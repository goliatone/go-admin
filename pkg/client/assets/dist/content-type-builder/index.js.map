{"version":3,"file":"index.js","sources":["../../src/content-type-builder/api-client.ts","../../src/content-type-builder/field-type-picker.ts","../../src/content-type-builder/field-config-form.ts","../../src/content-type-builder/layout-editor.ts","../../src/content-type-builder/content-type-editor.ts","../../src/content-type-builder/block-library-manager.ts","../../src/content-type-builder/index.ts"],"sourcesContent":["/**\n * Content Type API Client\n *\n * Handles all API communication for content type management.\n */\n\nimport type {\n  ContentType,\n  ContentTypeListResponse,\n  SchemaValidationRequest,\n  SchemaValidationResponse,\n  SchemaPreviewRequest,\n  SchemaPreviewResponse,\n  APIErrorResponse,\n  JSONSchema,\n  UISchemaOverlay,\n  BlockDefinition,\n  BlockDefinitionListResponse,\n  BlockDefinitionSummary,\n  BlockSchemaVersion,\n  ContentTypeSchemaVersion,\n  CompatibilityCheckResult,\n} from './types';\n\nexport interface ContentTypeAPIConfig {\n  basePath: string;\n  headers?: Record<string, string>;\n  credentials?: RequestCredentials;\n}\n\nexport class ContentTypeAPIError extends Error {\n  readonly status: number;\n  readonly textCode?: string;\n  readonly fields?: Record<string, string>;\n\n  constructor(message: string, status: number, textCode?: string, fields?: Record<string, string>) {\n    super(message);\n    this.name = 'ContentTypeAPIError';\n    this.status = status;\n    this.textCode = textCode;\n    this.fields = fields;\n  }\n}\n\nexport class ContentTypeAPIClient {\n  private config: ContentTypeAPIConfig;\n\n  constructor(config: ContentTypeAPIConfig) {\n    this.config = {\n      basePath: config.basePath.replace(/\\/$/, ''),\n      headers: config.headers ?? {},\n      credentials: config.credentials ?? 'same-origin',\n    };\n  }\n\n  // ===========================================================================\n  // Content Type CRUD\n  // ===========================================================================\n\n  /**\n   * List all content types\n   */\n  async list(params?: { page?: number; per_page?: number; search?: string }): Promise<ContentTypeListResponse> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.search) queryParams.set('search', params.search);\n\n    const query = queryParams.toString();\n    const url = `${this.config.basePath}/api/content_types${query ? `?${query}` : ''}`;\n\n    const response = await this.fetch(url, { method: 'GET' });\n    const data = await response.json();\n\n    // Handle both array and paginated response formats\n    if (Array.isArray(data)) {\n      return { items: data, total: data.length };\n    }\n    if (data.items && Array.isArray(data.items)) {\n      return data as ContentTypeListResponse;\n    }\n    if (data.data && Array.isArray(data.data)) {\n      return { items: data.data, total: data.total ?? data.data.length };\n    }\n\n    return { items: [], total: 0 };\n  }\n\n  /**\n   * Get a single content type by ID or slug\n   */\n  async get(idOrSlug: string): Promise<ContentType> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}`;\n    const response = await this.fetch(url, { method: 'GET' });\n    const data = await response.json();\n\n    // Handle wrapped and unwrapped response formats\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Create a new content type\n   */\n  async create(contentType: Partial<ContentType>): Promise<ContentType> {\n    const url = `${this.config.basePath}/api/content_types`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(contentType),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Update an existing content type\n   */\n  async update(idOrSlug: string, contentType: Partial<ContentType>): Promise<ContentType> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}`;\n    const response = await this.fetch(url, {\n      method: 'PUT',\n      body: JSON.stringify(contentType),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Delete a content type\n   */\n  async delete(idOrSlug: string): Promise<void> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}`;\n    await this.fetch(url, { method: 'DELETE' });\n  }\n\n  // ===========================================================================\n  // Content Type Lifecycle (Publish, Clone, Deprecate)\n  // ===========================================================================\n\n  /**\n   * Publish a content type (change status to active)\n   */\n  async publish(idOrSlug: string, force?: boolean): Promise<ContentType> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}/publish`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ force: force ?? false }),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Deprecate a content type\n   */\n  async deprecate(idOrSlug: string): Promise<ContentType> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}/deprecate`;\n    const response = await this.fetch(url, { method: 'POST' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Clone a content type\n   */\n  async clone(idOrSlug: string, newSlug: string, newName?: string): Promise<ContentType> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}/clone`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ slug: newSlug, name: newName }),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Check compatibility between current schema and a new schema\n   */\n  async checkCompatibility(\n    idOrSlug: string,\n    newSchema: JSONSchema,\n    newUiSchema?: UISchemaOverlay\n  ): Promise<CompatibilityCheckResult> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}/compatibility`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ schema: newSchema, ui_schema: newUiSchema }),\n    });\n    return await response.json();\n  }\n\n  /**\n   * Get content type schema version history\n   */\n  async getVersionHistory(idOrSlug: string): Promise<{ versions: ContentTypeSchemaVersion[] }> {\n    const url = `${this.config.basePath}/api/content_types/${encodeURIComponent(idOrSlug)}/versions`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      return { versions: data.versions ?? data.items ?? data ?? [] };\n    } catch {\n      return { versions: [] };\n    }\n  }\n\n  // ===========================================================================\n  // Schema Validation & Preview\n  // ===========================================================================\n\n  /**\n   * Validate a JSON schema\n   */\n  async validateSchema(request: SchemaValidationRequest): Promise<SchemaValidationResponse> {\n    const url = `${this.config.basePath}/api/content_types/validate`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(request),\n    });\n    const data = await response.json();\n    return data;\n  }\n\n  /**\n   * Generate a preview of the schema as a rendered form\n   */\n  async previewSchema(request: SchemaPreviewRequest): Promise<SchemaPreviewResponse> {\n    const url = `${this.config.basePath}/api/content_types/preview`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(request),\n    });\n    const data = await response.json();\n    return data;\n  }\n\n  // ===========================================================================\n  // Block Definitions (for blocks field configuration)\n  // ===========================================================================\n\n  /**\n   * List available block definitions (summary)\n   */\n  async listBlockDefinitionsSummary(): Promise<BlockDefinitionSummary[]> {\n    const url = `${this.config.basePath}/api/block_definitions`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      if (Array.isArray(data)) return data;\n      if (data.items && Array.isArray(data.items)) return data.items;\n      if (data.data && Array.isArray(data.data)) return data.data;\n      return [];\n    } catch {\n      // Block definitions may not be available\n      return [];\n    }\n  }\n\n  /**\n   * List block definitions with full details\n   */\n  async listBlockDefinitions(params?: {\n    page?: number;\n    per_page?: number;\n    search?: string;\n    category?: string;\n    status?: string;\n  }): Promise<BlockDefinitionListResponse> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.search) queryParams.set('search', params.search);\n    if (params?.category) queryParams.set('category', params.category);\n    if (params?.status) queryParams.set('status', params.status);\n\n    const query = queryParams.toString();\n    const url = `${this.config.basePath}/api/block_definitions${query ? `?${query}` : ''}`;\n\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n\n      if (Array.isArray(data)) {\n        return { items: data, total: data.length };\n      }\n      if (data.items && Array.isArray(data.items)) {\n        return data as BlockDefinitionListResponse;\n      }\n      if (data.data && Array.isArray(data.data)) {\n        return { items: data.data, total: data.total ?? data.data.length };\n      }\n\n      return { items: [], total: 0 };\n    } catch {\n      return { items: [], total: 0 };\n    }\n  }\n\n  /**\n   * Get a single block definition by ID or type\n   */\n  async getBlockDefinition(idOrType: string): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/api/block_definitions/${encodeURIComponent(idOrType)}`;\n    const response = await this.fetch(url, { method: 'GET' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Create a new block definition\n   */\n  async createBlockDefinition(block: Partial<BlockDefinition>): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/api/block_definitions`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(block),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Update an existing block definition\n   */\n  async updateBlockDefinition(idOrType: string, block: Partial<BlockDefinition>): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/api/block_definitions/${encodeURIComponent(idOrType)}`;\n    const response = await this.fetch(url, {\n      method: 'PUT',\n      body: JSON.stringify(block),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Delete a block definition\n   */\n  async deleteBlockDefinition(idOrType: string): Promise<void> {\n    const url = `${this.config.basePath}/api/block_definitions/${encodeURIComponent(idOrType)}`;\n    await this.fetch(url, { method: 'DELETE' });\n  }\n\n  /**\n   * Publish a block definition (change status to active)\n   */\n  async publishBlockDefinition(idOrType: string): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/api/block_definitions/${encodeURIComponent(idOrType)}/publish`;\n    const response = await this.fetch(url, { method: 'POST' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Deprecate a block definition\n   */\n  async deprecateBlockDefinition(idOrType: string): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/api/block_definitions/${encodeURIComponent(idOrType)}/deprecate`;\n    const response = await this.fetch(url, { method: 'POST' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Clone a block definition\n   */\n  async cloneBlockDefinition(idOrType: string, newType: string): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/api/block_definitions/${encodeURIComponent(idOrType)}/clone`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ type: newType }),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Get block definition schema version history\n   */\n  async getBlockDefinitionVersions(idOrType: string): Promise<{ versions: BlockSchemaVersion[] }> {\n    const url = `${this.config.basePath}/api/block_definitions/${encodeURIComponent(idOrType)}/versions`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      return { versions: data.versions ?? data.items ?? data ?? [] };\n    } catch {\n      return { versions: [] };\n    }\n  }\n\n  /**\n   * Get block categories\n   */\n  async getBlockCategories(): Promise<string[]> {\n    const url = `${this.config.basePath}/api/block_definitions/categories`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      return Array.isArray(data) ? data : data.categories ?? [];\n    } catch {\n      return ['content', 'media', 'layout', 'interactive', 'custom'];\n    }\n  }\n\n  // ===========================================================================\n  // Helpers\n  // ===========================================================================\n\n  private async fetch(url: string, options: RequestInit): Promise<Response> {\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n      Accept: 'application/json',\n      ...this.config.headers,\n    };\n\n    const response = await fetch(url, {\n      ...options,\n      headers,\n      credentials: this.config.credentials,\n    });\n\n    if (!response.ok) {\n      await this.handleError(response);\n    }\n\n    return response;\n  }\n\n  private async handleError(response: Response): Promise<never> {\n    let errorData: APIErrorResponse | null = null;\n\n    try {\n      errorData = await response.json();\n    } catch {\n      // Response may not be JSON\n    }\n\n    const message = errorData?.error ?? response.statusText ?? 'Request failed';\n    throw new ContentTypeAPIError(message, response.status, errorData?.text_code, errorData?.fields);\n  }\n}\n\n// ===========================================================================\n// Schema Conversion Utilities\n// ===========================================================================\n\nimport type { FieldDefinition, FieldType } from './types';\n\n/**\n * Convert field definitions to JSON Schema\n */\nexport function fieldsToSchema(fields: FieldDefinition[], slug?: string): JSONSchema {\n  const properties: Record<string, JSONSchema> = {};\n  const required: string[] = [];\n\n  for (const field of fields) {\n    properties[field.name] = fieldToSchemaProperty(field);\n    if (field.required) {\n      required.push(field.name);\n    }\n  }\n\n  const schema: JSONSchema = {\n    $schema: 'https://json-schema.org/draft/2020-12/schema',\n    type: 'object',\n    properties,\n  };\n\n  if (slug) {\n    schema.$id = slug;\n  }\n\n  if (required.length > 0) {\n    schema.required = required;\n  }\n\n  return schema;\n}\n\n/**\n * Convert a single field to a JSON Schema property\n */\nfunction fieldToSchemaProperty(field: FieldDefinition): JSONSchema {\n  const schema: JSONSchema = {};\n\n  // Base type mapping\n  const typeMapping: Record<FieldType, { type: JSONSchema['type']; format?: string }> = {\n    text: { type: 'string' },\n    textarea: { type: 'string' },\n    'rich-text': { type: 'string' },\n    markdown: { type: 'string' },\n    code: { type: 'string' },\n    number: { type: 'number' },\n    integer: { type: 'integer' },\n    currency: { type: 'number' },\n    percentage: { type: 'number' },\n    select: { type: 'string' },\n    radio: { type: 'string' },\n    checkbox: { type: 'boolean' },\n    chips: { type: 'array' },\n    toggle: { type: 'boolean' },\n    date: { type: 'string', format: 'date' },\n    time: { type: 'string', format: 'time' },\n    datetime: { type: 'string', format: 'date-time' },\n    daterange: { type: 'object' },\n    'media-picker': { type: 'string', format: 'uri' },\n    'media-gallery': { type: 'array' },\n    'file-upload': { type: 'string', format: 'uri' },\n    reference: { type: 'string', format: 'uuid' },\n    references: { type: 'array' },\n    user: { type: 'string', format: 'uuid' },\n    group: { type: 'object' },\n    repeater: { type: 'array' },\n    blocks: { type: 'array' },\n    json: { type: 'object' },\n    slug: { type: 'string' },\n    color: { type: 'string' },\n    location: { type: 'object' },\n  };\n\n  const mapping = typeMapping[field.type] ?? { type: 'string' };\n  schema.type = mapping.type;\n  if (mapping.format) {\n    schema.format = mapping.format;\n  }\n\n  // Title and description\n  if (field.label) {\n    schema.title = field.label;\n  }\n  if (field.description) {\n    schema.description = field.description;\n  }\n\n  // Default value\n  if (field.defaultValue !== undefined) {\n    schema.default = field.defaultValue;\n  }\n\n  // Validation constraints\n  if (field.validation) {\n    if (field.validation.minLength !== undefined) {\n      schema.minLength = field.validation.minLength;\n    }\n    if (field.validation.maxLength !== undefined) {\n      schema.maxLength = field.validation.maxLength;\n    }\n    if (field.validation.min !== undefined) {\n      schema.minimum = field.validation.min;\n    }\n    if (field.validation.max !== undefined) {\n      schema.maximum = field.validation.max;\n    }\n    if (field.validation.pattern) {\n      schema.pattern = field.validation.pattern;\n    }\n  }\n\n  // x-formgen extension\n  const formgen: Record<string, unknown> = {};\n  const widget = fieldTypeToWidget(field.type);\n  if (widget) {\n    formgen.widget = widget;\n  }\n  if (field.placeholder) {\n    formgen.placeholder = field.placeholder;\n  }\n  if (field.helpText) {\n    formgen.helpText = field.helpText;\n  }\n  if (field.section) {\n    formgen.section = field.section;\n  }\n  if (field.order !== undefined) {\n    formgen.order = field.order;\n  }\n  if (field.gridSpan !== undefined) {\n    formgen.grid = { span: field.gridSpan };\n  }\n  if (field.readonly) {\n    formgen.readonly = true;\n  }\n  if (field.hidden) {\n    formgen.hidden = true;\n  }\n\n  if (Object.keys(formgen).length > 0) {\n    schema['x-formgen'] = formgen as FormgenExtension;\n  }\n\n  // Type-specific handling\n  switch (field.type) {\n    case 'select':\n    case 'radio':\n      if (field.config && 'options' in field.config && field.config.options) {\n        schema.enum = field.config.options.map((opt) => opt.value);\n      }\n      break;\n\n    case 'chips':\n      schema.items = { type: 'string' };\n      if (field.config && 'options' in field.config && field.config.options) {\n        schema.items.enum = field.config.options.map((opt) => opt.value);\n      }\n      break;\n\n    case 'media-gallery':\n    case 'references':\n      schema.items = { type: 'string', format: 'uri' };\n      break;\n\n    case 'repeater':\n      if (field.config && 'fields' in field.config && field.config.fields) {\n        schema.items = fieldsToSchema(field.config.fields);\n      }\n      break;\n\n    case 'blocks': {\n      // Blocks use oneOf with _type discriminator pattern\n      const blocksConfig = field.config as import('./types').BlocksFieldConfig | undefined;\n\n      // Build the items schema with oneOf and discriminator\n      const itemsSchema: JSONSchema = {\n        type: 'object',\n        properties: {\n          _type: {\n            type: 'string',\n            description: 'Block type discriminator',\n          },\n          _schema: {\n            type: 'string',\n            description: 'Block schema version',\n          },\n        },\n        required: ['_type'],\n      };\n\n      // If we have allowed blocks, create oneOf with explicit types\n      if (blocksConfig?.allowedBlocks && blocksConfig.allowedBlocks.length > 0) {\n        itemsSchema.oneOf = blocksConfig.allowedBlocks.map((blockType) => ({\n          type: 'object' as const,\n          properties: {\n            _type: { const: blockType },\n          },\n          required: ['_type'],\n        }));\n        // Add discriminator metadata\n        itemsSchema['x-discriminator'] = '_type';\n      }\n\n      schema.items = itemsSchema;\n\n      // Add min/max constraints\n      if (blocksConfig?.minBlocks !== undefined) {\n        schema.minItems = blocksConfig.minBlocks;\n      }\n      if (blocksConfig?.maxBlocks !== undefined) {\n        schema.maxItems = blocksConfig.maxBlocks;\n      }\n\n      // Build x-formgen with blocks configuration\n      const blocksFormgen: Record<string, unknown> = {\n        ...formgen,\n        widget: 'block',\n        sortable: true,\n      };\n      if (blocksConfig?.allowedBlocks) {\n        blocksFormgen.allowedBlocks = blocksConfig.allowedBlocks;\n      }\n      if (blocksConfig?.deniedBlocks) {\n        blocksFormgen.deniedBlocks = blocksConfig.deniedBlocks;\n      }\n      schema['x-formgen'] = blocksFormgen as FormgenExtension;\n      break;\n    }\n  }\n\n  return schema;\n}\n\n/**\n * Map field type to widget name\n */\nfunction fieldTypeToWidget(fieldType: FieldType): string | undefined {\n  const widgetMap: Partial<Record<FieldType, string>> = {\n    textarea: 'textarea',\n    'rich-text': 'rich-text',\n    markdown: 'markdown',\n    code: 'code-editor',\n    toggle: 'toggle',\n    chips: 'chips',\n    'media-picker': 'media-picker',\n    'media-gallery': 'media-picker',\n    'file-upload': 'file-upload',\n    blocks: 'block',\n    json: 'json-editor',\n    slug: 'slug',\n    color: 'color',\n  };\n  return widgetMap[fieldType];\n}\n\n/**\n * Convert JSON Schema to field definitions\n */\nexport function schemaToFields(schema: JSONSchema): FieldDefinition[] {\n  if (!schema.properties) {\n    return [];\n  }\n\n  const required = new Set(schema.required ?? []);\n  const fields: FieldDefinition[] = [];\n\n  for (const [name, propSchema] of Object.entries(schema.properties)) {\n    fields.push(schemaPropertyToField(name, propSchema, required.has(name)));\n  }\n\n  // Sort by x-formgen.order if present\n  fields.sort((a, b) => (a.order ?? 999) - (b.order ?? 999));\n\n  return fields;\n}\n\n/**\n * Convert a JSON Schema property to a field definition\n */\nfunction schemaPropertyToField(name: string, schema: JSONSchema, isRequired: boolean): FieldDefinition {\n  const formgen = schema['x-formgen'] as FormgenExtension | undefined;\n\n  const field: FieldDefinition = {\n    id: generateFieldId(),\n    name,\n    type: schemaToFieldType(schema),\n    label: schema.title ?? titleCase(name),\n    description: schema.description,\n    placeholder: formgen?.placeholder,\n    helpText: formgen?.helpText,\n    required: isRequired,\n    readonly: formgen?.readonly,\n    hidden: formgen?.hidden,\n    defaultValue: schema.default,\n    section: formgen?.section,\n    gridSpan: formgen?.grid?.span,\n    order: formgen?.order,\n  };\n\n  // Validation\n  const validation: FieldDefinition['validation'] = {};\n  if (schema.minLength !== undefined) validation.minLength = schema.minLength;\n  if (schema.maxLength !== undefined) validation.maxLength = schema.maxLength;\n  if (schema.minimum !== undefined) validation.min = schema.minimum;\n  if (schema.maximum !== undefined) validation.max = schema.maximum;\n  if (schema.pattern) validation.pattern = schema.pattern;\n  if (Object.keys(validation).length > 0) {\n    field.validation = validation;\n  }\n\n  // Enum options\n  if (schema.enum && Array.isArray(schema.enum)) {\n    field.config = {\n      options: schema.enum.map((value) => ({\n        value: String(value),\n        label: titleCase(String(value)),\n      })),\n    };\n  }\n\n  // Blocks configuration\n  if (field.type === 'blocks' && schema.type === 'array') {\n    const blocksConfig: import('./types').BlocksFieldConfig = {};\n\n    // Extract min/max from schema\n    if (schema.minItems !== undefined) {\n      blocksConfig.minBlocks = schema.minItems;\n    }\n    if (schema.maxItems !== undefined) {\n      blocksConfig.maxBlocks = schema.maxItems;\n    }\n\n    // Extract allowed blocks from x-formgen or oneOf\n    if (formgen?.allowedBlocks && Array.isArray(formgen.allowedBlocks)) {\n      blocksConfig.allowedBlocks = formgen.allowedBlocks as string[];\n    } else if (schema.items) {\n      const itemsSchema = schema.items as JSONSchema;\n      if (itemsSchema.oneOf && Array.isArray(itemsSchema.oneOf)) {\n        // Extract allowed block types from oneOf const values\n        const allowedTypes = itemsSchema.oneOf\n          .map((subSchema) => {\n            const typeSchema = subSchema as JSONSchema;\n            const typeProp = typeSchema.properties?._type as JSONSchema | undefined;\n            return typeProp?.const as string | undefined;\n          })\n          .filter((t): t is string => !!t);\n        if (allowedTypes.length > 0) {\n          blocksConfig.allowedBlocks = allowedTypes;\n        }\n      }\n    }\n\n    // Extract denied blocks from x-formgen\n    if (formgen?.deniedBlocks && Array.isArray(formgen.deniedBlocks)) {\n      blocksConfig.deniedBlocks = formgen.deniedBlocks as string[];\n    }\n\n    if (Object.keys(blocksConfig).length > 0) {\n      field.config = blocksConfig;\n    }\n  }\n\n  return field;\n}\n\n/**\n * Infer field type from JSON Schema property\n */\nfunction schemaToFieldType(schema: JSONSchema): FieldType {\n  const formgen = schema['x-formgen'] as FormgenExtension | undefined;\n\n  // Check explicit widget\n  if (formgen?.widget) {\n    const widgetToType: Record<string, FieldType> = {\n      textarea: 'textarea',\n      'rich-text': 'rich-text',\n      markdown: 'markdown',\n      'code-editor': 'code',\n      toggle: 'toggle',\n      chips: 'chips',\n      'media-picker': 'media-picker',\n      'file-upload': 'file-upload',\n      block: 'blocks',\n      'json-editor': 'json',\n      slug: 'slug',\n      color: 'color',\n    };\n    if (widgetToType[formgen.widget]) {\n      return widgetToType[formgen.widget];\n    }\n  }\n\n  // Infer from type + format\n  const type = Array.isArray(schema.type) ? schema.type[0] : schema.type;\n\n  switch (type) {\n    case 'string':\n      if (schema.format === 'date-time') return 'datetime';\n      if (schema.format === 'date') return 'date';\n      if (schema.format === 'time') return 'time';\n      if (schema.format === 'uri') return 'media-picker';\n      if (schema.format === 'uuid') return 'reference';\n      if (schema.enum) return 'select';\n      return 'text';\n\n    case 'number':\n      return 'number';\n\n    case 'integer':\n      return 'integer';\n\n    case 'boolean':\n      return 'toggle';\n\n    case 'array':\n      if (schema.items) {\n        const itemsSchema = schema.items as JSONSchema;\n        if (itemsSchema.oneOf) return 'blocks';\n        if (itemsSchema.enum) return 'chips';\n      }\n      return 'repeater';\n\n    case 'object':\n      return 'json';\n\n    default:\n      return 'text';\n  }\n}\n\n/**\n * Generate a unique field ID\n */\nexport function generateFieldId(): string {\n  return `field_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 7)}`;\n}\n\n/**\n * Convert string to title case\n */\nfunction titleCase(str: string): string {\n  return str\n    .replace(/([A-Z])/g, ' $1')\n    .replace(/[_-]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n    .split(' ')\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n}\n\nimport type { FormgenExtension } from './types';\n","/**\n * Field Type Picker\n *\n * Modal/drawer UI for selecting a field type when adding new fields.\n */\n\nimport type { FieldType, FieldTypeMetadata, FieldTypeCategory, FieldTypePickerConfig } from './types';\n\n// =============================================================================\n// Field Type Registry\n// =============================================================================\n\nexport const FIELD_TYPES: FieldTypeMetadata[] = [\n  // Text Fields\n  {\n    type: 'text',\n    label: 'Text',\n    description: 'Single line text input',\n    icon: 'T',\n    category: 'text',\n    defaultConfig: { validation: { maxLength: 255 } },\n  },\n  {\n    type: 'textarea',\n    label: 'Textarea',\n    description: 'Multi-line text input',\n    icon: 'Â¶',\n    category: 'text',\n    defaultConfig: { config: { multiline: true, rows: 4 } },\n  },\n  {\n    type: 'rich-text',\n    label: 'Rich Text',\n    description: 'WYSIWYG editor with formatting',\n    icon: 'Aa',\n    category: 'text',\n  },\n  {\n    type: 'markdown',\n    label: 'Markdown',\n    description: 'Markdown text editor',\n    icon: 'Md',\n    category: 'text',\n  },\n  {\n    type: 'code',\n    label: 'Code',\n    description: 'Code editor with syntax highlighting',\n    icon: '<>',\n    category: 'text',\n    defaultConfig: { config: { language: 'json', lineNumbers: true } },\n  },\n\n  // Number Fields\n  {\n    type: 'number',\n    label: 'Number',\n    description: 'Decimal number input',\n    icon: '#',\n    category: 'number',\n  },\n  {\n    type: 'integer',\n    label: 'Integer',\n    description: 'Whole number input',\n    icon: '1',\n    category: 'number',\n  },\n  {\n    type: 'currency',\n    label: 'Currency',\n    description: 'Money amount with currency symbol',\n    icon: '$',\n    category: 'number',\n    defaultConfig: { config: { precision: 2, prefix: '$' } },\n  },\n  {\n    type: 'percentage',\n    label: 'Percentage',\n    description: 'Percentage value (0-100)',\n    icon: '%',\n    category: 'number',\n    defaultConfig: { validation: { min: 0, max: 100 }, config: { suffix: '%' } },\n  },\n\n  // Selection Fields\n  {\n    type: 'select',\n    label: 'Select',\n    description: 'Dropdown selection',\n    icon: 'â–¼',\n    category: 'selection',\n    defaultConfig: { config: { options: [] } },\n  },\n  {\n    type: 'radio',\n    label: 'Radio',\n    description: 'Radio button selection',\n    icon: 'â—‰',\n    category: 'selection',\n    defaultConfig: { config: { options: [] } },\n  },\n  {\n    type: 'checkbox',\n    label: 'Checkbox',\n    description: 'Single checkbox (true/false)',\n    icon: 'â˜‘',\n    category: 'selection',\n  },\n  {\n    type: 'chips',\n    label: 'Chips',\n    description: 'Tag-style multi-select',\n    icon: 'âšª',\n    category: 'selection',\n    defaultConfig: { config: { options: [], multiple: true } },\n  },\n  {\n    type: 'toggle',\n    label: 'Toggle',\n    description: 'Boolean switch',\n    icon: 'â—',\n    category: 'selection',\n  },\n\n  // Date/Time Fields\n  {\n    type: 'date',\n    label: 'Date',\n    description: 'Date picker',\n    icon: 'ðŸ“…',\n    category: 'datetime',\n  },\n  {\n    type: 'time',\n    label: 'Time',\n    description: 'Time picker',\n    icon: 'ðŸ•',\n    category: 'datetime',\n  },\n  {\n    type: 'datetime',\n    label: 'Date & Time',\n    description: 'Date and time picker',\n    icon: 'ðŸ“†',\n    category: 'datetime',\n  },\n\n  // Media Fields\n  {\n    type: 'media-picker',\n    label: 'Media',\n    description: 'Single media asset picker',\n    icon: 'ðŸ–¼',\n    category: 'media',\n    defaultConfig: { config: { accept: 'image/*' } },\n  },\n  {\n    type: 'media-gallery',\n    label: 'Gallery',\n    description: 'Multiple media assets',\n    icon: 'ðŸŽž',\n    category: 'media',\n    defaultConfig: { config: { accept: 'image/*', multiple: true } },\n  },\n  {\n    type: 'file-upload',\n    label: 'File',\n    description: 'File attachment',\n    icon: 'ðŸ“Ž',\n    category: 'media',\n  },\n\n  // Reference Fields\n  {\n    type: 'reference',\n    label: 'Reference',\n    description: 'Link to another content type',\n    icon: 'ðŸ”—',\n    category: 'reference',\n    defaultConfig: { config: { target: '', displayField: 'name' } },\n  },\n  {\n    type: 'references',\n    label: 'References',\n    description: 'Multiple links to another content type',\n    icon: 'â›“',\n    category: 'reference',\n    defaultConfig: { config: { target: '', displayField: 'name', multiple: true } },\n  },\n  {\n    type: 'user',\n    label: 'User',\n    description: 'User reference',\n    icon: 'ðŸ‘¤',\n    category: 'reference',\n  },\n\n  // Structural Fields\n  {\n    type: 'group',\n    label: 'Group',\n    description: 'Collapsible field group',\n    icon: 'ðŸ“',\n    category: 'structural',\n  },\n  {\n    type: 'repeater',\n    label: 'Repeater',\n    description: 'Repeatable field group',\n    icon: 'ðŸ”„',\n    category: 'structural',\n    defaultConfig: { config: { fields: [], minItems: 0, maxItems: 10 } },\n  },\n  {\n    type: 'blocks',\n    label: 'Blocks',\n    description: 'Modular content blocks',\n    icon: 'ðŸ§©',\n    category: 'structural',\n    defaultConfig: { config: { allowedBlocks: [] } },\n  },\n\n  // Advanced Fields\n  {\n    type: 'json',\n    label: 'JSON',\n    description: 'Raw JSON editor',\n    icon: '{}',\n    category: 'advanced',\n  },\n  {\n    type: 'slug',\n    label: 'Slug',\n    description: 'URL-friendly identifier',\n    icon: 'ðŸ”–',\n    category: 'advanced',\n    defaultConfig: { validation: { pattern: '^[a-z0-9-]+$' } },\n  },\n  {\n    type: 'color',\n    label: 'Color',\n    description: 'Color picker',\n    icon: 'ðŸŽ¨',\n    category: 'advanced',\n  },\n  {\n    type: 'location',\n    label: 'Location',\n    description: 'Geographic coordinates',\n    icon: 'ðŸ“',\n    category: 'advanced',\n  },\n];\n\nexport const FIELD_CATEGORIES: { id: FieldTypeCategory; label: string; icon: string }[] = [\n  { id: 'text', label: 'Text', icon: 'T' },\n  { id: 'number', label: 'Numbers', icon: '#' },\n  { id: 'selection', label: 'Selection', icon: 'â–¼' },\n  { id: 'datetime', label: 'Date & Time', icon: 'ðŸ“…' },\n  { id: 'media', label: 'Media', icon: 'ðŸ–¼' },\n  { id: 'reference', label: 'References', icon: 'ðŸ”—' },\n  { id: 'structural', label: 'Structural', icon: 'ðŸ“' },\n  { id: 'advanced', label: 'Advanced', icon: 'âš™' },\n];\n\nexport function getFieldTypeMetadata(type: FieldType): FieldTypeMetadata | undefined {\n  return FIELD_TYPES.find((ft) => ft.type === type);\n}\n\nexport function getFieldTypesByCategory(category: FieldTypeCategory): FieldTypeMetadata[] {\n  return FIELD_TYPES.filter((ft) => ft.category === category);\n}\n\n// =============================================================================\n// Field Type Picker Component\n// =============================================================================\n\nexport class FieldTypePicker {\n  private config: FieldTypePickerConfig;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private selectedCategory: FieldTypeCategory = 'text';\n  private searchQuery: string = '';\n\n  constructor(config: FieldTypePickerConfig) {\n    this.config = config;\n  }\n\n  /**\n   * Show the field type picker modal\n   */\n  show(): void {\n    this.render();\n    this.bindEvents();\n    // Focus search input\n    const searchInput = this.container?.querySelector<HTMLInputElement>('[data-field-type-search]');\n    searchInput?.focus();\n  }\n\n  /**\n   * Hide the field type picker modal\n   */\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    // Create backdrop\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-50 flex items-center justify-center bg-black/50 transition-opacity duration-150';\n    this.backdrop.setAttribute('data-field-type-picker-backdrop', 'true');\n\n    // Create modal container\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col overflow-hidden';\n    this.container.setAttribute('data-field-type-picker', 'true');\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Add Field</h2>\n        <button type=\"button\" data-field-type-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div class=\"relative\">\n          <svg class=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n          </svg>\n          <input\n            type=\"text\"\n            data-field-type-search\n            placeholder=\"Search field types...\"\n            class=\"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n      </div>\n\n      <div class=\"flex flex-1 overflow-hidden\">\n        <div class=\"w-48 border-r border-gray-200 dark:border-gray-700 overflow-y-auto\" data-field-type-categories>\n          ${this.renderCategories()}\n        </div>\n\n        <div class=\"flex-1 overflow-y-auto p-4\" data-field-type-list>\n          ${this.renderFieldTypes()}\n        </div>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    // Trigger animation\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private renderCategories(): string {\n    return FIELD_CATEGORIES.map(\n      (cat) => `\n      <button\n        type=\"button\"\n        data-field-category=\"${cat.id}\"\n        class=\"w-full flex items-center gap-3 px-4 py-3 text-sm text-left transition-colors ${\n          cat.id === this.selectedCategory\n            ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium'\n            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800'\n        }\"\n      >\n        <span class=\"flex-shrink-0 w-6 text-center\">${cat.icon}</span>\n        <span>${cat.label}</span>\n      </button>\n    `\n    ).join('');\n  }\n\n  private renderFieldTypes(): string {\n    const excludeSet = new Set(this.config.excludeTypes ?? []);\n    let types = FIELD_TYPES.filter((ft) => !excludeSet.has(ft.type));\n\n    // Filter by search query\n    if (this.searchQuery) {\n      const query = this.searchQuery.toLowerCase();\n      types = types.filter(\n        (ft) =>\n          ft.label.toLowerCase().includes(query) ||\n          ft.description.toLowerCase().includes(query) ||\n          ft.type.toLowerCase().includes(query)\n      );\n    } else {\n      // Filter by category when not searching\n      types = types.filter((ft) => ft.category === this.selectedCategory);\n    }\n\n    if (types.length === 0) {\n      return `\n        <div class=\"flex flex-col items-center justify-center h-full text-gray-400\">\n          <svg class=\"w-12 h-12 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n          </svg>\n          <p class=\"text-sm\">No field types found</p>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"grid grid-cols-2 gap-3\">\n        ${types.map((ft) => this.renderFieldTypeCard(ft)).join('')}\n      </div>\n    `;\n  }\n\n  private renderFieldTypeCard(fieldType: FieldTypeMetadata): string {\n    return `\n      <button\n        type=\"button\"\n        data-field-type-select=\"${fieldType.type}\"\n        class=\"flex items-start gap-3 p-4 text-left border border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors group\"\n      >\n        <span class=\"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 group-hover:bg-blue-100 dark:group-hover:bg-blue-900/40 group-hover:text-blue-600 dark:group-hover:text-blue-400 text-lg font-medium\">\n          ${fieldType.icon}\n        </span>\n        <div class=\"flex-1 min-w-0\">\n          <div class=\"font-medium text-gray-900 dark:text-white\">${fieldType.label}</div>\n          <div class=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5 line-clamp-2\">${fieldType.description}</div>\n        </div>\n      </button>\n    `;\n  }\n\n  private bindEvents(): void {\n    if (!this.container || !this.backdrop) return;\n\n    // Close on backdrop click\n    this.backdrop.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n\n    // Close button\n    this.container.querySelector('[data-field-type-close]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Category selection\n    this.container.querySelectorAll('[data-field-category]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        this.selectedCategory = btn.getAttribute('data-field-category') as FieldTypeCategory;\n        this.searchQuery = '';\n        const searchInput = this.container?.querySelector<HTMLInputElement>('[data-field-type-search]');\n        if (searchInput) searchInput.value = '';\n        this.updateView();\n      });\n    });\n\n    // Field type selection\n    this.container.addEventListener('click', (e) => {\n      const target = (e.target as HTMLElement).closest('[data-field-type-select]');\n      if (target) {\n        const type = target.getAttribute('data-field-type-select') as FieldType;\n        this.config.onSelect(type);\n        this.hide();\n      }\n    });\n\n    // Search\n    const searchInput = this.container.querySelector<HTMLInputElement>('[data-field-type-search]');\n    searchInput?.addEventListener('input', () => {\n      this.searchQuery = searchInput.value;\n      this.updateView();\n    });\n\n    // Keyboard navigation\n    this.container.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n  }\n\n  private updateView(): void {\n    if (!this.container) return;\n\n    // Update categories\n    const categoriesContainer = this.container.querySelector('[data-field-type-categories]');\n    if (categoriesContainer) {\n      categoriesContainer.innerHTML = this.renderCategories();\n      // Re-bind category events\n      categoriesContainer.querySelectorAll('[data-field-category]').forEach((btn) => {\n        btn.addEventListener('click', () => {\n          this.selectedCategory = btn.getAttribute('data-field-category') as FieldTypeCategory;\n          this.searchQuery = '';\n          const searchInput = this.container?.querySelector<HTMLInputElement>('[data-field-type-search]');\n          if (searchInput) searchInput.value = '';\n          this.updateView();\n        });\n      });\n    }\n\n    // Update field types list\n    const listContainer = this.container.querySelector('[data-field-type-list]');\n    if (listContainer) {\n      listContainer.innerHTML = this.renderFieldTypes();\n    }\n  }\n}\n","/**\n * Field Configuration Form\n *\n * Modal/drawer UI for configuring a field's properties.\n */\n\nimport type {\n  FieldDefinition,\n  FieldConfigFormConfig,\n  FieldType,\n  SelectOption,\n  SlugFieldConfig,\n  ColorFieldConfig,\n  LocationFieldConfig,\n  DateRangeFieldConfig,\n  RepeaterFieldConfig,\n  BlocksFieldConfig,\n  BlockDefinitionSummary,\n} from './types';\nimport { getFieldTypeMetadata, FIELD_TYPES } from './field-type-picker';\nimport { generateFieldId, ContentTypeAPIClient } from './api-client';\n\n// =============================================================================\n// Field Config Form Component\n// =============================================================================\n\nexport class FieldConfigForm {\n  private config: FieldConfigFormConfig;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private field: FieldDefinition;\n  private isNewField: boolean;\n\n  constructor(config: FieldConfigFormConfig) {\n    this.config = config;\n    this.field = { ...config.field };\n    this.isNewField = !config.field.id || config.field.id.startsWith('new_');\n  }\n\n  /**\n   * Show the field config form modal\n   */\n  show(): void {\n    this.render();\n    this.bindEvents();\n    // Focus first input\n    const firstInput = this.container?.querySelector<HTMLInputElement>('input[name=\"name\"]');\n    firstInput?.focus();\n    firstInput?.select();\n  }\n\n  /**\n   * Hide the field config form modal\n   */\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    const fieldMeta = getFieldTypeMetadata(this.field.type);\n\n    // Create backdrop\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-50 flex items-center justify-center bg-black/50 transition-opacity duration-150';\n    this.backdrop.setAttribute('data-field-config-backdrop', 'true');\n\n    // Create modal container\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden';\n    this.container.setAttribute('data-field-config-form', 'true');\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center gap-3\">\n          <span class=\"flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 text-lg font-medium\">\n            ${fieldMeta?.icon ?? '?'}\n          </span>\n          <div>\n            <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              ${this.isNewField ? 'Add' : 'Edit'} ${fieldMeta?.label ?? 'Field'}\n            </h2>\n            <p class=\"text-sm text-gray-500 dark:text-gray-400\">${fieldMeta?.description ?? ''}</p>\n          </div>\n        </div>\n        <button type=\"button\" data-field-config-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto px-6 py-4\">\n        <form data-field-config-form-element class=\"space-y-6\">\n          ${this.renderGeneralSection()}\n          ${this.renderValidationSection()}\n          ${this.renderAppearanceSection()}\n          ${this.renderTypeSpecificSection()}\n        </form>\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-field-config-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-field-config-save\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          ${this.isNewField ? 'Add Field' : 'Save Changes'}\n        </button>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    // Trigger animation\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private renderGeneralSection(): string {\n    return `\n      <div class=\"space-y-4\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">General</h3>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Field Name <span class=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              name=\"name\"\n              value=\"${escapeHtml(this.field.name)}\"\n              placeholder=\"field_name\"\n              pattern=\"^[a-z][a-z0-9_]*$\"\n              required\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Lowercase letters, numbers, underscores. Starts with letter.</p>\n          </div>\n\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Label <span class=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              name=\"label\"\n              value=\"${escapeHtml(this.field.label)}\"\n              placeholder=\"Field Label\"\n              required\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            Description\n          </label>\n          <textarea\n            name=\"description\"\n            rows=\"2\"\n            placeholder=\"Help text for editors\"\n            class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none\"\n          >${escapeHtml(this.field.description ?? '')}</textarea>\n        </div>\n\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            Placeholder\n          </label>\n          <input\n            type=\"text\"\n            name=\"placeholder\"\n            value=\"${escapeHtml(this.field.placeholder ?? '')}\"\n            placeholder=\"Placeholder text\"\n            class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div class=\"flex items-center gap-6\">\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"required\"\n              ${this.field.required ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Required</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"readonly\"\n              ${this.field.readonly ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Read-only</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"hidden\"\n              ${this.field.hidden ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Hidden</span>\n          </label>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderValidationSection(): string {\n    const validation = this.field.validation ?? {};\n    const showStringValidation = ['text', 'textarea', 'rich-text', 'markdown', 'code', 'slug'].includes(\n      this.field.type\n    );\n    const showNumberValidation = ['number', 'integer', 'currency', 'percentage'].includes(this.field.type);\n\n    if (!showStringValidation && !showNumberValidation) {\n      return '';\n    }\n\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Validation</h3>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          ${\n            showStringValidation\n              ? `\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Min Length\n              </label>\n              <input\n                type=\"number\"\n                name=\"minLength\"\n                value=\"${validation.minLength ?? ''}\"\n                min=\"0\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Max Length\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxLength\"\n                value=\"${validation.maxLength ?? ''}\"\n                min=\"0\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          `\n              : ''\n          }\n\n          ${\n            showNumberValidation\n              ? `\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Minimum\n              </label>\n              <input\n                type=\"number\"\n                name=\"min\"\n                value=\"${validation.min ?? ''}\"\n                step=\"any\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Maximum\n              </label>\n              <input\n                type=\"number\"\n                name=\"max\"\n                value=\"${validation.max ?? ''}\"\n                step=\"any\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          `\n              : ''\n          }\n        </div>\n\n        ${\n          showStringValidation\n            ? `\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Pattern (RegEx)\n            </label>\n            <input\n              type=\"text\"\n              name=\"pattern\"\n              value=\"${escapeHtml(validation.pattern ?? '')}\"\n              placeholder=\"^[a-z]+$\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono\"\n            />\n          </div>\n        `\n            : ''\n        }\n      </div>\n    `;\n  }\n\n  private renderAppearanceSection(): string {\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Appearance</h3>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Section/Tab\n            </label>\n            <input\n              type=\"text\"\n              name=\"section\"\n              value=\"${escapeHtml(this.field.section ?? '')}\"\n              placeholder=\"main\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Grid Span (1-12)\n            </label>\n            <input\n              type=\"number\"\n              name=\"gridSpan\"\n              value=\"${this.field.gridSpan ?? ''}\"\n              min=\"1\"\n              max=\"12\"\n              placeholder=\"12\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTypeSpecificSection(): string {\n    const sections: string[] = [];\n\n    // Select/Radio/Chips options\n    if (['select', 'radio', 'chips'].includes(this.field.type)) {\n      const config = this.field.config as { options?: SelectOption[] } | undefined;\n      const options = config?.options ?? [];\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <div class=\"flex items-center justify-between\">\n            <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Options</h3>\n            <button\n              type=\"button\"\n              data-add-option\n              class=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n            >\n              + Add Option\n            </button>\n          </div>\n\n          <div data-options-list class=\"space-y-2\">\n            ${options\n              .map(\n                (opt, i) => `\n              <div class=\"flex items-center gap-2\" data-option-row=\"${i}\">\n                <input\n                  type=\"text\"\n                  name=\"option_value_${i}\"\n                  value=\"${escapeHtml(String(opt.value))}\"\n                  placeholder=\"value\"\n                  class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n                <input\n                  type=\"text\"\n                  name=\"option_label_${i}\"\n                  value=\"${escapeHtml(opt.label)}\"\n                  placeholder=\"label\"\n                  class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n                <button\n                  type=\"button\"\n                  data-remove-option=\"${i}\"\n                  class=\"p-2 text-gray-400 hover:text-red-500\"\n                >\n                  <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                  </svg>\n                </button>\n              </div>\n            `\n              )\n              .join('')}\n          </div>\n        </div>\n      `);\n    }\n\n    // Reference target\n    if (['reference', 'references', 'user'].includes(this.field.type)) {\n      const config = this.field.config as { target?: string; displayField?: string } | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Reference Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Target Content Type\n              </label>\n              <input\n                type=\"text\"\n                name=\"target\"\n                value=\"${escapeHtml(config?.target ?? '')}\"\n                placeholder=\"users\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Display Field\n              </label>\n              <input\n                type=\"text\"\n                name=\"displayField\"\n                value=\"${escapeHtml(config?.displayField ?? '')}\"\n                placeholder=\"name\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n        </div>\n      `);\n    }\n\n    // Media settings\n    if (['media-picker', 'media-gallery', 'file-upload'].includes(this.field.type)) {\n      const config = this.field.config as { accept?: string; maxSize?: number; multiple?: boolean } | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Media Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Accept Types\n              </label>\n              <input\n                type=\"text\"\n                name=\"accept\"\n                value=\"${escapeHtml(config?.accept ?? '')}\"\n                placeholder=\"image/*\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Max Size (MB)\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxSize\"\n                value=\"${config?.maxSize ?? ''}\"\n                min=\"0\"\n                placeholder=\"10\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          ${\n            this.field.type === 'media-gallery'\n              ? `\n            <label class=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                name=\"multiple\"\n                ${config?.multiple !== false ? 'checked' : ''}\n                class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n              />\n              <span class=\"text-sm text-gray-700 dark:text-gray-300\">Allow multiple files</span>\n            </label>\n          `\n              : ''\n          }\n        </div>\n      `);\n    }\n\n    // Code editor settings\n    if (this.field.type === 'code') {\n      const config = this.field.config as { language?: string; lineNumbers?: boolean } | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Code Editor Settings</h3>\n\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Language\n            </label>\n            <select\n              name=\"language\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"json\" ${config?.language === 'json' ? 'selected' : ''}>JSON</option>\n              <option value=\"javascript\" ${config?.language === 'javascript' ? 'selected' : ''}>JavaScript</option>\n              <option value=\"typescript\" ${config?.language === 'typescript' ? 'selected' : ''}>TypeScript</option>\n              <option value=\"html\" ${config?.language === 'html' ? 'selected' : ''}>HTML</option>\n              <option value=\"css\" ${config?.language === 'css' ? 'selected' : ''}>CSS</option>\n              <option value=\"sql\" ${config?.language === 'sql' ? 'selected' : ''}>SQL</option>\n              <option value=\"yaml\" ${config?.language === 'yaml' ? 'selected' : ''}>YAML</option>\n              <option value=\"markdown\" ${config?.language === 'markdown' ? 'selected' : ''}>Markdown</option>\n            </select>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"lineNumbers\"\n              ${config?.lineNumbers !== false ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Show line numbers</span>\n          </label>\n        </div>\n      `);\n    }\n\n    // Slug field settings\n    if (this.field.type === 'slug') {\n      const config = this.field.config as SlugFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Slug Settings</h3>\n\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Source Field\n            </label>\n            <input\n              type=\"text\"\n              name=\"sourceField\"\n              value=\"${escapeHtml(config?.sourceField ?? '')}\"\n              placeholder=\"title\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Field name to generate slug from (e.g., title)</p>\n          </div>\n\n          <div class=\"grid grid-cols-3 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Prefix\n              </label>\n              <input\n                type=\"text\"\n                name=\"slugPrefix\"\n                value=\"${escapeHtml(config?.prefix ?? '')}\"\n                placeholder=\"\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Suffix\n              </label>\n              <input\n                type=\"text\"\n                name=\"slugSuffix\"\n                value=\"${escapeHtml(config?.suffix ?? '')}\"\n                placeholder=\"\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Separator\n              </label>\n              <select\n                name=\"slugSeparator\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <option value=\"-\" ${config?.separator === '-' || !config?.separator ? 'selected' : ''}>Hyphen (-)</option>\n                <option value=\"_\" ${config?.separator === '_' ? 'selected' : ''}>Underscore (_)</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      `);\n    }\n\n    // Color field settings\n    if (this.field.type === 'color') {\n      const config = this.field.config as ColorFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Color Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Format\n              </label>\n              <select\n                name=\"colorFormat\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <option value=\"hex\" ${config?.format === 'hex' || !config?.format ? 'selected' : ''}>HEX (#ff0000)</option>\n                <option value=\"rgb\" ${config?.format === 'rgb' ? 'selected' : ''}>RGB (rgb(255,0,0))</option>\n                <option value=\"hsl\" ${config?.format === 'hsl' ? 'selected' : ''}>HSL (hsl(0,100%,50%))</option>\n              </select>\n            </div>\n            <div>\n              <label class=\"flex items-center gap-2 cursor-pointer mt-6\">\n                <input\n                  type=\"checkbox\"\n                  name=\"allowAlpha\"\n                  ${config?.allowAlpha ? 'checked' : ''}\n                  class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n                />\n                <span class=\"text-sm text-gray-700 dark:text-gray-300\">Allow transparency (alpha)</span>\n              </label>\n            </div>\n          </div>\n\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Color Presets (comma-separated)\n            </label>\n            <input\n              type=\"text\"\n              name=\"colorPresets\"\n              value=\"${escapeHtml(config?.presets?.join(', ') ?? '')}\"\n              placeholder=\"#ff0000, #00ff00, #0000ff\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        </div>\n      `);\n    }\n\n    // Location field settings\n    if (this.field.type === 'location') {\n      const config = this.field.config as LocationFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Location Settings</h3>\n\n          <div class=\"grid grid-cols-3 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Default Latitude\n              </label>\n              <input\n                type=\"number\"\n                name=\"defaultLat\"\n                value=\"${config?.defaultCenter?.lat ?? ''}\"\n                step=\"any\"\n                placeholder=\"40.7128\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Default Longitude\n              </label>\n              <input\n                type=\"number\"\n                name=\"defaultLng\"\n                value=\"${config?.defaultCenter?.lng ?? ''}\"\n                step=\"any\"\n                placeholder=\"-74.0060\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Default Zoom\n              </label>\n              <input\n                type=\"number\"\n                name=\"defaultZoom\"\n                value=\"${config?.defaultZoom ?? ''}\"\n                min=\"1\"\n                max=\"20\"\n                placeholder=\"12\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"searchEnabled\"\n              ${config?.searchEnabled !== false ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Enable location search</span>\n          </label>\n        </div>\n      `);\n    }\n\n    // DateRange field settings\n    if (this.field.type === 'daterange') {\n      const config = this.field.config as DateRangeFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Date Range Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Min Date\n              </label>\n              <input\n                type=\"date\"\n                name=\"minDate\"\n                value=\"${escapeHtml(config?.minDate ?? '')}\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Max Date\n              </label>\n              <input\n                type=\"date\"\n                name=\"maxDate\"\n                value=\"${escapeHtml(config?.maxDate ?? '')}\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"allowSameDay\"\n              ${config?.allowSameDay !== false ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Allow same start and end date</span>\n          </label>\n        </div>\n      `);\n    }\n\n    // Repeater field settings\n    if (this.field.type === 'repeater') {\n      const config = this.field.config as RepeaterFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Repeater Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Min Items\n              </label>\n              <input\n                type=\"number\"\n                name=\"minItems\"\n                value=\"${config?.minItems ?? ''}\"\n                min=\"0\"\n                placeholder=\"0\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Max Items\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxItems\"\n                value=\"${config?.maxItems ?? ''}\"\n                min=\"1\"\n                placeholder=\"10\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"collapsed\"\n              ${config?.collapsed ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Start collapsed</span>\n          </label>\n\n          <div class=\"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n            <p class=\"text-xs text-gray-500 dark:text-gray-400\">\n              Nested fields can be configured after saving. Edit this field to define repeater sub-fields.\n            </p>\n          </div>\n        </div>\n      `);\n    }\n\n    // Blocks field settings\n    if (this.field.type === 'blocks') {\n      const config = this.field.config as BlocksFieldConfig | undefined;\n      const allowedBlocksJson = config?.allowedBlocks ? JSON.stringify(config.allowedBlocks) : '[]';\n      const deniedBlocksJson = config?.deniedBlocks ? JSON.stringify(config.deniedBlocks) : '[]';\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Blocks Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Min Blocks\n              </label>\n              <input\n                type=\"number\"\n                name=\"minBlocks\"\n                value=\"${config?.minBlocks ?? ''}\"\n                min=\"0\"\n                placeholder=\"0\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Max Blocks\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxBlocks\"\n                value=\"${config?.maxBlocks ?? ''}\"\n                min=\"1\"\n                placeholder=\"No limit\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <div class=\"flex items-center justify-between mb-2\">\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Allowed Blocks\n              </label>\n              <button\n                type=\"button\"\n                data-block-picker-allowed\n                class=\"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              >\n                Select blocks...\n              </button>\n            </div>\n            <div\n              data-allowed-blocks-list\n              class=\"min-h-[48px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/50\"\n            >\n              <div data-allowed-blocks-chips class=\"flex flex-wrap gap-2\">\n                ${\n                  config?.allowedBlocks?.length\n                    ? config.allowedBlocks\n                        .map(\n                          (block) =>\n                            `<span class=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\" data-block-chip=\"${escapeHtml(block)}\">${escapeHtml(block)}<button type=\"button\" data-remove-allowed=\"${escapeHtml(block)}\" class=\"hover:text-blue-900 dark:hover:text-blue-200\">&times;</button></span>`\n                        )\n                        .join('')\n                    : '<span class=\"text-xs text-gray-400 dark:text-gray-500\">All blocks allowed (no restrictions)</span>'\n                }\n              </div>\n            </div>\n            <input type=\"hidden\" name=\"allowedBlocks\" value='${escapeHtml(allowedBlocksJson)}' />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Leave empty to allow all block types</p>\n          </div>\n\n          <div>\n            <div class=\"flex items-center justify-between mb-2\">\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Denied Blocks\n              </label>\n              <button\n                type=\"button\"\n                data-block-picker-denied\n                class=\"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              >\n                Select blocks...\n              </button>\n            </div>\n            <div\n              data-denied-blocks-list\n              class=\"min-h-[48px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/50\"\n            >\n              <div data-denied-blocks-chips class=\"flex flex-wrap gap-2\">\n                ${\n                  config?.deniedBlocks?.length\n                    ? config.deniedBlocks\n                        .map(\n                          (block) =>\n                            `<span class=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\" data-block-chip=\"${escapeHtml(block)}\">${escapeHtml(block)}<button type=\"button\" data-remove-denied=\"${escapeHtml(block)}\" class=\"hover:text-red-900 dark:hover:text-red-200\">&times;</button></span>`\n                        )\n                        .join('')\n                    : '<span class=\"text-xs text-gray-400 dark:text-gray-500\">No blocks denied</span>'\n                }\n              </div>\n            </div>\n            <input type=\"hidden\" name=\"deniedBlocks\" value='${escapeHtml(deniedBlocksJson)}' />\n          </div>\n        </div>\n      `);\n    }\n\n    return sections.join('');\n  }\n\n  private bindEvents(): void {\n    if (!this.container || !this.backdrop) return;\n\n    // Close on backdrop click\n    this.backdrop.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n\n    // Close button\n    this.container.querySelector('[data-field-config-close]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Cancel button\n    this.container.querySelector('[data-field-config-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Save button\n    this.container.querySelector('[data-field-config-save]')?.addEventListener('click', () => {\n      this.handleSave();\n    });\n\n    // Form submit (Enter key)\n    this.container.querySelector('[data-field-config-form-element]')?.addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.handleSave();\n    });\n\n    // Keyboard shortcuts\n    this.container.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n\n    // Auto-generate name from label\n    const nameInput = this.container.querySelector<HTMLInputElement>('input[name=\"name\"]');\n    const labelInput = this.container.querySelector<HTMLInputElement>('input[name=\"label\"]');\n    if (nameInput && labelInput && this.isNewField) {\n      labelInput.addEventListener('input', () => {\n        if (!nameInput.dataset.userModified) {\n          nameInput.value = labelToFieldName(labelInput.value);\n        }\n      });\n      nameInput.addEventListener('input', () => {\n        nameInput.dataset.userModified = 'true';\n      });\n    }\n\n    // Options management\n    this.bindOptionsEvents();\n\n    // Block picker events\n    this.bindBlockPickerEvents();\n  }\n\n  private bindOptionsEvents(): void {\n    if (!this.container) return;\n\n    // Add option\n    this.container.querySelector('[data-add-option]')?.addEventListener('click', () => {\n      const optionsList = this.container?.querySelector('[data-options-list]');\n      if (!optionsList) return;\n\n      const index = optionsList.querySelectorAll('[data-option-row]').length;\n      const row = document.createElement('div');\n      row.className = 'flex items-center gap-2';\n      row.setAttribute('data-option-row', String(index));\n      row.innerHTML = `\n        <input\n          type=\"text\"\n          name=\"option_value_${index}\"\n          placeholder=\"value\"\n          class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        />\n        <input\n          type=\"text\"\n          name=\"option_label_${index}\"\n          placeholder=\"label\"\n          class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        />\n        <button\n          type=\"button\"\n          data-remove-option=\"${index}\"\n          class=\"p-2 text-gray-400 hover:text-red-500\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      `;\n      optionsList.appendChild(row);\n\n      // Bind remove event\n      row.querySelector('[data-remove-option]')?.addEventListener('click', () => {\n        row.remove();\n      });\n\n      // Focus value input\n      row.querySelector<HTMLInputElement>(`input[name=\"option_value_${index}\"]`)?.focus();\n    });\n\n    // Remove option\n    this.container.querySelectorAll('[data-remove-option]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        btn.closest('[data-option-row]')?.remove();\n      });\n    });\n  }\n\n  private bindBlockPickerEvents(): void {\n    if (!this.container || this.field.type !== 'blocks') return;\n\n    // Open allowed blocks picker\n    this.container.querySelector('[data-block-picker-allowed]')?.addEventListener('click', () => {\n      this.showBlockPicker('allowed');\n    });\n\n    // Open denied blocks picker\n    this.container.querySelector('[data-block-picker-denied]')?.addEventListener('click', () => {\n      this.showBlockPicker('denied');\n    });\n\n    // Remove allowed block chip\n    this.container.querySelectorAll('[data-remove-allowed]').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        e.preventDefault();\n        const blockType = btn.getAttribute('data-remove-allowed');\n        if (blockType) this.removeBlockFromList('allowed', blockType);\n      });\n    });\n\n    // Remove denied block chip\n    this.container.querySelectorAll('[data-remove-denied]').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        e.preventDefault();\n        const blockType = btn.getAttribute('data-remove-denied');\n        if (blockType) this.removeBlockFromList('denied', blockType);\n      });\n    });\n  }\n\n  private async showBlockPicker(listType: 'allowed' | 'denied'): Promise<void> {\n    // Get current selections\n    const hiddenInput = this.container?.querySelector<HTMLInputElement>(`input[name=\"${listType}Blocks\"]`);\n    const currentBlocks: string[] = hiddenInput?.value ? JSON.parse(hiddenInput.value) : [];\n\n    // Create picker modal\n    const picker = new BlockPickerModal({\n      apiBasePath: this.config.apiBasePath ?? '/admin',\n      selectedBlocks: currentBlocks,\n      title: listType === 'allowed' ? 'Select Allowed Blocks' : 'Select Denied Blocks',\n      onSelect: (blocks) => {\n        this.updateBlockList(listType, blocks);\n      },\n    });\n    picker.show();\n  }\n\n  private updateBlockList(listType: 'allowed' | 'denied', blocks: string[]): void {\n    const hiddenInput = this.container?.querySelector<HTMLInputElement>(`input[name=\"${listType}Blocks\"]`);\n    const chipsContainer = this.container?.querySelector(`[data-${listType}-blocks-chips]`);\n\n    if (!hiddenInput || !chipsContainer) return;\n\n    // Update hidden input\n    hiddenInput.value = JSON.stringify(blocks);\n\n    // Update chips display\n    if (blocks.length === 0) {\n      const emptyText =\n        listType === 'allowed' ? 'All blocks allowed (no restrictions)' : 'No blocks denied';\n      chipsContainer.innerHTML = `<span class=\"text-xs text-gray-400 dark:text-gray-500\">${emptyText}</span>`;\n    } else {\n      const chipColor = listType === 'allowed' ? 'blue' : 'red';\n      chipsContainer.innerHTML = blocks\n        .map(\n          (block) =>\n            `<span class=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-${chipColor}-100 text-${chipColor}-700 dark:bg-${chipColor}-900/30 dark:text-${chipColor}-400\" data-block-chip=\"${escapeHtml(block)}\">${escapeHtml(block)}<button type=\"button\" data-remove-${listType}=\"${escapeHtml(block)}\" class=\"hover:text-${chipColor}-900 dark:hover:text-${chipColor}-200\">&times;</button></span>`\n        )\n        .join('');\n\n      // Rebind remove events\n      chipsContainer.querySelectorAll(`[data-remove-${listType}]`).forEach((btn) => {\n        btn.addEventListener('click', (e) => {\n          e.preventDefault();\n          const blockType = btn.getAttribute(`data-remove-${listType}`);\n          if (blockType) this.removeBlockFromList(listType, blockType);\n        });\n      });\n    }\n  }\n\n  private removeBlockFromList(listType: 'allowed' | 'denied', blockType: string): void {\n    const hiddenInput = this.container?.querySelector<HTMLInputElement>(`input[name=\"${listType}Blocks\"]`);\n    if (!hiddenInput) return;\n\n    const blocks: string[] = hiddenInput.value ? JSON.parse(hiddenInput.value) : [];\n    const updatedBlocks = blocks.filter((b) => b !== blockType);\n    this.updateBlockList(listType, updatedBlocks);\n  }\n\n  private handleSave(): void {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-field-config-form-element]');\n    if (!form) return;\n\n    const formData = new FormData(form);\n\n    // Validate name\n    const name = (formData.get('name') as string)?.trim();\n    if (!name) {\n      this.showError('name', 'Field name is required');\n      return;\n    }\n    if (!/^[a-z][a-z0-9_]*$/.test(name)) {\n      this.showError('name', 'Invalid field name format');\n      return;\n    }\n\n    // Check for duplicate names\n    const existingNames = this.config.existingFieldNames ?? [];\n    const originalName = this.config.field.name;\n    if (name !== originalName && existingNames.includes(name)) {\n      this.showError('name', 'A field with this name already exists');\n      return;\n    }\n\n    // Validate label\n    const label = (formData.get('label') as string)?.trim();\n    if (!label) {\n      this.showError('label', 'Label is required');\n      return;\n    }\n\n    // Build updated field\n    const updatedField: FieldDefinition = {\n      id: this.field.id || generateFieldId(),\n      name,\n      type: this.field.type,\n      label,\n      description: (formData.get('description') as string)?.trim() || undefined,\n      placeholder: (formData.get('placeholder') as string)?.trim() || undefined,\n      required: formData.get('required') === 'on',\n      readonly: formData.get('readonly') === 'on',\n      hidden: formData.get('hidden') === 'on',\n      section: (formData.get('section') as string)?.trim() || undefined,\n      gridSpan: formData.get('gridSpan') ? parseInt(formData.get('gridSpan') as string, 10) : undefined,\n    };\n\n    // Validation\n    const validation: FieldDefinition['validation'] = {};\n    const minLength = formData.get('minLength');\n    if (minLength !== null && minLength !== '') {\n      validation.minLength = parseInt(minLength as string, 10);\n    }\n    const maxLength = formData.get('maxLength');\n    if (maxLength !== null && maxLength !== '') {\n      validation.maxLength = parseInt(maxLength as string, 10);\n    }\n    const min = formData.get('min');\n    if (min !== null && min !== '') {\n      validation.min = parseFloat(min as string);\n    }\n    const max = formData.get('max');\n    if (max !== null && max !== '') {\n      validation.max = parseFloat(max as string);\n    }\n    const pattern = formData.get('pattern');\n    if (pattern && (pattern as string).trim()) {\n      validation.pattern = (pattern as string).trim();\n    }\n    if (Object.keys(validation).length > 0) {\n      updatedField.validation = validation;\n    }\n\n    // Type-specific config\n    const config = this.buildTypeSpecificConfig(formData);\n    if (config && Object.keys(config).length > 0) {\n      updatedField.config = config;\n    }\n\n    this.config.onSave(updatedField);\n    this.hide();\n  }\n\n  private buildTypeSpecificConfig(formData: FormData): FieldDefinition['config'] | undefined {\n    switch (this.field.type) {\n      case 'select':\n      case 'radio':\n      case 'chips': {\n        const options: SelectOption[] = [];\n        let i = 0;\n        while (formData.has(`option_value_${i}`)) {\n          const value = (formData.get(`option_value_${i}`) as string)?.trim();\n          const label = (formData.get(`option_label_${i}`) as string)?.trim();\n          if (value) {\n            options.push({ value, label: label || value });\n          }\n          i++;\n        }\n        return options.length > 0 ? { options } : undefined;\n      }\n\n      case 'reference':\n      case 'references':\n      case 'user': {\n        const target = (formData.get('target') as string)?.trim();\n        const displayField = (formData.get('displayField') as string)?.trim();\n        if (!target) return undefined;\n        return { target, displayField: displayField || undefined };\n      }\n\n      case 'media-picker':\n      case 'media-gallery':\n      case 'file-upload': {\n        const accept = (formData.get('accept') as string)?.trim();\n        const maxSize = formData.get('maxSize') ? parseInt(formData.get('maxSize') as string, 10) : undefined;\n        const multiple = formData.get('multiple') === 'on';\n        return {\n          accept: accept || undefined,\n          maxSize,\n          multiple: this.field.type === 'media-gallery' ? multiple : undefined,\n        };\n      }\n\n      case 'code': {\n        const language = (formData.get('language') as string)?.trim() || 'json';\n        const lineNumbers = formData.get('lineNumbers') === 'on';\n        return { language, lineNumbers };\n      }\n\n      case 'slug': {\n        const sourceField = (formData.get('sourceField') as string)?.trim();\n        const prefix = (formData.get('slugPrefix') as string)?.trim();\n        const suffix = (formData.get('slugSuffix') as string)?.trim();\n        const separator = (formData.get('slugSeparator') as string)?.trim() || '-';\n        return {\n          sourceField: sourceField || undefined,\n          prefix: prefix || undefined,\n          suffix: suffix || undefined,\n          separator,\n        };\n      }\n\n      case 'color': {\n        const format = (formData.get('colorFormat') as string)?.trim() || 'hex';\n        const allowAlpha = formData.get('allowAlpha') === 'on';\n        const presetsStr = (formData.get('colorPresets') as string)?.trim();\n        const presets = presetsStr\n          ? presetsStr.split(',').map((s) => s.trim()).filter(Boolean)\n          : undefined;\n        return {\n          format: format as 'hex' | 'rgb' | 'hsl',\n          allowAlpha,\n          presets,\n        };\n      }\n\n      case 'location': {\n        const defaultLat = formData.get('defaultLat');\n        const defaultLng = formData.get('defaultLng');\n        const defaultZoom = formData.get('defaultZoom');\n        const searchEnabled = formData.get('searchEnabled') === 'on';\n        const config: LocationFieldConfig = { searchEnabled };\n        if (defaultLat && defaultLng) {\n          config.defaultCenter = {\n            lat: parseFloat(defaultLat as string),\n            lng: parseFloat(defaultLng as string),\n          };\n        }\n        if (defaultZoom) {\n          config.defaultZoom = parseInt(defaultZoom as string, 10);\n        }\n        return config;\n      }\n\n      case 'daterange': {\n        const minDate = (formData.get('minDate') as string)?.trim();\n        const maxDate = (formData.get('maxDate') as string)?.trim();\n        const allowSameDay = formData.get('allowSameDay') === 'on';\n        return {\n          minDate: minDate || undefined,\n          maxDate: maxDate || undefined,\n          allowSameDay,\n        };\n      }\n\n      case 'repeater': {\n        const minItems = formData.get('minItems');\n        const maxItems = formData.get('maxItems');\n        const collapsed = formData.get('collapsed') === 'on';\n        // Preserve existing nested fields\n        const existingConfig = this.field.config as RepeaterFieldConfig | undefined;\n        return {\n          fields: existingConfig?.fields ?? [],\n          minItems: minItems ? parseInt(minItems as string, 10) : undefined,\n          maxItems: maxItems ? parseInt(maxItems as string, 10) : undefined,\n          collapsed,\n        };\n      }\n\n      case 'blocks': {\n        const minBlocks = formData.get('minBlocks');\n        const maxBlocks = formData.get('maxBlocks');\n        const allowedStr = (formData.get('allowedBlocks') as string)?.trim();\n        const deniedStr = (formData.get('deniedBlocks') as string)?.trim();\n\n        // Parse JSON arrays (new format) or fall back to comma-separated (legacy)\n        let allowedBlocks: string[] | undefined;\n        let deniedBlocks: string[] | undefined;\n\n        if (allowedStr) {\n          try {\n            const parsed = JSON.parse(allowedStr);\n            allowedBlocks = Array.isArray(parsed) && parsed.length > 0 ? parsed : undefined;\n          } catch {\n            // Fall back to comma-separated format\n            allowedBlocks = allowedStr.split(',').map((s) => s.trim()).filter(Boolean);\n            if (allowedBlocks.length === 0) allowedBlocks = undefined;\n          }\n        }\n\n        if (deniedStr) {\n          try {\n            const parsed = JSON.parse(deniedStr);\n            deniedBlocks = Array.isArray(parsed) && parsed.length > 0 ? parsed : undefined;\n          } catch {\n            // Fall back to comma-separated format\n            deniedBlocks = deniedStr.split(',').map((s) => s.trim()).filter(Boolean);\n            if (deniedBlocks.length === 0) deniedBlocks = undefined;\n          }\n        }\n\n        return {\n          minBlocks: minBlocks ? parseInt(minBlocks as string, 10) : undefined,\n          maxBlocks: maxBlocks ? parseInt(maxBlocks as string, 10) : undefined,\n          allowedBlocks,\n          deniedBlocks,\n        };\n      }\n\n      default:\n        return undefined;\n    }\n  }\n\n  private showError(fieldName: string, message: string): void {\n    const input = this.container?.querySelector<HTMLInputElement>(`[name=\"${fieldName}\"]`);\n    if (!input) return;\n\n    input.classList.add('border-red-500', 'focus:ring-red-500');\n    input.focus();\n\n    // Remove existing error\n    const existingError = input.parentElement?.querySelector('.field-error');\n    existingError?.remove();\n\n    // Add error message\n    const errorEl = document.createElement('p');\n    errorEl.className = 'field-error text-xs text-red-500 mt-1';\n    errorEl.textContent = message;\n    input.parentElement?.appendChild(errorEl);\n\n    // Clear on input\n    const clearError = () => {\n      input.classList.remove('border-red-500', 'focus:ring-red-500');\n      errorEl.remove();\n      input.removeEventListener('input', clearError);\n    };\n    input.addEventListener('input', clearError);\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction labelToFieldName(label: string): string {\n  return label\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '_')\n    .replace(/^_|_$/g, '')\n    .replace(/^[0-9]/, '_$&');\n}\n\n// =============================================================================\n// Block Picker Modal\n// =============================================================================\n\ninterface BlockPickerModalConfig {\n  apiBasePath: string;\n  selectedBlocks: string[];\n  title: string;\n  onSelect: (blocks: string[]) => void;\n}\n\nclass BlockPickerModal {\n  private config: BlockPickerModalConfig;\n  private api: ContentTypeAPIClient;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private availableBlocks: BlockDefinitionSummary[] = [];\n  private selectedBlocks: Set<string>;\n\n  constructor(config: BlockPickerModalConfig) {\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    this.selectedBlocks = new Set(config.selectedBlocks);\n  }\n\n  async show(): Promise<void> {\n    this.render();\n    this.bindEvents();\n    await this.loadBlocks();\n  }\n\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-[70] flex items-center justify-center bg-black/50 transition-opacity duration-150 opacity-0';\n\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-lg max-h-[70vh] flex flex-col overflow-hidden';\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-semibold text-gray-900 dark:text-white\">${escapeHtml(this.config.title)}</h3>\n        <button type=\"button\" data-picker-close class=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded\">\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto p-4\">\n        <div data-blocks-loading class=\"flex items-center justify-center py-8\">\n          <div class=\"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n        </div>\n        <div data-blocks-list class=\"hidden space-y-2\"></div>\n        <div data-blocks-empty class=\"hidden text-center py-8 text-sm text-gray-500 dark:text-gray-400\">\n          No block definitions available. Create some in the Block Library first.\n        </div>\n      </div>\n\n      <div class=\"flex items-center justify-between px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n        <span class=\"text-xs text-gray-500 dark:text-gray-400\" data-selection-count>0 selected</span>\n        <div class=\"flex gap-2\">\n          <button\n            type=\"button\"\n            data-picker-cancel\n            class=\"px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            data-picker-confirm\n            class=\"px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700\"\n          >\n            Confirm\n          </button>\n        </div>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private bindEvents(): void {\n    if (!this.container || !this.backdrop) return;\n\n    this.backdrop.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) this.hide();\n    });\n\n    this.container.querySelector('[data-picker-close]')?.addEventListener('click', () => this.hide());\n    this.container.querySelector('[data-picker-cancel]')?.addEventListener('click', () => this.hide());\n\n    this.container.querySelector('[data-picker-confirm]')?.addEventListener('click', () => {\n      this.config.onSelect(Array.from(this.selectedBlocks));\n      this.hide();\n    });\n  }\n\n  private async loadBlocks(): Promise<void> {\n    const loadingEl = this.container?.querySelector('[data-blocks-loading]');\n    const listEl = this.container?.querySelector('[data-blocks-list]');\n    const emptyEl = this.container?.querySelector('[data-blocks-empty]');\n\n    try {\n      const blocks = await this.api.listBlockDefinitionsSummary();\n      this.availableBlocks = blocks;\n\n      loadingEl?.classList.add('hidden');\n\n      if (blocks.length === 0) {\n        emptyEl?.classList.remove('hidden');\n      } else {\n        listEl?.classList.remove('hidden');\n        this.renderBlocksList();\n      }\n    } catch {\n      loadingEl?.classList.add('hidden');\n      emptyEl?.classList.remove('hidden');\n      const emptyText = emptyEl?.querySelector('span') || emptyEl;\n      if (emptyText) emptyText.textContent = 'Failed to load block definitions';\n    }\n  }\n\n  private renderBlocksList(): void {\n    const listEl = this.container?.querySelector('[data-blocks-list]');\n    if (!listEl) return;\n\n    listEl.innerHTML = this.availableBlocks\n      .map((block) => {\n        const isSelected = this.selectedBlocks.has(block.type);\n        return `\n          <label class=\"flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${\n            isSelected\n              ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-600'\n              : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n          }\">\n            <input\n              type=\"checkbox\"\n              value=\"${escapeHtml(block.type)}\"\n              ${isSelected ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <div class=\"flex-shrink-0 flex items-center justify-center w-8 h-8 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-sm font-medium\">\n              ${block.icon || block.type.charAt(0).toUpperCase()}\n            </div>\n            <div class=\"flex-1 min-w-0\">\n              <div class=\"text-sm font-medium text-gray-900 dark:text-white\">${escapeHtml(block.name)}</div>\n              <div class=\"text-xs text-gray-500 dark:text-gray-400 font-mono\">${escapeHtml(block.type)}</div>\n            </div>\n            ${block.schema_version ? `<span class=\"text-xs text-gray-400 dark:text-gray-500\">v${escapeHtml(block.schema_version)}</span>` : ''}\n          </label>\n        `;\n      })\n      .join('');\n\n    // Bind checkbox events\n    listEl.querySelectorAll<HTMLInputElement>('input[type=\"checkbox\"]').forEach((checkbox) => {\n      checkbox.addEventListener('change', () => {\n        const blockType = checkbox.value;\n        if (checkbox.checked) {\n          this.selectedBlocks.add(blockType);\n        } else {\n          this.selectedBlocks.delete(blockType);\n        }\n        this.updateSelectionCount();\n        this.renderBlocksList(); // Re-render to update styles\n      });\n    });\n\n    this.updateSelectionCount();\n  }\n\n  private updateSelectionCount(): void {\n    const countEl = this.container?.querySelector('[data-selection-count]');\n    if (countEl) {\n      const count = this.selectedBlocks.size;\n      countEl.textContent = `${count} selected`;\n    }\n  }\n}\n","/**\n * Layout Editor\n *\n * Modal/drawer UI for configuring content type layout with tabs/sections and grid settings.\n */\n\nimport type { UISchemaOverlay, UILayoutConfig, UITab, FieldDefinition } from './types';\n\nexport interface LayoutEditorConfig {\n  layout: UILayoutConfig;\n  fields: FieldDefinition[];\n  onSave: (layout: UILayoutConfig) => void;\n  onCancel: () => void;\n}\n\n// =============================================================================\n// Layout Editor Component\n// =============================================================================\n\nexport class LayoutEditor {\n  private config: LayoutEditorConfig;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private layout: UILayoutConfig;\n  private dragState: { tabId: string; startIndex: number } | null = null;\n\n  constructor(config: LayoutEditorConfig) {\n    this.config = config;\n    this.layout = JSON.parse(JSON.stringify(config.layout ?? { type: 'flat', gridColumns: 12 }));\n    if (!this.layout.tabs) {\n      this.layout.tabs = [];\n    }\n  }\n\n  /**\n   * Show the layout editor modal\n   */\n  show(): void {\n    this.render();\n    this.bindEvents();\n  }\n\n  /**\n   * Hide the layout editor modal\n   */\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    // Create backdrop\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-50 flex items-center justify-center bg-black/50 transition-opacity duration-150';\n    this.backdrop.setAttribute('data-layout-editor-backdrop', 'true');\n\n    // Create modal container\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col overflow-hidden';\n    this.container.setAttribute('data-layout-editor', 'true');\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Layout Settings</h2>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">Configure tabs, sections, and grid layout</p>\n        </div>\n        <button type=\"button\" data-layout-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto px-6 py-4 space-y-6\">\n        ${this.renderLayoutTypeSection()}\n        ${this.renderGridSection()}\n        ${this.renderTabsSection()}\n        ${this.renderFieldAssignment()}\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-layout-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-layout-save\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          Apply Layout\n        </button>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    // Trigger animation\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private renderLayoutTypeSection(): string {\n    return `\n      <div class=\"space-y-4\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Layout Type</h3>\n\n        <div class=\"grid grid-cols-3 gap-3\">\n          <button\n            type=\"button\"\n            data-layout-type=\"flat\"\n            class=\"flex flex-col items-center gap-2 p-4 border rounded-lg transition-colors ${\n              this.layout.type === 'flat' || !this.layout.type\n                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n            }\"\n          >\n            <svg class=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Flat</span>\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">All fields in one view</span>\n          </button>\n\n          <button\n            type=\"button\"\n            data-layout-type=\"tabs\"\n            class=\"flex flex-col items-center gap-2 p-4 border rounded-lg transition-colors ${\n              this.layout.type === 'tabs'\n                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n            }\"\n          >\n            <svg class=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Tabs</span>\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">Organize with tabs</span>\n          </button>\n\n          <button\n            type=\"button\"\n            data-layout-type=\"sections\"\n            class=\"flex flex-col items-center gap-2 p-4 border rounded-lg transition-colors ${\n              this.layout.type === 'sections'\n                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n            }\"\n          >\n            <svg class=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Sections</span>\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">Collapsible sections</span>\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderGridSection(): string {\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Grid Settings</h3>\n\n        <div class=\"flex items-center gap-4\">\n          <div class=\"flex-1\">\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Grid Columns\n            </label>\n            <select\n              data-grid-columns\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"1\" ${this.layout.gridColumns === 1 ? 'selected' : ''}>1 Column</option>\n              <option value=\"2\" ${this.layout.gridColumns === 2 ? 'selected' : ''}>2 Columns</option>\n              <option value=\"3\" ${this.layout.gridColumns === 3 ? 'selected' : ''}>3 Columns</option>\n              <option value=\"4\" ${this.layout.gridColumns === 4 ? 'selected' : ''}>4 Columns</option>\n              <option value=\"6\" ${this.layout.gridColumns === 6 ? 'selected' : ''}>6 Columns</option>\n              <option value=\"12\" ${this.layout.gridColumns === 12 || !this.layout.gridColumns ? 'selected' : ''}>12 Columns (default)</option>\n            </select>\n          </div>\n\n          <div class=\"flex-1\">\n            <div class=\"text-sm text-gray-500 dark:text-gray-400 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n              Fields use <code class=\"text-xs\">gridSpan</code> to control width. Set per-field in field settings.\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTabsSection(): string {\n    if (this.layout.type !== 'tabs' && this.layout.type !== 'sections') {\n      return '';\n    }\n\n    const tabs = this.layout.tabs ?? [];\n    const itemName = this.layout.type === 'tabs' ? 'Tab' : 'Section';\n\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center justify-between\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">${itemName}s</h3>\n          <button\n            type=\"button\"\n            data-add-tab\n            class=\"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n            </svg>\n            Add ${itemName}\n          </button>\n        </div>\n\n        <div data-tabs-list class=\"space-y-2\">\n          ${tabs.length === 0\n            ? `\n            <div class=\"text-sm text-gray-500 dark:text-gray-400 p-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-center\">\n              No ${itemName.toLowerCase()}s defined. Fields without a section will appear in a default \"${itemName.toLowerCase()}\".\n            </div>\n          `\n            : tabs.map((tab, i) => this.renderTabRow(tab, i)).join('')\n          }\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTabRow(tab: UITab, index: number): string {\n    return `\n      <div\n        class=\"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-slate-900\"\n        data-tab-row=\"${tab.id}\"\n        data-tab-index=\"${index}\"\n        draggable=\"true\"\n      >\n        <div class=\"flex-shrink-0 cursor-move text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\" data-tab-drag-handle>\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 8h16M4 16h16\"></path>\n          </svg>\n        </div>\n\n        <div class=\"flex-1 grid grid-cols-3 gap-3\">\n          <input\n            type=\"text\"\n            data-tab-id=\"${tab.id}\"\n            name=\"tab_id_${index}\"\n            value=\"${escapeHtml(tab.id)}\"\n            placeholder=\"section_id\"\n            class=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono\"\n          />\n          <input\n            type=\"text\"\n            name=\"tab_label_${index}\"\n            value=\"${escapeHtml(tab.label)}\"\n            placeholder=\"Tab Label\"\n            class=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n          <input\n            type=\"text\"\n            name=\"tab_icon_${index}\"\n            value=\"${escapeHtml(tab.icon ?? '')}\"\n            placeholder=\"icon-name\"\n            class=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <button\n          type=\"button\"\n          data-remove-tab=\"${tab.id}\"\n          class=\"p-2 text-gray-400 hover:text-red-500\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n    `;\n  }\n\n  private renderFieldAssignment(): string {\n    if (this.layout.type !== 'tabs' && this.layout.type !== 'sections') {\n      return '';\n    }\n\n    const tabs = this.layout.tabs ?? [];\n    const itemName = this.layout.type === 'tabs' ? 'tab' : 'section';\n\n    // Group fields by section\n    const fieldsBySection = new Map<string, FieldDefinition[]>();\n    fieldsBySection.set('', []); // Unassigned\n\n    for (const tab of tabs) {\n      fieldsBySection.set(tab.id, []);\n    }\n\n    for (const field of this.config.fields) {\n      const section = field.section ?? '';\n      if (!fieldsBySection.has(section)) {\n        fieldsBySection.set(section, []);\n      }\n      fieldsBySection.get(section)!.push(field);\n    }\n\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Field Assignment</h3>\n        <p class=\"text-sm text-gray-500 dark:text-gray-400\">\n          Fields are assigned to ${itemName}s via the \"Section/Tab\" setting in each field's configuration.\n        </p>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          ${Array.from(fieldsBySection.entries())\n            .map(\n              ([section, fields]) => `\n            <div class=\"p-3 border border-gray-200 dark:border-gray-700 rounded-lg\">\n              <div class=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                ${section || '(Unassigned)'}\n              </div>\n              <div class=\"space-y-1\">\n                ${fields.length === 0\n                  ? '<div class=\"text-xs text-gray-400\">No fields</div>'\n                  : fields.map((f) => `<div class=\"text-xs text-gray-500 dark:text-gray-400 truncate\">${escapeHtml(f.label)} <span class=\"font-mono\">(${escapeHtml(f.name)})</span></div>`).join('')\n                }\n              </div>\n            </div>\n          `\n            )\n            .join('')}\n        </div>\n      </div>\n    `;\n  }\n\n  private bindEvents(): void {\n    if (!this.container || !this.backdrop) return;\n\n    // Close on backdrop click\n    this.backdrop.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n\n    // Close button\n    this.container.querySelector('[data-layout-close]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Cancel button\n    this.container.querySelector('[data-layout-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Save button\n    this.container.querySelector('[data-layout-save]')?.addEventListener('click', () => {\n      this.handleSave();\n    });\n\n    // Layout type selection\n    this.container.querySelectorAll('[data-layout-type]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const type = btn.getAttribute('data-layout-type') as 'flat' | 'tabs' | 'sections';\n        this.layout.type = type;\n        this.updateView();\n      });\n    });\n\n    // Grid columns\n    this.container.querySelector('[data-grid-columns]')?.addEventListener('change', (e) => {\n      const value = (e.target as HTMLSelectElement).value;\n      this.layout.gridColumns = parseInt(value, 10);\n    });\n\n    // Add tab\n    this.container.querySelector('[data-add-tab]')?.addEventListener('click', () => {\n      this.addTab();\n    });\n\n    // Bind tab events\n    this.bindTabEvents();\n\n    // Keyboard shortcuts\n    this.container.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n  }\n\n  private bindTabEvents(): void {\n    if (!this.container) return;\n\n    // Remove tab\n    this.container.querySelectorAll('[data-remove-tab]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const tabId = btn.getAttribute('data-remove-tab');\n        if (tabId) this.removeTab(tabId);\n      });\n    });\n\n    // Tab ID changes\n    this.container.querySelectorAll('input[name^=\"tab_id_\"]').forEach((input) => {\n      input.addEventListener('input', () => {\n        this.updateTabsFromForm();\n      });\n    });\n\n    // Tab drag and drop\n    const tabsList = this.container.querySelector('[data-tabs-list]');\n    if (tabsList) {\n      tabsList.addEventListener('dragstart', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        const row = target.closest<HTMLElement>('[data-tab-row]');\n        if (!row) return;\n\n        this.dragState = {\n          tabId: row.getAttribute('data-tab-row') ?? '',\n          startIndex: parseInt(row.getAttribute('data-tab-index') ?? '0', 10),\n        };\n        row.classList.add('opacity-50');\n      });\n\n      tabsList.addEventListener('dragover', (e) => {\n        e.preventDefault();\n      });\n\n      tabsList.addEventListener('drop', (e) => {\n        e.preventDefault();\n        if (!this.dragState) return;\n\n        const target = (e as DragEvent).target as HTMLElement;\n        const row = target.closest<HTMLElement>('[data-tab-row]');\n        if (!row) return;\n\n        const targetIndex = parseInt(row.getAttribute('data-tab-index') ?? '0', 10);\n        this.moveTab(this.dragState.tabId, targetIndex);\n        this.dragState = null;\n      });\n\n      tabsList.addEventListener('dragend', () => {\n        tabsList.querySelectorAll('.opacity-50').forEach((el) => el.classList.remove('opacity-50'));\n        this.dragState = null;\n      });\n    }\n  }\n\n  private addTab(): void {\n    const newId = `section_${(this.layout.tabs?.length ?? 0) + 1}`;\n    const newTab: UITab = {\n      id: newId,\n      label: `Section ${(this.layout.tabs?.length ?? 0) + 1}`,\n      order: this.layout.tabs?.length ?? 0,\n    };\n\n    if (!this.layout.tabs) {\n      this.layout.tabs = [];\n    }\n    this.layout.tabs.push(newTab);\n    this.updateView();\n  }\n\n  private removeTab(tabId: string): void {\n    if (!this.layout.tabs) return;\n    this.layout.tabs = this.layout.tabs.filter((t) => t.id !== tabId);\n    this.updateView();\n  }\n\n  private moveTab(tabId: string, newIndex: number): void {\n    if (!this.layout.tabs) return;\n\n    const currentIndex = this.layout.tabs.findIndex((t) => t.id === tabId);\n    if (currentIndex === -1 || currentIndex === newIndex) return;\n\n    const tab = this.layout.tabs.splice(currentIndex, 1)[0];\n    this.layout.tabs.splice(newIndex, 0, tab);\n\n    // Update order values\n    this.layout.tabs.forEach((t, i) => {\n      t.order = i;\n    });\n\n    this.updateView();\n  }\n\n  private updateTabsFromForm(): void {\n    if (!this.container || !this.layout.tabs) return;\n\n    this.layout.tabs.forEach((tab, i) => {\n      const idInput = this.container!.querySelector<HTMLInputElement>(`input[name=\"tab_id_${i}\"]`);\n      const labelInput = this.container!.querySelector<HTMLInputElement>(`input[name=\"tab_label_${i}\"]`);\n      const iconInput = this.container!.querySelector<HTMLInputElement>(`input[name=\"tab_icon_${i}\"]`);\n\n      if (idInput) tab.id = idInput.value.trim();\n      if (labelInput) tab.label = labelInput.value.trim();\n      if (iconInput) tab.icon = iconInput.value.trim() || undefined;\n    });\n  }\n\n  private updateView(): void {\n    if (!this.container) return;\n\n    // Re-render the whole container content (but not the header/footer)\n    const content = this.container.querySelector('.overflow-y-auto');\n    if (content) {\n      content.innerHTML = `\n        ${this.renderLayoutTypeSection()}\n        ${this.renderGridSection()}\n        ${this.renderTabsSection()}\n        ${this.renderFieldAssignment()}\n      `;\n\n      // Re-bind events\n      this.container.querySelectorAll('[data-layout-type]').forEach((btn) => {\n        btn.addEventListener('click', () => {\n          const type = btn.getAttribute('data-layout-type') as 'flat' | 'tabs' | 'sections';\n          this.layout.type = type;\n          this.updateView();\n        });\n      });\n\n      this.container.querySelector('[data-grid-columns]')?.addEventListener('change', (e) => {\n        const value = (e.target as HTMLSelectElement).value;\n        this.layout.gridColumns = parseInt(value, 10);\n      });\n\n      this.container.querySelector('[data-add-tab]')?.addEventListener('click', () => {\n        this.addTab();\n      });\n\n      this.bindTabEvents();\n    }\n  }\n\n  private handleSave(): void {\n    // Update tabs from form inputs\n    this.updateTabsFromForm();\n\n    // Validate tabs have unique IDs\n    if (this.layout.tabs && this.layout.tabs.length > 0) {\n      const ids = new Set<string>();\n      for (const tab of this.layout.tabs) {\n        if (!tab.id.trim()) {\n          alert('All tabs must have an ID');\n          return;\n        }\n        if (ids.has(tab.id)) {\n          alert(`Duplicate tab ID: ${tab.id}`);\n          return;\n        }\n        ids.add(tab.id);\n      }\n    }\n\n    this.config.onSave(this.layout);\n    this.hide();\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n","/**\n * Content Type Editor\n *\n * Main editor component for creating/editing content types.\n * Includes field list with drag-and-drop ordering, quick edit cards,\n * and schema preview integration.\n */\n\nimport type {\n  ContentType,\n  ContentTypeEditorConfig,\n  FieldDefinition,\n  FieldType,\n  JSONSchema,\n  UISchemaOverlay,\n  UILayoutConfig,\n  UIOverride,\n  ContentTypeBuilderState,\n  SchemaValidationError,\n  ContentTypeCapabilities,\n  ContentTypeStatus,\n  ContentTypeSchemaVersion,\n  CompatibilityCheckResult,\n  SchemaChange,\n} from './types';\nimport { ContentTypeAPIClient, fieldsToSchema, schemaToFields, generateFieldId } from './api-client';\nimport { FieldTypePicker, getFieldTypeMetadata, FIELD_TYPES } from './field-type-picker';\nimport { FieldConfigForm } from './field-config-form';\nimport { LayoutEditor } from './layout-editor';\n\n// =============================================================================\n// Content Type Editor Component\n// =============================================================================\n\n// Extended state with layout\ninterface ExtendedBuilderState extends ContentTypeBuilderState {\n  layout: UILayoutConfig;\n}\n\nexport class ContentTypeEditor {\n  private config: ContentTypeEditorConfig;\n  private container: HTMLElement;\n  private api: ContentTypeAPIClient;\n  private state: ExtendedBuilderState;\n  private dragState: DragState | null = null;\n\n  constructor(container: HTMLElement, config: ContentTypeEditorConfig) {\n    this.container = container;\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    this.state = {\n      contentType: null,\n      fields: [],\n      isDirty: false,\n      isLoading: false,\n      isSaving: false,\n      isPreviewing: false,\n      validationErrors: [],\n      selectedFieldId: null,\n      previewHtml: null,\n      layout: { type: 'flat', gridColumns: 12, tabs: [] },\n    };\n  }\n\n  /**\n   * Initialize the editor\n   */\n  async init(): Promise<void> {\n    this.render();\n    this.bindEvents();\n\n    // Load existing content type if editing\n    if (this.config.contentTypeId) {\n      await this.loadContentType(this.config.contentTypeId);\n    }\n  }\n\n  /**\n   * Load a content type for editing\n   */\n  async loadContentType(idOrSlug: string): Promise<void> {\n    this.state.isLoading = true;\n    this.updateLoadingState();\n\n    try {\n      const contentType = await this.api.get(idOrSlug);\n      this.state.contentType = contentType;\n      this.state.fields = schemaToFields(contentType.schema);\n      // Load layout from ui_schema\n      if (contentType.ui_schema?.layout) {\n        this.state.layout = {\n          type: contentType.ui_schema.layout.type ?? 'flat',\n          tabs: contentType.ui_schema.layout.tabs ?? [],\n          gridColumns: contentType.ui_schema.layout.gridColumns ?? 12,\n        };\n      }\n      this.state.isDirty = false;\n      this.render();\n    } catch (error) {\n      console.error('Failed to load content type:', error);\n      this.showToast('Failed to load content type', 'error');\n    } finally {\n      this.state.isLoading = false;\n      this.updateLoadingState();\n    }\n  }\n\n  /**\n   * Save the content type\n   */\n  async save(): Promise<void> {\n    if (this.state.isSaving) return;\n\n    // Validate required fields\n    const nameInput = this.container.querySelector<HTMLInputElement>('[data-ct-name]');\n    const name = nameInput?.value?.trim();\n    if (!name) {\n      this.showToast('Name is required', 'error');\n      nameInput?.focus();\n      return;\n    }\n\n    // Build content type data\n    const schema = fieldsToSchema(this.state.fields, this.getSlug());\n    const contentType: Partial<ContentType> = {\n      name,\n      slug: this.getSlug(),\n      description: this.getDescription(),\n      icon: this.getIcon(),\n      schema,\n      ui_schema: this.buildUISchema(),\n      capabilities: this.getCapabilities(),\n    };\n\n    this.state.isSaving = true;\n    this.updateSavingState();\n\n    try {\n      let saved: ContentType;\n      if (this.state.contentType?.id) {\n        saved = await this.api.update(this.state.contentType.id, contentType);\n      } else {\n        saved = await this.api.create(contentType);\n      }\n\n      this.state.contentType = saved;\n      this.state.isDirty = false;\n      this.showToast('Content type saved successfully', 'success');\n      this.config.onSave?.(saved);\n    } catch (error) {\n      console.error('Failed to save content type:', error);\n      const message = error instanceof Error ? error.message : 'Failed to save content type';\n      this.showToast(message, 'error');\n    } finally {\n      this.state.isSaving = false;\n      this.updateSavingState();\n    }\n  }\n\n  /**\n   * Add a new field\n   */\n  addField(type: FieldType): void {\n    const metadata = getFieldTypeMetadata(type);\n    const field: FieldDefinition = {\n      id: generateFieldId(),\n      name: `new_${type}_${this.state.fields.length + 1}`,\n      type,\n      label: metadata?.label ?? type,\n      required: false,\n      order: this.state.fields.length,\n      ...(metadata?.defaultConfig ?? {}),\n    };\n\n    // Open config form for the new field\n    const configForm = new FieldConfigForm({\n      field,\n      existingFieldNames: this.state.fields.map((f) => f.name),\n      onSave: (updatedField) => {\n        this.state.fields.push(updatedField);\n        this.state.isDirty = true;\n        this.renderFieldList();\n        this.updateDirtyState();\n      },\n      onCancel: () => {},\n    });\n    configForm.show();\n  }\n\n  /**\n   * Edit an existing field\n   */\n  editField(fieldId: string): void {\n    const field = this.state.fields.find((f) => f.id === fieldId);\n    if (!field) return;\n\n    const configForm = new FieldConfigForm({\n      field,\n      existingFieldNames: this.state.fields.filter((f) => f.id !== fieldId).map((f) => f.name),\n      onSave: (updatedField) => {\n        const index = this.state.fields.findIndex((f) => f.id === fieldId);\n        if (index !== -1) {\n          this.state.fields[index] = updatedField;\n          this.state.isDirty = true;\n          this.renderFieldList();\n          this.updateDirtyState();\n        }\n      },\n      onCancel: () => {},\n    });\n    configForm.show();\n  }\n\n  /**\n   * Remove a field\n   */\n  removeField(fieldId: string): void {\n    const index = this.state.fields.findIndex((f) => f.id === fieldId);\n    if (index === -1) return;\n\n    const field = this.state.fields[index];\n    if (!confirm(`Remove field \"${field.label}\"?`)) return;\n\n    this.state.fields.splice(index, 1);\n    this.state.isDirty = true;\n    this.renderFieldList();\n    this.updateDirtyState();\n  }\n\n  /**\n   * Move a field to a new position\n   */\n  moveField(fieldId: string, newIndex: number): void {\n    const currentIndex = this.state.fields.findIndex((f) => f.id === fieldId);\n    if (currentIndex === -1 || currentIndex === newIndex) return;\n\n    const field = this.state.fields.splice(currentIndex, 1)[0];\n    this.state.fields.splice(newIndex, 0, field);\n\n    // Update order values\n    this.state.fields.forEach((f, i) => {\n      f.order = i;\n    });\n\n    this.state.isDirty = true;\n    this.renderFieldList();\n    this.updateDirtyState();\n  }\n\n  /**\n   * Validate the schema\n   */\n  async validateSchema(): Promise<void> {\n    const schema = fieldsToSchema(this.state.fields, this.getSlug());\n\n    try {\n      const result = await this.api.validateSchema({\n        schema,\n        slug: this.getSlug(),\n        ui_schema: this.buildUISchema(),\n      });\n\n      if (result.valid) {\n        this.state.validationErrors = [];\n        this.showToast('Schema is valid', 'success');\n      } else {\n        this.state.validationErrors = result.errors ?? [];\n        this.showToast('Schema has validation errors', 'error');\n      }\n    } catch (error) {\n      console.error('Validation failed:', error);\n      const message = error instanceof Error ? error.message : 'Validation failed';\n      this.showToast(message, 'error');\n    }\n\n    this.renderValidationErrors();\n  }\n\n  /**\n   * Preview the schema as a rendered form\n   */\n  async previewSchema(): Promise<void> {\n    if (this.state.isPreviewing) return;\n\n    const schema = fieldsToSchema(this.state.fields, this.getSlug());\n\n    this.state.isPreviewing = true;\n    this.updatePreviewState();\n\n    try {\n      const result = await this.api.previewSchema({\n        schema,\n        slug: this.getSlug(),\n        ui_schema: this.buildUISchema(),\n      });\n\n      this.state.previewHtml = result.html;\n      this.renderPreview();\n    } catch (error) {\n      console.error('Preview failed:', error);\n      const message = error instanceof Error ? error.message : 'Preview failed';\n      this.showToast(message, 'error');\n    } finally {\n      this.state.isPreviewing = false;\n      this.updatePreviewState();\n    }\n  }\n\n  // ===========================================================================\n  // Rendering\n  // ===========================================================================\n\n  private render(): void {\n    const ct = this.state.contentType;\n    const statusBadge = this.getStatusBadge(ct?.status);\n\n    this.container.innerHTML = `\n      <div class=\"content-type-editor flex flex-col h-full\" data-content-type-editor>\n        <!-- Header -->\n        <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900\">\n          <div>\n            <div class=\"flex items-center gap-3\">\n              <h1 class=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                ${ct ? 'Edit Content Type' : 'Create Content Type'}\n              </h1>\n              ${ct ? statusBadge : ''}\n              ${ct?.schema_version ? `<span class=\"text-xs text-gray-400 dark:text-gray-500\">v${escapeHtml(ct.schema_version)}</span>` : ''}\n            </div>\n            <p class=\"text-sm text-gray-500 dark:text-gray-400 mt-0.5\">\n              ${ct ? `Editing: ${ct.name}` : 'Define fields and configure your content type'}\n            </p>\n          </div>\n          <div class=\"flex items-center gap-3\">\n            ${this.state.validationErrors.length > 0 ? `\n              <span class=\"flex items-center gap-1 text-sm text-red-600 dark:text-red-400\">\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                </svg>\n                ${this.state.validationErrors.length} error${this.state.validationErrors.length > 1 ? 's' : ''}\n              </span>\n            ` : ''}\n\n            <!-- Lifecycle Actions (only for existing content types) -->\n            ${ct ? this.renderLifecycleActions(ct) : ''}\n\n            <button\n              type=\"button\"\n              data-ct-validate\n              class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              Validate\n            </button>\n            <button\n              type=\"button\"\n              data-ct-preview\n              class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              Preview\n            </button>\n            <button\n              type=\"button\"\n              data-ct-cancel\n              class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"button\"\n              data-ct-save\n              class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              ${ct ? 'Save Changes' : 'Create Content Type'}\n            </button>\n          </div>\n        </div>\n\n        <!-- Main Content -->\n        <div class=\"flex-1 flex overflow-hidden\">\n          <!-- Left Panel: Basic Info + Fields -->\n          <div class=\"flex-1 overflow-y-auto p-6 space-y-6\">\n            ${this.renderBasicInfo()}\n            ${this.renderFieldsSection()}\n            ${this.renderCapabilitiesSection()}\n          </div>\n\n          <!-- Right Panel: Preview -->\n          <div class=\"w-[400px] border-l border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-950 overflow-y-auto\">\n            ${this.renderPreviewPanel()}\n          </div>\n        </div>\n\n        <!-- Validation Errors -->\n        <div data-ct-validation-errors class=\"hidden\"></div>\n      </div>\n    `;\n  }\n\n  private renderBasicInfo(): string {\n    const ct = this.state.contentType;\n\n    return `\n      <div class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\n        <h2 class=\"text-sm font-medium text-gray-900 dark:text-white mb-4\">Basic Information</h2>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Name <span class=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              data-ct-name\n              value=\"${escapeHtml(ct?.name ?? '')}\"\n              placeholder=\"Blog Post\"\n              required\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Slug\n            </label>\n            <input\n              type=\"text\"\n              data-ct-slug\n              value=\"${escapeHtml(ct?.slug ?? '')}\"\n              placeholder=\"blog-post\"\n              pattern=\"^[a-z][a-z0-9_-]*$\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Auto-generated from name if empty</p>\n          </div>\n        </div>\n\n        <div class=\"mt-4\">\n          <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            Description\n          </label>\n          <textarea\n            data-ct-description\n            rows=\"2\"\n            placeholder=\"Describe this content type\"\n            class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none\"\n          >${escapeHtml(ct?.description ?? '')}</textarea>\n        </div>\n\n        <div class=\"mt-4\">\n          <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            Icon\n          </label>\n          <input\n            type=\"text\"\n            data-ct-icon\n            value=\"${escapeHtml(ct?.icon ?? '')}\"\n            placeholder=\"file-text\"\n            class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n      </div>\n    `;\n  }\n\n  private renderFieldsSection(): string {\n    const layoutType = this.state.layout.type ?? 'flat';\n    const layoutLabel = layoutType === 'tabs' ? 'Tabs' : layoutType === 'sections' ? 'Sections' : 'Flat';\n\n    return `\n      <div class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n          <div class=\"flex items-center gap-4\">\n            <h2 class=\"text-sm font-medium text-gray-900 dark:text-white\">\n              Fields (${this.state.fields.length})\n            </h2>\n            <button\n              type=\"button\"\n              data-ct-layout\n              class=\"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 rounded hover:bg-gray-200 dark:hover:bg-gray-700\"\n            >\n              <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6z\"></path>\n              </svg>\n              Layout: ${layoutLabel}\n            </button>\n          </div>\n          <button\n            type=\"button\"\n            data-ct-add-field\n            class=\"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n            </svg>\n            Add Field\n          </button>\n        </div>\n\n        <div data-ct-field-list class=\"p-4\">\n          ${this.renderFieldListHTML()}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderFieldListHTML(): string {\n    return this.renderFieldListContent();\n  }\n\n  private renderFieldCard(field: FieldDefinition, index: number): string {\n    const metadata = getFieldTypeMetadata(field.type);\n    const isSelected = this.state.selectedFieldId === field.id;\n\n    // Check for validation errors for this field\n    const fieldErrors = this.state.validationErrors.filter(\n      (err) => err.path.includes(`/${field.name}`) || err.path.includes(`properties.${field.name}`)\n    );\n    const hasErrors = fieldErrors.length > 0;\n\n    // Build constraints summary\n    const constraints: string[] = [];\n    if (field.validation?.minLength) constraints.push(`min: ${field.validation.minLength}`);\n    if (field.validation?.maxLength) constraints.push(`max: ${field.validation.maxLength}`);\n    if (field.validation?.min !== undefined) constraints.push(`>= ${field.validation.min}`);\n    if (field.validation?.max !== undefined) constraints.push(`<= ${field.validation.max}`);\n    if (field.validation?.pattern) constraints.push('pattern');\n\n    return `\n      <div\n        class=\"field-card flex items-center gap-3 p-3 border rounded-lg transition-colors ${\n          hasErrors\n            ? 'border-red-400 bg-red-50 dark:bg-red-900/10'\n            : isSelected\n            ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n            : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900 hover:border-gray-300 dark:hover:border-gray-600'\n        }\"\n        data-field-card=\"${field.id}\"\n        data-field-index=\"${index}\"\n        draggable=\"true\"\n      >\n        <!-- Drag Handle -->\n        <div\n          class=\"flex-shrink-0 cursor-move text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n          data-field-drag-handle\n        >\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 8h16M4 16h16\"></path>\n          </svg>\n        </div>\n\n        <!-- Field Type Icon -->\n        <div class=\"flex-shrink-0 flex items-center justify-center w-8 h-8 rounded-lg ${\n          hasErrors ? 'bg-red-100 dark:bg-red-900/30 text-red-600' : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300'\n        } text-sm font-medium\">\n          ${hasErrors ? '!' : (metadata?.icon ?? '?')}\n        </div>\n\n        <!-- Field Info -->\n        <div class=\"flex-1 min-w-0\">\n          <div class=\"flex items-center gap-2\">\n            <span class=\"font-medium text-gray-900 dark:text-white truncate\">${escapeHtml(field.label)}</span>\n            ${field.required ? '<span class=\"text-xs text-red-500\">Required</span>' : ''}\n            ${field.readonly ? '<span class=\"text-xs text-gray-400\">Read-only</span>' : ''}\n            ${field.hidden ? '<span class=\"text-xs text-gray-400\">Hidden</span>' : ''}\n          </div>\n          <div class=\"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400\">\n            <span class=\"font-mono\">${escapeHtml(field.name)}</span>\n            <span>â€¢</span>\n            <span>${metadata?.label ?? field.type}</span>\n            ${field.section ? `<span>â€¢ ${escapeHtml(field.section)}</span>` : ''}\n            ${field.gridSpan ? `<span>â€¢ ${field.gridSpan} cols</span>` : ''}\n          </div>\n          ${constraints.length > 0 ? `\n            <div class=\"flex items-center gap-1 mt-1\">\n              ${constraints.map(c => `<span class=\"text-xs px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-gray-500 dark:text-gray-400\">${escapeHtml(c)}</span>`).join('')}\n            </div>\n          ` : ''}\n          ${hasErrors ? `\n            <div class=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n              ${fieldErrors.map(err => escapeHtml(err.message)).join(', ')}\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- Quick Actions -->\n        <div class=\"flex items-center gap-1\">\n          <button\n            type=\"button\"\n            data-field-edit=\"${field.id}\"\n            class=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded hover:bg-gray-100 dark:hover:bg-gray-800\"\n            title=\"Edit field\"\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n            </svg>\n          </button>\n          <button\n            type=\"button\"\n            data-field-remove=\"${field.id}\"\n            class=\"p-1.5 text-gray-400 hover:text-red-500 rounded hover:bg-gray-100 dark:hover:bg-gray-800\"\n            title=\"Remove field\"\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\n            </svg>\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderCapabilitiesSection(): string {\n    const caps = this.state.contentType?.capabilities ?? {};\n\n    return `\n      <div class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\n        <h2 class=\"text-sm font-medium text-gray-900 dark:text-white mb-4\">Capabilities</h2>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"versioning\"\n              ${caps.versioning ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Versioning</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"scheduling\"\n              ${caps.scheduling ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Scheduling</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"seo\"\n              ${caps.seo ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">SEO Fields</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"localization\"\n              ${caps.localization ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Localization</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"blocks\"\n              ${caps.blocks ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Block Editor</span>\n          </label>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderPreviewPanel(): string {\n    return `\n      <div class=\"p-4\">\n        <div class=\"flex items-center justify-between mb-4\">\n          <h2 class=\"text-sm font-medium text-gray-900 dark:text-white\">Form Preview</h2>\n          <button\n            type=\"button\"\n            data-ct-refresh-preview\n            class=\"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n          >\n            Refresh\n          </button>\n        </div>\n\n        <div\n          data-ct-preview-container\n          class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4 min-h-[200px]\"\n        >\n          ${\n            this.state.previewHtml\n              ? this.state.previewHtml\n              : `\n            <div class=\"flex flex-col items-center justify-center h-40 text-gray-400\">\n              <svg class=\"w-10 h-10 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\n              </svg>\n              <p class=\"text-sm\">Click \"Preview\" to see the generated form</p>\n            </div>\n          `\n          }\n        </div>\n      </div>\n    `;\n  }\n\n  // ===========================================================================\n  // Status Badges & Lifecycle Actions\n  // ===========================================================================\n\n  private getStatusBadge(status?: ContentTypeStatus): string {\n    switch (status) {\n      case 'draft':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\">Draft</span>';\n      case 'deprecated':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Deprecated</span>';\n      case 'active':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\">Active</span>';\n      default:\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400\">Unknown</span>';\n    }\n  }\n\n  private renderLifecycleActions(ct: ContentType): string {\n    return `\n      <div class=\"relative\" data-ct-lifecycle-menu>\n        <button\n          type=\"button\"\n          data-ct-lifecycle-trigger\n          class=\"flex items-center gap-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z\"></path>\n          </svg>\n          Actions\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n          </svg>\n        </button>\n        <div\n          data-ct-lifecycle-dropdown\n          class=\"hidden absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50\"\n        >\n          <div class=\"py-1\">\n            ${ct.status === 'draft' ? `\n              <button\n                type=\"button\"\n                data-ct-publish\n                class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-green-700 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                </svg>\n                Publish\n              </button>\n            ` : ct.status === 'active' ? `\n              <button\n                type=\"button\"\n                data-ct-deprecate\n                class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-yellow-700 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n                </svg>\n                Deprecate\n              </button>\n            ` : ''}\n            <button\n              type=\"button\"\n              data-ct-clone\n              class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\n              </svg>\n              Clone\n            </button>\n            <div class=\"border-t border-gray-200 dark:border-gray-700 my-1\"></div>\n            <button\n              type=\"button\"\n              data-ct-versions\n              class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n              Version History\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  // ===========================================================================\n  // Lifecycle Actions\n  // ===========================================================================\n\n  /**\n   * Publish the content type\n   */\n  async publishContentType(): Promise<void> {\n    if (!this.state.contentType?.id) return;\n\n    // First check compatibility\n    const schema = fieldsToSchema(this.state.fields, this.getSlug());\n    let compatResult: CompatibilityCheckResult | null = null;\n\n    try {\n      compatResult = await this.api.checkCompatibility(\n        this.state.contentType.id,\n        schema,\n        this.buildUISchema()\n      );\n    } catch {\n      // Compatibility check endpoint might not be available; proceed with warning\n    }\n\n    // Show confirmation modal\n    const modal = new PublishConfirmationModal({\n      contentType: this.state.contentType,\n      compatibilityResult: compatResult,\n      onConfirm: async (force: boolean) => {\n        try {\n          const published = await this.api.publish(this.state.contentType!.id, force);\n          this.state.contentType = published;\n          this.state.isDirty = false;\n          this.render();\n          this.bindEvents();\n          this.showToast('Content type published successfully', 'success');\n          this.config.onSave?.(published);\n        } catch (error) {\n          const message = error instanceof Error ? error.message : 'Failed to publish content type';\n          this.showToast(message, 'error');\n        }\n      },\n      onCancel: () => {},\n    });\n    modal.show();\n  }\n\n  /**\n   * Deprecate the content type\n   */\n  async deprecateContentType(): Promise<void> {\n    if (!this.state.contentType?.id) return;\n\n    if (!confirm(`Are you sure you want to deprecate \"${this.state.contentType.name}\"?\\n\\nDeprecated content types can still be used but are hidden from new content creation.`)) {\n      return;\n    }\n\n    try {\n      const deprecated = await this.api.deprecate(this.state.contentType.id);\n      this.state.contentType = deprecated;\n      this.render();\n      this.bindEvents();\n      this.showToast('Content type deprecated successfully', 'success');\n      this.config.onSave?.(deprecated);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Failed to deprecate content type';\n      this.showToast(message, 'error');\n    }\n  }\n\n  /**\n   * Clone the content type\n   */\n  async cloneContentType(): Promise<void> {\n    if (!this.state.contentType?.id) return;\n\n    const modal = new CloneContentTypeModal({\n      contentType: this.state.contentType,\n      onConfirm: async (newSlug: string, newName?: string) => {\n        try {\n          const cloned = await this.api.clone(this.state.contentType!.id, newSlug, newName);\n          this.showToast(`Content type cloned as \"${cloned.name}\"`, 'success');\n          // Optionally navigate to the cloned content type\n          if (this.config.onSave) {\n            this.config.onSave(cloned);\n          }\n        } catch (error) {\n          const message = error instanceof Error ? error.message : 'Failed to clone content type';\n          this.showToast(message, 'error');\n        }\n      },\n      onCancel: () => {},\n    });\n    modal.show();\n  }\n\n  /**\n   * Show version history\n   */\n  showVersionHistory(): void {\n    if (!this.state.contentType?.id) return;\n\n    const viewer = new ContentTypeVersionHistoryViewer({\n      apiBasePath: this.config.apiBasePath,\n      contentType: this.state.contentType,\n    });\n    viewer.show();\n  }\n\n  // ===========================================================================\n  // Event Binding\n  // ===========================================================================\n\n  private bindEvents(): void {\n    // Header actions\n    this.container.querySelector('[data-ct-save]')?.addEventListener('click', () => this.save());\n    this.container.querySelector('[data-ct-validate]')?.addEventListener('click', () => this.validateSchema());\n    this.container.querySelector('[data-ct-preview]')?.addEventListener('click', () => this.previewSchema());\n    this.container.querySelector('[data-ct-cancel]')?.addEventListener('click', () => this.config.onCancel?.());\n\n    // Lifecycle actions dropdown\n    this.bindLifecycleMenuEvents();\n\n    // Add field buttons\n    this.container.querySelector('[data-ct-add-field]')?.addEventListener('click', () => this.showFieldTypePicker());\n    this.container.querySelector('[data-ct-add-field-empty]')?.addEventListener('click', () =>\n      this.showFieldTypePicker()\n    );\n\n    // Layout button\n    this.container.querySelector('[data-ct-layout]')?.addEventListener('click', () => this.showLayoutEditor());\n\n    // Preview refresh\n    this.container.querySelector('[data-ct-refresh-preview]')?.addEventListener('click', () => this.previewSchema());\n\n    // Field actions (delegated)\n    this.container.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n\n      // Edit field\n      const editBtn = target.closest('[data-field-edit]');\n      if (editBtn) {\n        const fieldId = editBtn.getAttribute('data-field-edit');\n        if (fieldId) this.editField(fieldId);\n        return;\n      }\n\n      // Remove field\n      const removeBtn = target.closest('[data-field-remove]');\n      if (removeBtn) {\n        const fieldId = removeBtn.getAttribute('data-field-remove');\n        if (fieldId) this.removeField(fieldId);\n        return;\n      }\n\n      // Select field card\n      const fieldCard = target.closest('[data-field-card]');\n      if (fieldCard && !target.closest('button')) {\n        const fieldId = fieldCard.getAttribute('data-field-card');\n        if (fieldId) {\n          this.state.selectedFieldId = this.state.selectedFieldId === fieldId ? null : fieldId;\n          this.renderFieldList();\n        }\n      }\n    });\n\n    // Mark dirty on input changes\n    this.container.addEventListener('input', (e) => {\n      const target = e.target as HTMLElement;\n      if (\n        target.matches('[data-ct-name], [data-ct-slug], [data-ct-description], [data-ct-icon]') ||\n        target.matches('[data-ct-cap]')\n      ) {\n        this.state.isDirty = true;\n        this.updateDirtyState();\n      }\n    });\n\n    // Auto-generate slug from name\n    const nameInput = this.container.querySelector<HTMLInputElement>('[data-ct-name]');\n    const slugInput = this.container.querySelector<HTMLInputElement>('[data-ct-slug]');\n    if (nameInput && slugInput) {\n      nameInput.addEventListener('input', () => {\n        if (!slugInput.dataset.userModified && !this.state.contentType?.slug) {\n          slugInput.value = nameToSlug(nameInput.value);\n        }\n      });\n      slugInput.addEventListener('input', () => {\n        slugInput.dataset.userModified = 'true';\n      });\n    }\n\n    // Drag and drop\n    this.bindDragEvents();\n  }\n\n  private bindDragEvents(): void {\n    const fieldList = this.container.querySelector('[data-ct-field-list]');\n    if (!fieldList) return;\n\n    // Drag start\n    fieldList.addEventListener('dragstart', (evt) => {\n      const e = evt as DragEvent;\n      const target = e.target as HTMLElement;\n      const card = target.closest<HTMLElement>('[data-field-card]');\n      if (!card) return;\n\n      const fieldId = card.getAttribute('data-field-card');\n      const index = parseInt(card.getAttribute('data-field-index') ?? '0', 10);\n\n      this.dragState = {\n        fieldId: fieldId ?? '',\n        startIndex: index,\n        currentIndex: index,\n      };\n\n      card.classList.add('opacity-50');\n      e.dataTransfer?.setData('text/plain', fieldId ?? '');\n      if (e.dataTransfer) e.dataTransfer.effectAllowed = 'move';\n    });\n\n    // Drag over\n    fieldList.addEventListener('dragover', (evt) => {\n      evt.preventDefault();\n      const e = evt as DragEvent;\n      if (!this.dragState) return;\n\n      const target = e.target as HTMLElement;\n      const card = target.closest<HTMLElement>('[data-field-card]');\n      if (!card || card.getAttribute('data-field-card') === this.dragState.fieldId) return;\n\n      const rect = card.getBoundingClientRect();\n      const midY = rect.top + rect.height / 2;\n      const insertBefore = e.clientY < midY;\n\n      // Visual feedback\n      fieldList.querySelectorAll('.drop-indicator').forEach((el) => el.remove());\n      const indicator = document.createElement('div');\n      indicator.className =\n        'drop-indicator h-0.5 bg-blue-500 rounded-full my-1 transition-opacity';\n      if (insertBefore) {\n        card.parentElement?.insertBefore(indicator, card);\n      } else {\n        card.parentElement?.insertBefore(indicator, card.nextSibling);\n      }\n\n      // Update current index\n      const targetIndex = parseInt(card.getAttribute('data-field-index') ?? '0', 10);\n      this.dragState.currentIndex = insertBefore ? targetIndex : targetIndex + 1;\n    });\n\n    // Drag leave\n    fieldList.addEventListener('dragleave', () => {\n      fieldList.querySelectorAll('.drop-indicator').forEach((el) => el.remove());\n    });\n\n    // Drop\n    fieldList.addEventListener('drop', (e) => {\n      e.preventDefault();\n      fieldList.querySelectorAll('.drop-indicator').forEach((el) => el.remove());\n\n      if (!this.dragState) return;\n\n      const { fieldId, startIndex, currentIndex } = this.dragState;\n      if (startIndex !== currentIndex) {\n        const adjustedIndex = currentIndex > startIndex ? currentIndex - 1 : currentIndex;\n        this.moveField(fieldId, adjustedIndex);\n      }\n\n      this.dragState = null;\n    });\n\n    // Drag end\n    fieldList.addEventListener('dragend', () => {\n      fieldList.querySelectorAll('.opacity-50').forEach((el) => el.classList.remove('opacity-50'));\n      fieldList.querySelectorAll('.drop-indicator').forEach((el) => el.remove());\n      this.dragState = null;\n    });\n  }\n\n  private bindLifecycleMenuEvents(): void {\n    const menuContainer = this.container.querySelector('[data-ct-lifecycle-menu]');\n    if (!menuContainer) return;\n\n    const trigger = menuContainer.querySelector('[data-ct-lifecycle-trigger]');\n    const dropdown = menuContainer.querySelector('[data-ct-lifecycle-dropdown]');\n\n    if (trigger && dropdown) {\n      // Toggle dropdown on click\n      trigger.addEventListener('click', (e) => {\n        e.stopPropagation();\n        dropdown.classList.toggle('hidden');\n      });\n\n      // Close dropdown when clicking outside\n      document.addEventListener('click', (e) => {\n        if (!menuContainer.contains(e.target as Node)) {\n          dropdown.classList.add('hidden');\n        }\n      });\n    }\n\n    // Lifecycle action buttons\n    this.container.querySelector('[data-ct-publish]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.publishContentType();\n    });\n\n    this.container.querySelector('[data-ct-deprecate]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.deprecateContentType();\n    });\n\n    this.container.querySelector('[data-ct-clone]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.cloneContentType();\n    });\n\n    this.container.querySelector('[data-ct-versions]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.showVersionHistory();\n    });\n  }\n\n  private showFieldTypePicker(): void {\n    const picker = new FieldTypePicker({\n      onSelect: (type) => this.addField(type),\n      onCancel: () => {},\n    });\n    picker.show();\n  }\n\n  private showLayoutEditor(): void {\n    const editor = new LayoutEditor({\n      layout: this.state.layout,\n      fields: this.state.fields,\n      onSave: (layout) => {\n        this.state.layout = layout;\n        this.state.isDirty = true;\n        this.renderFieldList();\n        this.updateDirtyState();\n        // Re-render fields section to update layout badge\n        const fieldsSection = this.container.querySelector('[data-ct-field-list]')?.closest('.rounded-lg');\n        if (fieldsSection) {\n          const newFieldsSection = document.createElement('div');\n          newFieldsSection.innerHTML = this.renderFieldsSection();\n          fieldsSection.replaceWith(newFieldsSection.firstElementChild!);\n          this.bindFieldsEvents();\n        }\n      },\n      onCancel: () => {},\n    });\n    editor.show();\n  }\n\n  private bindFieldsEvents(): void {\n    // Re-bind field section events after re-render\n    this.container.querySelector('[data-ct-add-field]')?.addEventListener('click', () => this.showFieldTypePicker());\n    this.container.querySelector('[data-ct-add-field-empty]')?.addEventListener('click', () => this.showFieldTypePicker());\n    this.container.querySelector('[data-ct-layout]')?.addEventListener('click', () => this.showLayoutEditor());\n    this.bindDragEvents();\n  }\n\n  // ===========================================================================\n  // Helpers\n  // ===========================================================================\n\n  private getSlug(): string {\n    const slugInput = this.container.querySelector<HTMLInputElement>('[data-ct-slug]');\n    const nameInput = this.container.querySelector<HTMLInputElement>('[data-ct-name]');\n    const slug = slugInput?.value?.trim();\n    if (slug) return slug;\n    return nameToSlug(nameInput?.value ?? '');\n  }\n\n  private getDescription(): string | undefined {\n    const input = this.container.querySelector<HTMLTextAreaElement>('[data-ct-description]');\n    const value = input?.value?.trim();\n    return value || undefined;\n  }\n\n  private getIcon(): string | undefined {\n    const input = this.container.querySelector<HTMLInputElement>('[data-ct-icon]');\n    const value = input?.value?.trim();\n    return value || undefined;\n  }\n\n  private getCapabilities(): ContentTypeCapabilities {\n    const caps: ContentTypeCapabilities = {};\n    this.container.querySelectorAll<HTMLInputElement>('[data-ct-cap]').forEach((input) => {\n      const key = input.getAttribute('data-ct-cap');\n      if (key) {\n        caps[key] = input.checked;\n      }\n    });\n    return caps;\n  }\n\n  private buildUISchema(): UISchemaOverlay | undefined {\n    const uiSchema: UISchemaOverlay = {};\n\n    // Build layout from state\n    const layout: UILayoutConfig = {\n      type: this.state.layout.type ?? 'flat',\n      gridColumns: this.state.layout.gridColumns ?? 12,\n    };\n\n    // Include tabs if using tabs or sections layout\n    if (layout.type === 'tabs' || layout.type === 'sections') {\n      // Merge explicit tabs with field sections\n      const tabsById = new Map<string, { id: string; label: string; order: number; icon?: string }>();\n\n      // Add explicit tabs from layout\n      (this.state.layout.tabs ?? []).forEach((tab, i) => {\n        tabsById.set(tab.id, {\n          id: tab.id,\n          label: tab.label,\n          order: tab.order ?? i,\n          icon: tab.icon,\n        });\n      });\n\n      // Add implicit tabs from field sections\n      this.state.fields.forEach((field) => {\n        if (field.section && !tabsById.has(field.section)) {\n          tabsById.set(field.section, {\n            id: field.section,\n            label: titleCase(field.section),\n            order: tabsById.size,\n          });\n        }\n      });\n\n      if (tabsById.size > 0) {\n        layout.tabs = Array.from(tabsById.values()).sort((a, b) => a.order - b.order);\n      }\n    }\n\n    uiSchema.layout = layout;\n\n    // Build field overrides\n    const overrides: UIOverride[] = [];\n    this.state.fields.forEach((field) => {\n      const override: UIOverride = { path: `#/properties/${field.name}` };\n      const formgen: Record<string, unknown> = {};\n\n      // Add formgen properties that aren't in the schema\n      if (field.section) formgen.section = field.section;\n      if (field.gridSpan) formgen.grid = { span: field.gridSpan };\n      if (field.order !== undefined) formgen.order = field.order;\n      if (field.readonly) formgen.readonly = true;\n      if (field.hidden) formgen.hidden = true;\n\n      if (Object.keys(formgen).length > 0) {\n        override['x-formgen'] = formgen;\n        overrides.push(override);\n      }\n    });\n\n    if (overrides.length > 0) {\n      uiSchema.overrides = overrides;\n    }\n\n    // Only return if there's meaningful content\n    if (\n      (layout.type === 'flat' && !layout.tabs?.length && overrides.length === 0) ||\n      (!uiSchema.layout && !uiSchema.overrides)\n    ) {\n      return undefined;\n    }\n\n    return uiSchema;\n  }\n\n  private updateLoadingState(): void {\n    const saveBtn = this.container.querySelector<HTMLButtonElement>('[data-ct-save]');\n    if (saveBtn) {\n      saveBtn.disabled = this.state.isLoading;\n    }\n  }\n\n  private updateSavingState(): void {\n    const saveBtn = this.container.querySelector<HTMLButtonElement>('[data-ct-save]');\n    if (saveBtn) {\n      saveBtn.disabled = this.state.isSaving;\n      saveBtn.textContent = this.state.isSaving ? 'Saving...' : this.state.contentType ? 'Save Changes' : 'Create Content Type';\n    }\n  }\n\n  private updatePreviewState(): void {\n    const previewBtn = this.container.querySelector<HTMLButtonElement>('[data-ct-preview]');\n    if (previewBtn) {\n      previewBtn.disabled = this.state.isPreviewing;\n      previewBtn.textContent = this.state.isPreviewing ? 'Loading...' : 'Preview';\n    }\n  }\n\n  private updateDirtyState(): void {\n    // Could add visual indicator for unsaved changes\n  }\n\n  private renderFieldList(): void {\n    const fieldListContainer = this.container.querySelector('[data-ct-field-list]');\n    if (fieldListContainer) {\n      fieldListContainer.innerHTML = this.renderFieldListContent();\n      this.bindDragEvents();\n    }\n  }\n\n  private renderFieldListContent(): string {\n    if (this.state.fields.length === 0) {\n      return `\n        <div class=\"flex flex-col items-center justify-center py-12 text-gray-400\">\n          <svg class=\"w-12 h-12 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"></path>\n          </svg>\n          <p class=\"text-sm mb-3\">No fields yet</p>\n          <button\n            type=\"button\"\n            data-ct-add-field-empty\n            class=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n          >\n            + Add your first field\n          </button>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"space-y-2\">\n        ${this.state.fields.map((field, index) => this.renderFieldCard(field, index)).join('')}\n      </div>\n    `;\n  }\n\n  private renderPreview(): void {\n    const previewContainer = this.container.querySelector('[data-ct-preview-container]');\n    if (previewContainer && this.state.previewHtml) {\n      previewContainer.innerHTML = this.state.previewHtml;\n    }\n  }\n\n  private renderValidationErrors(): void {\n    const errorsContainer = this.container.querySelector('[data-ct-validation-errors]');\n    if (!errorsContainer) return;\n\n    if (this.state.validationErrors.length === 0) {\n      errorsContainer.classList.add('hidden');\n      errorsContainer.innerHTML = '';\n      // Re-render field list to clear error styling\n      this.renderFieldList();\n      return;\n    }\n\n    // Group errors by field\n    const errorsByField = new Map<string, SchemaValidationError[]>();\n    const generalErrors: SchemaValidationError[] = [];\n\n    for (const err of this.state.validationErrors) {\n      const fieldMatch = err.path.match(/properties[./](\\w+)/);\n      if (fieldMatch) {\n        const fieldName = fieldMatch[1];\n        if (!errorsByField.has(fieldName)) {\n          errorsByField.set(fieldName, []);\n        }\n        errorsByField.get(fieldName)!.push(err);\n      } else {\n        generalErrors.push(err);\n      }\n    }\n\n    errorsContainer.classList.remove('hidden');\n    errorsContainer.innerHTML = `\n      <div class=\"fixed bottom-4 right-4 max-w-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg shadow-lg overflow-hidden z-40\">\n        <div class=\"flex items-center justify-between px-4 py-2 bg-red-100 dark:bg-red-900/40 border-b border-red-200 dark:border-red-800\">\n          <div class=\"flex items-center gap-2\">\n            <svg class=\"w-4 h-4 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-red-800 dark:text-red-200\">\n              ${this.state.validationErrors.length} Validation Error${this.state.validationErrors.length > 1 ? 's' : ''}\n            </span>\n          </div>\n          <button type=\"button\" class=\"text-red-400 hover:text-red-600\" data-close-validation-errors>\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </div>\n        <div class=\"px-4 py-3 max-h-64 overflow-y-auto\">\n          ${generalErrors.length > 0 ? `\n            <div class=\"mb-3\">\n              <div class=\"text-xs font-medium text-red-700 dark:text-red-300 uppercase mb-1\">Schema</div>\n              <ul class=\"text-sm text-red-600 dark:text-red-400 space-y-1\">\n                ${generalErrors.map((err) => `<li class=\"flex items-start gap-2\"><span class=\"text-red-400\">â€¢</span>${escapeHtml(err.message)}</li>`).join('')}\n              </ul>\n            </div>\n          ` : ''}\n          ${Array.from(errorsByField.entries()).map(([fieldName, errors]) => {\n            const field = this.state.fields.find((f) => f.name === fieldName);\n            return `\n              <div class=\"mb-3 last:mb-0\">\n                <div class=\"text-xs font-medium text-red-700 dark:text-red-300 mb-1\">\n                  ${escapeHtml(field?.label ?? fieldName)} <span class=\"font-mono\">(${escapeHtml(fieldName)})</span>\n                </div>\n                <ul class=\"text-sm text-red-600 dark:text-red-400 space-y-1\">\n                  ${errors.map((err) => `<li class=\"flex items-start gap-2\"><span class=\"text-red-400\">â€¢</span>${escapeHtml(err.message)}</li>`).join('')}\n                </ul>\n              </div>\n            `;\n          }).join('')}\n        </div>\n      </div>\n    `;\n\n    // Bind close button\n    errorsContainer.querySelector('[data-close-validation-errors]')?.addEventListener('click', () => {\n      errorsContainer.classList.add('hidden');\n    });\n\n    // Re-render field list to show error styling\n    this.renderFieldList();\n  }\n\n  private showToast(message: string, type: 'success' | 'error' | 'info'): void {\n    // Try to use global toast if available\n    const toastFn = (window as any).showToast;\n    if (typeof toastFn === 'function') {\n      toastFn(message, type);\n      return;\n    }\n\n    // Fallback to console\n    if (type === 'error') {\n      console.error(message);\n    } else {\n      console.log(message);\n    }\n  }\n}\n\n// =============================================================================\n// Types\n// =============================================================================\n\ninterface DragState {\n  fieldId: string;\n  startIndex: number;\n  currentIndex: number;\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction nameToSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '');\n}\n\nfunction titleCase(str: string): string {\n  return str\n    .replace(/([A-Z])/g, ' $1')\n    .replace(/[_-]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n    .split(' ')\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n}\n\nfunction formatDate(dateStr: string): string {\n  try {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' });\n  } catch {\n    return dateStr;\n  }\n}\n\n// =============================================================================\n// Publish Confirmation Modal\n// =============================================================================\n\ninterface PublishConfirmationModalConfig {\n  contentType: ContentType;\n  compatibilityResult: CompatibilityCheckResult | null;\n  onConfirm: (force: boolean) => void;\n  onCancel: () => void;\n}\n\nclass PublishConfirmationModal {\n  private config: PublishConfirmationModalConfig;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n\n  constructor(config: PublishConfirmationModalConfig) {\n    this.config = config;\n  }\n\n  show(): void {\n    this.render();\n    this.bindEvents();\n  }\n\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    const { contentType, compatibilityResult } = this.config;\n    const hasBreakingChanges = (compatibilityResult?.breaking_changes?.length ?? 0) > 0;\n    const hasWarnings = (compatibilityResult?.warnings?.length ?? 0) > 0;\n    const affectedCount = compatibilityResult?.affected_entries_count ?? 0;\n\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-[70] flex items-center justify-center bg-black/50 transition-opacity duration-150 opacity-0';\n\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-lg overflow-hidden';\n\n    this.container.innerHTML = `\n      <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Publish Content Type\n        </h2>\n      </div>\n\n      <div class=\"px-6 py-4 space-y-4\">\n        <p class=\"text-sm text-gray-600 dark:text-gray-400\">\n          You are about to publish <strong class=\"text-gray-900 dark:text-white\">${escapeHtml(contentType.name)}</strong>.\n          ${contentType.status === 'draft' ? 'This will make it available for content creation.' : 'This will create a new version of the schema.'}\n        </p>\n\n        ${hasBreakingChanges ? `\n          <div class=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n            <div class=\"flex items-center gap-2 mb-2\">\n              <svg class=\"w-5 h-5 text-red-600 dark:text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n              </svg>\n              <span class=\"text-sm font-medium text-red-800 dark:text-red-200\">Breaking Changes Detected</span>\n            </div>\n            <ul class=\"text-sm text-red-700 dark:text-red-300 space-y-1 ml-7\">\n              ${compatibilityResult!.breaking_changes.map((change) => `\n                <li>â€¢ ${escapeHtml(change.description || `${change.type}: ${change.path}`)}</li>\n              `).join('')}\n            </ul>\n            ${affectedCount > 0 ? `\n              <p class=\"mt-2 ml-7 text-xs text-red-600 dark:text-red-400\">\n                ${affectedCount} content ${affectedCount === 1 ? 'entry' : 'entries'} will require migration.\n              </p>\n            ` : ''}\n          </div>\n        ` : ''}\n\n        ${hasWarnings ? `\n          <div class=\"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg\">\n            <div class=\"flex items-center gap-2 mb-2\">\n              <svg class=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n              <span class=\"text-sm font-medium text-yellow-800 dark:text-yellow-200\">Warnings</span>\n            </div>\n            <ul class=\"text-sm text-yellow-700 dark:text-yellow-300 space-y-1 ml-7\">\n              ${compatibilityResult!.warnings.map((change) => `\n                <li>â€¢ ${escapeHtml(change.description || `${change.type}: ${change.path}`)}</li>\n              `).join('')}\n            </ul>\n          </div>\n        ` : ''}\n\n        ${!hasBreakingChanges && !hasWarnings ? `\n          <div class=\"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\">\n            <div class=\"flex items-center gap-2\">\n              <svg class=\"w-5 h-5 text-green-600 dark:text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n              <span class=\"text-sm font-medium text-green-800 dark:text-green-200\">Schema is compatible</span>\n            </div>\n            <p class=\"mt-1 ml-7 text-sm text-green-700 dark:text-green-300\">\n              No breaking changes detected. Publishing is safe.\n            </p>\n          </div>\n        ` : ''}\n\n        ${hasBreakingChanges ? `\n          <label class=\"flex items-start gap-2\">\n            <input\n              type=\"checkbox\"\n              data-publish-force\n              class=\"mt-0.5 w-4 h-4 text-red-600 border-gray-300 dark:border-gray-600 rounded focus:ring-red-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">\n              I understand there are breaking changes and want to publish anyway\n            </span>\n          </label>\n        ` : ''}\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-publish-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-publish-confirm\n          class=\"px-4 py-2 text-sm font-medium text-white rounded-lg ${hasBreakingChanges ? 'bg-red-600 hover:bg-red-700 disabled:opacity-50' : 'bg-green-600 hover:bg-green-700'}\"\n          ${hasBreakingChanges ? 'disabled' : ''}\n        >\n          ${hasBreakingChanges ? 'Publish with Breaking Changes' : 'Publish'}\n        </button>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private bindEvents(): void {\n    this.backdrop?.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n\n    this.container?.querySelector('[data-publish-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    const confirmBtn = this.container?.querySelector<HTMLButtonElement>('[data-publish-confirm]');\n    const forceCheckbox = this.container?.querySelector<HTMLInputElement>('[data-publish-force]');\n\n    // Enable confirm button when force checkbox is checked (for breaking changes)\n    forceCheckbox?.addEventListener('change', () => {\n      if (confirmBtn) {\n        confirmBtn.disabled = !forceCheckbox.checked;\n      }\n    });\n\n    confirmBtn?.addEventListener('click', () => {\n      const force = forceCheckbox?.checked ?? false;\n      this.config.onConfirm(force);\n      this.hide();\n    });\n\n    // Escape key\n    this.container?.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n  }\n}\n\n// =============================================================================\n// Clone Content Type Modal\n// =============================================================================\n\ninterface CloneContentTypeModalConfig {\n  contentType: ContentType;\n  onConfirm: (newSlug: string, newName?: string) => void;\n  onCancel: () => void;\n}\n\nclass CloneContentTypeModal {\n  private config: CloneContentTypeModalConfig;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n\n  constructor(config: CloneContentTypeModalConfig) {\n    this.config = config;\n  }\n\n  show(): void {\n    this.render();\n    this.bindEvents();\n  }\n\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    const { contentType } = this.config;\n    const suggestedSlug = `${contentType.slug}-copy`;\n    const suggestedName = `${contentType.name} (Copy)`;\n\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-[70] flex items-center justify-center bg-black/50 transition-opacity duration-150 opacity-0';\n\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-md overflow-hidden';\n\n    this.container.innerHTML = `\n      <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Clone Content Type\n        </h2>\n      </div>\n\n      <div class=\"px-6 py-4 space-y-4\">\n        <p class=\"text-sm text-gray-600 dark:text-gray-400\">\n          Create a copy of <strong class=\"text-gray-900 dark:text-white\">${escapeHtml(contentType.name)}</strong> with a new slug and name.\n        </p>\n\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            New Slug <span class=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            data-clone-slug\n            value=\"${escapeHtml(suggestedSlug)}\"\n            placeholder=\"my-content-type\"\n            pattern=\"^[a-z][a-z0-9_-]*$\"\n            required\n            class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n          <p class=\"mt-1 text-xs text-gray-500\">Lowercase letters, numbers, hyphens, underscores</p>\n        </div>\n\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            New Name\n          </label>\n          <input\n            type=\"text\"\n            data-clone-name\n            value=\"${escapeHtml(suggestedName)}\"\n            placeholder=\"My Content Type\"\n            class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-clone-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-clone-confirm\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          Clone\n        </button>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n      // Focus the slug input\n      const slugInput = this.container?.querySelector<HTMLInputElement>('[data-clone-slug]');\n      slugInput?.focus();\n      slugInput?.select();\n    });\n  }\n\n  private bindEvents(): void {\n    this.backdrop?.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n\n    this.container?.querySelector('[data-clone-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    this.container?.querySelector('[data-clone-confirm]')?.addEventListener('click', () => {\n      const slugInput = this.container?.querySelector<HTMLInputElement>('[data-clone-slug]');\n      const nameInput = this.container?.querySelector<HTMLInputElement>('[data-clone-name]');\n\n      const newSlug = slugInput?.value?.trim();\n      const newName = nameInput?.value?.trim();\n\n      if (!newSlug) {\n        alert('Slug is required');\n        slugInput?.focus();\n        return;\n      }\n\n      if (!/^[a-z][a-z0-9_-]*$/.test(newSlug)) {\n        alert('Invalid slug format. Use lowercase letters, numbers, hyphens, underscores. Must start with a letter.');\n        slugInput?.focus();\n        return;\n      }\n\n      this.config.onConfirm(newSlug, newName || undefined);\n      this.hide();\n    });\n\n    // Enter key to submit\n    this.container?.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        this.container?.querySelector<HTMLButtonElement>('[data-clone-confirm]')?.click();\n      } else if (e.key === 'Escape') {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n  }\n}\n\n// =============================================================================\n// Content Type Version History Viewer\n// =============================================================================\n\ninterface ContentTypeVersionHistoryViewerConfig {\n  apiBasePath: string;\n  contentType: ContentType;\n}\n\nclass ContentTypeVersionHistoryViewer {\n  private config: ContentTypeVersionHistoryViewerConfig;\n  private api: ContentTypeAPIClient;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private versions: ContentTypeSchemaVersion[] = [];\n  private expandedVersions: Set<string> = new Set();\n\n  constructor(config: ContentTypeVersionHistoryViewerConfig) {\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n  }\n\n  async show(): Promise<void> {\n    this.render();\n    this.bindEvents();\n    await this.loadVersions();\n  }\n\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-[60] flex items-center justify-center bg-black/50 transition-opacity duration-150 opacity-0';\n\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden';\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Version History</h2>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">${escapeHtml(this.config.contentType.name)} (${escapeHtml(this.config.contentType.slug)})</p>\n        </div>\n        <button type=\"button\" data-viewer-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto\">\n        <div data-versions-list class=\"p-4\">\n          <div class=\"flex items-center justify-center py-8\">\n            <div class=\"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private bindEvents(): void {\n    this.backdrop?.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) this.hide();\n    });\n\n    this.container?.querySelector('[data-viewer-close]')?.addEventListener('click', () => {\n      this.hide();\n    });\n\n    this.container?.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') this.hide();\n    });\n  }\n\n  private async loadVersions(): Promise<void> {\n    try {\n      const result = await this.api.getVersionHistory(this.config.contentType.id);\n      this.versions = result.versions;\n      this.renderVersionsList();\n    } catch {\n      this.renderVersionsList();\n    }\n  }\n\n  private renderVersionsList(): void {\n    const listEl = this.container?.querySelector('[data-versions-list]');\n    if (!listEl) return;\n\n    if (this.versions.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <p class=\"text-sm\">No version history available.</p>\n          <p class=\"text-xs mt-2\">Current version: ${escapeHtml(this.config.contentType.schema_version ?? '1.0.0')}</p>\n        </div>\n      `;\n      return;\n    }\n\n    listEl.innerHTML = `\n      <div class=\"space-y-3\">\n        ${this.versions.map((version, index) => this.renderVersionCard(version, index === 0)).join('')}\n      </div>\n    `;\n\n    // Bind expand/collapse events\n    listEl.querySelectorAll('[data-toggle-version]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const versionId = btn.getAttribute('data-toggle-version');\n        if (versionId) {\n          if (this.expandedVersions.has(versionId)) {\n            this.expandedVersions.delete(versionId);\n          } else {\n            this.expandedVersions.add(versionId);\n          }\n          this.renderVersionsList();\n        }\n      });\n    });\n  }\n\n  private renderVersionCard(version: ContentTypeSchemaVersion, isCurrent: boolean): string {\n    const isExpanded = this.expandedVersions.has(version.version);\n    const hasChanges = (version.changes?.length ?? 0) > 0;\n    const hasBreakingChanges = version.is_breaking || version.changes?.some((c) => c.is_breaking);\n\n    return `\n      <div class=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\n        <div class=\"p-4 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50\">\n          <div class=\"flex items-center gap-3\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"text-sm font-medium text-gray-900 dark:text-white\">v${escapeHtml(version.version)}</span>\n              ${isCurrent ? '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\">Current</span>' : ''}\n              ${hasBreakingChanges ? '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Breaking</span>' : ''}\n              ${this.getMigrationBadge(version.migration_status)}\n            </div>\n          </div>\n          <div class=\"flex items-center gap-3\">\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">${formatDate(version.created_at)}</span>\n            ${hasChanges ? `\n              <button\n                type=\"button\"\n                data-toggle-version=\"${escapeHtml(version.version)}\"\n                class=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded\"\n              >\n                <svg class=\"w-4 h-4 transition-transform ${isExpanded ? 'rotate-180' : ''}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n                </svg>\n              </button>\n            ` : ''}\n          </div>\n        </div>\n\n        ${version.migration_status && version.total_count ? `\n          <div class=\"px-4 py-2 border-t border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/30\">\n            <div class=\"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1\">\n              <span>Migration Progress</span>\n              <span>${version.migrated_count ?? 0}/${version.total_count}</span>\n            </div>\n            <div class=\"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n              <div class=\"h-full bg-blue-600 rounded-full\" style=\"width: ${((version.migrated_count ?? 0) / version.total_count) * 100}%\"></div>\n            </div>\n          </div>\n        ` : ''}\n\n        ${isExpanded && hasChanges ? `\n          <div class=\"px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900\">\n            <h4 class=\"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2\">Changes</h4>\n            <ul class=\"space-y-2\">\n              ${version.changes!.map((change) => this.renderChangeItem(change)).join('')}\n            </ul>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  private renderChangeItem(change: SchemaChange): string {\n    const typeColors = {\n      added: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',\n      removed: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',\n      modified: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400',\n    };\n\n    const typeIcons = {\n      added: '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>',\n      removed: '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"></path>',\n      modified: '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>',\n    };\n\n    return `\n      <li class=\"flex items-start gap-2 text-sm\">\n        <span class=\"flex-shrink-0 px-2 py-0.5 text-xs font-medium rounded ${typeColors[change.type]}\">\n          <svg class=\"w-3 h-3 inline-block mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            ${typeIcons[change.type]}\n          </svg>\n          ${change.type}\n        </span>\n        <div class=\"flex-1\">\n          <span class=\"font-mono text-xs text-gray-600 dark:text-gray-400\">${escapeHtml(change.path)}</span>\n          ${change.field ? `<span class=\"text-gray-500 dark:text-gray-400\"> (${escapeHtml(change.field)})</span>` : ''}\n          ${change.description ? `<p class=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5\">${escapeHtml(change.description)}</p>` : ''}\n          ${change.is_breaking ? '<span class=\"ml-1 text-xs text-red-500 dark:text-red-400\">Breaking</span>' : ''}\n        </div>\n      </li>\n    `;\n  }\n\n  private getMigrationBadge(status?: string): string {\n    switch (status) {\n      case 'pending':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\">Pending</span>';\n      case 'in_progress':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\">Migrating</span>';\n      case 'completed':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\">Migrated</span>';\n      case 'failed':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Failed</span>';\n      default:\n        return '';\n    }\n  }\n}\n","/**\n * Block Library Manager\n *\n * UI component for managing block definitions (CRUD operations).\n * Supports both management mode (full CRUD) and picker mode (selection only).\n */\n\nimport type {\n  BlockDefinition,\n  BlockDefinitionSummary,\n  BlockLibraryManagerConfig,\n  BlockLibraryManagerState,\n  BlockSchemaVersion,\n  JSONSchema,\n} from './types';\nimport { ContentTypeAPIClient } from './api-client';\nimport { FieldTypePicker, FIELD_TYPES } from './field-type-picker';\nimport { FieldConfigForm } from './field-config-form';\nimport { fieldsToSchema, schemaToFields, generateFieldId } from './api-client';\n\n// =============================================================================\n// Block Library Manager Component\n// =============================================================================\n\nexport class BlockLibraryManager {\n  private config: BlockLibraryManagerConfig;\n  private api: ContentTypeAPIClient;\n  private state: BlockLibraryManagerState;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private categories: string[] = [];\n\n  constructor(config: BlockLibraryManagerConfig) {\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    this.state = {\n      blocks: [],\n      selectedBlockId: null,\n      isLoading: false,\n      isSaving: false,\n      error: null,\n      filter: '',\n      categoryFilter: null,\n    };\n  }\n\n  /**\n   * Show the block library manager\n   */\n  async show(): Promise<void> {\n    this.render();\n    this.bindEvents();\n    await this.loadBlocks();\n    await this.loadCategories();\n  }\n\n  /**\n   * Hide the block library manager\n   */\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    const isManageMode = this.config.mode !== 'picker';\n    const title = isManageMode ? 'Block Library' : 'Select Block Type';\n\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-50 flex items-center justify-center bg-black/50 transition-opacity duration-150 opacity-0';\n    this.backdrop.setAttribute('data-block-library-backdrop', 'true');\n\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden';\n    this.container.setAttribute('data-block-library-manager', 'true');\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center gap-3\">\n          <span class=\"flex items-center justify-center w-10 h-10 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400\">\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\"></path>\n            </svg>\n          </span>\n          <div>\n            <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">${title}</h2>\n            <p class=\"text-sm text-gray-500 dark:text-gray-400\">\n              ${isManageMode ? 'Create, edit, and manage reusable block definitions' : 'Choose a block type to add'}\n            </p>\n          </div>\n        </div>\n        <button type=\"button\" data-block-library-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex items-center gap-4 px-6 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n        <div class=\"flex-1 relative\">\n          <input\n            type=\"text\"\n            data-block-filter\n            placeholder=\"Search blocks...\"\n            class=\"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n          <svg class=\"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n          </svg>\n        </div>\n        <select\n          data-block-category-filter\n          class=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        >\n          <option value=\"\">All Categories</option>\n        </select>\n        ${\n          isManageMode\n            ? `\n          <button\n            type=\"button\"\n            data-block-create\n            class=\"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n            </svg>\n            New Block\n          </button>\n        `\n            : ''\n        }\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto\">\n        <div data-block-list class=\"p-4\">\n          <div data-block-loading class=\"flex items-center justify-center py-12\">\n            <div class=\"animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          </div>\n        </div>\n      </div>\n\n      <div data-block-error class=\"hidden px-6 py-3 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-800\">\n        <p class=\"text-sm text-red-600 dark:text-red-400\"></p>\n      </div>\n\n      ${\n        this.config.mode === 'picker'\n          ? `\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n          <button\n            type=\"button\"\n            data-block-library-cancel\n            class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n          >\n            Cancel\n          </button>\n        </div>\n      `\n          : ''\n      }\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private bindEvents(): void {\n    if (!this.container || !this.backdrop) return;\n\n    // Close on backdrop click\n    this.backdrop.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) {\n        this.config.onClose?.();\n        this.hide();\n      }\n    });\n\n    // Close button\n    this.container.querySelector('[data-block-library-close]')?.addEventListener('click', () => {\n      this.config.onClose?.();\n      this.hide();\n    });\n\n    // Cancel button (picker mode)\n    this.container.querySelector('[data-block-library-cancel]')?.addEventListener('click', () => {\n      this.config.onClose?.();\n      this.hide();\n    });\n\n    // Filter input\n    const filterInput = this.container.querySelector<HTMLInputElement>('[data-block-filter]');\n    filterInput?.addEventListener('input', () => {\n      this.state.filter = filterInput.value;\n      this.renderBlockList();\n    });\n\n    // Category filter\n    const categoryFilter = this.container.querySelector<HTMLSelectElement>('[data-block-category-filter]');\n    categoryFilter?.addEventListener('change', () => {\n      this.state.categoryFilter = categoryFilter.value || null;\n      this.renderBlockList();\n    });\n\n    // Create new block\n    this.container.querySelector('[data-block-create]')?.addEventListener('click', () => {\n      this.showBlockEditor(null);\n    });\n\n    // Keyboard shortcuts\n    this.container.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.config.onClose?.();\n        this.hide();\n      }\n    });\n\n    // Delegate click events on block list\n    const blockList = this.container.querySelector('[data-block-list]');\n    blockList?.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n\n      // Block card click (picker mode)\n      const blockCard = target.closest('[data-block-id]');\n      if (blockCard && this.config.mode === 'picker') {\n        const blockId = blockCard.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block && this.isBlockAllowed(block)) {\n          this.config.onSelect?.({\n            id: block.id,\n            name: block.name,\n            type: block.type,\n            description: block.description,\n            icon: block.icon,\n            category: block.category,\n            schema_version: block.schema_version,\n            status: block.status,\n          });\n          this.hide();\n        }\n        return;\n      }\n\n      // Edit button\n      if (target.closest('[data-block-edit]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.showBlockEditor(block);\n        }\n        return;\n      }\n\n      // Delete button\n      if (target.closest('[data-block-delete]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.confirmDeleteBlock(block);\n        }\n        return;\n      }\n\n      // Clone button\n      if (target.closest('[data-block-clone]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.cloneBlock(block);\n        }\n        return;\n      }\n\n      // Publish button\n      if (target.closest('[data-block-publish]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.publishBlock(block);\n        }\n        return;\n      }\n\n      // Version history button\n      if (target.closest('[data-block-versions]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.showVersionHistory(block);\n        }\n        return;\n      }\n    });\n  }\n\n  private async loadBlocks(): Promise<void> {\n    this.state.isLoading = true;\n    this.state.error = null;\n    this.renderBlockList();\n\n    try {\n      const response = await this.api.listBlockDefinitions();\n      this.state.blocks = response.items;\n    } catch (err) {\n      this.state.error = err instanceof Error ? err.message : 'Failed to load blocks';\n    } finally {\n      this.state.isLoading = false;\n      this.renderBlockList();\n    }\n  }\n\n  private async loadCategories(): Promise<void> {\n    try {\n      this.categories = await this.api.getBlockCategories();\n      this.renderCategoryOptions();\n    } catch {\n      this.categories = ['content', 'media', 'layout', 'interactive', 'custom'];\n      this.renderCategoryOptions();\n    }\n  }\n\n  private renderCategoryOptions(): void {\n    const select = this.container?.querySelector<HTMLSelectElement>('[data-block-category-filter]');\n    if (!select) return;\n\n    select.innerHTML = '<option value=\"\">All Categories</option>';\n    for (const category of this.categories) {\n      const option = document.createElement('option');\n      option.value = category;\n      option.textContent = titleCase(category);\n      select.appendChild(option);\n    }\n  }\n\n  private renderBlockList(): void {\n    const listEl = this.container?.querySelector('[data-block-list]');\n    if (!listEl) return;\n\n    if (this.state.isLoading) {\n      listEl.innerHTML = `\n        <div data-block-loading class=\"flex items-center justify-center py-12\">\n          <div class=\"animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n        </div>\n      `;\n      return;\n    }\n\n    const filteredBlocks = this.getFilteredBlocks();\n\n    if (filteredBlocks.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"flex flex-col items-center justify-center py-12 text-center\">\n          <svg class=\"w-12 h-12 text-gray-300 dark:text-gray-600 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\"></path>\n          </svg>\n          <p class=\"text-gray-500 dark:text-gray-400\">\n            ${this.state.filter || this.state.categoryFilter ? 'No blocks match your filters' : 'No blocks defined yet'}\n          </p>\n          ${\n            this.config.mode !== 'picker' && !this.state.filter && !this.state.categoryFilter\n              ? `\n            <button\n              type=\"button\"\n              data-block-create-empty\n              class=\"mt-4 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n            >\n              Create your first block\n            </button>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      listEl.querySelector('[data-block-create-empty]')?.addEventListener('click', () => {\n        this.showBlockEditor(null);\n      });\n      return;\n    }\n\n    // Group blocks by category\n    const groupedBlocks = new Map<string, BlockDefinition[]>();\n    for (const block of filteredBlocks) {\n      const category = block.category || 'custom';\n      if (!groupedBlocks.has(category)) {\n        groupedBlocks.set(category, []);\n      }\n      groupedBlocks.get(category)!.push(block);\n    }\n\n    let html = '';\n    for (const [category, blocks] of groupedBlocks) {\n      html += `\n        <div class=\"mb-6\">\n          <h3 class=\"text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3\">${titleCase(category)}</h3>\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            ${blocks.map((block) => this.renderBlockCard(block)).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    listEl.innerHTML = html;\n  }\n\n  private renderBlockCard(block: BlockDefinition): string {\n    const isManageMode = this.config.mode !== 'picker';\n    const isAllowed = this.isBlockAllowed(block);\n    const statusBadge = this.getStatusBadge(block.status);\n\n    return `\n      <div\n        data-block-id=\"${block.id}\"\n        class=\"relative p-4 border rounded-lg ${\n          isAllowed\n            ? 'border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-800 hover:border-blue-300 dark:hover:border-blue-600 cursor-pointer'\n            : 'border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 opacity-60 cursor-not-allowed'\n        } transition-colors\"\n      >\n        <div class=\"flex items-start gap-3\">\n          <div class=\"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-lg font-medium\">\n            ${block.icon || block.type.charAt(0).toUpperCase()}\n          </div>\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <h4 class=\"text-sm font-medium text-gray-900 dark:text-white truncate\">${escapeHtml(block.name)}</h4>\n              ${statusBadge}\n            </div>\n            <p class=\"text-xs text-gray-500 dark:text-gray-400 font-mono\">${escapeHtml(block.type)}</p>\n            ${\n              block.description\n                ? `<p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400 line-clamp-2\">${escapeHtml(block.description)}</p>`\n                : ''\n            }\n            ${\n              block.schema_version\n                ? `<p class=\"mt-1 text-xs text-gray-400 dark:text-gray-500\">v${escapeHtml(block.schema_version)}</p>`\n                : ''\n            }\n          </div>\n        </div>\n\n        ${\n          isManageMode\n            ? `\n          <div class=\"absolute top-2 right-2 flex items-center gap-1\">\n            <button\n              type=\"button\"\n              data-block-versions\n              class=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\n              title=\"Version history\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n            </button>\n            ${\n              block.status === 'draft'\n                ? `\n              <button\n                type=\"button\"\n                data-block-publish\n                class=\"p-1.5 text-green-500 hover:text-green-600 rounded hover:bg-green-50 dark:hover:bg-green-900/20\"\n                title=\"Publish\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                </svg>\n              </button>\n            `\n                : ''\n            }\n            <button\n              type=\"button\"\n              data-block-clone\n              class=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\n              title=\"Clone\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\n              </svg>\n            </button>\n            <button\n              type=\"button\"\n              data-block-edit\n              class=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\n              title=\"Edit\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n              </svg>\n            </button>\n            <button\n              type=\"button\"\n              data-block-delete\n              class=\"p-1.5 text-gray-400 hover:text-red-500 rounded hover:bg-red-50 dark:hover:bg-red-900/20\"\n              title=\"Delete\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\n              </svg>\n            </button>\n          </div>\n        `\n            : ''\n        }\n\n        ${!isAllowed ? `<div class=\"absolute inset-0 flex items-center justify-center bg-gray-100/50 dark:bg-gray-900/50 rounded-lg\"><span class=\"text-xs text-gray-500 dark:text-gray-400\">Not allowed</span></div>` : ''}\n      </div>\n    `;\n  }\n\n  private getStatusBadge(status?: string): string {\n    switch (status) {\n      case 'draft':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\">Draft</span>';\n      case 'deprecated':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Deprecated</span>';\n      case 'active':\n      default:\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\">Active</span>';\n    }\n  }\n\n  private getFilteredBlocks(): BlockDefinition[] {\n    let blocks = [...this.state.blocks];\n\n    // Apply search filter\n    if (this.state.filter) {\n      const searchLower = this.state.filter.toLowerCase();\n      blocks = blocks.filter(\n        (b) =>\n          b.name.toLowerCase().includes(searchLower) ||\n          b.type.toLowerCase().includes(searchLower) ||\n          (b.description?.toLowerCase().includes(searchLower) ?? false)\n      );\n    }\n\n    // Apply category filter\n    if (this.state.categoryFilter) {\n      blocks = blocks.filter((b) => b.category === this.state.categoryFilter);\n    }\n\n    return blocks;\n  }\n\n  private isBlockAllowed(block: BlockDefinition): boolean {\n    const { allowedBlocks, deniedBlocks } = this.config;\n\n    if (deniedBlocks && deniedBlocks.includes(block.type)) {\n      return false;\n    }\n\n    if (allowedBlocks && allowedBlocks.length > 0) {\n      return allowedBlocks.includes(block.type);\n    }\n\n    return true;\n  }\n\n  private showBlockEditor(block: BlockDefinition | null): void {\n    const editor = new BlockDefinitionEditor({\n      apiBasePath: this.config.apiBasePath,\n      block,\n      categories: this.categories,\n      onSave: async (savedBlock) => {\n        await this.loadBlocks();\n      },\n      onCancel: () => {},\n    });\n    editor.show();\n  }\n\n  private async confirmDeleteBlock(block: BlockDefinition): Promise<void> {\n    const confirmed = confirm(`Are you sure you want to delete the block \"${block.name}\"? This action cannot be undone.`);\n    if (!confirmed) return;\n\n    try {\n      await this.api.deleteBlockDefinition(block.id);\n      await this.loadBlocks();\n    } catch (err) {\n      this.showError(err instanceof Error ? err.message : 'Failed to delete block');\n    }\n  }\n\n  private async cloneBlock(block: BlockDefinition): Promise<void> {\n    const newType = prompt('Enter a unique type for the cloned block:', `${block.type}_copy`);\n    if (!newType) return;\n\n    try {\n      await this.api.cloneBlockDefinition(block.id, newType);\n      await this.loadBlocks();\n    } catch (err) {\n      this.showError(err instanceof Error ? err.message : 'Failed to clone block');\n    }\n  }\n\n  private async publishBlock(block: BlockDefinition): Promise<void> {\n    try {\n      await this.api.publishBlockDefinition(block.id);\n      await this.loadBlocks();\n    } catch (err) {\n      this.showError(err instanceof Error ? err.message : 'Failed to publish block');\n    }\n  }\n\n  private async showVersionHistory(block: BlockDefinition): Promise<void> {\n    const viewer = new BlockVersionHistoryViewer({\n      apiBasePath: this.config.apiBasePath,\n      block,\n    });\n    viewer.show();\n  }\n\n  private showError(message: string): void {\n    const errorEl = this.container?.querySelector('[data-block-error]');\n    if (!errorEl) return;\n\n    errorEl.classList.remove('hidden');\n    const textEl = errorEl.querySelector('p');\n    if (textEl) textEl.textContent = message;\n\n    setTimeout(() => {\n      errorEl.classList.add('hidden');\n    }, 5000);\n  }\n}\n\n// =============================================================================\n// Block Definition Editor\n// =============================================================================\n\ninterface BlockDefinitionEditorConfig {\n  apiBasePath: string;\n  block: BlockDefinition | null;\n  categories: string[];\n  onSave: (block: BlockDefinition) => void;\n  onCancel: () => void;\n}\n\nclass BlockDefinitionEditor {\n  private config: BlockDefinitionEditorConfig;\n  private api: ContentTypeAPIClient;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private fields: import('./types').FieldDefinition[] = [];\n  private isNew: boolean;\n\n  constructor(config: BlockDefinitionEditorConfig) {\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    this.isNew = !config.block;\n\n    if (config.block?.schema) {\n      this.fields = schemaToFields(config.block.schema);\n    }\n  }\n\n  show(): void {\n    this.render();\n    this.bindEvents();\n  }\n\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    const block = this.config.block;\n\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-[60] flex items-center justify-center bg-black/50 transition-opacity duration-150 opacity-0';\n\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col overflow-hidden';\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          ${this.isNew ? 'Create Block Definition' : 'Edit Block Definition'}\n        </h2>\n        <button type=\"button\" data-editor-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto px-6 py-4\">\n        <form data-block-form class=\"space-y-6\">\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Name <span class=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                name=\"name\"\n                value=\"${escapeHtml(block?.name ?? '')}\"\n                placeholder=\"Hero Section\"\n                required\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Type <span class=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                name=\"type\"\n                value=\"${escapeHtml(block?.type ?? '')}\"\n                placeholder=\"hero\"\n                pattern=\"^[a-z][a-z0-9_-]*$\"\n                required\n                ${block ? 'readonly' : ''}\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 ${block ? 'bg-gray-50 dark:bg-gray-800 cursor-not-allowed' : ''}\"\n              />\n              <p class=\"mt-1 text-xs text-gray-500\">Unique identifier. Lowercase, numbers, hyphens, underscores.</p>\n            </div>\n          </div>\n\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Description\n            </label>\n            <textarea\n              name=\"description\"\n              rows=\"2\"\n              placeholder=\"A description of this block type\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none\"\n            >${escapeHtml(block?.description ?? '')}</textarea>\n          </div>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Category\n              </label>\n              <select\n                name=\"category\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                ${this.config.categories.map((cat) => `<option value=\"${cat}\" ${block?.category === cat ? 'selected' : ''}>${titleCase(cat)}</option>`).join('')}\n              </select>\n            </div>\n            <div>\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Icon\n              </label>\n              <input\n                type=\"text\"\n                name=\"icon\"\n                value=\"${escapeHtml(block?.icon ?? '')}\"\n                placeholder=\"emoji or text\"\n                maxlength=\"2\"\n                class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          <div class=\"border-t border-gray-200 dark:border-gray-700 pt-4\">\n            <div class=\"flex items-center justify-between mb-4\">\n              <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Block Fields</h3>\n              <button\n                type=\"button\"\n                data-add-field\n                class=\"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n                </svg>\n                Add Field\n              </button>\n            </div>\n            <div data-fields-list class=\"space-y-2\">\n              ${this.renderFieldsList()}\n            </div>\n          </div>\n        </form>\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-editor-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-editor-save\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          ${this.isNew ? 'Create Block' : 'Save Changes'}\n        </button>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private renderFieldsList(): string {\n    if (this.fields.length === 0) {\n      return `\n        <div class=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <p class=\"text-sm\">No fields defined. Click \"Add Field\" to start.</p>\n        </div>\n      `;\n    }\n\n    return this.fields\n      .map(\n        (field, index) => `\n        <div class=\"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/50\" data-field-index=\"${index}\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"text-sm font-medium text-gray-900 dark:text-white\">${escapeHtml(field.label)}</span>\n              <span class=\"text-xs text-gray-500 dark:text-gray-400 font-mono\">${escapeHtml(field.name)}</span>\n              <span class=\"px-2 py-0.5 text-xs rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300\">${field.type}</span>\n              ${field.required ? '<span class=\"text-xs text-red-500\">required</span>' : ''}\n            </div>\n          </div>\n          <button type=\"button\" data-edit-field=\"${index}\" class=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\">\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n            </svg>\n          </button>\n          <button type=\"button\" data-remove-field=\"${index}\" class=\"p-1 text-gray-400 hover:text-red-500\">\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </div>\n      `\n      )\n      .join('');\n  }\n\n  private bindEvents(): void {\n    if (!this.container || !this.backdrop) return;\n\n    this.backdrop.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) {\n        this.config.onCancel();\n        this.hide();\n      }\n    });\n\n    this.container.querySelector('[data-editor-close]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    this.container.querySelector('[data-editor-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    this.container.querySelector('[data-editor-save]')?.addEventListener('click', () => {\n      this.handleSave();\n    });\n\n    this.container.querySelector('[data-add-field]')?.addEventListener('click', () => {\n      this.showFieldTypePicker();\n    });\n\n    // Delegate field events\n    this.container.querySelector('[data-fields-list]')?.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n\n      const editBtn = target.closest('[data-edit-field]');\n      if (editBtn) {\n        const index = parseInt(editBtn.getAttribute('data-edit-field') ?? '-1', 10);\n        if (index >= 0 && this.fields[index]) {\n          this.showFieldConfigForm(this.fields[index], index);\n        }\n        return;\n      }\n\n      const removeBtn = target.closest('[data-remove-field]');\n      if (removeBtn) {\n        const index = parseInt(removeBtn.getAttribute('data-remove-field') ?? '-1', 10);\n        if (index >= 0) {\n          this.fields.splice(index, 1);\n          this.updateFieldsList();\n        }\n        return;\n      }\n    });\n  }\n\n  private showFieldTypePicker(): void {\n    const picker = new FieldTypePicker({\n      onSelect: (fieldType) => {\n        const newField: import('./types').FieldDefinition = {\n          id: generateFieldId(),\n          name: '',\n          type: fieldType,\n          label: '',\n          required: false,\n        };\n        this.showFieldConfigForm(newField, -1);\n      },\n      onCancel: () => {},\n      excludeTypes: ['blocks', 'repeater'], // Blocks can't nest blocks\n    });\n    picker.show();\n  }\n\n  private showFieldConfigForm(field: import('./types').FieldDefinition, index: number): void {\n    const form = new FieldConfigForm({\n      field,\n      existingFieldNames: this.fields.filter((_, i) => i !== index).map((f) => f.name),\n      onSave: (updatedField) => {\n        if (index >= 0) {\n          this.fields[index] = updatedField;\n        } else {\n          this.fields.push(updatedField);\n        }\n        this.updateFieldsList();\n      },\n      onCancel: () => {},\n    });\n    form.show();\n  }\n\n  private updateFieldsList(): void {\n    const listEl = this.container?.querySelector('[data-fields-list]');\n    if (listEl) {\n      listEl.innerHTML = this.renderFieldsList();\n    }\n  }\n\n  private async handleSave(): Promise<void> {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-block-form]');\n    if (!form) return;\n\n    const formData = new FormData(form);\n    const name = (formData.get('name') as string)?.trim();\n    const type = (formData.get('type') as string)?.trim();\n\n    if (!name || !type) {\n      alert('Name and Type are required');\n      return;\n    }\n\n    if (!/^[a-z][a-z0-9_-]*$/.test(type)) {\n      alert('Invalid type format. Use lowercase letters, numbers, hyphens, underscores. Must start with a letter.');\n      return;\n    }\n\n    const schema = fieldsToSchema(this.fields, type);\n\n    const blockData: Partial<BlockDefinition> = {\n      name,\n      type,\n      description: (formData.get('description') as string)?.trim() || undefined,\n      category: (formData.get('category') as string) || 'custom',\n      icon: (formData.get('icon') as string)?.trim() || undefined,\n      schema,\n      status: this.config.block?.status ?? 'draft',\n    };\n\n    try {\n      let savedBlock: BlockDefinition;\n      if (this.isNew) {\n        savedBlock = await this.api.createBlockDefinition(blockData);\n      } else {\n        savedBlock = await this.api.updateBlockDefinition(this.config.block!.id, blockData);\n      }\n      this.config.onSave(savedBlock);\n      this.hide();\n    } catch (err) {\n      alert(err instanceof Error ? err.message : 'Failed to save block');\n    }\n  }\n}\n\n// =============================================================================\n// Block Version History Viewer\n// =============================================================================\n\ninterface BlockVersionHistoryViewerConfig {\n  apiBasePath: string;\n  block: BlockDefinition;\n}\n\nclass BlockVersionHistoryViewer {\n  private config: BlockVersionHistoryViewerConfig;\n  private api: ContentTypeAPIClient;\n  private container: HTMLElement | null = null;\n  private backdrop: HTMLElement | null = null;\n  private versions: BlockSchemaVersion[] = [];\n\n  constructor(config: BlockVersionHistoryViewerConfig) {\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n  }\n\n  async show(): Promise<void> {\n    this.render();\n    this.bindEvents();\n    await this.loadVersions();\n  }\n\n  hide(): void {\n    if (this.backdrop) {\n      this.backdrop.classList.add('opacity-0');\n      setTimeout(() => {\n        this.backdrop?.remove();\n        this.backdrop = null;\n        this.container = null;\n      }, 150);\n    }\n  }\n\n  private render(): void {\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 z-[60] flex items-center justify-center bg-black/50 transition-opacity duration-150 opacity-0';\n\n    this.container = document.createElement('div');\n    this.container.className =\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden';\n\n    this.container.innerHTML = `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Version History</h2>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">${escapeHtml(this.config.block.name)} (${escapeHtml(this.config.block.type)})</p>\n        </div>\n        <button type=\"button\" data-viewer-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto\">\n        <div data-versions-list class=\"p-4\">\n          <div class=\"flex items-center justify-center py-8\">\n            <div class=\"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n  }\n\n  private bindEvents(): void {\n    this.backdrop?.addEventListener('click', (e) => {\n      if (e.target === this.backdrop) this.hide();\n    });\n\n    this.container?.querySelector('[data-viewer-close]')?.addEventListener('click', () => {\n      this.hide();\n    });\n  }\n\n  private async loadVersions(): Promise<void> {\n    try {\n      const result = await this.api.getBlockDefinitionVersions(this.config.block.id);\n      this.versions = result.versions;\n      this.renderVersionsList();\n    } catch {\n      this.renderVersionsList();\n    }\n  }\n\n  private renderVersionsList(): void {\n    const listEl = this.container?.querySelector('[data-versions-list]');\n    if (!listEl) return;\n\n    if (this.versions.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <p class=\"text-sm\">No version history available.</p>\n          <p class=\"text-xs mt-2\">Current version: ${escapeHtml(this.config.block.schema_version ?? '1.0.0')}</p>\n        </div>\n      `;\n      return;\n    }\n\n    listEl.innerHTML = `\n      <div class=\"space-y-3\">\n        ${this.versions\n          .map(\n            (version) => `\n          <div class=\"p-4 border border-gray-200 dark:border-gray-700 rounded-lg\">\n            <div class=\"flex items-center justify-between mb-2\">\n              <div class=\"flex items-center gap-2\">\n                <span class=\"text-sm font-medium text-gray-900 dark:text-white\">v${escapeHtml(version.version)}</span>\n                ${version.is_breaking ? '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Breaking</span>' : ''}\n                ${this.getMigrationBadge(version.migration_status)}\n              </div>\n              <span class=\"text-xs text-gray-500 dark:text-gray-400\">${formatDate(version.created_at)}</span>\n            </div>\n            ${\n              version.migration_status && version.total_count\n                ? `\n              <div class=\"mt-2\">\n                <div class=\"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1\">\n                  <span>Migration Progress</span>\n                  <span>${version.migrated_count ?? 0}/${version.total_count}</span>\n                </div>\n                <div class=\"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n                  <div class=\"h-full bg-blue-600 rounded-full\" style=\"width: ${((version.migrated_count ?? 0) / version.total_count) * 100}%\"></div>\n                </div>\n              </div>\n            `\n                : ''\n            }\n          </div>\n        `\n          )\n          .join('')}\n      </div>\n    `;\n  }\n\n  private getMigrationBadge(status?: string): string {\n    switch (status) {\n      case 'pending':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\">Pending</span>';\n      case 'in_progress':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\">Migrating</span>';\n      case 'completed':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\">Migrated</span>';\n      case 'failed':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Failed</span>';\n      default:\n        return '';\n    }\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction titleCase(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n}\n\nfunction formatDate(dateStr: string): string {\n  try {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' });\n  } catch {\n    return dateStr;\n  }\n}\n\n// =============================================================================\n// Auto-initialization\n// =============================================================================\n\nexport function initBlockLibraryManagers(scope: ParentNode = document): void {\n  const triggers = Array.from(scope.querySelectorAll<HTMLElement>('[data-block-library-trigger]'));\n\n  triggers.forEach((trigger) => {\n    if (trigger.dataset.initialized === 'true') return;\n\n    const config: BlockLibraryManagerConfig = {\n      apiBasePath: trigger.dataset.apiBasePath ?? '/admin',\n      mode: (trigger.dataset.mode as 'manage' | 'picker') ?? 'manage',\n    };\n\n    trigger.addEventListener('click', () => {\n      const manager = new BlockLibraryManager(config);\n      manager.show();\n    });\n\n    trigger.dataset.initialized = 'true';\n  });\n}\n\nfunction onReady(fn: () => void): void {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', fn, { once: true });\n  } else {\n    fn();\n  }\n}\n\nonReady(() => initBlockLibraryManagers());\n","/**\n * Content Type Builder Module\n *\n * A visual UI for creating and editing content types with drag-and-drop field ordering,\n * field type picker, configuration forms, and live schema preview.\n */\n\n// Re-export types\nexport type {\n  ContentType,\n  ContentTypeStatus,\n  ContentTypeCapabilities,\n  JSONSchema,\n  JSONSchemaType,\n  FormgenExtension,\n  AdminExtension,\n  UISchemaOverlay,\n  UILayoutConfig,\n  UITab,\n  UIOverride,\n  ConditionalField,\n  FieldDefinition,\n  FieldType,\n  FieldValidation,\n  FieldTypeConfig,\n  FieldTypeMetadata,\n  FieldTypeCategory,\n  // Advanced field configs\n  TextFieldConfig,\n  NumberFieldConfig,\n  SelectFieldConfig,\n  MediaFieldConfig,\n  ReferenceFieldConfig,\n  RepeaterFieldConfig,\n  BlocksFieldConfig,\n  CodeFieldConfig,\n  SlugFieldConfig,\n  ColorFieldConfig,\n  LocationFieldConfig,\n  DateRangeFieldConfig,\n  // Block definition types\n  BlockDefinition,\n  BlockDefinitionStatus,\n  BlockDefinitionListResponse,\n  BlockDefinitionSummary,\n  BlockLibraryManagerConfig,\n  BlockLibraryManagerState,\n  BlockSchemaVersion,\n  // Content type versioning types\n  ContentTypeSchemaVersion,\n  SchemaChange,\n  CompatibilityCheckResult,\n  // API types\n  ContentTypeListResponse,\n  SchemaValidationRequest,\n  SchemaValidationResponse,\n  SchemaPreviewRequest,\n  SchemaPreviewResponse,\n  ContentTypeBuilderState,\n  ContentTypeEditorConfig,\n  FieldTypePickerConfig,\n  FieldConfigFormConfig,\n  SchemaPreviewConfig,\n  ContentTypeBuilderEvent,\n} from './types';\n\n// Re-export API client\nexport { ContentTypeAPIClient, ContentTypeAPIError, fieldsToSchema, schemaToFields, generateFieldId } from './api-client';\n\n// Re-export field type picker\nexport { FieldTypePicker, FIELD_TYPES, FIELD_CATEGORIES, getFieldTypeMetadata, getFieldTypesByCategory } from './field-type-picker';\n\n// Re-export field config form\nexport { FieldConfigForm } from './field-config-form';\n\n// Re-export layout editor\nexport { LayoutEditor } from './layout-editor';\nexport type { LayoutEditorConfig } from './layout-editor';\n\n// Re-export main editor\nexport { ContentTypeEditor } from './content-type-editor';\n\n// Re-export block library manager\nexport { BlockLibraryManager, initBlockLibraryManagers } from './block-library-manager';\n\n// =============================================================================\n// Auto-initialization\n// =============================================================================\n\nimport { ContentTypeEditor } from './content-type-editor';\n\n/**\n * Initialize content type editors on elements matching [data-content-type-editor]\n */\nexport function initContentTypeEditors(scope: ParentNode = document): void {\n  const roots = Array.from(scope.querySelectorAll<HTMLElement>('[data-content-type-editor-root]'));\n\n  roots.forEach((root) => {\n    // Skip if already initialized\n    if (root.dataset.initialized === 'true') return;\n\n    const config = parseConfig(root);\n    if (!config.apiBasePath) {\n      console.warn('Content type editor missing apiBasePath', root);\n      return;\n    }\n\n    const editor = new ContentTypeEditor(root, config);\n    editor.init();\n\n    root.dataset.initialized = 'true';\n  });\n}\n\nfunction parseConfig(root: HTMLElement): {\n  apiBasePath: string;\n  contentTypeId?: string;\n  locale?: string;\n} {\n  const configAttr = root.getAttribute('data-content-type-editor-config');\n  if (configAttr) {\n    try {\n      return JSON.parse(configAttr);\n    } catch {\n      // Fall through to data attributes\n    }\n  }\n\n  return {\n    apiBasePath: root.dataset.apiBasePath ?? '/admin',\n    contentTypeId: root.dataset.contentTypeId,\n    locale: root.dataset.locale,\n  };\n}\n\nfunction onReady(fn: () => void): void {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', fn, { once: true });\n  } else {\n    fn();\n  }\n}\n\n// Auto-initialize on DOM ready\nonReady(() => initContentTypeEditors());\n"],"names":["ContentTypeAPIError","message","status","textCode","fields","ContentTypeAPIClient","config","params","queryParams","query","url","data","idOrSlug","contentType","force","newSlug","newName","newSchema","newUiSchema","request","idOrType","block","newType","options","headers","response","errorData","fieldsToSchema","slug","properties","required","field","fieldToSchemaProperty","schema","mapping","formgen","widget","fieldTypeToWidget","opt","blocksConfig","itemsSchema","blockType","blocksFormgen","fieldType","schemaToFields","name","propSchema","schemaPropertyToField","a","b","isRequired","generateFieldId","schemaToFieldType","titleCase","validation","value","allowedTypes","subSchema","t","widgetToType","str","word","FIELD_TYPES","FIELD_CATEGORIES","getFieldTypeMetadata","type","ft","getFieldTypesByCategory","category","FieldTypePicker","cat","excludeSet","types","e","btn","searchInput","target","categoriesContainer","listContainer","FieldConfigForm","firstInput","fieldMeta","escapeHtml","showStringValidation","showNumberValidation","sections","allowedBlocksJson","deniedBlocksJson","nameInput","labelInput","labelToFieldName","optionsList","index","row","listType","hiddenInput","currentBlocks","BlockPickerModal","blocks","chipsContainer","emptyText","chipColor","updatedBlocks","form","formData","existingNames","originalName","label","updatedField","minLength","maxLength","min","max","pattern","i","displayField","accept","maxSize","multiple","language","lineNumbers","sourceField","prefix","suffix","separator","format","allowAlpha","presetsStr","presets","defaultLat","defaultLng","defaultZoom","minDate","maxDate","allowSameDay","minItems","maxItems","collapsed","minBlocks","maxBlocks","allowedStr","deniedStr","allowedBlocks","deniedBlocks","parsed","s","fieldName","input","errorEl","clearError","div","loadingEl","listEl","emptyEl","isSelected","checkbox","countEl","count","LayoutEditor","tabs","itemName","tab","fieldsBySection","section","f","tabId","tabsList","targetIndex","el","newTab","newIndex","currentIndex","idInput","iconInput","content","ids","ContentTypeEditor","container","error","saved","metadata","fieldId","result","ct","statusBadge","layoutType","layoutLabel","fieldErrors","err","hasErrors","constraints","c","caps","compatResult","PublishConfirmationModal","published","deprecated","CloneContentTypeModal","cloned","ContentTypeVersionHistoryViewer","editBtn","removeBtn","fieldCard","slugInput","nameToSlug","fieldList","evt","card","rect","midY","insertBefore","indicator","startIndex","adjustedIndex","menuContainer","trigger","dropdown","layout","fieldsSection","newFieldsSection","key","uiSchema","tabsById","overrides","override","saveBtn","previewBtn","fieldListContainer","previewContainer","errorsContainer","errorsByField","generalErrors","fieldMatch","errors","toastFn","formatDate","dateStr","compatibilityResult","hasBreakingChanges","hasWarnings","affectedCount","change","confirmBtn","forceCheckbox","suggestedSlug","suggestedName","version","versionId","isCurrent","isExpanded","hasChanges","typeColors","typeIcons","BlockLibraryManager","isManageMode","title","filterInput","categoryFilter","blockCard","blockId","select","option","filteredBlocks","groupedBlocks","html","isAllowed","searchLower","BlockDefinitionEditor","savedBlock","BlockVersionHistoryViewer","textEl","newField","_","blockData","initBlockLibraryManagers","scope","onReady","fn","initContentTypeEditors","root","parseConfig","configAttr"],"mappings":"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"}