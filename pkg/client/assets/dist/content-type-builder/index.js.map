{"version":3,"file":"index.js","sources":["../../src/content-type-builder/api-client.ts","../../src/content-type-builder/field-type-picker.ts","../../src/content-type-builder/shared/field-input-classes.ts","../../src/content-type-builder/shared/icon-picker-data.ts","../../src/content-type-builder/shared/icon-picker.ts","../../src/content-type-builder/shared/block-picker.ts","../../src/content-type-builder/shared/api-paths.ts","../../src/content-type-builder/field-config-form.ts","../../src/content-type-builder/layout-editor.ts","../../src/content-type-builder/block-field-type-registry.ts","../../src/content-type-builder/shared/field-type-registry.ts","../../src/content-type-builder/field-palette-panel.ts","../../src/content-type-builder/shared/entity-header.ts","../../src/content-type-builder/shared/field-card.ts","../../src/content-type-builder/content-type-editor.ts","../../src/content-type-builder/block-library-manager.ts","../../src/content-type-builder/block-editor-panel.ts","../../src/content-type-builder/block-library-ide.ts","../../src/content-type-builder/index.ts"],"sourcesContent":["/**\n * Content Type API Client\n *\n * Handles all API communication for content type management.\n */\n\nimport type {\n  ContentType,\n  ContentTypeListResponse,\n  SchemaValidationRequest,\n  SchemaValidationResponse,\n  SchemaPreviewRequest,\n  SchemaPreviewResponse,\n  APIErrorResponse,\n  JSONSchema,\n  UISchemaOverlay,\n  BlockDefinition,\n  BlockDefinitionListResponse,\n  BlockDefinitionSummary,\n  BlockDefinitionsDiagnostics,\n  BlockSchemaVersion,\n  ContentTypeSchemaVersion,\n  CompatibilityCheckResult,\n  FieldTypeMetadata,\n} from './types';\nimport type { BackendFieldTypeCategoryGroup } from './block-field-type-registry';\nimport { extractErrorMessage } from '../toast/error-helpers';\n\nexport interface ContentTypeAPIConfig {\n  basePath: string;\n  headers?: Record<string, string>;\n  credentials?: RequestCredentials;\n}\n\nexport class ContentTypeAPIError extends Error {\n  readonly status: number;\n  readonly textCode?: string;\n  readonly fields?: Record<string, string>;\n\n  constructor(message: string, status: number, textCode?: string, fields?: Record<string, string>) {\n    super(message);\n    this.name = 'ContentTypeAPIError';\n    this.status = status;\n    this.textCode = textCode;\n    this.fields = fields;\n  }\n}\n\nexport class ContentTypeAPIClient {\n  private config: ContentTypeAPIConfig;\n  private environment: string = '';\n\n  constructor(config: ContentTypeAPIConfig) {\n    let basePath = config.basePath.replace(/\\/+$/, '');\n    if (basePath && !/\\/api(\\/|$)/.test(basePath)) {\n      basePath = `${basePath}/api`;\n    }\n    this.config = {\n      basePath,\n      headers: config.headers ?? {},\n      credentials: config.credentials ?? 'same-origin',\n    };\n  }\n\n  /** Set the active environment for all subsequent API requests (Phase 12 — Task 12.3) */\n  setEnvironment(env: string): void {\n    this.environment = env;\n  }\n\n  /** Get the current environment */\n  getEnvironment(): string {\n    return this.environment;\n  }\n\n  /** Get the configured base path */\n  getBasePath(): string {\n    return this.config.basePath;\n  }\n\n  /** Persist environment selection to the server session (Phase 12) */\n  async setEnvironmentSession(env: string): Promise<void> {\n    const url = `${this.config.basePath}/session/environment`;\n    await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ environment: env }),\n    });\n  }\n\n  private contentTypesPanelBasePath(): string {\n    return `${this.config.basePath}/panels/content_types`;\n  }\n\n  // ===========================================================================\n  // Content Type CRUD\n  // ===========================================================================\n\n  /**\n   * List all content types\n   */\n  async list(params?: { page?: number; per_page?: number; search?: string }): Promise<ContentTypeListResponse> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.search) queryParams.set('search', params.search);\n\n    const query = queryParams.toString();\n    const url = `${this.contentTypesPanelBasePath()}${query ? `?${query}` : ''}`;\n\n    const response = await this.fetch(url, { method: 'GET' });\n    const data = await response.json();\n\n    // Handle both array and paginated response formats\n    if (Array.isArray(data)) {\n      return { items: data, total: data.length };\n    }\n    if (data.items && Array.isArray(data.items)) {\n      return data as ContentTypeListResponse;\n    }\n    if (data.data && Array.isArray(data.data)) {\n      return { items: data.data, total: data.total ?? data.data.length };\n    }\n\n    return { items: [], total: 0 };\n  }\n\n  /**\n   * Get a single content type by ID or slug\n   */\n  async get(idOrSlug: string): Promise<ContentType> {\n    const url = `${this.contentTypesPanelBasePath()}/${encodeURIComponent(idOrSlug)}`;\n    const response = await this.fetch(url, { method: 'GET' });\n    const data = await response.json();\n\n    // Handle wrapped and unwrapped response formats\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Create a new content type\n   */\n  async create(contentType: Partial<ContentType>): Promise<ContentType> {\n    const url = this.contentTypesPanelBasePath();\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(contentType),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Update an existing content type\n   */\n  async update(idOrSlug: string, contentType: Partial<ContentType>): Promise<ContentType> {\n    const url = `${this.contentTypesPanelBasePath()}/${encodeURIComponent(idOrSlug)}`;\n    const response = await this.fetch(url, {\n      method: 'PUT',\n      body: JSON.stringify(contentType),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Delete a content type\n   */\n  async delete(idOrSlug: string): Promise<void> {\n    const url = `${this.contentTypesPanelBasePath()}/${encodeURIComponent(idOrSlug)}`;\n    await this.fetch(url, { method: 'DELETE' });\n  }\n\n  // ===========================================================================\n  // Content Type Lifecycle (Publish, Clone, Deprecate)\n  // ===========================================================================\n\n  /**\n   * Publish a content type (change status to active)\n   */\n  async publish(idOrSlug: string, force?: boolean): Promise<ContentType> {\n    const url = `${this.config.basePath}/content_types/${encodeURIComponent(idOrSlug)}/publish`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ force: force ?? false }),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Deprecate a content type\n   */\n  async deprecate(idOrSlug: string): Promise<ContentType> {\n    const url = `${this.config.basePath}/content_types/${encodeURIComponent(idOrSlug)}/deprecate`;\n    const response = await this.fetch(url, { method: 'POST' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Clone a content type\n   */\n  async clone(idOrSlug: string, newSlug: string, newName?: string): Promise<ContentType> {\n    const url = `${this.config.basePath}/content_types/${encodeURIComponent(idOrSlug)}/clone`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ slug: newSlug, name: newName }),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Check compatibility between current schema and a new schema\n   */\n  async checkCompatibility(\n    idOrSlug: string,\n    newSchema: JSONSchema,\n    newUiSchema?: UISchemaOverlay\n  ): Promise<CompatibilityCheckResult> {\n    const url = `${this.config.basePath}/content_types/${encodeURIComponent(idOrSlug)}/compatibility`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ schema: newSchema, ui_schema: newUiSchema }),\n    });\n    return await response.json();\n  }\n\n  /**\n   * Get content type schema version history\n   */\n  async getVersionHistory(idOrSlug: string): Promise<{ versions: ContentTypeSchemaVersion[] }> {\n    const url = `${this.config.basePath}/content_types/${encodeURIComponent(idOrSlug)}/versions`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      return { versions: data.versions ?? data.items ?? data ?? [] };\n    } catch {\n      return { versions: [] };\n    }\n  }\n\n  // ===========================================================================\n  // Schema Validation & Preview\n  // ===========================================================================\n\n  /**\n   * Validate a JSON schema\n   */\n  async validateSchema(request: SchemaValidationRequest): Promise<SchemaValidationResponse> {\n    const url = `${this.config.basePath}/content_types/validate`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(request),\n    });\n    const data = await response.json();\n    return data;\n  }\n\n  /**\n   * Generate a preview of the schema as a rendered form\n   */\n  async previewSchema(request: SchemaPreviewRequest): Promise<SchemaPreviewResponse> {\n    const url = `${this.config.basePath}/content_types/preview`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(request),\n    });\n    const data = await response.json();\n    return data;\n  }\n\n  // ===========================================================================\n  // Block Definitions (for blocks field configuration)\n  // ===========================================================================\n\n  private blockDefinitionsPanelBasePath(): string {\n    return `${this.config.basePath}/panels/block_definitions`;\n  }\n\n  /**\n   * List available block definitions (summary)\n   */\n  async listBlockDefinitionsSummary(): Promise<BlockDefinitionSummary[]> {\n    const response = await this.fetch(this.blockDefinitionsPanelBasePath(), { method: 'GET' });\n    const data = await response.json();\n    if (Array.isArray(data)) return data;\n    if (data.items && Array.isArray(data.items)) return data.items;\n    if (data.data && Array.isArray(data.data)) return data.data;\n    return [];\n  }\n\n  /**\n   * List block definitions with full details\n   */\n  async listBlockDefinitions(params?: {\n    page?: number;\n    per_page?: number;\n    search?: string;\n    category?: string;\n    status?: string;\n  }): Promise<BlockDefinitionListResponse> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.search) queryParams.set('search', params.search);\n    if (params?.category) queryParams.set('filter_category', params.category);\n    if (params?.status) queryParams.set('filter_status', params.status);\n\n    const query = queryParams.toString();\n    const url = `${this.blockDefinitionsPanelBasePath()}${query ? `?${query}` : ''}`;\n    const response = await this.fetch(url, { method: 'GET' });\n    const data = await response.json();\n\n    if (Array.isArray(data)) {\n      return { items: data, total: data.length };\n    }\n    if (data.items && Array.isArray(data.items)) {\n      return data as BlockDefinitionListResponse;\n    }\n    if (data.data && Array.isArray(data.data)) {\n      return { items: data.data, total: data.total ?? data.data.length };\n    }\n\n    return { items: [], total: 0 };\n  }\n\n  /**\n   * Get a single block definition by ID or type\n   */\n  async getBlockDefinition(idOrType: string): Promise<BlockDefinition> {\n    const url = `${this.blockDefinitionsPanelBasePath()}/${encodeURIComponent(idOrType)}`;\n    const response = await this.fetch(url, { method: 'GET' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Create a new block definition\n   */\n  async createBlockDefinition(block: Partial<BlockDefinition>): Promise<BlockDefinition> {\n    const url = this.blockDefinitionsPanelBasePath();\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify(block),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Update an existing block definition\n   */\n  async updateBlockDefinition(idOrType: string, block: Partial<BlockDefinition>): Promise<BlockDefinition> {\n    const url = `${this.blockDefinitionsPanelBasePath()}/${encodeURIComponent(idOrType)}`;\n    const response = await this.fetch(url, {\n      method: 'PUT',\n      body: JSON.stringify(block),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Delete a block definition\n   */\n  async deleteBlockDefinition(idOrType: string): Promise<void> {\n    const url = `${this.blockDefinitionsPanelBasePath()}/${encodeURIComponent(idOrType)}`;\n    await this.fetch(url, { method: 'DELETE' });\n  }\n\n  /**\n   * Publish a block definition (change status to active)\n   */\n  async publishBlockDefinition(idOrType: string): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/block_definitions/${encodeURIComponent(idOrType)}/publish`;\n    const response = await this.fetch(url, { method: 'POST' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Deprecate a block definition\n   */\n  async deprecateBlockDefinition(idOrType: string): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/block_definitions/${encodeURIComponent(idOrType)}/deprecate`;\n    const response = await this.fetch(url, { method: 'POST' });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Clone a block definition\n   */\n  async cloneBlockDefinition(idOrType: string, newType: string, newSlug?: string): Promise<BlockDefinition> {\n    const url = `${this.config.basePath}/block_definitions/${encodeURIComponent(idOrType)}/clone`;\n    const response = await this.fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({ type: newType, slug: newSlug }),\n    });\n    const data = await response.json();\n    return data.item ?? data.data ?? data;\n  }\n\n  /**\n   * Get block definition schema version history\n   */\n  async getBlockDefinitionVersions(idOrType: string): Promise<{ versions: BlockSchemaVersion[] }> {\n    const url = `${this.config.basePath}/block_definitions/${encodeURIComponent(idOrType)}/versions`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      return { versions: data.versions ?? data.items ?? data ?? [] };\n    } catch {\n      return { versions: [] };\n    }\n  }\n\n  /**\n   * Get block categories\n   */\n  async getBlockCategories(): Promise<string[]> {\n    const url = `${this.config.basePath}/block_definitions_meta/categories`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      return Array.isArray(data) ? data : data.categories ?? [];\n    } catch {\n      return ['content', 'media', 'layout', 'interactive', 'custom'];\n    }\n  }\n\n  /**\n   * Fetch block library diagnostics metadata (effective environment + counts).\n   * Returns null when the endpoint is unavailable.\n   */\n  async getBlockDefinitionDiagnostics(): Promise<BlockDefinitionsDiagnostics | null> {\n    return await this.fetchBlockDefinitionDiagnostics(`${this.config.basePath}/block_definitions_meta/diagnostics`);\n  }\n\n  private async fetchBlockDefinitionDiagnostics(url: string): Promise<BlockDefinitionsDiagnostics | null> {\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      if (!data || typeof data !== 'object') {\n        return null;\n      }\n      const diagnostics = data as Partial<BlockDefinitionsDiagnostics>;\n      if (typeof diagnostics.effective_environment !== 'string') {\n        return null;\n      }\n      return {\n        effective_environment: diagnostics.effective_environment,\n        requested_environment: diagnostics.requested_environment,\n        total_effective: Number.isFinite(diagnostics.total_effective) ? Number(diagnostics.total_effective) : 0,\n        total_default: Number.isFinite(diagnostics.total_default) ? Number(diagnostics.total_default) : 0,\n        available_environments: Array.isArray(diagnostics.available_environments)\n          ? diagnostics.available_environments.map((env) => String(env)).filter((env) => env.length > 0)\n          : [],\n      };\n    } catch {\n      return null;\n    }\n  }\n\n  // ===========================================================================\n  // Field Types Registry (Phase 9)\n  // ===========================================================================\n\n  /**\n   * Fetch field types from the backend registry.\n   * Falls back to null if the endpoint is not available (Phase 3 not deployed).\n   */\n  async getFieldTypes(): Promise<FieldTypeMetadata[] | null> {\n    const url = `${this.config.basePath}/block_definitions_meta/field_types`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      if (Array.isArray(data)) return data;\n      if (data.items && Array.isArray(data.items)) return data.items;\n      if (data.field_types && Array.isArray(data.field_types)) return data.field_types;\n      return null;\n    } catch {\n      // Endpoint may not exist yet (Phase 3); caller should fall back to local registry\n      return null;\n    }\n  }\n\n  /**\n   * Fetch grouped field types from the backend registry.\n   * Returns null when the endpoint does not expose grouped categories.\n   */\n  async getBlockFieldTypeGroups(): Promise<BackendFieldTypeCategoryGroup[] | null> {\n    const url = `${this.config.basePath}/block_definitions_meta/field_types`;\n    try {\n      const response = await this.fetch(url, { method: 'GET' });\n      const data = await response.json();\n      if (data && Array.isArray(data.categories)) {\n        return data.categories as BackendFieldTypeCategoryGroup[];\n      }\n      return null;\n    } catch {\n      return null;\n    }\n  }\n\n  // ===========================================================================\n  // Helpers\n  // ===========================================================================\n\n  private async fetch(url: string, options: RequestInit): Promise<Response> {\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n      Accept: 'application/json',\n      ...this.config.headers,\n    };\n\n    // Include environment context (Phase 12 — Task 12.3)\n    if (this.environment) {\n      headers['X-Admin-Environment'] = this.environment;\n      const separator = url.includes('?') ? '&' : '?';\n      url = `${url}${separator}env=${encodeURIComponent(this.environment)}`;\n    }\n\n    const response = await fetch(url, {\n      ...options,\n      headers,\n      credentials: this.config.credentials,\n    });\n\n    if (!response.ok) {\n      await this.handleError(response);\n    }\n\n    return response;\n  }\n\n  private async handleError(response: Response): Promise<never> {\n    let errorData: APIErrorResponse | null = null;\n\n    try {\n      errorData = await response.clone().json();\n    } catch {\n      // Response may not be JSON\n    }\n\n    const message = await extractErrorMessage(response);\n    let textCode: string | undefined = errorData?.text_code;\n    let fields: Record<string, string> | undefined = errorData?.fields;\n\n    if (errorData && typeof errorData.error === 'object' && errorData.error) {\n      const errObj = errorData.error as Record<string, unknown>;\n      if (!textCode && typeof errObj.text_code === 'string') {\n        textCode = errObj.text_code;\n      }\n      if (!fields) {\n        const meta = errObj.metadata as Record<string, unknown> | undefined;\n        const metaFields = meta?.fields as Record<string, string> | undefined;\n        if (metaFields && typeof metaFields === 'object') {\n          fields = metaFields;\n        }\n      }\n      if (!fields && Array.isArray(errObj.validation_errors)) {\n        const out: Record<string, string> = {};\n        for (const entry of errObj.validation_errors as Array<Record<string, unknown>>) {\n          const field = typeof entry.field === 'string' ? entry.field : '';\n          const msg = typeof entry.message === 'string' ? entry.message : '';\n          if (field && msg) {\n            out[field] = msg;\n          }\n        }\n        if (Object.keys(out).length > 0) {\n          fields = out;\n        }\n      }\n    }\n\n    throw new ContentTypeAPIError(message, response.status, textCode, fields);\n  }\n}\n\n// ===========================================================================\n// Schema Conversion Utilities\n// ===========================================================================\n\nimport type { AdminExtension, BlocksFieldConfig, FieldDefinition, FieldType, FormgenExtension } from './types';\n\nfunction cloneSchema<T>(value: T): T {\n  return JSON.parse(JSON.stringify(value)) as T;\n}\n\nfunction mergeSchemaSection(base: Record<string, unknown>, next: Record<string, unknown>): Record<string, unknown> {\n  return { ...base, ...next };\n}\n\nfunction normalizeBlockTypeList(values: string[] | undefined): string[] {\n  if (!values || values.length === 0) {\n    return [];\n  }\n  const seen = new Set<string>();\n  const out: string[] = [];\n  for (const value of values) {\n    const trimmed = String(value ?? '').trim();\n    if (!trimmed || seen.has(trimmed)) {\n      continue;\n    }\n    seen.add(trimmed);\n    out.push(trimmed);\n  }\n  return out;\n}\n\nfunction blockTypeListsEqual(a: string[] | undefined, b: string[] | undefined): boolean {\n  const left = normalizeBlockTypeList(a);\n  const right = normalizeBlockTypeList(b);\n  if (left.length !== right.length) {\n    return false;\n  }\n  const rightSet = new Set(right);\n  return left.every((item) => rightSet.has(item));\n}\n\nfunction extractBlockTypeFromRef(ref: unknown): { type?: string; prefix?: string } {\n  if (typeof ref !== 'string') {\n    return {};\n  }\n  const trimmed = ref.trim();\n  if (!trimmed) {\n    return {};\n  }\n  const idx = trimmed.lastIndexOf('/');\n  if (idx === -1 || idx === trimmed.length - 1) {\n    return { type: trimmed };\n  }\n  return {\n    type: trimmed.slice(idx + 1),\n    prefix: trimmed.slice(0, idx + 1),\n  };\n}\n\nfunction extractAllowedBlocksFromOneOf(\n  oneOf: unknown\n): { allowed: string[]; mode: 'refs' | 'inline'; refPrefix?: string } | null {\n  if (!Array.isArray(oneOf) || oneOf.length === 0) {\n    return null;\n  }\n\n  const refs: string[] = [];\n  let refPrefix: string | undefined;\n  for (const entry of oneOf) {\n    if (!entry || typeof entry !== 'object') {\n      continue;\n    }\n    const record = entry as Record<string, unknown>;\n    const refInfo = extractBlockTypeFromRef(record.$ref);\n    if (!refInfo.type) {\n      continue;\n    }\n    refs.push(refInfo.type);\n    if (!refPrefix && refInfo.prefix) {\n      refPrefix = refInfo.prefix;\n    }\n  }\n  if (refs.length > 0) {\n    return { allowed: normalizeBlockTypeList(refs), mode: 'refs', refPrefix };\n  }\n\n  const inline = oneOf\n    .map((subSchema) => {\n      const typeSchema = subSchema as JSONSchema;\n      const typeProp = typeSchema?.properties?._type as JSONSchema | undefined;\n      return typeof typeProp?.const === 'string' ? typeProp.const : undefined;\n    })\n    .filter((t): t is string => !!t);\n  if (inline.length > 0) {\n    return { allowed: normalizeBlockTypeList(inline), mode: 'inline' };\n  }\n\n  return null;\n}\n\nfunction buildInlineBlocksItemsSchema(allowedBlocks: string[] | undefined): JSONSchema {\n  const itemsSchema: JSONSchema = {\n    type: 'object',\n    properties: {\n      _type: {\n        type: 'string',\n        description: 'Block type discriminator',\n      },\n      _schema: {\n        type: 'string',\n        description: 'Block schema version',\n      },\n    },\n    required: ['_type'],\n  };\n\n  if (allowedBlocks && allowedBlocks.length > 0) {\n    itemsSchema.oneOf = allowedBlocks.map((blockType) => ({\n      type: 'object' as const,\n      properties: {\n        _type: { const: blockType },\n      },\n      required: ['_type'],\n    }));\n    itemsSchema['x-discriminator'] = '_type';\n  }\n\n  return itemsSchema;\n}\n\nfunction buildRefBlocksItemsSchema(allowedBlocks: string[], prefix?: string): JSONSchema {\n  const refPrefix = typeof prefix === 'string' && prefix.trim() ? prefix : '#/$defs/';\n  return {\n    oneOf: allowedBlocks.map((blockType) => ({\n      $ref: `${refPrefix}${blockType}`,\n    })),\n  };\n}\n\nexport function mergeSchemaWithBase(base: JSONSchema | null | undefined, next: JSONSchema): JSONSchema {\n  if (!base) {\n    return cloneSchema(next);\n  }\n  const merged = cloneSchema(next);\n  const baseDefs = (base.$defs ?? {}) as Record<string, unknown>;\n  const nextDefs = (merged.$defs ?? {}) as Record<string, unknown>;\n  if (Object.keys(baseDefs).length > 0 || Object.keys(nextDefs).length > 0) {\n    merged.$defs = mergeSchemaSection(baseDefs, nextDefs) as JSONSchema['$defs'];\n  }\n  const baseMeta = (base as Record<string, unknown>).metadata as Record<string, unknown> | undefined;\n  const nextMeta = (merged as Record<string, unknown>).metadata as Record<string, unknown> | undefined;\n  if (baseMeta || nextMeta) {\n    (merged as Record<string, unknown>).metadata = mergeSchemaSection(baseMeta ?? {}, nextMeta ?? {});\n  }\n  return merged;\n}\n\n/**\n * Convert field definitions to JSON Schema\n */\nexport function fieldsToSchema(fields: FieldDefinition[], slug?: string): JSONSchema {\n  const properties: Record<string, JSONSchema> = {};\n  const required: string[] = [];\n\n  for (const field of fields) {\n    properties[field.name] = fieldToSchemaProperty(field);\n    if (field.required) {\n      required.push(field.name);\n    }\n  }\n\n  const schema: JSONSchema = {\n    $schema: 'https://json-schema.org/draft/2020-12/schema',\n    type: 'object',\n    properties,\n  };\n\n  if (slug) {\n    schema.$id = slug;\n  }\n\n  if (required.length > 0) {\n    schema.required = required;\n  }\n\n  return schema;\n}\n\n/**\n * Convert field definitions to a block definition schema\n */\nexport function fieldsToBlockSchema(fields: FieldDefinition[], slug?: string): JSONSchema {\n  const schema = fieldsToSchema(fields, slug);\n  if (!slug) {\n    return schema;\n  }\n\n  schema.properties = schema.properties ?? {};\n  schema.properties._type = { type: 'string', const: slug };\n\n  const required = new Set(schema.required ?? []);\n  required.add('_type');\n  schema.required = Array.from(required);\n\n  return schema;\n}\n\n/**\n * Convert a single field to a JSON Schema property\n */\nfunction fieldToSchemaProperty(field: FieldDefinition): JSONSchema {\n  const schema: JSONSchema = {};\n\n  // Base type mapping\n  const typeMapping: Record<FieldType, { type: JSONSchema['type']; format?: string }> = {\n    text: { type: 'string' },\n    textarea: { type: 'string' },\n    'rich-text': { type: 'string' },\n    markdown: { type: 'string' },\n    code: { type: 'string' },\n    number: { type: 'number' },\n    integer: { type: 'integer' },\n    currency: { type: 'number' },\n    percentage: { type: 'number' },\n    select: { type: 'string' },\n    radio: { type: 'string' },\n    checkbox: { type: 'boolean' },\n    chips: { type: 'array' },\n    toggle: { type: 'boolean' },\n    date: { type: 'string', format: 'date' },\n    time: { type: 'string', format: 'time' },\n    datetime: { type: 'string', format: 'date-time' },\n    daterange: { type: 'object' },\n    'media-picker': { type: 'string', format: 'uri' },\n    'media-gallery': { type: 'array' },\n    'file-upload': { type: 'string', format: 'uri' },\n    reference: { type: 'string', format: 'uuid' },\n    references: { type: 'array' },\n    user: { type: 'string', format: 'uuid' },\n    group: { type: 'object' },\n    repeater: { type: 'array' },\n    blocks: { type: 'array' },\n    json: { type: 'object' },\n    slug: { type: 'string' },\n    color: { type: 'string' },\n    location: { type: 'object' },\n  };\n\n  const mapping = typeMapping[field.type] ?? { type: 'string' };\n  schema.type = mapping.type;\n  if (mapping.format) {\n    schema.format = mapping.format;\n  }\n\n  // Title and description\n  if (field.label) {\n    schema.title = field.label;\n  }\n  if (field.description) {\n    schema.description = field.description;\n  }\n\n  // Default value\n  if (field.defaultValue !== undefined) {\n    schema.default = field.defaultValue;\n  }\n\n  // Validation constraints\n  if (field.validation) {\n    if (field.validation.minLength !== undefined) {\n      schema.minLength = field.validation.minLength;\n    }\n    if (field.validation.maxLength !== undefined) {\n      schema.maxLength = field.validation.maxLength;\n    }\n    if (field.validation.min !== undefined) {\n      schema.minimum = field.validation.min;\n    }\n    if (field.validation.max !== undefined) {\n      schema.maximum = field.validation.max;\n    }\n    if (field.validation.pattern) {\n      schema.pattern = field.validation.pattern;\n    }\n  }\n\n  // x-formgen extension\n  const formgen: Record<string, unknown> = {};\n  const widget = fieldTypeToWidget(field.type);\n  if (widget) {\n    formgen.widget = widget;\n  }\n  if (field.placeholder) {\n    formgen.placeholder = field.placeholder;\n  }\n  if (field.helpText) {\n    formgen.helpText = field.helpText;\n  }\n  if (field.section) {\n    formgen.section = field.section;\n  }\n  if (field.order !== undefined) {\n    formgen.order = field.order;\n  }\n  if (field.gridSpan !== undefined) {\n    formgen.grid = { span: field.gridSpan };\n  }\n  if (field.readonly) {\n    formgen.readonly = true;\n  }\n  if (field.hidden) {\n    formgen.hidden = true;\n  }\n  if (field.filterable) {\n    formgen.filterable = true;\n  }\n\n  if (Object.keys(formgen).length > 0) {\n    schema['x-formgen'] = formgen as FormgenExtension;\n  }\n\n  if (field.filterable) {\n    schema['x-admin'] = { filterable: true } as AdminExtension;\n  }\n\n  // Type-specific handling\n  switch (field.type) {\n    case 'select':\n    case 'radio':\n      if (field.config && 'options' in field.config && field.config.options) {\n        schema.enum = field.config.options.map((opt) => opt.value);\n      }\n      break;\n\n    case 'chips':\n      schema.items = { type: 'string' };\n      if (field.config && 'options' in field.config && field.config.options) {\n        schema.items.enum = field.config.options.map((opt) => opt.value);\n      }\n      break;\n\n    case 'media-gallery':\n    case 'references':\n      schema.items = { type: 'string', format: 'uri' };\n      break;\n\n    case 'repeater':\n      if (field.config && 'fields' in field.config && field.config.fields) {\n        schema.items = fieldsToSchema(field.config.fields);\n      } else {\n        schema.items = { type: 'string' };\n      }\n      break;\n\n    case 'blocks': {\n      const blocksConfig = field.config as BlocksFieldConfig | undefined;\n      const allowedBlocks = normalizeBlockTypeList(blocksConfig?.allowedBlocks);\n      const deniedBlocks = normalizeBlockTypeList(blocksConfig?.deniedBlocks);\n      const sourceAllowed = normalizeBlockTypeList(blocksConfig?.__sourceAllowedBlocks);\n      const sourceDenied = normalizeBlockTypeList(blocksConfig?.__sourceDeniedBlocks);\n      const hasAllowedOverride = allowedBlocks.length > 0;\n      const hasDeniedOverride = deniedBlocks.length > 0;\n      const allowedChanged = !blockTypeListsEqual(allowedBlocks, sourceAllowed);\n      const deniedChanged = !blockTypeListsEqual(deniedBlocks, sourceDenied);\n\n      const sourceItems = blocksConfig?.__sourceItemsSchema;\n      const sourceMode = blocksConfig?.__sourceRepresentation ?? 'inline';\n      if (sourceItems && !allowedChanged) {\n        schema.items = cloneSchema(sourceItems);\n      } else if (sourceMode === 'refs' && hasAllowedOverride) {\n        schema.items = buildRefBlocksItemsSchema(allowedBlocks, blocksConfig?.__sourceRefPrefix);\n      } else {\n        schema.items = buildInlineBlocksItemsSchema(hasAllowedOverride ? allowedBlocks : undefined);\n      }\n\n      // Add min/max constraints\n      if (blocksConfig?.minBlocks !== undefined) {\n        schema.minItems = blocksConfig.minBlocks;\n      }\n      if (blocksConfig?.maxBlocks !== undefined) {\n        schema.maxItems = blocksConfig.maxBlocks;\n      }\n\n      // Build x-formgen with blocks configuration\n      const blocksFormgen: Record<string, unknown> = {\n        ...formgen,\n        widget: blocksConfig?.__sourceWidget || 'block',\n        sortable: blocksConfig?.__sourceSortable ?? true,\n      };\n      if (\n        hasAllowedOverride &&\n        (blocksConfig?.__sourceHadAllowedBlocks || sourceMode !== 'refs' || allowedChanged)\n      ) {\n        blocksFormgen.allowedBlocks = allowedBlocks;\n      }\n      if (hasDeniedOverride || (blocksConfig?.__sourceHadDeniedBlocks && deniedChanged)) {\n        blocksFormgen.deniedBlocks = deniedBlocks;\n      }\n      schema['x-formgen'] = blocksFormgen as FormgenExtension;\n      break;\n    }\n  }\n\n  return schema;\n}\n\n/**\n * Map field type to widget name\n */\nfunction fieldTypeToWidget(fieldType: FieldType): string | undefined {\n  const widgetMap: Partial<Record<FieldType, string>> = {\n    textarea: 'textarea',\n    'rich-text': 'rich-text',\n    markdown: 'markdown',\n    code: 'code-editor',\n    toggle: 'toggle',\n    chips: 'chips',\n    'media-picker': 'media-picker',\n    'media-gallery': 'media-picker',\n    'file-upload': 'file-upload',\n    blocks: 'block',\n    json: 'json-editor',\n    slug: 'slug',\n    color: 'color',\n  };\n  return widgetMap[fieldType];\n}\n\n/**\n * Convert JSON Schema to field definitions\n */\nexport function schemaToFields(schema: JSONSchema): FieldDefinition[] {\n  if (!schema.properties) {\n    return [];\n  }\n\n  const required = new Set(schema.required ?? []);\n  const fields: FieldDefinition[] = [];\n\n  for (const [name, propSchema] of Object.entries(schema.properties)) {\n    if (name === '_type' || name === '_schema') {\n      continue;\n    }\n    fields.push(schemaPropertyToField(name, propSchema, required.has(name)));\n  }\n\n  // Sort by x-formgen.order if present\n  fields.sort((a, b) => (a.order ?? 999) - (b.order ?? 999));\n\n  return fields;\n}\n\n/**\n * Convert a JSON Schema property to a field definition\n */\nfunction schemaPropertyToField(name: string, schema: JSONSchema, isRequired: boolean): FieldDefinition {\n  const formgen = schema['x-formgen'] as FormgenExtension | undefined;\n  const admin = schema['x-admin'] as AdminExtension | undefined;\n  const filterable = admin?.filterable ?? formgen?.filterable;\n\n  const field: FieldDefinition = {\n    id: generateFieldId(),\n    name,\n    type: schemaToFieldType(schema),\n    label: schema.title ?? titleCase(name),\n    description: schema.description,\n    placeholder: formgen?.placeholder,\n    helpText: formgen?.helpText,\n    required: isRequired,\n    readonly: formgen?.readonly,\n    hidden: formgen?.hidden,\n    filterable: filterable === true,\n    defaultValue: schema.default,\n    section: formgen?.section,\n    gridSpan: formgen?.grid?.span,\n    order: formgen?.order,\n  };\n\n  // Validation\n  const validation: FieldDefinition['validation'] = {};\n  if (schema.minLength !== undefined) validation.minLength = schema.minLength;\n  if (schema.maxLength !== undefined) validation.maxLength = schema.maxLength;\n  if (schema.minimum !== undefined) validation.min = schema.minimum;\n  if (schema.maximum !== undefined) validation.max = schema.maximum;\n  if (schema.pattern) validation.pattern = schema.pattern;\n  if (Object.keys(validation).length > 0) {\n    field.validation = validation;\n  }\n\n  // Enum options\n  if (schema.enum && Array.isArray(schema.enum)) {\n    field.config = {\n      options: schema.enum.map((value) => ({\n        value: String(value),\n        label: titleCase(String(value)),\n      })),\n    };\n  }\n\n  // Blocks configuration\n  if (field.type === 'blocks' && schema.type === 'array') {\n    const blocksConfig: BlocksFieldConfig = {};\n    const sourceItems = schema.items ? cloneSchema(schema.items as JSONSchema) : undefined;\n    if (sourceItems) {\n      blocksConfig.__sourceItemsSchema = sourceItems;\n    }\n    if (typeof formgen?.widget === 'string' && formgen.widget.trim()) {\n      blocksConfig.__sourceWidget = formgen.widget.trim();\n    }\n    if (typeof formgen?.sortable === 'boolean') {\n      blocksConfig.__sourceSortable = formgen.sortable;\n    }\n    blocksConfig.__sourceHadAllowedBlocks = Array.isArray(formgen?.allowedBlocks);\n    blocksConfig.__sourceHadDeniedBlocks = Array.isArray(formgen?.deniedBlocks);\n\n    // Extract min/max from schema\n    if (schema.minItems !== undefined) {\n      blocksConfig.minBlocks = schema.minItems;\n    }\n    if (schema.maxItems !== undefined) {\n      blocksConfig.maxBlocks = schema.maxItems;\n    }\n\n    // Extract allowed blocks from oneOf/formgen and keep source representation metadata.\n    const parsedSource = sourceItems?.oneOf ? extractAllowedBlocksFromOneOf(sourceItems.oneOf) : null;\n    if (parsedSource) {\n      blocksConfig.__sourceRepresentation = parsedSource.mode;\n      if (parsedSource.refPrefix) {\n        blocksConfig.__sourceRefPrefix = parsedSource.refPrefix;\n      }\n    }\n    let sourceAllowedBlocks: string[] | undefined;\n    if (formgen?.allowedBlocks && Array.isArray(formgen.allowedBlocks)) {\n      const configured = normalizeBlockTypeList(formgen.allowedBlocks as string[]);\n      sourceAllowedBlocks = parsedSource?.allowed.length ? parsedSource.allowed : configured;\n      if (configured.length > 0) {\n        blocksConfig.allowedBlocks = configured;\n      }\n    } else if (parsedSource?.allowed.length) {\n      sourceAllowedBlocks = parsedSource.allowed;\n      blocksConfig.allowedBlocks = parsedSource.allowed;\n    }\n    if (!blocksConfig.__sourceRepresentation) {\n      blocksConfig.__sourceRepresentation = 'inline';\n    }\n    if (sourceAllowedBlocks && sourceAllowedBlocks.length > 0) {\n      blocksConfig.__sourceAllowedBlocks = sourceAllowedBlocks;\n    }\n\n    // Extract denied blocks from x-formgen\n    if (formgen?.deniedBlocks && Array.isArray(formgen.deniedBlocks)) {\n      const denied = normalizeBlockTypeList(formgen.deniedBlocks as string[]);\n      if (denied.length > 0) {\n        blocksConfig.deniedBlocks = denied;\n      }\n      blocksConfig.__sourceDeniedBlocks = denied;\n    }\n\n    if (Object.keys(blocksConfig).length > 0) {\n      field.config = blocksConfig;\n    }\n  }\n\n  return field;\n}\n\n/**\n * Infer field type from JSON Schema property\n */\nfunction schemaToFieldType(schema: JSONSchema): FieldType {\n  const formgen = schema['x-formgen'] as FormgenExtension | undefined;\n\n  // Infer from type + format\n  const type = Array.isArray(schema.type) ? schema.type[0] : schema.type;\n\n  switch (type) {\n    case 'array': {\n      if (schema.items) {\n        const itemsSchema = schema.items as JSONSchema;\n        if (itemsSchema.oneOf) return 'blocks';\n        if (itemsSchema.enum) return 'chips';\n        if (formgen?.widget === 'block') return 'blocks';\n        if (formgen?.widget === 'chips') return 'chips';\n        if (formgen?.widget === 'media-picker') return 'media-gallery';\n        if (itemsSchema.format === 'uuid' || itemsSchema.format === 'uri') return 'references';\n      }\n      return 'repeater';\n    }\n\n    default:\n      break;\n  }\n\n  // Check explicit widget (non-array)\n  if (formgen?.widget) {\n    const widgetToType: Record<string, FieldType> = {\n      textarea: 'textarea',\n      'rich-text': 'rich-text',\n      markdown: 'markdown',\n      'code-editor': 'code',\n      toggle: 'toggle',\n      chips: 'chips',\n      'media-picker': 'media-picker',\n      'file-upload': 'file-upload',\n      block: 'blocks',\n      'json-editor': 'json',\n      slug: 'slug',\n      color: 'color',\n    };\n    if (widgetToType[formgen.widget]) {\n      return widgetToType[formgen.widget];\n    }\n  }\n\n  switch (type) {\n    case 'string':\n      if (schema.format === 'date-time') return 'datetime';\n      if (schema.format === 'date') return 'date';\n      if (schema.format === 'time') return 'time';\n      if (schema.format === 'uri') return 'media-picker';\n      if (schema.format === 'uuid') return 'reference';\n      if (schema.enum) return 'select';\n      return 'text';\n\n    case 'number':\n      return 'number';\n\n    case 'integer':\n      return 'integer';\n\n    case 'boolean':\n      return 'toggle';\n\n    case 'object':\n      return 'json';\n\n    default:\n      return 'text';\n  }\n}\n\n/**\n * Generate a unique field ID\n */\nexport function generateFieldId(): string {\n  return `field_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 7)}`;\n}\n\n/**\n * Convert string to title case\n */\nfunction titleCase(str: string): string {\n  return str\n    .replace(/([A-Z])/g, ' $1')\n    .replace(/[_-]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n    .split(' ')\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n}\n","/**\n * Field Type Picker\n *\n * Modal/drawer UI for selecting a field type when adding new fields.\n */\n\nimport type { FieldType, FieldTypeMetadata, FieldTypeCategory, FieldTypePickerConfig } from './types';\nimport { Modal } from '../shared/modal';\n\n// =============================================================================\n// SVG Icon Map\n// =============================================================================\n\nconst SVG_ICONS: Record<string, string> = {\n  // Text\n  text: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h8\"></path></svg>',\n  textarea: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 10h16M4 14h10M4 18h6\"></path></svg>',\n  'rich-text': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path></svg>',\n  markdown: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z\"></path></svg>',\n  code: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4\"></path></svg>',\n\n  // Number\n  number: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"></path></svg>',\n  integer: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 7h6m-3-3v18\"></path></svg>',\n  currency: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>',\n  percentage: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 5L5 19M9 7a2 2 0 11-4 0 2 2 0 014 0zm10 10a2 2 0 11-4 0 2 2 0 014 0z\"></path></svg>',\n\n  // Selection\n  select: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 9l4-4 4 4m0 6l-4 4-4-4\"></path></svg>',\n  radio: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" stroke-width=\"2\"/><circle cx=\"12\" cy=\"12\" r=\"4\" fill=\"currentColor\"/></svg>',\n  checkbox: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>',\n  chips: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 7h.01M7 3h5a1.99 1.99 0 011.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"></path></svg>',\n  toggle: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><rect x=\"1\" y=\"6\" width=\"22\" height=\"12\" rx=\"6\" stroke-width=\"2\"/><circle cx=\"8\" cy=\"12\" r=\"3\" fill=\"currentColor\"/></svg>',\n\n  // Date/Time\n  date: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"></path></svg>',\n  time: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>',\n  datetime: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13l-2 2-1-1\"></path></svg>',\n\n  // Media\n  'media-picker': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"></path></svg>',\n  'media-gallery': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"></path></svg>',\n  'file-upload': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\"></path></svg>',\n\n  // Reference\n  reference: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"></path></svg>',\n  references: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 8h2m2 0h-2m0 0V6m0 2v2\"></path></svg>',\n  user: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path></svg>',\n\n  // Structural\n  group: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"></path></svg>',\n  repeater: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path></svg>',\n  blocks: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zm0 8a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zm10 0a1 1 0 011-1h4a1 1 0 011 1v6a1 1 0 01-1 1h-4a1 1 0 01-1-1v-6z\"></path></svg>',\n\n  // Advanced\n  json: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4\"></path></svg>',\n  slug: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 18h8\"></path></svg>',\n  color: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01\"></path></svg>',\n  location: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg>',\n\n  // Category icons\n  'cat-text': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h8\"></path></svg>',\n  'cat-number': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"></path></svg>',\n  'cat-selection': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 9l4-4 4 4m0 6l-4 4-4-4\"></path></svg>',\n  'cat-datetime': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"></path></svg>',\n  'cat-media': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"></path></svg>',\n  'cat-reference': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"></path></svg>',\n  'cat-structural': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"></path></svg>',\n  'cat-advanced': '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg>',\n};\n\nexport function iconForKey(key: string): string {\n  return SVG_ICONS[key] ?? '';\n}\n\nexport function normalizeFieldType(type: string): FieldType {\n  const key = type.trim().toLowerCase();\n  const map: Record<string, FieldType> = {\n    string: 'text',\n    richtext: 'rich-text',\n    decimal: 'number',\n    boolean: 'toggle',\n    multiselect: 'chips',\n    image: 'media-picker',\n    file: 'file-upload',\n    url: 'text',\n    email: 'text',\n    hidden: 'text',\n  };\n  return (map[key] ?? key) as FieldType;\n}\n\nfunction icon(key: string): string {\n  return iconForKey(key);\n}\n\n// =============================================================================\n// Field Type Registry\n// =============================================================================\n\nexport const FIELD_TYPES: FieldTypeMetadata[] = [\n  // Text Fields\n  {\n    type: 'text',\n    label: 'Text',\n    description: 'Single line text input',\n    icon: icon('text'),\n    category: 'text',\n    defaultConfig: { validation: { maxLength: 255 } },\n  },\n  {\n    type: 'textarea',\n    label: 'Textarea',\n    description: 'Multi-line text input',\n    icon: icon('textarea'),\n    category: 'text',\n    defaultConfig: { config: { multiline: true, rows: 4 } },\n  },\n  {\n    type: 'rich-text',\n    label: 'Rich Text',\n    description: 'WYSIWYG editor with formatting',\n    icon: icon('rich-text'),\n    category: 'text',\n  },\n  {\n    type: 'markdown',\n    label: 'Markdown',\n    description: 'Markdown text editor',\n    icon: icon('markdown'),\n    category: 'text',\n  },\n  {\n    type: 'code',\n    label: 'Code',\n    description: 'Code editor with syntax highlighting',\n    icon: icon('code'),\n    category: 'text',\n    defaultConfig: { config: { language: 'json', lineNumbers: true } },\n  },\n\n  // Number Fields\n  {\n    type: 'number',\n    label: 'Number',\n    description: 'Decimal number input',\n    icon: icon('number'),\n    category: 'number',\n  },\n  {\n    type: 'integer',\n    label: 'Integer',\n    description: 'Whole number input',\n    icon: icon('integer'),\n    category: 'number',\n  },\n  {\n    type: 'currency',\n    label: 'Currency',\n    description: 'Money amount with currency symbol',\n    icon: icon('currency'),\n    category: 'number',\n    defaultConfig: { config: { precision: 2, prefix: '$' } },\n  },\n  {\n    type: 'percentage',\n    label: 'Percentage',\n    description: 'Percentage value (0-100)',\n    icon: icon('percentage'),\n    category: 'number',\n    defaultConfig: { validation: { min: 0, max: 100 }, config: { suffix: '%' } },\n  },\n\n  // Selection Fields\n  {\n    type: 'select',\n    label: 'Select',\n    description: 'Dropdown selection',\n    icon: icon('select'),\n    category: 'selection',\n    defaultConfig: { config: { options: [] } },\n  },\n  {\n    type: 'radio',\n    label: 'Radio',\n    description: 'Radio button selection',\n    icon: icon('radio'),\n    category: 'selection',\n    defaultConfig: { config: { options: [] } },\n  },\n  {\n    type: 'checkbox',\n    label: 'Checkbox',\n    description: 'Single checkbox (true/false)',\n    icon: icon('checkbox'),\n    category: 'selection',\n  },\n  {\n    type: 'chips',\n    label: 'Chips',\n    description: 'Tag-style multi-select',\n    icon: icon('chips'),\n    category: 'selection',\n    defaultConfig: { config: { options: [], multiple: true } },\n  },\n  {\n    type: 'toggle',\n    label: 'Toggle',\n    description: 'Boolean switch',\n    icon: icon('toggle'),\n    category: 'selection',\n  },\n\n  // Date/Time Fields\n  {\n    type: 'date',\n    label: 'Date',\n    description: 'Date picker',\n    icon: icon('date'),\n    category: 'datetime',\n  },\n  {\n    type: 'time',\n    label: 'Time',\n    description: 'Time picker',\n    icon: icon('time'),\n    category: 'datetime',\n  },\n  {\n    type: 'datetime',\n    label: 'Date & Time',\n    description: 'Date and time picker',\n    icon: icon('datetime'),\n    category: 'datetime',\n  },\n\n  // Media Fields\n  {\n    type: 'media-picker',\n    label: 'Media',\n    description: 'Single media asset picker',\n    icon: icon('media-picker'),\n    category: 'media',\n    defaultConfig: { config: { accept: 'image/*' } },\n  },\n  {\n    type: 'media-gallery',\n    label: 'Gallery',\n    description: 'Multiple media assets',\n    icon: icon('media-gallery'),\n    category: 'media',\n    defaultConfig: { config: { accept: 'image/*', multiple: true } },\n  },\n  {\n    type: 'file-upload',\n    label: 'File',\n    description: 'File attachment',\n    icon: icon('file-upload'),\n    category: 'media',\n  },\n\n  // Reference Fields\n  {\n    type: 'reference',\n    label: 'Reference',\n    description: 'Link to another content type',\n    icon: icon('reference'),\n    category: 'reference',\n    defaultConfig: { config: { target: '', displayField: 'name' } },\n  },\n  {\n    type: 'references',\n    label: 'References',\n    description: 'Multiple links to another content type',\n    icon: icon('references'),\n    category: 'reference',\n    defaultConfig: { config: { target: '', displayField: 'name', multiple: true } },\n  },\n  {\n    type: 'user',\n    label: 'User',\n    description: 'User reference',\n    icon: icon('user'),\n    category: 'reference',\n  },\n\n  // Structural Fields\n  {\n    type: 'group',\n    label: 'Group',\n    description: 'Collapsible field group',\n    icon: icon('group'),\n    category: 'structural',\n  },\n  {\n    type: 'repeater',\n    label: 'Repeater',\n    description: 'Repeatable field group',\n    icon: icon('repeater'),\n    category: 'structural',\n    defaultConfig: { config: { fields: [], minItems: 0, maxItems: 10 } },\n  },\n  {\n    type: 'blocks',\n    label: 'Blocks',\n    description: 'Modular content blocks',\n    icon: icon('blocks'),\n    category: 'structural',\n    defaultConfig: { config: { allowedBlocks: [] } },\n  },\n\n  // Advanced Fields\n  {\n    type: 'json',\n    label: 'JSON',\n    description: 'Raw JSON editor',\n    icon: icon('json'),\n    category: 'advanced',\n  },\n  {\n    type: 'slug',\n    label: 'Slug',\n    description: 'URL-friendly identifier',\n    icon: icon('slug'),\n    category: 'advanced',\n    defaultConfig: { validation: { pattern: '^[a-z0-9-]+$' } },\n  },\n  {\n    type: 'color',\n    label: 'Color',\n    description: 'Color picker',\n    icon: icon('color'),\n    category: 'advanced',\n  },\n  {\n    type: 'location',\n    label: 'Location',\n    description: 'Geographic coordinates',\n    icon: icon('location'),\n    category: 'advanced',\n  },\n];\n\nexport const FIELD_CATEGORIES: { id: FieldTypeCategory; label: string; icon: string }[] = [\n  { id: 'text', label: 'Text', icon: icon('cat-text') },\n  { id: 'number', label: 'Numbers', icon: icon('cat-number') },\n  { id: 'selection', label: 'Selection', icon: icon('cat-selection') },\n  { id: 'datetime', label: 'Date & Time', icon: icon('cat-datetime') },\n  { id: 'media', label: 'Media', icon: icon('cat-media') },\n  { id: 'reference', label: 'References', icon: icon('cat-reference') },\n  { id: 'structural', label: 'Structural', icon: icon('cat-structural') },\n  { id: 'advanced', label: 'Advanced', icon: icon('cat-advanced') },\n];\n\nexport function getFieldTypeMetadata(type: FieldType): FieldTypeMetadata | undefined {\n  const normalized = normalizeFieldType(String(type));\n  return FIELD_TYPES.find((ft) => ft.type === normalized);\n}\n\nexport function getFieldTypesByCategory(category: FieldTypeCategory): FieldTypeMetadata[] {\n  return FIELD_TYPES.filter((ft) => ft.category === category);\n}\n\n// =============================================================================\n// Field Type Picker Component\n// =============================================================================\n\nexport class FieldTypePicker extends Modal {\n  private config: FieldTypePickerConfig;\n  private selectedCategory: FieldTypeCategory = 'text';\n  private searchQuery: string = '';\n\n  constructor(config: FieldTypePickerConfig) {\n    super({\n      size: '3xl',\n      maxHeight: 'h-[80vh]',\n      initialFocus: '[data-field-type-search]',\n      backdropDataAttr: 'data-field-type-picker-backdrop',\n    });\n    this.config = config;\n  }\n\n  protected onBeforeHide(): boolean {\n    this.config.onCancel();\n    return true;\n  }\n\n  protected renderContent(): string {\n    return `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Add Field</h2>\n        <button type=\"button\" data-field-type-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div class=\"relative\">\n          <svg class=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n          </svg>\n          <input\n            type=\"text\"\n            data-field-type-search\n            placeholder=\"Search field types...\"\n            class=\"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n      </div>\n\n      <div class=\"flex flex-1 overflow-hidden\">\n        <div class=\"w-48 border-r border-gray-200 dark:border-gray-700 overflow-y-auto\" data-field-type-categories>\n          ${this.renderCategories()}\n        </div>\n\n        <div class=\"flex-1 overflow-y-auto p-4\" data-field-type-list>\n          ${this.renderFieldTypes()}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderCategories(): string {\n    return FIELD_CATEGORIES.map(\n      (cat) => `\n      <button\n        type=\"button\"\n        data-field-category=\"${cat.id}\"\n        class=\"w-full flex items-center gap-3 px-4 py-3 text-sm text-left transition-colors ${\n          cat.id === this.selectedCategory\n            ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium'\n            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800'\n        }\"\n      >\n        <span class=\"flex-shrink-0 w-6 flex items-center justify-center\">${cat.icon}</span>\n        <span>${cat.label}</span>\n      </button>\n    `\n    ).join('');\n  }\n\n  private renderFieldTypes(): string {\n    const excludeSet = new Set(this.config.excludeTypes ?? []);\n    let types = FIELD_TYPES.filter((ft) => !excludeSet.has(ft.type));\n\n    // Filter by search query\n    if (this.searchQuery) {\n      const query = this.searchQuery.toLowerCase();\n      types = types.filter(\n        (ft) =>\n          ft.label.toLowerCase().includes(query) ||\n          ft.description.toLowerCase().includes(query) ||\n          ft.type.toLowerCase().includes(query)\n      );\n    } else {\n      // Filter by category when not searching\n      types = types.filter((ft) => ft.category === this.selectedCategory);\n    }\n\n    if (types.length === 0) {\n      return `\n        <div class=\"flex flex-col items-center justify-center h-full text-gray-400\">\n          <svg class=\"w-12 h-12 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n          </svg>\n          <p class=\"text-sm\">No field types found</p>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"grid grid-cols-2 gap-3\">\n        ${types.map((ft) => this.renderFieldTypeCard(ft)).join('')}\n      </div>\n    `;\n  }\n\n  private renderFieldTypeCard(fieldType: FieldTypeMetadata): string {\n    return `\n      <button\n        type=\"button\"\n        data-field-type-select=\"${fieldType.type}\"\n        class=\"flex items-start gap-3 p-4 text-left border border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors group\"\n      >\n        <span class=\"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 group-hover:bg-blue-100 dark:group-hover:bg-blue-900/40 group-hover:text-blue-600 dark:group-hover:text-blue-400\">\n          ${fieldType.icon}\n        </span>\n        <div class=\"flex-1 min-w-0\">\n          <div class=\"font-medium text-gray-900 dark:text-white\">${fieldType.label}</div>\n          <div class=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5 line-clamp-2\">${fieldType.description}</div>\n        </div>\n      </button>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    if (!this.container) return;\n\n    // Close button\n    this.container.querySelector('[data-field-type-close]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Category selection\n    this.container.querySelectorAll('[data-field-category]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        this.selectedCategory = btn.getAttribute('data-field-category') as FieldTypeCategory;\n        this.searchQuery = '';\n        const searchInput = this.container?.querySelector<HTMLInputElement>('[data-field-type-search]');\n        if (searchInput) searchInput.value = '';\n        this.updateView();\n      });\n    });\n\n    // Field type selection\n    this.container.addEventListener('click', (e) => {\n      const target = (e.target as HTMLElement).closest('[data-field-type-select]');\n      if (target) {\n        const type = target.getAttribute('data-field-type-select') as FieldType;\n        this.config.onSelect(type);\n        this.hide();\n      }\n    });\n\n    // Search\n    const searchInput = this.container.querySelector<HTMLInputElement>('[data-field-type-search]');\n    searchInput?.addEventListener('input', () => {\n      this.searchQuery = searchInput.value;\n      this.updateView();\n    });\n  }\n\n  private updateView(): void {\n    if (!this.container) return;\n\n    // Update categories\n    const categoriesContainer = this.container.querySelector('[data-field-type-categories]');\n    if (categoriesContainer) {\n      categoriesContainer.innerHTML = this.renderCategories();\n      // Re-bind category events\n      categoriesContainer.querySelectorAll('[data-field-category]').forEach((btn) => {\n        btn.addEventListener('click', () => {\n          this.selectedCategory = btn.getAttribute('data-field-category') as FieldTypeCategory;\n          this.searchQuery = '';\n          const searchInput = this.container?.querySelector<HTMLInputElement>('[data-field-type-search]');\n          if (searchInput) searchInput.value = '';\n          this.updateView();\n        });\n      });\n    }\n\n    // Update field types list\n    const listContainer = this.container.querySelector('[data-field-type-list]');\n    if (listContainer) {\n      listContainer.innerHTML = this.renderFieldTypes();\n    }\n  }\n}\n","/**\n * Shared Field Input Classes\n *\n * Centralizes CSS class strings for form inputs across the Content Type Builder.\n * All helpers include full dark mode support.\n *\n * Size variants:\n *   'sm' (default) — standard form inputs (px-3 py-2)\n *   'xs'           — compact inputs for inline editors (px-2 py-1)\n */\n\n// ---------------------------------------------------------------------------\n// Input / Select / Textarea\n// ---------------------------------------------------------------------------\n\nconst BASE_INPUT =\n  'w-full border rounded-lg bg-white text-gray-900 placeholder-gray-400 ' +\n  'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ' +\n  'dark:border-gray-600 dark:bg-slate-800 dark:text-white dark:placeholder-gray-500';\n\nconst SIZE_SM = 'px-3 py-2 text-sm border-gray-300';\nconst SIZE_XS = 'px-2 py-1 text-[12px] border-gray-200';\n\nexport function inputClasses(size: 'sm' | 'xs' = 'sm'): string {\n  return size === 'xs' ? `${BASE_INPUT} ${SIZE_XS}` : `${BASE_INPUT} ${SIZE_SM}`;\n}\n\nexport function selectClasses(size: 'sm' | 'xs' = 'sm'): string {\n  // Same base as input but without placeholder classes\n  const base =\n    'w-full border rounded-lg bg-white text-gray-900 ' +\n    'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ' +\n    'dark:border-gray-600 dark:bg-slate-800 dark:text-white';\n  return size === 'xs' ? `${base} ${SIZE_XS}` : `${base} ${SIZE_SM}`;\n}\n\ntype TextareaResize = 'none' | 'x' | 'y' | 'both';\n\ninterface TextareaClassOptions {\n  size?: 'sm' | 'xs';\n  /** Resize behavior (default: vertical) */\n  resize?: TextareaResize;\n}\n\nexport function textareaClasses(options: TextareaClassOptions = {}): string {\n  const size = options.size ?? 'sm';\n  const resize = options.resize ?? 'y';\n  const resizeClass =\n    resize === 'none' ? 'resize-none'\n    : resize === 'x' ? 'resize-x'\n    : resize === 'both' ? 'resize'\n    : 'resize-y';\n  return `${inputClasses(size)} ${resizeClass}`;\n}\n\n// ---------------------------------------------------------------------------\n// Checkbox\n// ---------------------------------------------------------------------------\n\nexport function checkboxClasses(): string {\n  return 'w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500';\n}\n\n// ---------------------------------------------------------------------------\n// Label\n// ---------------------------------------------------------------------------\n\nexport function labelClasses(size: 'sm' | 'xs' = 'sm'): string {\n  return size === 'xs'\n    ? 'block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1'\n    : 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1';\n}\n\n// ---------------------------------------------------------------------------\n// Drag Handle Icon (6-dot grip pattern — canonical for all surfaces)\n// ---------------------------------------------------------------------------\n\nexport function dragHandleIcon(size: 'sm' | 'xs' = 'sm'): string {\n  const sizeClass = size === 'xs' ? 'w-3 h-3' : 'w-4 h-4';\n  return `<svg class=\"${sizeClass}\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><circle cx=\"8\" cy=\"4\" r=\"2\"/><circle cx=\"16\" cy=\"4\" r=\"2\"/><circle cx=\"8\" cy=\"12\" r=\"2\"/><circle cx=\"16\" cy=\"12\" r=\"2\"/><circle cx=\"8\" cy=\"20\" r=\"2\"/><circle cx=\"16\" cy=\"20\" r=\"2\"/></svg>`;\n}\n","/**\n * Icon Picker Data\n *\n * Static emoji set (~200 curated entries) and SVG icon key list for the\n * built-in Emoji and Icons tabs. Kept in a separate file so the data\n * can be tree-shaken or lazy-loaded if needed.\n */\n\nimport { iconForKey } from '../field-type-picker';\nimport type { IconTab, IconEntry } from './icon-picker';\nimport { renderIcon } from '../../shared/icon-renderer.js';\n\n// ---------------------------------------------------------------------------\n// Emoji Types\n// ---------------------------------------------------------------------------\n\nexport interface EmojiEntry {\n  emoji: string;\n  name: string;\n  keywords?: string;\n}\n\nexport interface EmojiCategory {\n  id: string;\n  label: string;\n  emoji: string;\n  entries: EmojiEntry[];\n}\n\n// ---------------------------------------------------------------------------\n// Emoji Data (~200 curated entries)\n// ---------------------------------------------------------------------------\n\nexport const EMOJI_CATEGORIES: EmojiCategory[] = [\n  {\n    id: 'smileys',\n    label: 'Smileys',\n    emoji: '😀',\n    entries: [\n      { emoji: '😀', name: 'grinning face', keywords: 'happy smile' },\n      { emoji: '😃', name: 'smiley', keywords: 'happy face' },\n      { emoji: '😄', name: 'smile', keywords: 'happy joy' },\n      { emoji: '😁', name: 'grin', keywords: 'happy teeth' },\n      { emoji: '😅', name: 'sweat smile', keywords: 'nervous relief' },\n      { emoji: '😂', name: 'joy', keywords: 'laugh tears funny' },\n      { emoji: '🤣', name: 'rofl', keywords: 'laugh rolling' },\n      { emoji: '😊', name: 'blush', keywords: 'happy shy' },\n      { emoji: '😇', name: 'innocent', keywords: 'angel halo' },\n      { emoji: '😍', name: 'heart eyes', keywords: 'love crush' },\n      { emoji: '🤩', name: 'star struck', keywords: 'wow excited' },\n      { emoji: '😘', name: 'kissing heart', keywords: 'love kiss' },\n      { emoji: '🤔', name: 'thinking', keywords: 'consider wonder hmm' },\n      { emoji: '🤗', name: 'hugging', keywords: 'hug embrace warm' },\n      { emoji: '😎', name: 'sunglasses', keywords: 'cool confident' },\n      { emoji: '🥳', name: 'partying', keywords: 'celebrate birthday party' },\n      { emoji: '😤', name: 'triumph', keywords: 'frustrated angry huff' },\n      { emoji: '😢', name: 'cry', keywords: 'sad tear' },\n      { emoji: '😱', name: 'scream', keywords: 'fear shock horror' },\n      { emoji: '🤯', name: 'exploding head', keywords: 'mind blown shock' },\n      { emoji: '😴', name: 'sleeping', keywords: 'zzz tired rest' },\n      { emoji: '🤮', name: 'vomiting', keywords: 'sick disgusting' },\n      { emoji: '🥺', name: 'pleading', keywords: 'puppy eyes beg' },\n      { emoji: '😈', name: 'smiling imp', keywords: 'devil evil mischief' },\n      { emoji: '💀', name: 'skull', keywords: 'dead death skeleton' },\n    ],\n  },\n  {\n    id: 'people',\n    label: 'People',\n    emoji: '👋',\n    entries: [\n      { emoji: '👋', name: 'wave', keywords: 'hello hi greeting' },\n      { emoji: '👍', name: 'thumbs up', keywords: 'approve like yes good' },\n      { emoji: '👎', name: 'thumbs down', keywords: 'reject dislike no bad' },\n      { emoji: '👏', name: 'clap', keywords: 'applause congrats' },\n      { emoji: '🙌', name: 'raised hands', keywords: 'celebrate hooray' },\n      { emoji: '🤝', name: 'handshake', keywords: 'deal agreement' },\n      { emoji: '✋', name: 'raised hand', keywords: 'stop high five' },\n      { emoji: '✌️', name: 'peace', keywords: 'victory two' },\n      { emoji: '🤞', name: 'crossed fingers', keywords: 'luck hope wish' },\n      { emoji: '💪', name: 'flexed biceps', keywords: 'strong power muscle' },\n      { emoji: '👀', name: 'eyes', keywords: 'look see watch' },\n      { emoji: '👁️', name: 'eye', keywords: 'look see vision' },\n      { emoji: '🧠', name: 'brain', keywords: 'think smart intelligence' },\n      { emoji: '❤️', name: 'red heart', keywords: 'love like' },\n      { emoji: '🔥', name: 'fire', keywords: 'hot flame lit popular' },\n      { emoji: '✨', name: 'sparkles', keywords: 'stars magic new shiny' },\n      { emoji: '💫', name: 'dizzy', keywords: 'star shooting' },\n      { emoji: '💥', name: 'collision', keywords: 'boom bang explosion' },\n      { emoji: '💬', name: 'speech bubble', keywords: 'comment chat message' },\n      { emoji: '💡', name: 'light bulb', keywords: 'idea thought bright' },\n    ],\n  },\n  {\n    id: 'animals-nature',\n    label: 'Nature',\n    emoji: '🌿',\n    entries: [\n      { emoji: '🐶', name: 'dog face', keywords: 'pet puppy' },\n      { emoji: '🐱', name: 'cat face', keywords: 'pet kitten' },\n      { emoji: '🐻', name: 'bear', keywords: 'animal' },\n      { emoji: '🦊', name: 'fox', keywords: 'clever sly' },\n      { emoji: '🦁', name: 'lion', keywords: 'king brave' },\n      { emoji: '🐸', name: 'frog', keywords: 'toad' },\n      { emoji: '🦋', name: 'butterfly', keywords: 'insect beauty' },\n      { emoji: '🐝', name: 'honeybee', keywords: 'buzz insect' },\n      { emoji: '🌸', name: 'cherry blossom', keywords: 'flower spring pink' },\n      { emoji: '🌺', name: 'hibiscus', keywords: 'flower tropical' },\n      { emoji: '🌻', name: 'sunflower', keywords: 'flower sun yellow' },\n      { emoji: '🌹', name: 'rose', keywords: 'flower love red' },\n      { emoji: '🌲', name: 'evergreen tree', keywords: 'pine forest' },\n      { emoji: '🌿', name: 'herb', keywords: 'plant leaf green' },\n      { emoji: '🍀', name: 'four leaf clover', keywords: 'luck lucky irish' },\n      { emoji: '🌊', name: 'wave', keywords: 'ocean sea water surf' },\n      { emoji: '⛰️', name: 'mountain', keywords: 'peak hill' },\n      { emoji: '🌈', name: 'rainbow', keywords: 'colors pride' },\n      { emoji: '☀️', name: 'sun', keywords: 'sunny bright warm weather' },\n      { emoji: '🌙', name: 'crescent moon', keywords: 'night sleep' },\n    ],\n  },\n  {\n    id: 'food',\n    label: 'Food',\n    emoji: '🍕',\n    entries: [\n      { emoji: '🍕', name: 'pizza', keywords: 'food slice' },\n      { emoji: '🍔', name: 'hamburger', keywords: 'burger food' },\n      { emoji: '☕', name: 'coffee', keywords: 'drink hot tea cup' },\n      { emoji: '🍺', name: 'beer', keywords: 'drink alcohol mug' },\n      { emoji: '🍷', name: 'wine', keywords: 'drink glass red' },\n      { emoji: '🎂', name: 'birthday cake', keywords: 'dessert party celebrate' },\n      { emoji: '🍰', name: 'shortcake', keywords: 'dessert sweet' },\n      { emoji: '🍩', name: 'doughnut', keywords: 'donut dessert sweet' },\n      { emoji: '🍎', name: 'red apple', keywords: 'fruit health' },\n      { emoji: '🍋', name: 'lemon', keywords: 'fruit citrus sour' },\n      { emoji: '🍉', name: 'watermelon', keywords: 'fruit summer' },\n      { emoji: '🌶️', name: 'hot pepper', keywords: 'spicy chili' },\n      { emoji: '🥑', name: 'avocado', keywords: 'fruit green' },\n      { emoji: '🍿', name: 'popcorn', keywords: 'movie snack' },\n      { emoji: '🧁', name: 'cupcake', keywords: 'dessert sweet muffin' },\n    ],\n  },\n  {\n    id: 'travel',\n    label: 'Travel',\n    emoji: '✈️',\n    entries: [\n      { emoji: '✈️', name: 'airplane', keywords: 'travel flight fly' },\n      { emoji: '🚀', name: 'rocket', keywords: 'launch space ship fast' },\n      { emoji: '🚗', name: 'car', keywords: 'auto vehicle drive' },\n      { emoji: '🚲', name: 'bicycle', keywords: 'bike cycle pedal' },\n      { emoji: '🏠', name: 'house', keywords: 'home building' },\n      { emoji: '🏢', name: 'office building', keywords: 'work corporate' },\n      { emoji: '🏭', name: 'factory', keywords: 'industry manufacturing' },\n      { emoji: '🏥', name: 'hospital', keywords: 'health medical doctor' },\n      { emoji: '🏫', name: 'school', keywords: 'education learn' },\n      { emoji: '🏰', name: 'castle', keywords: 'medieval fortress' },\n      { emoji: '⛪', name: 'church', keywords: 'religion worship' },\n      { emoji: '🗽', name: 'statue of liberty', keywords: 'new york freedom' },\n      { emoji: '🌍', name: 'globe europe africa', keywords: 'earth world map' },\n      { emoji: '🌏', name: 'globe asia', keywords: 'earth world map' },\n      { emoji: '🗺️', name: 'world map', keywords: 'earth globe travel' },\n    ],\n  },\n  {\n    id: 'activities',\n    label: 'Activities',\n    emoji: '⚽',\n    entries: [\n      { emoji: '⚽', name: 'soccer', keywords: 'football sport ball' },\n      { emoji: '🏀', name: 'basketball', keywords: 'sport ball hoop' },\n      { emoji: '🎮', name: 'video game', keywords: 'gaming controller play' },\n      { emoji: '🎯', name: 'direct hit', keywords: 'target bullseye goal' },\n      { emoji: '🎲', name: 'game die', keywords: 'dice random chance' },\n      { emoji: '🧩', name: 'puzzle', keywords: 'piece jigsaw game' },\n      { emoji: '🎨', name: 'artist palette', keywords: 'art paint draw color' },\n      { emoji: '🎵', name: 'musical note', keywords: 'music song sound' },\n      { emoji: '🎸', name: 'guitar', keywords: 'music instrument rock' },\n      { emoji: '🎬', name: 'clapper board', keywords: 'movie film cinema' },\n      { emoji: '📸', name: 'camera flash', keywords: 'photo picture' },\n      { emoji: '🏆', name: 'trophy', keywords: 'win prize award champion' },\n      { emoji: '🥇', name: 'gold medal', keywords: 'first winner' },\n      { emoji: '🎪', name: 'circus tent', keywords: 'carnival fun' },\n      { emoji: '🎭', name: 'performing arts', keywords: 'theater drama masks' },\n    ],\n  },\n  {\n    id: 'objects',\n    label: 'Objects',\n    emoji: '📦',\n    entries: [\n      { emoji: '📰', name: 'newspaper', keywords: 'news article press media' },\n      { emoji: '📄', name: 'page', keywords: 'document file paper' },\n      { emoji: '📋', name: 'clipboard', keywords: 'list copy paste' },\n      { emoji: '📌', name: 'pushpin', keywords: 'pin location mark' },\n      { emoji: '📎', name: 'paperclip', keywords: 'attach clip' },\n      { emoji: '🔗', name: 'link', keywords: 'chain url href' },\n      { emoji: '📦', name: 'package', keywords: 'box shipping delivery' },\n      { emoji: '🗂️', name: 'card index', keywords: 'folder organize dividers' },\n      { emoji: '📁', name: 'file folder', keywords: 'directory' },\n      { emoji: '📂', name: 'open folder', keywords: 'directory files' },\n      { emoji: '📝', name: 'memo', keywords: 'note write edit pencil' },\n      { emoji: '✏️', name: 'pencil', keywords: 'write edit draw' },\n      { emoji: '🖊️', name: 'pen', keywords: 'write sign' },\n      { emoji: '📐', name: 'triangular ruler', keywords: 'measure geometry' },\n      { emoji: '📏', name: 'straight ruler', keywords: 'measure length' },\n      { emoji: '🔍', name: 'magnifying glass', keywords: 'search find zoom' },\n      { emoji: '🔒', name: 'locked', keywords: 'secure private padlock' },\n      { emoji: '🔓', name: 'unlocked', keywords: 'open access' },\n      { emoji: '🔑', name: 'key', keywords: 'unlock password access' },\n      { emoji: '🔧', name: 'wrench', keywords: 'tool fix settings' },\n      { emoji: '🔨', name: 'hammer', keywords: 'tool build construct' },\n      { emoji: '⚙️', name: 'gear', keywords: 'settings config cog' },\n      { emoji: '🧲', name: 'magnet', keywords: 'attract pull' },\n      { emoji: '💾', name: 'floppy disk', keywords: 'save storage' },\n      { emoji: '💻', name: 'laptop', keywords: 'computer device' },\n      { emoji: '🖥️', name: 'desktop computer', keywords: 'monitor screen' },\n      { emoji: '📱', name: 'mobile phone', keywords: 'cell smartphone device' },\n      { emoji: '🖨️', name: 'printer', keywords: 'print output' },\n      { emoji: '📷', name: 'camera', keywords: 'photo picture' },\n      { emoji: '🎙️', name: 'microphone', keywords: 'audio record podcast' },\n      { emoji: '📡', name: 'satellite antenna', keywords: 'signal broadcast' },\n      { emoji: '🔔', name: 'bell', keywords: 'notification alert ring' },\n      { emoji: '📊', name: 'bar chart', keywords: 'graph statistics data' },\n      { emoji: '📈', name: 'chart increasing', keywords: 'graph growth up trend' },\n      { emoji: '📉', name: 'chart decreasing', keywords: 'graph down decline' },\n      { emoji: '🗓️', name: 'calendar', keywords: 'date schedule event' },\n      { emoji: '⏰', name: 'alarm clock', keywords: 'time timer' },\n      { emoji: '⏱️', name: 'stopwatch', keywords: 'time timer speed' },\n      { emoji: '🧪', name: 'test tube', keywords: 'science lab experiment' },\n      { emoji: '💊', name: 'pill', keywords: 'medicine health drug' },\n      { emoji: '🛒', name: 'shopping cart', keywords: 'buy store ecommerce' },\n      { emoji: '💰', name: 'money bag', keywords: 'cash dollar rich finance' },\n      { emoji: '💳', name: 'credit card', keywords: 'payment buy charge' },\n      { emoji: '📮', name: 'postbox', keywords: 'mail letter send' },\n      { emoji: '📬', name: 'open mailbox', keywords: 'email inbox receive' },\n      { emoji: '🏷️', name: 'label', keywords: 'tag price category' },\n      { emoji: '🧾', name: 'receipt', keywords: 'invoice bill purchase' },\n      { emoji: '📚', name: 'books', keywords: 'library read study' },\n      { emoji: '🎁', name: 'wrapped gift', keywords: 'present box surprise' },\n      { emoji: '🪄', name: 'magic wand', keywords: 'wizard spell sparkle' },\n    ],\n  },\n  {\n    id: 'symbols',\n    label: 'Symbols',\n    emoji: '⚡',\n    entries: [\n      { emoji: '⚡', name: 'zap', keywords: 'lightning bolt electric power' },\n      { emoji: '✅', name: 'check mark', keywords: 'done complete yes success' },\n      { emoji: '❌', name: 'cross mark', keywords: 'no wrong delete remove' },\n      { emoji: '⭐', name: 'star', keywords: 'favorite bookmark rating' },\n      { emoji: '🌟', name: 'glowing star', keywords: 'sparkle shine bright' },\n      { emoji: '💠', name: 'diamond', keywords: 'shape gem crystal' },\n      { emoji: '🔶', name: 'large orange diamond', keywords: 'shape' },\n      { emoji: '🔷', name: 'large blue diamond', keywords: 'shape' },\n      { emoji: '🔴', name: 'red circle', keywords: 'dot round' },\n      { emoji: '🟢', name: 'green circle', keywords: 'dot round' },\n      { emoji: '🔵', name: 'blue circle', keywords: 'dot round' },\n      { emoji: '🟡', name: 'yellow circle', keywords: 'dot round' },\n      { emoji: '🟣', name: 'purple circle', keywords: 'dot round' },\n      { emoji: '⬛', name: 'black square', keywords: 'shape' },\n      { emoji: '⬜', name: 'white square', keywords: 'shape' },\n      { emoji: '▶️', name: 'play button', keywords: 'start forward' },\n      { emoji: '⏸️', name: 'pause button', keywords: 'stop wait' },\n      { emoji: '⏹️', name: 'stop button', keywords: 'halt end' },\n      { emoji: '♻️', name: 'recycling symbol', keywords: 'eco green recycle' },\n      { emoji: '⚠️', name: 'warning', keywords: 'caution alert danger' },\n      { emoji: '🚫', name: 'prohibited', keywords: 'no ban forbidden stop' },\n      { emoji: 'ℹ️', name: 'information', keywords: 'info help about' },\n      { emoji: '❓', name: 'question mark', keywords: 'help what why' },\n      { emoji: '❗', name: 'exclamation mark', keywords: 'alert important bang' },\n      { emoji: '➕', name: 'plus', keywords: 'add new create' },\n      { emoji: '➖', name: 'minus', keywords: 'remove subtract delete' },\n      { emoji: '➡️', name: 'right arrow', keywords: 'forward next direction' },\n      { emoji: '⬅️', name: 'left arrow', keywords: 'back previous direction' },\n      { emoji: '⬆️', name: 'up arrow', keywords: 'top direction' },\n      { emoji: '⬇️', name: 'down arrow', keywords: 'bottom direction' },\n      { emoji: '↩️', name: 'right arrow curving left', keywords: 'return reply back undo' },\n      { emoji: '🔀', name: 'shuffle', keywords: 'random mix' },\n      { emoji: '🔁', name: 'repeat', keywords: 'loop cycle' },\n      { emoji: '♾️', name: 'infinity', keywords: 'forever unlimited' },\n      { emoji: '🏁', name: 'checkered flag', keywords: 'finish race end' },\n      { emoji: '🚩', name: 'triangular flag', keywords: 'report mark milestone' },\n      { emoji: '🔰', name: 'Japanese symbol for beginner', keywords: 'new start' },\n      { emoji: '💲', name: 'heavy dollar sign', keywords: 'money currency price' },\n      { emoji: '#️⃣', name: 'hash', keywords: 'number pound tag' },\n      { emoji: '🔣', name: 'input symbols', keywords: 'character special' },\n    ],\n  },\n];\n\n// ---------------------------------------------------------------------------\n// Iconoir Sidebar Icons (~50 curated for navigation / sidebar use)\n// ---------------------------------------------------------------------------\n\ninterface IconoirEntry {\n  value: string;\n  label: string;\n  keywords?: string;\n  category: string;\n}\n\nexport const ICONOIR_SIDEBAR_ICONS: IconoirEntry[] = [\n  // Content & Documents\n  { value: 'page', label: 'Page', keywords: 'document paper', category: 'Content' },\n  { value: 'page-edit', label: 'Page Edit', keywords: 'document write', category: 'Content' },\n  { value: 'journal', label: 'Journal', keywords: 'book notebook blog', category: 'Content' },\n  { value: 'book', label: 'Book', keywords: 'read documentation', category: 'Content' },\n  { value: 'clipboard', label: 'Clipboard', keywords: 'copy paste list', category: 'Content' },\n  { value: 'edit-pencil', label: 'Edit', keywords: 'write pencil compose', category: 'Content' },\n  { value: 'post', label: 'Post', keywords: 'article blog entry', category: 'Content' },\n  // Objects & Layout\n  { value: 'cube', label: 'Cube', keywords: 'box 3d model block', category: 'Objects' },\n  { value: 'view-grid', label: 'Grid', keywords: 'layout blocks tiles', category: 'Objects' },\n  { value: 'dashboard', label: 'Dashboard', keywords: 'home overview panel', category: 'Objects' },\n  { value: 'folder', label: 'Folder', keywords: 'directory files', category: 'Objects' },\n  { value: 'archive', label: 'Archive', keywords: 'box storage', category: 'Objects' },\n  { value: 'table-rows', label: 'Table', keywords: 'list rows data', category: 'Objects' },\n  { value: 'puzzle', label: 'Puzzle', keywords: 'piece component module', category: 'Objects' },\n  // People & Auth\n  { value: 'user', label: 'User', keywords: 'person account profile', category: 'People' },\n  { value: 'users', label: 'Users', keywords: 'people group team', category: 'People' },\n  { value: 'user-circle', label: 'User Circle', keywords: 'profile avatar', category: 'People' },\n  { value: 'shield', label: 'Shield', keywords: 'security auth role', category: 'People' },\n  { value: 'community', label: 'Community', keywords: 'group organization', category: 'People' },\n  { value: 'lock', label: 'Lock', keywords: 'secure private', category: 'People' },\n  // Commerce & Business\n  { value: 'building', label: 'Building', keywords: 'office company tenant', category: 'Business' },\n  { value: 'briefcase', label: 'Briefcase', keywords: 'work business', category: 'Business' },\n  { value: 'cart', label: 'Cart', keywords: 'shop ecommerce buy', category: 'Business' },\n  { value: 'credit-card', label: 'Credit Card', keywords: 'payment money', category: 'Business' },\n  { value: 'gift', label: 'Gift', keywords: 'present reward', category: 'Business' },\n  { value: 'shop', label: 'Shop', keywords: 'store ecommerce', category: 'Business' },\n  // Media\n  { value: 'media-image', label: 'Image', keywords: 'photo picture', category: 'Media' },\n  { value: 'camera', label: 'Camera', keywords: 'photo picture', category: 'Media' },\n  { value: 'play', label: 'Play', keywords: 'video media', category: 'Media' },\n  { value: 'music-note', label: 'Music', keywords: 'audio song', category: 'Media' },\n  { value: 'attachment', label: 'Attachment', keywords: 'file clip', category: 'Media' },\n  // Communication\n  { value: 'bell', label: 'Bell', keywords: 'notification alert', category: 'Communication' },\n  { value: 'chat-bubble', label: 'Chat', keywords: 'message comment', category: 'Communication' },\n  { value: 'mail', label: 'Mail', keywords: 'email message', category: 'Communication' },\n  { value: 'megaphone', label: 'Megaphone', keywords: 'announce broadcast', category: 'Communication' },\n  { value: 'send', label: 'Send', keywords: 'share submit', category: 'Communication' },\n  // System & Settings\n  { value: 'settings', label: 'Settings', keywords: 'config gear cog', category: 'System' },\n  { value: 'switch-on', label: 'Toggle', keywords: 'switch feature flag', category: 'System' },\n  { value: 'bug', label: 'Bug', keywords: 'debug error issue', category: 'System' },\n  { value: 'clock', label: 'Clock', keywords: 'time schedule activity', category: 'System' },\n  { value: 'database', label: 'Database', keywords: 'storage data', category: 'System' },\n  { value: 'code', label: 'Code', keywords: 'developer programming', category: 'System' },\n  { value: 'terminal', label: 'Terminal', keywords: 'console command line', category: 'System' },\n  // Misc & Navigation\n  { value: 'star', label: 'Star', keywords: 'favorite bookmark rating', category: 'Misc' },\n  { value: 'heart', label: 'Heart', keywords: 'love favorite', category: 'Misc' },\n  { value: 'bookmark', label: 'Bookmark', keywords: 'save favorite', category: 'Misc' },\n  { value: 'pin-alt', label: 'Pin', keywords: 'location map', category: 'Misc' },\n  { value: 'link', label: 'Link', keywords: 'url chain href', category: 'Misc' },\n  { value: 'search', label: 'Search', keywords: 'find magnifier', category: 'Misc' },\n  { value: 'download', label: 'Download', keywords: 'save get export', category: 'Misc' },\n  { value: 'cloud', label: 'Cloud', keywords: 'upload sync', category: 'Misc' },\n  { value: 'flash', label: 'Flash', keywords: 'lightning bolt fast', category: 'Misc' },\n  { value: 'calendar', label: 'Calendar', keywords: 'date event schedule', category: 'Misc' },\n  { value: 'graph-up', label: 'Analytics', keywords: 'chart statistics', category: 'Misc' },\n  { value: 'color-picker', label: 'Theme', keywords: 'color palette style', category: 'Misc' },\n  { value: 'globe', label: 'Globe', keywords: 'world international web', category: 'Misc' },\n  { value: 'rocket', label: 'Rocket', keywords: 'launch deploy fast', category: 'Misc' },\n  { value: 'flag', label: 'Flag', keywords: 'mark milestone report', category: 'Misc' },\n  { value: 'trash', label: 'Trash', keywords: 'delete remove', category: 'Misc' },\n];\n\n/** Build the built-in Iconoir tab from ICONOIR_SIDEBAR_ICONS. */\nexport function getBuiltinIconoirTab(): IconTab {\n  const entries: IconEntry[] = [];\n  const categories: { id: string; label: string; startIndex: number }[] = [];\n\n  const catOrder = ['Content', 'Objects', 'People', 'Business', 'Media', 'Communication', 'System', 'Misc'];\n  for (const catName of catOrder) {\n    const catEntries = ICONOIR_SIDEBAR_ICONS.filter((e) => e.category === catName);\n    if (catEntries.length === 0) continue;\n    categories.push({ id: catName.toLowerCase(), label: catName, startIndex: entries.length });\n    for (const e of catEntries) {\n      entries.push({\n        value: e.value,\n        label: e.label,\n        keywords: e.keywords,\n        display: renderIcon(`iconoir:${e.value}`, { size: '18px' }),\n      });\n    }\n  }\n\n  return {\n    id: 'iconoir',\n    label: 'Sidebar',\n    icon: '🧭',\n    entries,\n    categories,\n  };\n}\n\n// ---------------------------------------------------------------------------\n// SVG Icon Keys (from field-type-picker.ts, excluding cat-* internal icons)\n// ---------------------------------------------------------------------------\n\nexport const SVG_ICON_KEYS: string[] = [\n  'text', 'textarea', 'rich-text', 'markdown', 'code',\n  'number', 'integer', 'currency', 'percentage',\n  'select', 'radio', 'checkbox', 'chips', 'toggle',\n  'date', 'time', 'datetime',\n  'media-picker', 'media-gallery', 'file-upload',\n  'reference', 'references', 'user',\n  'group', 'repeater', 'blocks',\n  'json', 'slug', 'color', 'location',\n];\n\n// ---------------------------------------------------------------------------\n// Tab Builders\n// ---------------------------------------------------------------------------\n\n/** Build the built-in Emoji tab from EMOJI_CATEGORIES. */\nexport function getBuiltinEmojiTab(): IconTab {\n  const entries: IconEntry[] = [];\n  const categories: { id: string; label: string; startIndex: number }[] = [];\n\n  for (const cat of EMOJI_CATEGORIES) {\n    categories.push({ id: cat.id, label: cat.label, startIndex: entries.length });\n    for (const e of cat.entries) {\n      entries.push({\n        value: e.emoji,\n        label: e.name,\n        keywords: e.keywords,\n        display: e.emoji,\n      });\n    }\n  }\n\n  return {\n    id: 'emoji',\n    label: 'Emoji',\n    icon: '😀',\n    entries,\n    categories,\n  };\n}\n\n/** Build the built-in Icons tab from SVG_ICONS in field-type-picker.ts. */\nexport function getBuiltinIconsTab(): IconTab {\n  const entries: IconEntry[] = [];\n  for (const key of SVG_ICON_KEYS) {\n    const svg = iconForKey(key);\n    if (!svg) continue;\n    entries.push({\n      value: key,\n      label: key.replace(/-/g, ' '),\n      keywords: key.replace(/-/g, ' '),\n      display: svg,\n    });\n  }\n\n  return {\n    id: 'icons',\n    label: 'Icons',\n    icon: '◇',\n    entries,\n  };\n}\n","/**\n * Shared Icon Picker\n *\n * A popover-based icon/emoji picker component with:\n *   - Built-in Emoji and SVG Icons tabs\n *   - Global registry for custom tabs (per-project extensibility)\n *   - Trigger element that replaces plain text inputs\n *   - Search filtering, category grouping, dark mode\n *\n * Usage:\n *   import { renderIconTrigger, bindIconTriggerEvents } from './shared/icon-picker';\n *\n * Extension:\n *   import { registerIconTab } from './shared/icon-picker';\n *   registerIconTab({ id: 'custom', label: 'My Icons', entries: [...] });\n */\n\nimport { iconForKey } from '../field-type-picker';\nimport { inputClasses } from './field-input-classes';\nimport { getBuiltinEmojiTab, getBuiltinIconoirTab, getBuiltinIconsTab } from './icon-picker-data';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface IconEntry {\n  /** Stored value (emoji char or key string) */\n  value: string;\n  /** Display name for search */\n  label: string;\n  /** Extra search terms */\n  keywords?: string;\n  /** Rendered HTML (emoji text or SVG markup) */\n  display: string;\n}\n\nexport interface IconTab {\n  /** Unique tab ID */\n  id: string;\n  /** Tab button text */\n  label: string;\n  /** Tab button icon (emoji char or small HTML) */\n  icon?: string;\n  /** All selectable items */\n  entries: IconEntry[];\n  /** Optional category grouping within the tab */\n  categories?: { id: string; label: string; startIndex: number }[];\n}\n\nexport interface IconPickerConfig {\n  /** Current value */\n  value: string;\n  /** Called when user picks an icon */\n  onSelect: (value: string) => void;\n  /** Called when user clears the icon */\n  onClear?: () => void;\n  /** Compact mode (xs sizing) for block editor */\n  compact?: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Global Registry (singleton)\n// ---------------------------------------------------------------------------\n\nconst _tabs: IconTab[] = [];\nlet _initialized = false;\n\nfunction ensureBuiltins(): void {\n  if (_initialized) return;\n  _initialized = true;\n  _tabs.push(getBuiltinIconoirTab());\n  _tabs.push(getBuiltinEmojiTab());\n  _tabs.push(getBuiltinIconsTab());\n}\n\n/** Register a custom icon tab. Appears in all picker instances. */\nexport function registerIconTab(tab: IconTab): void {\n  ensureBuiltins();\n  const idx = _tabs.findIndex((t) => t.id === tab.id);\n  if (idx >= 0) {\n    _tabs[idx] = tab;\n  } else {\n    _tabs.push(tab);\n  }\n}\n\n/** Remove a tab by ID (including built-in tabs). */\nexport function unregisterIconTab(id: string): void {\n  ensureBuiltins();\n  const idx = _tabs.findIndex((t) => t.id === id);\n  if (idx >= 0) _tabs.splice(idx, 1);\n}\n\n/** Get all registered tabs. */\nexport function getIconTabs(): IconTab[] {\n  ensureBuiltins();\n  return _tabs;\n}\n\n// ---------------------------------------------------------------------------\n// Icon Resolution\n// ---------------------------------------------------------------------------\n\n/**\n * Resolve a stored icon value to displayable HTML.\n *\n * Resolution order:\n *   1. Empty → empty string\n *   2. iconForKey() match (built-in SVG icons) → SVG HTML\n *   3. Custom tab entry match → entry.display\n *   4. Passthrough (assumed emoji text)\n */\nexport function resolveIcon(value: string): string {\n  if (!value) return '';\n  const svg = iconForKey(value);\n  if (svg) return svg;\n\n  ensureBuiltins();\n  for (const tab of _tabs) {\n    const entry = tab.entries.find((e) => e.value === value);\n    if (entry) return entry.display;\n  }\n\n  return escapeHtml(value);\n}\n\n/**\n * Resolve a stored icon value to a label (for the trigger display).\n */\nfunction resolveLabel(value: string): string {\n  if (!value) return '';\n\n  ensureBuiltins();\n  for (const tab of _tabs) {\n    const entry = tab.entries.find((e) => e.value === value);\n    if (entry) return entry.label;\n  }\n\n  return value;\n}\n\n// ---------------------------------------------------------------------------\n// Trigger Renderer\n// ---------------------------------------------------------------------------\n\n/**\n * Render an icon picker trigger element.\n *\n * Replaces a plain `<input type=\"text\">` with a preview + open/clear buttons.\n * Contains a hidden input with the original field attribute(s) so that\n * existing event delegation (data-meta-field, data-ct-icon, name=...) still works.\n *\n * @param value   Current icon value (emoji or key)\n * @param fieldAttr  Attribute string for the hidden input, e.g. 'data-meta-field=\"icon\"' or 'name=\"icon\"'\n * @param compact  Use xs sizing\n */\nexport function renderIconTrigger(\n  value: string,\n  fieldAttr: string,\n  compact?: boolean,\n): string {\n  const resolved = resolveIcon(value);\n  const label = resolveLabel(value);\n  const hasValue = value.length > 0;\n\n  const height = compact ? 'h-[30px]' : 'h-[38px]';\n  const textSize = compact ? 'text-[12px]' : 'text-sm';\n  const iconSize = compact ? 'w-5 h-5 text-[14px]' : 'w-6 h-6 text-base';\n  const btnSize = compact ? 'w-5 h-5' : 'w-6 h-6';\n\n  return `\n    <div data-icon-trigger\n         class=\"flex items-center gap-1.5 ${height} px-2 border rounded-lg bg-white text-gray-900\n                dark:border-gray-600 dark:bg-slate-800 dark:text-white\n                hover:border-gray-400 dark:hover:border-gray-500\n                cursor-pointer transition-colors select-none\">\n      <span data-icon-preview\n            class=\"flex-shrink-0 ${iconSize} flex items-center justify-center rounded\n                   ${hasValue ? '' : 'text-gray-300 dark:text-gray-600'}\">\n        ${hasValue ? resolved : '?'}\n      </span>\n      <span data-icon-label\n            class=\"flex-1 min-w-0 truncate ${textSize} ${hasValue ? 'text-gray-700 dark:text-gray-300' : 'text-gray-400 dark:text-gray-500'}\">\n        ${hasValue ? escapeHtml(label) : 'Choose icon\\u2026'}\n      </span>\n      <button type=\"button\" data-icon-clear\n              class=\"flex-shrink-0 ${btnSize} flex items-center justify-center rounded\n                     text-gray-300 dark:text-gray-600\n                     hover:text-gray-500 dark:hover:text-gray-400\n                     hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\n                     ${hasValue ? '' : 'hidden'}\"\n              title=\"Clear icon\" aria-hidden=\"${hasValue ? 'false' : 'true'}\">\n        <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n        </svg>\n      </button>\n      <span class=\"flex-shrink-0 ${btnSize} flex items-center justify-center rounded\n                   text-gray-400 dark:text-gray-500\">\n        <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n        </svg>\n      </span>\n      <input type=\"hidden\" ${fieldAttr} value=\"${escapeHtml(value)}\" />\n    </div>`;\n}\n\n// ---------------------------------------------------------------------------\n// Popover State\n// ---------------------------------------------------------------------------\n\nlet _popoverEl: HTMLElement | null = null;\nlet _activeConfig: IconPickerConfig | null = null;\nlet _activeTrigger: HTMLElement | null = null;\nlet _activeTabId = 'iconoir';\nlet _searchQuery = '';\nlet _clickOutsideHandler: ((e: MouseEvent) => void) | null = null;\nlet _escapeHandler: ((e: KeyboardEvent) => void) | null = null;\n\n// ---------------------------------------------------------------------------\n// Popover Open / Close\n// ---------------------------------------------------------------------------\n\n/** Open the icon picker popover anchored to a trigger element. */\nexport function openIconPicker(\n  anchor: HTMLElement,\n  config: IconPickerConfig,\n): void {\n  // Close any existing popover first\n  closeIconPicker();\n\n  _activeConfig = config;\n  _activeTrigger = anchor;\n  _searchQuery = '';\n  _activeTabId = getIconTabs()[0]?.id ?? 'emoji';\n\n  // Create popover element\n  _popoverEl = document.createElement('div');\n  _popoverEl.setAttribute('data-icon-picker-popover', '');\n  _popoverEl.className = 'fixed';\n  // Compute z-index above the nearest modal backdrop (or fallback to 50)\n  _popoverEl.style.zIndex = String(getAncestorZIndex(anchor) + 5);\n  _popoverEl.innerHTML = renderPopoverContent();\n\n  document.body.appendChild(_popoverEl);\n  positionPopover(anchor);\n  bindPopoverEvents();\n\n  // Focus search\n  const searchInput = _popoverEl.querySelector<HTMLInputElement>('[data-icon-search]');\n  searchInput?.focus();\n\n  // Click-outside handler\n  _clickOutsideHandler = (e: MouseEvent) => {\n    const target = e.target as HTMLElement;\n    if (!target.closest('[data-icon-picker-popover]') && !target.closest('[data-icon-trigger]')) {\n      closeIconPicker();\n    }\n  };\n  // Defer so the opening click doesn't immediately close\n  setTimeout(() => {\n    if (_clickOutsideHandler) document.addEventListener('mousedown', _clickOutsideHandler);\n  }, 0);\n\n  // Escape handler\n  _escapeHandler = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') closeIconPicker();\n  };\n  document.addEventListener('keydown', _escapeHandler);\n}\n\n/** Close the icon picker popover. */\nexport function closeIconPicker(): void {\n  if (_popoverEl) {\n    _popoverEl.remove();\n    _popoverEl = null;\n  }\n  if (_clickOutsideHandler) {\n    document.removeEventListener('mousedown', _clickOutsideHandler);\n    _clickOutsideHandler = null;\n  }\n  if (_escapeHandler) {\n    document.removeEventListener('keydown', _escapeHandler);\n    _escapeHandler = null;\n  }\n  _activeConfig = null;\n  _activeTrigger = null;\n}\n\n// ---------------------------------------------------------------------------\n// Popover Positioning\n// ---------------------------------------------------------------------------\n\nfunction positionPopover(anchor: HTMLElement): void {\n  if (!_popoverEl) return;\n\n  const rect = anchor.getBoundingClientRect();\n  const popoverWidth = 320;\n  const popoverHeight = 380;\n\n  let top = rect.bottom + 4;\n  let left = rect.left;\n\n  // Flip up if near bottom of viewport\n  if (top + popoverHeight > window.innerHeight - 8) {\n    top = rect.top - popoverHeight - 4;\n  }\n\n  // Keep within horizontal bounds\n  if (left + popoverWidth > window.innerWidth - 8) {\n    left = window.innerWidth - popoverWidth - 8;\n  }\n  if (left < 8) left = 8;\n\n  _popoverEl.style.top = `${top}px`;\n  _popoverEl.style.left = `${left}px`;\n  _popoverEl.style.width = `${popoverWidth}px`;\n}\n\n// ---------------------------------------------------------------------------\n// Popover Content Renderer\n// ---------------------------------------------------------------------------\n\nfunction renderPopoverContent(): string {\n  const tabs = getIconTabs();\n  const activeTab = tabs.find((t) => t.id === _activeTabId) ?? tabs[0];\n\n  // Filter entries by search query\n  let filteredEntries: { entry: IconEntry; tabId: string }[] = [];\n  if (_searchQuery) {\n    const q = _searchQuery.toLowerCase();\n    for (const tab of tabs) {\n      for (const entry of tab.entries) {\n        if (\n          entry.label.toLowerCase().includes(q) ||\n          entry.value.toLowerCase().includes(q) ||\n          (entry.keywords ?? '').toLowerCase().includes(q)\n        ) {\n          filteredEntries.push({ entry, tabId: tab.id });\n        }\n      }\n    }\n  } else if (activeTab) {\n    filteredEntries = activeTab.entries.map((entry) => ({ entry, tabId: activeTab.id }));\n  }\n\n  // Tab bar\n  const tabBarHtml = tabs.map((tab) => {\n    const isActive = tab.id === _activeTabId;\n    return `\n      <button type=\"button\" data-icon-tab=\"${escapeHtml(tab.id)}\"\n              class=\"px-2 py-1 text-[11px] font-medium rounded-md transition-colors whitespace-nowrap\n                     ${isActive\n                       ? 'bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300'\n                       : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-700 dark:hover:text-gray-300'\n                     }\">\n        ${tab.icon ? `<span class=\"mr-0.5\">${tab.icon}</span>` : ''}${escapeHtml(tab.label)}\n      </button>`;\n  }).join('');\n\n  // Grid content\n  let gridHtml: string;\n  if (filteredEntries.length === 0) {\n    gridHtml = `<div class=\"text-center py-6 text-xs text-gray-400 dark:text-gray-500\">No matching icons</div>`;\n  } else if (_searchQuery) {\n    // When searching: flat grid, no categories\n    gridHtml = renderGrid(filteredEntries.map((f) => f.entry));\n  } else if (activeTab?.categories && activeTab.categories.length > 0) {\n    // Render with category headers\n    gridHtml = '';\n    for (let i = 0; i < activeTab.categories.length; i++) {\n      const cat = activeTab.categories[i];\n      const nextStart = activeTab.categories[i + 1]?.startIndex ?? activeTab.entries.length;\n      const catEntries = activeTab.entries.slice(cat.startIndex, nextStart);\n      if (catEntries.length === 0) continue;\n      gridHtml += `\n        <div class=\"text-[10px] font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider px-1 pt-2 pb-1\">${escapeHtml(cat.label)}</div>`;\n      gridHtml += renderGrid(catEntries);\n    }\n  } else {\n    gridHtml = renderGrid(filteredEntries.map((f) => f.entry));\n  }\n\n  return `\n    <div class=\"bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl\n                flex flex-col overflow-hidden\" style=\"max-height: 380px;\">\n      <div class=\"px-3 pt-3 pb-2 space-y-2 flex-shrink-0\">\n        <div class=\"relative\">\n          <input type=\"text\" data-icon-search\n                 placeholder=\"Search icons\\u2026\"\n                 value=\"${escapeHtml(_searchQuery)}\"\n                 class=\"${inputClasses('xs')}\" />\n        </div>\n        <div class=\"flex items-center gap-1 overflow-x-auto\" data-icon-tab-bar>\n          ${tabBarHtml}\n        </div>\n      </div>\n      <div class=\"flex-1 overflow-y-auto px-3 pb-2\" data-icon-grid-area>\n        ${gridHtml}\n      </div>\n      <div class=\"flex-shrink-0 border-t border-gray-100 dark:border-gray-700 px-3 py-2\">\n        <button type=\"button\" data-icon-clear-btn\n                class=\"w-full text-center text-[11px] text-gray-400 dark:text-gray-500\n                       hover:text-red-500 dark:hover:text-red-400 transition-colors py-1\">\n          Clear selection\n        </button>\n      </div>\n    </div>`;\n}\n\nfunction renderGrid(entries: IconEntry[]): string {\n  let html = '<div class=\"grid grid-cols-8 gap-0.5\">';\n  for (const entry of entries) {\n    const isEmoji = !entry.display.startsWith('<');\n    html += `\n      <button type=\"button\" data-icon-pick=\"${escapeHtml(entry.value)}\"\n              title=\"${escapeHtml(entry.label)}\"\n              class=\"w-8 h-8 flex items-center justify-center rounded-md\n                     hover:bg-gray-100 dark:hover:bg-gray-700\n                     transition-colors cursor-pointer\n                     ${isEmoji ? 'text-lg' : 'text-gray-600 dark:text-gray-300'}\">\n        ${isEmoji ? entry.display : `<span class=\"w-5 h-5 flex items-center justify-center\">${entry.display}</span>`}\n      </button>`;\n  }\n  html += '</div>';\n  return html;\n}\n\n// ---------------------------------------------------------------------------\n// Popover Event Binding\n// ---------------------------------------------------------------------------\n\nfunction bindPopoverEvents(): void {\n  if (!_popoverEl) return;\n\n  // Search\n  const searchInput = _popoverEl.querySelector<HTMLInputElement>('[data-icon-search]');\n  searchInput?.addEventListener('input', () => {\n    _searchQuery = searchInput.value;\n    refreshPopoverContent();\n  });\n\n  // Tab clicks\n  _popoverEl.addEventListener('click', (e) => {\n    const target = e.target as HTMLElement;\n\n    // Tab button\n    const tabBtn = target.closest<HTMLElement>('[data-icon-tab]');\n    if (tabBtn) {\n      _activeTabId = tabBtn.dataset.iconTab!;\n      _searchQuery = '';\n      refreshPopoverContent();\n      return;\n    }\n\n    // Icon pick\n    const pickBtn = target.closest<HTMLElement>('[data-icon-pick]');\n    if (pickBtn && _activeConfig) {\n      const value = pickBtn.dataset.iconPick!;\n      _activeConfig.onSelect(value);\n      if (_activeTrigger) {\n        updateTriggerDisplay(_activeTrigger, value);\n      }\n      closeIconPicker();\n      return;\n    }\n\n    // Clear\n    const clearBtn = target.closest<HTMLElement>('[data-icon-clear-btn]');\n    if (clearBtn && _activeConfig) {\n      if (_activeConfig.onClear) {\n        _activeConfig.onClear();\n      } else {\n        _activeConfig.onSelect('');\n      }\n      if (_activeTrigger) {\n        updateTriggerDisplay(_activeTrigger, '');\n      }\n      closeIconPicker();\n    }\n  });\n}\n\nfunction refreshPopoverContent(): void {\n  if (!_popoverEl) return;\n  const container = _popoverEl.querySelector<HTMLElement>('.bg-white, .dark\\\\:bg-slate-800');\n  if (!container) {\n    _popoverEl.innerHTML = renderPopoverContent();\n    bindPopoverEvents();\n    return;\n  }\n\n  // Re-render full content and swap\n  const scrollTop = _popoverEl.querySelector('[data-icon-grid-area]')?.scrollTop ?? 0;\n  _popoverEl.innerHTML = renderPopoverContent();\n  bindPopoverEvents();\n\n  // Restore scroll\n  const gridArea = _popoverEl.querySelector('[data-icon-grid-area]');\n  if (gridArea) gridArea.scrollTop = scrollTop;\n\n  // Restore search focus & cursor\n  const searchInput = _popoverEl.querySelector<HTMLInputElement>('[data-icon-search]');\n  if (searchInput) {\n    searchInput.focus();\n    searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Trigger Event Binding\n// ---------------------------------------------------------------------------\n\nfunction updateTriggerDisplay(trigger: HTMLElement, value: string): void {\n  const hasValue = value.length > 0;\n  const preview = trigger.querySelector<HTMLElement>('[data-icon-preview]');\n  const label = trigger.querySelector<HTMLElement>('[data-icon-label]');\n  const clearBtn = trigger.querySelector<HTMLElement>('[data-icon-clear]');\n\n  if (preview) {\n    preview.innerHTML = hasValue ? resolveIcon(value) : '?';\n    preview.classList.toggle('text-gray-300', !hasValue);\n    preview.classList.toggle('dark:text-gray-600', !hasValue);\n  }\n\n  if (label) {\n    label.textContent = hasValue ? resolveLabel(value) : 'Choose icon\\u2026';\n    label.classList.toggle('text-gray-400', !hasValue);\n    label.classList.toggle('dark:text-gray-500', !hasValue);\n    label.classList.toggle('text-gray-700', hasValue);\n    label.classList.toggle('dark:text-gray-300', hasValue);\n  }\n\n  if (clearBtn) {\n    clearBtn.classList.toggle('hidden', !hasValue);\n    clearBtn.setAttribute('aria-hidden', hasValue ? 'false' : 'true');\n  }\n}\n\n/**\n * Bind click events on icon trigger elements within a container.\n *\n * @param container  Parent element containing icon triggers\n * @param selector   CSS selector for trigger elements (e.g. '[data-icon-trigger]')\n * @param getConfig  Factory function that returns IconPickerConfig for a given trigger\n */\nexport function bindIconTriggerEvents(\n  container: HTMLElement,\n  selector: string,\n  getConfig: (trigger: HTMLElement) => IconPickerConfig,\n): void {\n  container.querySelectorAll<HTMLElement>(selector).forEach((trigger) => {\n    // Open on click (anywhere on trigger except clear button)\n    trigger.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n\n      // Clear button\n      if (target.closest('[data-icon-clear]')) {\n        e.stopPropagation();\n        const config = getConfig(trigger);\n        if (config.onClear) {\n          config.onClear();\n        } else {\n          config.onSelect('');\n        }\n        updateTriggerDisplay(trigger, '');\n        return;\n      }\n\n      // Open picker (toggle if already open for this trigger)\n      if (_activeTrigger === trigger && _popoverEl) {\n        closeIconPicker();\n      } else {\n        openIconPicker(trigger, getConfig(trigger));\n      }\n    });\n  });\n}\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\n/** Walk up the DOM to find the nearest ancestor with an inline z-index (e.g. modal backdrop). */\nfunction getAncestorZIndex(el: HTMLElement): number {\n  let node: HTMLElement | null = el;\n  while (node) {\n    const z = parseInt(node.style.zIndex, 10);\n    if (!isNaN(z) && z > 0) return z;\n    node = node.parentElement;\n  }\n  return 50;\n}\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n","/**\n * Shared Block Picker\n *\n * Extracted from field-config-form.ts BlockPickerModal.\n * Provides reusable block loading, normalization, and inline rendering\n * for both the expanded field card (block-editor-panel) and the\n * FieldConfigForm modal.\n */\n\nimport type { BlockDefinitionSummary } from '../types';\nimport type { ContentTypeAPIClient } from '../api-client';\nimport { checkboxClasses } from './field-input-classes';\nimport { resolveIcon } from './icon-picker';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface InlineBlockPickerConfig {\n  /** Available blocks (call loadAvailableBlocks first) */\n  availableBlocks: BlockDefinitionSummary[];\n  /** Currently selected block keys */\n  selectedBlocks: Set<string>;\n  /** Optional search filter */\n  searchQuery?: string;\n  /** Callback when selection changes */\n  onSelectionChange: (selected: Set<string>) => void;\n  /** Label shown above the list (default: \"Allowed Blocks\") */\n  label?: string;\n  /** Color accent: 'blue' for allowed, 'red' for denied */\n  accent?: 'blue' | 'red';\n  /** Optional label when selection is empty (e.g., \"All blocks allowed\") */\n  emptySelectionText?: string;\n}\n\n// ---------------------------------------------------------------------------\n// Block Loading\n// ---------------------------------------------------------------------------\n\n/**\n * Load available block definitions from the API.\n */\nexport async function loadAvailableBlocks(api: ContentTypeAPIClient): Promise<BlockDefinitionSummary[]> {\n  return await api.listBlockDefinitionsSummary();\n}\n\n// ---------------------------------------------------------------------------\n// Block Key + Normalization\n// ---------------------------------------------------------------------------\n\n/** Canonical key for a block: prefers slug, falls back to type */\nexport function blockKey(block: BlockDefinitionSummary): string {\n  return (block.slug || block.type || '').trim();\n}\n\n/**\n * Normalize a set of selected block keys against the available blocks.\n * Handles legacy type-based keys by mapping them to slugs.\n */\nexport function normalizeBlockSelection(\n  selected: Set<string>,\n  available: BlockDefinitionSummary[],\n): Set<string> {\n  if (selected.size === 0 || available.length === 0) return new Set(selected);\n\n  const normalized = new Set<string>();\n  const mappedLegacy = new Set<string>();\n\n  for (const block of available) {\n    const key = blockKey(block);\n    if (!key) continue;\n    const hasKey = selected.has(key);\n    const hasType = selected.has(block.type);\n    if (hasKey || hasType) {\n      normalized.add(key);\n      if (hasType && block.slug && block.slug !== block.type) {\n        mappedLegacy.add(block.type);\n      }\n    }\n  }\n\n  // Keep any keys that weren't mapped (may reference blocks not yet loaded)\n  for (const value of selected) {\n    if (mappedLegacy.has(value)) continue;\n    if (!normalized.has(value)) {\n      normalized.add(value);\n    }\n  }\n\n  return normalized;\n}\n\n// ---------------------------------------------------------------------------\n// Inline Renderer\n// ---------------------------------------------------------------------------\n\n/**\n * Render an inline block picker (checkbox list with search).\n * Designed for use inside an expanded field card.\n */\nexport function renderInlineBlockPicker(config: InlineBlockPickerConfig): string {\n  const { availableBlocks, selectedBlocks, searchQuery } = config;\n  const accent = config.accent ?? 'blue';\n  const label = config.label ?? 'Allowed Blocks';\n  const emptySelectionText = config.emptySelectionText;\n\n  if (availableBlocks.length === 0) {\n    return `\n      <div class=\"text-center py-4 text-xs text-gray-400 dark:text-gray-500\">\n        No block definitions available.\n      </div>`;\n  }\n\n  const filtered = searchQuery\n    ? availableBlocks.filter((b) => {\n        const q = searchQuery.toLowerCase();\n        return b.name.toLowerCase().includes(q)\n          || blockKey(b).toLowerCase().includes(q)\n          || (b.category ?? '').toLowerCase().includes(q);\n      })\n    : availableBlocks;\n\n  // Group by category\n  const grouped = new Map<string, BlockDefinitionSummary[]>();\n  for (const block of filtered) {\n    const cat = block.category || 'uncategorized';\n    if (!grouped.has(cat)) grouped.set(cat, []);\n    grouped.get(cat)!.push(block);\n  }\n\n  const count = selectedBlocks.size;\n  const countText = count === 0 && emptySelectionText ? emptySelectionText : `${count} selected`;\n  const focusRing = accent === 'red' ? 'focus:ring-red-500' : 'focus:ring-blue-500';\n  const selectedClass = accent === 'red'\n    ? 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700'\n    : 'bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700';\n  let html = `\n    <div class=\"space-y-2\" data-block-picker-inline>\n      <div class=\"flex items-center justify-between\">\n        <span class=\"text-[10px] font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">${escapeHtml(label)}</span>\n        <span class=\"text-[10px] text-gray-400 dark:text-gray-500\">${escapeHtml(countText)}</span>\n      </div>\n      <div class=\"relative\">\n        <input type=\"text\" data-block-picker-search\n               placeholder=\"Search blocks...\"\n               value=\"${escapeHtml(searchQuery ?? '')}\"\n               class=\"w-full px-2 py-1 text-[12px] border border-gray-200 dark:border-gray-600 rounded-md bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-1 ${focusRing}\" />\n      </div>\n      <div class=\"max-h-[200px] overflow-y-auto space-y-1\" data-block-picker-list>`;\n\n  if (filtered.length === 0) {\n    html += `\n        <div class=\"text-center py-3 text-xs text-gray-400 dark:text-gray-500\">No matching blocks</div>`;\n  } else {\n    for (const [cat, blocks] of grouped) {\n      if (grouped.size > 1) {\n        html += `\n        <div class=\"text-[10px] font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider pt-1\">${escapeHtml(titleCase(cat))}</div>`;\n      }\n      for (const block of blocks) {\n        const key = blockKey(block);\n        const isSelected = selectedBlocks.has(key) || selectedBlocks.has(block.type);\n        html += `\n        <label class=\"flex items-center gap-2 px-2 py-1.5 rounded-md cursor-pointer transition-colors ${\n          isSelected\n            ? selectedClass\n            : 'hover:bg-gray-50 dark:hover:bg-gray-800 border border-transparent'\n        }\">\n          <input type=\"checkbox\" value=\"${escapeHtml(key)}\" data-block-type=\"${escapeHtml(block.type)}\"\n                 ${isSelected ? 'checked' : ''}\n                 class=\"${checkboxClasses()}\" />\n          <div class=\"flex-shrink-0 flex items-center justify-center w-6 h-6 rounded bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] font-medium\">\n            ${block.icon ? resolveIcon(block.icon) : key.charAt(0).toUpperCase()}\n          </div>\n          <div class=\"flex-1 min-w-0\">\n            <span class=\"text-[12px] font-medium text-gray-800 dark:text-gray-200\">${escapeHtml(block.name)}</span>\n            <span class=\"text-[10px] text-gray-400 dark:text-gray-500 font-mono ml-1\">${escapeHtml(key)}</span>\n          </div>\n        </label>`;\n      }\n    }\n  }\n\n  html += `\n      </div>\n    </div>`;\n  return html;\n}\n\n// ---------------------------------------------------------------------------\n// Event Binding\n// ---------------------------------------------------------------------------\n\n/**\n * Bind events for an inline block picker.\n * Call after inserting renderInlineBlockPicker HTML into the DOM.\n */\nexport function bindInlineBlockPickerEvents(\n  container: HTMLElement,\n  config: InlineBlockPickerConfig,\n): void {\n  const pickerRoot = container.querySelector<HTMLElement>('[data-block-picker-inline]');\n  if (!pickerRoot) return;\n\n  // Search\n  const searchInput = pickerRoot.querySelector<HTMLInputElement>('[data-block-picker-search]');\n  searchInput?.addEventListener('input', () => {\n    config.searchQuery = searchInput.value;\n    refreshInlineBlockPickerList(pickerRoot, config);\n  });\n\n  // Checkboxes\n  const listEl = pickerRoot.querySelector<HTMLElement>('[data-block-picker-list]');\n  if (listEl) bindCheckboxEvents(listEl, config);\n}\n\nfunction bindCheckboxEvents(\n  listEl: HTMLElement,\n  config: InlineBlockPickerConfig,\n): void {\n  listEl.querySelectorAll<HTMLInputElement>('input[type=\"checkbox\"]').forEach((checkbox) => {\n    checkbox.addEventListener('change', () => {\n      const key = checkbox.value;\n      const legacyType = checkbox.dataset.blockType;\n      if (checkbox.checked) {\n        config.selectedBlocks.add(key);\n        if (legacyType && legacyType !== key) {\n          config.selectedBlocks.delete(legacyType);\n        }\n      } else {\n        config.selectedBlocks.delete(key);\n        if (legacyType) {\n          config.selectedBlocks.delete(legacyType);\n        }\n      }\n      config.onSelectionChange(config.selectedBlocks);\n      const pickerRoot = listEl.closest<HTMLElement>('[data-block-picker-inline]');\n      if (pickerRoot) {\n        refreshInlineBlockPickerList(pickerRoot, config);\n      }\n    });\n  });\n}\n\nfunction refreshInlineBlockPickerList(\n  pickerRoot: HTMLElement,\n  config: InlineBlockPickerConfig,\n): void {\n  const listEl = pickerRoot.querySelector<HTMLElement>('[data-block-picker-list]');\n  if (!listEl) return;\n  const scrollTop = listEl.scrollTop;\n  const tempDiv = document.createElement('div');\n  tempDiv.innerHTML = renderInlineBlockPicker(config);\n  const newList = tempDiv.querySelector('[data-block-picker-list]');\n  const newCount = tempDiv.querySelector('[data-block-picker-inline] > div > span:last-child');\n  if (newList) {\n    listEl.innerHTML = newList.innerHTML;\n    listEl.scrollTop = scrollTop;\n    bindCheckboxEvents(listEl, config);\n  }\n  const countEl = pickerRoot.querySelector(':scope > div > span:last-child');\n  if (countEl && newCount) countEl.textContent = newCount.textContent;\n}\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\nfunction titleCase(str: string): string {\n  return str\n    .replace(/_/g, ' ')\n    .replace(/\\b\\w/g, (c) => c.toUpperCase());\n}\n","function trimTrailingSlash(value: string): string {\n  return value.replace(/\\/+$/, '');\n}\n\nfunction normalizeApiBasePath(value: string): string {\n  const raw = value.trim();\n  if (!raw) return '';\n  const trimmed = trimTrailingSlash(raw);\n  if (!trimmed) return '/api';\n  if (/\\/api(\\/|$)/.test(trimmed)) return trimmed;\n  return `${trimmed}/api`;\n}\n\nexport function resolveApiBasePath(...candidates: Array<string | undefined>): string {\n  for (const candidate of candidates) {\n    const trimmed = (candidate || '').trim();\n    if (trimmed) return normalizeApiBasePath(trimmed);\n  }\n\n  const docBase =\n    document.documentElement?.getAttribute('data-api-base-path') ||\n    document.body?.getAttribute('data-api-base-path');\n  if (docBase && docBase.trim()) {\n    return normalizeApiBasePath(docBase.trim());\n  }\n\n  const docAdminBase =\n    document.documentElement?.getAttribute('data-base-path') ||\n    document.body?.getAttribute('data-base-path');\n  if (docAdminBase && docAdminBase.trim()) {\n    return normalizeApiBasePath(docAdminBase.trim());\n  }\n\n  const debugConfig = (window as any)?.DEBUG_CONFIG;\n  if (typeof debugConfig?.apiBasePath === 'string' && debugConfig.apiBasePath.trim()) {\n    return normalizeApiBasePath(debugConfig.apiBasePath.trim());\n  }\n  if (typeof debugConfig?.basePath === 'string' && debugConfig.basePath.trim()) {\n    return normalizeApiBasePath(debugConfig.basePath.trim());\n  }\n\n  return '';\n}\n\nexport function deriveAdminBasePath(apiBasePath: string, fallbackBasePath?: string): string {\n  const fallback = (fallbackBasePath || '').trim();\n  if (fallback) return trimTrailingSlash(fallback);\n\n  const trimmed = trimTrailingSlash((apiBasePath || '').trim());\n  if (!trimmed) return '';\n\n  const match = trimmed.match(/^(.*)\\/api(?:\\/[^/]+)?$/);\n  if (match) return match[1] || '';\n  return trimmed;\n}\n","/**\n * Field Configuration Form\n *\n * Modal/drawer UI for configuring a field's properties.\n */\n\nimport type {\n  FieldDefinition,\n  FieldConfigFormConfig,\n  FieldType,\n  SelectOption,\n  SlugFieldConfig,\n  ColorFieldConfig,\n  LocationFieldConfig,\n  DateRangeFieldConfig,\n  RepeaterFieldConfig,\n  BlocksFieldConfig,\n  BlockDefinitionSummary,\n} from './types';\nimport { getFieldTypeMetadata, FIELD_TYPES } from './field-type-picker';\nimport { generateFieldId, ContentTypeAPIClient } from './api-client';\nimport { Modal } from '../shared/modal';\nimport { inputClasses, selectClasses, textareaClasses, checkboxClasses, labelClasses } from './shared/field-input-classes';\nimport { loadAvailableBlocks, blockKey as sharedBlockKey, normalizeBlockSelection } from './shared/block-picker';\nimport { resolveApiBasePath } from './shared/api-paths';\n\n// =============================================================================\n// Field Config Form Component\n// =============================================================================\n\nexport class FieldConfigForm extends Modal {\n  private config: FieldConfigFormConfig;\n  private field: FieldDefinition;\n  private isNewField: boolean;\n\n  constructor(config: FieldConfigFormConfig) {\n    super({\n      size: '2xl',\n      initialFocus: 'input[name=\"name\"]',\n      backdropDataAttr: 'data-field-config-backdrop',\n    });\n    this.config = config;\n    this.field = { ...config.field };\n    this.isNewField = !config.field.id || config.field.id.startsWith('new_');\n  }\n\n  protected onBeforeHide(): boolean {\n    this.config.onCancel();\n    return true;\n  }\n\n  protected renderContent(): string {\n    const fieldMeta = getFieldTypeMetadata(this.field.type);\n\n    return `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center gap-3\">\n          <span class=\"flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 text-lg font-medium\">\n            ${fieldMeta?.icon ?? '?'}\n          </span>\n          <div>\n            <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              ${this.isNewField ? 'Add' : 'Edit'} ${fieldMeta?.label ?? 'Field'}\n            </h2>\n            <p class=\"text-sm text-gray-500 dark:text-gray-400\">${fieldMeta?.description ?? ''}</p>\n          </div>\n        </div>\n        <button type=\"button\" data-field-config-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto px-6 py-4\">\n        <form data-field-config-form-element class=\"space-y-6\">\n          ${this.renderGeneralSection()}\n          ${this.renderValidationSection()}\n          ${this.renderAppearanceSection()}\n          ${this.renderTypeSpecificSection()}\n        </form>\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-field-config-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-field-config-save\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          ${this.isNewField ? 'Add Field' : 'Save Changes'}\n        </button>\n      </div>\n    `;\n  }\n\n  private renderGeneralSection(): string {\n    return `\n      <div class=\"space-y-4\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">General</h3>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label class=\"${labelClasses()}\">\n              Field Name <span class=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              name=\"name\"\n              value=\"${escapeHtml(this.field.name)}\"\n              placeholder=\"field_name\"\n              pattern=\"^[a-z][a-z0-9_]*$\"\n              required\n              class=\"${inputClasses()}\"\n            />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Lowercase letters, numbers, underscores. Starts with letter.</p>\n          </div>\n\n          <div>\n            <label class=\"${labelClasses()}\">\n              Label <span class=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              name=\"label\"\n              value=\"${escapeHtml(this.field.label)}\"\n              placeholder=\"Field Label\"\n              required\n              class=\"${inputClasses()}\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <label class=\"${labelClasses()}\">\n            Description\n          </label>\n          <textarea\n            name=\"description\"\n            rows=\"2\"\n            placeholder=\"Help text for editors\"\n            class=\"${textareaClasses()}\"\n          >${escapeHtml(this.field.description ?? '')}</textarea>\n        </div>\n\n        <div>\n          <label class=\"${labelClasses()}\">\n            Placeholder\n          </label>\n          <input\n            type=\"text\"\n            name=\"placeholder\"\n            value=\"${escapeHtml(this.field.placeholder ?? '')}\"\n            placeholder=\"Placeholder text\"\n            class=\"${inputClasses()}\"\n          />\n        </div>\n\n        <div class=\"flex items-center gap-6\">\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"required\"\n              ${this.field.required ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Required</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"readonly\"\n              ${this.field.readonly ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Read-only</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"hidden\"\n              ${this.field.hidden ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Hidden</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"filterable\"\n              ${this.field.filterable ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Filterable</span>\n          </label>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderValidationSection(): string {\n    const validation = this.field.validation ?? {};\n    const showStringValidation = ['text', 'textarea', 'rich-text', 'markdown', 'code', 'slug'].includes(\n      this.field.type\n    );\n    const showNumberValidation = ['number', 'integer', 'currency', 'percentage'].includes(this.field.type);\n\n    if (!showStringValidation && !showNumberValidation) {\n      return '';\n    }\n\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Validation</h3>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          ${\n            showStringValidation\n              ? `\n            <div>\n              <label class=\"${labelClasses()}\">\n                Min Length\n              </label>\n              <input\n                type=\"number\"\n                name=\"minLength\"\n                value=\"${validation.minLength ?? ''}\"\n                min=\"0\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Max Length\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxLength\"\n                value=\"${validation.maxLength ?? ''}\"\n                min=\"0\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          `\n              : ''\n          }\n\n          ${\n            showNumberValidation\n              ? `\n            <div>\n              <label class=\"${labelClasses()}\">\n                Minimum\n              </label>\n              <input\n                type=\"number\"\n                name=\"min\"\n                value=\"${validation.min ?? ''}\"\n                step=\"any\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Maximum\n              </label>\n              <input\n                type=\"number\"\n                name=\"max\"\n                value=\"${validation.max ?? ''}\"\n                step=\"any\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          `\n              : ''\n          }\n        </div>\n\n        ${\n          showStringValidation\n            ? `\n          <div>\n            <label class=\"${labelClasses()}\">\n              Pattern (RegEx)\n            </label>\n            <input\n              type=\"text\"\n              name=\"pattern\"\n              value=\"${escapeHtml(validation.pattern ?? '')}\"\n              placeholder=\"^[a-z]+$\"\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono\"\n            />\n          </div>\n        `\n            : ''\n        }\n      </div>\n    `;\n  }\n\n  private renderAppearanceSection(): string {\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Appearance</h3>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label class=\"${labelClasses()}\">\n              Section/Tab\n            </label>\n            <input\n              type=\"text\"\n              name=\"section\"\n              value=\"${escapeHtml(this.field.section ?? '')}\"\n              placeholder=\"main\"\n              class=\"${inputClasses()}\"\n            />\n          </div>\n\n          <div>\n            <label class=\"${labelClasses()}\">\n              Grid Span (1-12)\n            </label>\n            <input\n              type=\"number\"\n              name=\"gridSpan\"\n              value=\"${this.field.gridSpan ?? ''}\"\n              min=\"1\"\n              max=\"12\"\n              placeholder=\"12\"\n              class=\"${inputClasses()}\"\n            />\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTypeSpecificSection(): string {\n    const sections: string[] = [];\n\n    // Select/Radio/Chips options\n    if (['select', 'radio', 'chips'].includes(this.field.type)) {\n      const config = this.field.config as { options?: SelectOption[] } | undefined;\n      const options = config?.options ?? [];\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <div class=\"flex items-center justify-between\">\n            <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Options</h3>\n            <button\n              type=\"button\"\n              data-add-option\n              class=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n            >\n              + Add Option\n            </button>\n          </div>\n\n          <div data-options-list class=\"space-y-2\">\n            ${options\n              .map(\n                (opt, i) => `\n              <div class=\"flex items-center gap-2\" data-option-row=\"${i}\">\n                <input\n                  type=\"text\"\n                  name=\"option_value_${i}\"\n                  value=\"${escapeHtml(String(opt.value))}\"\n                  placeholder=\"value\"\n                  class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n                <input\n                  type=\"text\"\n                  name=\"option_label_${i}\"\n                  value=\"${escapeHtml(opt.label)}\"\n                  placeholder=\"label\"\n                  class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n                <button\n                  type=\"button\"\n                  data-remove-option=\"${i}\"\n                  class=\"p-2 text-gray-400 hover:text-red-500\"\n                >\n                  <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                  </svg>\n                </button>\n              </div>\n            `\n              )\n              .join('')}\n          </div>\n        </div>\n      `);\n    }\n\n    // Reference target\n    if (['reference', 'references', 'user'].includes(this.field.type)) {\n      const config = this.field.config as { target?: string; displayField?: string } | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Reference Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Target Content Type\n              </label>\n              <input\n                type=\"text\"\n                name=\"target\"\n                value=\"${escapeHtml(config?.target ?? '')}\"\n                placeholder=\"users\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Display Field\n              </label>\n              <input\n                type=\"text\"\n                name=\"displayField\"\n                value=\"${escapeHtml(config?.displayField ?? '')}\"\n                placeholder=\"name\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          </div>\n        </div>\n      `);\n    }\n\n    // Media settings\n    if (['media-picker', 'media-gallery', 'file-upload'].includes(this.field.type)) {\n      const config = this.field.config as { accept?: string; maxSize?: number; multiple?: boolean } | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Media Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Accept Types\n              </label>\n              <input\n                type=\"text\"\n                name=\"accept\"\n                value=\"${escapeHtml(config?.accept ?? '')}\"\n                placeholder=\"image/*\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Max Size (MB)\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxSize\"\n                value=\"${config?.maxSize ?? ''}\"\n                min=\"0\"\n                placeholder=\"10\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          </div>\n\n          ${\n            this.field.type === 'media-gallery'\n              ? `\n            <label class=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                name=\"multiple\"\n                ${config?.multiple !== false ? 'checked' : ''}\n                class=\"${checkboxClasses()}\"\n              />\n              <span class=\"text-sm text-gray-700 dark:text-gray-300\">Allow multiple files</span>\n            </label>\n          `\n              : ''\n          }\n        </div>\n      `);\n    }\n\n    // Code editor settings\n    if (this.field.type === 'code') {\n      const config = this.field.config as { language?: string; lineNumbers?: boolean } | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Code Editor Settings</h3>\n\n          <div>\n            <label class=\"${labelClasses()}\">\n              Language\n            </label>\n            <select\n              name=\"language\"\n              class=\"${selectClasses()}\"\n            >\n              <option value=\"json\" ${config?.language === 'json' ? 'selected' : ''}>JSON</option>\n              <option value=\"javascript\" ${config?.language === 'javascript' ? 'selected' : ''}>JavaScript</option>\n              <option value=\"typescript\" ${config?.language === 'typescript' ? 'selected' : ''}>TypeScript</option>\n              <option value=\"html\" ${config?.language === 'html' ? 'selected' : ''}>HTML</option>\n              <option value=\"css\" ${config?.language === 'css' ? 'selected' : ''}>CSS</option>\n              <option value=\"sql\" ${config?.language === 'sql' ? 'selected' : ''}>SQL</option>\n              <option value=\"yaml\" ${config?.language === 'yaml' ? 'selected' : ''}>YAML</option>\n              <option value=\"markdown\" ${config?.language === 'markdown' ? 'selected' : ''}>Markdown</option>\n            </select>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"lineNumbers\"\n              ${config?.lineNumbers !== false ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Show line numbers</span>\n          </label>\n        </div>\n      `);\n    }\n\n    // Slug field settings\n    if (this.field.type === 'slug') {\n      const config = this.field.config as SlugFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Slug Settings</h3>\n\n          <div>\n            <label class=\"${labelClasses()}\">\n              Source Field\n            </label>\n            <input\n              type=\"text\"\n              name=\"sourceField\"\n              value=\"${escapeHtml(config?.sourceField ?? '')}\"\n              placeholder=\"title\"\n              class=\"${inputClasses()}\"\n            />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Field name to generate slug from (e.g., title)</p>\n          </div>\n\n          <div class=\"grid grid-cols-3 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Prefix\n              </label>\n              <input\n                type=\"text\"\n                name=\"slugPrefix\"\n                value=\"${escapeHtml(config?.prefix ?? '')}\"\n                placeholder=\"\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Suffix\n              </label>\n              <input\n                type=\"text\"\n                name=\"slugSuffix\"\n                value=\"${escapeHtml(config?.suffix ?? '')}\"\n                placeholder=\"\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Separator\n              </label>\n              <select\n                name=\"slugSeparator\"\n                class=\"${selectClasses()}\"\n              >\n                <option value=\"-\" ${config?.separator === '-' || !config?.separator ? 'selected' : ''}>Hyphen (-)</option>\n                <option value=\"_\" ${config?.separator === '_' ? 'selected' : ''}>Underscore (_)</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      `);\n    }\n\n    // Color field settings\n    if (this.field.type === 'color') {\n      const config = this.field.config as ColorFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Color Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Format\n              </label>\n              <select\n                name=\"colorFormat\"\n                class=\"${selectClasses()}\"\n              >\n                <option value=\"hex\" ${config?.format === 'hex' || !config?.format ? 'selected' : ''}>HEX (#ff0000)</option>\n                <option value=\"rgb\" ${config?.format === 'rgb' ? 'selected' : ''}>RGB (rgb(255,0,0))</option>\n                <option value=\"hsl\" ${config?.format === 'hsl' ? 'selected' : ''}>HSL (hsl(0,100%,50%))</option>\n              </select>\n            </div>\n            <div>\n              <label class=\"flex items-center gap-2 cursor-pointer mt-6\">\n                <input\n                  type=\"checkbox\"\n                  name=\"allowAlpha\"\n                  ${config?.allowAlpha ? 'checked' : ''}\n                  class=\"${checkboxClasses()}\"\n                />\n                <span class=\"text-sm text-gray-700 dark:text-gray-300\">Allow transparency (alpha)</span>\n              </label>\n            </div>\n          </div>\n\n          <div>\n            <label class=\"${labelClasses()}\">\n              Color Presets (comma-separated)\n            </label>\n            <input\n              type=\"text\"\n              name=\"colorPresets\"\n              value=\"${escapeHtml(config?.presets?.join(', ') ?? '')}\"\n              placeholder=\"#ff0000, #00ff00, #0000ff\"\n              class=\"${inputClasses()}\"\n            />\n          </div>\n        </div>\n      `);\n    }\n\n    // Location field settings\n    if (this.field.type === 'location') {\n      const config = this.field.config as LocationFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Location Settings</h3>\n\n          <div class=\"grid grid-cols-3 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Default Latitude\n              </label>\n              <input\n                type=\"number\"\n                name=\"defaultLat\"\n                value=\"${config?.defaultCenter?.lat ?? ''}\"\n                step=\"any\"\n                placeholder=\"40.7128\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Default Longitude\n              </label>\n              <input\n                type=\"number\"\n                name=\"defaultLng\"\n                value=\"${config?.defaultCenter?.lng ?? ''}\"\n                step=\"any\"\n                placeholder=\"-74.0060\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Default Zoom\n              </label>\n              <input\n                type=\"number\"\n                name=\"defaultZoom\"\n                value=\"${config?.defaultZoom ?? ''}\"\n                min=\"1\"\n                max=\"20\"\n                placeholder=\"12\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"searchEnabled\"\n              ${config?.searchEnabled !== false ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Enable location search</span>\n          </label>\n        </div>\n      `);\n    }\n\n    // DateRange field settings\n    if (this.field.type === 'daterange') {\n      const config = this.field.config as DateRangeFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Date Range Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Min Date\n              </label>\n              <input\n                type=\"date\"\n                name=\"minDate\"\n                value=\"${escapeHtml(config?.minDate ?? '')}\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Max Date\n              </label>\n              <input\n                type=\"date\"\n                name=\"maxDate\"\n                value=\"${escapeHtml(config?.maxDate ?? '')}\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"allowSameDay\"\n              ${config?.allowSameDay !== false ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Allow same start and end date</span>\n          </label>\n        </div>\n      `);\n    }\n\n    // Repeater field settings\n    if (this.field.type === 'repeater') {\n      const config = this.field.config as RepeaterFieldConfig | undefined;\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Repeater Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Min Items\n              </label>\n              <input\n                type=\"number\"\n                name=\"minItems\"\n                value=\"${config?.minItems ?? ''}\"\n                min=\"0\"\n                placeholder=\"0\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Max Items\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxItems\"\n                value=\"${config?.maxItems ?? ''}\"\n                min=\"1\"\n                placeholder=\"10\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          </div>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              name=\"collapsed\"\n              ${config?.collapsed ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Start collapsed</span>\n          </label>\n\n          <div class=\"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n            <p class=\"text-xs text-gray-500 dark:text-gray-400\">\n              Nested fields can be configured after saving. Edit this field to define repeater sub-fields.\n            </p>\n          </div>\n        </div>\n      `);\n    }\n\n    // Blocks field settings\n    if (this.field.type === 'blocks') {\n      const config = this.field.config as BlocksFieldConfig | undefined;\n      const allowedBlocksJson = config?.allowedBlocks ? JSON.stringify(config.allowedBlocks) : '[]';\n      const deniedBlocksJson = config?.deniedBlocks ? JSON.stringify(config.deniedBlocks) : '[]';\n\n      sections.push(`\n        <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Blocks Settings</h3>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Min Blocks\n              </label>\n              <input\n                type=\"number\"\n                name=\"minBlocks\"\n                value=\"${config?.minBlocks ?? ''}\"\n                min=\"0\"\n                placeholder=\"0\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Max Blocks\n              </label>\n              <input\n                type=\"number\"\n                name=\"maxBlocks\"\n                value=\"${config?.maxBlocks ?? ''}\"\n                min=\"1\"\n                placeholder=\"No limit\"\n                class=\"${inputClasses()}\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <div class=\"flex items-center justify-between mb-2\">\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Allowed Blocks\n              </label>\n              <button\n                type=\"button\"\n                data-block-picker-allowed\n                class=\"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              >\n                Select blocks...\n              </button>\n            </div>\n            <div\n              data-allowed-blocks-list\n              class=\"min-h-[48px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/50\"\n            >\n              <div data-allowed-blocks-chips class=\"flex flex-wrap gap-2\">\n                ${\n                  config?.allowedBlocks?.length\n                    ? config.allowedBlocks\n                        .map(\n                          (block) =>\n                            `<span class=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\" data-block-chip=\"${escapeHtml(block)}\">${escapeHtml(block)}<button type=\"button\" data-remove-allowed=\"${escapeHtml(block)}\" class=\"hover:text-blue-900 dark:hover:text-blue-200\">&times;</button></span>`\n                        )\n                        .join('')\n                    : '<span class=\"text-xs text-gray-400 dark:text-gray-500\">All blocks allowed (no restrictions)</span>'\n                }\n              </div>\n            </div>\n            <input type=\"hidden\" name=\"allowedBlocks\" value='${escapeHtml(allowedBlocksJson)}' />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Leave empty to allow all block types</p>\n          </div>\n\n          <div>\n            <div class=\"flex items-center justify-between mb-2\">\n              <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Denied Blocks\n              </label>\n              <button\n                type=\"button\"\n                data-block-picker-denied\n                class=\"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              >\n                Select blocks...\n              </button>\n            </div>\n            <div\n              data-denied-blocks-list\n              class=\"min-h-[48px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/50\"\n            >\n              <div data-denied-blocks-chips class=\"flex flex-wrap gap-2\">\n                ${\n                  config?.deniedBlocks?.length\n                    ? config.deniedBlocks\n                        .map(\n                          (block) =>\n                            `<span class=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\" data-block-chip=\"${escapeHtml(block)}\">${escapeHtml(block)}<button type=\"button\" data-remove-denied=\"${escapeHtml(block)}\" class=\"hover:text-red-900 dark:hover:text-red-200\">&times;</button></span>`\n                        )\n                        .join('')\n                    : '<span class=\"text-xs text-gray-400 dark:text-gray-500\">No blocks denied</span>'\n                }\n              </div>\n            </div>\n            <input type=\"hidden\" name=\"deniedBlocks\" value='${escapeHtml(deniedBlocksJson)}' />\n          </div>\n        </div>\n      `);\n    }\n\n    return sections.join('');\n  }\n\n  protected bindContentEvents(): void {\n    if (!this.container) return;\n\n    // Close button\n    this.container.querySelector('[data-field-config-close]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Cancel button\n    this.container.querySelector('[data-field-config-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Save button\n    this.container.querySelector('[data-field-config-save]')?.addEventListener('click', () => {\n      this.handleSave();\n    });\n\n    // Form submit (Enter key)\n    this.container.querySelector('[data-field-config-form-element]')?.addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.handleSave();\n    });\n\n    // Auto-generate name from label\n    const nameInput = this.container.querySelector<HTMLInputElement>('input[name=\"name\"]');\n    const labelInput = this.container.querySelector<HTMLInputElement>('input[name=\"label\"]');\n    if (nameInput && labelInput && this.isNewField) {\n      labelInput.addEventListener('input', () => {\n        if (!nameInput.dataset.userModified) {\n          nameInput.value = labelToFieldName(labelInput.value);\n        }\n      });\n      nameInput.addEventListener('input', () => {\n        nameInput.dataset.userModified = 'true';\n      });\n    }\n\n    // Options management\n    this.bindOptionsEvents();\n\n    // Block picker events\n    this.bindBlockPickerEvents();\n  }\n\n  private bindOptionsEvents(): void {\n    if (!this.container) return;\n\n    // Add option\n    this.container.querySelector('[data-add-option]')?.addEventListener('click', () => {\n      const optionsList = this.container?.querySelector('[data-options-list]');\n      if (!optionsList) return;\n\n      const index = optionsList.querySelectorAll('[data-option-row]').length;\n      const row = document.createElement('div');\n      row.className = 'flex items-center gap-2';\n      row.setAttribute('data-option-row', String(index));\n      row.innerHTML = `\n        <input\n          type=\"text\"\n          name=\"option_value_${index}\"\n          placeholder=\"value\"\n          class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        />\n        <input\n          type=\"text\"\n          name=\"option_label_${index}\"\n          placeholder=\"label\"\n          class=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        />\n        <button\n          type=\"button\"\n          data-remove-option=\"${index}\"\n          class=\"p-2 text-gray-400 hover:text-red-500\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      `;\n      optionsList.appendChild(row);\n\n      // Bind remove event\n      row.querySelector('[data-remove-option]')?.addEventListener('click', () => {\n        row.remove();\n      });\n\n      // Focus value input\n      row.querySelector<HTMLInputElement>(`input[name=\"option_value_${index}\"]`)?.focus();\n    });\n\n    // Remove option\n    this.container.querySelectorAll('[data-remove-option]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        btn.closest('[data-option-row]')?.remove();\n      });\n    });\n  }\n\n  private bindBlockPickerEvents(): void {\n    if (!this.container || this.field.type !== 'blocks') return;\n\n    // Open allowed blocks picker\n    this.container.querySelector('[data-block-picker-allowed]')?.addEventListener('click', () => {\n      this.showBlockPicker('allowed');\n    });\n\n    // Open denied blocks picker\n    this.container.querySelector('[data-block-picker-denied]')?.addEventListener('click', () => {\n      this.showBlockPicker('denied');\n    });\n\n    // Remove allowed block chip\n    this.container.querySelectorAll('[data-remove-allowed]').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        e.preventDefault();\n        const blockType = btn.getAttribute('data-remove-allowed');\n        if (blockType) this.removeBlockFromList('allowed', blockType);\n      });\n    });\n\n    // Remove denied block chip\n    this.container.querySelectorAll('[data-remove-denied]').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        e.preventDefault();\n        const blockType = btn.getAttribute('data-remove-denied');\n        if (blockType) this.removeBlockFromList('denied', blockType);\n      });\n    });\n  }\n\n  private async showBlockPicker(listType: 'allowed' | 'denied'): Promise<void> {\n    // Get current selections\n    const hiddenInput = this.container?.querySelector<HTMLInputElement>(`input[name=\"${listType}Blocks\"]`);\n    const currentBlocks: string[] = hiddenInput?.value ? JSON.parse(hiddenInput.value) : [];\n\n    // Create picker modal\n    const apiBasePath = resolveApiBasePath(this.config.apiBasePath);\n    const picker = new BlockPickerModal({\n      apiBasePath,\n      selectedBlocks: currentBlocks,\n      title: listType === 'allowed' ? 'Select Allowed Blocks' : 'Select Denied Blocks',\n      onSelect: (blocks) => {\n        this.updateBlockList(listType, blocks);\n      },\n    });\n    picker.show();\n  }\n\n  private updateBlockList(listType: 'allowed' | 'denied', blocks: string[]): void {\n    const hiddenInput = this.container?.querySelector<HTMLInputElement>(`input[name=\"${listType}Blocks\"]`);\n    const chipsContainer = this.container?.querySelector(`[data-${listType}-blocks-chips]`);\n\n    if (!hiddenInput || !chipsContainer) return;\n\n    // Update hidden input\n    hiddenInput.value = JSON.stringify(blocks);\n\n    // Update chips display\n    if (blocks.length === 0) {\n      const emptyText =\n        listType === 'allowed' ? 'All blocks allowed (no restrictions)' : 'No blocks denied';\n      chipsContainer.innerHTML = `<span class=\"text-xs text-gray-400 dark:text-gray-500\">${emptyText}</span>`;\n    } else {\n      const chipColor = listType === 'allowed' ? 'blue' : 'red';\n      chipsContainer.innerHTML = blocks\n        .map(\n          (block) =>\n            `<span class=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-${chipColor}-100 text-${chipColor}-700 dark:bg-${chipColor}-900/30 dark:text-${chipColor}-400\" data-block-chip=\"${escapeHtml(block)}\">${escapeHtml(block)}<button type=\"button\" data-remove-${listType}=\"${escapeHtml(block)}\" class=\"hover:text-${chipColor}-900 dark:hover:text-${chipColor}-200\">&times;</button></span>`\n        )\n        .join('');\n\n      // Rebind remove events\n      chipsContainer.querySelectorAll(`[data-remove-${listType}]`).forEach((btn) => {\n        btn.addEventListener('click', (e) => {\n          e.preventDefault();\n          const blockType = btn.getAttribute(`data-remove-${listType}`);\n          if (blockType) this.removeBlockFromList(listType, blockType);\n        });\n      });\n    }\n  }\n\n  private removeBlockFromList(listType: 'allowed' | 'denied', blockType: string): void {\n    const hiddenInput = this.container?.querySelector<HTMLInputElement>(`input[name=\"${listType}Blocks\"]`);\n    if (!hiddenInput) return;\n\n    const blocks: string[] = hiddenInput.value ? JSON.parse(hiddenInput.value) : [];\n    const updatedBlocks = blocks.filter((b) => b !== blockType);\n    this.updateBlockList(listType, updatedBlocks);\n  }\n\n  private handleSave(): void {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-field-config-form-element]');\n    if (!form) return;\n\n    const formData = new FormData(form);\n\n    // Validate name\n    const name = (formData.get('name') as string)?.trim();\n    if (!name) {\n      this.showError('name', 'Field name is required');\n      return;\n    }\n    if (!/^[a-z][a-z0-9_]*$/.test(name)) {\n      this.showError('name', 'Invalid field name format');\n      return;\n    }\n\n    // Check for duplicate names\n    const existingNames = this.config.existingFieldNames ?? [];\n    const originalName = this.config.field.name;\n    if (name !== originalName && existingNames.includes(name)) {\n      this.showError('name', 'A field with this name already exists');\n      return;\n    }\n\n    // Validate label\n    const label = (formData.get('label') as string)?.trim();\n    if (!label) {\n      this.showError('label', 'Label is required');\n      return;\n    }\n\n    // Build updated field\n    const updatedField: FieldDefinition = {\n      id: this.field.id || generateFieldId(),\n      name,\n      type: this.field.type,\n      order: this.field.order,\n      label,\n      description: (formData.get('description') as string)?.trim() || undefined,\n      placeholder: (formData.get('placeholder') as string)?.trim() || undefined,\n      required: formData.get('required') === 'on',\n      readonly: formData.get('readonly') === 'on',\n      hidden: formData.get('hidden') === 'on',\n      filterable: formData.get('filterable') === 'on',\n      section: (formData.get('section') as string)?.trim() || undefined,\n      gridSpan: formData.get('gridSpan') ? parseInt(formData.get('gridSpan') as string, 10) : undefined,\n    };\n\n    // Validation\n    const validation: FieldDefinition['validation'] = {};\n    const minLength = formData.get('minLength');\n    if (minLength !== null && minLength !== '') {\n      validation.minLength = parseInt(minLength as string, 10);\n    }\n    const maxLength = formData.get('maxLength');\n    if (maxLength !== null && maxLength !== '') {\n      validation.maxLength = parseInt(maxLength as string, 10);\n    }\n    const min = formData.get('min');\n    if (min !== null && min !== '') {\n      validation.min = parseFloat(min as string);\n    }\n    const max = formData.get('max');\n    if (max !== null && max !== '') {\n      validation.max = parseFloat(max as string);\n    }\n    const pattern = formData.get('pattern');\n    if (pattern && (pattern as string).trim()) {\n      validation.pattern = (pattern as string).trim();\n    }\n    if (Object.keys(validation).length > 0) {\n      updatedField.validation = validation;\n    }\n\n    // Type-specific config\n    const config = this.buildTypeSpecificConfig(formData);\n    if (config && Object.keys(config).length > 0) {\n      updatedField.config = config;\n    }\n\n    this.config.onSave(updatedField);\n    this.hide();\n  }\n\n  private buildTypeSpecificConfig(formData: FormData): FieldDefinition['config'] | undefined {\n    switch (this.field.type) {\n      case 'select':\n      case 'radio':\n      case 'chips': {\n        const options: SelectOption[] = [];\n        let i = 0;\n        while (formData.has(`option_value_${i}`)) {\n          const value = (formData.get(`option_value_${i}`) as string)?.trim();\n          const label = (formData.get(`option_label_${i}`) as string)?.trim();\n          if (value) {\n            options.push({ value, label: label || value });\n          }\n          i++;\n        }\n        return options.length > 0 ? { options } : undefined;\n      }\n\n      case 'reference':\n      case 'references':\n      case 'user': {\n        const target = (formData.get('target') as string)?.trim();\n        const displayField = (formData.get('displayField') as string)?.trim();\n        if (!target) return undefined;\n        return { target, displayField: displayField || undefined };\n      }\n\n      case 'media-picker':\n      case 'media-gallery':\n      case 'file-upload': {\n        const accept = (formData.get('accept') as string)?.trim();\n        const maxSize = formData.get('maxSize') ? parseInt(formData.get('maxSize') as string, 10) : undefined;\n        const multiple = formData.get('multiple') === 'on';\n        return {\n          accept: accept || undefined,\n          maxSize,\n          multiple: this.field.type === 'media-gallery' ? multiple : undefined,\n        };\n      }\n\n      case 'code': {\n        const language = (formData.get('language') as string)?.trim() || 'json';\n        const lineNumbers = formData.get('lineNumbers') === 'on';\n        return { language, lineNumbers };\n      }\n\n      case 'slug': {\n        const sourceField = (formData.get('sourceField') as string)?.trim();\n        const prefix = (formData.get('slugPrefix') as string)?.trim();\n        const suffix = (formData.get('slugSuffix') as string)?.trim();\n        const separator = (formData.get('slugSeparator') as string)?.trim() || '-';\n        return {\n          sourceField: sourceField || undefined,\n          prefix: prefix || undefined,\n          suffix: suffix || undefined,\n          separator,\n        };\n      }\n\n      case 'color': {\n        const format = (formData.get('colorFormat') as string)?.trim() || 'hex';\n        const allowAlpha = formData.get('allowAlpha') === 'on';\n        const presetsStr = (formData.get('colorPresets') as string)?.trim();\n        const presets = presetsStr\n          ? presetsStr.split(',').map((s) => s.trim()).filter(Boolean)\n          : undefined;\n        return {\n          format: format as 'hex' | 'rgb' | 'hsl',\n          allowAlpha,\n          presets,\n        };\n      }\n\n      case 'location': {\n        const defaultLat = formData.get('defaultLat');\n        const defaultLng = formData.get('defaultLng');\n        const defaultZoom = formData.get('defaultZoom');\n        const searchEnabled = formData.get('searchEnabled') === 'on';\n        const config: LocationFieldConfig = { searchEnabled };\n        if (defaultLat && defaultLng) {\n          config.defaultCenter = {\n            lat: parseFloat(defaultLat as string),\n            lng: parseFloat(defaultLng as string),\n          };\n        }\n        if (defaultZoom) {\n          config.defaultZoom = parseInt(defaultZoom as string, 10);\n        }\n        return config;\n      }\n\n      case 'daterange': {\n        const minDate = (formData.get('minDate') as string)?.trim();\n        const maxDate = (formData.get('maxDate') as string)?.trim();\n        const allowSameDay = formData.get('allowSameDay') === 'on';\n        return {\n          minDate: minDate || undefined,\n          maxDate: maxDate || undefined,\n          allowSameDay,\n        };\n      }\n\n      case 'repeater': {\n        const minItems = formData.get('minItems');\n        const maxItems = formData.get('maxItems');\n        const collapsed = formData.get('collapsed') === 'on';\n        // Preserve existing nested fields\n        const existingConfig = this.field.config as RepeaterFieldConfig | undefined;\n        return {\n          fields: existingConfig?.fields ?? [],\n          minItems: minItems ? parseInt(minItems as string, 10) : undefined,\n          maxItems: maxItems ? parseInt(maxItems as string, 10) : undefined,\n          collapsed,\n        };\n      }\n\n      case 'blocks': {\n        const minBlocks = formData.get('minBlocks');\n        const maxBlocks = formData.get('maxBlocks');\n        const allowedStr = (formData.get('allowedBlocks') as string)?.trim();\n        const deniedStr = (formData.get('deniedBlocks') as string)?.trim();\n        const existingConfig = this.field.config as BlocksFieldConfig | undefined;\n\n        // Parse JSON arrays (new format) or fall back to comma-separated (legacy)\n        let allowedBlocks: string[] | undefined;\n        let deniedBlocks: string[] | undefined;\n\n        if (allowedStr) {\n          try {\n            const parsed = JSON.parse(allowedStr);\n            allowedBlocks = Array.isArray(parsed) && parsed.length > 0 ? parsed : undefined;\n          } catch {\n            // Fall back to comma-separated format\n            allowedBlocks = allowedStr.split(',').map((s) => s.trim()).filter(Boolean);\n            if (allowedBlocks.length === 0) allowedBlocks = undefined;\n          }\n        }\n\n        if (deniedStr) {\n          try {\n            const parsed = JSON.parse(deniedStr);\n            deniedBlocks = Array.isArray(parsed) && parsed.length > 0 ? parsed : undefined;\n          } catch {\n            // Fall back to comma-separated format\n            deniedBlocks = deniedStr.split(',').map((s) => s.trim()).filter(Boolean);\n            if (deniedBlocks.length === 0) deniedBlocks = undefined;\n          }\n        }\n\n        return {\n          __sourceItemsSchema: existingConfig?.__sourceItemsSchema,\n          __sourceAllowedBlocks: existingConfig?.__sourceAllowedBlocks,\n          __sourceDeniedBlocks: existingConfig?.__sourceDeniedBlocks,\n          __sourceRefPrefix: existingConfig?.__sourceRefPrefix,\n          __sourceRepresentation: existingConfig?.__sourceRepresentation,\n          __sourceWidget: existingConfig?.__sourceWidget,\n          __sourceSortable: existingConfig?.__sourceSortable,\n          __sourceHadAllowedBlocks: existingConfig?.__sourceHadAllowedBlocks,\n          __sourceHadDeniedBlocks: existingConfig?.__sourceHadDeniedBlocks,\n          minBlocks: minBlocks ? parseInt(minBlocks as string, 10) : undefined,\n          maxBlocks: maxBlocks ? parseInt(maxBlocks as string, 10) : undefined,\n          allowedBlocks,\n          deniedBlocks,\n        };\n      }\n\n      default:\n        return undefined;\n    }\n  }\n\n  private showError(fieldName: string, message: string): void {\n    const input = this.container?.querySelector<HTMLInputElement>(`[name=\"${fieldName}\"]`);\n    if (!input) return;\n\n    input.classList.add('border-red-500', 'focus:ring-red-500');\n    input.focus();\n\n    // Remove existing error\n    const existingError = input.parentElement?.querySelector('.field-error');\n    existingError?.remove();\n\n    // Add error message\n    const errorEl = document.createElement('p');\n    errorEl.className = 'field-error text-xs text-red-500 mt-1';\n    errorEl.textContent = message;\n    input.parentElement?.appendChild(errorEl);\n\n    // Clear on input\n    const clearError = () => {\n      input.classList.remove('border-red-500', 'focus:ring-red-500');\n      errorEl.remove();\n      input.removeEventListener('input', clearError);\n    };\n    input.addEventListener('input', clearError);\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction labelToFieldName(label: string): string {\n  return label\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '_')\n    .replace(/^_|_$/g, '')\n    .replace(/^[0-9]/, '_$&');\n}\n\n// =============================================================================\n// Block Picker Modal\n// =============================================================================\n\ninterface BlockPickerModalConfig {\n  apiBasePath: string;\n  selectedBlocks: string[];\n  title: string;\n  onSelect: (blocks: string[]) => void;\n}\n\nclass BlockPickerModal extends Modal {\n  private config: BlockPickerModalConfig;\n  private api: ContentTypeAPIClient;\n  private availableBlocks: BlockDefinitionSummary[] = [];\n  private selectedBlocks: Set<string>;\n\n  constructor(config: BlockPickerModalConfig) {\n    super({ size: 'lg', maxHeight: 'max-h-[70vh]' });\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    this.selectedBlocks = new Set(config.selectedBlocks);\n  }\n\n  protected async onAfterShow(): Promise<void> {\n    await this.loadBlocks();\n  }\n\n  protected renderContent(): string {\n    return `\n      <div class=\"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-semibold text-gray-900 dark:text-white\">${escapeHtml(this.config.title)}</h3>\n        <button type=\"button\" data-picker-close class=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded\">\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto p-4\">\n        <div data-blocks-loading class=\"flex items-center justify-center py-8\">\n          <div class=\"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n        </div>\n        <div data-blocks-list class=\"hidden space-y-2\"></div>\n        <div data-blocks-empty class=\"hidden text-center py-8 text-sm text-gray-500 dark:text-gray-400\">\n          No block definitions available. Create some in the Block Library first.\n        </div>\n      </div>\n\n      <div class=\"flex items-center justify-between px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n        <span class=\"text-xs text-gray-500 dark:text-gray-400\" data-selection-count>0 selected</span>\n        <div class=\"flex gap-2\">\n          <button\n            type=\"button\"\n            data-picker-cancel\n            class=\"px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            data-picker-confirm\n            class=\"px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700\"\n          >\n            Confirm\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    if (!this.container) return;\n\n    this.container.querySelector('[data-picker-close]')?.addEventListener('click', () => this.hide());\n    this.container.querySelector('[data-picker-cancel]')?.addEventListener('click', () => this.hide());\n\n    this.container.querySelector('[data-picker-confirm]')?.addEventListener('click', () => {\n      this.config.onSelect(Array.from(this.selectedBlocks));\n      this.hide();\n    });\n  }\n\n  private async loadBlocks(): Promise<void> {\n    const loadingEl = this.container?.querySelector('[data-blocks-loading]');\n    const listEl = this.container?.querySelector('[data-blocks-list]');\n    const emptyEl = this.container?.querySelector('[data-blocks-empty]');\n\n    try {\n      this.availableBlocks = await loadAvailableBlocks(this.api);\n      this.selectedBlocks = normalizeBlockSelection(this.selectedBlocks, this.availableBlocks);\n\n      loadingEl?.classList.add('hidden');\n\n      if (this.availableBlocks.length === 0) {\n        emptyEl?.classList.remove('hidden');\n      } else {\n        listEl?.classList.remove('hidden');\n        this.renderBlocksList();\n      }\n    } catch {\n      loadingEl?.classList.add('hidden');\n      emptyEl?.classList.remove('hidden');\n      const emptyText = emptyEl?.querySelector('span') || emptyEl;\n      if (emptyText) emptyText.textContent = 'Failed to load block definitions';\n    }\n  }\n\n  private renderBlocksList(): void {\n    const listEl = this.container?.querySelector('[data-blocks-list]');\n    if (!listEl) return;\n\n    listEl.innerHTML = this.availableBlocks\n      .map((block) => {\n        const bk = sharedBlockKey(block);\n        const isSelected = this.selectedBlocks.has(bk) || this.selectedBlocks.has(block.type);\n        return `\n          <label class=\"flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${\n            isSelected\n              ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-600'\n              : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n          }\">\n            <input\n              type=\"checkbox\"\n              value=\"${escapeHtml(bk)}\"\n              data-block-type=\"${escapeHtml(block.type)}\"\n              ${isSelected ? 'checked' : ''}\n              class=\"${checkboxClasses()}\"\n            />\n            <div class=\"flex-shrink-0 flex items-center justify-center w-8 h-8 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-sm font-medium\">\n              ${block.icon || bk.charAt(0).toUpperCase()}\n            </div>\n            <div class=\"flex-1 min-w-0\">\n              <div class=\"text-sm font-medium text-gray-900 dark:text-white\">${escapeHtml(block.name)}</div>\n              <div class=\"text-xs text-gray-500 dark:text-gray-400 font-mono\">${escapeHtml(bk)}</div>\n            </div>\n            ${block.schema_version ? `<span class=\"text-xs text-gray-400 dark:text-gray-500\">v${escapeHtml(block.schema_version)}</span>` : ''}\n          </label>\n        `;\n      })\n      .join('');\n\n    // Bind checkbox events\n    listEl.querySelectorAll<HTMLInputElement>('input[type=\"checkbox\"]').forEach((checkbox) => {\n      checkbox.addEventListener('change', () => {\n        const blockType = checkbox.value;\n        const legacyType = checkbox.dataset.blockType;\n        if (checkbox.checked) {\n          this.selectedBlocks.add(blockType);\n          if (legacyType && legacyType !== blockType) {\n            this.selectedBlocks.delete(legacyType);\n          }\n        } else {\n          this.selectedBlocks.delete(blockType);\n          if (legacyType) {\n            this.selectedBlocks.delete(legacyType);\n          }\n        }\n        this.updateSelectionCount();\n        this.renderBlocksList(); // Re-render to update styles\n      });\n    });\n\n    this.updateSelectionCount();\n  }\n\n  private updateSelectionCount(): void {\n    const countEl = this.container?.querySelector('[data-selection-count]');\n    if (countEl) {\n      const count = this.selectedBlocks.size;\n      countEl.textContent = `${count} selected`;\n    }\n  }\n}\n","/**\n * Layout Editor\n *\n * Modal/drawer UI for configuring content type layout with tabs/sections and grid settings.\n */\n\nimport type { UISchemaOverlay, UILayoutConfig, UITab, FieldDefinition } from './types';\nimport { Modal } from '../shared/modal';\nimport { renderIconTrigger, bindIconTriggerEvents, closeIconPicker } from './shared/icon-picker';\n\nexport interface LayoutEditorConfig {\n  layout: UILayoutConfig;\n  fields: FieldDefinition[];\n  onSave: (layout: UILayoutConfig) => void;\n  onCancel: () => void;\n}\n\n// =============================================================================\n// Layout Editor Component\n// =============================================================================\n\nexport class LayoutEditor extends Modal {\n  private config: LayoutEditorConfig;\n  private layout: UILayoutConfig;\n  private dragState: { tabId: string; startIndex: number } | null = null;\n\n  constructor(config: LayoutEditorConfig) {\n    super({ size: '3xl', backdropDataAttr: 'data-layout-editor-backdrop' });\n    this.config = config;\n    this.layout = JSON.parse(JSON.stringify(config.layout ?? { type: 'flat', gridColumns: 12 }));\n    if (!this.layout.tabs) {\n      this.layout.tabs = [];\n    }\n  }\n\n  protected onBeforeHide(): boolean {\n    this.config.onCancel();\n    return true;\n  }\n\n  protected renderContent(): string {\n    return `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Layout Settings</h2>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">Configure tabs, sections, and grid layout</p>\n        </div>\n        <button type=\"button\" data-layout-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto px-6 py-4 space-y-6\">\n        ${this.renderLayoutTypeSection()}\n        ${this.renderGridSection()}\n        ${this.renderTabsSection()}\n        ${this.renderFieldAssignment()}\n      </div>\n\n      <div data-layout-error class=\"hidden px-6 py-3 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-800\">\n        <p class=\"text-sm text-red-600 dark:text-red-400\"></p>\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-layout-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-layout-save\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          Apply Layout\n        </button>\n      </div>\n    `;\n  }\n\n  private renderLayoutTypeSection(): string {\n    return `\n      <div class=\"space-y-4\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Layout Type</h3>\n\n        <div class=\"grid grid-cols-3 gap-3\">\n          <button\n            type=\"button\"\n            data-layout-type=\"flat\"\n            class=\"flex flex-col items-center gap-2 p-4 border rounded-lg transition-colors ${\n              this.layout.type === 'flat' || !this.layout.type\n                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n            }\"\n          >\n            <svg class=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Flat</span>\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">All fields in one view</span>\n          </button>\n\n          <button\n            type=\"button\"\n            data-layout-type=\"tabs\"\n            class=\"flex flex-col items-center gap-2 p-4 border rounded-lg transition-colors ${\n              this.layout.type === 'tabs'\n                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n            }\"\n          >\n            <svg class=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Tabs</span>\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">Organize with tabs</span>\n          </button>\n\n          <button\n            type=\"button\"\n            data-layout-type=\"sections\"\n            class=\"flex flex-col items-center gap-2 p-4 border rounded-lg transition-colors ${\n              this.layout.type === 'sections'\n                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n            }\"\n          >\n            <svg class=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Sections</span>\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">Collapsible sections</span>\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderGridSection(): string {\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Grid Settings</h3>\n\n        <div class=\"flex items-center gap-4\">\n          <div class=\"flex-1\">\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Grid Columns\n            </label>\n            <select\n              data-grid-columns\n              class=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"1\" ${this.layout.gridColumns === 1 ? 'selected' : ''}>1 Column</option>\n              <option value=\"2\" ${this.layout.gridColumns === 2 ? 'selected' : ''}>2 Columns</option>\n              <option value=\"3\" ${this.layout.gridColumns === 3 ? 'selected' : ''}>3 Columns</option>\n              <option value=\"4\" ${this.layout.gridColumns === 4 ? 'selected' : ''}>4 Columns</option>\n              <option value=\"6\" ${this.layout.gridColumns === 6 ? 'selected' : ''}>6 Columns</option>\n              <option value=\"12\" ${this.layout.gridColumns === 12 || !this.layout.gridColumns ? 'selected' : ''}>12 Columns (default)</option>\n            </select>\n          </div>\n\n          <div class=\"flex-1\">\n            <div class=\"text-sm text-gray-500 dark:text-gray-400 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n              Fields use <code class=\"text-xs\">gridSpan</code> to control width. Set per-field in field settings.\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTabsSection(): string {\n    if (this.layout.type !== 'tabs' && this.layout.type !== 'sections') {\n      return '';\n    }\n\n    const tabs = this.layout.tabs ?? [];\n    const itemName = this.layout.type === 'tabs' ? 'Tab' : 'Section';\n\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center justify-between\">\n          <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">${itemName}s</h3>\n          <button\n            type=\"button\"\n            data-add-tab\n            class=\"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n            </svg>\n            Add ${itemName}\n          </button>\n        </div>\n\n        <div data-tabs-list class=\"space-y-2\">\n          ${tabs.length === 0\n            ? `\n            <div class=\"text-sm text-gray-500 dark:text-gray-400 p-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-center\">\n              No ${itemName.toLowerCase()}s defined. Fields without a section will appear in a default \"${itemName.toLowerCase()}\".\n            </div>\n          `\n            : tabs.map((tab, i) => this.renderTabRow(tab, i)).join('')\n          }\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTabRow(tab: UITab, index: number): string {\n    return `\n      <div\n        class=\"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-slate-900\"\n        data-tab-row=\"${tab.id}\"\n        data-tab-index=\"${index}\"\n        draggable=\"true\"\n      >\n        <div class=\"flex-shrink-0 cursor-move text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\" data-tab-drag-handle>\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 8h16M4 16h16\"></path>\n          </svg>\n        </div>\n\n        <div class=\"flex-1 grid grid-cols-3 gap-3\">\n          <input\n            type=\"text\"\n            data-tab-id=\"${tab.id}\"\n            name=\"tab_id_${index}\"\n            value=\"${escapeHtml(tab.id)}\"\n            placeholder=\"section_id\"\n            class=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono\"\n          />\n          <input\n            type=\"text\"\n            name=\"tab_label_${index}\"\n            value=\"${escapeHtml(tab.label)}\"\n            placeholder=\"Tab Label\"\n            class=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n          ${renderIconTrigger(tab.icon ?? '', `name=\"tab_icon_${index}\"`)}\n        </div>\n\n        <button\n          type=\"button\"\n          data-remove-tab=\"${tab.id}\"\n          class=\"p-2 text-gray-400 hover:text-red-500\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n    `;\n  }\n\n  private renderFieldAssignment(): string {\n    if (this.layout.type !== 'tabs' && this.layout.type !== 'sections') {\n      return '';\n    }\n\n    const tabs = this.layout.tabs ?? [];\n    const itemName = this.layout.type === 'tabs' ? 'tab' : 'section';\n\n    // Group fields by section\n    const fieldsBySection = new Map<string, FieldDefinition[]>();\n    fieldsBySection.set('', []); // Unassigned\n\n    for (const tab of tabs) {\n      fieldsBySection.set(tab.id, []);\n    }\n\n    for (const field of this.config.fields) {\n      const section = field.section ?? '';\n      if (!fieldsBySection.has(section)) {\n        fieldsBySection.set(section, []);\n      }\n      fieldsBySection.get(section)!.push(field);\n    }\n\n    return `\n      <div class=\"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Field Assignment</h3>\n        <p class=\"text-sm text-gray-500 dark:text-gray-400\">\n          Fields are assigned to ${itemName}s via the \"Section/Tab\" setting in each field's configuration.\n        </p>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          ${Array.from(fieldsBySection.entries())\n            .map(\n              ([section, fields]) => `\n            <div class=\"p-3 border border-gray-200 dark:border-gray-700 rounded-lg\">\n              <div class=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                ${section || '(Unassigned)'}\n              </div>\n              <div class=\"space-y-1\">\n                ${fields.length === 0\n                  ? '<div class=\"text-xs text-gray-400\">No fields</div>'\n                  : fields.map((f) => `<div class=\"text-xs text-gray-500 dark:text-gray-400 truncate\">${escapeHtml(f.label)} <span class=\"font-mono\">(${escapeHtml(f.name)})</span></div>`).join('')\n                }\n              </div>\n            </div>\n          `\n            )\n            .join('')}\n        </div>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    if (!this.container) return;\n\n    // Close button\n    this.container.querySelector('[data-layout-close]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Cancel button\n    this.container.querySelector('[data-layout-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    // Save button\n    this.container.querySelector('[data-layout-save]')?.addEventListener('click', () => {\n      this.handleSave();\n    });\n\n    // Layout type selection\n    this.container.querySelectorAll('[data-layout-type]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const type = btn.getAttribute('data-layout-type') as 'flat' | 'tabs' | 'sections';\n        this.layout.type = type;\n        this.updateView();\n      });\n    });\n\n    // Grid columns\n    this.container.querySelector('[data-grid-columns]')?.addEventListener('change', (e) => {\n      const value = (e.target as HTMLSelectElement).value;\n      this.layout.gridColumns = parseInt(value, 10);\n    });\n\n    // Add tab\n    this.container.querySelector('[data-add-tab]')?.addEventListener('click', () => {\n      this.addTab();\n    });\n\n    // Bind tab events\n    this.bindTabEvents();\n  }\n\n  private bindTabEvents(): void {\n    if (!this.container) return;\n\n    // Remove tab\n    this.container.querySelectorAll('[data-remove-tab]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const tabId = btn.getAttribute('data-remove-tab');\n        if (tabId) this.removeTab(tabId);\n      });\n    });\n\n    // Tab ID changes\n    this.container.querySelectorAll('input[name^=\"tab_id_\"]').forEach((input) => {\n      input.addEventListener('input', () => {\n        this.updateTabsFromForm();\n      });\n    });\n\n    // Icon picker triggers\n    bindIconTriggerEvents(this.container, '[data-icon-trigger]', (trigger) => {\n      const hiddenInput = trigger.querySelector<HTMLInputElement>('input[name^=\"tab_icon_\"]');\n      return {\n        value: hiddenInput?.value ?? '',\n        onSelect: (v: string) => { if (hiddenInput) hiddenInput.value = v; },\n        onClear: () => { if (hiddenInput) hiddenInput.value = ''; },\n      };\n    });\n\n    // Tab drag and drop\n    const tabsList = this.container.querySelector('[data-tabs-list]');\n    if (tabsList) {\n      tabsList.addEventListener('dragstart', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        const row = target.closest<HTMLElement>('[data-tab-row]');\n        if (!row) return;\n\n        this.dragState = {\n          tabId: row.getAttribute('data-tab-row') ?? '',\n          startIndex: parseInt(row.getAttribute('data-tab-index') ?? '0', 10),\n        };\n        row.classList.add('opacity-50');\n      });\n\n      tabsList.addEventListener('dragover', (e) => {\n        e.preventDefault();\n      });\n\n      tabsList.addEventListener('drop', (e) => {\n        e.preventDefault();\n        if (!this.dragState) return;\n\n        const target = (e as DragEvent).target as HTMLElement;\n        const row = target.closest<HTMLElement>('[data-tab-row]');\n        if (!row) return;\n\n        const targetIndex = parseInt(row.getAttribute('data-tab-index') ?? '0', 10);\n        this.moveTab(this.dragState.tabId, targetIndex);\n        this.dragState = null;\n      });\n\n      tabsList.addEventListener('dragend', () => {\n        tabsList.querySelectorAll('.opacity-50').forEach((el) => el.classList.remove('opacity-50'));\n        this.dragState = null;\n      });\n    }\n  }\n\n  private addTab(): void {\n    const newId = `section_${(this.layout.tabs?.length ?? 0) + 1}`;\n    const newTab: UITab = {\n      id: newId,\n      label: `Section ${(this.layout.tabs?.length ?? 0) + 1}`,\n      order: this.layout.tabs?.length ?? 0,\n    };\n\n    if (!this.layout.tabs) {\n      this.layout.tabs = [];\n    }\n    this.layout.tabs.push(newTab);\n    this.updateView();\n  }\n\n  private removeTab(tabId: string): void {\n    if (!this.layout.tabs) return;\n    this.layout.tabs = this.layout.tabs.filter((t) => t.id !== tabId);\n    this.updateView();\n  }\n\n  private moveTab(tabId: string, newIndex: number): void {\n    if (!this.layout.tabs) return;\n\n    const currentIndex = this.layout.tabs.findIndex((t) => t.id === tabId);\n    if (currentIndex === -1 || currentIndex === newIndex) return;\n\n    const tab = this.layout.tabs.splice(currentIndex, 1)[0];\n    this.layout.tabs.splice(newIndex, 0, tab);\n\n    // Update order values\n    this.layout.tabs.forEach((t, i) => {\n      t.order = i;\n    });\n\n    this.updateView();\n  }\n\n  private updateTabsFromForm(): void {\n    if (!this.container || !this.layout.tabs) return;\n\n    this.layout.tabs.forEach((tab, i) => {\n      const idInput = this.container!.querySelector<HTMLInputElement>(`input[name=\"tab_id_${i}\"]`);\n      const labelInput = this.container!.querySelector<HTMLInputElement>(`input[name=\"tab_label_${i}\"]`);\n      const iconInput = this.container!.querySelector<HTMLInputElement>(`input[name=\"tab_icon_${i}\"]`);\n\n      if (idInput) tab.id = idInput.value.trim();\n      if (labelInput) tab.label = labelInput.value.trim();\n      if (iconInput) tab.icon = iconInput.value.trim() || undefined;\n    });\n  }\n\n  private updateView(): void {\n    if (!this.container) return;\n    closeIconPicker();\n\n    // Re-render the whole container content (but not the header/footer)\n    const content = this.container.querySelector('.overflow-y-auto');\n    if (content) {\n      content.innerHTML = `\n        ${this.renderLayoutTypeSection()}\n        ${this.renderGridSection()}\n        ${this.renderTabsSection()}\n        ${this.renderFieldAssignment()}\n      `;\n\n      // Re-bind events\n      this.container.querySelectorAll('[data-layout-type]').forEach((btn) => {\n        btn.addEventListener('click', () => {\n          const type = btn.getAttribute('data-layout-type') as 'flat' | 'tabs' | 'sections';\n          this.layout.type = type;\n          this.updateView();\n        });\n      });\n\n      this.container.querySelector('[data-grid-columns]')?.addEventListener('change', (e) => {\n        const value = (e.target as HTMLSelectElement).value;\n        this.layout.gridColumns = parseInt(value, 10);\n      });\n\n      this.container.querySelector('[data-add-tab]')?.addEventListener('click', () => {\n        this.addTab();\n      });\n\n      this.bindTabEvents();\n    }\n  }\n\n  private handleSave(): void {\n    // Update tabs from form inputs\n    this.updateTabsFromForm();\n\n    // Validate tabs have unique IDs\n    if (this.layout.tabs && this.layout.tabs.length > 0) {\n      const ids = new Set<string>();\n      for (const tab of this.layout.tabs) {\n        if (!tab.id.trim()) {\n          this.showLayoutError('All tabs must have an ID');\n          return;\n        }\n        if (ids.has(tab.id)) {\n          this.showLayoutError(`Duplicate tab ID: ${tab.id}`);\n          return;\n        }\n        ids.add(tab.id);\n      }\n    }\n\n    this.config.onSave(this.layout);\n    this.hide();\n  }\n\n  private showLayoutError(message: string): void {\n    const errorEl = this.container?.querySelector('[data-layout-error]');\n    if (!errorEl) return;\n    errorEl.classList.remove('hidden');\n    const textEl = errorEl.querySelector('p');\n    if (textEl) textEl.textContent = message;\n    setTimeout(() => errorEl.classList.add('hidden'), 5000);\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n","/**\n * Block Field Type Registry\n *\n * Maps backend block field type registry payloads to the frontend field metadata\n * used by the Block Library IDE.\n */\n\nimport type { FieldType, FieldTypeCategory, FieldTypeMetadata, FieldDefinition } from './types';\nimport { iconForKey, normalizeFieldType } from './field-type-picker';\n\nexport interface BackendFieldTypeDefinition {\n  type: string;\n  label?: string;\n  description?: string;\n  category?: string;\n  icon?: string;\n  defaults?: Record<string, unknown>;\n  order?: number;\n}\n\nexport interface BackendFieldTypeCategory {\n  id?: string;\n  label?: string;\n  icon?: string;\n  order?: number;\n  collapsed?: boolean;\n}\n\nexport interface BackendFieldTypeCategoryGroup {\n  category?: BackendFieldTypeCategory;\n  field_types?: BackendFieldTypeDefinition[];\n}\n\nexport interface BlockFieldTypeCategory {\n  id: FieldTypeCategory;\n  label: string;\n  icon: string;\n  collapsed?: boolean;\n}\n\nexport interface BlockFieldTypeRegistry {\n  categories: BlockFieldTypeCategory[];\n  fieldTypes: FieldTypeMetadata[];\n}\n\nconst CATEGORY_ID_MAP: Record<string, FieldTypeCategory> = {\n  text: 'text',\n  media: 'media',\n  choice: 'selection',\n  number: 'number',\n  datetime: 'datetime',\n  relationship: 'reference',\n  structure: 'structural',\n  advanced: 'advanced',\n};\n\nconst CATEGORY_ICON_MAP: Record<string, string> = {\n  text: 'cat-text',\n  media: 'cat-media',\n  choice: 'cat-selection',\n  number: 'cat-number',\n  datetime: 'cat-datetime',\n  relationship: 'cat-reference',\n  structure: 'cat-structural',\n  advanced: 'cat-advanced',\n};\n\nfunction normalizeCategoryId(id?: string): FieldTypeCategory {\n  const raw = (id ?? '').trim().toLowerCase();\n  return CATEGORY_ID_MAP[raw] ?? 'advanced';\n}\n\nfunction normalizeCategoryLabel(label?: string, fallbackId?: string): string {\n  const val = (label ?? '').trim();\n  if (val) return val;\n  const id = (fallbackId ?? '').trim();\n  return id ? titleCase(id) : 'Advanced';\n}\n\nfunction normalizeCategoryIcon(id?: string): string {\n  const raw = (id ?? '').trim().toLowerCase();\n  const iconKey = CATEGORY_ICON_MAP[raw] ?? 'cat-advanced';\n  return iconForKey(iconKey);\n}\n\nfunction normalizeDefaults(def: BackendFieldTypeDefinition): Partial<FieldDefinition> | undefined {\n  const defaults = def.defaults;\n  if (!defaults || typeof defaults !== 'object') return undefined;\n  const out = defaults as Partial<FieldDefinition>;\n  return out;\n}\n\nfunction mapFieldType(def: BackendFieldTypeDefinition, categoryId: FieldTypeCategory): FieldTypeMetadata {\n  const rawType = (def.type ?? 'text').trim().toLowerCase();\n  const normalizedType = rawType === 'text' ? 'textarea' : normalizeFieldType(rawType);\n  const label = (def.label ?? '').trim() || titleCase(def.type ?? normalizedType);\n  const description = (def.description ?? '').trim();\n  const icon = iconForKey(def.icon ?? '') || iconForKey(normalizedType) || '';\n  const defaultConfig = normalizeDefaults(def);\n  const meta: FieldTypeMetadata = {\n    type: normalizedType,\n    label,\n    description,\n    icon,\n    category: categoryId,\n    defaultConfig,\n  };\n  if ((def.type ?? '').toLowerCase() === 'hidden') {\n    meta.defaultConfig = {\n      ...(meta.defaultConfig ?? {}),\n      hidden: true,\n    };\n  }\n  return meta;\n}\n\nexport function buildRegistryFromGroups(groups: BackendFieldTypeCategoryGroup[]): BlockFieldTypeRegistry {\n  const categories: BlockFieldTypeCategory[] = [];\n  const fieldTypes: FieldTypeMetadata[] = [];\n\n  for (const group of groups) {\n    const category = group.category ?? {};\n    const backendId = (category.id ?? '').trim().toLowerCase();\n    const mappedId = normalizeCategoryId(backendId);\n    categories.push({\n      id: mappedId,\n      label: normalizeCategoryLabel(category.label, backendId),\n      icon: normalizeCategoryIcon(backendId),\n      collapsed: category.collapsed,\n    });\n\n    const defs = Array.isArray(group.field_types) ? group.field_types : [];\n    for (const def of defs) {\n      fieldTypes.push(mapFieldType(def, mappedId));\n    }\n  }\n\n  return { categories, fieldTypes };\n}\n\nexport const BLOCK_FIELD_TYPE_REGISTRY_FALLBACK: BlockFieldTypeRegistry = buildRegistryFromGroups([\n  {\n    category: { id: 'text', label: 'Text', icon: 'text', order: 10 },\n    field_types: [\n      {\n        type: 'string',\n        label: 'Single Line Text',\n        description: 'Short text value',\n        category: 'text',\n        icon: 'text',\n        defaults: { validation: { maxLength: 255 } },\n        order: 10,\n      },\n      {\n        type: 'text',\n        label: 'Multi Line Text',\n        description: 'Paragraph text',\n        category: 'text',\n        icon: 'textarea',\n        defaults: { config: { rows: 4 } },\n        order: 20,\n      },\n      {\n        type: 'richtext',\n        label: 'Rich Text',\n        description: 'Formatted text editor',\n        category: 'text',\n        icon: 'rich-text',\n        defaults: { config: { toolbar: 'standard' } },\n        order: 30,\n      },\n      {\n        type: 'slug',\n        label: 'Slug',\n        description: 'URL-friendly identifier',\n        category: 'text',\n        icon: 'slug',\n        defaults: { config: { sourceField: null } },\n        order: 40,\n      },\n      {\n        type: 'url',\n        label: 'URL',\n        description: 'Website link',\n        category: 'text',\n        icon: 'url',\n        order: 50,\n      },\n      {\n        type: 'email',\n        label: 'Email',\n        description: 'Email address',\n        category: 'text',\n        icon: 'email',\n        order: 60,\n      },\n    ],\n  },\n  {\n    category: { id: 'media', label: 'Media', icon: 'media', order: 20 },\n    field_types: [\n      {\n        type: 'image',\n        label: 'Image',\n        description: 'Image asset',\n        category: 'media',\n        icon: 'media-picker',\n        defaults: { config: { accept: 'image/*' } },\n        order: 10,\n      },\n      {\n        type: 'file',\n        label: 'File',\n        description: 'File attachment',\n        category: 'media',\n        icon: 'file-upload',\n        order: 20,\n      },\n    ],\n  },\n  {\n    category: { id: 'choice', label: 'Choice', icon: 'choice', order: 30 },\n    field_types: [\n      {\n        type: 'boolean',\n        label: 'Boolean',\n        description: 'True/false toggle',\n        category: 'choice',\n        icon: 'toggle',\n        defaults: { config: { displayAs: 'toggle' } },\n        order: 10,\n      },\n      {\n        type: 'select',\n        label: 'Select',\n        description: 'Dropdown selection',\n        category: 'choice',\n        icon: 'select',\n        defaults: { config: { options: [], multiple: false } },\n        order: 20,\n      },\n      {\n        type: 'multiselect',\n        label: 'Multi Select',\n        description: 'Multiple selections',\n        category: 'choice',\n        icon: 'chips',\n        defaults: { config: { options: [], multiple: true } },\n        order: 30,\n      },\n    ],\n  },\n  {\n    category: { id: 'number', label: 'Number', icon: 'number', order: 40 },\n    field_types: [\n      { type: 'integer', label: 'Integer', description: 'Whole number', category: 'number', icon: 'integer', order: 10 },\n      {\n        type: 'decimal',\n        label: 'Decimal',\n        description: 'Decimal number',\n        category: 'number',\n        icon: 'number',\n        defaults: { config: { precision: 2 } },\n        order: 20,\n      },\n    ],\n  },\n  {\n    category: { id: 'datetime', label: 'Date & Time', icon: 'datetime', order: 50 },\n    field_types: [\n      {\n        type: 'date',\n        label: 'Date',\n        description: 'Calendar date',\n        category: 'datetime',\n        icon: 'date',\n        defaults: { config: { format: 'YYYY-MM-DD' } },\n        order: 10,\n      },\n      {\n        type: 'datetime',\n        label: 'Date & Time',\n        description: 'Date with time',\n        category: 'datetime',\n        icon: 'datetime',\n        order: 20,\n      },\n    ],\n  },\n  {\n    category: { id: 'relationship', label: 'Relationship', icon: 'relationship', order: 60 },\n    field_types: [\n      {\n        type: 'reference',\n        label: 'Reference',\n        description: 'Link to another type',\n        category: 'relationship',\n        icon: 'reference',\n        defaults: { config: { targetType: null } },\n        order: 10,\n      },\n    ],\n  },\n  {\n    category: { id: 'structure', label: 'Structure', icon: 'structure', order: 70 },\n    field_types: [\n      {\n        type: 'group',\n        label: 'Group',\n        description: 'Nested fields',\n        category: 'structure',\n        icon: 'group',\n        defaults: { config: { fields: [] } },\n        order: 10,\n      },\n    ],\n  },\n  {\n    category: { id: 'advanced', label: 'Advanced', icon: 'advanced', order: 80, collapsed: true },\n    field_types: [\n      { type: 'json', label: 'JSON', description: 'Raw JSON input', category: 'advanced', icon: 'json', order: 10 },\n      {\n        type: 'color',\n        label: 'Color',\n        description: 'Color picker',\n        category: 'advanced',\n        icon: 'color',\n        defaults: { config: { format: 'hex' } },\n        order: 20,\n      },\n      {\n        type: 'hidden',\n        label: 'Hidden',\n        description: 'Hidden field',\n        category: 'advanced',\n        icon: 'json',\n        order: 30,\n      },\n    ],\n  },\n]);\n\nfunction titleCase(value: string): string {\n  return value\n    .replace(/_/g, ' ')\n    .replace(/\\b\\w/g, (c) => c.toUpperCase());\n}\n","/**\n * Unified Field Type Registry\n *\n * Single source of truth for field type metadata across all surfaces\n * (Content Modeling, Block Library IDE, Field Palette).\n *\n * Loading strategy:\n *   1. Try backend grouped endpoint (categories with field types)\n *   2. Try backend flat endpoint (field type array)\n *   3. Fall back to merged local registry\n *\n * The static registry in field-type-picker.ts still owns SVG icons and\n * the canonical FIELD_TYPES array. This module wraps it with backend\n * loading and a unified async loader.\n */\n\nimport type { FieldTypeMetadata, FieldTypeCategory } from '../types';\nimport type { ContentTypeAPIClient } from '../api-client';\nimport { FIELD_TYPES, FIELD_CATEGORIES, getFieldTypeMetadata, normalizeFieldType, getFieldTypesByCategory } from '../field-type-picker';\nimport { BLOCK_FIELD_TYPE_REGISTRY_FALLBACK, buildRegistryFromGroups } from '../block-field-type-registry';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface FieldTypeRegistryCategory {\n  id: FieldTypeCategory;\n  label: string;\n  icon: string;\n  collapsed?: boolean;\n}\n\nexport interface FieldTypeRegistrySource {\n  categories: FieldTypeRegistryCategory[];\n  fieldTypes: FieldTypeMetadata[];\n}\n\n// ---------------------------------------------------------------------------\n// Re-exports (canonical lookup functions live in field-type-picker.ts)\n// ---------------------------------------------------------------------------\n\nexport { getFieldTypeMetadata, normalizeFieldType, getFieldTypesByCategory };\n\n// ---------------------------------------------------------------------------\n// Merged Fallback Registry\n// ---------------------------------------------------------------------------\n\n/**\n * Merge the static FIELD_TYPES (33 types with SVG icons) and the\n * BLOCK_FIELD_TYPE_REGISTRY_FALLBACK (23 types from backend format)\n * into a single canonical fallback.\n *\n * Strategy: static FIELD_TYPES wins for overlapping type keys (it has icons).\n * Any types only in the block registry are appended.\n */\nfunction buildMergedFallback(): FieldTypeRegistrySource {\n  const staticTypes = new Map<string, FieldTypeMetadata>();\n  for (const ft of FIELD_TYPES) {\n    staticTypes.set(ft.type, ft);\n  }\n\n  // Add any block-registry-only types that the static registry doesn't cover\n  for (const ft of BLOCK_FIELD_TYPE_REGISTRY_FALLBACK.fieldTypes) {\n    if (!staticTypes.has(ft.type)) {\n      staticTypes.set(ft.type, ft);\n    }\n  }\n\n  // Use static categories as the base (they have richer labels)\n  const categories: FieldTypeRegistryCategory[] = FIELD_CATEGORIES.map((c) => ({\n    id: c.id,\n    label: c.label,\n    icon: c.icon,\n  }));\n\n  return {\n    categories,\n    fieldTypes: Array.from(staticTypes.values()),\n  };\n}\n\nexport const FIELD_TYPE_REGISTRY_FALLBACK: FieldTypeRegistrySource = buildMergedFallback();\n\n// ---------------------------------------------------------------------------\n// Async Loader\n// ---------------------------------------------------------------------------\n\n/**\n * Load the field type registry from the backend with graceful fallback.\n *\n * Load strategy:\n *   1. Try grouped categories (BackendFieldTypeCategoryGroup[])\n *   2. If empty or fails, try flat array (FieldTypeMetadata[])\n *   3. Fall back to merged local registry (FIELD_TYPE_REGISTRY_FALLBACK)\n */\nexport async function loadFieldTypeRegistry(api: ContentTypeAPIClient): Promise<FieldTypeRegistrySource> {\n  // Try grouped format first\n  try {\n    const groups = await api.getBlockFieldTypeGroups();\n    if (groups && groups.length > 0) {\n      const registry = buildRegistryFromGroups(groups);\n      return {\n        categories: registry.categories,\n        fieldTypes: registry.fieldTypes,\n      };\n    }\n  } catch {\n    // Ignore and try flat format next\n  }\n\n  // Try flat format\n  try {\n    const apiTypes = await api.getFieldTypes();\n    if (apiTypes && apiTypes.length > 0) {\n      return {\n        categories: [...FIELD_TYPE_REGISTRY_FALLBACK.categories],\n        fieldTypes: apiTypes,\n      };\n    }\n  } catch {\n    // Fall through to local fallback\n  }\n\n  return {\n    categories: [...FIELD_TYPE_REGISTRY_FALLBACK.categories],\n    fieldTypes: [...FIELD_TYPE_REGISTRY_FALLBACK.fieldTypes],\n  };\n}\n","/**\n * Field Palette Panel\n *\n * Phase 9 implements the right-column field palette for the Block Library IDE:\n *   Task 9.1 - Data-driven palette: fetches from GET /admin/api/block_definitions_meta/field_types,\n *              falls back to the local FIELD_TYPES registry when the endpoint is unavailable.\n *   Task 9.2 - Search and grouped categories with \"Advanced\" collapsed by default.\n *   Task 9.3 - Drag handle on each palette item; drop target integration with the block editor.\n *\n * The panel renders inside [data-block-ide-palette] in the three-column IDE layout.\n */\n\nimport type { FieldTypeMetadata, FieldTypeCategory } from './types';\nimport { ContentTypeAPIClient } from './api-client';\nimport { loadFieldTypeRegistry, FIELD_TYPE_REGISTRY_FALLBACK } from './shared/field-type-registry';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface FieldPalettePanelConfig {\n  container: HTMLElement;\n  api: ContentTypeAPIClient;\n  /** Called when user clicks (non-drag) a palette item to add a field */\n  onAddField: (meta: FieldTypeMetadata) => void;\n}\n\ninterface CategoryGroupState {\n  collapsed: boolean;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\n/** Categories that should be collapsed by default */\nconst COLLAPSED_BY_DEFAULT: Set<FieldTypeCategory> = new Set(['advanced']);\n\n/** MIME type used for drag-and-drop data transfer */\nexport const PALETTE_DRAG_MIME = 'application/x-field-palette-type';\nexport const PALETTE_DRAG_META_MIME = 'application/x-field-palette-meta';\n\n// =============================================================================\n// Field Palette Panel\n// =============================================================================\n\nexport class FieldPalettePanel {\n  private config: FieldPalettePanelConfig;\n  private fieldTypes: FieldTypeMetadata[] = [];\n  private fieldTypeByKey: Map<string, FieldTypeMetadata> = new Map();\n  private fieldTypeKeyByRef: Map<FieldTypeMetadata, string> = new Map();\n  private categoryOrder: { id: FieldTypeCategory; label: string; icon: string; collapsed?: boolean }[] = [];\n  private searchQuery: string = '';\n  private categoryStates: Map<FieldTypeCategory, CategoryGroupState> = new Map();\n  private isLoading: boolean = true;\n  private enabled: boolean = false;\n\n  constructor(config: FieldPalettePanelConfig) {\n    this.config = config;\n    // Initialize category order from the fallback registry\n    this.categoryOrder = [...FIELD_TYPE_REGISTRY_FALLBACK.categories];\n  }\n\n  // ===========================================================================\n  // Public API\n  // ===========================================================================\n\n  /** Initialize: fetch field types and render */\n  async init(): Promise<void> {\n    this.isLoading = true;\n    this.render();\n    await this.loadFieldTypes();\n    this.isLoading = false;\n    this.render();\n  }\n\n  /** Enable the palette (a block is selected) */\n  enable(): void {\n    this.enabled = true;\n    this.render();\n  }\n\n  /** Disable the palette (no block selected) */\n  disable(): void {\n    this.enabled = false;\n    this.render();\n  }\n\n  /** Refresh field types from the API */\n  async refresh(): Promise<void> {\n    await this.loadFieldTypes();\n    this.render();\n  }\n\n  // ===========================================================================\n  // Data Loading (Task 9.1)\n  // ===========================================================================\n\n  private async loadFieldTypes(): Promise<void> {\n    const registry = await loadFieldTypeRegistry(this.config.api);\n    this.fieldTypes = registry.fieldTypes;\n    this.categoryOrder = registry.categories;\n\n    // Initialize collapse states for any new categories\n    this.initCategoryStates();\n    this.buildFieldTypeKeyMap();\n  }\n\n  private initCategoryStates(): void {\n    const seenCategories = new Set<FieldTypeCategory>();\n    for (const cat of this.categoryOrder) {\n      seenCategories.add(cat.id);\n    }\n    for (const cat of seenCategories) {\n      if (!this.categoryStates.has(cat)) {\n        this.categoryStates.set(cat, {\n          collapsed: COLLAPSED_BY_DEFAULT.has(cat),\n        });\n      }\n    }\n    for (const cat of this.categoryOrder) {\n      const state = this.categoryStates.get(cat.id) ?? { collapsed: false };\n      if (cat.collapsed !== undefined) {\n        state.collapsed = cat.collapsed;\n      }\n      this.categoryStates.set(cat.id, state);\n    }\n  }\n\n  private buildFieldTypeKeyMap(): void {\n    this.fieldTypeByKey.clear();\n    this.fieldTypeKeyByRef.clear();\n    this.fieldTypes.forEach((fieldType, index) => {\n      const key = `${fieldType.type}:${index}`;\n      this.fieldTypeByKey.set(key, fieldType);\n      this.fieldTypeKeyByRef.set(fieldType, key);\n    });\n  }\n\n  // ===========================================================================\n  // Rendering\n  // ===========================================================================\n\n  private render(): void {\n    const container = this.config.container;\n\n    if (this.isLoading) {\n      container.innerHTML = `\n        <div class=\"flex items-center justify-center py-12\">\n          <div class=\"animate-spin w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n        </div>`;\n      return;\n    }\n\n    if (!this.enabled) {\n      container.innerHTML = `\n        <div class=\"px-4 py-8 text-center\">\n          <svg class=\"w-10 h-10 mx-auto text-gray-200 dark:text-gray-700 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\"\n                  d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z\"></path>\n          </svg>\n          <p class=\"text-xs text-gray-400 dark:text-gray-500\">Select a block to see available field types</p>\n        </div>`;\n      return;\n    }\n\n    container.innerHTML = '';\n    // Ensure the container is a flex column so the list can scroll\n    container.classList.add('flex', 'flex-col', 'min-h-0');\n\n    // Search bar\n    const searchWrapper = document.createElement('div');\n    searchWrapper.className = 'px-3 py-2 border-b border-gray-100 dark:border-gray-800 shrink-0';\n    searchWrapper.innerHTML = `\n      <div class=\"relative\">\n        <svg class=\"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n        </svg>\n        <input type=\"text\"\n               data-palette-search\n               placeholder=\"Search fields...\"\n               value=\"${esc(this.searchQuery)}\"\n               class=\"w-full pl-9 pr-3 py-2 text-[13px] border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:bg-white dark:focus:bg-slate-700 transition-colors\" />\n      </div>`;\n    container.appendChild(searchWrapper);\n\n    // Field types grouped by category\n    const listWrapper = document.createElement('div');\n    listWrapper.className = 'overflow-y-auto flex-1 min-h-0';\n    listWrapper.setAttribute('data-palette-list', '');\n\n    if (this.searchQuery) {\n      listWrapper.innerHTML = this.renderSearchResults();\n    } else {\n      listWrapper.innerHTML = this.renderCategoryGroups();\n    }\n\n    container.appendChild(listWrapper);\n\n    this.bindEvents(container);\n  }\n\n  // ===========================================================================\n  // Rendering – Category Groups (Task 9.2)\n  // ===========================================================================\n\n  private renderCategoryGroups(): string {\n    let html = '';\n\n    for (const cat of this.categoryOrder) {\n      const types = this.fieldTypes.filter((ft) => ft.category === cat.id);\n      if (types.length === 0) continue;\n\n      const state = this.categoryStates.get(cat.id);\n      const isCollapsed = state?.collapsed ?? false;\n\n      html += `\n        <div data-palette-category=\"${esc(cat.id)}\" class=\"border-b border-gray-50 dark:border-gray-800\">\n          <button type=\"button\" data-palette-toggle=\"${esc(cat.id)}\"\n                  class=\"w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group\">\n            <span class=\"w-3 h-3 text-gray-400 dark:text-gray-500 flex items-center justify-center\" data-palette-chevron=\"${esc(cat.id)}\">\n              ${isCollapsed\n                ? '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n                : '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>'\n              }\n            </span>\n            <span class=\"flex-shrink-0 w-4 h-4 flex items-center justify-center text-gray-400 dark:text-gray-500\">${cat.icon}</span>\n            <span class=\"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider flex-1\">${esc(cat.label)}</span>\n            <span class=\"text-[11px] text-gray-400 dark:text-gray-500\">${types.length}</span>\n          </button>\n          <div class=\"${isCollapsed ? 'hidden' : ''}\" data-palette-category-body=\"${esc(cat.id)}\">\n            <div class=\"px-2 pb-2 space-y-0.5\">\n              ${types.map((ft) => this.renderPaletteItem(ft)).join('')}\n            </div>\n          </div>\n        </div>`;\n    }\n\n    if (!html) {\n      html = `\n        <div class=\"px-4 py-8 text-center\">\n          <p class=\"text-xs text-gray-400 dark:text-gray-500\">No field types available.</p>\n        </div>`;\n    }\n\n    return html;\n  }\n\n  // ===========================================================================\n  // Rendering – Search Results (Task 9.2)\n  // ===========================================================================\n\n  private renderSearchResults(): string {\n    const query = this.searchQuery.toLowerCase();\n    const matched = this.fieldTypes.filter(\n      (ft) =>\n        ft.label.toLowerCase().includes(query) ||\n        (ft.description ?? '').toLowerCase().includes(query) ||\n        ft.type.toLowerCase().includes(query)\n    );\n\n    if (matched.length === 0) {\n      return `\n        <div class=\"px-4 py-8 text-center\">\n          <svg class=\"w-8 h-8 mx-auto text-gray-200 dark:text-gray-700 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\"\n                  d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n          </svg>\n          <p class=\"text-xs text-gray-400 dark:text-gray-500\">No fields match \"${esc(this.searchQuery)}\"</p>\n        </div>`;\n    }\n\n    return `\n      <div class=\"px-2 py-2 space-y-0.5\">\n        ${matched.map((ft) => this.renderPaletteItem(ft)).join('')}\n      </div>`;\n  }\n\n  // ===========================================================================\n  // Rendering – Single Palette Item (Tasks 9.1 + 9.3)\n  // ===========================================================================\n\n  private renderPaletteItem(fieldType: FieldTypeMetadata): string {\n    const key = this.fieldTypeKeyByRef.get(fieldType) ?? fieldType.type;\n    return `\n      <div data-palette-item=\"${esc(key)}\"\n           draggable=\"true\"\n           class=\"flex items-center gap-2 px-2 py-1.5 rounded-md cursor-grab hover:bg-blue-50 dark:hover:bg-blue-900/20 active:cursor-grabbing transition-colors group select-none\"\n           title=\"${esc(fieldType.description)}\">\n        <span class=\"flex-shrink-0 text-gray-300 dark:text-gray-600 group-hover:text-gray-400 dark:group-hover:text-gray-500 cursor-grab\" data-palette-grip>\n          <svg class=\"w-3 h-3\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <circle cx=\"8\" cy=\"4\" r=\"2\"/><circle cx=\"16\" cy=\"4\" r=\"2\"/>\n            <circle cx=\"8\" cy=\"12\" r=\"2\"/><circle cx=\"16\" cy=\"12\" r=\"2\"/>\n            <circle cx=\"8\" cy=\"20\" r=\"2\"/><circle cx=\"16\" cy=\"20\" r=\"2\"/>\n          </svg>\n        </span>\n        <span class=\"flex-shrink-0 w-5 h-5 flex items-center justify-center rounded bg-gray-100 dark:bg-slate-800 text-gray-500 dark:text-gray-400 group-hover:bg-blue-100 dark:group-hover:bg-blue-900/30 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\">\n          ${fieldType.icon}\n        </span>\n        <span class=\"flex-1 min-w-0\">\n          <span class=\"block text-[12px] font-medium text-gray-700 dark:text-gray-300 group-hover:text-blue-700 dark:group-hover:text-blue-400 truncate\">${esc(fieldType.label)}</span>\n        </span>\n      </div>`;\n  }\n\n  // ===========================================================================\n  // Event Binding\n  // ===========================================================================\n\n  private bindEvents(root: HTMLElement): void {\n    // Search input\n    const searchInput = root.querySelector<HTMLInputElement>('[data-palette-search]');\n    searchInput?.addEventListener('input', () => {\n      this.searchQuery = searchInput.value;\n      const list = root.querySelector<HTMLElement>('[data-palette-list]');\n      if (list) {\n        list.innerHTML = this.searchQuery ? this.renderSearchResults() : this.renderCategoryGroups();\n        this.bindListEvents(list);\n      }\n    });\n\n    // Category and item events on the list\n    const list = root.querySelector<HTMLElement>('[data-palette-list]');\n    if (list) {\n      this.bindListEvents(list);\n    }\n  }\n\n  private bindListEvents(list: HTMLElement): void {\n    // Category toggle\n    list.querySelectorAll<HTMLElement>('[data-palette-toggle]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const catId = btn.dataset.paletteToggle as FieldTypeCategory;\n        const state = this.categoryStates.get(catId) ?? { collapsed: false };\n        state.collapsed = !state.collapsed;\n        this.categoryStates.set(catId, state);\n\n        const body = list.querySelector<HTMLElement>(`[data-palette-category-body=\"${catId}\"]`);\n        const chevron = list.querySelector<HTMLElement>(`[data-palette-chevron=\"${catId}\"]`);\n        if (body) body.classList.toggle('hidden', state.collapsed);\n        if (chevron) {\n          chevron.innerHTML = state.collapsed\n            ? '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n            : '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>';\n        }\n      });\n    });\n\n    // Palette item: click-to-add\n    list.querySelectorAll<HTMLElement>('[data-palette-item]').forEach((item) => {\n      item.addEventListener('click', (e) => {\n        // Don't fire click when drag is happening\n        if ((e as MouseEvent).detail === 0) return;\n        const fieldTypeKey = item.dataset.paletteItem as string;\n        const meta = this.fieldTypeByKey.get(fieldTypeKey) ?? this.fieldTypes.find((ft) => ft.type === fieldTypeKey);\n        if (meta) {\n          this.config.onAddField(meta);\n        }\n      });\n    });\n\n    // Palette item: drag start (Task 9.3)\n    list.querySelectorAll<HTMLElement>('[data-palette-item]').forEach((item) => {\n      item.addEventListener('dragstart', (e) => {\n        const fieldTypeKey = item.dataset.paletteItem!;\n        e.dataTransfer!.effectAllowed = 'copy';\n        const meta = this.fieldTypeByKey.get(fieldTypeKey) ?? this.fieldTypes.find((ft) => ft.type === fieldTypeKey);\n        if (meta) {\n          e.dataTransfer!.setData(PALETTE_DRAG_MIME, meta.type);\n          e.dataTransfer!.setData(PALETTE_DRAG_META_MIME, JSON.stringify(meta));\n        } else {\n          e.dataTransfer!.setData(PALETTE_DRAG_MIME, fieldTypeKey);\n        }\n        e.dataTransfer!.setData('text/plain', meta?.type ?? fieldTypeKey);\n        item.classList.add('opacity-50');\n      });\n\n      item.addEventListener('dragend', () => {\n        item.classList.remove('opacity-50');\n      });\n    });\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction esc(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n","/**\n * Shared Entity Header\n *\n * Renders a consistent header bar for both the Block Editor Panel\n * and Content Type Editor. Supports save state indicators, status\n * badges, version labels, and action button slots.\n *\n * Layout variants:\n *   compact (Block Editor):  name + subtitle left, save indicator + status right\n *   standard (Content Type): title + status + version left, actions right\n */\n\nimport { badge } from '../../shared/badge';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type SaveState = 'idle' | 'saving' | 'saved' | 'error';\n\nexport interface EntityHeaderConfig {\n  /** Primary name/title displayed in the header */\n  name: string;\n  /** Secondary line (slug, description, editing target) */\n  subtitle?: string;\n  /** Render subtitle in monospace font (true for slugs/types) */\n  subtitleMono?: boolean;\n  /** Status badge value (draft, published, etc.) */\n  status?: string;\n  /** Version label (displayed as \"vX.Y\") */\n  version?: string;\n  /** Current save state */\n  saveState?: SaveState;\n  /** Error message for save failures (shown as tooltip) */\n  saveMessage?: string;\n  /** Pre-rendered HTML for action buttons/dropdowns */\n  actions?: string;\n  /** Compact mode: smaller padding, h2 title (block editor vs content type) */\n  compact?: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Escape Helper\n// ---------------------------------------------------------------------------\n\nfunction esc(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\n// ---------------------------------------------------------------------------\n// Save Indicator (standalone — used by updateSaveState for in-place updates)\n// ---------------------------------------------------------------------------\n\n/**\n * Render a save state indicator pill.\n *\n * Returns empty string for 'idle' state. Exported standalone so\n * callers can update the indicator in-place without a full re-render.\n */\nexport function renderSaveIndicator(state: SaveState, message?: string): string {\n  switch (state) {\n    case 'saving':\n      return `<span data-save-state class=\"inline-flex items-center gap-1.5 text-[11px] font-medium text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 px-2.5 py-1 rounded-md\">\n        <span class=\"w-3 h-3 border-2 border-blue-400 border-t-transparent rounded-full animate-spin\"></span>\n        Saving\\u2026\n      </span>`;\n    case 'saved':\n      return `<span data-save-state class=\"inline-flex items-center gap-1.5 text-[11px] font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30 px-2.5 py-1 rounded-md\">\n        <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\n        </svg>\n        Saved\n      </span>`;\n    case 'error':\n      return `<span data-save-state class=\"inline-flex items-center gap-1.5 text-[11px] font-medium text-red-700 dark:text-red-300 bg-red-50 dark:bg-red-900/30 px-2.5 py-1 rounded-md\"${message ? ` title=\"${esc(message)}\"` : ''}>\n        <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n        </svg>\n        Save failed\n      </span>`;\n    default:\n      return '';\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Entity Header\n// ---------------------------------------------------------------------------\n\n/**\n * Render a shared entity header bar.\n *\n * In **compact** mode (Block Editor):\n *   Left:  h2 name + mono subtitle\n *   Right: save indicator → status badge\n *\n * In **standard** mode (Content Type Editor):\n *   Left:  h1 name + status badge + version (row), subtitle below\n *   Right: save indicator + actions slot\n */\nexport function renderEntityHeader(config: EntityHeaderConfig): string {\n  const {\n    name,\n    subtitle,\n    subtitleMono = false,\n    status,\n    version,\n    saveState = 'idle',\n    saveMessage,\n    actions,\n    compact = false,\n  } = config;\n\n  const px = compact ? 'px-5' : 'px-6';\n  const tag = compact ? 'h2' : 'h1';\n  const titleSize = compact ? 'text-lg' : 'text-xl';\n  const gap = compact ? 'gap-2.5' : 'gap-3';\n\n  const saveHtml = renderSaveIndicator(saveState, saveMessage);\n\n  // Status badge HTML\n  const statusBadgeHtml = status\n    ? badge(\n        compact ? status : status.charAt(0).toUpperCase() + status.slice(1),\n        'status',\n        status,\n        compact ? { uppercase: true, attrs: { 'data-entity-status-badge': '' } } : { attrs: { 'data-entity-status-badge': '' } },\n      )\n    : '';\n\n  // Version label\n  const versionHtml = version\n    ? `<span class=\"text-xs text-gray-400 dark:text-gray-500\">v${esc(version)}</span>`\n    : '';\n\n  // Subtitle line\n  const subtitleHtml = subtitle\n    ? `<p class=\"${subtitleMono ? 'text-[11px] font-mono text-gray-400 dark:text-gray-500' : 'text-sm text-gray-500 dark:text-gray-400'} mt-0.5 truncate\">${esc(subtitle)}</p>`\n    : '';\n\n  if (compact) {\n    // Block Editor layout: name left, indicators right\n    return `\n      <div class=\"${px} py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900 flex items-center justify-between shrink-0\">\n        <div class=\"min-w-0 flex-1\">\n          <${tag} class=\"${titleSize} font-semibold text-gray-900 dark:text-white truncate leading-snug\" data-entity-name>${esc(name)}</${tag}>\n          ${subtitleHtml}\n        </div>\n        <div class=\"flex items-center ${gap} shrink-0\">\n          <span data-entity-save-indicator>${saveHtml}</span>\n          ${statusBadgeHtml}\n          ${actions || ''}\n        </div>\n      </div>`;\n  }\n\n  // Standard layout: title row with badge + version, actions on right\n  return `\n    <div class=\"${px} py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900 flex items-center justify-between shrink-0\">\n      <div>\n        <div class=\"flex items-center gap-3\">\n          <${tag} class=\"${titleSize} font-semibold text-gray-900 dark:text-white\" data-entity-name>${esc(name)}</${tag}>\n          ${statusBadgeHtml}\n          ${versionHtml}\n        </div>\n        ${subtitleHtml}\n      </div>\n      <div class=\"flex items-center ${gap}\">\n        <span data-entity-save-indicator>${saveHtml}</span>\n        ${actions || ''}\n      </div>\n    </div>`;\n}\n","/**\n * Shared Field Card\n *\n * Renders a consistent field card for both the Block Editor Panel\n * and Content Type Editor. Supports drag-and-drop, expand/collapse,\n * reorder buttons, and custom action slots.\n *\n * Both surfaces use the same standard sizing by default (compact=false).\n */\n\nimport type { FieldDefinition } from '../types';\nimport { getFieldTypeMetadata } from '../field-type-picker';\nimport { badge } from '../../shared/badge';\nimport { dragHandleIcon } from './field-input-classes';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface FieldCardConfig {\n  /** The field definition to render */\n  field: FieldDefinition;\n  /** Card is expanded (accordion body visible) */\n  isExpanded?: boolean;\n  /** Card is selected (highlighted border) */\n  isSelected?: boolean;\n  /** Card is a drop target for drag-and-drop */\n  isDropTarget?: boolean;\n  /** Card has validation errors */\n  hasErrors?: boolean;\n  /** Error messages shown below the metadata line */\n  errorMessages?: string[];\n  /** Show up/down reorder buttons */\n  showReorderButtons?: boolean;\n  /** First in group — disables \"move up\" */\n  isFirst?: boolean;\n  /** Last in group — disables \"move down\" */\n  isLast?: boolean;\n  /** Compact mode: xs sizes, tighter padding (block editor) */\n  compact?: boolean;\n  /** Slot: render expanded accordion content. If provided, expand toggle is shown */\n  renderExpandedContent?: () => string;\n  /** Slot: pre-rendered HTML for surface-specific actions (menus, buttons) */\n  actionsHtml?: string;\n  /** Optional constraint summary badges (e.g. \"min: 5\", \"pattern\") */\n  constraintBadges?: string[];\n  /** Section name for data-field-section attribute */\n  sectionName?: string;\n  /** Index for data-field-index attribute */\n  index?: number;\n}\n\n// ---------------------------------------------------------------------------\n// Escape Helper\n// ---------------------------------------------------------------------------\n\nfunction esc(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\n// ---------------------------------------------------------------------------\n// SVG Icons (inlined to avoid external dependencies)\n// ---------------------------------------------------------------------------\n\nconst CHEVRON_UP = '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 15l7-7 7 7\"></path></svg>';\nconst CHEVRON_DOWN = '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>';\nconst EXPAND_ICON = '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path></svg>';\nconst COLLAPSE_ICON = '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"></path></svg>';\nconst ERROR_ICON = '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>';\n\n// ---------------------------------------------------------------------------\n// Render\n// ---------------------------------------------------------------------------\n\n/**\n * Render a shared field card.\n *\n * Both surfaces use the standard sizing by default.\n * Set `compact: true` for a denser layout (smaller padding, xs text).\n */\nexport function renderFieldCard(config: FieldCardConfig): string {\n  const {\n    field,\n    isExpanded = false,\n    isSelected = false,\n    isDropTarget = false,\n    hasErrors = false,\n    errorMessages = [],\n    showReorderButtons = false,\n    isFirst = false,\n    isLast = false,\n    compact = false,\n    renderExpandedContent,\n    actionsHtml = '',\n    constraintBadges = [],\n    sectionName,\n    index,\n  } = config;\n\n  const meta = getFieldTypeMetadata(field.type);\n  const expandable = typeof renderExpandedContent === 'function';\n\n  // --- Wrapper state classes ---\n  let wrapperState: string;\n  if (hasErrors) {\n    wrapperState = 'border-red-400 bg-red-50 dark:bg-red-900/10';\n  } else if (isExpanded) {\n    wrapperState = 'border-blue-200 dark:border-blue-800 bg-blue-50/30 dark:bg-blue-900/20';\n  } else if (isSelected) {\n    wrapperState = 'border-blue-500 bg-blue-50 dark:bg-blue-900/20';\n  } else {\n    wrapperState = 'border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900 hover:border-gray-300 dark:hover:border-gray-600';\n  }\n\n  const dropClass = isDropTarget ? 'border-t-2 border-t-blue-400' : '';\n\n  // --- Size variants ---\n  const gapClass = compact ? 'gap-1.5 px-2 py-2' : 'gap-3 p-3';\n  const iconSize = compact ? 'w-7 h-7 rounded-md' : 'w-8 h-8 rounded-lg';\n  const labelSize = compact ? 'text-[13px]' : 'text-sm';\n  const metaSize = compact ? 'text-[10px]' : 'text-xs';\n  const handleSize = compact ? 'xs' as const : 'sm' as const;\n\n  // --- Field type icon ---\n  const iconBg = hasErrors\n    ? 'bg-red-100 dark:bg-red-900/30 text-red-600'\n    : 'bg-gray-100 dark:bg-slate-800 text-gray-500 dark:text-gray-400';\n  const iconContent = hasErrors ? ERROR_ICON : (meta?.icon ?? '?');\n\n  // --- Badges (required / readonly / hidden) ---\n  const badges: string[] = [];\n  if (field.required) {\n    badges.push(badge('req', 'status', 'required', { size: 'sm', uppercase: true, extraClass: 'flex-shrink-0' }));\n  }\n  if (field.readonly) {\n    badges.push(badge('ro', 'status', 'readonly', { size: 'sm', uppercase: true, extraClass: 'flex-shrink-0' }));\n  }\n  if (field.hidden) {\n    badges.push(badge('hid', 'status', 'hidden', { size: 'sm', uppercase: true, extraClass: 'flex-shrink-0' }));\n  }\n  const badgesHtml = badges.join('\\n          ');\n\n  // --- Data attributes ---\n  let dataAttrs = `data-field-card=\"${esc(field.id)}\"`;\n  if (sectionName != null) dataAttrs += ` data-field-section=\"${esc(sectionName)}\"`;\n  if (index != null) dataAttrs += ` data-field-index=\"${index}\"`;\n\n  // --- Metadata line ---\n  let metaLine: string;\n  if (compact) {\n    metaLine = `${esc(field.name)} &middot; ${esc(field.type)}`;\n  } else {\n    const typeLabel = meta?.label ?? field.type;\n    const parts = [\n      `<span class=\"font-mono\">${esc(field.name)}</span>`,\n      `<span>&middot;</span>`,\n      `<span>${esc(typeLabel)}</span>`,\n    ];\n    if (field.section) parts.push(`<span>&middot; ${esc(field.section)}</span>`);\n    if (field.gridSpan) parts.push(`<span>&middot; ${field.gridSpan} cols</span>`);\n    metaLine = parts.join(' ');\n  }\n\n  // --- Constraint badges (optional, typically content-type editor) ---\n  let constraintHtml = '';\n  if (constraintBadges.length > 0) {\n    constraintHtml = `\n            <div class=\"flex items-center gap-1 mt-1\">\n              ${constraintBadges.map(c => `<span class=\"text-xs px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-gray-500 dark:text-gray-400\">${esc(c)}</span>`).join('')}\n            </div>`;\n  }\n\n  // --- Error messages ---\n  let errorHtml = '';\n  if (hasErrors && errorMessages.length > 0) {\n    errorHtml = `\n            <div class=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n              ${errorMessages.map(msg => esc(msg)).join(', ')}\n            </div>`;\n  }\n\n  // --- Reorder buttons ---\n  let reorderHtml = '';\n  if (showReorderButtons) {\n    const upDisabled = isFirst;\n    const downDisabled = isLast;\n    const upClass = upDisabled\n      ? 'text-gray-200 dark:text-gray-700 cursor-not-allowed'\n      : 'text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800';\n    const downClass = downDisabled\n      ? 'text-gray-200 dark:text-gray-700 cursor-not-allowed'\n      : 'text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800';\n\n    reorderHtml = `\n          <span class=\"flex-shrink-0 inline-flex flex-col border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden\">\n            <button type=\"button\" data-field-move-up=\"${esc(field.id)}\"\n                    class=\"px-0.5 py-px ${upClass} transition-colors\"\n                    title=\"Move up\" ${upDisabled ? 'disabled' : ''}>\n              ${CHEVRON_UP}\n            </button>\n            <span class=\"block h-px bg-gray-200 dark:bg-gray-700\"></span>\n            <button type=\"button\" data-field-move-down=\"${esc(field.id)}\"\n                    class=\"px-0.5 py-px ${downClass} transition-colors\"\n                    title=\"Move down\" ${downDisabled ? 'disabled' : ''}>\n              ${CHEVRON_DOWN}\n            </button>\n          </span>`;\n  }\n\n  // --- Expand toggle ---\n  let expandToggle = '';\n  if (expandable) {\n    expandToggle = `\n          <span class=\"flex-shrink-0 w-5 h-5 flex items-center justify-center rounded text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 cursor-pointer transition-colors\">\n            ${isExpanded ? COLLAPSE_ICON : EXPAND_ICON}\n          </span>`;\n  }\n\n  return `\n      <div ${dataAttrs}\n           draggable=\"true\"\n           class=\"rounded-lg border ${dropClass} ${wrapperState} transition-colors\">\n        <div class=\"flex items-center ${gapClass} select-none\" ${expandable ? `data-field-toggle=\"${esc(field.id)}\"` : ''}>\n          <span class=\"flex-shrink-0 text-gray-300 dark:text-gray-600 hover:text-gray-400 dark:hover:text-gray-500 cursor-grab active:cursor-grabbing\" data-field-grip=\"${esc(field.id)}\">\n            ${dragHandleIcon(handleSize)}\n          </span>\n          <span class=\"flex-shrink-0 ${iconSize} flex items-center justify-center ${iconBg} text-[11px]\">\n            ${iconContent}\n          </span>\n          <span class=\"flex-1 min-w-0 ${expandable ? 'cursor-pointer' : ''}\">\n            <span class=\"block ${labelSize} font-medium text-gray-800 dark:text-gray-100 truncate\">${esc(field.label || field.name)}</span>\n            <span class=\"block ${metaSize} text-gray-400 dark:text-gray-500 ${compact ? 'font-mono' : ''} truncate\">${metaLine}</span>${constraintHtml}${errorHtml}\n          </span>\n          ${badgesHtml}\n          ${reorderHtml}\n          ${actionsHtml}\n          ${expandToggle}\n        </div>\n        ${isExpanded && expandable ? renderExpandedContent!() : ''}\n      </div>`;\n}\n\n// ---------------------------------------------------------------------------\n// Shared Kebab Actions Menu\n// ---------------------------------------------------------------------------\n\nconst KEBAB_ICON = '<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z\"></path></svg>';\n\n/**\n * Render a kebab (⋮) action button for a field card.\n * Both surfaces use this to trigger contextual menus.\n */\nexport function renderFieldKebab(fieldId: string): string {\n  return `<button type=\"button\" data-field-actions=\"${esc(fieldId)}\"\n                    class=\"p-1.5 rounded-md text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors\"\n                    title=\"Field actions\">\n              ${KEBAB_ICON}\n            </button>`;\n}\n\n// ---------------------------------------------------------------------------\n// Shared Drop Zone\n// ---------------------------------------------------------------------------\n\nexport interface DropZoneConfig {\n  /** Whether the zone is currently highlighted (drag hover) */\n  highlight?: boolean;\n  /** Helper text shown inside the zone */\n  text?: string;\n}\n\n/**\n * Render a shared field drop zone used at the bottom of field lists.\n * Both the Block Editor and Content Type Editor use this.\n */\nexport function renderDropZone(config: DropZoneConfig = {}): string {\n  const {\n    highlight = false,\n    text = 'Drop a field here or click a field type in the palette',\n  } = config;\n  const highlightClass = highlight\n    ? 'border-blue-400 bg-blue-50/50 dark:bg-blue-900/20'\n    : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600';\n  return `\n      <div data-field-drop-zone\n           class=\"mx-3 my-2 py-6 border-2 border-dashed rounded-lg text-center transition-colors ${highlightClass}\">\n        <p class=\"text-xs text-gray-400 dark:text-gray-500\">${esc(text)}</p>\n      </div>`;\n}\n","/**\n * Content Type Editor\n *\n * Main editor component for creating/editing content types.\n * Includes field list with drag-and-drop ordering, quick edit cards,\n * and schema preview integration.\n */\n\nimport type {\n  ContentType,\n  ContentTypeEditorConfig,\n  FieldDefinition,\n  FieldType,\n  JSONSchema,\n  UISchemaOverlay,\n  UILayoutConfig,\n  UIOverride,\n  ContentTypeBuilderState,\n  SchemaValidationError,\n  ContentTypeCapabilities,\n  ContentTypeSchemaVersion,\n  CompatibilityCheckResult,\n  SchemaChange,\n  BlocksFieldConfig,\n  BlockDefinitionSummary,\n} from './types';\nimport { ContentTypeAPIClient, fieldsToSchema, schemaToFields, generateFieldId, mergeSchemaWithBase } from './api-client';\nimport { FieldTypePicker, getFieldTypeMetadata, FIELD_TYPES, normalizeFieldType } from './field-type-picker';\nimport { FieldConfigForm } from './field-config-form';\nimport { FieldPalettePanel, PALETTE_DRAG_MIME, PALETTE_DRAG_META_MIME } from './field-palette-panel';\nimport { LayoutEditor } from './layout-editor';\nimport { Modal, ConfirmModal } from '../shared/modal';\nimport { inputClasses, textareaClasses, labelClasses } from './shared/field-input-classes';\nimport { renderIconTrigger, bindIconTriggerEvents, closeIconPicker } from './shared/icon-picker';\nimport { renderEntityHeader } from './shared/entity-header';\nimport { renderFieldCard as renderFieldCardShared, renderFieldKebab, renderDropZone } from './shared/field-card';\nimport { loadAvailableBlocks, normalizeBlockSelection, renderInlineBlockPicker, bindInlineBlockPickerEvents } from './shared/block-picker';\n\n// =============================================================================\n// Content Type Editor Component\n// =============================================================================\n\nconst DEFAULT_SECTION = 'main';\n\n// Extended state with layout\ninterface ExtendedBuilderState extends ContentTypeBuilderState {\n  layout: UILayoutConfig;\n  previewError: string | null;\n  originalSchema: JSONSchema | null;\n  initialFieldsSignature: string;\n}\n\nexport class ContentTypeEditor {\n  private config: ContentTypeEditorConfig;\n  private container: HTMLElement;\n  private api: ContentTypeAPIClient;\n  private state: ExtendedBuilderState;\n  private dragState: DragState | null = null;\n  private dropIndicator: HTMLElement | null = null;\n  private dragOverRAF: number | null = null;\n  private staticEventsBound = false;\n  private previewDebounceTimer: ReturnType<typeof setTimeout> | null = null;\n  private palettePanel: FieldPalettePanel | null = null;\n  private paletteVisible = false;\n  private sectionStates: Map<string, { collapsed: boolean }> = new Map();\n  private lifecycleOutsideClickHandler: ((e: MouseEvent) => void) | null = null;\n  private cachedBlocks: BlockDefinitionSummary[] | null = null;\n  private blocksLoading = false;\n  private blockPickerModes: Map<string, 'allowed' | 'denied'> = new Map();\n  /** Currently open field kebab menu (null = none open) */\n  private fieldActionsMenuId: string | null = null;\n\n  constructor(container: HTMLElement, config: ContentTypeEditorConfig) {\n    this.container = container;\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    const configuredEnvironment = this.normalizeEnvironment(config.environment);\n    if (configuredEnvironment) {\n      this.api.setEnvironment(configuredEnvironment);\n    }\n    this.state = {\n      contentType: null,\n      fields: [],\n      isDirty: false,\n      isLoading: false,\n      isSaving: false,\n      isPreviewing: false,\n      validationErrors: [],\n      selectedFieldId: null,\n      previewHtml: null,\n      previewError: null,\n      layout: { type: 'flat', gridColumns: 12, tabs: [] },\n      originalSchema: null,\n      initialFieldsSignature: '',\n    };\n  }\n\n  private normalizeEnvironment(value?: string): string {\n    const normalized = String(value ?? '').trim().toLowerCase();\n    return normalized;\n  }\n\n  /**\n   * Initialize the editor\n   */\n  async init(): Promise<void> {\n    this.render();\n    this.bindEvents();\n\n    // Load existing content type if editing\n    if (this.config.contentTypeId) {\n      await this.loadContentType(this.config.contentTypeId);\n    }\n  }\n\n  /**\n   * Load a content type for editing\n   */\n  async loadContentType(idOrSlug: string): Promise<void> {\n    this.state.isLoading = true;\n    this.updateLoadingState();\n\n    try {\n      const contentType = await this.api.get(idOrSlug);\n      this.state.contentType = contentType;\n      this.state.fields = schemaToFields(contentType.schema);\n      this.state.originalSchema = contentType.schema ?? null;\n      this.state.initialFieldsSignature = this.serializeFields(this.state.fields);\n      // Load layout from ui_schema\n      if (contentType.ui_schema?.layout) {\n        this.state.layout = {\n          type: contentType.ui_schema.layout.type ?? 'flat',\n          tabs: contentType.ui_schema.layout.tabs ?? [],\n          gridColumns: contentType.ui_schema.layout.gridColumns ?? 12,\n        };\n      }\n      this.state.isDirty = false;\n      this.render();\n      this.bindEvents();\n      this.schedulePreview();\n    } catch (error) {\n      console.error('Failed to load content type:', error);\n      this.showToast('Failed to load content type', 'error');\n    } finally {\n      this.state.isLoading = false;\n      this.updateLoadingState();\n    }\n  }\n\n  /**\n   * Save the content type\n   */\n  async save(): Promise<void> {\n    if (this.state.isSaving) return;\n\n    // Validate required fields\n    const nameInput = this.container.querySelector<HTMLInputElement>('[data-ct-name]');\n    const name = nameInput?.value?.trim();\n    if (!name) {\n      this.showToast('Name is required', 'error');\n      nameInput?.focus();\n      return;\n    }\n\n    // Build content type data\n    const schema = this.buildSchemaPayload();\n    const contentType: Partial<ContentType> = {\n      name,\n      slug: this.getSlug(),\n      description: this.getDescription(),\n      icon: this.getIcon(),\n      schema,\n      ui_schema: this.buildUISchema(),\n      capabilities: this.getCapabilities(),\n    };\n\n    this.state.isSaving = true;\n    this.updateSavingState();\n\n    try {\n      let saved: ContentType;\n      if (this.state.contentType?.id) {\n        saved = await this.api.update(this.state.contentType.id, contentType);\n      } else {\n        saved = await this.api.create(contentType);\n      }\n\n      this.state.contentType = saved;\n      this.state.originalSchema = saved.schema ?? null;\n      this.state.initialFieldsSignature = this.serializeFields(this.state.fields);\n      this.state.isDirty = false;\n      this.showToast('Content type saved successfully', 'success');\n      this.config.onSave?.(saved);\n    } catch (error) {\n      console.error('Failed to save content type:', error);\n      const message = error instanceof Error ? error.message : 'Failed to save content type';\n      this.showToast(message, 'error');\n    } finally {\n      this.state.isSaving = false;\n      this.updateSavingState();\n    }\n  }\n\n  private buildSchemaPayload(): JSONSchema {\n    const generated = fieldsToSchema(this.state.fields, this.getSlug());\n    if (!this.schemaHasChanges() && this.state.originalSchema) {\n      return this.state.originalSchema;\n    }\n    return mergeSchemaWithBase(this.state.originalSchema, generated);\n  }\n\n  private schemaHasChanges(): boolean {\n    if (!this.state.initialFieldsSignature) {\n      return true;\n    }\n    return this.serializeFields(this.state.fields) !== this.state.initialFieldsSignature;\n  }\n\n  private serializeFields(fields: FieldDefinition[]): string {\n    const normalized = fields.map((field) => ({\n      name: field.name,\n      type: field.type,\n      label: field.label,\n      description: field.description,\n      placeholder: field.placeholder,\n      helpText: field.helpText,\n      required: field.required,\n      readonly: field.readonly,\n      hidden: field.hidden,\n      filterable: field.filterable,\n      defaultValue: field.defaultValue,\n      section: field.section,\n      gridSpan: field.gridSpan,\n      order: field.order,\n      validation: field.validation,\n      config: field.config,\n    }));\n    return JSON.stringify(normalized);\n  }\n\n  /**\n   * Add a new field\n   */\n  addField(type: FieldType): void {\n    const metadata = getFieldTypeMetadata(type);\n\n    // Auto-generate defaults for blocks fields (Phase 4 — Task 4.2)\n    if (type === 'blocks') {\n      const existingNames = new Set(this.state.fields.map((f) => f.name));\n      let name = 'content_blocks';\n      let label = 'Content Blocks';\n      let counter = 1;\n      while (existingNames.has(name)) {\n        name = `content_blocks_${counter}`;\n        label = `Content Blocks ${counter}`;\n        counter++;\n      }\n      const field: FieldDefinition = {\n        id: generateFieldId(),\n        name,\n        type,\n        label,\n        required: false,\n        order: this.state.fields.length,\n        ...(metadata?.defaultConfig ?? {}),\n      };\n      this.state.fields.push(field);\n      this.state.selectedFieldId = field.id;\n      this.state.isDirty = true;\n      this.renderFieldList();\n      this.updateDirtyState();\n      this.schedulePreview();\n      this.loadBlocksForField(field);\n      return;\n    }\n\n    const field: FieldDefinition = {\n      id: generateFieldId(),\n      name: `new_${type}_${this.state.fields.length + 1}`,\n      type,\n      label: metadata?.label ?? type,\n      required: false,\n      order: this.state.fields.length,\n      ...(metadata?.defaultConfig ?? {}),\n    };\n\n    // Open config form for the new field\n    const configForm = new FieldConfigForm({\n      field,\n      existingFieldNames: this.state.fields.map((f) => f.name),\n      apiBasePath: this.config.apiBasePath,\n      onSave: (updatedField) => {\n        this.state.fields.push(updatedField);\n        this.state.isDirty = true;\n        this.renderFieldList();\n        this.updateDirtyState();\n        this.schedulePreview();\n      },\n      onCancel: () => {},\n    });\n    configForm.show();\n  }\n\n  /**\n   * Edit an existing field\n   */\n  editField(fieldId: string): void {\n    const field = this.state.fields.find((f) => f.id === fieldId);\n    if (!field) return;\n\n    const configForm = new FieldConfigForm({\n      field,\n      existingFieldNames: this.state.fields.filter((f) => f.id !== fieldId).map((f) => f.name),\n      apiBasePath: this.config.apiBasePath,\n      onSave: (updatedField) => {\n        const index = this.state.fields.findIndex((f) => f.id === fieldId);\n        if (index !== -1) {\n          this.state.fields[index] = updatedField;\n          this.state.isDirty = true;\n          this.renderFieldList();\n          this.updateDirtyState();\n          this.schedulePreview();\n        }\n      },\n      onCancel: () => {},\n    });\n    configForm.show();\n  }\n\n  /**\n   * Remove a field\n   */\n  async removeField(fieldId: string): Promise<void> {\n    const index = this.state.fields.findIndex((f) => f.id === fieldId);\n    if (index === -1) return;\n\n    const field = this.state.fields[index];\n    const confirmed = await ConfirmModal.confirm(\n      `Remove field \"${field.label}\"?`,\n      { title: 'Remove Field', confirmText: 'Remove', confirmVariant: 'danger' },\n    );\n    if (!confirmed) return;\n\n    this.state.fields.splice(index, 1);\n    this.state.isDirty = true;\n    this.renderFieldList();\n    this.updateDirtyState();\n    this.schedulePreview();\n  }\n\n  /**\n   * Move a field to a new position (optionally across sections)\n   */\n  moveField(fieldId: string, targetSection: string, targetIndex: number): void {\n    const currentIndex = this.state.fields.findIndex((f) => f.id === fieldId);\n    if (currentIndex === -1) return;\n\n    const field = this.state.fields[currentIndex];\n    const sourceSection = field.section || DEFAULT_SECTION;\n    const normalizedTarget = targetSection || DEFAULT_SECTION;\n\n    const sections = this.groupFieldsBySection();\n    const sourceList = sections.get(sourceSection);\n    if (!sourceList) return;\n\n    const fromIndex = sourceList.findIndex((f) => f.id === fieldId);\n    if (fromIndex === -1) return;\n\n    sourceList.splice(fromIndex, 1);\n    if (sourceList.length === 0) {\n      sections.delete(sourceSection);\n    }\n\n    if (!sections.has(normalizedTarget)) {\n      sections.set(normalizedTarget, []);\n    }\n\n    const targetList = sections.get(normalizedTarget)!;\n    let insertIndex = Math.max(0, Math.min(targetIndex, targetList.length));\n    if (sourceSection === normalizedTarget && fromIndex < insertIndex) {\n      insertIndex -= 1;\n    }\n    targetList.splice(insertIndex, 0, field);\n\n    field.section = normalizedTarget === DEFAULT_SECTION ? undefined : normalizedTarget;\n\n    const ordered = new Map<string, FieldDefinition[]>();\n    if (sections.has(DEFAULT_SECTION)) {\n      ordered.set(DEFAULT_SECTION, sections.get(DEFAULT_SECTION)!);\n    }\n    for (const [key, list] of sections) {\n      if (key === DEFAULT_SECTION) continue;\n      ordered.set(key, list);\n    }\n    this.state.fields = Array.from(ordered.values()).flat();\n\n    // Update order values\n    this.state.fields.forEach((f, i) => {\n      f.order = i;\n    });\n\n    this.state.isDirty = true;\n    this.renderFieldList();\n    this.updateDirtyState();\n    this.schedulePreview();\n  }\n\n  /**\n   * Move a field up (-1) or down (+1) within its section\n   */\n  moveFieldByDirection(fieldId: string, direction: -1 | 1): void {\n    const field = this.state.fields.find((f) => f.id === fieldId);\n    if (!field) return;\n\n    const sectionName = field.section || DEFAULT_SECTION;\n    const sectionFields = this.state.fields.filter((f) => (f.section || DEFAULT_SECTION) === sectionName);\n    const indexInSection = sectionFields.findIndex((f) => f.id === fieldId);\n    const newIndex = indexInSection + direction;\n\n    if (newIndex < 0 || newIndex >= sectionFields.length) return;\n\n    // Swap in the master fields array\n    const globalA = this.state.fields.indexOf(sectionFields[indexInSection]);\n    const globalB = this.state.fields.indexOf(sectionFields[newIndex]);\n    [this.state.fields[globalA], this.state.fields[globalB]] = [this.state.fields[globalB], this.state.fields[globalA]];\n\n    this.state.isDirty = true;\n    this.renderFieldList();\n    this.updateDirtyState();\n    this.schedulePreview();\n  }\n\n  /**\n   * Validate the schema\n   */\n  async validateSchema(): Promise<void> {\n    const schema = this.buildSchemaPayload();\n\n    try {\n      const result = await this.api.validateSchema({\n        schema,\n        slug: this.getSlug(),\n        ui_schema: this.buildUISchema(),\n      });\n\n      if (result.valid) {\n        this.state.validationErrors = [];\n        this.showToast('Schema is valid', 'success');\n      } else {\n        this.state.validationErrors = result.errors ?? [];\n        this.showToast('Schema has validation errors', 'error');\n      }\n    } catch (error) {\n      console.error('Validation failed:', error);\n      const message = error instanceof Error ? error.message : 'Validation failed';\n      this.showToast(message, 'error');\n    }\n\n    this.renderValidationErrors();\n  }\n\n  /**\n   * Preview the schema as a rendered form\n   */\n  async previewSchema(): Promise<void> {\n    if (this.state.isPreviewing) return;\n\n    // Guard: skip API call when there are no fields\n    if (this.state.fields.length === 0) {\n      this.state.previewHtml = null;\n      this.state.previewError = null;\n      const previewContainer = this.container.querySelector('[data-ct-preview-container]');\n      if (previewContainer) {\n        previewContainer.innerHTML = `\n          <div class=\"flex flex-col items-center justify-center h-40 text-gray-400\">\n            <svg class=\"w-10 h-10 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"></path>\n            </svg>\n            <p class=\"text-sm\">Add fields to preview the form</p>\n          </div>\n        `;\n      }\n      return;\n    }\n\n    const schema = fieldsToSchema(this.state.fields, this.getSlug());\n\n    this.state.isPreviewing = true;\n    this.updatePreviewState();\n\n    try {\n      const result = await this.api.previewSchema({\n        schema,\n        slug: this.getSlug(),\n        ui_schema: this.buildUISchema(),\n      });\n\n      this.state.previewHtml = result.html;\n      this.state.previewError = null;\n      this.renderPreview();\n    } catch (error) {\n      console.error('Preview failed:', error);\n      const message = error instanceof Error ? error.message : 'Preview failed';\n      this.state.previewHtml = null;\n      this.state.previewError = message;\n      this.renderPreview();\n    } finally {\n      this.state.isPreviewing = false;\n      this.updatePreviewState();\n    }\n  }\n\n  // ===========================================================================\n  // Rendering\n  // ===========================================================================\n\n  private render(): void {\n    closeIconPicker();\n    // Recreate palette after full re-render to avoid stale DOM references\n    this.palettePanel = null;\n    this.container.innerHTML = `\n      <div class=\"content-type-editor flex flex-col h-full\" data-content-type-editor>\n        <!-- Header -->\n        ${this.renderHeader()}\n\n        <!-- Main Content -->\n        <div class=\"flex-1 flex overflow-hidden\">\n          <!-- Left Panel: Basic Info + Fields -->\n          <div class=\"flex-1 overflow-y-auto p-6 space-y-6\">\n            ${this.renderBasicInfo()}\n            ${this.renderFieldsSection()}\n            ${this.renderCapabilitiesSection()}\n          </div>\n\n          <!-- Right Panel: Preview -->\n          <div class=\"w-[400px] border-l border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-950 overflow-y-auto\">\n            ${this.renderPreviewPanel()}\n          </div>\n        </div>\n\n        <!-- Validation Errors -->\n        <div data-ct-validation-errors class=\"hidden\"></div>\n      </div>\n    `;\n  }\n\n  private renderBasicInfo(): string {\n    const ct = this.state.contentType;\n\n    return `\n      <div class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\n        <h2 class=\"text-sm font-medium text-gray-900 dark:text-white mb-4\">Basic Information</h2>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label class=\"${labelClasses()}\">\n              Name <span class=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              data-ct-name\n              value=\"${escapeHtml(ct?.name ?? '')}\"\n              placeholder=\"Blog Post\"\n              required\n              class=\"${inputClasses()}\"\n            />\n          </div>\n\n          <div>\n            <label class=\"${labelClasses()}\">\n              Slug\n            </label>\n            <input\n              type=\"text\"\n              data-ct-slug\n              value=\"${escapeHtml(ct?.slug ?? '')}\"\n              placeholder=\"blog-post\"\n              pattern=\"^[a-z][a-z0-9_\\\\-]*$\"\n              class=\"${inputClasses()}\"\n            />\n            <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Auto-generated from name if empty</p>\n          </div>\n        </div>\n\n        <div class=\"mt-4\">\n          <label class=\"${labelClasses()}\">\n            Description\n          </label>\n          <textarea\n            data-ct-description\n            rows=\"2\"\n            placeholder=\"Describe this content type\"\n            class=\"${textareaClasses()}\"\n          >${escapeHtml(ct?.description ?? '')}</textarea>\n        </div>\n\n        <div class=\"mt-4\">\n          <label class=\"${labelClasses()}\">\n            Icon\n          </label>\n          ${renderIconTrigger(ct?.icon ?? '', 'data-ct-icon')}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderFieldsSection(): string {\n    const layoutType = this.state.layout.type ?? 'flat';\n    const layoutLabel = layoutType === 'tabs' ? 'Tabs' : layoutType === 'sections' ? 'Sections' : 'Flat';\n\n    return `\n      <div class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n          <div class=\"flex items-center gap-4\">\n            <h2 class=\"text-sm font-medium text-gray-900 dark:text-white\">\n              Fields (${this.state.fields.length})\n            </h2>\n            <button\n              type=\"button\"\n              data-ct-layout\n              class=\"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 rounded hover:bg-gray-200 dark:hover:bg-gray-700\"\n            >\n              <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6z\"></path>\n              </svg>\n              Layout: ${layoutLabel}\n            </button>\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <button\n              type=\"button\"\n              data-ct-toggle-palette\n              class=\"flex items-center gap-1 px-2 py-1 text-xs ${this.paletteVisible ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20' : 'text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800'} rounded hover:bg-gray-200 dark:hover:bg-gray-700\"\n            >\n              <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h8m-8 6h16\"></path>\n              </svg>\n              Palette\n            </button>\n            <button\n              type=\"button\"\n              data-ct-add-field\n              class=\"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n              </svg>\n              Add Field\n            </button>\n          </div>\n        </div>\n\n        <div data-ct-palette class=\"${this.paletteVisible ? '' : 'hidden'} border-b border-gray-200 dark:border-gray-700\">\n          <div data-ct-palette-container class=\"h-[300px] overflow-y-auto\"></div>\n        </div>\n\n        <div data-ct-field-list class=\"p-4\">\n          ${this.renderFieldListHTML()}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderFieldListHTML(): string {\n    return this.renderFieldListContent();\n  }\n\n  private renderFieldCard(field: FieldDefinition, index: number, sectionFields?: FieldDefinition[]): string {\n    const isBlocks = normalizeFieldType(field.type) === 'blocks';\n    const isExpanded = isBlocks && this.state.selectedFieldId === field.id;\n\n    // Check for validation errors for this field\n    const fieldErrors = this.state.validationErrors.filter(\n      (err) => err.path.includes(`/${field.name}`) || err.path.includes(`properties.${field.name}`)\n    );\n    const hasErrors = fieldErrors.length > 0;\n\n    // Build constraints summary\n    const constraints: string[] = [];\n    if (field.validation?.minLength !== undefined) constraints.push(`min: ${field.validation.minLength}`);\n    if (field.validation?.maxLength !== undefined) constraints.push(`max: ${field.validation.maxLength}`);\n    if (field.validation?.min !== undefined) constraints.push(`>= ${field.validation.min}`);\n    if (field.validation?.max !== undefined) constraints.push(`<= ${field.validation.max}`);\n    if (field.validation?.pattern) constraints.push('pattern');\n\n    // Determine position in section for reorder buttons\n    const list = sectionFields ?? this.state.fields;\n    const indexInList = list.indexOf(field);\n\n    // Kebab menu with dropdown\n    const menuOpen = this.fieldActionsMenuId === field.id;\n    const actionsHtml = `\n          <div class=\"relative flex-shrink-0\">\n            ${renderFieldKebab(field.id)}\n            ${menuOpen ? this.renderFieldActionsMenu(field) : ''}\n          </div>`;\n\n    return renderFieldCardShared({\n      field,\n      sectionName: field.section || DEFAULT_SECTION,\n      isSelected: this.state.selectedFieldId === field.id,\n      isExpanded,\n      hasErrors,\n      errorMessages: fieldErrors.map(err => err.message),\n      constraintBadges: constraints,\n      index,\n      actionsHtml,\n      showReorderButtons: true,\n      isFirst: indexInList === 0,\n      isLast: indexInList === list.length - 1,\n      compact: false,\n      renderExpandedContent: isBlocks ? () => this.renderBlocksInlineContent(field) : undefined,\n    });\n  }\n\n  private renderFieldActionsMenu(field: FieldDefinition): string {\n    const itemClass = 'w-full text-left px-3 py-1.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2';\n    return `\n      <div data-ct-field-actions-menu class=\"absolute right-0 top-full mt-1 z-30 w-40 bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg py-1 text-sm\">\n        <button type=\"button\" data-field-action-edit=\"${escapeHtml(field.id)}\" class=\"${itemClass}\">\n          <svg class=\"w-3.5 h-3.5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n          </svg>\n          Edit\n        </button>\n        <button type=\"button\" data-field-action-remove=\"${escapeHtml(field.id)}\" class=\"${itemClass} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20\">\n          <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\n          </svg>\n          Remove\n        </button>\n      </div>`;\n  }\n\n  private renderBlocksInlineContent(field: FieldDefinition): string {\n    const config = (field.config ?? {}) as BlocksFieldConfig;\n    const mode = this.getBlocksPickerMode(field.id);\n    const isAllowed = mode === 'allowed';\n    const selectedBlocks = new Set(\n      isAllowed ? (config.allowedBlocks ?? []) : (config.deniedBlocks ?? []),\n    );\n    const toggleBase = 'px-2 py-1 text-[10px] font-semibold uppercase tracking-wider rounded';\n    const allowedClass = isAllowed\n      ? 'bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300'\n      : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800';\n    const deniedClass = !isAllowed\n      ? 'bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-300'\n      : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800';\n    const pickerLabel = isAllowed ? 'Allowed Blocks' : 'Denied Blocks';\n    const pickerAccent = isAllowed ? 'blue' : 'red';\n    const emptySelectionText = isAllowed ? 'All blocks allowed (no restrictions)' : 'No blocks denied';\n\n    let pickerHtml: string;\n    if (this.cachedBlocks) {\n      const normalized = normalizeBlockSelection(selectedBlocks, this.cachedBlocks);\n      pickerHtml = renderInlineBlockPicker({\n        availableBlocks: this.cachedBlocks,\n        selectedBlocks: normalized,\n        onSelectionChange: () => {},\n        label: pickerLabel,\n        accent: pickerAccent,\n        emptySelectionText,\n      });\n    } else {\n      pickerHtml = `\n        <div class=\"flex items-center justify-center py-6\" data-ct-blocks-loading=\"${escapeHtml(field.id)}\">\n          <div class=\"animate-spin w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          <span class=\"ml-2 text-xs text-gray-400 dark:text-gray-500\">Loading blocks...</span>\n        </div>`;\n    }\n\n    return `\n      <div class=\"px-3 pb-3 space-y-3 border-t border-gray-100 dark:border-gray-800 mt-1 pt-3\" data-field-props=\"${escapeHtml(field.id)}\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"inline-flex items-center gap-1 p-0.5 rounded-md border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n            <button type=\"button\" data-ct-blocks-mode-toggle=\"${escapeHtml(field.id)}\" data-ct-blocks-mode=\"allowed\"\n                    class=\"${toggleBase} ${allowedClass}\">\n              Allowed\n            </button>\n            <button type=\"button\" data-ct-blocks-mode-toggle=\"${escapeHtml(field.id)}\" data-ct-blocks-mode=\"denied\"\n                    class=\"${toggleBase} ${deniedClass}\">\n              Denied\n            </button>\n          </div>\n          <button type=\"button\" data-ct-blocks-open-library=\"${escapeHtml(field.id)}\"\n                  class=\"text-[11px] text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium\">\n            Open Block Library\n          </button>\n        </div>\n        <div data-ct-blocks-picker-container=\"${escapeHtml(field.id)}\">\n          ${pickerHtml}\n        </div>\n        <div class=\"flex items-center justify-between\">\n          <button type=\"button\" data-ct-blocks-advanced=\"${escapeHtml(field.id)}\"\n                  class=\"text-[11px] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 font-medium\">\n            Advanced settings...\n          </button>\n        </div>\n      </div>`;\n  }\n\n  private renderCapabilitiesSection(): string {\n    const caps = this.state.contentType?.capabilities ?? {};\n\n    return `\n      <div class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\n        <h2 class=\"text-sm font-medium text-gray-900 dark:text-white mb-4\">Capabilities</h2>\n\n        <div class=\"grid grid-cols-2 gap-4\">\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"versioning\"\n              ${caps.versioning ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Versioning</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"scheduling\"\n              ${caps.scheduling ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Scheduling</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"seo\"\n              ${caps.seo ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">SEO Fields</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"localization\"\n              ${caps.localization ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Localization</span>\n          </label>\n\n          <label class=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              data-ct-cap=\"blocks\"\n              ${caps.blocks ? 'checked' : ''}\n              class=\"w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">Block Editor</span>\n          </label>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderPreviewPanel(): string {\n    return `\n      <div class=\"p-4\">\n        <div class=\"flex items-center justify-between mb-4\">\n          <h2 class=\"text-sm font-medium text-gray-900 dark:text-white\">Form Preview</h2>\n          <button\n            type=\"button\"\n            data-ct-refresh-preview\n            class=\"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n          >\n            Refresh\n          </button>\n        </div>\n\n        <div\n          data-ct-preview-container\n          class=\"bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4 min-h-[200px]\"\n        >\n          ${\n            this.state.previewHtml\n              ? this.state.previewHtml\n              : `\n            <div class=\"flex flex-col items-center justify-center h-40 text-gray-400\">\n              <svg class=\"w-10 h-10 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\n              </svg>\n              <p class=\"text-sm\">Click \"Preview\" to see the generated form</p>\n            </div>\n          `\n          }\n        </div>\n      </div>\n    `;\n  }\n\n  // ===========================================================================\n  // Status Badges & Lifecycle Actions\n  // ===========================================================================\n\n  private renderHeader(): string {\n    const ct = this.state.contentType;\n    return renderEntityHeader({\n      name: ct ? 'Edit Content Type' : 'Create Content Type',\n      subtitle: ct ? `Editing: ${ct.name}` : 'Define fields and configure your content type',\n      status: ct?.status,\n      version: ct?.schema_version,\n      actions: this.renderHeaderActions(),\n    });\n  }\n\n  private renderHeaderActions(): string {\n    const ct = this.state.contentType;\n    const btnClass = 'px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700';\n    return `\n      ${this.state.validationErrors.length > 0 ? `\n        <span class=\"flex items-center gap-1 text-sm text-red-600 dark:text-red-400\">\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n          </svg>\n          ${this.state.validationErrors.length} error${this.state.validationErrors.length > 1 ? 's' : ''}\n        </span>\n      ` : ''}\n      ${ct ? this.renderLifecycleActions(ct) : ''}\n      <button type=\"button\" data-ct-validate class=\"${btnClass}\">Validate</button>\n      <button type=\"button\" data-ct-preview class=\"${btnClass}\">Preview</button>\n      <button type=\"button\" data-ct-cancel class=\"${btnClass}\">Cancel</button>\n      <button type=\"button\" data-ct-save class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\">\n        ${ct ? 'Save Changes' : 'Create Content Type'}\n      </button>\n    `;\n  }\n\n  private renderLifecycleActions(ct: ContentType): string {\n    const status = (ct.status ?? '').toLowerCase();\n    const isDraft = status === '' || status === 'draft';\n    const isActive = status === 'active' || status === 'published';\n    return `\n      <div class=\"relative\" data-ct-lifecycle-menu>\n        <button\n          type=\"button\"\n          data-ct-lifecycle-trigger\n          class=\"flex items-center gap-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z\"></path>\n          </svg>\n          Actions\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n          </svg>\n        </button>\n        <div\n          data-ct-lifecycle-dropdown\n          class=\"hidden absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50\"\n        >\n          <div class=\"py-1\">\n            ${isDraft ? `\n              <button\n                type=\"button\"\n                data-ct-publish\n                class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-green-700 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                </svg>\n                Publish\n              </button>\n            ` : isActive ? `\n              <button\n                type=\"button\"\n                data-ct-deprecate\n                class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-yellow-700 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n                </svg>\n                Deprecate\n              </button>\n            ` : ''}\n            <button\n              type=\"button\"\n              data-ct-clone\n              class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\n              </svg>\n              Clone\n            </button>\n            <div class=\"border-t border-gray-200 dark:border-gray-700 my-1\"></div>\n            <button\n              type=\"button\"\n              data-ct-versions\n              class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n              Version History\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  // ===========================================================================\n  // Lifecycle Actions\n  // ===========================================================================\n\n  /**\n   * Publish the content type\n   */\n  async publishContentType(): Promise<void> {\n    if (!this.state.contentType?.id) return;\n\n    // First check compatibility\n    const schema = this.buildSchemaPayload();\n    let compatResult: CompatibilityCheckResult | null = null;\n    let compatError: string | null = null;\n\n    try {\n      compatResult = await this.api.checkCompatibility(\n        this.state.contentType.id,\n        schema,\n        this.buildUISchema()\n      );\n    } catch (error) {\n      compatError = error instanceof Error ? error.message : 'Compatibility check failed';\n    }\n\n    // Show confirmation modal\n    const modal = new PublishConfirmationModal({\n      contentType: this.state.contentType,\n      compatibilityResult: compatResult,\n      compatibilityError: compatError ?? undefined,\n      onConfirm: async (force: boolean) => {\n        try {\n          const published = await this.api.publish(this.state.contentType!.id, force);\n          this.state.contentType = published;\n          this.state.isDirty = false;\n          this.render();\n          this.bindEvents();\n          this.showToast('Content type published successfully', 'success');\n          this.config.onSave?.(published);\n        } catch (error) {\n          const message = error instanceof Error ? error.message : 'Failed to publish content type';\n          this.showToast(message, 'error');\n        }\n      },\n      onCancel: () => {},\n    });\n    modal.show();\n  }\n\n  /**\n   * Deprecate the content type\n   */\n  async deprecateContentType(): Promise<void> {\n    if (!this.state.contentType?.id) return;\n\n    const confirmed = await ConfirmModal.confirm(\n      `Are you sure you want to deprecate \"${this.state.contentType.name}\"? Deprecated content types can still be used but are hidden from new content creation.`,\n      { title: 'Deprecate Content Type', confirmText: 'Deprecate', confirmVariant: 'danger' },\n    );\n    if (!confirmed) return;\n\n    try {\n      const deprecated = await this.api.deprecate(this.state.contentType.id);\n      this.state.contentType = deprecated;\n      this.render();\n      this.bindEvents();\n      this.showToast('Content type deprecated successfully', 'success');\n      this.config.onSave?.(deprecated);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Failed to deprecate content type';\n      this.showToast(message, 'error');\n    }\n  }\n\n  /**\n   * Clone the content type\n   */\n  async cloneContentType(): Promise<void> {\n    if (!this.state.contentType?.id) return;\n\n    const modal = new CloneContentTypeModal({\n      contentType: this.state.contentType,\n      onConfirm: async (newSlug: string, newName?: string) => {\n        try {\n          const cloned = await this.api.clone(this.state.contentType!.id, newSlug, newName);\n          this.showToast(`Content type cloned as \"${cloned.name}\"`, 'success');\n          // Optionally navigate to the cloned content type\n          if (this.config.onSave) {\n            this.config.onSave(cloned);\n          }\n        } catch (error) {\n          const message = error instanceof Error ? error.message : 'Failed to clone content type';\n          this.showToast(message, 'error');\n        }\n      },\n      onCancel: () => {},\n    });\n    modal.show();\n  }\n\n  /**\n   * Show version history\n   */\n  showVersionHistory(): void {\n    if (!this.state.contentType?.id) return;\n\n    const viewer = new ContentTypeVersionHistoryViewer({\n      apiBasePath: this.config.apiBasePath,\n      contentType: this.state.contentType,\n    });\n    viewer.show();\n  }\n\n  // ===========================================================================\n  // Event Binding\n  // ===========================================================================\n\n  private bindEvents(): void {\n    if (!this.staticEventsBound) {\n      this.bindStaticEvents();\n      this.staticEventsBound = true;\n    }\n    this.bindDynamicEvents();\n  }\n\n  private bindStaticEvents(): void {\n    // Field actions (delegated)\n    this.container.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n\n      // Kebab menu trigger — toggle dropdown\n      const actionsBtn = target.closest<HTMLElement>('[data-field-actions]');\n      if (actionsBtn) {\n        e.stopPropagation();\n        const fieldId = actionsBtn.dataset.fieldActions!;\n        this.fieldActionsMenuId = this.fieldActionsMenuId === fieldId ? null : fieldId;\n        this.renderFieldList();\n        return;\n      }\n\n      // Kebab dropdown: Edit\n      const editAction = target.closest<HTMLElement>('[data-field-action-edit]');\n      if (editAction) {\n        const fieldId = editAction.dataset.fieldActionEdit!;\n        this.fieldActionsMenuId = null;\n        this.editField(fieldId);\n        return;\n      }\n\n      // Kebab dropdown: Remove\n      const removeAction = target.closest<HTMLElement>('[data-field-action-remove]');\n      if (removeAction) {\n        const fieldId = removeAction.dataset.fieldActionRemove!;\n        this.fieldActionsMenuId = null;\n        this.removeField(fieldId);\n        return;\n      }\n\n      // Reorder: Move up\n      const moveUpBtn = target.closest<HTMLElement>('[data-field-move-up]');\n      if (moveUpBtn && !moveUpBtn.hasAttribute('disabled')) {\n        e.stopPropagation();\n        const fieldId = moveUpBtn.dataset.fieldMoveUp!;\n        this.moveFieldByDirection(fieldId, -1);\n        return;\n      }\n\n      // Reorder: Move down\n      const moveDownBtn = target.closest<HTMLElement>('[data-field-move-down]');\n      if (moveDownBtn && !moveDownBtn.hasAttribute('disabled')) {\n        e.stopPropagation();\n        const fieldId = moveDownBtn.dataset.fieldMoveDown!;\n        this.moveFieldByDirection(fieldId, 1);\n        return;\n      }\n\n      // Blocks picker mode toggle (allowed/denied)\n      const blocksMode = target.closest<HTMLElement>('[data-ct-blocks-mode-toggle]');\n      if (blocksMode) {\n        const fieldId = blocksMode.dataset.ctBlocksModeToggle!;\n        const mode = (blocksMode.dataset.ctBlocksMode as 'allowed' | 'denied') ?? 'allowed';\n        this.blockPickerModes.set(fieldId, mode);\n        this.renderFieldList();\n        const field = this.state.fields.find((f) => f.id === fieldId);\n        if (field && normalizeFieldType(field.type) === 'blocks') {\n          this.loadBlocksForField(field);\n        }\n        return;\n      }\n\n      // Open Block Library\n      const blocksOpenLibrary = target.closest<HTMLElement>('[data-ct-blocks-open-library]');\n      if (blocksOpenLibrary) {\n        const basePath = this.api.getBasePath();\n        window.location.href = `${basePath}/content/block-library`;\n        return;\n      }\n\n      // Advanced settings modal\n      const blocksAdvanced = target.closest<HTMLElement>('[data-ct-blocks-advanced]');\n      if (blocksAdvanced) {\n        const fieldId = blocksAdvanced.dataset.ctBlocksAdvanced!;\n        if (fieldId) this.editField(fieldId);\n        return;\n      }\n\n      // Retry loading blocks for field\n      const blocksRetry = target.closest<HTMLElement>('[data-ct-blocks-retry]');\n      if (blocksRetry) {\n        const fieldId = blocksRetry.dataset.ctBlocksRetry!;\n        const field = this.state.fields.find((f) => f.id === fieldId);\n        if (field) {\n          this.cachedBlocks = null;\n          this.loadBlocksForField(field);\n        }\n        return;\n      }\n\n      // Field toggle (expand/collapse for inline blocks)\n      const fieldToggle = target.closest<HTMLElement>('[data-field-toggle]');\n      if (fieldToggle && !target.closest('button')) {\n        const fieldId = fieldToggle.dataset.fieldToggle!;\n        this.state.selectedFieldId = this.state.selectedFieldId === fieldId ? null : fieldId;\n        this.renderFieldList();\n        if (this.state.selectedFieldId) {\n          const field = this.state.fields.find((f) => f.id === this.state.selectedFieldId);\n          if (field && normalizeFieldType(field.type) === 'blocks') {\n            this.loadBlocksForField(field);\n          }\n        }\n        return;\n      }\n\n      // Select field card\n      const fieldCard = target.closest('[data-field-card]');\n      if (fieldCard && !target.closest('button') && !target.closest('[data-field-props]')) {\n        const fieldId = fieldCard.getAttribute('data-field-card');\n        if (fieldId) {\n          this.state.selectedFieldId = this.state.selectedFieldId === fieldId ? null : fieldId;\n          this.renderFieldList();\n        }\n      }\n\n      // Close kebab menu on any click that didn't match a menu action\n      if (this.fieldActionsMenuId && !target.closest('[data-field-actions]') && !target.closest('[data-ct-field-actions-menu]')) {\n        this.fieldActionsMenuId = null;\n        this.renderFieldList();\n      }\n    });\n\n    // Mark dirty on input changes + auto-slug\n    this.container.addEventListener('input', (e) => {\n      const target = e.target as HTMLElement;\n      if (\n        target.matches('[data-ct-name], [data-ct-slug], [data-ct-description], [data-ct-icon]') ||\n        target.matches('[data-ct-cap]')\n      ) {\n        this.state.isDirty = true;\n        this.updateDirtyState();\n      }\n\n      if (target.matches('[data-ct-name]')) {\n        const nameInput = target as HTMLInputElement;\n        const slugInput = this.container.querySelector<HTMLInputElement>('[data-ct-slug]');\n        if (slugInput && !slugInput.dataset.userModified && !this.state.contentType?.slug) {\n          slugInput.value = nameToSlug(nameInput.value);\n        }\n        this.schedulePreview();\n        return;\n      }\n\n      if (target.matches('[data-ct-slug]')) {\n        const slugInput = target as HTMLInputElement;\n        slugInput.dataset.userModified = 'true';\n        this.schedulePreview();\n        return;\n      }\n    });\n  }\n\n  private bindDynamicEvents(): void {\n    // Header actions\n    this.container.querySelector('[data-ct-save]')?.addEventListener('click', () => this.save());\n    this.container.querySelector('[data-ct-validate]')?.addEventListener('click', () => this.validateSchema());\n    this.container.querySelector('[data-ct-preview]')?.addEventListener('click', () => this.previewSchema());\n    this.container.querySelector('[data-ct-cancel]')?.addEventListener('click', () => this.config.onCancel?.());\n\n    // Lifecycle actions dropdown\n    this.bindLifecycleMenuEvents();\n\n    // Add field buttons\n    this.container.querySelector('[data-ct-add-field]')?.addEventListener('click', () => this.showFieldTypePicker());\n    this.container.querySelector('[data-ct-add-field-empty]')?.addEventListener('click', () =>\n      this.showFieldTypePicker()\n    );\n\n    // Palette toggle\n    this.container.querySelector('[data-ct-toggle-palette]')?.addEventListener('click', () => this.togglePalette());\n\n    // Initialize palette if visible\n    this.initPaletteIfNeeded();\n\n    // Layout button\n    this.container.querySelector('[data-ct-layout]')?.addEventListener('click', () => this.showLayoutEditor());\n\n    // Preview refresh\n    this.container.querySelector('[data-ct-refresh-preview]')?.addEventListener('click', () => this.previewSchema());\n\n    // Icon picker trigger\n    bindIconTriggerEvents(this.container, '[data-icon-trigger]', (trigger) => {\n      const hiddenInput = trigger.querySelector<HTMLInputElement>('[data-ct-icon]');\n      return {\n        value: hiddenInput?.value ?? '',\n        onSelect: (v: string) => {\n          if (hiddenInput) {\n            hiddenInput.value = v;\n            this.state.isDirty = true;\n            this.updateDirtyState();\n          }\n        },\n        onClear: () => {\n          if (hiddenInput) {\n            hiddenInput.value = '';\n            this.state.isDirty = true;\n            this.updateDirtyState();\n          }\n        },\n      };\n    });\n\n    // Section toggles\n    this.bindSectionToggleEvents();\n\n    // Drag and drop\n    this.bindDragEvents();\n  }\n\n  private removeDropIndicator(): void {\n    if (this.dropIndicator && this.dropIndicator.parentNode) {\n      this.dropIndicator.parentNode.removeChild(this.dropIndicator);\n    }\n    this.dropIndicator = null;\n  }\n\n  private getOrCreateDropIndicator(): HTMLElement {\n    if (!this.dropIndicator) {\n      this.dropIndicator = document.createElement('div');\n      this.dropIndicator.className =\n        'drop-indicator h-0.5 bg-blue-500 rounded-full my-1 pointer-events-none';\n    }\n    return this.dropIndicator;\n  }\n\n  private bindDragEvents(): void {\n    const fieldList = this.container.querySelector('[data-ct-field-list]');\n    if (!fieldList) return;\n\n    // Drag start\n    fieldList.addEventListener('dragstart', (evt) => {\n      const e = evt as DragEvent;\n      const target = e.target as HTMLElement;\n      const card = target.closest<HTMLElement>('[data-field-card]');\n      if (!card) return;\n\n      const fieldId = card.getAttribute('data-field-card');\n      const index = parseInt(card.getAttribute('data-field-index') ?? '0', 10);\n      const sectionName = card.getAttribute('data-field-section') ?? DEFAULT_SECTION;\n\n      this.dragState = {\n        fieldId: fieldId ?? '',\n        startSection: sectionName,\n        currentSection: sectionName,\n        startIndex: index,\n        currentIndex: index,\n      };\n\n      card.classList.add('opacity-50');\n      e.dataTransfer?.setData('text/plain', fieldId ?? '');\n      if (e.dataTransfer) e.dataTransfer.effectAllowed = 'move';\n    });\n\n    // Drag enter — mark container as valid drop zone\n    fieldList.addEventListener('dragenter', (evt) => {\n      evt.preventDefault();\n    });\n\n    // Drag over — throttled via rAF, reuses cached indicator\n    fieldList.addEventListener('dragover', (evt) => {\n      evt.preventDefault();\n      const e = evt as DragEvent;\n      if (!this.dragState) return;\n\n      const clientY = e.clientY;\n      const target = e.target as HTMLElement;\n\n      if (this.dragOverRAF) return;\n      this.dragOverRAF = requestAnimationFrame(() => {\n        this.dragOverRAF = null;\n        if (!this.dragState) return;\n\n        const card = target.closest<HTMLElement>('[data-field-card]');\n        if (!card || card.getAttribute('data-field-card') === this.dragState.fieldId) return;\n\n        const rect = card.getBoundingClientRect();\n        const midY = rect.top + rect.height / 2;\n        const insertBefore = clientY < midY;\n\n        // Reuse cached indicator — just move it in the DOM\n        const indicator = this.getOrCreateDropIndicator();\n        const anchor = insertBefore ? card : card.nextSibling;\n        if (indicator.nextSibling !== anchor || indicator.parentNode !== card.parentElement) {\n          card.parentElement?.insertBefore(indicator, anchor);\n        }\n\n        // Update current index\n        const targetIndex = parseInt(card.getAttribute('data-field-index') ?? '0', 10);\n        const targetSection = card.getAttribute('data-field-section') ?? DEFAULT_SECTION;\n        this.dragState.currentSection = targetSection;\n        this.dragState.currentIndex = insertBefore ? targetIndex : targetIndex + 1;\n      });\n    });\n\n    // Drag leave — only remove indicator when cursor truly leaves the field list\n    fieldList.addEventListener('dragleave', (evt) => {\n      const e = evt as DragEvent;\n      const related = e.relatedTarget as Node | null;\n      if (!related || !fieldList.contains(related)) {\n        this.removeDropIndicator();\n      }\n    });\n\n    // Drop\n    fieldList.addEventListener('drop', (e) => {\n      e.preventDefault();\n      this.removeDropIndicator();\n\n      if (!this.dragState) return;\n\n      const { fieldId, startIndex, currentIndex, startSection, currentSection } = this.dragState;\n      if (startIndex !== currentIndex || startSection !== currentSection) {\n        this.moveField(fieldId, currentSection, currentIndex);\n      }\n\n      this.dragState = null;\n    });\n\n    // Drag end\n    fieldList.addEventListener('dragend', () => {\n      fieldList.querySelectorAll('.opacity-50').forEach((el) => el.classList.remove('opacity-50'));\n      this.removeDropIndicator();\n      if (this.dragOverRAF) {\n        cancelAnimationFrame(this.dragOverRAF);\n        this.dragOverRAF = null;\n      }\n      this.dragState = null;\n    });\n  }\n\n  /** Bind drag-and-drop events on [data-field-drop-zone] for palette drops */\n  private bindFieldDropZoneEvents(root: HTMLElement): void {\n    const dropZones = root.querySelectorAll<HTMLElement>('[data-field-drop-zone]');\n    dropZones.forEach((zone) => {\n      zone.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        e.dataTransfer!.dropEffect = 'copy';\n        zone.classList.remove('border-gray-200', 'hover:border-gray-300', 'border-transparent');\n        zone.classList.add('border-blue-400', 'bg-blue-50/50');\n      });\n\n      zone.addEventListener('dragleave', (e) => {\n        if (!zone.contains(e.relatedTarget as Node)) {\n          zone.classList.remove('border-blue-400', 'bg-blue-50/50');\n          zone.classList.add('border-gray-200', 'hover:border-gray-300');\n        }\n      });\n\n      zone.addEventListener('drop', (e) => {\n        e.preventDefault();\n        zone.classList.remove('border-blue-400', 'bg-blue-50/50');\n        zone.classList.add('border-gray-200', 'hover:border-gray-300');\n\n        // Try full metadata first\n        const metaRaw = e.dataTransfer?.getData(PALETTE_DRAG_META_MIME);\n        if (metaRaw) {\n          try {\n            const parsed = JSON.parse(metaRaw);\n            if (parsed?.type) {\n              this.addField(parsed.type as FieldType);\n              return;\n            }\n          } catch { /* fall through */ }\n        }\n        // Fall back to type-only\n        const fieldType = e.dataTransfer?.getData(PALETTE_DRAG_MIME);\n        if (fieldType) {\n          this.addField(fieldType as FieldType);\n        }\n      });\n    });\n  }\n\n  private bindLifecycleMenuEvents(): void {\n    const menuContainer = this.container.querySelector('[data-ct-lifecycle-menu]');\n    if (!menuContainer) {\n      if (this.lifecycleOutsideClickHandler) {\n        document.removeEventListener('click', this.lifecycleOutsideClickHandler);\n        this.lifecycleOutsideClickHandler = null;\n      }\n      return;\n    }\n\n    const trigger = menuContainer.querySelector('[data-ct-lifecycle-trigger]');\n    const dropdown = menuContainer.querySelector('[data-ct-lifecycle-dropdown]');\n\n    if (trigger && dropdown) {\n      // Toggle dropdown on click\n      trigger.addEventListener('click', (e) => {\n        e.stopPropagation();\n        dropdown.classList.toggle('hidden');\n      });\n\n      // Close dropdown when clicking outside\n      if (this.lifecycleOutsideClickHandler) {\n        document.removeEventListener('click', this.lifecycleOutsideClickHandler);\n      }\n      this.lifecycleOutsideClickHandler = (e) => {\n        if (!menuContainer.contains(e.target as Node)) {\n          dropdown.classList.add('hidden');\n        }\n      };\n      document.addEventListener('click', this.lifecycleOutsideClickHandler);\n    }\n\n    // Lifecycle action buttons\n    this.container.querySelector('[data-ct-publish]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.publishContentType();\n    });\n\n    this.container.querySelector('[data-ct-deprecate]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.deprecateContentType();\n    });\n\n    this.container.querySelector('[data-ct-clone]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.cloneContentType();\n    });\n\n    this.container.querySelector('[data-ct-versions]')?.addEventListener('click', () => {\n      dropdown?.classList.add('hidden');\n      this.showVersionHistory();\n    });\n  }\n\n  private togglePalette(): void {\n    this.paletteVisible = !this.paletteVisible;\n    const wrapper = this.container.querySelector<HTMLElement>('[data-ct-palette]');\n    if (wrapper) {\n      wrapper.classList.toggle('hidden', !this.paletteVisible);\n    }\n    const btn = this.container.querySelector<HTMLElement>('[data-ct-toggle-palette]');\n    if (btn) {\n      btn.setAttribute('aria-expanded', String(this.paletteVisible));\n    }\n    this.initPaletteIfNeeded();\n  }\n\n  private initPaletteIfNeeded(): void {\n    if (!this.paletteVisible || this.palettePanel) return;\n    const el = this.container.querySelector<HTMLElement>('[data-ct-palette-container]');\n    if (!el) return;\n    this.palettePanel = new FieldPalettePanel({\n      container: el,\n      api: this.api,\n      onAddField: (meta) => this.addField(meta.type as FieldType),\n    });\n    this.palettePanel.init();\n    this.palettePanel.enable();\n  }\n\n  private showFieldTypePicker(): void {\n    const picker = new FieldTypePicker({\n      onSelect: (type) => this.addField(type),\n      onCancel: () => {},\n    });\n    picker.show();\n  }\n\n  private showLayoutEditor(): void {\n    const editor = new LayoutEditor({\n      layout: this.state.layout,\n      fields: this.state.fields,\n      onSave: (layout) => {\n        this.state.layout = layout;\n        this.state.isDirty = true;\n        this.renderFieldList();\n        this.updateDirtyState();\n        this.schedulePreview();\n        // Re-render fields section to update layout badge\n        const fieldsSection = this.container.querySelector('[data-ct-field-list]')?.closest('.rounded-lg');\n        if (fieldsSection) {\n          const newFieldsSection = document.createElement('div');\n          newFieldsSection.innerHTML = this.renderFieldsSection();\n          fieldsSection.replaceWith(newFieldsSection.firstElementChild!);\n          this.bindFieldsEvents();\n        }\n      },\n      onCancel: () => {},\n    });\n    editor.show();\n  }\n\n  private bindFieldsEvents(): void {\n    // Re-bind field section events after re-render\n    this.container.querySelector('[data-ct-add-field]')?.addEventListener('click', () => this.showFieldTypePicker());\n    this.container.querySelector('[data-ct-add-field-empty]')?.addEventListener('click', () => this.showFieldTypePicker());\n    this.container.querySelector('[data-ct-layout]')?.addEventListener('click', () => this.showLayoutEditor());\n    this.container.querySelector('[data-ct-toggle-palette]')?.addEventListener('click', () => this.togglePalette());\n    this.palettePanel = null;\n    this.initPaletteIfNeeded();\n    this.bindSectionToggleEvents();\n    this.bindDragEvents();\n  }\n\n  private bindSectionToggleEvents(): void {\n    this.container.querySelectorAll<HTMLElement>('[data-ct-toggle-section]').forEach((btn) => {\n      const sectionName = btn.getAttribute('data-ct-toggle-section');\n      if (sectionName) {\n        btn.addEventListener('click', () => this.toggleSection(sectionName));\n      }\n    });\n  }\n\n  // ===========================================================================\n  // Helpers\n  // ===========================================================================\n\n  private getSlug(): string {\n    const slugInput = this.container.querySelector<HTMLInputElement>('[data-ct-slug]');\n    const nameInput = this.container.querySelector<HTMLInputElement>('[data-ct-name]');\n    const slug = slugInput?.value?.trim();\n    if (slug) return slug;\n    return nameToSlug(nameInput?.value ?? '');\n  }\n\n  private getDescription(): string | undefined {\n    const input = this.container.querySelector<HTMLTextAreaElement>('[data-ct-description]');\n    if (!input) return undefined;\n    return input.value.trim();\n  }\n\n  private getIcon(): string | undefined {\n    const input = this.container.querySelector<HTMLInputElement>('[data-ct-icon]');\n    if (!input) return undefined;\n    return input.value.trim();\n  }\n\n  private getCapabilities(): ContentTypeCapabilities {\n    const existing = this.state.contentType?.capabilities;\n    const caps: ContentTypeCapabilities =\n      existing && typeof existing === 'object' ? { ...existing } : {};\n\n    this.container.querySelectorAll<HTMLInputElement>('[data-ct-cap]').forEach((input) => {\n      const key = input.getAttribute('data-ct-cap');\n      if (key) {\n        caps[key] = input.checked;\n      }\n    });\n    return caps;\n  }\n\n  private buildUISchema(): UISchemaOverlay | undefined {\n    const uiSchema: UISchemaOverlay = {};\n\n    // Build layout from state\n    const layout: UILayoutConfig = {\n      type: this.state.layout.type ?? 'flat',\n      gridColumns: this.state.layout.gridColumns ?? 12,\n    };\n\n    // Include tabs if using tabs or sections layout\n    if (layout.type === 'tabs' || layout.type === 'sections') {\n      // Merge explicit tabs with field sections\n      const tabsById = new Map<string, { id: string; label: string; order: number; icon?: string }>();\n\n      // Add explicit tabs from layout\n      (this.state.layout.tabs ?? []).forEach((tab, i) => {\n        tabsById.set(tab.id, {\n          id: tab.id,\n          label: tab.label,\n          order: tab.order ?? i,\n          icon: tab.icon,\n        });\n      });\n\n      // Add implicit tabs from field sections\n      this.state.fields.forEach((field) => {\n        if (field.section && !tabsById.has(field.section)) {\n          tabsById.set(field.section, {\n            id: field.section,\n            label: titleCase(field.section),\n            order: tabsById.size,\n          });\n        }\n      });\n\n      if (tabsById.size > 0) {\n        layout.tabs = Array.from(tabsById.values()).sort((a, b) => a.order - b.order);\n      }\n    }\n\n    uiSchema.layout = layout;\n\n    // Build field overrides\n    const overrides: UIOverride[] = [];\n    this.state.fields.forEach((field) => {\n      const override: UIOverride = { path: `#/properties/${field.name}` };\n      const formgen: Record<string, unknown> = {};\n\n      // Add formgen properties that aren't in the schema\n      if (field.section) formgen.section = field.section;\n      if (field.gridSpan) formgen.grid = { span: field.gridSpan };\n      if (field.order !== undefined) formgen.order = field.order;\n      if (field.readonly) formgen.readonly = true;\n      if (field.hidden) formgen.hidden = true;\n\n      if (Object.keys(formgen).length > 0) {\n        override['x-formgen'] = formgen;\n        overrides.push(override);\n      }\n    });\n\n    if (overrides.length > 0) {\n      uiSchema.overrides = overrides;\n    }\n\n    // Only return if there's meaningful content\n    if (\n      (layout.type === 'flat' && !layout.tabs?.length && overrides.length === 0) ||\n      (!uiSchema.layout && !uiSchema.overrides)\n    ) {\n      return undefined;\n    }\n\n    return uiSchema;\n  }\n\n  private updateLoadingState(): void {\n    const saveBtn = this.container.querySelector<HTMLButtonElement>('[data-ct-save]');\n    if (saveBtn) {\n      saveBtn.disabled = this.state.isLoading;\n    }\n  }\n\n  private updateSavingState(): void {\n    const saveBtn = this.container.querySelector<HTMLButtonElement>('[data-ct-save]');\n    if (saveBtn) {\n      saveBtn.disabled = this.state.isSaving;\n      saveBtn.textContent = this.state.isSaving ? 'Saving...' : this.state.contentType ? 'Save Changes' : 'Create Content Type';\n    }\n  }\n\n  private updatePreviewState(): void {\n    const previewBtn = this.container.querySelector<HTMLButtonElement>('[data-ct-preview]');\n    if (previewBtn) {\n      previewBtn.disabled = this.state.isPreviewing;\n      previewBtn.textContent = this.state.isPreviewing ? 'Loading...' : 'Preview';\n    }\n  }\n\n  private updateDirtyState(): void {\n    // Dirty dot on Save button\n    const saveBtn = this.container.querySelector<HTMLButtonElement>('[data-ct-save]');\n    if (saveBtn) {\n      let dot = saveBtn.querySelector('[data-dirty-dot]');\n      if (this.state.isDirty) {\n        if (!dot) {\n          dot = document.createElement('span');\n          dot.setAttribute('data-dirty-dot', '');\n          dot.className = 'inline-block w-2 h-2 rounded-full bg-orange-400 ml-1.5 align-middle';\n          dot.setAttribute('title', 'Unsaved changes');\n          saveBtn.appendChild(dot);\n        }\n      } else {\n        dot?.remove();\n      }\n    }\n\n    // \"Unsaved changes\" badge in header\n    const headerEl = this.container.querySelector('[data-content-type-editor] h1');\n    if (headerEl) {\n      let badge = headerEl.parentElement?.querySelector('[data-dirty-badge]');\n      if (this.state.isDirty) {\n        if (!badge) {\n          badge = document.createElement('span');\n          badge.setAttribute('data-dirty-badge', '');\n          badge.className = 'px-2 py-0.5 text-xs font-medium rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400';\n          badge.textContent = 'Modified';\n          headerEl.parentElement?.appendChild(badge);\n        }\n      } else {\n        badge?.remove();\n      }\n    }\n  }\n\n  private renderFieldList(): void {\n    const fieldListContainer = this.container.querySelector('[data-ct-field-list]');\n    if (fieldListContainer) {\n      fieldListContainer.innerHTML = this.renderFieldListContent();\n      this.bindSectionToggleEvents();\n      this.bindDragEvents();\n      this.bindFieldDropZoneEvents(fieldListContainer as HTMLElement);\n      const selected = this.state.fields.find((f) => f.id === this.state.selectedFieldId);\n      if (selected && normalizeFieldType(selected.type) === 'blocks' && this.cachedBlocks) {\n        this.renderInlineBlockPickerForField(selected);\n      }\n    }\n  }\n\n  private renderFieldListContent(): string {\n    if (this.state.fields.length === 0) {\n      return `\n        <div class=\"flex flex-col items-center justify-center py-12 text-gray-400\">\n          <svg class=\"w-12 h-12 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"></path>\n          </svg>\n          <p class=\"text-sm mb-3\">No fields yet</p>\n          <button\n            type=\"button\"\n            data-ct-add-field-empty\n            class=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n          >\n            + Add your first field\n          </button>\n        </div>\n      `;\n    }\n\n    const sections = this.groupFieldsBySection();\n    const sectionNames = Array.from(sections.keys());\n\n    // Single section — render flat (no section headers)\n    if (sectionNames.length <= 1) {\n      const allFields = this.state.fields;\n      return `\n        <div class=\"space-y-2\">\n          ${allFields.map((field, index) => this.renderFieldCard(field, index, allFields)).join('')}\n        </div>\n        ${renderDropZone({ highlight: false })}\n      `;\n    }\n\n    // Multiple sections — render grouped with collapsible headers\n    let html = '';\n\n    for (const sectionName of sectionNames) {\n      const fields = sections.get(sectionName)!;\n      const state = this.getSectionState(sectionName);\n      const isCollapsed = state.collapsed;\n\n      html += `\n        <div data-ct-section=\"${escapeHtml(sectionName)}\" class=\"border-b border-gray-100 dark:border-gray-800 last:border-b-0\">\n          <button type=\"button\" data-ct-toggle-section=\"${escapeHtml(sectionName)}\"\n                  class=\"w-full flex items-center gap-2 px-3 py-2.5 text-left hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors group\">\n            <span class=\"w-4 h-4 text-gray-400 dark:text-gray-500 flex items-center justify-center\">\n              ${isCollapsed\n                ? '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n                : '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>'\n              }\n            </span>\n            <span class=\"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">${escapeHtml(titleCase(sectionName))}</span>\n            <span class=\"text-[10px] text-gray-400 dark:text-gray-500 ml-auto\">${fields.length}</span>\n          </button>\n\n          <div class=\"${isCollapsed ? 'hidden' : ''}\" data-ct-section-body=\"${escapeHtml(sectionName)}\">\n            <div class=\"space-y-2 px-1 pb-2\">\n              ${fields.map((field, index) => this.renderFieldCard(field, index, fields)).join('')}\n            </div>\n          </div>\n        </div>`;\n    }\n\n    html += renderDropZone({ highlight: false });\n\n    return html;\n  }\n\n  // ===========================================================================\n  // Section Grouping\n  // ===========================================================================\n\n  private groupFieldsBySection(): Map<string, FieldDefinition[]> {\n    const map = new Map<string, FieldDefinition[]>();\n    for (const field of this.state.fields) {\n      const section = field.section || DEFAULT_SECTION;\n      if (!map.has(section)) map.set(section, []);\n      map.get(section)!.push(field);\n    }\n    // Ensure default section is always first\n    if (map.has(DEFAULT_SECTION)) {\n      const mainFields = map.get(DEFAULT_SECTION)!;\n      map.delete(DEFAULT_SECTION);\n      const ordered = new Map<string, FieldDefinition[]>();\n      ordered.set(DEFAULT_SECTION, mainFields);\n      for (const [k, v] of map) ordered.set(k, v);\n      return ordered;\n    }\n    return map;\n  }\n\n  private getSectionState(sectionName: string): { collapsed: boolean } {\n    if (!this.sectionStates.has(sectionName)) {\n      this.sectionStates.set(sectionName, { collapsed: false });\n    }\n    return this.sectionStates.get(sectionName)!;\n  }\n\n  private toggleSection(sectionName: string): void {\n    const state = this.getSectionState(sectionName);\n    state.collapsed = !state.collapsed;\n    const body = this.container.querySelector<HTMLElement>(`[data-ct-section-body=\"${sectionName}\"]`);\n    if (body) {\n      body.classList.toggle('hidden', state.collapsed);\n    }\n    const btn = this.container.querySelector<HTMLElement>(`[data-ct-toggle-section=\"${sectionName}\"]`);\n    const chevron = btn?.querySelector('span:first-child');\n    if (chevron) {\n      chevron.innerHTML = state.collapsed\n        ? '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n        : '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>';\n    }\n  }\n\n  private getBlocksPickerMode(fieldId: string): 'allowed' | 'denied' {\n    return this.blockPickerModes.get(fieldId) ?? 'allowed';\n  }\n\n  private async loadBlocksForField(field: FieldDefinition): Promise<void> {\n    if (this.cachedBlocks) {\n      this.renderInlineBlockPickerForField(field);\n      return;\n    }\n    if (this.blocksLoading) return;\n    this.blocksLoading = true;\n    try {\n      this.cachedBlocks = await loadAvailableBlocks(this.api);\n      if (this.state.selectedFieldId === field.id) {\n        this.renderInlineBlockPickerForField(field);\n      }\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Failed to load block definitions';\n      this.renderInlineBlockPickerError(field.id, message);\n      this.showToast(`Failed to load block definitions: ${message}`, 'error');\n    } finally {\n      this.blocksLoading = false;\n    }\n  }\n\n  private renderInlineBlockPickerError(fieldID: string, message: string): void {\n    const container = this.container.querySelector<HTMLElement>(\n      `[data-ct-blocks-picker-container=\"${fieldID}\"]`\n    );\n    if (!container) return;\n    container.innerHTML = `\n      <div class=\"rounded-md border border-red-200 bg-red-50 px-3 py-3 dark:border-red-800/70 dark:bg-red-900/20\">\n        <div class=\"flex items-start gap-2\">\n          <svg class=\"mt-0.5 h-4 w-4 flex-shrink-0 text-red-500 dark:text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n          </svg>\n          <p class=\"text-xs text-red-700 dark:text-red-300\">${escapeHtml(message)}</p>\n        </div>\n        <button type=\"button\" data-ct-blocks-retry=\"${escapeHtml(fieldID)}\"\n                class=\"mt-2 ml-6 text-xs font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\">\n          Retry\n        </button>\n      </div>\n    `;\n  }\n\n  private renderInlineBlockPickerForField(field: FieldDefinition): void {\n    const container = this.container.querySelector<HTMLElement>(\n      `[data-ct-blocks-picker-container=\"${field.id}\"]`\n    );\n    if (!container || !this.cachedBlocks) return;\n\n    const config = (field.config ?? {}) as BlocksFieldConfig;\n    const mode = this.getBlocksPickerMode(field.id);\n    const isAllowed = mode === 'allowed';\n    const selected = normalizeBlockSelection(\n      new Set(isAllowed ? (config.allowedBlocks ?? []) : (config.deniedBlocks ?? [])),\n      this.cachedBlocks,\n    );\n    const pickerLabel = isAllowed ? 'Allowed Blocks' : 'Denied Blocks';\n    const pickerAccent = isAllowed ? 'blue' : 'red';\n    const emptySelectionText = isAllowed ? 'All blocks allowed (no restrictions)' : 'No blocks denied';\n\n    container.innerHTML = renderInlineBlockPicker({\n      availableBlocks: this.cachedBlocks,\n      selectedBlocks: selected,\n      onSelectionChange: (sel) => this.applyBlockSelection(field, mode, sel),\n      label: pickerLabel,\n      accent: pickerAccent,\n      emptySelectionText,\n    });\n\n    bindInlineBlockPickerEvents(container, {\n      availableBlocks: this.cachedBlocks,\n      selectedBlocks: selected,\n      onSelectionChange: (sel) => this.applyBlockSelection(field, mode, sel),\n      label: pickerLabel,\n      accent: pickerAccent,\n      emptySelectionText,\n    });\n  }\n\n  private applyBlockSelection(\n    field: FieldDefinition,\n    mode: 'allowed' | 'denied',\n    selected: Set<string>,\n  ): void {\n    if (!field.config) field.config = {};\n    const cfgRec = field.config as Record<string, unknown>;\n    if (mode === 'allowed') {\n      if (selected.size > 0) {\n        cfgRec.allowedBlocks = Array.from(selected);\n      } else {\n        delete cfgRec.allowedBlocks;\n      }\n    } else {\n      if (selected.size > 0) {\n        cfgRec.deniedBlocks = Array.from(selected);\n      } else {\n        delete cfgRec.deniedBlocks;\n      }\n    }\n    if (Object.keys(field.config).length === 0) field.config = undefined;\n    this.state.isDirty = true;\n    this.updateDirtyState();\n    this.schedulePreview();\n  }\n\n  private renderPreview(): void {\n    const previewContainer = this.container.querySelector('[data-ct-preview-container]');\n    if (!previewContainer) return;\n\n    if (this.state.previewError) {\n      previewContainer.innerHTML = `\n        <div class=\"flex flex-col items-center justify-center h-40 text-red-400\">\n          <svg class=\"w-10 h-10 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n          </svg>\n          <p class=\"text-sm font-medium\">Preview failed</p>\n          <p class=\"text-xs text-red-300 mt-1 max-w-xs text-center\">${this.state.previewError}</p>\n        </div>\n      `;\n    } else if (this.state.previewHtml) {\n      previewContainer.innerHTML = this.state.previewHtml;\n      this.initPreviewEditors();\n    }\n  }\n\n  /**\n   * Initialize preview field enhancements that require client-side behavior.\n   * formgen-behaviors provides JSON editor hydration and\n   * formgen-relationships provides WYSIWYG hydration.\n   */\n  private initPreviewEditors(): void {\n    const fb = (window as any).FormgenBehaviors;\n    if (typeof fb?.initJSONEditors === 'function') {\n      fb.initJSONEditors();\n    }\n\n    const rel = (window as any).FormgenRelationships;\n    const initWysiwyg = rel?.autoInitWysiwyg ?? fb?.autoInitWysiwyg;\n    if (typeof initWysiwyg === 'function') {\n      initWysiwyg();\n    }\n  }\n\n  private renderValidationErrors(): void {\n    const errorsContainer = this.container.querySelector('[data-ct-validation-errors]');\n    if (!errorsContainer) return;\n\n    if (this.state.validationErrors.length === 0) {\n      errorsContainer.classList.add('hidden');\n      errorsContainer.innerHTML = '';\n      // Re-render field list to clear error styling\n      this.renderFieldList();\n      return;\n    }\n\n    // Group errors by field\n    const errorsByField = new Map<string, SchemaValidationError[]>();\n    const generalErrors: SchemaValidationError[] = [];\n\n    for (const err of this.state.validationErrors) {\n      const fieldMatch = err.path.match(/properties[./](\\w+)/);\n      if (fieldMatch) {\n        const fieldName = fieldMatch[1];\n        if (!errorsByField.has(fieldName)) {\n          errorsByField.set(fieldName, []);\n        }\n        errorsByField.get(fieldName)!.push(err);\n      } else {\n        generalErrors.push(err);\n      }\n    }\n\n    errorsContainer.classList.remove('hidden');\n    errorsContainer.innerHTML = `\n      <div class=\"fixed bottom-4 right-4 max-w-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg shadow-lg overflow-hidden z-40\">\n        <div class=\"flex items-center justify-between px-4 py-2 bg-red-100 dark:bg-red-900/40 border-b border-red-200 dark:border-red-800\">\n          <div class=\"flex items-center gap-2\">\n            <svg class=\"w-4 h-4 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n            </svg>\n            <span class=\"text-sm font-medium text-red-800 dark:text-red-200\">\n              ${this.state.validationErrors.length} Validation Error${this.state.validationErrors.length > 1 ? 's' : ''}\n            </span>\n          </div>\n          <button type=\"button\" class=\"text-red-400 hover:text-red-600\" data-close-validation-errors>\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </div>\n        <div class=\"px-4 py-3 max-h-64 overflow-y-auto\">\n          ${generalErrors.length > 0 ? `\n            <div class=\"mb-3\">\n              <div class=\"text-xs font-medium text-red-700 dark:text-red-300 uppercase mb-1\">Schema</div>\n              <ul class=\"text-sm text-red-600 dark:text-red-400 space-y-1\">\n                ${generalErrors.map((err) => `<li class=\"flex items-start gap-2\"><span class=\"text-red-400\">•</span>${escapeHtml(err.message)}</li>`).join('')}\n              </ul>\n            </div>\n          ` : ''}\n          ${Array.from(errorsByField.entries()).map(([fieldName, errors]) => {\n            const field = this.state.fields.find((f) => f.name === fieldName);\n            return `\n              <div class=\"mb-3 last:mb-0\">\n                <div class=\"text-xs font-medium text-red-700 dark:text-red-300 mb-1\">\n                  ${escapeHtml(field?.label ?? fieldName)} <span class=\"font-mono\">(${escapeHtml(fieldName)})</span>\n                </div>\n                <ul class=\"text-sm text-red-600 dark:text-red-400 space-y-1\">\n                  ${errors.map((err) => `<li class=\"flex items-start gap-2\"><span class=\"text-red-400\">•</span>${escapeHtml(err.message)}</li>`).join('')}\n                </ul>\n              </div>\n            `;\n          }).join('')}\n        </div>\n      </div>\n    `;\n\n    // Bind close button\n    errorsContainer.querySelector('[data-close-validation-errors]')?.addEventListener('click', () => {\n      errorsContainer.classList.add('hidden');\n    });\n\n    // Re-render field list to show error styling\n    this.renderFieldList();\n  }\n\n  private showToast(message: string, type: 'success' | 'error' | 'info'): void {\n    // Prefer global notify helper\n    const notify = (window as any).notify as\n      | { success?: (msg: string) => void; error?: (msg: string) => void; info?: (msg: string) => void }\n      | undefined;\n    const notifyFn = notify?.[type];\n    if (typeof notifyFn === 'function') {\n      notifyFn(message);\n      return;\n    }\n\n    // Fallback to console\n    if (type === 'error') {\n      console.error(message);\n    } else {\n      console.log(message);\n    }\n  }\n\n  private schedulePreview(delayMs: number = 400): void {\n    if (this.previewDebounceTimer) {\n      clearTimeout(this.previewDebounceTimer);\n    }\n    this.previewDebounceTimer = setTimeout(() => {\n      this.previewDebounceTimer = null;\n      this.previewSchema();\n    }, delayMs);\n  }\n}\n\n// =============================================================================\n// Types\n// =============================================================================\n\ninterface DragState {\n  fieldId: string;\n  startSection: string;\n  currentSection: string;\n  startIndex: number;\n  currentIndex: number;\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction nameToSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '');\n}\n\nfunction titleCase(str: string): string {\n  return str\n    .replace(/([A-Z])/g, ' $1')\n    .replace(/[_-]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n    .split(' ')\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n}\n\nfunction formatDate(dateStr: string): string {\n  try {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' });\n  } catch {\n    return dateStr;\n  }\n}\n\n// =============================================================================\n// Publish Confirmation Modal\n// =============================================================================\n\ninterface PublishConfirmationModalConfig {\n  contentType: ContentType;\n  compatibilityResult: CompatibilityCheckResult | null;\n  compatibilityError?: string;\n  onConfirm: (force: boolean) => void;\n  onCancel: () => void;\n}\n\nclass PublishConfirmationModal extends Modal {\n  private config: PublishConfirmationModalConfig;\n\n  constructor(config: PublishConfirmationModalConfig) {\n    super({ size: 'lg', flexColumn: false });\n    this.config = config;\n  }\n\n  protected onBeforeHide(): boolean {\n    this.config.onCancel();\n    return true;\n  }\n\n  protected renderContent(): string {\n    const { contentType, compatibilityResult, compatibilityError } = this.config;\n    const hasCompatibilityError = Boolean(compatibilityError);\n    const hasBreakingChanges = (compatibilityResult?.breaking_changes?.length ?? 0) > 0;\n    const hasWarnings = (compatibilityResult?.warnings?.length ?? 0) > 0;\n    const affectedCount = compatibilityResult?.affected_entries_count ?? 0;\n    const confirmDisabled = hasCompatibilityError || hasBreakingChanges;\n    const confirmClass = hasCompatibilityError\n      ? 'bg-gray-400 cursor-not-allowed'\n      : hasBreakingChanges\n        ? 'bg-red-600 hover:bg-red-700 disabled:opacity-50'\n        : 'bg-green-600 hover:bg-green-700';\n\n    return `\n      <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Publish Content Type\n        </h2>\n      </div>\n\n      <div class=\"px-6 py-4 space-y-4\">\n        <p class=\"text-sm text-gray-600 dark:text-gray-400\">\n          You are about to publish <strong class=\"text-gray-900 dark:text-white\">${escapeHtml(contentType.name)}</strong>.\n          ${contentType.status === 'draft' ? 'This will make it available for content creation.' : 'This will create a new version of the schema.'}\n        </p>\n\n        ${hasCompatibilityError ? `\n          <div class=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n            <div class=\"flex items-center gap-2 mb-2\">\n              <svg class=\"w-5 h-5 text-red-600 dark:text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n              </svg>\n              <span class=\"text-sm font-medium text-red-800 dark:text-red-200\">Compatibility Check Failed</span>\n            </div>\n            <p class=\"ml-7 text-sm text-red-700 dark:text-red-300\">\n              Publishing is blocked until compatibility can be verified.\n            </p>\n            ${compatibilityError ? `\n              <p class=\"mt-2 ml-7 text-xs text-red-600 dark:text-red-400\">\n                ${escapeHtml(compatibilityError)}\n              </p>\n            ` : ''}\n          </div>\n        ` : ''}\n\n        ${!hasCompatibilityError && hasBreakingChanges ? `\n          <div class=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n            <div class=\"flex items-center gap-2 mb-2\">\n              <svg class=\"w-5 h-5 text-red-600 dark:text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n              </svg>\n              <span class=\"text-sm font-medium text-red-800 dark:text-red-200\">Breaking Changes Detected</span>\n            </div>\n            <ul class=\"text-sm text-red-700 dark:text-red-300 space-y-1 ml-7\">\n              ${compatibilityResult!.breaking_changes.map((change) => `\n                <li>• ${escapeHtml(change.description || `${change.type}: ${change.path}`)}</li>\n              `).join('')}\n            </ul>\n            ${affectedCount > 0 ? `\n              <p class=\"mt-2 ml-7 text-xs text-red-600 dark:text-red-400\">\n                ${affectedCount} content ${affectedCount === 1 ? 'entry' : 'entries'} will require migration.\n              </p>\n            ` : ''}\n          </div>\n        ` : ''}\n\n        ${!hasCompatibilityError && hasWarnings ? `\n          <div class=\"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg\">\n            <div class=\"flex items-center gap-2 mb-2\">\n              <svg class=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n              <span class=\"text-sm font-medium text-yellow-800 dark:text-yellow-200\">Warnings</span>\n            </div>\n            <ul class=\"text-sm text-yellow-700 dark:text-yellow-300 space-y-1 ml-7\">\n              ${compatibilityResult!.warnings.map((change) => `\n                <li>• ${escapeHtml(change.description || `${change.type}: ${change.path}`)}</li>\n              `).join('')}\n            </ul>\n          </div>\n        ` : ''}\n\n        ${!hasCompatibilityError && !hasBreakingChanges && !hasWarnings ? `\n          <div class=\"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\">\n            <div class=\"flex items-center gap-2\">\n              <svg class=\"w-5 h-5 text-green-600 dark:text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n              <span class=\"text-sm font-medium text-green-800 dark:text-green-200\">Schema is compatible</span>\n            </div>\n            <p class=\"mt-1 ml-7 text-sm text-green-700 dark:text-green-300\">\n              No breaking changes detected. Publishing is safe.\n            </p>\n          </div>\n        ` : ''}\n\n        ${!hasCompatibilityError && hasBreakingChanges ? `\n          <label class=\"flex items-start gap-2\">\n            <input\n              type=\"checkbox\"\n              data-publish-force\n              class=\"mt-0.5 w-4 h-4 text-red-600 border-gray-300 dark:border-gray-600 rounded focus:ring-red-500\"\n            />\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">\n              I understand there are breaking changes and want to publish anyway\n            </span>\n          </label>\n        ` : ''}\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-publish-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-publish-confirm\n          class=\"px-4 py-2 text-sm font-medium text-white rounded-lg ${confirmClass}\"\n          ${confirmDisabled ? 'disabled' : ''}\n        >\n          ${hasBreakingChanges ? 'Publish with Breaking Changes' : 'Publish'}\n        </button>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    this.container?.querySelector('[data-publish-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    const confirmBtn = this.container?.querySelector<HTMLButtonElement>('[data-publish-confirm]');\n    const forceCheckbox = this.container?.querySelector<HTMLInputElement>('[data-publish-force]');\n    const blockPublish = Boolean(this.config.compatibilityError);\n\n    // Enable confirm button when force checkbox is checked (for breaking changes)\n    forceCheckbox?.addEventListener('change', () => {\n      if (confirmBtn && !blockPublish) {\n        confirmBtn.disabled = !forceCheckbox.checked;\n      }\n    });\n\n    confirmBtn?.addEventListener('click', () => {\n      if (blockPublish) {\n        return;\n      }\n      const force = forceCheckbox?.checked ?? false;\n      this.config.onConfirm(force);\n      this.hide();\n    });\n  }\n}\n\n// =============================================================================\n// Clone Content Type Modal\n// =============================================================================\n\ninterface CloneContentTypeModalConfig {\n  contentType: ContentType;\n  onConfirm: (newSlug: string, newName?: string) => void;\n  onCancel: () => void;\n}\n\nclass CloneContentTypeModal extends Modal {\n  private config: CloneContentTypeModalConfig;\n\n  constructor(config: CloneContentTypeModalConfig) {\n    super({ size: 'md', initialFocus: '[data-clone-slug]' });\n    this.config = config;\n  }\n\n  protected onBeforeHide(): boolean {\n    this.config.onCancel();\n    return true;\n  }\n\n  protected renderContent(): string {\n    const { contentType } = this.config;\n    const suggestedSlug = `${contentType.slug}-copy`;\n    const suggestedName = `${contentType.name} (Copy)`;\n\n    return `\n      <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Clone Content Type\n        </h2>\n      </div>\n\n      <div class=\"px-6 py-4 space-y-4\">\n        <p class=\"text-sm text-gray-600 dark:text-gray-400\">\n          Create a copy of <strong class=\"text-gray-900 dark:text-white\">${escapeHtml(contentType.name)}</strong> with a new slug and name.\n        </p>\n\n        <div>\n          <label class=\"${labelClasses()}\">\n            New Slug <span class=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            data-clone-slug\n            value=\"${escapeHtml(suggestedSlug)}\"\n            placeholder=\"my-content-type\"\n            pattern=\"^[a-z][a-z0-9_\\\\-]*$\"\n            required\n            class=\"${inputClasses()}\"\n          />\n          <p class=\"mt-1 text-xs text-gray-500\">Lowercase letters, numbers, hyphens, underscores</p>\n          <div data-clone-error class=\"hidden text-xs text-red-600 dark:text-red-400 mt-1\"></div>\n        </div>\n\n        <div>\n          <label class=\"${labelClasses()}\">\n            New Name\n          </label>\n          <input\n            type=\"text\"\n            data-clone-name\n            value=\"${escapeHtml(suggestedName)}\"\n            placeholder=\"My Content Type\"\n            class=\"${inputClasses()}\"\n          />\n        </div>\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-clone-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-clone-confirm\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          Clone\n        </button>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    this.container?.querySelector('[data-clone-cancel]')?.addEventListener('click', () => {\n      this.config.onCancel();\n      this.hide();\n    });\n\n    this.container?.querySelector('[data-clone-confirm]')?.addEventListener('click', () => {\n      const slugInput = this.container?.querySelector<HTMLInputElement>('[data-clone-slug]');\n      const nameInput = this.container?.querySelector<HTMLInputElement>('[data-clone-name]');\n\n      const newSlug = slugInput?.value?.trim();\n      const newName = nameInput?.value?.trim();\n      const errorEl = this.container?.querySelector<HTMLElement>('[data-clone-error]');\n\n      const showError = (msg: string): void => {\n        if (errorEl) {\n          errorEl.textContent = msg;\n          errorEl.classList.remove('hidden');\n        }\n      };\n\n      if (!newSlug) {\n        showError('Slug is required');\n        slugInput?.focus();\n        return;\n      }\n\n      if (!/^[a-z][a-z0-9_\\-]*$/.test(newSlug)) {\n        showError('Invalid slug format. Use lowercase letters, numbers, hyphens, underscores. Must start with a letter.');\n        slugInput?.focus();\n        return;\n      }\n\n      this.config.onConfirm(newSlug, newName || undefined);\n      this.hide();\n    });\n\n    // Enter key to submit\n    this.container?.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        this.container?.querySelector<HTMLButtonElement>('[data-clone-confirm]')?.click();\n      }\n    });\n  }\n}\n\n// =============================================================================\n// Content Type Version History Viewer\n// =============================================================================\n\ninterface ContentTypeVersionHistoryViewerConfig {\n  apiBasePath: string;\n  contentType: ContentType;\n}\n\nclass ContentTypeVersionHistoryViewer extends Modal {\n  private config: ContentTypeVersionHistoryViewerConfig;\n  private api: ContentTypeAPIClient;\n  private versions: ContentTypeSchemaVersion[] = [];\n  private expandedVersions: Set<string> = new Set();\n\n  constructor(config: ContentTypeVersionHistoryViewerConfig) {\n    super({ size: '2xl', maxHeight: 'max-h-[80vh]' });\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n  }\n\n  protected async onAfterShow(): Promise<void> {\n    await this.loadVersions();\n  }\n\n  protected renderContent(): string {\n    return `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Version History</h2>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">${escapeHtml(this.config.contentType.name)} (${escapeHtml(this.config.contentType.slug)})</p>\n        </div>\n        <button type=\"button\" data-viewer-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto\">\n        <div data-versions-list class=\"p-4\">\n          <div class=\"flex items-center justify-center py-8\">\n            <div class=\"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    this.container?.querySelector('[data-viewer-close]')?.addEventListener('click', () => {\n      this.hide();\n    });\n  }\n\n  private async loadVersions(): Promise<void> {\n    try {\n      const result = await this.api.getVersionHistory(this.config.contentType.id);\n      this.versions = result.versions;\n      this.renderVersionsList();\n    } catch {\n      this.renderVersionsList();\n    }\n  }\n\n  private renderVersionsList(): void {\n    const listEl = this.container?.querySelector('[data-versions-list]');\n    if (!listEl) return;\n\n    if (this.versions.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <p class=\"text-sm\">No version history available.</p>\n          <p class=\"text-xs mt-2\">Current version: ${escapeHtml(this.config.contentType.schema_version ?? '1.0.0')}</p>\n        </div>\n      `;\n      return;\n    }\n\n    listEl.innerHTML = `\n      <div class=\"space-y-3\">\n        ${this.versions.map((version, index) => this.renderVersionCard(version, index === 0)).join('')}\n      </div>\n    `;\n\n    // Bind expand/collapse events\n    listEl.querySelectorAll('[data-toggle-version]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const versionId = btn.getAttribute('data-toggle-version');\n        if (versionId) {\n          if (this.expandedVersions.has(versionId)) {\n            this.expandedVersions.delete(versionId);\n          } else {\n            this.expandedVersions.add(versionId);\n          }\n          this.renderVersionsList();\n        }\n      });\n    });\n  }\n\n  private renderVersionCard(version: ContentTypeSchemaVersion, isCurrent: boolean): string {\n    const isExpanded = this.expandedVersions.has(version.version);\n    const hasChanges = (version.changes?.length ?? 0) > 0;\n    const hasBreakingChanges = version.is_breaking || version.changes?.some((c) => c.is_breaking);\n\n    return `\n      <div class=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\n        <div class=\"p-4 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50\">\n          <div class=\"flex items-center gap-3\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"text-sm font-medium text-gray-900 dark:text-white\">v${escapeHtml(version.version)}</span>\n              ${isCurrent ? '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\">Current</span>' : ''}\n              ${hasBreakingChanges ? '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Breaking</span>' : ''}\n              ${this.getMigrationBadge(version.migration_status)}\n            </div>\n          </div>\n          <div class=\"flex items-center gap-3\">\n            <span class=\"text-xs text-gray-500 dark:text-gray-400\">${formatDate(version.created_at)}</span>\n            ${hasChanges ? `\n              <button\n                type=\"button\"\n                data-toggle-version=\"${escapeHtml(version.version)}\"\n                class=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded\"\n              >\n                <svg class=\"w-4 h-4 transition-transform ${isExpanded ? 'rotate-180' : ''}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n                </svg>\n              </button>\n            ` : ''}\n          </div>\n        </div>\n\n        ${version.migration_status && version.total_count ? `\n          <div class=\"px-4 py-2 border-t border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/30\">\n            <div class=\"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1\">\n              <span>Migration Progress</span>\n              <span>${version.migrated_count ?? 0}/${version.total_count}</span>\n            </div>\n            <div class=\"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n              <div class=\"h-full bg-blue-600 rounded-full\" style=\"width: ${((version.migrated_count ?? 0) / version.total_count) * 100}%\"></div>\n            </div>\n          </div>\n        ` : ''}\n\n        ${isExpanded && hasChanges ? `\n          <div class=\"px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900\">\n            <h4 class=\"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2\">Changes</h4>\n            <ul class=\"space-y-2\">\n              ${version.changes!.map((change) => this.renderChangeItem(change)).join('')}\n            </ul>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  private renderChangeItem(change: SchemaChange): string {\n    const typeColors = {\n      added: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',\n      removed: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',\n      modified: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400',\n    };\n\n    const typeIcons = {\n      added: '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>',\n      removed: '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"></path>',\n      modified: '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>',\n    };\n\n    return `\n      <li class=\"flex items-start gap-2 text-sm\">\n        <span class=\"flex-shrink-0 px-2 py-0.5 text-xs font-medium rounded ${typeColors[change.type]}\">\n          <svg class=\"w-3 h-3 inline-block mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            ${typeIcons[change.type]}\n          </svg>\n          ${change.type}\n        </span>\n        <div class=\"flex-1\">\n          <span class=\"font-mono text-xs text-gray-600 dark:text-gray-400\">${escapeHtml(change.path)}</span>\n          ${change.field ? `<span class=\"text-gray-500 dark:text-gray-400\"> (${escapeHtml(change.field)})</span>` : ''}\n          ${change.description ? `<p class=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5\">${escapeHtml(change.description)}</p>` : ''}\n          ${change.is_breaking ? '<span class=\"ml-1 text-xs text-red-500 dark:text-red-400\">Breaking</span>' : ''}\n        </div>\n      </li>\n    `;\n  }\n\n  private getMigrationBadge(status?: string): string {\n    switch (status) {\n      case 'pending':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\">Pending</span>';\n      case 'in_progress':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\">Migrating</span>';\n      case 'completed':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\">Migrated</span>';\n      case 'failed':\n        return '<span class=\"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">Failed</span>';\n      default:\n        return '';\n    }\n  }\n}\n","/**\n * Block Library Manager\n *\n * UI component for managing block definitions (CRUD operations).\n * Supports both management mode (full CRUD) and picker mode (selection only).\n */\n\nimport type {\n  BlockDefinition,\n  BlockDefinitionSummary,\n  BlockLibraryManagerConfig,\n  BlockLibraryManagerState,\n  BlockSchemaVersion,\n  JSONSchema,\n} from './types';\nimport { ContentTypeAPIClient } from './api-client';\nimport { FieldTypePicker, FIELD_TYPES } from './field-type-picker';\nimport { FieldConfigForm } from './field-config-form';\nimport { fieldsToBlockSchema, schemaToFields, generateFieldId } from './api-client';\nimport { badge } from '../shared/badge';\nimport { Modal, ConfirmModal, TextPromptModal } from '../shared/modal.js';\nimport { inputClasses, selectClasses, textareaClasses, labelClasses } from './shared/field-input-classes';\nimport { renderIconTrigger, bindIconTriggerEvents, resolveIcon } from './shared/icon-picker';\nimport { deriveAdminBasePath, resolveApiBasePath } from './shared/api-paths';\n\n// =============================================================================\n// Block Library Manager Component\n// =============================================================================\n\nexport class BlockLibraryManager extends Modal {\n  private config: BlockLibraryManagerConfig;\n  private api: ContentTypeAPIClient;\n  private state: BlockLibraryManagerState;\n  private categories: string[] = [];\n\n  constructor(config: BlockLibraryManagerConfig) {\n    super({ size: '4xl', backdropDataAttr: 'data-block-library-backdrop' });\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    this.state = {\n      blocks: [],\n      selectedBlockId: null,\n      isLoading: false,\n      isSaving: false,\n      error: null,\n      filter: '',\n      categoryFilter: null,\n    };\n  }\n\n  protected onBeforeHide(): boolean {\n    this.config.onClose?.();\n    return true;\n  }\n\n  protected async onAfterShow(): Promise<void> {\n    this.container?.setAttribute('data-block-library-manager', 'true');\n    await this.loadBlocks();\n    await this.loadCategories();\n  }\n\n  protected renderContent(): string {\n    const isManageMode = this.config.mode !== 'picker';\n    const title = isManageMode ? 'Block Library' : 'Select Block Type';\n\n    return `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div class=\"flex items-center gap-3\">\n          <span class=\"flex items-center justify-center w-10 h-10 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400\">\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\"></path>\n            </svg>\n          </span>\n          <div>\n            <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">${title}</h2>\n            <p class=\"text-sm text-gray-500 dark:text-gray-400\">\n              ${isManageMode ? 'Create, edit, and manage reusable block definitions' : 'Choose a block type to add'}\n            </p>\n          </div>\n        </div>\n        <button type=\"button\" data-block-library-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex items-center gap-4 px-6 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n        <div class=\"flex-1 relative\">\n          <input\n            type=\"text\"\n            data-block-filter\n            placeholder=\"Search blocks...\"\n            class=\"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n          <svg class=\"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n          </svg>\n        </div>\n        <select\n          data-block-category-filter\n          class=\"${selectClasses()}\"\n        >\n          <option value=\"\">All Categories</option>\n        </select>\n        ${\n          isManageMode\n            ? `\n          <button\n            type=\"button\"\n            data-block-create\n            class=\"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n            </svg>\n            New Block\n          </button>\n        `\n            : ''\n        }\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto\">\n        <div data-block-list class=\"p-4\">\n          <div data-block-loading class=\"flex items-center justify-center py-12\">\n            <div class=\"animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          </div>\n        </div>\n      </div>\n\n      <div data-block-error class=\"hidden px-6 py-3 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-800\">\n        <p class=\"text-sm text-red-600 dark:text-red-400\"></p>\n      </div>\n\n      ${\n        this.config.mode === 'picker'\n          ? `\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n          <button\n            type=\"button\"\n            data-block-library-cancel\n            class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n          >\n            Cancel\n          </button>\n        </div>\n      `\n          : ''\n      }\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    // Close button\n    this.container?.querySelector('[data-block-library-close]')?.addEventListener('click', () => {\n      this.requestHide();\n    });\n\n    // Cancel button (picker mode)\n    this.container?.querySelector('[data-block-library-cancel]')?.addEventListener('click', () => {\n      this.requestHide();\n    });\n\n    // Filter input\n    const filterInput = this.container?.querySelector<HTMLInputElement>('[data-block-filter]');\n    filterInput?.addEventListener('input', () => {\n      this.state.filter = filterInput.value;\n      this.renderBlockList();\n    });\n\n    // Category filter\n    const categoryFilter = this.container?.querySelector<HTMLSelectElement>('[data-block-category-filter]');\n    categoryFilter?.addEventListener('change', () => {\n      this.state.categoryFilter = categoryFilter.value || null;\n      this.renderBlockList();\n    });\n\n    // Create new block\n    this.container?.querySelector('[data-block-create]')?.addEventListener('click', () => {\n      this.showBlockEditor(null);\n    });\n\n    // Delegate click events on block list\n    const blockList = this.container?.querySelector('[data-block-list]');\n    blockList?.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n\n      // Block card click (picker mode)\n      const blockCard = target.closest('[data-block-id]');\n      if (blockCard && this.config.mode === 'picker') {\n        const blockId = blockCard.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block && this.isBlockAllowed(block)) {\n          const blockKey = this.blockKey(block);\n          this.config.onSelect?.({\n            id: block.id,\n            name: block.name,\n            slug: block.slug,\n            type: blockKey || block.type,\n            description: block.description,\n            icon: block.icon,\n            category: block.category,\n            schema_version: block.schema_version,\n            status: block.status,\n          });\n          this.hide();\n        }\n        return;\n      }\n\n      // Edit button\n      if (target.closest('[data-block-edit]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.showBlockEditor(block);\n        }\n        return;\n      }\n\n      // Delete button\n      if (target.closest('[data-block-delete]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.confirmDeleteBlock(block);\n        }\n        return;\n      }\n\n      // Clone button\n      if (target.closest('[data-block-clone]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.cloneBlock(block);\n        }\n        return;\n      }\n\n      // Publish button\n      if (target.closest('[data-block-publish]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.publishBlock(block);\n        }\n        return;\n      }\n\n      // Version history button\n      if (target.closest('[data-block-versions]')) {\n        const card = target.closest('[data-block-id]');\n        const blockId = card?.getAttribute('data-block-id');\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block) {\n          this.showVersionHistory(block);\n        }\n        return;\n      }\n    });\n  }\n\n  private async loadBlocks(): Promise<void> {\n    this.state.isLoading = true;\n    this.state.error = null;\n    this.renderBlockList();\n\n    try {\n      const response = await this.api.listBlockDefinitions();\n      this.state.blocks = response.items;\n    } catch (err) {\n      this.state.error = err instanceof Error ? err.message : 'Failed to load blocks';\n    } finally {\n      this.state.isLoading = false;\n      this.refreshCategoriesFromBlocks();\n      this.renderBlockList();\n    }\n  }\n\n  private async loadCategories(): Promise<void> {\n    try {\n      const apiCategories = await this.api.getBlockCategories();\n      if (apiCategories.length > 0) {\n        this.categories = apiCategories;\n      }\n    } catch {\n      // Categories will be derived from loaded blocks in refreshCategoriesFromBlocks\n    }\n    this.renderCategoryOptions();\n  }\n\n  private refreshCategoriesFromBlocks(): void {\n    const seen = new Set<string>(this.categories);\n    for (const block of this.state.blocks) {\n      const cat = (block.category || '').trim().toLowerCase();\n      if (cat && !seen.has(cat)) {\n        seen.add(cat);\n        this.categories.push(cat);\n      }\n    }\n    this.renderCategoryOptions();\n  }\n\n  private renderCategoryOptions(): void {\n    const select = this.container?.querySelector<HTMLSelectElement>('[data-block-category-filter]');\n    if (!select) return;\n\n    select.innerHTML = '<option value=\"\">All Categories</option>';\n    for (const category of this.categories) {\n      const option = document.createElement('option');\n      option.value = category;\n      option.textContent = titleCase(category);\n      select.appendChild(option);\n    }\n  }\n\n  private renderBlockList(): void {\n    const listEl = this.container?.querySelector('[data-block-list]');\n    if (!listEl) return;\n\n    if (this.state.isLoading) {\n      listEl.innerHTML = `\n        <div data-block-loading class=\"flex items-center justify-center py-12\">\n          <div class=\"animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n        </div>\n      `;\n      return;\n    }\n\n    const filteredBlocks = this.getFilteredBlocks();\n\n    if (filteredBlocks.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"flex flex-col items-center justify-center py-12 text-center\">\n          <svg class=\"w-12 h-12 text-gray-300 dark:text-gray-600 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\"></path>\n          </svg>\n          <p class=\"text-gray-500 dark:text-gray-400\">\n            ${this.state.filter || this.state.categoryFilter ? 'No blocks match your filters' : 'No blocks defined yet'}\n          </p>\n          ${\n            this.config.mode !== 'picker' && !this.state.filter && !this.state.categoryFilter\n              ? `\n            <button\n              type=\"button\"\n              data-block-create-empty\n              class=\"mt-4 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n            >\n              Create your first block\n            </button>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      listEl.querySelector('[data-block-create-empty]')?.addEventListener('click', () => {\n        this.showBlockEditor(null);\n      });\n      return;\n    }\n\n    // Group blocks by category\n    const groupedBlocks = new Map<string, BlockDefinition[]>();\n    for (const block of filteredBlocks) {\n      const category = block.category || 'custom';\n      if (!groupedBlocks.has(category)) {\n        groupedBlocks.set(category, []);\n      }\n      groupedBlocks.get(category)!.push(block);\n    }\n\n    let html = '';\n    for (const [category, blocks] of groupedBlocks) {\n      html += `\n        <div class=\"mb-6\">\n          <h3 class=\"text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3\">${titleCase(category)}</h3>\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            ${blocks.map((block) => this.renderBlockCard(block)).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    listEl.innerHTML = html;\n  }\n\n  private renderBlockCard(block: BlockDefinition): string {\n    const isManageMode = this.config.mode !== 'picker';\n    const isAllowed = this.isBlockAllowed(block);\n    const statusBadge = this.getStatusBadge(block.status);\n    const blockKey = this.blockKey(block);\n\n    return `\n      <div\n        data-block-id=\"${block.id}\"\n        class=\"relative p-4 border rounded-lg ${\n          isAllowed\n            ? 'border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-800 hover:border-blue-300 dark:hover:border-blue-600 cursor-pointer'\n            : 'border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 opacity-60 cursor-not-allowed'\n        } transition-colors\"\n      >\n        <div class=\"flex items-start gap-3\">\n          <div class=\"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-lg font-medium\">\n            ${block.icon ? resolveIcon(block.icon) : blockKey.charAt(0).toUpperCase()}\n          </div>\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <h4 class=\"text-sm font-medium text-gray-900 dark:text-white truncate\">${escapeHtml(block.name)}</h4>\n              ${statusBadge}\n            </div>\n            <p class=\"text-xs text-gray-500 dark:text-gray-400 font-mono\">${escapeHtml(blockKey)}</p>\n            ${\n              block.description\n                ? `<p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400 line-clamp-2\">${escapeHtml(block.description)}</p>`\n                : ''\n            }\n            ${\n              block.schema_version\n                ? `<p class=\"mt-1 text-xs text-gray-400 dark:text-gray-500\">v${escapeHtml(block.schema_version)}</p>`\n                : ''\n            }\n          </div>\n        </div>\n\n        ${\n          isManageMode\n            ? `\n          <div class=\"absolute top-2 right-2 flex items-center gap-1\">\n            <button\n              type=\"button\"\n              data-block-versions\n              class=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\n              title=\"Version history\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n              </svg>\n            </button>\n            ${\n              block.status === 'draft'\n                ? `\n              <button\n                type=\"button\"\n                data-block-publish\n                class=\"p-1.5 text-green-500 hover:text-green-600 rounded hover:bg-green-50 dark:hover:bg-green-900/20\"\n                title=\"Publish\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                </svg>\n              </button>\n            `\n                : ''\n            }\n            <button\n              type=\"button\"\n              data-block-clone\n              class=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\n              title=\"Clone\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\n              </svg>\n            </button>\n            <button\n              type=\"button\"\n              data-block-edit\n              class=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\n              title=\"Edit\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n              </svg>\n            </button>\n            <button\n              type=\"button\"\n              data-block-delete\n              class=\"p-1.5 text-gray-400 hover:text-red-500 rounded hover:bg-red-50 dark:hover:bg-red-900/20\"\n              title=\"Delete\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\n              </svg>\n            </button>\n          </div>\n        `\n            : ''\n        }\n\n        ${!isAllowed ? `<div class=\"absolute inset-0 flex items-center justify-center bg-gray-100/50 dark:bg-gray-900/50 rounded-lg\"><span class=\"text-xs text-gray-500 dark:text-gray-400\">Not allowed</span></div>` : ''}\n      </div>\n    `;\n  }\n\n  private getStatusBadge(status?: string): string {\n    const variant = status || 'active';\n    const label = variant.charAt(0).toUpperCase() + variant.slice(1);\n    return badge(label, 'status', variant);\n  }\n\n  private getFilteredBlocks(): BlockDefinition[] {\n    let blocks = [...this.state.blocks];\n\n    // Apply search filter\n    if (this.state.filter) {\n      const searchLower = this.state.filter.toLowerCase();\n      blocks = blocks.filter(\n        (b) =>\n          b.name.toLowerCase().includes(searchLower) ||\n          b.type.toLowerCase().includes(searchLower) ||\n          (b.slug?.toLowerCase().includes(searchLower) ?? false) ||\n          (b.description?.toLowerCase().includes(searchLower) ?? false)\n      );\n    }\n\n    // Apply category filter\n    if (this.state.categoryFilter) {\n      blocks = blocks.filter((b) => b.category === this.state.categoryFilter);\n    }\n\n    return blocks;\n  }\n\n  private blockKey(block: BlockDefinition): string {\n    return (block.slug || block.type || '').trim();\n  }\n\n  private blockInList(list: string[] | undefined, block: BlockDefinition): boolean {\n    if (!list || list.length === 0) return false;\n    const key = this.blockKey(block);\n    if (key && list.includes(key)) return true;\n    if (block.slug && list.includes(block.type)) return true;\n    return false;\n  }\n\n  private isBlockAllowed(block: BlockDefinition): boolean {\n    const { allowedBlocks, deniedBlocks } = this.config;\n\n    if (this.blockInList(deniedBlocks, block)) {\n      return false;\n    }\n\n    if (allowedBlocks && allowedBlocks.length > 0) {\n      return this.blockInList(allowedBlocks, block);\n    }\n\n    return true;\n  }\n\n  private showBlockEditor(block: BlockDefinition | null): void {\n    const editor = new BlockDefinitionEditor({\n      apiBasePath: this.config.apiBasePath,\n      block,\n      categories: this.categories,\n      onSave: async (savedBlock) => {\n        await this.loadBlocks();\n      },\n      onCancel: () => {},\n    });\n    editor.show();\n  }\n\n  private async confirmDeleteBlock(block: BlockDefinition): Promise<void> {\n    const confirmed = await ConfirmModal.confirm(\n      `Are you sure you want to delete the block \"${block.name}\"? This action cannot be undone.`,\n      { title: 'Delete Block', confirmText: 'Delete', confirmVariant: 'danger' },\n    );\n    if (!confirmed) return;\n\n    try {\n      await this.api.deleteBlockDefinition(block.id);\n      await this.loadBlocks();\n    } catch (err) {\n      this.showError(err instanceof Error ? err.message : 'Failed to delete block');\n    }\n  }\n\n  private cloneBlock(block: BlockDefinition): void {\n    const base = (block.slug || block.type || 'block').trim();\n    const modal = new TextPromptModal({\n      title: 'Clone Block',\n      label: 'Enter a unique slug for the cloned block',\n      placeholder: 'e.g. hero_copy',\n      initialValue: `${base}_copy`,\n      confirmLabel: 'Clone',\n      inputClass: inputClasses(),\n      onConfirm: async (value) => {\n        const newSlug = value.trim();\n        if (!newSlug) return;\n        try {\n          await this.api.cloneBlockDefinition(block.id, newSlug, newSlug);\n          await this.loadBlocks();\n        } catch (err) {\n          this.showError(err instanceof Error ? err.message : 'Failed to clone block');\n        }\n      },\n    });\n    modal.show();\n  }\n\n  private async publishBlock(block: BlockDefinition): Promise<void> {\n    try {\n      await this.api.publishBlockDefinition(block.id);\n      await this.loadBlocks();\n    } catch (err) {\n      this.showError(err instanceof Error ? err.message : 'Failed to publish block');\n    }\n  }\n\n  private async showVersionHistory(block: BlockDefinition): Promise<void> {\n    const viewer = new BlockVersionHistoryViewer({\n      apiBasePath: this.config.apiBasePath,\n      block,\n    });\n    viewer.show();\n  }\n\n  private showError(message: string): void {\n    const errorEl = this.container?.querySelector('[data-block-error]');\n    if (!errorEl) return;\n\n    errorEl.classList.remove('hidden');\n    const textEl = errorEl.querySelector('p');\n    if (textEl) textEl.textContent = message;\n\n    setTimeout(() => {\n      errorEl.classList.add('hidden');\n    }, 5000);\n  }\n}\n\n// =============================================================================\n// Block Definition Editor\n// =============================================================================\n\ninterface BlockDefinitionEditorConfig {\n  apiBasePath: string;\n  block: BlockDefinition | null;\n  categories: string[];\n  onSave: (block: BlockDefinition) => void;\n  onCancel: () => void;\n}\n\nclass BlockDefinitionEditor extends Modal {\n  private config: BlockDefinitionEditorConfig;\n  private api: ContentTypeAPIClient;\n  private fields: import('./types').FieldDefinition[] = [];\n  private isNew: boolean;\n\n  constructor(config: BlockDefinitionEditorConfig) {\n    super({ size: '3xl' });\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n    this.isNew = !config.block;\n\n    if (config.block?.schema) {\n      this.fields = schemaToFields(config.block.schema);\n    }\n  }\n\n  protected onBeforeHide(): boolean {\n    this.config.onCancel();\n    return true;\n  }\n\n  protected renderContent(): string {\n    const block = this.config.block;\n\n    return `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          ${this.isNew ? 'Create Block Definition' : 'Edit Block Definition'}\n        </h2>\n        <button type=\"button\" data-editor-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto px-6 py-4\">\n        <form data-block-form class=\"space-y-6\">\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Name <span class=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                name=\"name\"\n                value=\"${escapeHtml(block?.name ?? '')}\"\n                placeholder=\"Hero Section\"\n                required\n                class=\"${inputClasses()}\"\n              />\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Type <span class=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                name=\"type\"\n                value=\"${escapeHtml(block?.type ?? '')}\"\n                placeholder=\"hero\"\n                pattern=\"^[a-z][a-z0-9_\\\\-]*$\"\n                required\n                ${block ? 'readonly' : ''}\n                class=\"${inputClasses()} ${block ? 'bg-gray-50 dark:bg-gray-800 cursor-not-allowed' : ''}\"\n              />\n              <p class=\"mt-1 text-xs text-gray-500\">Unique identifier. Lowercase, numbers, hyphens, underscores.</p>\n            </div>\n          </div>\n\n          <div>\n            <label class=\"${labelClasses()}\">\n              Description\n            </label>\n            <textarea\n              name=\"description\"\n              rows=\"2\"\n              placeholder=\"A description of this block type\"\n              class=\"${textareaClasses()}\"\n            >${escapeHtml(block?.description ?? '')}</textarea>\n          </div>\n\n          <div class=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label class=\"${labelClasses()}\">\n                Category\n              </label>\n              <select\n                name=\"category\"\n                class=\"${selectClasses()}\"\n              >\n                ${this.config.categories.map((cat) => `<option value=\"${cat}\" ${block?.category === cat ? 'selected' : ''}>${titleCase(cat)}</option>`).join('')}\n              </select>\n            </div>\n            <div>\n              <label class=\"${labelClasses()}\">\n                Icon\n              </label>\n              ${renderIconTrigger(block?.icon ?? '', 'name=\"icon\"')}\n            </div>\n          </div>\n\n          <div class=\"border-t border-gray-200 dark:border-gray-700 pt-4\">\n            <div class=\"flex items-center justify-between mb-4\">\n              <h3 class=\"text-sm font-medium text-gray-900 dark:text-white\">Block Fields</h3>\n              <button\n                type=\"button\"\n                data-add-field\n                class=\"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n                </svg>\n                Add Field\n              </button>\n            </div>\n            <div data-fields-list class=\"space-y-2\">\n              ${this.renderFieldsList()}\n            </div>\n          </div>\n        </form>\n      </div>\n\n      <div data-editor-error class=\"hidden px-6 py-3 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-800\">\n        <p class=\"text-sm text-red-600 dark:text-red-400\"></p>\n      </div>\n\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button\n          type=\"button\"\n          data-editor-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          data-editor-save\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\"\n        >\n          ${this.isNew ? 'Create Block' : 'Save Changes'}\n        </button>\n      </div>\n    `;\n  }\n\n  private renderFieldsList(): string {\n    if (this.fields.length === 0) {\n      return `\n        <div class=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <p class=\"text-sm\">No fields defined. Click \"Add Field\" to start.</p>\n        </div>\n      `;\n    }\n\n    return this.fields\n      .map(\n        (field, index) => `\n        <div class=\"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/50\" data-field-index=\"${index}\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"text-sm font-medium text-gray-900 dark:text-white\">${escapeHtml(field.label)}</span>\n              <span class=\"text-xs text-gray-500 dark:text-gray-400 font-mono\">${escapeHtml(field.name)}</span>\n              <span class=\"px-2 py-0.5 text-xs rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300\">${field.type}</span>\n              ${field.required ? '<span class=\"text-xs text-red-500\">required</span>' : ''}\n            </div>\n          </div>\n          <button type=\"button\" data-edit-field=\"${index}\" class=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\">\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n            </svg>\n          </button>\n          <button type=\"button\" data-remove-field=\"${index}\" class=\"p-1 text-gray-400 hover:text-red-500\">\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </div>\n      `\n      )\n      .join('');\n  }\n\n  protected bindContentEvents(): void {\n    this.container?.querySelector('[data-editor-close]')?.addEventListener('click', () => {\n      this.requestHide();\n    });\n\n    this.container?.querySelector('[data-editor-cancel]')?.addEventListener('click', () => {\n      this.requestHide();\n    });\n\n    this.container?.querySelector('[data-editor-save]')?.addEventListener('click', () => {\n      this.handleSave();\n    });\n\n    this.container?.querySelector('[data-add-field]')?.addEventListener('click', () => {\n      this.showFieldTypePicker();\n    });\n\n    // Icon picker trigger\n    if (this.container) {\n      bindIconTriggerEvents(this.container, '[data-icon-trigger]', (trigger) => {\n        const hiddenInput = trigger.querySelector<HTMLInputElement>('[name=\"icon\"]');\n        return {\n          value: hiddenInput?.value ?? '',\n          onSelect: (v: string) => { if (hiddenInput) hiddenInput.value = v; },\n          onClear: () => { if (hiddenInput) hiddenInput.value = ''; },\n        };\n      });\n    }\n\n    // Delegate field events\n    this.container?.querySelector('[data-fields-list]')?.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n\n      const editBtn = target.closest('[data-edit-field]');\n      if (editBtn) {\n        const index = parseInt(editBtn.getAttribute('data-edit-field') ?? '-1', 10);\n        if (index >= 0 && this.fields[index]) {\n          this.showFieldConfigForm(this.fields[index], index);\n        }\n        return;\n      }\n\n      const removeBtn = target.closest('[data-remove-field]');\n      if (removeBtn) {\n        const index = parseInt(removeBtn.getAttribute('data-remove-field') ?? '-1', 10);\n        if (index >= 0) {\n          this.fields.splice(index, 1);\n          this.updateFieldsList();\n        }\n        return;\n      }\n    });\n  }\n\n  private showFieldTypePicker(): void {\n    const picker = new FieldTypePicker({\n      onSelect: (fieldType) => {\n        const newField: import('./types').FieldDefinition = {\n          id: generateFieldId(),\n          name: '',\n          type: fieldType,\n          label: '',\n          required: false,\n        };\n        this.showFieldConfigForm(newField, -1);\n      },\n      onCancel: () => {},\n      excludeTypes: ['blocks', 'repeater'], // Blocks can't nest blocks\n    });\n    picker.show();\n  }\n\n  private showFieldConfigForm(field: import('./types').FieldDefinition, index: number): void {\n    const form = new FieldConfigForm({\n      field,\n      existingFieldNames: this.fields.filter((_, i) => i !== index).map((f) => f.name),\n      apiBasePath: this.config.apiBasePath,\n      onSave: (updatedField) => {\n        if (index >= 0) {\n          this.fields[index] = updatedField;\n        } else {\n          this.fields.push(updatedField);\n        }\n        this.updateFieldsList();\n      },\n      onCancel: () => {},\n    });\n    form.show();\n  }\n\n  private updateFieldsList(): void {\n    const listEl = this.container?.querySelector('[data-fields-list]');\n    if (listEl) {\n      listEl.innerHTML = this.renderFieldsList();\n    }\n  }\n\n  private async handleSave(): Promise<void> {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-block-form]');\n    if (!form) return;\n\n    const formData = new FormData(form);\n    const name = (formData.get('name') as string)?.trim();\n    const type = (formData.get('type') as string)?.trim();\n\n    if (!name || !type) {\n      this.showEditorError('Name and Type are required');\n      return;\n    }\n\n    if (!/^[a-z][a-z0-9_\\-]*$/.test(type)) {\n      this.showEditorError('Invalid type format. Use lowercase letters, numbers, hyphens, underscores. Must start with a letter.');\n      return;\n    }\n\n    const schema = fieldsToBlockSchema(this.fields, type);\n\n    const descriptionValue = formData.get('description');\n    const iconValue = formData.get('icon');\n    const blockData: Partial<BlockDefinition> = {\n      name,\n      type,\n      description: typeof descriptionValue === 'string' ? descriptionValue.trim() : undefined,\n      category: (formData.get('category') as string) || 'custom',\n      icon: typeof iconValue === 'string' ? iconValue.trim() : undefined,\n      schema,\n      status: this.config.block?.status ?? 'draft',\n    };\n\n    try {\n      let savedBlock: BlockDefinition;\n      if (this.isNew) {\n        savedBlock = await this.api.createBlockDefinition(blockData);\n      } else {\n        savedBlock = await this.api.updateBlockDefinition(this.config.block!.id, blockData);\n      }\n      this.config.onSave(savedBlock);\n      this.hide();\n    } catch (err) {\n      this.showEditorError(err instanceof Error ? err.message : 'Failed to save block');\n    }\n  }\n\n  private showEditorError(message: string): void {\n    const errorEl = this.container?.querySelector('[data-editor-error]');\n    if (!errorEl) return;\n    errorEl.classList.remove('hidden');\n    const textEl = errorEl.querySelector('p');\n    if (textEl) textEl.textContent = message;\n    setTimeout(() => errorEl.classList.add('hidden'), 5000);\n  }\n}\n\n// =============================================================================\n// Block Version History Viewer\n// =============================================================================\n\ninterface BlockVersionHistoryViewerConfig {\n  apiBasePath: string;\n  block: BlockDefinition;\n}\n\nclass BlockVersionHistoryViewer extends Modal {\n  private config: BlockVersionHistoryViewerConfig;\n  private api: ContentTypeAPIClient;\n  private versions: BlockSchemaVersion[] = [];\n\n  constructor(config: BlockVersionHistoryViewerConfig) {\n    super({ size: '2xl', maxHeight: 'max-h-[80vh]' });\n    this.config = config;\n    this.api = new ContentTypeAPIClient({ basePath: config.apiBasePath });\n  }\n\n  protected async onAfterShow(): Promise<void> {\n    await this.loadVersions();\n  }\n\n  protected renderContent(): string {\n    return `\n      <div class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <h2 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Version History</h2>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">${escapeHtml(this.config.block.name)} (${escapeHtml(this.config.block.slug || this.config.block.type)})</p>\n        </div>\n        <button type=\"button\" data-viewer-close class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\">\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"flex-1 overflow-y-auto\">\n        <div data-versions-list class=\"p-4\">\n          <div class=\"flex items-center justify-center py-8\">\n            <div class=\"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    this.container?.querySelector('[data-viewer-close]')?.addEventListener('click', () => {\n      this.hide();\n    });\n  }\n\n  private async loadVersions(): Promise<void> {\n    try {\n      const result = await this.api.getBlockDefinitionVersions(this.config.block.id);\n      this.versions = result.versions;\n      this.renderVersionsList();\n    } catch {\n      this.renderVersionsList();\n    }\n  }\n\n  private renderVersionsList(): void {\n    const listEl = this.container?.querySelector('[data-versions-list]');\n    if (!listEl) return;\n\n    if (this.versions.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <p class=\"text-sm\">No version history available.</p>\n          <p class=\"text-xs mt-2\">Current version: ${escapeHtml(this.config.block.schema_version ?? '1.0.0')}</p>\n        </div>\n      `;\n      return;\n    }\n\n    listEl.innerHTML = `\n      <div class=\"space-y-3\">\n        ${this.versions\n          .map(\n            (version) => `\n          <div class=\"p-4 border border-gray-200 dark:border-gray-700 rounded-lg\">\n            <div class=\"flex items-center justify-between mb-2\">\n              <div class=\"flex items-center gap-2\">\n                <span class=\"text-sm font-medium text-gray-900 dark:text-white\">v${escapeHtml(version.version)}</span>\n                ${version.is_breaking ? badge('Breaking', 'status', 'breaking') : ''}\n                ${this.getMigrationBadge(version.migration_status)}\n              </div>\n              <span class=\"text-xs text-gray-500 dark:text-gray-400\">${formatDate(version.created_at)}</span>\n            </div>\n            ${\n              version.migration_status && version.total_count\n                ? `\n              <div class=\"mt-2\">\n                <div class=\"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1\">\n                  <span>Migration Progress</span>\n                  <span>${version.migrated_count ?? 0}/${version.total_count}</span>\n                </div>\n                <div class=\"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n                  <div class=\"h-full bg-blue-600 rounded-full\" style=\"width: ${((version.migrated_count ?? 0) / version.total_count) * 100}%\"></div>\n                </div>\n              </div>\n            `\n                : ''\n            }\n          </div>\n        `\n          )\n          .join('')}\n      </div>\n    `;\n  }\n\n  private getMigrationBadge(status?: string): string {\n    const map: Record<string, [string, string]> = {\n      pending:     ['Pending', 'pending'],\n      in_progress: ['Migrating', 'migrating'],\n      completed:   ['Migrated', 'migrated'],\n      failed:      ['Failed', 'failed'],\n    };\n    const entry = status ? map[status] : undefined;\n    if (!entry) return '';\n    return badge(entry[0], 'status', entry[1]);\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction titleCase(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n}\n\nfunction formatDate(dateStr: string): string {\n  try {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' });\n  } catch {\n    return dateStr;\n  }\n}\n\n// =============================================================================\n// Auto-initialization\n// =============================================================================\n\nexport function initBlockLibraryManagers(scope: ParentNode = document): void {\n  const triggers = Array.from(scope.querySelectorAll<HTMLElement>('[data-block-library-trigger]'));\n\n  triggers.forEach((trigger) => {\n    if (trigger.dataset.initialized === 'true') return;\n\n    const apiBasePath = resolveApiBasePath(trigger.dataset.apiBasePath, trigger.dataset.basePath);\n    const basePath = deriveAdminBasePath(apiBasePath, trigger.dataset.basePath);\n    const mode = (trigger.dataset.mode as 'manage' | 'picker') ?? 'manage';\n\n    if (mode === 'manage') {\n      // Manage mode navigates to the Block Library IDE page\n      trigger.addEventListener('click', () => {\n        window.location.href = `${basePath}/content/block-library`;\n      });\n    } else {\n      // Picker mode opens the modal for block selection\n      const config: BlockLibraryManagerConfig = {\n        apiBasePath,\n        mode,\n      };\n\n      trigger.addEventListener('click', () => {\n        const manager = new BlockLibraryManager(config);\n        manager.show();\n      });\n    }\n\n    trigger.dataset.initialized = 'true';\n  });\n}\n\nfunction onReady(fn: () => void): void {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', fn, { once: true });\n  } else {\n    fn();\n  }\n}\n\nonReady(() => initBlockLibraryManagers());\n","/**\n * Block Editor Panel\n *\n * Phase 8 implements the inline block editor (center column):\n *   - Block metadata fields (name, slug, description, category, icon, status)\n *   - Inline field cards with expand/collapse accordion (one open at a time)\n *   - Section grouping with collapsible section headers\n *   - \"Move to section\" action per field card\n *\n * The panel is rendered inside [data-block-ide-editor] when a block is selected.\n */\n\nimport type { BlockDefinition, BlockDefinitionStatus, FieldDefinition, FieldTypeMetadata, BlockDefinitionSummary, BlocksFieldConfig } from './types';\nimport { schemaToFields, fieldsToSchema, ContentTypeAPIClient } from './api-client';\nimport { getFieldTypeMetadata, normalizeFieldType } from './field-type-picker';\nimport { PALETTE_DRAG_MIME, PALETTE_DRAG_META_MIME } from './field-palette-panel';\nimport { FieldConfigForm } from './field-config-form';\nimport { inputClasses, selectClasses } from './shared/field-input-classes';\nimport { ConfirmModal, TextPromptModal } from '../shared/modal';\nimport { renderIconTrigger, bindIconTriggerEvents, closeIconPicker } from './shared/icon-picker';\nimport { renderEntityHeader, renderSaveIndicator } from './shared/entity-header';\nimport type { SaveState } from './shared/entity-header';\nimport { renderFieldCard as renderFieldCardShared, renderDropZone } from './shared/field-card';\nimport { loadAvailableBlocks, normalizeBlockSelection, renderInlineBlockPicker, bindInlineBlockPickerEvents } from './shared/block-picker';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface BlockEditorPanelConfig {\n  container: HTMLElement;\n  block: BlockDefinition;\n  categories: string[];\n  api: ContentTypeAPIClient;\n  onMetadataChange: (blockId: string, patch: Partial<BlockDefinition>) => void;\n  onSchemaChange: (blockId: string, fields: FieldDefinition[]) => void;\n  /** Called when a field type is dropped from the palette (Phase 9) */\n  onFieldDrop?: (meta: FieldTypeMetadata) => void;\n  /** Called when status is changed via the editor dropdown (Phase 11 — Task 11.3) */\n  onStatusChange?: (blockId: string, newStatus: BlockDefinitionStatus) => void;\n  /** Called when the user triggers a manual save (Phase 11 — Task 11.1) */\n  onSave?: (blockId: string) => void;\n  /** Called when the user clicks \"+ Add Field\" button in the fields header */\n  onAddFieldClick?: () => void;\n}\n\ninterface SectionState {\n  collapsed: boolean;\n}\n\nconst DEFAULT_SECTION = 'main';\n\n/** MIME type for intra-section field reorder drag */\nconst FIELD_REORDER_MIME = 'application/x-field-reorder';\n\n// =============================================================================\n// Block Editor Panel\n// =============================================================================\n\nexport class BlockEditorPanel {\n  private config: BlockEditorPanelConfig;\n  private block: BlockDefinition;\n  private fields: FieldDefinition[];\n  private expandedFieldId: string | null = null;\n  private sectionStates: Map<string, SectionState> = new Map();\n  private moveMenuFieldId: string | null = null;\n  private dropHighlight: boolean = false;\n  /** Active intra-section drag reorder (Phase 10 — Task 10.1) */\n  private dragReorder: { fieldId: string; sectionName: string } | null = null;\n  /** Field id currently showing a drop-before indicator */\n  private dropTargetFieldId: string | null = null;\n  /** Save state tracking (Phase 11 — Task 11.2) */\n  private saveState: SaveState = 'idle';\n  private saveMessage: string = '';\n  private saveDisplayTimer: ReturnType<typeof setTimeout> | null = null;\n  /** Cached block definitions for inline block picker (Phase 4) */\n  private cachedBlocks: BlockDefinitionSummary[] | null = null;\n  private blocksLoading = false;\n  private blockPickerModes: Map<string, 'allowed' | 'denied'> = new Map();\n\n  constructor(config: BlockEditorPanelConfig) {\n    this.config = config;\n    this.block = { ...config.block };\n    this.fields = config.block.schema ? schemaToFields(config.block.schema) : [];\n  }\n\n  render(): void {\n    closeIconPicker();\n    this.config.container.innerHTML = '';\n\n    const wrapper = document.createElement('div');\n    wrapper.className = 'flex flex-col h-full overflow-hidden';\n    wrapper.setAttribute('data-block-editor-panel', '');\n\n    wrapper.innerHTML = `\n      ${this.renderHeader()}\n      <div class=\"flex-1 overflow-y-auto\" data-editor-scroll>\n        ${this.renderMetadataSection()}\n        ${this.renderFieldsSection()}\n      </div>\n    `;\n\n    this.config.container.appendChild(wrapper);\n    this.bindEvents(wrapper);\n    this.ensureInlineBlocksPicker();\n  }\n\n  /** Refresh the panel for a new block without a full re-mount */\n  update(block: BlockDefinition): void {\n    this.block = { ...block };\n    this.fields = block.schema ? schemaToFields(block.schema) : [];\n    this.expandedFieldId = null;\n    this.moveMenuFieldId = null;\n    this.render();\n  }\n\n  getFields(): FieldDefinition[] {\n    return [...this.fields];\n  }\n\n  /** Add a field to the end of the fields list (Phase 9 — palette insert) */\n  addField(field: FieldDefinition): void {\n    this.fields.push(field);\n    this.expandedFieldId = field.id;\n    this.render();\n  }\n\n  // ===========================================================================\n  // Rendering – Header\n  // ===========================================================================\n\n  private renderHeader(): string {\n    return renderEntityHeader({\n      name: this.block.name || 'Untitled',\n      subtitle: this.block.slug || this.block.type || '',\n      subtitleMono: true,\n      status: this.block.status || 'draft',\n      saveState: this.saveState,\n      saveMessage: this.saveMessage,\n      compact: true,\n    });\n  }\n\n  // ===========================================================================\n  // Save state indicator (Phase 11 — Task 11.2)\n  // ===========================================================================\n\n  /** Update the save state indicator without a full re-render */\n  updateSaveState(state: SaveState, message?: string): void {\n    if (this.saveDisplayTimer) {\n      clearTimeout(this.saveDisplayTimer);\n      this.saveDisplayTimer = null;\n    }\n\n    this.saveState = state;\n    this.saveMessage = message ?? '';\n\n    // Update the indicator in-place\n    const container = this.config.container.querySelector('[data-entity-save-indicator]');\n    if (container) {\n      container.innerHTML = renderSaveIndicator(this.saveState, this.saveMessage);\n    }\n\n    // Auto-clear \"saved\" state after a delay\n    if (state === 'saved') {\n      this.saveDisplayTimer = setTimeout(() => {\n        this.saveState = 'idle';\n        this.saveMessage = '';\n        const el = this.config.container.querySelector('[data-entity-save-indicator]');\n        if (el) el.innerHTML = '';\n      }, 2000);\n    }\n  }\n\n  /** Revert the status dropdown to a previous value (used on status change failure) */\n  revertStatus(status?: BlockDefinitionStatus | string): void {\n    const select = this.config.container.querySelector<HTMLSelectElement>('[data-meta-field=\"status\"]');\n    if (select) {\n      select.value = status ?? 'draft';\n    }\n    (this.block as unknown as Record<string, unknown>).status = status ?? 'draft';\n  }\n\n  // ===========================================================================\n  // Rendering – Metadata (Task 8.1)\n  // ===========================================================================\n\n  private renderMetadataSection(): string {\n    const b = this.block;\n    const slugValue = b.slug || b.type || '';\n    const typeHint =\n      b.slug && b.type && b.slug !== b.type\n        ? `<p class=\"mt-0.5 text-[10px] text-gray-400 dark:text-gray-500\">Internal type: ${esc(b.type)}</p>`\n        : '';\n    return `\n      <div class=\"border-b border-gray-200 dark:border-gray-700\" data-editor-metadata>\n        <button type=\"button\" data-toggle-metadata\n                class=\"w-full flex items-center justify-between px-5 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:bg-gray-50/80 dark:hover:bg-gray-800/50 transition-colors\">\n          <div class=\"flex items-center gap-2\">\n            <span class=\"w-1 h-4 rounded-full bg-indigo-400\"></span>\n            <span>Block Metadata</span>\n          </div>\n          <span data-metadata-chevron class=\"w-4 h-4 text-gray-400 dark:text-gray-500 flex items-center justify-center\">\n            <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n            </svg>\n          </span>\n        </button>\n        <div class=\"px-5 pb-4 space-y-3\" data-metadata-body>\n          <div class=\"grid grid-cols-2 gap-3\">\n            <div>\n              <label class=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">Name</label>\n              <input type=\"text\" data-meta-field=\"name\" value=\"${esc(b.name)}\"\n                     class=\"${inputClasses()}\" />\n            </div>\n            <div>\n              <label class=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">Slug</label>\n              <input type=\"text\" data-meta-field=\"slug\" value=\"${esc(slugValue)}\" pattern=\"^[a-z][a-z0-9_\\\\-]*$\"\n                     class=\"${inputClasses()} font-mono\" />\n              ${typeHint}\n            </div>\n          </div>\n          <div>\n            <label class=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">Description</label>\n            <textarea data-meta-field=\"description\" rows=\"2\"\n                      placeholder=\"Short description for other editors...\"\n                      class=\"${inputClasses()} resize-none\">${esc(b.description ?? '')}</textarea>\n          </div>\n          <div class=\"grid grid-cols-3 gap-3\">\n            <div>\n              <label class=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">Category</label>\n              <select data-meta-field=\"category\" class=\"${selectClasses()}\">\n                ${this.config.categories.map((c) => `<option value=\"${esc(c)}\" ${c === (b.category ?? '') ? 'selected' : ''}>${esc(titleCase(c))}</option>`).join('')}\n              </select>\n            </div>\n            <div>\n              <label class=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">Icon</label>\n              ${renderIconTrigger(b.icon ?? '', 'data-meta-field=\"icon\"', true)}\n            </div>\n            <div>\n              <label class=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">Status</label>\n              <select data-meta-field=\"status\" class=\"${selectClasses()}\">\n                <option value=\"draft\" ${b.status === 'draft' ? 'selected' : ''}>Draft</option>\n                <option value=\"active\" ${b.status === 'active' ? 'selected' : ''}>Active</option>\n                <option value=\"deprecated\" ${b.status === 'deprecated' ? 'selected' : ''}>Deprecated</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>`;\n  }\n\n  // ===========================================================================\n  // Rendering – Fields grouped by section (Tasks 8.2 + 8.3)\n  // ===========================================================================\n\n  private renderFieldsSection(): string {\n    const sections = this.groupFieldsBySection();\n    const sectionNames = Array.from(sections.keys());\n\n    if (this.fields.length === 0) {\n      return `\n        <div class=\"px-5 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\n          <div class=\"flex items-center gap-2\">\n            <span class=\"w-1 h-4 rounded-full bg-emerald-400\"></span>\n            <span class=\"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Fields</span>\n            <span class=\"text-[11px] text-gray-400 dark:text-gray-500\">0 fields</span>\n          </div>\n          <button type=\"button\" data-block-add-field\n                  class=\"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium\">\n            <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n            </svg>\n            Add Field\n          </button>\n        </div>\n        <div data-field-drop-zone\n             class=\"flex flex-col items-center justify-center py-16 px-5 text-center border-2 border-dashed ${this.dropHighlight ? 'border-blue-400 bg-blue-50/50' : 'border-transparent'} rounded-lg mx-3 my-2 transition-colors\">\n          <svg class=\"w-12 h-12 text-gray-200 dark:text-gray-700 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\"\n                  d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zm0 8a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6z\"></path>\n          </svg>\n          <p class=\"text-sm text-gray-400 dark:text-gray-500\">No fields defined.</p>\n          <p class=\"text-xs text-gray-300 dark:text-gray-600 mt-1\">Drag fields from the palette or click a field type to add.</p>\n        </div>`;\n    }\n\n    let html = `\n      <div class=\"px-5 py-3 border-b border-gray-200 flex items-center justify-between\">\n        <div class=\"flex items-center gap-2\">\n          <span class=\"w-1 h-4 rounded-full bg-emerald-400\"></span>\n          <span class=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Fields</span>\n          <span class=\"text-[11px] text-gray-400 dark:text-gray-500\">${this.fields.length} field${this.fields.length !== 1 ? 's' : ''}</span>\n        </div>\n        <button type=\"button\" data-block-add-field\n                class=\"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium\">\n          <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\n          </svg>\n          Add Field\n        </button>\n      </div>`;\n\n    for (const sectionName of sectionNames) {\n      const fields = sections.get(sectionName)!;\n      const state = this.getSectionState(sectionName);\n      const isCollapsed = state.collapsed;\n\n      html += `\n        <div data-section=\"${esc(sectionName)}\" class=\"border-b border-gray-100 dark:border-gray-800\">\n          <button type=\"button\" data-toggle-section=\"${esc(sectionName)}\"\n                  class=\"w-full flex items-center gap-2 px-5 py-2.5 text-left hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group\">\n            <span class=\"w-3.5 h-3.5 text-gray-400 dark:text-gray-500 flex items-center justify-center\" data-section-chevron=\"${esc(sectionName)}\">\n              ${isCollapsed\n                ? '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n                : '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>'\n              }\n            </span>\n            <span class=\"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">${esc(titleCase(sectionName))}</span>\n            <span class=\"text-[10px] text-gray-400 dark:text-gray-500 ml-auto\">${fields.length}</span>\n          </button>\n\n          <div class=\"${isCollapsed ? 'hidden' : ''}\" data-section-body=\"${esc(sectionName)}\">\n            <div class=\"px-3 pb-2 space-y-1\" data-section-fields=\"${esc(sectionName)}\">\n              ${fields.map((f) => this.renderFieldCard(f, sectionNames, fields)).join('')}\n            </div>\n          </div>\n        </div>`;\n    }\n\n    // Drop zone at the bottom (Phase 9 — Task 9.3)\n    html += renderDropZone({ highlight: this.dropHighlight });\n\n    return html;\n  }\n\n  // ===========================================================================\n  // Rendering – Single field card (Task 8.2)\n  // ===========================================================================\n\n  private renderFieldCard(field: FieldDefinition, allSections: string[], sectionFields: FieldDefinition[]): string {\n    const sectionName = field.section || DEFAULT_SECTION;\n    const indexInSection = sectionFields.indexOf(field);\n\n    // Build constraint badges\n    const constraints: string[] = [];\n    if (field.validation?.minLength !== undefined) constraints.push(`min: ${field.validation.minLength}`);\n    if (field.validation?.maxLength !== undefined) constraints.push(`max: ${field.validation.maxLength}`);\n    if (field.validation?.min !== undefined) constraints.push(`>= ${field.validation.min}`);\n    if (field.validation?.max !== undefined) constraints.push(`<= ${field.validation.max}`);\n    if (field.validation?.pattern) constraints.push('pattern');\n\n    // Build actions HTML (3-dot menu + move-to-section dropdown)\n    const actionsHtml = `\n          <div class=\"relative flex-shrink-0\">\n            <button type=\"button\" data-field-actions=\"${esc(field.id)}\"\n                    class=\"p-1.5 rounded-md text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors\"\n                    title=\"Field actions\">\n              <svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path d=\"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z\"></path>\n              </svg>\n            </button>\n            ${this.moveMenuFieldId === field.id ? this.renderMoveToSectionMenu(field, allSections, sectionName) : ''}\n          </div>`;\n\n    return renderFieldCardShared({\n      field,\n      isExpanded: field.id === this.expandedFieldId,\n      isDropTarget: this.dropTargetFieldId === field.id,\n      showReorderButtons: true,\n      isFirst: indexInSection === 0,\n      isLast: indexInSection === sectionFields.length - 1,\n      compact: false,\n      sectionName,\n      actionsHtml,\n      constraintBadges: constraints,\n      renderExpandedContent: () => this.renderFieldProperties(field, allSections),\n    });\n  }\n\n  // ===========================================================================\n  // Rendering – Inline field property editor (Task 8.2)\n  // ===========================================================================\n\n  private renderFieldProperties(field: FieldDefinition, allSections: string[]): string {\n    const normalizedType = normalizeFieldType(field.type);\n    const isBlocks = normalizedType === 'blocks';\n\n    // For blocks fields, show block picker as primary, field settings as secondary\n    if (isBlocks) {\n      return this.renderBlocksFieldProperties(field, allSections);\n    }\n\n    return this.renderStandardFieldProperties(field, allSections);\n  }\n\n  /** Standard field properties (non-blocks) */\n  private renderStandardFieldProperties(field: FieldDefinition, allSections: string[]): string {\n    const validation = field.validation ?? {};\n    const normalizedType = normalizeFieldType(field.type);\n    const showStringVal = ['text', 'textarea', 'rich-text', 'markdown', 'code', 'slug'].includes(normalizedType);\n    const showNumberVal = ['number', 'integer', 'currency', 'percentage'].includes(normalizedType);\n    const currentSection = field.section || DEFAULT_SECTION;\n\n    return `\n      <div class=\"px-3 pb-3 space-y-3 border-t border-gray-100 dark:border-gray-800 mt-1 pt-3\" data-field-props=\"${esc(field.id)}\">\n        <!-- General -->\n        <div class=\"grid grid-cols-2 gap-2\">\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Field Name</label>\n            <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"name\"\n                   value=\"${esc(field.name)}\" pattern=\"^[a-z][a-z0-9_]*$\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Label</label>\n            <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"label\"\n                   value=\"${esc(field.label)}\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n        </div>\n\n        <div>\n          <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Description</label>\n          <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"description\"\n                 value=\"${esc(field.description ?? '')}\" placeholder=\"Help text for editors\"\n                 class=\"${inputClasses('xs')}\" />\n        </div>\n\n        <div>\n          <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Placeholder</label>\n          <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"placeholder\"\n                 value=\"${esc(field.placeholder ?? '')}\"\n                 class=\"${inputClasses('xs')}\" />\n        </div>\n\n        <!-- Flags -->\n        <div class=\"flex items-center gap-4\">\n          <label class=\"flex items-center gap-1.5 cursor-pointer\">\n            <input type=\"checkbox\" data-field-check=\"${esc(field.id)}\" data-check-key=\"required\"\n                   ${field.required ? 'checked' : ''}\n                   class=\"w-3.5 h-3.5 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\" />\n            <span class=\"text-[11px] text-gray-600 dark:text-gray-400\">Required</span>\n          </label>\n          <label class=\"flex items-center gap-1.5 cursor-pointer\">\n            <input type=\"checkbox\" data-field-check=\"${esc(field.id)}\" data-check-key=\"readonly\"\n                   ${field.readonly ? 'checked' : ''}\n                   class=\"w-3.5 h-3.5 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\" />\n            <span class=\"text-[11px] text-gray-600 dark:text-gray-400\">Read-only</span>\n          </label>\n          <label class=\"flex items-center gap-1.5 cursor-pointer\">\n            <input type=\"checkbox\" data-field-check=\"${esc(field.id)}\" data-check-key=\"hidden\"\n                   ${field.hidden ? 'checked' : ''}\n                   class=\"w-3.5 h-3.5 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\" />\n            <span class=\"text-[11px] text-gray-600 dark:text-gray-400\">Hidden</span>\n          </label>\n        </div>\n\n        <!-- Validation (conditional) -->\n        ${showStringVal ? `\n        <div class=\"grid grid-cols-2 gap-2\">\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Min Length</label>\n            <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"validation.minLength\"\n                   value=\"${validation.minLength ?? ''}\" min=\"0\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Max Length</label>\n            <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"validation.maxLength\"\n                   value=\"${validation.maxLength ?? ''}\" min=\"0\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n        </div>\n        <div>\n          <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Pattern (RegEx)</label>\n          <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"validation.pattern\"\n                 value=\"${esc(validation.pattern ?? '')}\" placeholder=\"^[a-z]+$\"\n                 class=\"${inputClasses('xs')} font-mono\" />\n        </div>` : ''}\n\n        ${showNumberVal ? `\n        <div class=\"grid grid-cols-2 gap-2\">\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Minimum</label>\n            <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"validation.min\"\n                   value=\"${validation.min ?? ''}\" step=\"any\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Maximum</label>\n            <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"validation.max\"\n                   value=\"${validation.max ?? ''}\" step=\"any\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n        </div>` : ''}\n\n        <!-- Appearance (Phase 10 — Task 10.3: section dropdown) -->\n        <div class=\"grid grid-cols-2 gap-2\">\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Section</label>\n            <select data-field-section-select=\"${esc(field.id)}\"\n                    class=\"${selectClasses('xs')}\">\n              ${allSections.map((s) => `<option value=\"${esc(s)}\" ${s === currentSection ? 'selected' : ''}>${esc(titleCase(s))}</option>`).join('')}\n              <option value=\"__new__\">+ New section...</option>\n            </select>\n          </div>\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Grid Span (1-12)</label>\n            <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"gridSpan\"\n                   value=\"${field.gridSpan ?? ''}\" min=\"1\" max=\"12\" placeholder=\"12\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n        </div>\n\n        <!-- Remove field -->\n        <div class=\"pt-2 border-t border-gray-100 dark:border-gray-800\">\n          <button type=\"button\" data-field-remove=\"${esc(field.id)}\"\n                  class=\"text-[11px] text-red-500 hover:text-red-700 font-medium transition-colors\">\n            Remove field\n          </button>\n        </div>\n      </div>`;\n  }\n\n  /** Blocks field properties: block picker primary, field settings secondary */\n  private renderBlocksFieldProperties(field: FieldDefinition, allSections: string[]): string {\n    const config = (field.config ?? {}) as BlocksFieldConfig;\n    const currentSection = field.section || DEFAULT_SECTION;\n    const mode = this.getBlocksPickerMode(field.id);\n    const isAllowed = mode === 'allowed';\n    const selectedBlocks = new Set(\n      isAllowed ? (config.allowedBlocks ?? []) : (config.deniedBlocks ?? []),\n    );\n    const toggleBase = 'px-2 py-1 text-[10px] font-semibold uppercase tracking-wider rounded';\n    const allowedClass = isAllowed\n      ? 'bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300'\n      : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800';\n    const deniedClass = !isAllowed\n      ? 'bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-300'\n      : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800';\n    const pickerLabel = isAllowed ? 'Allowed Blocks' : 'Denied Blocks';\n    const pickerAccent = isAllowed ? 'blue' : 'red';\n    const emptySelectionText = isAllowed ? 'All blocks allowed (no restrictions)' : 'No blocks denied';\n\n    // Block picker section (primary — always visible)\n    let pickerHtml: string;\n    if (this.cachedBlocks) {\n      const normalized = normalizeBlockSelection(selectedBlocks, this.cachedBlocks);\n      pickerHtml = renderInlineBlockPicker({\n        availableBlocks: this.cachedBlocks,\n        selectedBlocks: normalized,\n        onSelectionChange: () => {},\n        label: pickerLabel,\n        accent: pickerAccent,\n        emptySelectionText,\n      });\n    } else {\n      pickerHtml = `\n        <div class=\"flex items-center justify-center py-6\" data-blocks-loading=\"${esc(field.id)}\">\n          <div class=\"animate-spin w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n          <span class=\"ml-2 text-xs text-gray-400 dark:text-gray-500\">Loading blocks...</span>\n        </div>`;\n    }\n\n    return `\n      <div class=\"px-3 pb-3 space-y-3 border-t border-gray-100 dark:border-gray-800 mt-1 pt-3\" data-field-props=\"${esc(field.id)}\">\n        <!-- Block Selection (primary) -->\n        <div class=\"flex items-center justify-between\">\n          <div class=\"inline-flex items-center gap-1 p-0.5 rounded-md border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n            <button type=\"button\" data-blocks-mode-toggle=\"${esc(field.id)}\" data-blocks-mode=\"allowed\"\n                    class=\"${toggleBase} ${allowedClass}\">\n              Allowed\n            </button>\n            <button type=\"button\" data-blocks-mode-toggle=\"${esc(field.id)}\" data-blocks-mode=\"denied\"\n                    class=\"${toggleBase} ${deniedClass}\">\n              Denied\n            </button>\n          </div>\n          <button type=\"button\" data-blocks-open-library=\"${esc(field.id)}\"\n                  class=\"text-[11px] text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium\">\n            Open Block Library\n          </button>\n        </div>\n        <div data-blocks-picker-container=\"${esc(field.id)}\">\n          ${pickerHtml}\n        </div>\n        <div class=\"flex items-center justify-between\">\n          <button type=\"button\" data-blocks-advanced=\"${esc(field.id)}\"\n                  class=\"text-[11px] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 font-medium\">\n            Advanced settings...\n          </button>\n        </div>\n\n        <!-- Min/Max Blocks -->\n        <div class=\"grid grid-cols-2 gap-2\">\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Min Blocks</label>\n            <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"config.minBlocks\"\n                   value=\"${config.minBlocks ?? ''}\" min=\"0\" placeholder=\"0\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n          <div>\n            <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Max Blocks</label>\n            <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"config.maxBlocks\"\n                   value=\"${config.maxBlocks ?? ''}\" min=\"1\" placeholder=\"No limit\"\n                   class=\"${inputClasses('xs')}\" />\n          </div>\n        </div>\n\n        <!-- Field Settings (secondary — collapsed by default) -->\n        <div class=\"border-t border-gray-100 dark:border-gray-800 pt-2\">\n          <button type=\"button\" data-blocks-settings-toggle=\"${esc(field.id)}\"\n                  class=\"flex items-center gap-1.5 text-[11px] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 font-medium\">\n            <span data-blocks-settings-chevron=\"${esc(field.id)}\">\n              <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>\n            </span>\n            Field Settings\n          </button>\n\n          <div class=\"hidden mt-2 space-y-3\" data-blocks-settings-body=\"${esc(field.id)}\">\n            <div class=\"grid grid-cols-2 gap-2\">\n              <div>\n                <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Field Name</label>\n                <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"name\"\n                       value=\"${esc(field.name)}\" pattern=\"^[a-z][a-z0-9_]*$\"\n                       class=\"${inputClasses('xs')}\" />\n              </div>\n              <div>\n                <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Label</label>\n                <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"label\"\n                       value=\"${esc(field.label)}\"\n                       class=\"${inputClasses('xs')}\" />\n              </div>\n            </div>\n            <div>\n              <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Description</label>\n              <input type=\"text\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"description\"\n                     value=\"${esc(field.description ?? '')}\" placeholder=\"Help text for editors\"\n                     class=\"${inputClasses('xs')}\" />\n            </div>\n            <div class=\"flex items-center gap-4\">\n              <label class=\"flex items-center gap-1.5 cursor-pointer\">\n                <input type=\"checkbox\" data-field-check=\"${esc(field.id)}\" data-check-key=\"required\"\n                       ${field.required ? 'checked' : ''}\n                       class=\"w-3.5 h-3.5 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\" />\n                <span class=\"text-[11px] text-gray-600 dark:text-gray-400\">Required</span>\n              </label>\n              <label class=\"flex items-center gap-1.5 cursor-pointer\">\n                <input type=\"checkbox\" data-field-check=\"${esc(field.id)}\" data-check-key=\"readonly\"\n                       ${field.readonly ? 'checked' : ''}\n                       class=\"w-3.5 h-3.5 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\" />\n                <span class=\"text-[11px] text-gray-600 dark:text-gray-400\">Read-only</span>\n              </label>\n              <label class=\"flex items-center gap-1.5 cursor-pointer\">\n                <input type=\"checkbox\" data-field-check=\"${esc(field.id)}\" data-check-key=\"hidden\"\n                       ${field.hidden ? 'checked' : ''}\n                       class=\"w-3.5 h-3.5 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500\" />\n                <span class=\"text-[11px] text-gray-600 dark:text-gray-400\">Hidden</span>\n              </label>\n            </div>\n            <div class=\"grid grid-cols-2 gap-2\">\n              <div>\n                <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Section</label>\n                <select data-field-section-select=\"${esc(field.id)}\"\n                        class=\"${selectClasses('xs')}\">\n                  ${allSections.map((s) => `<option value=\"${esc(s)}\" ${s === currentSection ? 'selected' : ''}>${esc(titleCase(s))}</option>`).join('')}\n                  <option value=\"__new__\">+ New section...</option>\n                </select>\n              </div>\n              <div>\n                <label class=\"block text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5\">Grid Span (1-12)</label>\n                <input type=\"number\" data-field-prop=\"${esc(field.id)}\" data-prop-key=\"gridSpan\"\n                       value=\"${field.gridSpan ?? ''}\" min=\"1\" max=\"12\" placeholder=\"12\"\n                       class=\"${inputClasses('xs')}\" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Remove field -->\n        <div class=\"pt-2 border-t border-gray-100 dark:border-gray-800\">\n          <button type=\"button\" data-field-remove=\"${esc(field.id)}\"\n                  class=\"text-[11px] text-red-500 hover:text-red-700 font-medium transition-colors\">\n            Remove field\n          </button>\n        </div>\n      </div>`;\n  }\n\n  // ===========================================================================\n  // Rendering – Move to Section menu (Task 8.4)\n  // ===========================================================================\n\n  private renderMoveToSectionMenu(field: FieldDefinition, allSections: string[], currentSection: string): string {\n    const otherSections = allSections.filter((s) => s !== currentSection);\n    if (otherSections.length === 0) {\n      return `\n        <div data-move-menu class=\"absolute right-0 top-full mt-1 z-30 w-44 bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg py-1 text-sm\">\n          <div class=\"px-3 py-1.5 text-xs text-gray-400 dark:text-gray-500\">Only one section exists.</div>\n          <button type=\"button\" data-move-new-section=\"${esc(field.id)}\"\n                  class=\"w-full text-left px-3 py-1.5 text-xs text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20\">\n            + Create new section\n          </button>\n        </div>`;\n    }\n\n    return `\n      <div data-move-menu class=\"absolute right-0 top-full mt-1 z-30 w-44 bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg py-1 text-sm\">\n        <div class=\"px-3 py-1 text-[10px] font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider\">Move to section</div>\n        ${otherSections.map((s) => `\n          <button type=\"button\" data-move-to=\"${esc(s)}\" data-move-field=\"${esc(field.id)}\"\n                  class=\"w-full text-left px-3 py-1.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\">\n            <svg class=\"w-3 h-3 text-gray-400 dark:text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\"></path>\n            </svg>\n            ${esc(titleCase(s))}\n          </button>`).join('')}\n        <div class=\"border-t border-gray-100 dark:border-gray-700 mt-1 pt-1\">\n          <button type=\"button\" data-move-new-section=\"${esc(field.id)}\"\n                  class=\"w-full text-left px-3 py-1.5 text-xs text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20\">\n            + Create new section\n          </button>\n        </div>\n      </div>`;\n  }\n\n  // ===========================================================================\n  // Section helpers\n  // ===========================================================================\n\n  private groupFieldsBySection(): Map<string, FieldDefinition[]> {\n    const map = new Map<string, FieldDefinition[]>();\n    for (const field of this.fields) {\n      const section = field.section || DEFAULT_SECTION;\n      if (!map.has(section)) map.set(section, []);\n      map.get(section)!.push(field);\n    }\n    // Ensure \"main\" is always first if it exists\n    if (map.has(DEFAULT_SECTION)) {\n      const mainFields = map.get(DEFAULT_SECTION)!;\n      map.delete(DEFAULT_SECTION);\n      const ordered = new Map<string, FieldDefinition[]>();\n      ordered.set(DEFAULT_SECTION, mainFields);\n      for (const [k, v] of map) ordered.set(k, v);\n      return ordered;\n    }\n    return map;\n  }\n\n  private getSectionState(name: string): SectionState {\n    if (!this.sectionStates.has(name)) {\n      this.sectionStates.set(name, { collapsed: false });\n    }\n    return this.sectionStates.get(name)!;\n  }\n\n  private getBlocksPickerMode(fieldId: string): 'allowed' | 'denied' {\n    return this.blockPickerModes.get(fieldId) ?? 'allowed';\n  }\n\n  private ensureInlineBlocksPicker(): void {\n    if (!this.expandedFieldId) return;\n    const field = this.fields.find((f) => f.id === this.expandedFieldId);\n    if (field && normalizeFieldType(field.type) === 'blocks') {\n      void this.loadBlocksForField(field);\n    }\n  }\n\n  // ===========================================================================\n  // Event Binding\n  // ===========================================================================\n\n  private bindEvents(root: HTMLElement): void {\n    // Metadata toggle\n    root.querySelector('[data-toggle-metadata]')?.addEventListener('click', () => {\n      const body = root.querySelector<HTMLElement>('[data-metadata-body]');\n      const chevron = root.querySelector<HTMLElement>('[data-metadata-chevron]');\n      if (body) {\n        const hidden = body.classList.toggle('hidden');\n        if (chevron) {\n          chevron.innerHTML = hidden\n            ? '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n            : '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>';\n        }\n      }\n    });\n\n    // Metadata field changes (Task 8.1)\n    root.querySelectorAll<HTMLElement>('[data-meta-field]').forEach((el) => {\n      const key = el.dataset.metaField!;\n      if (el.tagName === 'SELECT') {\n        el.addEventListener('change', () => this.handleMetadataChange(key, (el as HTMLSelectElement).value));\n      } else if (el.tagName === 'TEXTAREA' || el.tagName === 'INPUT') {\n        el.addEventListener('input', () => this.handleMetadataChange(key, (el as HTMLInputElement).value));\n      }\n    });\n\n    // Icon picker trigger\n    bindIconTriggerEvents(root, '[data-icon-trigger]', (trigger) => {\n      const hiddenInput = trigger.querySelector<HTMLInputElement>('[data-meta-field=\"icon\"]');\n      return {\n        value: hiddenInput?.value ?? '',\n        onSelect: (v: string) => {\n          if (hiddenInput) {\n            hiddenInput.value = v;\n            hiddenInput.dispatchEvent(new Event('input', { bubbles: true }));\n          }\n        },\n        onClear: () => {\n          if (hiddenInput) {\n            hiddenInput.value = '';\n            hiddenInput.dispatchEvent(new Event('input', { bubbles: true }));\n          }\n        },\n        compact: true,\n      };\n    });\n\n    // Delegate: section toggle, field toggle, field actions, move-to, field prop changes, field remove\n    root.addEventListener('click', (e) => this.handleClick(e, root));\n\n    // Delegate: field property inputs\n    root.addEventListener('input', (e) => this.handleInput(e));\n\n    // Delegate: field checkbox changes\n    root.addEventListener('change', (e) => this.handleChange(e, root));\n\n    // Close move menu on outside click\n    document.addEventListener('click', (e) => {\n      if (this.moveMenuFieldId) {\n        const target = e.target as HTMLElement;\n        if (!target.closest('[data-move-menu]') && !target.closest('[data-field-actions]')) {\n          this.moveMenuFieldId = null;\n          this.render();\n        }\n      }\n    });\n\n    // Drop zone events (Phase 9 — Task 9.3)\n    this.bindDropZoneEvents(root);\n\n    // Drag reorder events (Phase 10 — Task 10.1)\n    this.bindFieldReorderEvents(root);\n\n    // Section select change (Phase 10 — Task 10.3)\n    this.bindSectionSelectEvents(root);\n  }\n\n  /** Bind drag-and-drop events on all [data-field-drop-zone] elements */\n  private bindDropZoneEvents(root: HTMLElement): void {\n    const dropZones = root.querySelectorAll<HTMLElement>('[data-field-drop-zone]');\n\n    dropZones.forEach((zone) => {\n      zone.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        e.dataTransfer!.dropEffect = 'copy';\n        if (!this.dropHighlight) {\n          this.dropHighlight = true;\n          zone.classList.remove('border-gray-200', 'hover:border-gray-300', 'border-transparent');\n          zone.classList.add('border-blue-400', 'bg-blue-50/50');\n        }\n      });\n\n      zone.addEventListener('dragleave', (e) => {\n        // Only reset when leaving the zone itself, not its children\n        if (!zone.contains(e.relatedTarget as Node)) {\n          this.dropHighlight = false;\n          zone.classList.remove('border-blue-400', 'bg-blue-50/50');\n          zone.classList.add('border-gray-200', 'hover:border-gray-300');\n        }\n      });\n\n      zone.addEventListener('drop', (e) => {\n        e.preventDefault();\n        this.dropHighlight = false;\n        zone.classList.remove('border-blue-400', 'bg-blue-50/50');\n        zone.classList.add('border-gray-200', 'hover:border-gray-300');\n\n        if (this.config.onFieldDrop) {\n          const metaRaw = e.dataTransfer?.getData(PALETTE_DRAG_META_MIME);\n          if (metaRaw) {\n            try {\n              const parsed = JSON.parse(metaRaw) as FieldTypeMetadata;\n              if (parsed && parsed.type) {\n                this.config.onFieldDrop(parsed);\n                return;\n              }\n            } catch {\n              // fall through to type-only handling\n            }\n          }\n          const fieldType = e.dataTransfer?.getData(PALETTE_DRAG_MIME);\n          if (fieldType) {\n            const normalized = normalizeFieldType(fieldType);\n            const meta =\n              getFieldTypeMetadata(normalized) ??\n              ({\n                type: normalized,\n                label: titleCase(normalized),\n                description: '',\n                icon: '',\n                category: 'advanced',\n              } as FieldTypeMetadata);\n            this.config.onFieldDrop(meta);\n          }\n        }\n      });\n    });\n  }\n\n  private handleClick(e: Event, root: HTMLElement): void {\n    const target = e.target as HTMLElement;\n\n    // Add Field button in fields header\n    const addFieldBtn = target.closest<HTMLElement>('[data-block-add-field]');\n    if (addFieldBtn) {\n      if (this.config.onAddFieldClick) {\n        this.config.onAddFieldClick();\n      }\n      return;\n    }\n\n    // Section toggle (Task 8.3)\n    const sectionToggle = target.closest<HTMLElement>('[data-toggle-section]');\n    if (sectionToggle) {\n      const section = sectionToggle.dataset.toggleSection!;\n      const state = this.getSectionState(section);\n      state.collapsed = !state.collapsed;\n      this.sectionStates.set(section, state);\n      // Toggle visibility\n      const body = root.querySelector<HTMLElement>(`[data-section-body=\"${section}\"]`);\n      const chevron = root.querySelector<HTMLElement>(`[data-section-chevron=\"${section}\"]`);\n      if (body) body.classList.toggle('hidden', state.collapsed);\n      if (chevron) {\n        chevron.innerHTML = state.collapsed\n          ? '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n          : '<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>';\n      }\n      return;\n    }\n\n    // Field actions (three-dot menu — Task 8.4)\n    const actionsBtn = target.closest<HTMLElement>('[data-field-actions]');\n    if (actionsBtn) {\n      e.stopPropagation();\n      const fieldId = actionsBtn.dataset.fieldActions!;\n      this.moveMenuFieldId = this.moveMenuFieldId === fieldId ? null : fieldId;\n      this.render();\n      return;\n    }\n\n    // Move to section\n    const moveBtn = target.closest<HTMLElement>('[data-move-to]');\n    if (moveBtn) {\n      e.stopPropagation();\n      const targetSection = moveBtn.dataset.moveTo!;\n      const fieldId = moveBtn.dataset.moveField!;\n      this.moveFieldToSection(fieldId, targetSection);\n      return;\n    }\n\n    // Move to new section\n    const moveNewBtn = target.closest<HTMLElement>('[data-move-new-section]');\n    if (moveNewBtn) {\n      e.stopPropagation();\n      const fieldId = moveNewBtn.dataset.moveNewSection!;\n      const modal = new TextPromptModal({\n        title: 'Create New Section',\n        label: 'Section name',\n        placeholder: 'e.g. sidebar',\n        confirmLabel: 'Create',\n        inputClass: inputClasses(),\n        onConfirm: (value) => {\n          const section = value.trim().toLowerCase().replace(/\\s+/g, '_');\n          if (section) {\n            this.moveFieldToSection(fieldId, section);\n          }\n        },\n      });\n      modal.show();\n      return;\n    }\n\n    // Move field up within section (Phase 10 — Task 10.2)\n    const moveUpBtn = target.closest<HTMLElement>('[data-field-move-up]');\n    if (moveUpBtn) {\n      e.stopPropagation();\n      const fieldId = moveUpBtn.dataset.fieldMoveUp!;\n      if (!moveUpBtn.hasAttribute('disabled')) {\n        this.moveFieldInSection(fieldId, -1);\n      }\n      return;\n    }\n\n    // Move field down within section (Phase 10 — Task 10.2)\n    const moveDownBtn = target.closest<HTMLElement>('[data-field-move-down]');\n    if (moveDownBtn) {\n      e.stopPropagation();\n      const fieldId = moveDownBtn.dataset.fieldMoveDown!;\n      if (!moveDownBtn.hasAttribute('disabled')) {\n        this.moveFieldInSection(fieldId, 1);\n      }\n      return;\n    }\n\n    // Remove field\n    const removeBtn = target.closest<HTMLElement>('[data-field-remove]');\n    if (removeBtn) {\n      const fieldId = removeBtn.dataset.fieldRemove!;\n      const field = this.fields.find((f) => f.id === fieldId);\n      if (field) {\n        ConfirmModal.confirm(`Remove field \"${field.label || field.name}\"?`, {\n          title: 'Remove Field',\n          confirmText: 'Remove',\n          confirmVariant: 'danger',\n        }).then((confirmed) => {\n          if (!confirmed) return;\n          this.fields = this.fields.filter((f) => f.id !== fieldId);\n          if (this.expandedFieldId === fieldId) this.expandedFieldId = null;\n          this.notifySchemaChange();\n          this.render();\n        });\n      }\n      return;\n    }\n\n    // Blocks field settings toggle (Phase 4)\n    const blocksToggle = target.closest<HTMLElement>('[data-blocks-settings-toggle]');\n    if (blocksToggle) {\n      const fieldId = blocksToggle.dataset.blocksSettingsToggle!;\n      const body = root.querySelector<HTMLElement>(`[data-blocks-settings-body=\"${fieldId}\"]`);\n      const chevron = root.querySelector<HTMLElement>(`[data-blocks-settings-chevron=\"${fieldId}\"]`);\n      if (body) {\n        const isHidden = body.classList.toggle('hidden');\n        if (chevron) {\n          chevron.innerHTML = isHidden\n            ? '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>'\n            : '<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>';\n        }\n      }\n      return;\n    }\n\n    // Blocks picker mode toggle (allowed/denied)\n    const blocksMode = target.closest<HTMLElement>('[data-blocks-mode-toggle]');\n    if (blocksMode) {\n      e.stopPropagation();\n      const fieldId = blocksMode.dataset.blocksModeToggle!;\n      const mode = (blocksMode.dataset.blocksMode as 'allowed' | 'denied') ?? 'allowed';\n      this.blockPickerModes.set(fieldId, mode);\n      this.render();\n      return;\n    }\n\n    // Open Block Library\n    const blocksOpenLibrary = target.closest<HTMLElement>('[data-blocks-open-library]');\n    if (blocksOpenLibrary) {\n      e.stopPropagation();\n      const basePath = this.config.api.getBasePath();\n      window.location.href = `${basePath}/content/block-library`;\n      return;\n    }\n\n    // Advanced settings modal\n    const blocksAdvanced = target.closest<HTMLElement>('[data-blocks-advanced]');\n    if (blocksAdvanced) {\n      e.stopPropagation();\n      const fieldId = blocksAdvanced.dataset.blocksAdvanced!;\n      const field = this.fields.find((f) => f.id === fieldId);\n      if (field) this.openFieldConfigModal(field);\n      return;\n    }\n\n    // Field toggle (expand/collapse — Task 8.2 accordion)\n    const fieldToggle = target.closest<HTMLElement>('[data-field-toggle]');\n    if (fieldToggle) {\n      if (target.closest('[data-field-grip]')) return;\n      const fieldId = fieldToggle.dataset.fieldToggle!;\n      // Accordion: close current if same, otherwise switch\n      this.expandedFieldId = this.expandedFieldId === fieldId ? null : fieldId;\n      this.render();\n\n      // Trigger block loading for blocks fields (Phase 4)\n      if (this.expandedFieldId) {\n        const field = this.fields.find((f) => f.id === this.expandedFieldId);\n        if (field && normalizeFieldType(field.type) === 'blocks') {\n          this.loadBlocksForField(field);\n        }\n      }\n      return;\n    }\n  }\n\n  private handleInput(e: Event): void {\n    const target = e.target as HTMLElement;\n\n    // Field property text input\n    const propEl = target.closest<HTMLInputElement>('[data-field-prop]');\n    if (propEl) {\n      const fieldId = propEl.dataset.fieldProp!;\n      const propKey = propEl.dataset.propKey!;\n      this.updateFieldProp(fieldId, propKey, propEl.value);\n      return;\n    }\n  }\n\n  private handleChange(e: Event, _root: HTMLElement): void {\n    const target = e.target as HTMLElement;\n\n    // Field checkbox change\n    const checkEl = target.closest<HTMLInputElement>('[data-field-check]');\n    if (checkEl) {\n      const fieldId = checkEl.dataset.fieldCheck!;\n      const propKey = checkEl.dataset.checkKey!;\n      this.updateFieldProp(fieldId, propKey, checkEl.checked);\n      return;\n    }\n  }\n\n  // ===========================================================================\n  // Data mutations\n  // ===========================================================================\n\n  private handleMetadataChange(key: string, value: string): void {\n    // Route status changes through the dedicated lifecycle handler (Phase 11 — Task 11.3)\n    if (key === 'status' && this.config.onStatusChange) {\n      this.config.onStatusChange(this.block.id, value as BlockDefinitionStatus);\n      return;\n    }\n\n    const patch: Partial<BlockDefinition> = {};\n    const self = this.block as unknown as Record<string, unknown>;\n    switch (key) {\n      case 'name':\n        patch.name = value;\n        self.name = value;\n        break;\n      case 'slug': {\n        const prevSlug = (this.block.slug || this.block.type || '').toString();\n        patch.slug = value;\n        self.slug = value;\n        if (!self.type || self.type === prevSlug) {\n          patch.type = value;\n          self.type = value;\n        }\n        break;\n      }\n      case 'description':\n        patch.description = value;\n        self.description = value;\n        break;\n      case 'category':\n        patch.category = value;\n        self.category = value;\n        break;\n      case 'icon':\n        patch.icon = value;\n        self.icon = value;\n        break;\n      case 'status':\n        patch.status = value as BlockDefinition['status'];\n        self.status = value;\n        break;\n    }\n    this.config.onMetadataChange(this.block.id, patch);\n  }\n\n  private updateFieldProp(fieldId: string, propPath: string, value: string | boolean): void {\n    const field = this.fields.find((f) => f.id === fieldId);\n    if (!field) return;\n\n    const parts = propPath.split('.');\n    if (parts.length === 1) {\n      // Top-level field prop\n      const key = parts[0] as keyof FieldDefinition;\n      const rec = field as unknown as Record<string, unknown>;\n      if (typeof value === 'boolean') {\n        rec[key] = value;\n      } else if (key === 'gridSpan') {\n        rec[key] = value ? parseInt(value, 10) : undefined;\n      } else {\n        rec[key] = value || undefined;\n      }\n    } else if (parts[0] === 'config') {\n      // Nested config prop (e.g., config.minBlocks, config.maxBlocks)\n      if (!field.config) field.config = {};\n      const cKey = parts[1] as string;\n      const configRec = field.config as Record<string, unknown>;\n      if (typeof value === 'string') {\n        if (value === '') {\n          delete configRec[cKey];\n        } else if (['minBlocks', 'maxBlocks'].includes(cKey)) {\n          configRec[cKey] = parseInt(value, 10);\n        } else {\n          configRec[cKey] = value;\n        }\n      }\n      if (Object.keys(field.config).length === 0) {\n        field.config = undefined;\n      }\n    } else if (parts[0] === 'validation') {\n      // Nested validation prop\n      if (!field.validation) field.validation = {};\n      const vKey = parts[1] as string;\n      if (typeof value === 'string') {\n        if (value === '') {\n          delete (field.validation as Record<string, unknown>)[vKey];\n        } else if (['minLength', 'maxLength'].includes(vKey)) {\n          (field.validation as Record<string, unknown>)[vKey] = parseInt(value, 10);\n        } else if (['min', 'max'].includes(vKey)) {\n          (field.validation as Record<string, unknown>)[vKey] = parseFloat(value);\n        } else {\n          (field.validation as Record<string, unknown>)[vKey] = value;\n        }\n      }\n      // Clean up empty validation\n      if (Object.keys(field.validation).length === 0) {\n        field.validation = undefined;\n      }\n    }\n\n    this.notifySchemaChange();\n  }\n\n  /** Load blocks and render inline picker for a blocks field (Phase 4) */\n  private async loadBlocksForField(field: FieldDefinition): Promise<void> {\n    if (this.cachedBlocks) {\n      this.renderInlineBlockPickerForField(field);\n      return;\n    }\n    if (this.blocksLoading) return;\n    this.blocksLoading = true;\n    this.cachedBlocks = await loadAvailableBlocks(this.config.api);\n    this.blocksLoading = false;\n    // Only render if this field is still expanded\n    if (this.expandedFieldId === field.id) {\n      this.renderInlineBlockPickerForField(field);\n    }\n  }\n\n  /** Render and bind inline block picker into the DOM container */\n  private renderInlineBlockPickerForField(field: FieldDefinition): void {\n    const container = this.config.container.querySelector<HTMLElement>(\n      `[data-blocks-picker-container=\"${field.id}\"]`\n    );\n    if (!container || !this.cachedBlocks) return;\n\n    const config = (field.config ?? {}) as BlocksFieldConfig;\n    const mode = this.getBlocksPickerMode(field.id);\n    const isAllowed = mode === 'allowed';\n    const selected = normalizeBlockSelection(\n      new Set(isAllowed ? (config.allowedBlocks ?? []) : (config.deniedBlocks ?? [])),\n      this.cachedBlocks,\n    );\n    const pickerLabel = isAllowed ? 'Allowed Blocks' : 'Denied Blocks';\n    const pickerAccent = isAllowed ? 'blue' : 'red';\n    const emptySelectionText = isAllowed ? 'All blocks allowed (no restrictions)' : 'No blocks denied';\n\n    container.innerHTML = renderInlineBlockPicker({\n      availableBlocks: this.cachedBlocks,\n      selectedBlocks: selected,\n      onSelectionChange: (sel) => {\n        if (!field.config) field.config = {};\n        const cfgRec = field.config as Record<string, unknown>;\n        if (isAllowed) {\n          if (sel.size > 0) {\n            cfgRec.allowedBlocks = Array.from(sel);\n          } else {\n            delete cfgRec.allowedBlocks;\n          }\n        } else {\n          if (sel.size > 0) {\n            cfgRec.deniedBlocks = Array.from(sel);\n          } else {\n            delete cfgRec.deniedBlocks;\n          }\n        }\n        if (Object.keys(field.config).length === 0) field.config = undefined;\n        this.notifySchemaChange();\n      },\n      label: pickerLabel,\n      accent: pickerAccent,\n      emptySelectionText,\n    });\n\n    bindInlineBlockPickerEvents(container, {\n      availableBlocks: this.cachedBlocks,\n      selectedBlocks: selected,\n      onSelectionChange: (sel) => {\n        if (!field.config) field.config = {};\n        const cfgRec = field.config as Record<string, unknown>;\n        if (isAllowed) {\n          if (sel.size > 0) {\n            cfgRec.allowedBlocks = Array.from(sel);\n          } else {\n            delete cfgRec.allowedBlocks;\n          }\n        } else {\n          if (sel.size > 0) {\n            cfgRec.deniedBlocks = Array.from(sel);\n          } else {\n            delete cfgRec.deniedBlocks;\n          }\n        }\n        if (Object.keys(field.config).length === 0) field.config = undefined;\n        this.notifySchemaChange();\n      },\n      label: pickerLabel,\n      accent: pickerAccent,\n      emptySelectionText,\n    });\n  }\n\n  private openFieldConfigModal(field: FieldDefinition): void {\n    const configForm = new FieldConfigForm({\n      field,\n      existingFieldNames: this.fields.filter((f) => f.id !== field.id).map((f) => f.name),\n      apiBasePath: this.config.api.getBasePath(),\n      onSave: (updatedField) => {\n        const index = this.fields.findIndex((f) => f.id === field.id);\n        if (index !== -1) {\n          this.fields[index] = updatedField;\n          this.notifySchemaChange();\n          this.render();\n        }\n      },\n      onCancel: () => {},\n    });\n    configForm.show();\n  }\n\n  private moveFieldToSection(fieldId: string, targetSection: string): void {\n    const field = this.fields.find((f) => f.id === fieldId);\n    if (!field) return;\n\n    field.section = targetSection === DEFAULT_SECTION ? undefined : targetSection;\n    this.moveMenuFieldId = null;\n    this.notifySchemaChange();\n    this.render();\n  }\n\n  // ===========================================================================\n  // Field Reorder (Phase 10 — Task 10.1 drag, Task 10.2 keyboard)\n  // ===========================================================================\n\n  /** Move a field up (-1) or down (+1) within its section */\n  private moveFieldInSection(fieldId: string, direction: -1 | 1): void {\n    const field = this.fields.find((f) => f.id === fieldId);\n    if (!field) return;\n\n    const sectionName = field.section || DEFAULT_SECTION;\n    const sectionFields = this.fields.filter((f) => (f.section || DEFAULT_SECTION) === sectionName);\n    const indexInSection = sectionFields.findIndex((f) => f.id === fieldId);\n    const newIndex = indexInSection + direction;\n\n    if (newIndex < 0 || newIndex >= sectionFields.length) return;\n\n    // Swap in the master fields array\n    const globalA = this.fields.indexOf(sectionFields[indexInSection]);\n    const globalB = this.fields.indexOf(sectionFields[newIndex]);\n    [this.fields[globalA], this.fields[globalB]] = [this.fields[globalB], this.fields[globalA]];\n\n    this.notifySchemaChange();\n    this.render();\n  }\n\n  /** Reorder a field by moving it before a target field in the same section */\n  private reorderFieldBefore(draggedId: string, targetId: string): void {\n    if (draggedId === targetId) return;\n\n    const dragged = this.fields.find((f) => f.id === draggedId);\n    const target = this.fields.find((f) => f.id === targetId);\n    if (!dragged || !target) return;\n\n    // Only reorder within the same section\n    const dragSection = dragged.section || DEFAULT_SECTION;\n    const targetSection = target.section || DEFAULT_SECTION;\n    if (dragSection !== targetSection) return;\n\n    // Remove dragged from array\n    const fromIndex = this.fields.indexOf(dragged);\n    this.fields.splice(fromIndex, 1);\n\n    // Insert before target\n    const toIndex = this.fields.indexOf(target);\n    this.fields.splice(toIndex, 0, dragged);\n\n    this.notifySchemaChange();\n    this.render();\n  }\n\n  /** Bind drag events on [data-field-card] for intra-section reordering */\n  private bindFieldReorderEvents(root: HTMLElement): void {\n    const cards = root.querySelectorAll<HTMLElement>('[data-field-card]');\n\n    cards.forEach((card) => {\n      const fieldId = card.dataset.fieldCard!;\n      const sectionName = card.dataset.fieldSection!;\n\n      // Track whether the mousedown was on the grip so we can gate dragstart\n      let gripEngaged = false;\n      card.addEventListener('mousedown', (e) => {\n        gripEngaged = !!(e.target as HTMLElement).closest('[data-field-grip]');\n      });\n\n      card.addEventListener('dragstart', (e) => {\n        if (!gripEngaged) {\n          e.preventDefault();\n          return;\n        }\n        this.dragReorder = { fieldId, sectionName };\n        e.dataTransfer!.effectAllowed = 'move';\n        e.dataTransfer!.setData(FIELD_REORDER_MIME, fieldId);\n        card.classList.add('opacity-50');\n      });\n\n      card.addEventListener('dragend', () => {\n        this.dragReorder = null;\n        this.dropTargetFieldId = null;\n        card.classList.remove('opacity-50');\n        // Clean up any lingering indicators\n        root.querySelectorAll('[data-field-card]').forEach((c) => {\n          c.classList.remove('border-t-2', 'border-t-blue-400');\n        });\n      });\n\n      card.addEventListener('dragover', (e) => {\n        // Only allow reorder within same section\n        if (!this.dragReorder) return;\n        if (this.dragReorder.sectionName !== sectionName) return;\n        if (this.dragReorder.fieldId === fieldId) return;\n\n        e.preventDefault();\n        e.dataTransfer!.dropEffect = 'move';\n\n        // Show drop indicator\n        if (this.dropTargetFieldId !== fieldId) {\n          // Clear previous indicator\n          root.querySelectorAll('[data-field-card]').forEach((c) => {\n            c.classList.remove('border-t-2', 'border-t-blue-400');\n          });\n          card.classList.add('border-t-2', 'border-t-blue-400');\n          this.dropTargetFieldId = fieldId;\n        }\n      });\n\n      card.addEventListener('dragleave', () => {\n        if (this.dropTargetFieldId === fieldId) {\n          card.classList.remove('border-t-2', 'border-t-blue-400');\n          this.dropTargetFieldId = null;\n        }\n      });\n\n      card.addEventListener('drop', (e) => {\n        e.preventDefault();\n        const draggedId = e.dataTransfer?.getData(FIELD_REORDER_MIME);\n        card.classList.remove('border-t-2', 'border-t-blue-400');\n        this.dropTargetFieldId = null;\n        this.dragReorder = null;\n\n        if (draggedId && draggedId !== fieldId) {\n          this.reorderFieldBefore(draggedId, fieldId);\n        }\n      });\n    });\n  }\n\n  /** Bind section-select dropdown changes (Phase 10 — Task 10.3) */\n  private bindSectionSelectEvents(root: HTMLElement): void {\n    root.querySelectorAll<HTMLSelectElement>('[data-field-section-select]').forEach((select) => {\n      select.addEventListener('change', () => {\n        const fieldId = select.dataset.fieldSectionSelect!;\n        const targetSection = select.value;\n\n        if (targetSection === '__new__') {\n          const field = this.fields.find((f) => f.id === fieldId);\n          const previousSection = field?.section || DEFAULT_SECTION;\n          const modal = new TextPromptModal({\n            title: 'Create New Section',\n            label: 'Section name',\n            placeholder: 'e.g. sidebar',\n            confirmLabel: 'Create',\n            inputClass: inputClasses(),\n            onConfirm: (value) => {\n              const section = value.trim().toLowerCase().replace(/\\s+/g, '_');\n              if (section) {\n                this.moveFieldToSection(fieldId, section);\n              }\n            },\n            onCancel: () => {\n              select.value = previousSection;\n            },\n          });\n          modal.show();\n          return;\n        }\n\n        this.moveFieldToSection(fieldId, targetSection);\n      });\n    });\n  }\n\n  private notifySchemaChange(): void {\n    this.config.onSchemaChange(this.block.id, [...this.fields]);\n  }\n}\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction esc(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction titleCase(str: string): string {\n  return str\n    .replace(/_/g, ' ')\n    .replace(/\\b\\w/g, (c) => c.toUpperCase());\n}\n","/**\n * Block Library IDE\n *\n * Full-page Block Library IDE controller for the three-column layout.\n * Phase 7: Block List Panel (left column)\n * Phase 8: Block Editor Panel (center column) — metadata, field cards, sections\n */\n\nimport type {\n  BlockDefinition,\n  BlockDefinitionStatus,\n  BlockDefinitionsDiagnostics,\n  FieldDefinition,\n  FieldTypeMetadata,\n} from './types';\nimport { ContentTypeAPIClient, ContentTypeAPIError, fieldsToBlockSchema, generateFieldId } from './api-client';\nimport { BlockEditorPanel } from './block-editor-panel';\nimport { FieldPalettePanel } from './field-palette-panel';\nimport { ConfirmModal, TextPromptModal } from '../shared/modal';\nimport { inputClasses, selectClasses } from './shared/field-input-classes';\nimport { resolveIcon } from './shared/icon-picker';\nimport { resolveApiBasePath } from './shared/api-paths';\n\n// =============================================================================\n// Types\n// =============================================================================\n\ninterface BlockLibraryIDEState {\n  blocks: BlockDefinition[];\n  selectedBlockId: string | null;\n  isLoading: boolean;\n  error: string | null;\n  search: string;\n  categoryFilter: string | null;\n  categories: string[];\n  isCreating: boolean;\n  renamingBlockId: string | null;\n  dirtyBlocks: Set<string>;\n  savingBlocks: Set<string>;\n  saveErrors: Map<string, string>;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nconst DEFAULT_BLOCK_CATEGORIES = ['content', 'media', 'layout', 'interactive', 'custom'];\nconst DEFAULT_ENVIRONMENT_KEY = 'default';\n\n// =============================================================================\n// Block Library IDE\n// =============================================================================\n\nexport class BlockLibraryIDE {\n  private root: HTMLElement;\n  private api: ContentTypeAPIClient;\n  private state: BlockLibraryIDEState;\n\n  // DOM references\n  private listEl: HTMLElement | null = null;\n  private searchInput: HTMLInputElement | null = null;\n  private categorySelect: HTMLSelectElement | null = null;\n  private countEl: HTMLElement | null = null;\n  private createBtn: HTMLElement | null = null;\n  private editorEl: HTMLElement | null = null;\n  private paletteEl: HTMLElement | null = null;\n\n  // Active context menu cleanup\n  private activeMenu: (() => void) | null = null;\n\n  // Editor panel (Phase 8)\n  private editorPanel: BlockEditorPanel | null = null;\n\n  // Field palette panel (Phase 9)\n  private palettePanel: FieldPalettePanel | null = null;\n\n  // Autosave system (Phase 11)\n  private autosaveTimers: Map<string, ReturnType<typeof setTimeout>> = new Map();\n  private static readonly AUTOSAVE_DELAY = 1500;\n  private boundVisibilityChange: (() => void) | null = null;\n  private boundBeforeUnload: ((e: BeforeUnloadEvent) => void) | null = null;\n\n  // Responsive layout (Phase 12 — Task 12.1)\n  private sidebarEl: HTMLElement | null = null;\n  private paletteAsideEl: HTMLElement | null = null;\n  private sidebarToggleBtn: HTMLElement | null = null;\n  private gridEl: HTMLElement | null = null;\n  private addFieldBar: HTMLElement | null = null;\n  private paletteTriggerBtn: HTMLElement | null = null;\n  private sidebarCollapsed: boolean = false;\n  private mediaQueryLg: MediaQueryList | null = null;\n  private popoverPalettePanel: FieldPalettePanel | null = null;\n\n  // Environment (Phase 12 — Tasks 12.2 + 12.3)\n  private envSelectEl: HTMLSelectElement | null = null;\n  private envResetBtn: HTMLButtonElement | null = null;\n  private envAddBtn: HTMLButtonElement | null = null;\n  private backToContentTypesLink: HTMLAnchorElement | null = null;\n  private currentEnvironment: string = DEFAULT_ENVIRONMENT_KEY;\n  private availableEnvironments: string[] = [DEFAULT_ENVIRONMENT_KEY];\n  private envDiagnostics: BlockDefinitionsDiagnostics | null = null;\n\n  constructor(root: HTMLElement) {\n    const apiBasePath = resolveApiBasePath(root.dataset.apiBasePath, root.dataset.basePath);\n    this.root = root;\n    this.api = new ContentTypeAPIClient({ basePath: apiBasePath });\n    this.state = {\n      blocks: [],\n      selectedBlockId: null,\n      isLoading: false,\n      error: null,\n      search: '',\n      categoryFilter: null,\n      categories: [],\n      isCreating: false,\n      renamingBlockId: null,\n      dirtyBlocks: new Set(),\n      savingBlocks: new Set(),\n      saveErrors: new Map(),\n    };\n  }\n\n  async init(): Promise<void> {\n    this.bindDOM();\n    this.bindEvents();\n    this.initPalette();\n    this.bindAutosaveListeners();\n    this.bindResponsive();\n    this.initEnvironment();\n    await Promise.all([this.loadBlocks(), this.loadCategories()]);\n  }\n\n  /** Initialize the field palette panel (Phase 9) */\n  private initPalette(): void {\n    if (!this.paletteEl) return;\n    this.palettePanel = new FieldPalettePanel({\n      container: this.paletteEl,\n      api: this.api,\n      onAddField: (meta) => this.handlePaletteAddField(meta),\n    });\n    this.palettePanel.init();\n  }\n\n  // ===========================================================================\n  // Autosave system (Phase 11 — Task 11.1)\n  // ===========================================================================\n\n  /** Set up global listeners for autosave: Ctrl+S, visibility change, beforeunload */\n  private bindAutosaveListeners(): void {\n    // Ctrl+S / Cmd+S manual save\n    this.root.addEventListener('keydown', (e) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n        e.preventDefault();\n        this.saveCurrentBlock();\n      }\n    });\n\n    // Save on page visibility change (tab switch, minimize)\n    this.boundVisibilityChange = () => {\n      if (document.hidden) {\n        this.saveAllDirty();\n      }\n    };\n    document.addEventListener('visibilitychange', this.boundVisibilityChange);\n\n    // Warn before leaving with unsaved changes\n    this.boundBeforeUnload = (e: BeforeUnloadEvent) => {\n      if (this.state.dirtyBlocks.size > 0) {\n        e.preventDefault();\n        e.returnValue = '';\n      }\n    };\n    window.addEventListener('beforeunload', this.boundBeforeUnload);\n  }\n\n  /** Persist a dirty block to the backend */\n  async saveBlock(blockId: string): Promise<boolean> {\n    if (!this.state.dirtyBlocks.has(blockId)) return true;\n\n    const block = this.state.blocks.find((b) => b.id === blockId);\n    if (!block) return false;\n\n    this.cancelScheduledSave(blockId);\n    this.markSaving(blockId);\n    this.notifySaveState(blockId, 'saving');\n\n    try {\n      const updated = await this.api.updateBlockDefinition(blockId, {\n        name: block.name,\n        slug: block.slug,\n        type: block.type,\n        description: block.description,\n        category: block.category,\n        icon: block.icon,\n        schema: block.schema,\n        ui_schema: block.ui_schema,\n      });\n      this.updateBlockInState(blockId, updated);\n      this.markClean(blockId);\n      this.notifySaveState(blockId, 'saved');\n      return true;\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : 'Save failed';\n      this.markSaveError(blockId, msg);\n      this.notifySaveState(blockId, 'error', msg);\n      return false;\n    }\n  }\n\n  /** Schedule an autosave after the debounce delay */\n  private scheduleSave(blockId: string): void {\n    this.cancelScheduledSave(blockId);\n    const timer = setTimeout(() => {\n      this.autosaveTimers.delete(blockId);\n      this.saveBlock(blockId);\n    }, BlockLibraryIDE.AUTOSAVE_DELAY);\n    this.autosaveTimers.set(blockId, timer);\n  }\n\n  /** Cancel a pending autosave for a block */\n  private cancelScheduledSave(blockId: string): void {\n    const timer = this.autosaveTimers.get(blockId);\n    if (timer) {\n      clearTimeout(timer);\n      this.autosaveTimers.delete(blockId);\n    }\n  }\n\n  /** Save the currently selected block immediately */\n  private async saveCurrentBlock(): Promise<void> {\n    if (!this.state.selectedBlockId) return;\n    await this.saveBlock(this.state.selectedBlockId);\n  }\n\n  /** Save all dirty blocks (used on visibility change) */\n  private async saveAllDirty(): Promise<void> {\n    const dirtyIds = [...this.state.dirtyBlocks];\n    await Promise.all(dirtyIds.map((id) => this.saveBlock(id)));\n  }\n\n  /** Notify the editor panel of a save state change */\n  private notifySaveState(blockId: string, state: 'saving' | 'saved' | 'error', message?: string): void {\n    if (this.editorPanel && this.state.selectedBlockId === blockId) {\n      this.editorPanel.updateSaveState(state, message);\n    }\n  }\n\n  // ===========================================================================\n  // Status lifecycle (Phase 11 — Task 11.3)\n  // ===========================================================================\n\n  /** Handle status changes from the editor dropdown (publish/deprecate flow) */\n  private async handleEditorStatusChange(blockId: string, newStatus: BlockDefinitionStatus): Promise<void> {\n    const block = this.state.blocks.find((b) => b.id === blockId);\n    if (!block) return;\n\n    const oldStatus = block.status;\n    if (oldStatus === newStatus) return;\n\n    // Save any pending changes first\n    if (this.state.dirtyBlocks.has(blockId)) {\n      const saved = await this.saveBlock(blockId);\n      if (!saved) {\n        this.showToast('Please fix save errors before changing status.', 'error');\n        this.editorPanel?.revertStatus(oldStatus);\n        return;\n      }\n    }\n\n    // Call the appropriate lifecycle API\n    try {\n      let updated: BlockDefinition;\n      if (newStatus === 'active') {\n        updated = await this.api.publishBlockDefinition(blockId);\n        this.showToast('Block published.', 'success');\n      } else if (newStatus === 'deprecated') {\n        updated = await this.api.deprecateBlockDefinition(blockId);\n        this.showToast('Block deprecated.', 'info');\n      } else {\n        // Revert to draft via regular update\n        updated = await this.api.updateBlockDefinition(blockId, { status: 'draft' });\n        this.showToast('Block reverted to draft.', 'info');\n      }\n      this.updateBlockInState(blockId, updated);\n      this.renderBlockList();\n      // Refresh editor to reflect new status\n      if (this.editorPanel && this.state.selectedBlockId === blockId) {\n        const refreshed = this.state.blocks.find((b) => b.id === blockId);\n        if (refreshed) this.editorPanel.update(refreshed);\n      }\n    } catch (err) {\n      const fallbackMessage =\n        newStatus === 'active' ? 'Block published.' : newStatus === 'deprecated' ? 'Block deprecated.' : 'Block reverted to draft.';\n      if (err instanceof ContentTypeAPIError && [404, 405, 501].includes(err.status)) {\n        try {\n          const updated = await this.api.updateBlockDefinition(blockId, { status: newStatus });\n          this.updateBlockInState(blockId, updated);\n          this.renderBlockList();\n          if (this.editorPanel && this.state.selectedBlockId === blockId) {\n            const refreshed = this.state.blocks.find((b) => b.id === blockId);\n            if (refreshed) this.editorPanel.update(refreshed);\n          }\n          this.showToast(fallbackMessage, newStatus === 'active' ? 'success' : 'info');\n          return;\n        } catch (fallbackErr) {\n          console.error('Status change fallback failed:', fallbackErr);\n        }\n      }\n      const msg = err instanceof Error ? err.message : 'Status change failed';\n      console.error('Status change failed:', err);\n      this.showToast(msg, 'error');\n      this.editorPanel?.revertStatus(oldStatus);\n    }\n  }\n\n  // ===========================================================================\n  // Responsive layout (Phase 12 — Task 12.1)\n  // ===========================================================================\n\n  /** Set up media query listeners and responsive behaviors */\n  private bindResponsive(): void {\n    // Sidebar toggle\n    this.sidebarToggleBtn?.addEventListener('click', () => this.toggleSidebar());\n\n    // Palette popover trigger (visible on < lg screens)\n    this.paletteTriggerBtn?.addEventListener('click', () => {\n      if (this.paletteTriggerBtn) {\n        this.openPalettePopover(this.paletteTriggerBtn);\n      }\n    });\n\n    // Media query for lg breakpoint — auto-close popover when returning to desktop\n    this.mediaQueryLg = window.matchMedia('(min-width: 1024px)');\n    this.mediaQueryLg.addEventListener('change', () => this.handleBreakpointChange());\n  }\n\n  /** React to viewport breakpoint changes */\n  private handleBreakpointChange(): void {\n    const isLg = this.mediaQueryLg?.matches ?? true;\n    if (isLg) {\n      this.closePalettePopover();\n    }\n  }\n\n  /** Toggle the left sidebar collapsed state */\n  private toggleSidebar(): void {\n    this.sidebarCollapsed = !this.sidebarCollapsed;\n\n    if (this.sidebarEl) {\n      this.sidebarEl.classList.toggle('hidden', this.sidebarCollapsed);\n    }\n\n    if (this.gridEl) {\n      if (this.sidebarCollapsed) {\n        this.gridEl.classList.remove('md:grid-cols-[240px,1fr]', 'lg:grid-cols-[240px,1fr,260px]');\n        this.gridEl.classList.add('md:grid-cols-[1fr]', 'lg:grid-cols-[1fr,260px]');\n      } else {\n        this.gridEl.classList.remove('md:grid-cols-[1fr]', 'lg:grid-cols-[1fr,260px]');\n        this.gridEl.classList.add('md:grid-cols-[240px,1fr]', 'lg:grid-cols-[240px,1fr,260px]');\n      }\n    }\n\n    if (this.sidebarToggleBtn) {\n      this.sidebarToggleBtn.setAttribute('title', this.sidebarCollapsed ? 'Show sidebar' : 'Hide sidebar');\n    }\n  }\n\n  /** Open the field palette as a popover overlay (< lg screens) */\n  private openPalettePopover(anchor: HTMLElement): void {\n    this.closePalettePopover();\n\n    // Backdrop\n    const backdrop = document.createElement('div');\n    backdrop.className = 'fixed inset-0 z-40';\n    backdrop.dataset.paletteBackdrop = '';\n    backdrop.addEventListener('click', () => this.closePalettePopover());\n\n    // Popover container\n    const popover = document.createElement('div');\n    popover.className = 'fixed z-50 w-72 max-h-[60vh] bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl flex flex-col overflow-hidden';\n    popover.dataset.palettePopover = '';\n\n    popover.innerHTML = `\n      <div class=\"px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between shrink-0\">\n        <h3 class=\"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Add Field</h3>\n        <button type=\"button\" data-palette-popover-close\n                class=\"p-1 rounded-lg text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\">\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n      </div>\n      <div class=\"flex-1 overflow-y-auto\" data-palette-popover-content></div>\n    `;\n\n    popover.querySelector('[data-palette-popover-close]')?.addEventListener('click', () => this.closePalettePopover());\n\n    // Position near anchor\n    const rect = anchor.getBoundingClientRect();\n    const popoverWidth = 288;\n    let left = rect.left;\n    let top = rect.top - 8; // Above the button\n\n    // Ensure stays on screen\n    if (left + popoverWidth > window.innerWidth - 16) {\n      left = window.innerWidth - popoverWidth - 16;\n    }\n    if (left < 16) left = 16;\n\n    // Prefer showing above the button; if not enough space, show below\n    const estimatedHeight = Math.min(window.innerHeight * 0.6, 480);\n    if (top - estimatedHeight < 16) {\n      top = rect.bottom + 8;\n    } else {\n      top = top - estimatedHeight;\n    }\n\n    popover.style.top = `${top}px`;\n    popover.style.left = `${left}px`;\n\n    document.body.appendChild(backdrop);\n    document.body.appendChild(popover);\n\n    // Initialize a palette panel inside the popover\n    const content = popover.querySelector<HTMLElement>('[data-palette-popover-content]');\n    if (content) {\n      this.popoverPalettePanel = new FieldPalettePanel({\n        container: content,\n        api: this.api,\n        onAddField: (meta) => {\n          this.handlePaletteAddField(meta);\n          this.closePalettePopover();\n        },\n      });\n      this.popoverPalettePanel.init();\n      if (this.state.selectedBlockId) {\n        this.popoverPalettePanel.enable();\n      }\n    }\n  }\n\n  /** Close the palette popover if open */\n  private closePalettePopover(): void {\n    document.querySelector('[data-palette-backdrop]')?.remove();\n    document.querySelector('[data-palette-popover]')?.remove();\n    this.popoverPalettePanel = null;\n  }\n\n  /** Show or hide the \"Add Field\" bar based on whether a block is selected */\n  private updateAddFieldBar(): void {\n    if (this.addFieldBar) {\n      this.addFieldBar.classList.toggle('hidden', !this.state.selectedBlockId);\n    }\n  }\n\n  // ===========================================================================\n  // Environment management (Phase 12 — Tasks 12.2 + 12.3)\n  // ===========================================================================\n\n  /** Initialize environment from URL param and bind selector */\n  private initEnvironment(): void {\n    const envFromUrl = new URLSearchParams(window.location.search).get('env');\n    this.currentEnvironment = this.normalizeEnvironment(envFromUrl);\n    this.api.setEnvironment(this.currentEnvironment);\n\n    this.refreshEnvironmentOptions();\n    this.updateEnvironmentStatus();\n    this.updateBackLink();\n\n    this.envSelectEl?.addEventListener('change', () => {\n      const value = this.envSelectEl?.value ?? DEFAULT_ENVIRONMENT_KEY;\n      this.setEnvironment(value);\n    });\n\n    this.envResetBtn?.addEventListener('click', () => {\n      this.setEnvironment(DEFAULT_ENVIRONMENT_KEY);\n    });\n\n    this.envAddBtn?.addEventListener('click', () => {\n      this.promptForEnvironment();\n    });\n\n    this.api.setEnvironmentSession(this.currentEnvironment).catch(() => {\n      // Ignore session persistence errors\n    });\n  }\n\n  /** Change the active environment and reload data */\n  private async setEnvironment(env: string): Promise<void> {\n    const normalized = this.normalizeEnvironment(env);\n    this.currentEnvironment = normalized;\n    this.api.setEnvironment(normalized);\n    this.refreshEnvironmentOptions();\n    this.updateEnvironmentStatus();\n\n    // Persist to server session (best-effort)\n    try {\n      await this.api.setEnvironmentSession(normalized);\n    } catch {\n      // Ignore session persistence errors\n    }\n\n    // Update URL\n    this.updateUrlEnvironment(normalized);\n\n    // Reset state and reload\n    this.state.selectedBlockId = null;\n    this.state.dirtyBlocks.clear();\n    this.state.savingBlocks.clear();\n    this.state.saveErrors.clear();\n    this.editorPanel = null;\n    this.renderEditor();\n\n    await Promise.all([this.loadBlocks(), this.loadCategories()]);\n  }\n\n  /** Update the ?env= query parameter in the URL without a page reload */\n  private updateUrlEnvironment(env: string): void {\n    const url = new URL(window.location.href);\n    if (env && env !== DEFAULT_ENVIRONMENT_KEY) {\n      url.searchParams.set('env', env);\n    } else {\n      url.searchParams.delete('env');\n    }\n    window.history.replaceState({}, '', url.toString());\n  }\n\n  private promptForEnvironment(): void {\n    if (!this.envSelectEl) return;\n    const previous = this.currentEnvironment;\n    const modal = new TextPromptModal({\n      title: 'Add Environment',\n      label: 'Environment name',\n      placeholder: 'e.g. staging',\n      confirmLabel: 'Add',\n      inputClass: inputClasses(),\n      onConfirm: (value) => {\n        const raw = value.trim();\n        if (!raw) return;\n        const env = this.normalizeEnvironment(raw);\n        this.upsertEnvironmentOption(env);\n        this.envSelectEl!.value = env;\n        this.setEnvironment(env);\n      },\n      onCancel: () => {\n        this.envSelectEl!.value = previous;\n      },\n    });\n    modal.show();\n  }\n\n  private normalizeEnvironment(value: string | null | undefined): string {\n    const env = String(value ?? '').trim().toLowerCase();\n    return env || DEFAULT_ENVIRONMENT_KEY;\n  }\n\n  private refreshEnvironmentOptions(): void {\n    if (!this.envSelectEl) return;\n\n    const current = this.normalizeEnvironment(this.currentEnvironment);\n    const known = new Set<string>([DEFAULT_ENVIRONMENT_KEY]);\n    for (const env of this.availableEnvironments) {\n      known.add(this.normalizeEnvironment(env));\n    }\n    known.add(current);\n\n    const sorted = Array.from(known).sort((a, b) => {\n      if (a === DEFAULT_ENVIRONMENT_KEY) return -1;\n      if (b === DEFAULT_ENVIRONMENT_KEY) return 1;\n      return a.localeCompare(b);\n    });\n\n    this.envSelectEl.innerHTML = '';\n    for (const env of sorted) {\n      const option = document.createElement('option');\n      option.value = env;\n      option.textContent = this.environmentLabel(env);\n      this.envSelectEl.appendChild(option);\n    }\n    this.envSelectEl.value = current;\n  }\n\n  private environmentLabel(env: string): string {\n    const normalized = this.normalizeEnvironment(env);\n    return normalized === DEFAULT_ENVIRONMENT_KEY ? 'Default' : normalized;\n  }\n\n  private upsertEnvironmentOption(env: string): void {\n    const normalized = this.normalizeEnvironment(env);\n    if (!this.availableEnvironments.includes(normalized)) {\n      this.availableEnvironments.push(normalized);\n    }\n    this.refreshEnvironmentOptions();\n  }\n\n  private updateEnvironmentStatus(): void {\n    const env = this.normalizeEnvironment(this.currentEnvironment);\n    const isDefault = env === DEFAULT_ENVIRONMENT_KEY;\n\n    if (this.envResetBtn) {\n      this.envResetBtn.classList.toggle('hidden', isDefault);\n    }\n\n    this.updateBackLink();\n  }\n\n  private updateBackLink(): void {\n    if (!this.backToContentTypesLink) return;\n    const env = this.normalizeEnvironment(this.currentEnvironment);\n    const basePath = this.root.dataset.basePath || '';\n    const baseUrl = `${basePath}/content/types`;\n    if (env && env !== DEFAULT_ENVIRONMENT_KEY) {\n      this.backToContentTypesLink.href = `${baseUrl}?env=${encodeURIComponent(env)}`;\n    } else {\n      this.backToContentTypesLink.href = baseUrl;\n    }\n  }\n\n  // ===========================================================================\n  // Public API (for cross-panel communication in later phases)\n  // ===========================================================================\n\n  getSelectedBlock(): BlockDefinition | null {\n    if (!this.state.selectedBlockId) return null;\n    return this.state.blocks.find((b) => b.id === this.state.selectedBlockId) ?? null;\n  }\n\n  selectBlock(blockId: string | null): void {\n    // Save-on-blur: flush any pending autosave for the previous block (Phase 11)\n    const prevId = this.state.selectedBlockId;\n    if (prevId && prevId !== blockId && this.state.dirtyBlocks.has(prevId)) {\n      this.cancelScheduledSave(prevId);\n      this.saveBlock(prevId);\n    }\n\n    this.state.selectedBlockId = blockId;\n\n    // Reset save indicator when switching blocks\n    if (this.editorPanel && prevId !== blockId) {\n      this.editorPanel.updateSaveState('idle');\n    }\n\n    this.renderBlockList();\n    this.renderEditor();\n  }\n\n  markDirty(blockId: string): void {\n    this.state.dirtyBlocks.add(blockId);\n    this.updateBlockIndicator(blockId);\n  }\n\n  markClean(blockId: string): void {\n    this.state.dirtyBlocks.delete(blockId);\n    this.state.saveErrors.delete(blockId);\n    this.state.savingBlocks.delete(blockId);\n    this.updateBlockIndicator(blockId);\n  }\n\n  markSaving(blockId: string): void {\n    this.state.savingBlocks.add(blockId);\n    this.updateBlockIndicator(blockId);\n  }\n\n  markSaveError(blockId: string, error: string): void {\n    this.state.savingBlocks.delete(blockId);\n    this.state.saveErrors.set(blockId, error);\n    this.updateBlockIndicator(blockId);\n  }\n\n  async refreshBlocks(): Promise<void> {\n    await this.loadBlocks();\n  }\n\n  // ===========================================================================\n  // DOM Binding\n  // ===========================================================================\n\n  private bindDOM(): void {\n    this.listEl = this.root.querySelector('[data-block-ide-list]');\n    this.searchInput = this.root.querySelector('[data-block-ide-search]');\n    this.categorySelect = this.root.querySelector('[data-block-ide-category-filter]');\n    this.countEl = this.root.querySelector('[data-block-ide-count]');\n    this.createBtn = this.root.querySelector('[data-block-ide-create]');\n    this.editorEl = this.root.querySelector('[data-block-ide-editor]');\n    this.paletteEl = this.root.querySelector('[data-block-ide-palette]');\n    // Phase 12: responsive + environment elements\n    this.sidebarEl = this.root.querySelector('[data-block-ide-sidebar]');\n    this.paletteAsideEl = this.root.querySelector('[data-block-ide-palette-aside]');\n    this.gridEl = this.root.querySelector('[data-block-ide-grid]');\n    this.addFieldBar = this.root.querySelector('[data-block-ide-add-field-bar]');\n    this.paletteTriggerBtn = this.root.querySelector('[data-block-ide-palette-trigger]');\n    // Sidebar toggle and env selector may be outside root (in the header)\n    this.sidebarToggleBtn = document.querySelector('[data-block-ide-sidebar-toggle]');\n    this.envSelectEl = document.querySelector('[data-block-ide-env]');\n    this.envResetBtn = document.querySelector('[data-block-ide-env-reset]');\n    this.envAddBtn = document.querySelector('[data-block-ide-env-add]');\n    this.backToContentTypesLink = document.querySelector('[data-back-to-content-types]');\n  }\n\n  private bindEvents(): void {\n    // Search input\n    this.searchInput?.addEventListener('input', () => {\n      this.state.search = this.searchInput!.value;\n      this.renderBlockList();\n    });\n\n    // Category filter\n    this.categorySelect?.addEventListener('change', () => {\n      this.state.categoryFilter = this.categorySelect!.value || null;\n      this.renderBlockList();\n    });\n\n    // Create button\n    this.createBtn?.addEventListener('click', () => {\n      this.showCreateForm();\n    });\n\n    // Delegate clicks on block list\n    this.listEl?.addEventListener('click', (e) => {\n      this.handleListClick(e);\n    });\n\n    // Close context menu on outside click\n    document.addEventListener('click', (e) => {\n      if (this.activeMenu) {\n        const target = e.target as HTMLElement;\n        if (!target.closest('[data-block-context-menu]') && !target.closest('[data-block-actions]')) {\n          this.closeContextMenu();\n        }\n      }\n    });\n\n    // Keyboard: Escape cancels create/rename\n    this.root.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (this.state.isCreating) {\n          this.cancelCreate();\n        }\n        if (this.state.renamingBlockId) {\n          this.cancelRename();\n        }\n        this.closeContextMenu();\n      }\n    });\n  }\n\n  // ===========================================================================\n  // Data Loading\n  // ===========================================================================\n\n  private async loadBlocks(): Promise<void> {\n    this.state.isLoading = true;\n    this.state.error = null;\n    this.renderBlockList();\n\n    try {\n      const [response, diagnostics] = await Promise.all([\n        this.api.listBlockDefinitions(),\n        this.api.getBlockDefinitionDiagnostics(),\n      ]);\n      this.state.blocks = response.items.map((block) => this.normalizeBlockDefinition(block));\n      this.envDiagnostics = diagnostics;\n      if (diagnostics && Array.isArray(diagnostics.available_environments)) {\n        this.availableEnvironments = diagnostics.available_environments\n          .map((env) => this.normalizeEnvironment(env))\n          .filter((env, index, arr) => env && arr.indexOf(env) === index);\n      }\n      if (diagnostics?.effective_environment) {\n        const effective = this.normalizeEnvironment(diagnostics.effective_environment);\n        if (effective !== this.currentEnvironment) {\n          this.currentEnvironment = effective;\n          this.api.setEnvironment(effective);\n          this.updateUrlEnvironment(effective);\n        }\n      }\n      this.refreshEnvironmentOptions();\n      this.updateEnvironmentStatus();\n    } catch (err) {\n      this.state.blocks = [];\n      this.envDiagnostics = null;\n      this.availableEnvironments = [DEFAULT_ENVIRONMENT_KEY];\n      this.state.error = this.formatBlockLoadError(err);\n      this.refreshEnvironmentOptions();\n      this.updateEnvironmentStatus();\n    } finally {\n      this.state.isLoading = false;\n      this.refreshCategoriesFromBlocks();\n      this.renderBlockList();\n      this.updateCount();\n    }\n  }\n\n  private formatBlockLoadError(err: unknown): string {\n    if (err instanceof ContentTypeAPIError) {\n      if (err.status === 404) {\n        return `Block Library API route not found. Expected GET ${this.api.getBasePath()}/panels/block_definitions.`;\n      }\n      if (err.status === 403) {\n        return 'Access denied while loading block definitions. Check your admin permissions.';\n      }\n      if (err.message) {\n        return `Failed to load block definitions: ${err.message}`;\n      }\n      return `Failed to load block definitions (HTTP ${err.status}).`;\n    }\n    if (err instanceof Error && err.message) {\n      return `Failed to load block definitions: ${err.message}`;\n    }\n    return 'Failed to load block definitions.';\n  }\n\n  private async loadCategories(): Promise<void> {\n    this.state.categories = [];\n    this.mergeCategories(DEFAULT_BLOCK_CATEGORIES);\n    this.mergeCategories(this.loadUserCategories());\n    try {\n      const apiCategories = await this.api.getBlockCategories();\n      this.mergeCategories(apiCategories);\n    } catch {\n      // Categories will be derived from loaded blocks in refreshCategoriesFromBlocks\n    }\n    this.renderCategoryOptions();\n    this.updateCreateCategorySelect();\n  }\n\n  private refreshCategoriesFromBlocks(): void {\n    if (this.state.categories.length === 0) {\n      this.mergeCategories(DEFAULT_BLOCK_CATEGORIES);\n      this.mergeCategories(this.loadUserCategories());\n    }\n    const seen = new Set<string>(this.state.categories.map((cat) => this.normalizeCategory(cat)));\n    this.state.categories = Array.from(seen);\n    for (const block of this.state.blocks) {\n      const cat = this.normalizeCategory(block.category || '');\n      if (cat && !seen.has(cat)) {\n        seen.add(cat);\n        this.state.categories.push(cat);\n      }\n    }\n    this.renderCategoryOptions();\n    this.updateCreateCategorySelect();\n  }\n\n  private normalizeCategory(value: string): string {\n    return value.trim().toLowerCase();\n  }\n\n  private mergeCategories(categories: string[]): void {\n    for (const raw of categories) {\n      const cat = this.normalizeCategory(raw);\n      if (!cat) continue;\n      if (!this.state.categories.includes(cat)) {\n        this.state.categories.push(cat);\n      }\n    }\n  }\n\n  private loadUserCategories(): string[] {\n    try {\n      const raw = sessionStorage.getItem('block-library-user-categories');\n      if (!raw) return [];\n      const parsed = JSON.parse(raw) as string[];\n      if (!Array.isArray(parsed)) return [];\n      return parsed.map((cat) => this.normalizeCategory(cat)).filter((cat) => cat.length > 0);\n    } catch {\n      return [];\n    }\n  }\n\n  private persistUserCategories(): void {\n    const userCats = this.state.categories.filter((cat) => !DEFAULT_BLOCK_CATEGORIES.includes(cat));\n    try {\n      sessionStorage.setItem('block-library-user-categories', JSON.stringify(userCats));\n    } catch {\n      // Ignore storage errors\n    }\n  }\n\n  private addCategory(category: string): string | null {\n    const normalized = this.normalizeCategory(category);\n    if (!normalized) return null;\n    if (!this.state.categories.includes(normalized)) {\n      this.state.categories.push(normalized);\n      this.persistUserCategories();\n      this.renderCategoryOptions();\n      this.updateCreateCategorySelect(normalized);\n      this.renderEditor();\n    }\n    return normalized;\n  }\n\n  private updateCreateCategorySelect(selected?: string): void {\n    const select = this.listEl?.querySelector<HTMLSelectElement>('[data-create-category]');\n    if (!select) return;\n    const current = selected ?? select.value;\n    select.innerHTML = this.state.categories\n      .map((c) => `<option value=\"${esc(c)}\">${esc(titleCase(c))}</option>`)\n      .join('');\n    select.innerHTML += '<option value=\"__add__\">Add category...</option>';\n    if (current && this.state.categories.includes(current)) {\n      select.value = current;\n    }\n  }\n\n  private promptForCategory(select: HTMLSelectElement, previousValue: string): void {\n    const modal = new TextPromptModal({\n      title: 'Add Category',\n      label: 'Category name',\n      placeholder: 'e.g. marketing',\n      confirmLabel: 'Add',\n      inputClass: inputClasses(),\n      onConfirm: (value) => {\n        const added = this.addCategory(value);\n        if (added) {\n          this.updateCreateCategorySelect(added);\n          select.value = added;\n          select.dataset.prevValue = added;\n          return;\n        }\n        select.value = previousValue;\n      },\n      onCancel: () => {\n        select.value = previousValue;\n      },\n    });\n    modal.show();\n  }\n\n  // ===========================================================================\n  // Rendering\n  // ===========================================================================\n\n  private renderBlockList(): void {\n    if (!this.listEl) return;\n\n    if (this.state.isLoading) {\n      this.listEl.innerHTML = `\n        <div class=\"flex items-center justify-center py-12\">\n          <div class=\"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n        </div>`;\n      return;\n    }\n\n    if (this.state.error) {\n      this.listEl.innerHTML = `\n        <div class=\"mx-4 my-6 rounded-md border border-red-200 bg-red-50 px-3 py-3 dark:border-red-800/70 dark:bg-red-900/20\">\n          <div class=\"flex items-start gap-2\">\n            <svg class=\"mt-0.5 h-4 w-4 flex-shrink-0 text-red-500 dark:text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n            </svg>\n            <p class=\"text-xs text-red-700 dark:text-red-300\">${esc(this.state.error)}</p>\n          </div>\n          <button type=\"button\" data-block-ide-retry\n                  class=\"mt-2 ml-6 text-xs font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\">\n            Retry\n          </button>\n        </div>`;\n      return;\n    }\n\n    const filtered = this.getFilteredBlocks();\n\n    if (filtered.length === 0) {\n      const hasFilters = this.state.search || this.state.categoryFilter;\n      const activeEnvironment = this.normalizeEnvironment(this.currentEnvironment);\n      const inDefault = activeEnvironment === DEFAULT_ENVIRONMENT_KEY;\n      const diagnosticHint = !hasFilters\n        ? inDefault\n          ? `No block definitions were found in the \"${DEFAULT_ENVIRONMENT_KEY}\" environment.`\n          : `No block definitions were found in environment \"${activeEnvironment}\".`\n        : '';\n      const resetHint =\n        !hasFilters && !inDefault\n          ? `<button type=\"button\"\n                 data-block-ide-empty-reset-env\n                 class=\"mt-2 inline-flex items-center gap-1 rounded border border-amber-300 bg-amber-50 px-2.5 py-1 text-[11px] font-semibold text-amber-700 hover:bg-amber-100 transition-colors\">\n               Reset to Default Environment\n             </button>`\n          : '';\n      const totalsHint =\n        !hasFilters && this.envDiagnostics\n          ? `<p class=\"text-[11px] text-gray-400 dark:text-gray-500 mt-1\">Visible in active env: ${this.envDiagnostics.total_effective}. Default env total: ${this.envDiagnostics.total_default}.</p>`\n          : '';\n      this.listEl.innerHTML = `\n        <div class=\"px-4 py-8 text-center\">\n          <svg class=\"w-10 h-10 mx-auto text-gray-300 dark:text-gray-600 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\"\n                  d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2z\"></path>\n          </svg>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">${hasFilters ? 'No blocks match your filters.' : 'No blocks yet.'}</p>\n          ${!hasFilters ? '<p class=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">Click \"New Block\" to create your first block definition.</p>' : ''}\n          ${diagnosticHint ? `<p class=\"text-[11px] text-gray-400 dark:text-gray-500 mt-2\">${esc(diagnosticHint)}</p>` : ''}\n          ${totalsHint}\n          ${resetHint}\n        </div>`;\n      return;\n    }\n\n    // Render create form at top if active\n    let html = '';\n    if (this.state.isCreating) {\n      html += this.renderCreateForm();\n    }\n\n    html += '<ul class=\"p-2 space-y-0.5\">';\n    for (const block of filtered) {\n      html += this.renderBlockItem(block);\n    }\n    html += '</ul>';\n\n    this.listEl.innerHTML = html;\n\n    // Focus create form name input if just opened + auto-slug generation\n    if (this.state.isCreating) {\n      const nameInput = this.listEl.querySelector<HTMLInputElement>('[data-create-name]');\n      const slugInput = this.listEl.querySelector<HTMLInputElement>('[data-create-slug]');\n      const categorySelect = this.listEl.querySelector<HTMLSelectElement>('[data-create-category]');\n      nameInput?.focus();\n      if (nameInput && slugInput) {\n        nameInput.addEventListener('input', () => {\n          if (!slugInput.dataset.userModified) {\n            slugInput.value = nameToSlug(nameInput.value);\n          }\n        });\n        slugInput.addEventListener('input', () => {\n          slugInput.dataset.userModified = 'true';\n        });\n      }\n      if (categorySelect) {\n        categorySelect.dataset.prevValue = categorySelect.value;\n        categorySelect.addEventListener('change', () => {\n          const value = categorySelect.value;\n          if (value === '__add__') {\n            const previous = categorySelect.dataset.prevValue ?? '';\n            this.promptForCategory(categorySelect, previous);\n            return;\n          }\n          categorySelect.dataset.prevValue = value;\n        });\n      }\n    }\n\n    // Focus rename input if renaming\n    if (this.state.renamingBlockId) {\n      const renameInput = this.listEl.querySelector<HTMLInputElement>('[data-rename-input]');\n      renameInput?.focus();\n      renameInput?.select();\n    }\n  }\n\n  private renderBlockItem(block: BlockDefinition): string {\n    const isSelected = block.id === this.state.selectedBlockId;\n    const isRenaming = block.id === this.state.renamingBlockId;\n    const isDirty = this.state.dirtyBlocks.has(block.id);\n    const isSaving = this.state.savingBlocks.has(block.id);\n    const saveError = this.state.saveErrors.get(block.id);\n    const slugOrType = block.slug || block.type || '';\n\n    const selectedClass = isSelected\n      ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 text-blue-800 dark:text-blue-200'\n      : 'hover:bg-gray-50 dark:hover:bg-gray-800 border-transparent';\n\n    const nameHtml = isRenaming\n      ? `<input type=\"text\" data-rename-input data-rename-block-id=\"${esc(block.id)}\"\n               value=\"${esc(block.name)}\"\n               class=\"block w-full text-[13px] font-medium text-gray-800 dark:text-gray-100 bg-white dark:bg-slate-800 border border-blue-400 rounded px-1.5 py-0.5 focus:outline-none focus:ring-1 focus:ring-blue-500\" />`\n      : `<span class=\"block font-medium text-gray-800 dark:text-gray-100 truncate text-[13px]\">${esc(block.name || 'Untitled')}</span>`;\n\n    // Unsaved indicator (Task 7.4)\n    let indicatorHtml = '';\n    if (saveError) {\n      indicatorHtml = `<span class=\"flex-shrink-0 w-1.5 h-1.5 rounded-full bg-red-500\" title=\"Save failed: ${esc(saveError)}\"></span>`;\n    } else if (isSaving) {\n      indicatorHtml = `<span class=\"flex-shrink-0 w-2 h-2 rounded-full border border-blue-400 border-t-transparent animate-spin\" title=\"Saving...\"></span>`;\n    } else if (isDirty) {\n      indicatorHtml = `<span class=\"flex-shrink-0 w-1.5 h-1.5 rounded-full bg-orange-400\" title=\"Unsaved changes\"></span>`;\n    } else {\n      indicatorHtml = statusDot(block.status);\n    }\n\n    return `\n      <li>\n        <div data-block-id=\"${esc(block.id)}\"\n             class=\"relative group w-full text-left px-3 py-2 text-sm rounded-lg border ${selectedClass} transition-colors flex items-center gap-2.5 cursor-pointer\">\n          <span class=\"flex-shrink-0 w-7 h-7 flex items-center justify-center rounded bg-gray-100 dark:bg-slate-800 text-gray-500 dark:text-gray-400 group-hover:bg-indigo-100 dark:group-hover:bg-indigo-900/30 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors\">\n            ${block.icon ? resolveIcon(block.icon) : `<svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6z\"></path></svg>`}\n          </span>\n          <span class=\"flex-1 min-w-0\">\n            ${nameHtml}\n            <span class=\"block text-[11px] text-gray-400 dark:text-gray-500 font-mono truncate\">${esc(slugOrType)}</span>\n          </span>\n          ${indicatorHtml}\n          <button type=\"button\" data-block-actions=\"${esc(block.id)}\"\n                  class=\"flex-shrink-0 p-0.5 rounded text-gray-300 dark:text-gray-600 hover:text-gray-600 dark:hover:text-gray-300 opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity\"\n                  title=\"Actions\">\n            <svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path d=\"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z\"></path>\n            </svg>\n          </button>\n        </div>\n      </li>`;\n  }\n\n  private renderCreateForm(): string {\n    return `\n      <div class=\"p-2 mb-1\" data-block-create-form>\n        <div class=\"p-3 border border-blue-200 dark:border-blue-800 rounded-lg bg-blue-50/50 dark:bg-blue-900/20 space-y-2\">\n          <div>\n            <label class=\"block text-[11px] font-medium text-gray-600 dark:text-gray-400 mb-0.5\">Name</label>\n            <input type=\"text\" data-create-name placeholder=\"e.g. Hero Section\"\n                   class=\"${inputClasses()}\" />\n          </div>\n          <div>\n            <label class=\"block text-[11px] font-medium text-gray-600 dark:text-gray-400 mb-0.5\">Slug</label>\n            <input type=\"text\" data-create-slug placeholder=\"e.g. hero_section\" pattern=\"^[a-z][a-z0-9_\\\\-]*$\"\n                   class=\"${inputClasses()} font-mono\" />\n            <p class=\"mt-0.5 text-[10px] text-gray-400 dark:text-gray-500\">Lowercase, numbers, hyphens, underscores.</p>\n          </div>\n          <div>\n            <label class=\"block text-[11px] font-medium text-gray-600 dark:text-gray-400 mb-0.5\">Category</label>\n            <select data-create-category\n                    class=\"${selectClasses()}\">\n              ${this.state.categories.map((c) => `<option value=\"${esc(c)}\">${esc(titleCase(c))}</option>`).join('')}\n              <option value=\"__add__\">Add category...</option>\n            </select>\n          </div>\n          <div data-create-error class=\"hidden text-xs text-red-600 dark:text-red-400\"></div>\n          <div class=\"flex items-center gap-2 pt-1\">\n            <button type=\"button\" data-create-save\n                    class=\"flex-1 px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors\">\n              Create\n            </button>\n            <button type=\"button\" data-create-cancel\n                    class=\"px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\n              Cancel\n            </button>\n          </div>\n        </div>\n      </div>`;\n  }\n\n  private renderContextMenu(blockId: string, anchorEl: HTMLElement): void {\n    this.closeContextMenu();\n\n    const block = this.state.blocks.find((b) => b.id === blockId);\n    if (!block) return;\n\n    const menu = document.createElement('div');\n    menu.setAttribute('data-block-context-menu', blockId);\n    menu.className =\n      'absolute z-50 w-44 bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg py-1 text-sm text-gray-700 dark:text-gray-300';\n\n    const items: { label: string; action: string; icon: string; danger?: boolean }[] = [\n      { label: 'Rename', action: 'rename', icon: ICONS.rename },\n      { label: 'Duplicate', action: 'duplicate', icon: ICONS.duplicate },\n    ];\n\n    if (block.status === 'draft') {\n      items.push({ label: 'Publish', action: 'publish', icon: ICONS.publish });\n    } else if (block.status === 'active') {\n      items.push({ label: 'Deprecate', action: 'deprecate', icon: ICONS.deprecate });\n    }\n\n    items.push({ label: 'Delete', action: 'delete', icon: ICONS.delete, danger: true });\n\n    menu.innerHTML = items\n      .map(\n        (item) => `\n        <button type=\"button\" data-menu-action=\"${item.action}\" data-menu-block-id=\"${esc(blockId)}\"\n                class=\"w-full text-left px-3 py-1.5 flex items-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-700 ${item.danger ? 'text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20' : ''}\">\n          ${item.icon}\n          <span>${item.label}</span>\n        </button>`\n      )\n      .join('');\n\n    // Position relative to anchor\n    const rect = anchorEl.getBoundingClientRect();\n    const menuWidth = 176; // w-44\n    menu.style.position = 'fixed';\n    menu.style.top = `${rect.bottom + 4}px`;\n\n    // Prefer left-aligning with the button; shift left if it would overflow the viewport\n    let left = rect.left;\n    if (left + menuWidth > window.innerWidth - 8) {\n      left = window.innerWidth - menuWidth - 8;\n    }\n    if (left < 8) left = 8;\n    menu.style.left = `${left}px`;\n\n    // Prevent vertical off-screen\n    document.body.appendChild(menu);\n    const menuRect = menu.getBoundingClientRect();\n    if (menuRect.bottom > window.innerHeight - 8) {\n      menu.style.top = `${rect.top - menuRect.height - 4}px`;\n    }\n\n    // Menu click handler\n    menu.addEventListener('click', (e) => {\n      const btn = (e.target as HTMLElement).closest<HTMLElement>('[data-menu-action]');\n      if (!btn) return;\n      const action = btn.dataset.menuAction!;\n      const id = btn.dataset.menuBlockId!;\n      this.closeContextMenu();\n      this.handleAction(action, id);\n    });\n\n    this.activeMenu = () => {\n      menu.remove();\n      this.activeMenu = null;\n    };\n  }\n\n  private closeContextMenu(): void {\n    if (this.activeMenu) {\n      this.activeMenu();\n    }\n  }\n\n  private renderCategoryOptions(): void {\n    if (!this.categorySelect) return;\n    this.categorySelect.innerHTML = '<option value=\"\">All Categories</option>';\n    for (const cat of this.state.categories) {\n      const option = document.createElement('option');\n      option.value = cat;\n      option.textContent = titleCase(cat);\n      if (cat === this.state.categoryFilter) option.selected = true;\n      this.categorySelect.appendChild(option);\n    }\n  }\n\n  private updateCount(): void {\n    if (this.countEl) {\n      this.countEl.textContent = String(this.state.blocks.length);\n    }\n  }\n\n  private updateBlockIndicator(blockId: string): void {\n    const itemEl = this.listEl?.querySelector(`[data-block-id=\"${blockId}\"]`);\n    if (!itemEl) return;\n    // Full re-render for simplicity; the list is small\n    this.renderBlockList();\n  }\n\n  private renderEditor(): void {\n    if (!this.editorEl) return;\n    const block = this.getSelectedBlock();\n\n    if (!block) {\n      this.editorPanel = null;\n      this.editorEl.innerHTML = `\n        <div class=\"flex flex-col items-center justify-center h-full p-8 text-center\">\n          <svg class=\"w-16 h-16 text-gray-200 dark:text-gray-700 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\"\n                  d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n          </svg>\n          <p class=\"text-sm text-gray-400 dark:text-gray-500\">Select a block from the list to edit</p>\n          <p class=\"text-xs text-gray-300 dark:text-gray-600 mt-1\">or create a new block to get started</p>\n        </div>`;\n      // Disable palette when no block is selected (Phase 9)\n      this.palettePanel?.disable();\n      this.updateAddFieldBar();\n      return;\n    }\n\n    // Create or update editor panel\n    if (this.editorPanel) {\n      this.editorPanel.update(block);\n    } else {\n      this.editorPanel = new BlockEditorPanel({\n        container: this.editorEl,\n        block,\n        categories: this.state.categories,\n        api: this.api,\n        onMetadataChange: (blockId, patch) => this.handleEditorMetadataChange(blockId, patch),\n        onSchemaChange: (blockId, fields) => this.handleEditorSchemaChange(blockId, fields),\n        onFieldDrop: (meta) => this.handlePaletteAddField(meta),\n        onAddFieldClick: () => this.handleAddFieldClick(),\n        onStatusChange: (blockId, newStatus) => this.handleEditorStatusChange(blockId, newStatus),\n        onSave: (blockId) => this.saveBlock(blockId),\n      });\n      this.editorPanel.render();\n    }\n\n    // Enable palette when a block is selected (Phase 9)\n    this.palettePanel?.enable();\n    this.updateAddFieldBar();\n  }\n\n  private handleEditorMetadataChange(blockId: string, patch: Partial<BlockDefinition>): void {\n    const idx = this.state.blocks.findIndex((b) => b.id === blockId);\n    if (idx < 0) return;\n    const prev = this.state.blocks[idx];\n    const next = { ...prev, ...patch };\n    if (patch.slug !== undefined && patch.slug !== prev.slug) {\n      const newSlug = (patch.slug ?? '').trim();\n      if (newSlug) {\n        if (!patch.type && (!prev.type || prev.type === prev.slug)) {\n          next.type = newSlug;\n          patch.type = newSlug;\n        }\n        if (next.schema && typeof next.schema === 'object') {\n          next.schema = { ...next.schema, $id: newSlug };\n        }\n      }\n    }\n    this.state.blocks[idx] = next;\n    this.markDirty(blockId);\n    // Update the block name/slug in the sidebar without a full list re-render\n    if (patch.name !== undefined || patch.status !== undefined || patch.slug !== undefined || patch.type !== undefined) {\n      this.updateBlockItemDOM(blockId, next);\n    }\n    // Schedule autosave (Phase 11)\n    this.scheduleSave(blockId);\n  }\n\n  private handleEditorSchemaChange(blockId: string, fields: import('./types').FieldDefinition[]): void {\n    const idx = this.state.blocks.findIndex((b) => b.id === blockId);\n    if (idx < 0) return;\n    const currentSchema = this.state.blocks[idx].schema;\n    const slug = this.state.blocks[idx].slug || this.state.blocks[idx].type;\n    let nextSchema = fieldsToBlockSchema(fields, slug);\n    nextSchema = this.mergeSchemaExtras(currentSchema, nextSchema);\n    this.state.blocks[idx] = {\n      ...this.state.blocks[idx],\n      schema: nextSchema,\n    };\n    this.markDirty(blockId);\n    // Schedule autosave (Phase 11)\n    this.scheduleSave(blockId);\n  }\n\n  /** Handle \"+ Add Field\" button click from the editor panel */\n  private handleAddFieldClick(): void {\n    // On large screens the palette is always visible in the sidebar; scroll it into view.\n    // On small screens use the palette popover.\n    if (this.paletteEl && this.paletteEl.offsetParent !== null) {\n      this.paletteEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n    } else if (this.paletteTriggerBtn) {\n      this.openPalettePopover(this.paletteTriggerBtn);\n    }\n  }\n\n  /** Handle adding a field from the palette (Phase 9 — click or drop) */\n  private handlePaletteAddField(meta: FieldTypeMetadata): void {\n    if (!this.editorPanel || !this.state.selectedBlockId) return;\n\n    // Auto-generate defaults for blocks fields (Phase 4 — Task 4.2)\n    const isBlocks = meta.type === 'blocks';\n    const label = isBlocks ? 'Content Blocks' : (meta?.label ?? titleCase(meta.type));\n    const baseName = isBlocks ? 'content_blocks' : meta.type.replace(/-/g, '_');\n\n    // Ensure unique field name\n    const existingNames = new Set(this.editorPanel.getFields().map((f) => f.name));\n    let name = baseName;\n    let counter = 1;\n    while (existingNames.has(name)) {\n      name = isBlocks ? `content_blocks_${counter++}` : `${baseName}_${counter++}`;\n    }\n\n    const newField: FieldDefinition = {\n      id: generateFieldId(),\n      name,\n      type: meta.type,\n      label: counter > 1 && isBlocks ? `Content Blocks ${counter - 1}` : label,\n      required: false,\n      ...(meta.defaultConfig ?? {}),\n    };\n\n    this.editorPanel.addField(newField);\n    this.handleEditorSchemaChange(this.state.selectedBlockId, this.editorPanel.getFields());\n  }\n\n  // ===========================================================================\n  // Filtering\n  // ===========================================================================\n\n  private getFilteredBlocks(): BlockDefinition[] {\n    let blocks = [...this.state.blocks];\n\n    if (this.state.search) {\n      const q = this.state.search.toLowerCase();\n      blocks = blocks.filter(\n        (b) =>\n          b.name.toLowerCase().includes(q) ||\n          b.type.toLowerCase().includes(q) ||\n          (b.slug?.toLowerCase().includes(q) ?? false) ||\n          (b.description?.toLowerCase().includes(q) ?? false)\n      );\n    }\n\n    if (this.state.categoryFilter) {\n      const filter = this.state.categoryFilter.toLowerCase().trim();\n      blocks = blocks.filter((b) => (b.category || 'custom').toLowerCase().trim() === filter);\n    }\n\n    return blocks;\n  }\n\n  // ===========================================================================\n  // Event Handling\n  // ===========================================================================\n\n  private handleListClick(e: Event): void {\n    const target = e.target as HTMLElement;\n\n    // Retry button\n    if (target.closest('[data-block-ide-retry]')) {\n      this.loadBlocks();\n      return;\n    }\n\n    if (target.closest('[data-block-ide-empty-reset-env]')) {\n      this.setEnvironment(DEFAULT_ENVIRONMENT_KEY);\n      return;\n    }\n\n    // Create form: save\n    if (target.closest('[data-create-save]')) {\n      this.handleCreateSave();\n      return;\n    }\n\n    // Create form: cancel\n    if (target.closest('[data-create-cancel]')) {\n      this.cancelCreate();\n      return;\n    }\n\n    // Context menu button\n    const actionsBtn = target.closest<HTMLElement>('[data-block-actions]');\n    if (actionsBtn) {\n      e.stopPropagation();\n      const blockId = actionsBtn.dataset.blockActions!;\n      this.renderContextMenu(blockId, actionsBtn);\n      return;\n    }\n\n    // Rename input: handle Enter/Escape\n    const renameInput = target.closest<HTMLInputElement>('[data-rename-input]');\n    if (renameInput) {\n      // Don't propagate click to block selection\n      e.stopPropagation();\n      return;\n    }\n\n    // Block item click (select)\n    const blockItem = target.closest<HTMLElement>('[data-block-id]');\n    if (blockItem) {\n      const blockId = blockItem.dataset.blockId!;\n      this.selectBlock(blockId);\n      return;\n    }\n  }\n\n  private handleAction(action: string, blockId: string): void {\n    switch (action) {\n      case 'rename':\n        this.startRename(blockId);\n        break;\n      case 'duplicate':\n        this.duplicateBlock(blockId);\n        break;\n      case 'publish':\n        this.publishBlock(blockId);\n        break;\n      case 'deprecate':\n        this.deprecateBlock(blockId);\n        break;\n      case 'delete':\n        this.deleteBlock(blockId);\n        break;\n    }\n  }\n\n  // ===========================================================================\n  // Create Block (Task 7.2)\n  // ===========================================================================\n\n  private showCreateForm(): void {\n    this.state.isCreating = true;\n    this.renderBlockList();\n  }\n\n  private cancelCreate(): void {\n    this.state.isCreating = false;\n    this.renderBlockList();\n  }\n\n  private async handleCreateSave(): Promise<void> {\n    const nameInput = this.listEl?.querySelector<HTMLInputElement>('[data-create-name]');\n    const slugInput = this.listEl?.querySelector<HTMLInputElement>('[data-create-slug]');\n    const categorySelect = this.listEl?.querySelector<HTMLSelectElement>('[data-create-category]');\n    const errorEl = this.listEl?.querySelector<HTMLElement>('[data-create-error]');\n\n    const name = nameInput?.value.trim() ?? '';\n    const slug = slugInput?.value.trim() ?? '';\n    let category = categorySelect?.value ?? 'custom';\n    if (category === '__add__') {\n      category = 'custom';\n    }\n\n    if (!name) {\n      this.showCreateError(errorEl, 'Name is required.');\n      nameInput?.focus();\n      return;\n    }\n    if (!slug) {\n      this.showCreateError(errorEl, 'Slug is required.');\n      slugInput?.focus();\n      return;\n    }\n    if (!/^[a-z][a-z0-9_\\-]*$/.test(slug)) {\n      this.showCreateError(errorEl, 'Slug must start with a letter and contain only lowercase, numbers, hyphens, underscores.');\n      slugInput?.focus();\n      return;\n    }\n\n    // Disable form while saving\n    const saveBtn = this.listEl?.querySelector<HTMLButtonElement>('[data-create-save]');\n    if (saveBtn) {\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Creating...';\n    }\n\n    try {\n      const newBlock = await this.api.createBlockDefinition({\n        name,\n        slug,\n        type: slug,\n        category,\n        status: 'draft',\n        schema: { $schema: 'https://json-schema.org/draft/2020-12/schema', type: 'object', properties: {} },\n      });\n\n      // Ensure slug is populated from the create form if the API didn't return it\n      if (!newBlock.slug) {\n        newBlock.slug = slug;\n      }\n      if (!newBlock.type) {\n        newBlock.type = newBlock.slug || slug;\n      }\n      const normalized = this.normalizeBlockDefinition(newBlock);\n\n      this.state.isCreating = false;\n      this.state.blocks.unshift(normalized);\n      this.state.selectedBlockId = normalized.id;\n      this.updateCount();\n      this.renderBlockList();\n      this.renderEditor();\n    } catch (err) {\n      const msg = err instanceof ContentTypeAPIError ? err.message : 'Failed to create block.';\n      this.showCreateError(errorEl, msg);\n      if (saveBtn) {\n        saveBtn.disabled = false;\n        saveBtn.textContent = 'Create';\n      }\n    }\n  }\n\n  private showCreateError(errorEl: HTMLElement | null | undefined, message: string): void {\n    if (!errorEl) return;\n    errorEl.textContent = message;\n    errorEl.classList.remove('hidden');\n  }\n\n  // ===========================================================================\n  // Rename Block (Task 7.3)\n  // ===========================================================================\n\n  private startRename(blockId: string): void {\n    this.state.renamingBlockId = blockId;\n    this.renderBlockList();\n\n    // Bind rename input events after render\n    const input = this.listEl?.querySelector<HTMLInputElement>('[data-rename-input]');\n    if (input) {\n      input.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          this.commitRename(blockId, input.value.trim());\n        }\n        if (e.key === 'Escape') {\n          e.preventDefault();\n          this.cancelRename();\n        }\n      });\n      input.addEventListener('blur', () => {\n        // Commit on blur if value changed\n        const block = this.state.blocks.find((b) => b.id === blockId);\n        if (block && input.value.trim() && input.value.trim() !== block.name) {\n          this.commitRename(blockId, input.value.trim());\n        } else {\n          this.cancelRename();\n        }\n      });\n    }\n  }\n\n  private async commitRename(blockId: string, newName: string): Promise<void> {\n    if (!newName) {\n      this.cancelRename();\n      return;\n    }\n\n    const block = this.state.blocks.find((b) => b.id === blockId);\n    if (!block || block.name === newName) {\n      this.cancelRename();\n      return;\n    }\n\n    try {\n      const updated = await this.api.updateBlockDefinition(blockId, { name: newName });\n      this.updateBlockInState(blockId, updated);\n    } catch (err) {\n      // Silently revert on error\n      console.error('Rename failed:', err);\n    } finally {\n      this.state.renamingBlockId = null;\n      this.renderBlockList();\n    }\n  }\n\n  private cancelRename(): void {\n    this.state.renamingBlockId = null;\n    this.renderBlockList();\n  }\n\n  // ===========================================================================\n  // Duplicate Block (Task 7.3)\n  // ===========================================================================\n\n  private async duplicateBlock(blockId: string): Promise<void> {\n    const block = this.state.blocks.find((b) => b.id === blockId);\n    if (!block) return;\n\n    const base = (block.slug || block.type || 'block').trim();\n    const newSlug = `${base}_copy`;\n    const newType = newSlug;\n\n    try {\n      const cloned = await this.api.cloneBlockDefinition(blockId, newType, newSlug);\n      const normalized = this.normalizeBlockDefinition(cloned);\n      this.state.blocks.unshift(normalized);\n      this.state.selectedBlockId = normalized.id;\n      this.updateCount();\n      this.renderBlockList();\n      this.renderEditor();\n    } catch (err) {\n      console.error('Duplicate failed:', err);\n      this.showToast(err instanceof Error ? err.message : 'Failed to duplicate block.', 'error');\n    }\n  }\n\n  // ===========================================================================\n  // Publish / Deprecate (Task 7.3)\n  // ===========================================================================\n\n  private async publishBlock(blockId: string): Promise<void> {\n    // Save pending changes before publishing (Phase 11)\n    if (this.state.dirtyBlocks.has(blockId)) {\n      const saved = await this.saveBlock(blockId);\n      if (!saved) {\n        this.showToast('Please fix save errors before publishing.', 'error');\n        return;\n      }\n    }\n    try {\n      const updated = await this.api.publishBlockDefinition(blockId);\n      this.updateBlockInState(blockId, updated);\n      this.renderBlockList();\n      this.showToast('Block published.', 'success');\n      // Refresh editor if this block is selected\n      if (this.state.selectedBlockId === blockId && this.editorPanel) {\n        const refreshed = this.state.blocks.find((b) => b.id === blockId);\n        if (refreshed) this.editorPanel.update(refreshed);\n      }\n    } catch (err) {\n      console.error('Publish failed:', err);\n      this.showToast(err instanceof Error ? err.message : 'Failed to publish block.', 'error');\n    }\n  }\n\n  private async deprecateBlock(blockId: string): Promise<void> {\n    // Save pending changes before deprecating (Phase 11)\n    if (this.state.dirtyBlocks.has(blockId)) {\n      const saved = await this.saveBlock(blockId);\n      if (!saved) {\n        this.showToast('Please fix save errors before deprecating.', 'error');\n        return;\n      }\n    }\n    try {\n      const updated = await this.api.deprecateBlockDefinition(blockId);\n      this.updateBlockInState(blockId, updated);\n      this.renderBlockList();\n      this.showToast('Block deprecated.', 'info');\n      // Refresh editor if this block is selected\n      if (this.state.selectedBlockId === blockId && this.editorPanel) {\n        const refreshed = this.state.blocks.find((b) => b.id === blockId);\n        if (refreshed) this.editorPanel.update(refreshed);\n      }\n    } catch (err) {\n      console.error('Deprecate failed:', err);\n      this.showToast(err instanceof Error ? err.message : 'Failed to deprecate block.', 'error');\n    }\n  }\n\n  // ===========================================================================\n  // Delete Block (Task 7.3)\n  // ===========================================================================\n\n  private async deleteBlock(blockId: string): Promise<void> {\n    const block = this.state.blocks.find((b) => b.id === blockId);\n    if (!block) return;\n\n    const confirmed = await ConfirmModal.confirm(\n      `Delete \"${block.name}\"? This cannot be undone.`,\n      { title: 'Delete Block', confirmText: 'Delete', confirmVariant: 'danger' },\n    );\n    if (!confirmed) return;\n\n    try {\n      await this.api.deleteBlockDefinition(blockId);\n      this.state.blocks = this.state.blocks.filter((b) => b.id !== blockId);\n      this.state.dirtyBlocks.delete(blockId);\n      this.state.savingBlocks.delete(blockId);\n      this.state.saveErrors.delete(blockId);\n\n      if (this.state.selectedBlockId === blockId) {\n        this.state.selectedBlockId = null;\n        this.renderEditor();\n      }\n\n      this.updateCount();\n      this.renderBlockList();\n    } catch (err) {\n      console.error('Delete failed:', err);\n      this.showToast(err instanceof Error ? err.message : 'Failed to delete block.', 'error');\n    }\n  }\n\n  // ===========================================================================\n  // Helpers\n  // ===========================================================================\n\n  /** Update a single block item in the sidebar DOM without re-rendering the entire list */\n  private updateBlockItemDOM(blockId: string, block: BlockDefinition): void {\n    const itemEl = this.listEl?.querySelector<HTMLElement>(`[data-block-id=\"${blockId}\"]`);\n    if (!itemEl) return;\n\n    // The text container is the <span class=\"flex-1 min-w-0\"> with two child spans\n    const textContainer = itemEl.querySelector<HTMLElement>('.flex-1.min-w-0');\n    if (!textContainer) return;\n\n    const spans = textContainer.querySelectorAll<HTMLElement>(':scope > span');\n    // First span = name, second span = slug\n    if (spans.length >= 1 && !this.state.renamingBlockId) {\n      spans[0].textContent = block.name || 'Untitled';\n    }\n    if (spans.length >= 2) {\n      spans[1].textContent = block.slug || block.type || '';\n    }\n  }\n\n  private updateBlockInState(blockId: string, updated: BlockDefinition): void {\n    const idx = this.state.blocks.findIndex((b) => b.id === blockId);\n    if (idx >= 0) {\n      const current = this.state.blocks[idx];\n      const merged = this.mergeBlockDefinition(current, updated);\n      this.state.blocks[idx] = merged;\n    }\n  }\n\n  private normalizeBlockDefinition(block: BlockDefinition): BlockDefinition {\n    const normalized = { ...block };\n    const slug = (normalized.slug ?? '').trim();\n    const typ = (normalized.type ?? '').trim();\n    if (!slug && typ) normalized.slug = typ;\n    if (!typ && slug) normalized.type = slug;\n    return normalized;\n  }\n\n  private mergeBlockDefinition(current: BlockDefinition, updated: BlockDefinition): BlockDefinition {\n    const merged = { ...current, ...updated };\n    if (updated.icon == null && current.icon) {\n      merged.icon = current.icon;\n    }\n    if (updated.description == null && current.description) {\n      merged.description = current.description;\n    }\n    if (updated.category == null && current.category) {\n      merged.category = current.category;\n    }\n    const updatedSlug = (updated.slug ?? '').trim();\n    const updatedType = (updated.type ?? '').trim();\n    if (!updatedSlug && current.slug) merged.slug = current.slug;\n    if (!updatedType && current.type) merged.type = current.type;\n    const mergedSlug = (merged.slug ?? '').trim();\n    const mergedType = (merged.type ?? '').trim();\n    if (!mergedSlug && mergedType) merged.slug = mergedType;\n    if (!mergedType && mergedSlug) merged.type = mergedSlug;\n    return merged;\n  }\n\n  private mergeSchemaExtras(current: BlockDefinition['schema'], next: BlockDefinition['schema']): BlockDefinition['schema'] {\n    if (!current || typeof current !== 'object') {\n      return next;\n    }\n    const merged = { ...next } as Record<string, unknown>;\n    const skip = new Set(['properties', 'required', 'type', '$schema']);\n    for (const [key, value] of Object.entries(current)) {\n      if (skip.has(key)) continue;\n      if (key === '$id') {\n        if (!merged['$id'] && value) merged['$id'] = value;\n        continue;\n      }\n      if (!(key in merged)) {\n        merged[key] = value;\n      }\n    }\n    return merged as BlockDefinition['schema'];\n  }\n\n  private showToast(message: string, type: 'success' | 'error' | 'info' = 'info'): void {\n    // Prefer global notify helper\n    const notify = (window as any).notify as\n      | { success?: (msg: string) => void; error?: (msg: string) => void; info?: (msg: string) => void }\n      | undefined;\n    const notifyFn = notify?.[type];\n    if (typeof notifyFn === 'function') {\n      notifyFn(message);\n      return;\n    }\n\n    // Fallback: show an inline toast notification\n    const existing = this.root.querySelector('[data-ide-toast]');\n    if (existing) existing.remove();\n\n      const colors = type === 'error'\n      ? 'bg-red-50 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-200 dark:border-red-800'\n      : type === 'success'\n        ? 'bg-green-50 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-200 dark:border-green-800'\n        : 'bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-800';\n\n    const toast = document.createElement('div');\n    toast.setAttribute('data-ide-toast', '');\n    toast.className = `fixed top-4 right-4 z-[100] px-4 py-2.5 rounded-lg border text-sm font-medium shadow-lg ${colors} transition-opacity`;\n    toast.textContent = message;\n    document.body.appendChild(toast);\n\n    setTimeout(() => {\n      toast.style.opacity = '0';\n      setTimeout(() => toast.remove(), 300);\n    }, 3000);\n  }\n}\n\n\n// =============================================================================\n// Utilities\n// =============================================================================\n\nfunction esc(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction titleCase(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n}\n\nfunction nameToSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '');\n}\n\nfunction statusDot(status?: string): string {\n  switch (status) {\n    case 'draft':\n      return '<span class=\"flex-shrink-0 w-1.5 h-1.5 rounded-full bg-yellow-400\" title=\"Draft\"></span>';\n    case 'deprecated':\n      return '<span class=\"flex-shrink-0 w-1.5 h-1.5 rounded-full bg-red-400\" title=\"Deprecated\"></span>';\n    case 'active':\n    default:\n      return '<span class=\"flex-shrink-0 w-1.5 h-1.5 rounded-full bg-green-400\" title=\"Active\"></span>';\n  }\n}\n\n// Context menu icons (compact SVGs)\nconst ICONS = {\n  rename: '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path></svg>',\n  duplicate:\n    '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg>',\n  publish:\n    '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>',\n  deprecate:\n    '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\"></path></svg>',\n  delete:\n    '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path></svg>',\n};\n\n// =============================================================================\n// Auto-initialization\n// =============================================================================\n\nexport function initBlockLibraryIDE(scope: ParentNode = document): void {\n  const roots = Array.from(scope.querySelectorAll<HTMLElement>('[data-block-library-ide]'));\n\n  roots.forEach((root) => {\n    if (root.dataset.ideInitialized === 'true') return;\n\n    try {\n      const ide = new BlockLibraryIDE(root);\n      ide.init();\n      root.dataset.ideInitialized = 'true';\n    } catch (err) {\n      console.error('Block Library IDE failed to initialize:', err);\n    }\n  });\n}\n","/**\n * Content Type Builder Module\n *\n * A visual UI for creating and editing content types with drag-and-drop field ordering,\n * field type picker, configuration forms, and live schema preview.\n */\n\n// Re-export types\nexport type {\n  ContentType,\n  ContentTypeStatus,\n  ContentTypeCapabilities,\n  JSONSchema,\n  JSONSchemaType,\n  FormgenExtension,\n  AdminExtension,\n  UISchemaOverlay,\n  UILayoutConfig,\n  UITab,\n  UIOverride,\n  ConditionalField,\n  FieldDefinition,\n  FieldType,\n  FieldValidation,\n  FieldTypeConfig,\n  FieldTypeMetadata,\n  FieldTypeCategory,\n  // Advanced field configs\n  TextFieldConfig,\n  NumberFieldConfig,\n  SelectFieldConfig,\n  MediaFieldConfig,\n  ReferenceFieldConfig,\n  RepeaterFieldConfig,\n  BlocksFieldConfig,\n  CodeFieldConfig,\n  SlugFieldConfig,\n  ColorFieldConfig,\n  LocationFieldConfig,\n  DateRangeFieldConfig,\n  // Block definition types\n  BlockDefinition,\n  BlockDefinitionStatus,\n  BlockDefinitionListResponse,\n  BlockDefinitionSummary,\n  BlockLibraryManagerConfig,\n  BlockLibraryManagerState,\n  BlockSchemaVersion,\n  // Content type versioning types\n  ContentTypeSchemaVersion,\n  SchemaChange,\n  CompatibilityCheckResult,\n  // API types\n  ContentTypeListResponse,\n  SchemaValidationRequest,\n  SchemaValidationResponse,\n  SchemaPreviewRequest,\n  SchemaPreviewResponse,\n  ContentTypeBuilderState,\n  ContentTypeEditorConfig,\n  FieldTypePickerConfig,\n  FieldConfigFormConfig,\n  SchemaPreviewConfig,\n  ContentTypeBuilderEvent,\n} from './types';\n\n// Re-export API client\nexport { ContentTypeAPIClient, ContentTypeAPIError, fieldsToSchema, schemaToFields, generateFieldId } from './api-client';\n\n// Re-export field type picker\nexport { FieldTypePicker, FIELD_TYPES, FIELD_CATEGORIES, getFieldTypeMetadata, getFieldTypesByCategory } from './field-type-picker';\n\n// Re-export field config form\nexport { FieldConfigForm } from './field-config-form';\n\n// Re-export layout editor\nexport { LayoutEditor } from './layout-editor';\nexport type { LayoutEditorConfig } from './layout-editor';\n\n// Re-export main editor\nexport { ContentTypeEditor } from './content-type-editor';\n\n// Re-export block library manager\nexport { BlockLibraryManager, initBlockLibraryManagers } from './block-library-manager';\n\n// Re-export block library IDE\nexport { BlockLibraryIDE, initBlockLibraryIDE } from './block-library-ide';\n\n// Re-export block editor panel\nexport { BlockEditorPanel } from './block-editor-panel';\n\n// Re-export field palette panel (Phase 9)\nexport { FieldPalettePanel, PALETTE_DRAG_MIME } from './field-palette-panel';\n\n// Re-export icon picker (shared)\nexport { registerIconTab, unregisterIconTab, getIconTabs, resolveIcon } from './shared/icon-picker';\nexport type { IconTab, IconEntry, IconPickerConfig } from './shared/icon-picker';\n\n// =============================================================================\n// Auto-initialization\n// =============================================================================\n\nimport { ContentTypeEditor } from './content-type-editor';\nimport { initBlockLibraryIDE } from './block-library-ide';\nimport type { ContentTypeEditorConfig } from './types';\nimport { deriveAdminBasePath, resolveApiBasePath } from './shared/api-paths';\n\n/**\n * Initialize content type editors on elements matching [data-content-type-editor]\n */\nexport function initContentTypeEditors(scope: ParentNode = document): void {\n  const roots = Array.from(scope.querySelectorAll<HTMLElement>('[data-content-type-editor-root]'));\n\n  roots.forEach((root) => {\n    // Skip if already initialized\n    if (root.dataset.initialized === 'true') return;\n\n    const config = parseConfig(root);\n    if (!config.apiBasePath) {\n      console.warn('Content type editor missing apiBasePath', root);\n      return;\n    }\n\n    const basePath = config.basePath ?? deriveAdminBasePath(config.apiBasePath);\n    const activeEnvironment = String(config.environment ?? '').trim().toLowerCase();\n    const envQuery = activeEnvironment && activeEnvironment !== 'default'\n      ? `env=${encodeURIComponent(activeEnvironment)}`\n      : '';\n\n    // Wire default onCancel: navigate back to the content types list\n    if (!config.onCancel) {\n      config.onCancel = () => {\n        const target = `${basePath}/content/types`;\n        window.location.href = envQuery ? `${target}?${envQuery}` : target;\n      };\n    }\n\n    // Wire default onSave: navigate to the saved content type's slug\n    if (!config.onSave) {\n      config.onSave = (saved) => {\n        const slug = saved.slug ?? saved.id;\n        if (slug) {\n          const params = [`slug=${encodeURIComponent(slug)}`];\n          if (envQuery) {\n            params.push(envQuery);\n          }\n          window.location.href = `${basePath}/content/types?${params.join('&')}`;\n        }\n      };\n    }\n\n    try {\n      const editor = new ContentTypeEditor(root, config);\n      editor.init();\n      root.dataset.initialized = 'true';\n    } catch (error) {\n      console.error('Content type editor failed to initialize:', error);\n      root.innerHTML = `\n        <div class=\"flex flex-col items-center justify-center min-h-[300px] p-8 text-center\">\n          <svg class=\"w-12 h-12 mb-3 text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n          </svg>\n          <h3 class=\"text-lg font-semibold text-gray-900 dark:text-white mb-1\">Editor failed to load</h3>\n          <p class=\"text-sm text-gray-500 dark:text-gray-400 max-w-md\">\n            ${error instanceof Error ? error.message : 'An unexpected error occurred while initializing the editor.'}\n          </p>\n          <button\n            type=\"button\"\n            onclick=\"window.location.reload()\"\n            class=\"mt-4 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 border border-blue-300 rounded-lg hover:bg-blue-50\"\n          >\n            Reload page\n          </button>\n        </div>\n      `;\n    }\n  });\n}\n\nfunction parseConfig(root: HTMLElement): ContentTypeEditorConfig {\n  let config: Partial<ContentTypeEditorConfig> = {};\n  const configAttr = root.getAttribute('data-content-type-editor-config');\n  if (configAttr) {\n    try {\n      config = JSON.parse(configAttr) as Partial<ContentTypeEditorConfig>;\n    } catch {\n      // Fall through to data attributes\n    }\n  }\n\n  const apiBasePath = resolveApiBasePath(config.apiBasePath, root.dataset.apiBasePath, root.dataset.basePath);\n  const basePath = config.basePath ?? deriveAdminBasePath(apiBasePath, root.dataset.basePath);\n\n  return {\n    ...config,\n    apiBasePath,\n    basePath,\n    contentTypeId: config.contentTypeId ?? root.dataset.contentTypeId,\n    environment: config.environment ?? root.dataset.environment,\n    locale: config.locale ?? root.dataset.locale,\n  };\n}\n\nfunction onReady(fn: () => void): void {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', fn, { once: true });\n  } else {\n    fn();\n  }\n}\n\n// Auto-initialize on DOM ready\nonReady(() => {\n  initContentTypeEditors();\n  initBlockLibraryIDE();\n});\n"],"names":["ContentTypeAPIError","message","status","textCode","fields","ContentTypeAPIClient","config","basePath","env","url","params","queryParams","query","data","idOrSlug","contentType","force","newSlug","newName","newSchema","newUiSchema","request","idOrType","block","newType","diagnostics","options","headers","separator","response","errorData","extractErrorMessage","errObj","metaFields","out","entry","field","msg","cloneSchema","value","mergeSchemaSection","base","next","normalizeBlockTypeList","values","seen","trimmed","blockTypeListsEqual","a","b","left","right","rightSet","item","extractBlockTypeFromRef","ref","idx","extractAllowedBlocksFromOneOf","oneOf","refs","refPrefix","refInfo","inline","subSchema","typeProp","t","buildInlineBlocksItemsSchema","allowedBlocks","itemsSchema","blockType","buildRefBlocksItemsSchema","prefix","mergeSchemaWithBase","merged","baseDefs","nextDefs","baseMeta","nextMeta","fieldsToSchema","slug","properties","required","fieldToSchemaProperty","schema","fieldsToBlockSchema","mapping","formgen","widget","fieldTypeToWidget","opt","blocksConfig","deniedBlocks","sourceAllowed","sourceDenied","hasAllowedOverride","hasDeniedOverride","allowedChanged","deniedChanged","sourceItems","sourceMode","blocksFormgen","fieldType","schemaToFields","name","propSchema","schemaPropertyToField","isRequired","filterable","generateFieldId","schemaToFieldType","titleCase","validation","parsedSource","sourceAllowedBlocks","configured","denied","type","widgetToType","str","word","SVG_ICONS","iconForKey","key","normalizeFieldType","icon","FIELD_TYPES","FIELD_CATEGORIES","getFieldTypeMetadata","normalized","ft","getFieldTypesByCategory","category","FieldTypePicker","Modal","cat","excludeSet","types","btn","searchInput","e","target","categoriesContainer","listContainer","BASE_INPUT","SIZE_SM","SIZE_XS","inputClasses","size","selectClasses","textareaClasses","resize","resizeClass","checkboxClasses","labelClasses","dragHandleIcon","EMOJI_CATEGORIES","ICONOIR_SIDEBAR_ICONS","getBuiltinIconoirTab","entries","categories","catOrder","catName","catEntries","renderIcon","SVG_ICON_KEYS","getBuiltinEmojiTab","getBuiltinIconsTab","svg","_tabs","_initialized","ensureBuiltins","registerIconTab","tab","unregisterIconTab","id","getIconTabs","resolveIcon","escapeHtml","resolveLabel","renderIconTrigger","fieldAttr","compact","resolved","label","hasValue","height","textSize","iconSize","btnSize","_popoverEl","_activeConfig","_activeTrigger","_activeTabId","_searchQuery","_clickOutsideHandler","_escapeHandler","openIconPicker","anchor","closeIconPicker","getAncestorZIndex","renderPopoverContent","positionPopover","bindPopoverEvents","rect","popoverWidth","popoverHeight","top","tabs","activeTab","filteredEntries","q","tabBarHtml","isActive","gridHtml","renderGrid","f","i","nextStart","html","isEmoji","refreshPopoverContent","tabBtn","pickBtn","updateTriggerDisplay","scrollTop","gridArea","trigger","preview","clearBtn","bindIconTriggerEvents","container","selector","getConfig","el","node","z","loadAvailableBlocks","api","blockKey","normalizeBlockSelection","selected","available","mappedLegacy","hasKey","hasType","renderInlineBlockPicker","availableBlocks","selectedBlocks","searchQuery","accent","emptySelectionText","filtered","grouped","count","countText","focusRing","selectedClass","blocks","isSelected","bindInlineBlockPickerEvents","pickerRoot","refreshInlineBlockPickerList","listEl","bindCheckboxEvents","checkbox","legacyType","tempDiv","newList","newCount","countEl","c","trimTrailingSlash","normalizeApiBasePath","raw","resolveApiBasePath","candidates","candidate","docBase","docAdminBase","debugConfig","deriveAdminBasePath","apiBasePath","fallbackBasePath","fallback","match","FieldConfigForm","fieldMeta","showStringValidation","showNumberValidation","sections","allowedBlocksJson","deniedBlocksJson","nameInput","labelInput","labelToFieldName","optionsList","index","row","listType","hiddenInput","currentBlocks","BlockPickerModal","chipsContainer","emptyText","chipColor","updatedBlocks","form","formData","existingNames","originalName","updatedField","minLength","maxLength","min","max","pattern","displayField","accept","maxSize","multiple","language","lineNumbers","sourceField","suffix","format","allowAlpha","presetsStr","presets","s","defaultLat","defaultLng","defaultZoom","minDate","maxDate","allowSameDay","minItems","maxItems","collapsed","minBlocks","maxBlocks","allowedStr","deniedStr","existingConfig","parsed","fieldName","input","errorEl","clearError","div","loadingEl","emptyEl","bk","sharedBlockKey","LayoutEditor","itemName","fieldsBySection","section","tabId","v","tabsList","targetIndex","newTab","newIndex","currentIndex","idInput","iconInput","content","ids","textEl","CATEGORY_ID_MAP","CATEGORY_ICON_MAP","normalizeCategoryId","normalizeCategoryLabel","fallbackId","val","normalizeCategoryIcon","iconKey","normalizeDefaults","def","defaults","mapFieldType","categoryId","rawType","normalizedType","description","defaultConfig","meta","buildRegistryFromGroups","groups","fieldTypes","group","backendId","mappedId","defs","BLOCK_FIELD_TYPE_REGISTRY_FALLBACK","buildMergedFallback","staticTypes","FIELD_TYPE_REGISTRY_FALLBACK","loadFieldTypeRegistry","registry","apiTypes","COLLAPSED_BY_DEFAULT","PALETTE_DRAG_MIME","PALETTE_DRAG_META_MIME","FieldPalettePanel","seenCategories","state","searchWrapper","esc","listWrapper","isCollapsed","matched","root","list","catId","body","chevron","fieldTypeKey","renderSaveIndicator","renderEntityHeader","subtitle","subtitleMono","version","saveState","saveMessage","actions","px","tag","titleSize","gap","saveHtml","statusBadgeHtml","badge","versionHtml","subtitleHtml","CHEVRON_UP","CHEVRON_DOWN","EXPAND_ICON","COLLAPSE_ICON","ERROR_ICON","renderFieldCard","isExpanded","isDropTarget","hasErrors","errorMessages","showReorderButtons","isFirst","isLast","renderExpandedContent","actionsHtml","constraintBadges","sectionName","expandable","wrapperState","dropClass","gapClass","labelSize","metaSize","handleSize","iconBg","iconContent","badges","badgesHtml","dataAttrs","metaLine","typeLabel","parts","constraintHtml","errorHtml","reorderHtml","upDisabled","downDisabled","upClass","downClass","expandToggle","KEBAB_ICON","renderFieldKebab","fieldId","renderDropZone","highlight","text","DEFAULT_SECTION","ContentTypeEditor","configuredEnvironment","error","saved","generated","metadata","counter","ConfirmModal","targetSection","sourceSection","normalizedTarget","sourceList","fromIndex","targetList","insertIndex","ordered","direction","sectionFields","indexInSection","globalA","globalB","result","previewContainer","ct","layoutType","layoutLabel","isBlocks","fieldErrors","err","constraints","indexInList","menuOpen","renderFieldCardShared","itemClass","isAllowed","toggleBase","allowedClass","deniedClass","pickerLabel","pickerAccent","pickerHtml","caps","btnClass","compatResult","compatError","PublishConfirmationModal","published","deprecated","CloneContentTypeModal","cloned","ContentTypeVersionHistoryViewer","actionsBtn","editAction","removeAction","moveUpBtn","moveDownBtn","blocksMode","mode","blocksAdvanced","blocksRetry","fieldToggle","fieldCard","slugInput","nameToSlug","fieldList","evt","card","clientY","midY","insertBefore","indicator","related","startIndex","startSection","currentSection","zone","metaRaw","menuContainer","dropdown","wrapper","layout","fieldsSection","newFieldsSection","existing","uiSchema","tabsById","overrides","override","saveBtn","previewBtn","dot","headerEl","fieldListContainer","sectionNames","allFields","map","mainFields","k","fieldID","sel","cfgRec","fb","initWysiwyg","errorsContainer","errorsByField","generalErrors","fieldMatch","errors","notifyFn","delayMs","formatDate","dateStr","compatibilityResult","compatibilityError","hasCompatibilityError","hasBreakingChanges","hasWarnings","affectedCount","confirmDisabled","confirmClass","change","confirmBtn","forceCheckbox","blockPublish","suggestedSlug","suggestedName","showError","versionId","isCurrent","hasChanges","typeColors","typeIcons","BlockLibraryManager","isManageMode","filterInput","categoryFilter","blockCard","blockId","apiCategories","select","option","filteredBlocks","groupedBlocks","statusBadge","variant","searchLower","BlockDefinitionEditor","savedBlock","TextPromptModal","BlockVersionHistoryViewer","editBtn","removeBtn","newField","_","descriptionValue","iconValue","blockData","initBlockLibraryManagers","scope","onReady","fn","FIELD_REORDER_MIME","BlockEditorPanel","slugValue","typeHint","allSections","showStringVal","showNumberVal","otherSections","hidden","sectionToggle","moveBtn","moveNewBtn","confirmed","blocksToggle","isHidden","propEl","propKey","_root","checkEl","patch","self","prevSlug","propPath","rec","cKey","configRec","vKey","draggedId","targetId","dragged","dragSection","toIndex","gripEngaged","previousSection","DEFAULT_BLOCK_CATEGORIES","DEFAULT_ENVIRONMENT_KEY","_BlockLibraryIDE","updated","timer","dirtyIds","newStatus","oldStatus","refreshed","fallbackMessage","fallbackErr","backdrop","popover","estimatedHeight","envFromUrl","previous","current","known","sorted","isDefault","baseUrl","prevId","arr","effective","userCats","previousValue","added","hasFilters","activeEnvironment","inDefault","diagnosticHint","resetHint","totalsHint","categorySelect","renameInput","isRenaming","isDirty","isSaving","saveError","slugOrType","nameHtml","indicatorHtml","statusDot","anchorEl","menu","items","ICONS","menuWidth","menuRect","action","prev","currentSchema","nextSchema","baseName","filter","blockItem","newBlock","itemEl","textContainer","spans","typ","updatedSlug","updatedType","mergedSlug","mergedType","skip","colors","toast","BlockLibraryIDE","initBlockLibraryIDE","initContentTypeEditors","parseConfig","envQuery","configAttr"],"mappings":"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"}