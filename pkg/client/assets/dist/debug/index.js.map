{"version":3,"file":"index.js","sources":["../../src/debug/debug-panel.ts","../../src/debug/index.ts"],"sourcesContent":["import { DebugStream, type DebugEvent, type DebugStreamStatus } from './debug-stream.js';\nimport { DebugReplPanel, type DebugReplCommand } from './repl/repl-panel.js';\nimport { highlightSQL, highlightJSON } from './syntax-highlight.js';\n\ntype RequestEntry = {\n  id?: string;\n  timestamp?: string;\n  method?: string;\n  path?: string;\n  status?: number;\n  duration?: number;\n  headers?: Record<string, string>;\n  query?: Record<string, string>;\n  error?: string;\n};\n\ntype SQLEntry = {\n  id?: string;\n  timestamp?: string;\n  query?: string;\n  args?: any[];\n  duration?: number;\n  row_count?: number;\n  error?: string;\n};\n\ntype LogEntry = {\n  timestamp?: string;\n  level?: string;\n  message?: string;\n  fields?: Record<string, any>;\n  source?: string;\n};\n\ntype CustomLogEntry = {\n  timestamp?: string;\n  category?: string;\n  message?: string;\n  fields?: Record<string, any>;\n};\n\ntype RouteEntry = {\n  method?: string;\n  path?: string;\n  name?: string;\n  handler?: string;\n  middleware?: string[];\n  summary?: string;\n  tags?: string[];\n};\n\ntype CustomSnapshot = {\n  data?: Record<string, any>;\n  logs?: CustomLogEntry[];\n};\n\ntype DebugReplCommandPayload = {\n  command?: string;\n  description?: string;\n  tags?: string[];\n  aliases?: string[];\n  mutates?: boolean;\n  read_only?: boolean;\n};\n\ntype DebugSnapshot = {\n  template?: Record<string, any>;\n  session?: Record<string, any>;\n  requests?: RequestEntry[];\n  sql?: SQLEntry[];\n  logs?: LogEntry[];\n  config?: Record<string, any>;\n  routes?: RouteEntry[];\n  custom?: CustomSnapshot;\n  [key: string]: any;\n};\n\ntype PanelFilters = {\n  requests: { method: string; status: string; search: string };\n  sql: { search: string; slowOnly: boolean; errorOnly: boolean };\n  logs: { level: string; search: string; autoScroll: boolean; newestFirst: boolean };\n  routes: { method: string; search: string };\n  custom: { search: string };\n  objects: { search: string };\n};\n\ntype DebugState = {\n  template: Record<string, any>;\n  session: Record<string, any>;\n  requests: RequestEntry[];\n  sql: SQLEntry[];\n  logs: LogEntry[];\n  config: Record<string, any>;\n  routes: RouteEntry[];\n  custom: { data: Record<string, any>; logs: CustomLogEntry[] };\n  extra: Record<string, any>;\n};\n\ntype PanelRenderer = {\n  render: () => void;\n  filters?: () => string;\n};\n\nconst defaultPanels = ['template', 'session', 'requests', 'sql', 'logs', 'config', 'routes', 'custom'];\nconst replPanelIDs = new Set(['shell', 'console']);\nconst knownPanels = new Set([...defaultPanels, ...replPanelIDs]);\n\nconst panelLabels: Record<string, string> = {\n  template: 'Template',\n  session: 'Session',\n  requests: 'Requests',\n  sql: 'SQL Queries',\n  logs: 'Logs',\n  config: 'Config',\n  routes: 'Routes',\n  custom: 'Custom',\n  shell: 'Shell',\n  console: 'Console',\n};\n\nconst panelEventMap: Record<string, string> = {\n  template: 'template',\n  session: 'session',\n  requests: 'request',\n  sql: 'sql',\n  logs: 'log',\n  custom: 'custom',\n};\n\nconst eventToPanel: Record<string, string> = {\n  request: 'requests',\n  sql: 'sql',\n  log: 'logs',\n  template: 'template',\n  session: 'session',\n  custom: 'custom',\n};\n\nconst parseJSON = (value: string | undefined): any => {\n  if (!value) {\n    return null;\n  }\n  try {\n    return JSON.parse(value);\n  } catch {\n    return null;\n  }\n};\n\nconst normalizeReplCommands = (value: any): DebugReplCommand[] => {\n  if (!Array.isArray(value)) {\n    return [];\n  }\n  const commands: DebugReplCommand[] = [];\n  value.forEach((item) => {\n    if (!item || typeof item !== 'object') {\n      return;\n    }\n    const raw = item as DebugReplCommandPayload;\n    const command = typeof raw.command === 'string' ? raw.command.trim() : '';\n    if (!command) {\n      return;\n    }\n    const description = typeof raw.description === 'string' ? raw.description.trim() : '';\n    const tags = Array.isArray(raw.tags)\n      ? raw.tags\n          .filter((tag) => typeof tag === 'string' && tag.trim() !== '')\n          .map((tag) => tag.trim())\n      : [];\n    const aliases = Array.isArray(raw.aliases)\n      ? raw.aliases\n          .filter((alias) => typeof alias === 'string' && alias.trim() !== '')\n          .map((alias) => alias.trim())\n      : [];\n    const mutates =\n      typeof raw.mutates === 'boolean'\n        ? raw.mutates\n        : typeof raw.read_only === 'boolean'\n          ? !raw.read_only\n          : false;\n    commands.push({\n      command,\n      description: description || undefined,\n      tags: tags.length > 0 ? tags : undefined,\n      aliases: aliases.length > 0 ? aliases : undefined,\n      mutates,\n    });\n  });\n  return commands;\n};\n\nconst escapeHTML = (value: any): string => {\n  const str = String(value ?? '');\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n};\n\nconst formatTimestamp = (value: any): string => {\n  if (!value) {\n    return '';\n  }\n  if (typeof value === 'number') {\n    return new Date(value).toLocaleTimeString();\n  }\n  if (typeof value === 'string') {\n    const date = new Date(value);\n    if (!Number.isNaN(date.getTime())) {\n      return date.toLocaleTimeString();\n    }\n    return value;\n  }\n  return '';\n};\n\nconst formatDuration = (value: any): string => {\n  if (value === null || value === undefined) {\n    return '0ms';\n  }\n  if (typeof value === 'string') {\n    return value;\n  }\n  const nanos = Number(value);\n  if (Number.isNaN(nanos)) {\n    return '0ms';\n  }\n  const ms = nanos / 1e6;\n  if (ms < 1) {\n    const micros = nanos / 1e3;\n    return `${micros.toFixed(1)}us`;\n  }\n  if (ms < 1000) {\n    return `${ms.toFixed(2)}ms`;\n  }\n  return `${(ms / 1000).toFixed(2)}s`;\n};\n\nconst formatNumber = (value: any): string => {\n  if (value === null || value === undefined || value === '') {\n    return '0';\n  }\n  const num = Number(value);\n  if (Number.isNaN(num)) {\n    return String(value);\n  }\n  return num.toLocaleString();\n};\n\nconst formatJSON = (value: any): string => {\n  if (value === undefined) {\n    return '{}';\n  }\n  try {\n    return JSON.stringify(value, null, 2);\n  } catch {\n    return String(value ?? '');\n  }\n};\n\nconst copyToClipboard = async (text: string, button: HTMLElement): Promise<void> => {\n  try {\n    await navigator.clipboard.writeText(text);\n    const originalHTML = button.innerHTML;\n    button.innerHTML = '<i class=\"iconoir-check\"></i> Copied';\n    button.classList.add('debug-copy--success');\n    setTimeout(() => {\n      button.innerHTML = originalHTML;\n      button.classList.remove('debug-copy--success');\n    }, 1500);\n  } catch {\n    button.classList.add('debug-copy--error');\n    setTimeout(() => {\n      button.classList.remove('debug-copy--error');\n    }, 1500);\n  }\n};\n\nconst countPanelPayload = (value: any): number => {\n  if (value === null || value === undefined) {\n    return 0;\n  }\n  if (Array.isArray(value)) {\n    return value.length;\n  }\n  if (typeof value === 'object') {\n    return Object.keys(value).length;\n  }\n  return 1;\n};\n\nconst normalizePanelList = (value: any): string[] => {\n  if (Array.isArray(value) && value.length > 0) {\n    return value.filter((panel) => typeof panel === 'string' && panel.trim()).map((panel) => panel.trim());\n  }\n  return [...defaultPanels];\n};\n\nconst panelLabel = (panelId: string): string => {\n  if (panelLabels[panelId]) {\n    return panelLabels[panelId];\n  }\n  if (!panelId) {\n    return '';\n  }\n  return panelId\n    .replace(/[-_.]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n    .replace(/\\bsql\\b/i, 'SQL')\n    .replace(/\\b([a-z])/g, (match) => match.toUpperCase());\n};\n\nconst filterObjectByKey = (data: Record<string, any>, search: string): Record<string, any> => {\n  if (!search) {\n    return data;\n  }\n  const needle = search.toLowerCase();\n  const out: Record<string, any> = {};\n  for (const [key, value] of Object.entries(data || {})) {\n    if (key.toLowerCase().includes(needle)) {\n      out[key] = value;\n    }\n  }\n  return out;\n};\n\nconst setNestedValue = (dest: Record<string, any>, key: string, value: any): void => {\n  if (!dest || !key) {\n    return;\n  }\n  const parts = key.split('.').map((part) => part.trim()).filter(Boolean);\n  if (parts.length === 0) {\n    return;\n  }\n  let current = dest;\n  for (let i = 0; i < parts.length - 1; i += 1) {\n    const part = parts[i];\n    if (!current[part] || typeof current[part] !== 'object') {\n      current[part] = {};\n    }\n    current = current[part];\n  }\n  current[parts[parts.length - 1]] = value;\n};\n\nconst ensureArray = <T>(value: any): T[] => (Array.isArray(value) ? value : []);\n\nconst parseNumber = (value: string | undefined, fallback: number): number => {\n  if (!value) {\n    return fallback;\n  }\n  const parsed = Number(value);\n  if (Number.isNaN(parsed)) {\n    return fallback;\n  }\n  return parsed;\n};\n\nexport class DebugPanel {\n  private container: HTMLElement;\n  private debugPath: string;\n  private panels: string[];\n  private activePanel: string;\n  private state: DebugState;\n  private filters: PanelFilters;\n  private paused = false;\n  private maxLogEntries: number;\n  private maxSQLQueries: number;\n  private slowThresholdMs: number;\n  private eventCount = 0;\n  private lastEventAt: Date | null = null;\n  private stream: DebugStream;\n  private replPanels: Map<string, DebugReplPanel>;\n  private replCommands: DebugReplCommand[];\n  private panelRenderers: Map<string, PanelRenderer>;\n  private tabsEl: HTMLElement;\n  private panelEl: HTMLElement;\n  private filtersEl: HTMLElement;\n  private statusEl: HTMLElement;\n  private connectionEl: HTMLElement;\n  private eventCountEl: HTMLElement;\n  private lastEventEl: HTMLElement;\n\n  constructor(container: HTMLElement) {\n    this.container = container;\n    const panelsData = parseJSON(container.dataset.panels);\n    this.panels = normalizePanelList(panelsData);\n    this.activePanel = this.panels[0] || 'template';\n\n    this.debugPath = container.dataset.debugPath || '';\n    this.maxLogEntries = parseNumber(container.dataset.maxLogEntries, 500);\n    this.maxSQLQueries = parseNumber(container.dataset.maxSqlQueries, 200);\n    this.slowThresholdMs = parseNumber(container.dataset.slowThresholdMs, 50);\n    this.replCommands = normalizeReplCommands(parseJSON(container.dataset.replCommands));\n\n    this.state = {\n      template: {},\n      session: {},\n      requests: [],\n      sql: [],\n      logs: [],\n      config: {},\n      routes: [],\n      custom: { data: {}, logs: [] },\n      extra: {},\n    };\n\n    this.filters = {\n      requests: { method: 'all', status: 'all', search: '' },\n      sql: { search: '', slowOnly: false, errorOnly: false },\n      logs: { level: 'all', search: '', autoScroll: true, newestFirst: true },\n      routes: { method: 'all', search: '' },\n      custom: { search: '' },\n      objects: { search: '' },\n    };\n\n    this.replPanels = new Map();\n    this.panelRenderers = new Map();\n    replPanelIDs.forEach((panel) => {\n      this.panelRenderers.set(panel, {\n        render: () => this.renderReplPanel(panel),\n        filters: () => '<span class=\"timestamp\">REPL controls are in the panel header.</span>',\n      });\n    });\n\n    this.tabsEl = this.requireElement('[data-debug-tabs]', document);\n    this.panelEl = this.requireElement('[data-debug-panel]', document);\n    this.filtersEl = this.requireElement('[data-debug-filters]', document);\n    this.statusEl = document.querySelector('[data-debug-status]') || this.container;\n    this.connectionEl = this.requireElement('[data-debug-connection]', document);\n    this.eventCountEl = this.requireElement('[data-debug-events]', document);\n    this.lastEventEl = this.requireElement('[data-debug-last]', document);\n\n    this.renderTabs();\n    this.renderActivePanel();\n    this.bindActions();\n\n    this.stream = new DebugStream({\n      basePath: this.debugPath,\n      onEvent: (event) => this.handleEvent(event),\n      onStatusChange: (status) => this.updateConnectionStatus(status),\n    });\n\n    this.fetchSnapshot();\n    this.stream.connect();\n    this.stream.subscribe(this.panels.map((panel) => panelEventMap[panel] || panel));\n  }\n\n  private requireElement(selector: string, parent: ParentNode = this.container): HTMLElement {\n    const el = parent.querySelector(selector);\n    if (!el) {\n      throw new Error(`Missing debug element: ${selector}`);\n    }\n    return el as HTMLElement;\n  }\n\n  private bindActions(): void {\n    this.tabsEl.addEventListener('click', (event) => {\n      const target = event.target as HTMLElement | null;\n      if (!target) {\n        return;\n      }\n      const button = target.closest<HTMLButtonElement>('[data-panel]');\n      if (!button) {\n        return;\n      }\n      const panel = button.dataset.panel || '';\n      if (!panel || panel === this.activePanel) {\n        return;\n      }\n      this.activePanel = panel;\n      this.renderActivePanel();\n    });\n\n    const actions = this.container.querySelectorAll<HTMLButtonElement>('[data-debug-action]');\n    actions.forEach((button) => {\n      button.addEventListener('click', () => {\n        const action = button.dataset.debugAction || '';\n        switch (action) {\n          case 'snapshot':\n            this.stream.requestSnapshot();\n            break;\n          case 'clear':\n            this.clearAll();\n            break;\n          case 'pause':\n            this.togglePause(button);\n            break;\n          case 'clear-panel':\n            this.clearActivePanel();\n            break;\n          default:\n            break;\n        }\n      });\n    });\n  }\n\n  private renderTabs(): void {\n    const tabs = this.panels\n      .map((panel) => {\n        const active = panel === this.activePanel ? 'debug-tab--active' : '';\n        return `\n          <button class=\"debug-tab ${active}\" data-panel=\"${escapeHTML(panel)}\">\n            <span class=\"debug-tab__label\">${escapeHTML(panelLabel(panel))}</span>\n            <span class=\"debug-tab__count\" data-panel-count=\"${escapeHTML(panel)}\">0</span>\n          </button>\n        `;\n      })\n      .join('');\n    this.tabsEl.innerHTML = tabs;\n    this.updateTabCounts();\n  }\n\n  private renderActivePanel(): void {\n    this.renderTabs();\n    this.renderFilters();\n    this.renderPanel();\n  }\n\n  private renderFilters(): void {\n    const panel = this.activePanel;\n    let content = '';\n    const renderer = this.panelRenderers.get(panel);\n    if (renderer?.filters) {\n      content = renderer.filters();\n    } else if (panel === 'requests') {\n      const values = this.filters.requests;\n      content = `\n        <div class=\"debug-filter\">\n          <label>Method</label>\n          <select data-filter=\"method\">\n            ${this.renderSelectOptions(['all', 'GET', 'POST', 'PUT', 'PATCH', 'DELETE'], values.method)}\n          </select>\n        </div>\n        <div class=\"debug-filter\">\n          <label>Status</label>\n          <select data-filter=\"status\">\n            ${this.renderSelectOptions(['all', '200', '201', '204', '400', '401', '403', '404', '500'], values.status)}\n          </select>\n        </div>\n        <div class=\"debug-filter debug-filter--grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"/admin/users\" />\n        </div>\n      `;\n    } else if (panel === 'sql') {\n      const values = this.filters.sql;\n      content = `\n        <div class=\"debug-filter debug-filter--grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"SELECT\" />\n        </div>\n        <label class=\"debug-btn\">\n          <input type=\"checkbox\" data-filter=\"slowOnly\" ${values.slowOnly ? 'checked' : ''} />\n          <span>Slow only</span>\n        </label>\n        <label class=\"debug-btn\">\n          <input type=\"checkbox\" data-filter=\"errorOnly\" ${values.errorOnly ? 'checked' : ''} />\n          <span>Errors</span>\n        </label>\n      `;\n    } else if (panel === 'logs') {\n      const values = this.filters.logs;\n      content = `\n        <div class=\"debug-filter\">\n          <label>Level</label>\n          <select data-filter=\"level\">\n            ${this.renderSelectOptions(['all', 'debug', 'info', 'warn', 'error'], values.level)}\n          </select>\n        </div>\n        <div class=\"debug-filter debug-filter--grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"database\" />\n        </div>\n        <label class=\"debug-btn\">\n          <input type=\"checkbox\" data-filter=\"newestFirst\" ${values.newestFirst ? 'checked' : ''} />\n          <span>Newest first</span>\n        </label>\n        <label class=\"debug-btn\">\n          <input type=\"checkbox\" data-filter=\"autoScroll\" ${values.autoScroll ? 'checked' : ''} />\n          <span>Auto-scroll</span>\n        </label>\n      `;\n    } else if (panel === 'routes') {\n      const values = this.filters.routes;\n      content = `\n        <div class=\"debug-filter\">\n          <label>Method</label>\n          <select data-filter=\"method\">\n            ${this.renderSelectOptions(['all', 'GET', 'POST', 'PUT', 'PATCH', 'DELETE'], values.method)}\n          </select>\n        </div>\n        <div class=\"debug-filter debug-filter--grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"/admin\" />\n        </div>\n      `;\n    } else {\n      const values = this.filters.objects;\n      content = `\n        <div class=\"debug-filter debug-filter--grow\">\n          <label>Search keys</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"token\" />\n        </div>\n      `;\n    }\n\n    this.filtersEl.innerHTML = content || '<span class=\"timestamp\">No filters</span>';\n    this.bindFilterInputs();\n  }\n\n  private bindFilterInputs(): void {\n    const inputs = this.filtersEl.querySelectorAll<HTMLInputElement | HTMLSelectElement>('input, select');\n    inputs.forEach((input) => {\n      input.addEventListener('input', () => this.updateFiltersFromInputs());\n      input.addEventListener('change', () => this.updateFiltersFromInputs());\n    });\n  }\n\n  private updateFiltersFromInputs(): void {\n    const panel = this.activePanel;\n    const inputs = this.filtersEl.querySelectorAll<HTMLInputElement | HTMLSelectElement>('[data-filter]');\n    if (panel === 'requests') {\n      const next = { ...this.filters.requests };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key && key in next) {\n          next[key as keyof typeof next] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.requests = next;\n    } else if (panel === 'sql') {\n      const next = { ...this.filters.sql };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key === 'slowOnly' || key === 'errorOnly') {\n          next[key] = (input as HTMLInputElement).checked;\n        } else if (key === 'search') {\n          next[key] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.sql = next;\n    } else if (panel === 'logs') {\n      const next = { ...this.filters.logs };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key === 'autoScroll' || key === 'newestFirst') {\n          next[key] = (input as HTMLInputElement).checked;\n        } else if (key === 'level' || key === 'search') {\n          next[key] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.logs = next;\n    } else if (panel === 'routes') {\n      const next = { ...this.filters.routes };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key && key in next) {\n          next[key as keyof typeof next] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.routes = next;\n    } else {\n      const next = { ...this.filters.objects };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key && key in next) {\n          next[key as keyof typeof next] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.objects = next;\n    }\n    this.renderPanel();\n  }\n\n  private renderPanel(): void {\n    const panel = this.activePanel;\n    const renderer = this.panelRenderers.get(panel);\n    if (renderer) {\n      renderer.render();\n      return;\n    }\n    this.panelEl.classList.remove('debug-content--repl');\n\n    let content = '';\n    if (panel === 'template') {\n      content = this.renderJSONPanel('Template Context', this.state.template, this.filters.objects.search);\n    } else if (panel === 'session') {\n      content = this.renderJSONPanel('Session', this.state.session, this.filters.objects.search);\n    } else if (panel === 'config') {\n      content = this.renderJSONPanel('Config', this.state.config, this.filters.objects.search);\n    } else if (panel === 'requests') {\n      content = this.renderRequests();\n    } else if (panel === 'sql') {\n      content = this.renderSQL();\n    } else if (panel === 'logs') {\n      content = this.renderLogs();\n    } else if (panel === 'routes') {\n      content = this.renderRoutes();\n    } else if (panel === 'custom') {\n      content = this.renderCustom();\n    } else {\n      content = this.renderJSONPanel(panelLabel(panel), this.state.extra[panel], this.filters.objects.search);\n    }\n\n    this.panelEl.innerHTML = content;\n    if (panel === 'logs' && this.filters.logs.autoScroll) {\n      // When newestFirst is true, newest entries are at the top, so scroll to top\n      // When newestFirst is false, newest entries are at the bottom, so scroll to bottom\n      this.panelEl.scrollTop = this.filters.logs.newestFirst ? 0 : this.panelEl.scrollHeight;\n    }\n    this.attachExpandableRowListeners();\n    this.attachCopyButtonListeners();\n  }\n\n  private attachExpandableRowListeners(): void {\n    this.panelEl.querySelectorAll('.expandable-row').forEach((row) => {\n      row.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        // Don't toggle if clicking on a link or button\n        if (target.closest('a, button')) return;\n\n        const rowEl = e.currentTarget as HTMLElement;\n        rowEl.classList.toggle('expanded');\n      });\n    });\n  }\n\n  private attachCopyButtonListeners(): void {\n    this.panelEl.querySelectorAll<HTMLButtonElement>('[data-copy-trigger]').forEach((button) => {\n      button.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        const container = button.closest('[data-copy-content]');\n        if (!container) return;\n        const content = container.getAttribute('data-copy-content') || '';\n        copyToClipboard(content, button);\n      });\n    });\n  }\n\n  private renderReplPanel(panel: string): void {\n    this.panelEl.classList.add('debug-content--repl');\n    let replPanel = this.replPanels.get(panel);\n    if (!replPanel) {\n      replPanel = new DebugReplPanel({\n        kind: panel === 'shell' ? 'shell' : 'console',\n        debugPath: this.debugPath,\n        commands: panel === 'console' ? this.replCommands : [],\n      });\n      this.replPanels.set(panel, replPanel);\n    }\n    replPanel.attach(this.panelEl);\n  }\n\n  private renderRequests(): string {\n    const { method, status, search } = this.filters.requests;\n    const needle = search.toLowerCase();\n    const entries = this.state.requests.filter((entry) => {\n      if (method !== 'all' && (entry.method || '').toUpperCase() !== method) {\n        return false;\n      }\n      if (status !== 'all' && String(entry.status || '') !== status) {\n        return false;\n      }\n      if (needle && !(entry.path || '').toLowerCase().includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No requests captured yet.');\n    }\n\n    const rows = entries\n      .map((entry) => {\n        const methodClass = `badge--method-${(entry.method || 'get').toLowerCase()}`;\n        const statusCode = entry.status || 0;\n        const statusClass = statusCode >= 500 ? 'badge--status-error' : statusCode >= 400 ? 'badge--status-warn' : 'badge--status';\n        const rowClass = statusCode >= 400 ? 'error' : '';\n        const duration = entry.duration || 0;\n        const durationMs = typeof duration === 'number' ? duration / 1e6 : 0;\n        const durationClass = durationMs >= this.slowThresholdMs ? 'duration--slow' : '';\n        return `\n          <tr class=\"${rowClass}\">\n            <td><span class=\"badge ${methodClass}\">${escapeHTML(entry.method || 'GET')}</span></td>\n            <td><span class=\"path\">${escapeHTML(entry.path || '')}</span></td>\n            <td><span class=\"badge ${statusClass}\">${escapeHTML(statusCode)}</span></td>\n            <td><span class=\"duration ${durationClass}\">${formatDuration(entry.duration)}</span></td>\n            <td><span class=\"timestamp\">${escapeHTML(formatTimestamp(entry.timestamp))}</span></td>\n          </tr>\n        `;\n      })\n      .join('');\n\n    return `\n      <table class=\"debug-table\">\n        <thead>\n          <tr>\n            <th>Method</th>\n            <th>Path</th>\n            <th>Status</th>\n            <th>Duration</th>\n            <th>Time</th>\n          </tr>\n        </thead>\n        <tbody>${rows}</tbody>\n      </table>\n    `;\n  }\n\n  private renderSQL(): string {\n    const { search, slowOnly, errorOnly } = this.filters.sql;\n    const needle = search.toLowerCase();\n    const entries = this.state.sql.filter((entry) => {\n      if (errorOnly && !entry.error) {\n        return false;\n      }\n      if (slowOnly && !this.isSlowQuery(entry)) {\n        return false;\n      }\n      if (needle && !(entry.query || '').toLowerCase().includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No SQL queries captured yet.');\n    }\n\n    const rows = entries\n      .map((entry, index) => {\n        const isSlow = this.isSlowQuery(entry);\n        const hasError = !!entry.error;\n        const rowClasses = ['expandable-row'];\n        if (hasError) rowClasses.push('error');\n        if (isSlow) rowClasses.push('slow');\n        const durationClass = isSlow ? 'duration--slow' : '';\n        const rowId = `sql-row-${index}`;\n        const rawQuery = entry.query || '';\n        const highlightedSQL = highlightSQL(rawQuery, true);\n        return `\n          <tr class=\"${rowClasses.join(' ')}\" data-row-id=\"${rowId}\">\n            <td><span class=\"duration ${durationClass}\">${formatDuration(entry.duration)}</span></td>\n            <td>${escapeHTML(formatNumber(entry.row_count || 0))}</td>\n            <td><span class=\"timestamp\">${escapeHTML(formatTimestamp(entry.timestamp))}</span></td>\n            <td>${hasError ? `<span class=\"badge badge--status-error\">Error</span>` : ''}</td>\n            <td><span class=\"query-text\"><span class=\"expand-icon\">&#9654;</span>${escapeHTML(rawQuery)}</span></td>\n          </tr>\n          <tr class=\"expansion-row\" data-expansion-for=\"${rowId}\">\n            <td colspan=\"5\">\n              <div class=\"expanded-content\" data-copy-content=\"${escapeHTML(rawQuery)}\">\n                <div class=\"expanded-content__header\">\n                  <button class=\"debug-btn debug-copy debug-copy--sm\" data-copy-trigger=\"${rowId}\" title=\"Copy SQL\">\n                    <i class=\"iconoir-copy\"></i> Copy\n                  </button>\n                </div>\n                <pre>${highlightedSQL}</pre>\n              </div>\n            </td>\n          </tr>\n        `;\n      })\n      .join('');\n\n    return `\n      <table class=\"debug-table\">\n        <thead>\n          <tr>\n            <th>Duration</th>\n            <th>Rows</th>\n            <th>Time</th>\n            <th>Status</th>\n            <th>Query</th>\n          </tr>\n        </thead>\n        <tbody>${rows}</tbody>\n      </table>\n    `;\n  }\n\n  private renderLogs(): string {\n    const { level, search, newestFirst } = this.filters.logs;\n    const needle = search.toLowerCase();\n    let entries = this.state.logs.filter((entry) => {\n      if (level !== 'all' && (entry.level || '').toLowerCase() !== level) {\n        return false;\n      }\n      const haystack = `${entry.message || ''} ${entry.source || ''} ${formatJSON(entry.fields || {})}`.toLowerCase();\n      if (needle && !haystack.includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No logs captured yet.');\n    }\n\n    if (newestFirst) {\n      entries = [...entries].reverse();\n    }\n\n    const rows = entries\n      .map((entry) => {\n        const logLevel = (entry.level || 'info').toLowerCase();\n        const levelClass = `badge--level-${logLevel}`;\n        const isError = logLevel === 'error' || logLevel === 'fatal';\n        const rowClass = isError ? 'error' : '';\n        return `\n          <tr class=\"${rowClass}\">\n            <td><span class=\"badge ${levelClass}\">${escapeHTML((entry.level || 'info').toUpperCase())}</span></td>\n            <td><span class=\"timestamp\">${escapeHTML(formatTimestamp(entry.timestamp))}</span></td>\n            <td><span class=\"message\">${escapeHTML(entry.message || '')}</span></td>\n            <td><span class=\"timestamp\">${escapeHTML(entry.source || '')}</span></td>\n          </tr>\n        `;\n      })\n      .join('');\n\n    return `\n      <table class=\"debug-table\">\n        <thead>\n          <tr>\n            <th>Level</th>\n            <th>Time</th>\n            <th>Message</th>\n            <th>Source</th>\n          </tr>\n        </thead>\n        <tbody>${rows}</tbody>\n      </table>\n    `;\n  }\n\n  private renderRoutes(): string {\n    const { method, search } = this.filters.routes;\n    const needle = search.toLowerCase();\n    const entries = this.state.routes.filter((entry) => {\n      if (method !== 'all' && (entry.method || '').toUpperCase() !== method) {\n        return false;\n      }\n      const haystack = `${entry.path || ''} ${entry.handler || ''} ${entry.summary || ''}`.toLowerCase();\n      if (needle && !haystack.includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No routes captured yet.');\n    }\n\n    const rows = entries\n      .map((entry) => {\n        const methodClass = `badge--method-${(entry.method || 'get').toLowerCase()}`;\n        return `\n          <tr>\n            <td><span class=\"badge ${methodClass}\">${escapeHTML(entry.method || '')}</span></td>\n            <td><span class=\"path\">${escapeHTML(entry.path || '')}</span></td>\n            <td><span class=\"timestamp\">${escapeHTML(entry.handler || '')}</span></td>\n            <td><span class=\"timestamp\">${escapeHTML(entry.name || '')}</span></td>\n          </tr>\n        `;\n      })\n      .join('');\n\n    return `\n      <table class=\"debug-table debug-routes-table\">\n        <thead>\n          <tr>\n            <th>Method</th>\n            <th>Path</th>\n            <th>Handler</th>\n            <th>Name</th>\n          </tr>\n        </thead>\n        <tbody>${rows}</tbody>\n      </table>\n    `;\n  }\n\n  private renderCustom(): string {\n    const { search } = this.filters.custom;\n    const data = filterObjectByKey(this.state.custom.data, search);\n    const logs = this.state.custom.logs;\n    const highlighted = highlightJSON(data, true);\n    const rawJSON = formatJSON(data);\n\n    const logRows = logs.length\n      ? logs\n          .map((entry) => {\n            return `\n              <tr>\n                <td><span class=\"badge badge--custom\">${escapeHTML(entry.category || 'custom')}</span></td>\n                <td><span class=\"timestamp\">${escapeHTML(formatTimestamp(entry.timestamp))}</span></td>\n                <td><span class=\"message\">${escapeHTML(entry.message || '')}</span></td>\n              </tr>\n            `;\n          })\n          .join('')\n      : '';\n\n    const logPanel = logs.length\n      ? `\n        <table class=\"debug-table\">\n          <thead>\n            <tr>\n              <th>Category</th>\n              <th>Time</th>\n              <th>Message</th>\n            </tr>\n          </thead>\n          <tbody>${logRows}</tbody>\n        </table>\n      `\n      : this.renderEmptyState('No custom logs yet.');\n\n    return `\n      <div class=\"debug-json-grid\">\n        <div class=\"debug-json-panel\" data-copy-content=\"${escapeHTML(rawJSON)}\">\n          <div class=\"debug-json-header\">\n            <h3>Custom Data</h3>\n            <div class=\"debug-json-actions\">\n              <span class=\"timestamp\">${formatNumber(countPanelPayload(data))} keys</span>\n              <button class=\"debug-btn debug-copy\" data-copy-trigger=\"custom-data\" title=\"Copy to clipboard\">\n                <i class=\"iconoir-copy\"></i> Copy\n              </button>\n            </div>\n          </div>\n          <div class=\"debug-json-content\">\n            <pre>${highlighted}</pre>\n          </div>\n        </div>\n        <div class=\"debug-json-panel\">\n          <div class=\"debug-json-header\">\n            <h3>Custom Logs</h3>\n            <span class=\"timestamp\">${formatNumber(logs.length)} entries</span>\n          </div>\n          <div class=\"debug-json-content\">\n            ${logPanel}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderJSONPanel(title: string, data: any, search: string): string {\n    const isObject = data && typeof data === 'object' && !Array.isArray(data);\n    const isArray = Array.isArray(data);\n    const filtered = isObject ? filterObjectByKey(data || {}, search) : data ?? {};\n    const count = countPanelPayload(filtered);\n    const unit = isArray ? 'items' : isObject ? 'keys' : 'entries';\n    const highlighted = highlightJSON(filtered, true);\n    const rawJSON = formatJSON(filtered);\n    const copyId = `copy-${title.toLowerCase().replace(/\\s+/g, '-')}-${Date.now()}`;\n    return `\n      <section class=\"debug-json-panel\" data-copy-content=\"${escapeHTML(rawJSON)}\">\n        <div class=\"debug-json-header\">\n          <h3>${escapeHTML(title)}</h3>\n          <div class=\"debug-json-actions\">\n            <span class=\"debug-muted\">${formatNumber(count)} ${unit}</span>\n            <button class=\"debug-btn debug-copy\" data-copy-trigger=\"${copyId}\" title=\"Copy to clipboard\">\n              <i class=\"iconoir-copy\"></i> Copy\n            </button>\n          </div>\n        </div>\n        <pre>${highlighted}</pre>\n      </section>\n    `;\n  }\n\n  private panelCount(panel: string): number {\n    switch (panel) {\n      case 'template':\n        return countPanelPayload(this.state.template);\n      case 'session':\n        return countPanelPayload(this.state.session);\n      case 'requests':\n        return this.state.requests.length;\n      case 'sql':\n        return this.state.sql.length;\n      case 'logs':\n        return this.state.logs.length;\n      case 'config':\n        return countPanelPayload(this.state.config);\n      case 'routes':\n        return this.state.routes.length;\n      case 'custom':\n        return countPanelPayload(this.state.custom.data) + this.state.custom.logs.length;\n      default:\n        return countPanelPayload(this.state.extra[panel]);\n    }\n  }\n\n  private renderEmptyState(message: string): string {\n    return `\n      <div class=\"debug-empty\">\n        <p>${escapeHTML(message)}</p>\n      </div>\n    `;\n  }\n\n  private renderSelectOptions(options: string[], current: string): string {\n    return options\n      .map((option) => {\n        const selected = option.toLowerCase() === current.toLowerCase() ? 'selected' : '';\n        return `<option value=\"${escapeHTML(option)}\" ${selected}>${escapeHTML(option)}</option>`;\n      })\n      .join('');\n  }\n\n  private updateTabCounts(): void {\n    this.panels.forEach((panel) => {\n      const count = this.panelCount(panel);\n      const badge = this.tabsEl.querySelector<HTMLElement>(`[data-panel-count=\"${panel}\"]`);\n      if (badge) {\n        badge.textContent = formatNumber(count);\n      }\n    });\n  }\n\n  private updateConnectionStatus(status: DebugStreamStatus): void {\n    this.connectionEl.textContent = status;\n    this.statusEl.setAttribute('data-status', status);\n  }\n\n  private updateStatusMeta(): void {\n    this.eventCountEl.textContent = `${formatNumber(this.eventCount)} events`;\n    if (this.lastEventAt) {\n      this.lastEventEl.textContent = this.lastEventAt.toLocaleTimeString();\n    }\n  }\n\n  private handleEvent(event: DebugEvent): void {\n    if (!event || !event.type) {\n      return;\n    }\n    if (event.type === 'snapshot') {\n      this.applySnapshot(event.payload as DebugSnapshot);\n      return;\n    }\n\n    this.eventCount += 1;\n    this.lastEventAt = new Date();\n    this.updateStatusMeta();\n\n    if (this.paused) {\n      return;\n    }\n\n    const panel = eventToPanel[event.type] || event.type;\n    switch (event.type) {\n      case 'request':\n        this.state.requests.push(event.payload as RequestEntry);\n        this.trim(this.state.requests, this.maxLogEntries);\n        break;\n      case 'sql':\n        this.state.sql.push(event.payload as SQLEntry);\n        this.trim(this.state.sql, this.maxSQLQueries);\n        break;\n      case 'log':\n        this.state.logs.push(event.payload as LogEntry);\n        this.trim(this.state.logs, this.maxLogEntries);\n        break;\n      case 'template':\n        this.state.template = (event.payload as Record<string, any>) || {};\n        break;\n      case 'session':\n        this.state.session = (event.payload as Record<string, any>) || {};\n        break;\n      case 'custom':\n        this.handleCustomEvent(event.payload);\n        break;\n      default:\n        if (!knownPanels.has(panel)) {\n          this.state.extra[panel] = event.payload;\n        }\n        break;\n    }\n\n    this.updateTabCounts();\n    if (panel === this.activePanel) {\n      this.renderPanel();\n    }\n  }\n\n  private handleCustomEvent(payload: any): void {\n    if (!payload) {\n      return;\n    }\n    if (typeof payload === 'object' && 'key' in payload && 'value' in payload) {\n      setNestedValue(this.state.custom.data, String(payload.key), payload.value);\n      return;\n    }\n    if (typeof payload === 'object' && ('category' in payload || 'message' in payload)) {\n      this.state.custom.logs.push(payload as CustomLogEntry);\n      this.trim(this.state.custom.logs, this.maxLogEntries);\n      return;\n    }\n  }\n\n  private applySnapshot(snapshot: DebugSnapshot): void {\n    const next = snapshot || {};\n    this.state.template = next.template || {};\n    this.state.session = next.session || {};\n    this.state.requests = ensureArray<RequestEntry>(next.requests);\n    this.state.sql = ensureArray<SQLEntry>(next.sql);\n    this.state.logs = ensureArray<LogEntry>(next.logs);\n    this.state.config = next.config || {};\n    this.state.routes = ensureArray<RouteEntry>(next.routes);\n    const custom = next.custom || {};\n    this.state.custom = {\n      data: custom.data || {},\n      logs: ensureArray<CustomLogEntry>(custom.logs),\n    };\n    const extra: Record<string, any> = {};\n    this.panels.forEach((panel) => {\n      if (!knownPanels.has(panel) && panel in next) {\n        extra[panel] = next[panel];\n      }\n    });\n    this.state.extra = extra;\n\n    this.updateTabCounts();\n    this.renderPanel();\n  }\n\n  private trim<T>(list: T[], max: number): void {\n    if (!Array.isArray(list) || max <= 0) {\n      return;\n    }\n    while (list.length > max) {\n      list.shift();\n    }\n  }\n\n  private isSlowQuery(entry: SQLEntry): boolean {\n    if (!entry || entry.duration === undefined || entry.duration === null) {\n      return false;\n    }\n    const nanos = Number(entry.duration);\n    if (Number.isNaN(nanos)) {\n      return false;\n    }\n    const ms = nanos / 1e6;\n    return ms >= this.slowThresholdMs;\n  }\n\n  private async fetchSnapshot(): Promise<void> {\n    if (!this.debugPath) {\n      return;\n    }\n    try {\n      const response = await fetch(`${this.debugPath}/api/snapshot`, {\n        credentials: 'same-origin',\n      });\n      if (!response.ok) {\n        return;\n      }\n      const payload = (await response.json()) as DebugSnapshot;\n      this.applySnapshot(payload);\n    } catch {\n      // ignore fetch errors\n    }\n  }\n\n  private clearAll(): void {\n    if (!this.debugPath) {\n      return;\n    }\n    this.stream.clear();\n    fetch(`${this.debugPath}/api/clear`, { method: 'POST', credentials: 'same-origin' }).catch(() => {\n      // ignore\n    });\n  }\n\n  private clearActivePanel(): void {\n    if (!this.debugPath) {\n      return;\n    }\n    const panel = this.activePanel;\n    this.stream.clear([panel]);\n    fetch(`${this.debugPath}/api/clear/${panel}`, { method: 'POST', credentials: 'same-origin' }).catch(() => {\n      // ignore\n    });\n  }\n\n  private togglePause(button: HTMLButtonElement): void {\n    this.paused = !this.paused;\n    button.textContent = this.paused ? 'Resume' : 'Pause';\n    if (!this.paused) {\n      this.stream.requestSnapshot();\n    }\n  }\n}\n\nexport const initDebugPanel = (container?: HTMLElement | null): DebugPanel | null => {\n  const target = container || document.querySelector<HTMLElement>('[data-debug-console]');\n  if (!target) {\n    return null;\n  }\n  return new DebugPanel(target);\n};\n","import { DebugPanel, initDebugPanel } from './debug-panel.js';\nimport { DebugStream } from './debug-stream.js';\n\nconst autoInit = () => {\n  initDebugPanel();\n};\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', autoInit);\n} else {\n  autoInit();\n}\n\nexport { DebugPanel, DebugStream, initDebugPanel };\n"],"names":["defaultPanels","replPanelIDs","knownPanels","panelLabels","panelEventMap","eventToPanel","parseJSON","value","normalizeReplCommands","commands","item","raw","command","description","tags","tag","aliases","alias","mutates","escapeHTML","formatTimestamp","date","formatDuration","nanos","ms","formatNumber","num","formatJSON","copyToClipboard","text","button","originalHTML","countPanelPayload","normalizePanelList","panel","panelLabel","panelId","match","filterObjectByKey","data","search","needle","out","key","setNestedValue","dest","parts","part","current","i","ensureArray","parseNumber","fallback","parsed","DebugPanel","container","panelsData","DebugStream","event","status","selector","parent","el","target","tabs","content","renderer","values","input","inputs","next","row","replPanel","DebugReplPanel","method","entries","entry","methodClass","statusCode","statusClass","rowClass","duration","durationClass","slowOnly","errorOnly","index","isSlow","hasError","rowClasses","rowId","rawQuery","highlightedSQL","highlightSQL","level","newestFirst","haystack","logLevel","levelClass","logs","highlighted","highlightJSON","rawJSON","logRows","logPanel","title","isObject","isArray","filtered","count","unit","copyId","message","options","option","selected","badge","payload","snapshot","custom","extra","list","max","response","initDebugPanel","autoInit"],"mappings":"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"}