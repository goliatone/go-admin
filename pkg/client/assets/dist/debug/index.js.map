{"version":3,"file":"index.js","sources":["../../src/debug/debug-stream.ts","../../src/debug/debug-panel.ts","../../src/debug/index.ts"],"sourcesContent":["export type DebugEvent = {\n  type: string;\n  payload: any;\n  timestamp: string;\n};\n\nexport type DebugCommand = {\n  type: string;\n  panels?: string[];\n};\n\nexport type DebugStreamStatus = 'connected' | 'disconnected' | 'reconnecting' | 'error';\n\nexport type DebugStreamOptions = {\n  basePath: string;\n  maxReconnectAttempts?: number;\n  reconnectDelayMs?: number;\n  maxReconnectDelayMs?: number;\n  onEvent?: (event: DebugEvent) => void;\n  onStatusChange?: (status: DebugStreamStatus) => void;\n  onError?: (event: Event) => void;\n};\n\nconst defaultReconnectDelayMs = 1000;\nconst defaultMaxReconnectDelayMs = 12000;\nconst defaultMaxReconnectAttempts = 8;\n\nconst normalizeBasePath = (basePath: string): string => {\n  const trimmed = (basePath || '').trim();\n  if (!trimmed) {\n    return '';\n  }\n  if (trimmed.startsWith('/')) {\n    return trimmed.replace(/\\/+$/, '');\n  }\n  return `/${trimmed.replace(/\\/+$/, '')}`;\n};\n\nconst buildWebSocketURL = (basePath: string): string => {\n  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n  const normalized = normalizeBasePath(basePath);\n  return `${protocol}//${window.location.host}${normalized}/ws`;\n};\n\nexport class DebugStream {\n  private options: DebugStreamOptions;\n  private ws: WebSocket | null = null;\n  private reconnectTimer: number | null = null;\n  private reconnectAttempts = 0;\n  private manualClose = false;\n  private pendingCommands: DebugCommand[] = [];\n  private status: DebugStreamStatus = 'disconnected';\n\n  constructor(options: DebugStreamOptions) {\n    this.options = options;\n  }\n\n  connect(): void {\n    if (this.ws && (this.ws.readyState === WebSocket.OPEN || this.ws.readyState === WebSocket.CONNECTING)) {\n      return;\n    }\n\n    this.manualClose = false;\n    const url = buildWebSocketURL(this.options.basePath);\n    this.ws = new WebSocket(url);\n\n    this.ws.onopen = () => {\n      this.reconnectAttempts = 0;\n      this.setStatus('connected');\n      this.flushPending();\n    };\n\n    this.ws.onmessage = (event) => {\n      if (!event || typeof event.data !== 'string') {\n        return;\n      }\n      try {\n        const parsed = JSON.parse(event.data) as DebugEvent;\n        this.options.onEvent?.(parsed);\n      } catch {\n        // ignore malformed payloads\n      }\n    };\n\n    this.ws.onclose = () => {\n      this.ws = null;\n      if (this.manualClose) {\n        this.setStatus('disconnected');\n        return;\n      }\n      this.setStatus('reconnecting');\n      this.scheduleReconnect();\n    };\n\n    this.ws.onerror = (event) => {\n      this.options.onError?.(event);\n      this.setStatus('error');\n    };\n  }\n\n  close(): void {\n    this.manualClose = true;\n    if (this.reconnectTimer !== null) {\n      window.clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n    if (this.ws) {\n      this.ws.close();\n    }\n  }\n\n  sendCommand(cmd: DebugCommand): void {\n    if (!cmd || !cmd.type) {\n      return;\n    }\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.ws.send(JSON.stringify(cmd));\n      return;\n    }\n    this.pendingCommands.push(cmd);\n  }\n\n  subscribe(panels: string[]): void {\n    this.sendCommand({ type: 'subscribe', panels });\n  }\n\n  unsubscribe(panels: string[]): void {\n    this.sendCommand({ type: 'unsubscribe', panels });\n  }\n\n  requestSnapshot(): void {\n    this.sendCommand({ type: 'snapshot' });\n  }\n\n  clear(panels?: string[]): void {\n    this.sendCommand({ type: 'clear', panels });\n  }\n\n  getStatus(): DebugStreamStatus {\n    return this.status;\n  }\n\n  private setStatus(status: DebugStreamStatus): void {\n    if (this.status === status) {\n      return;\n    }\n    this.status = status;\n    this.options.onStatusChange?.(status);\n  }\n\n  private flushPending(): void {\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n      return;\n    }\n    if (this.pendingCommands.length === 0) {\n      return;\n    }\n    const pending = [...this.pendingCommands];\n    this.pendingCommands = [];\n    for (const cmd of pending) {\n      this.ws.send(JSON.stringify(cmd));\n    }\n  }\n\n  private scheduleReconnect(): void {\n    const maxAttempts = this.options.maxReconnectAttempts ?? defaultMaxReconnectAttempts;\n    const baseDelay = this.options.reconnectDelayMs ?? defaultReconnectDelayMs;\n    const maxDelay = this.options.maxReconnectDelayMs ?? defaultMaxReconnectDelayMs;\n    if (this.reconnectAttempts >= maxAttempts) {\n      this.setStatus('disconnected');\n      return;\n    }\n    const attempt = this.reconnectAttempts;\n    const backoff = Math.min(baseDelay * Math.pow(2, attempt), maxDelay);\n    const jitter = backoff * (0.2 + Math.random() * 0.3);\n    this.reconnectAttempts += 1;\n    this.reconnectTimer = window.setTimeout(() => {\n      this.connect();\n    }, backoff + jitter);\n  }\n}\n","import { DebugStream, type DebugEvent, type DebugStreamStatus } from './debug-stream.js';\n\ntype RequestEntry = {\n  id?: string;\n  timestamp?: string;\n  method?: string;\n  path?: string;\n  status?: number;\n  duration?: number;\n  headers?: Record<string, string>;\n  query?: Record<string, string>;\n  error?: string;\n};\n\ntype SQLEntry = {\n  id?: string;\n  timestamp?: string;\n  query?: string;\n  args?: any[];\n  duration?: number;\n  row_count?: number;\n  error?: string;\n};\n\ntype LogEntry = {\n  timestamp?: string;\n  level?: string;\n  message?: string;\n  fields?: Record<string, any>;\n  source?: string;\n};\n\ntype CustomLogEntry = {\n  timestamp?: string;\n  category?: string;\n  message?: string;\n  fields?: Record<string, any>;\n};\n\ntype RouteEntry = {\n  method?: string;\n  path?: string;\n  name?: string;\n  handler?: string;\n  middleware?: string[];\n  summary?: string;\n  tags?: string[];\n};\n\ntype CustomSnapshot = {\n  data?: Record<string, any>;\n  logs?: CustomLogEntry[];\n};\n\ntype DebugSnapshot = {\n  template?: Record<string, any>;\n  session?: Record<string, any>;\n  requests?: RequestEntry[];\n  sql?: SQLEntry[];\n  logs?: LogEntry[];\n  config?: Record<string, any>;\n  routes?: RouteEntry[];\n  custom?: CustomSnapshot;\n};\n\ntype PanelFilters = {\n  requests: { method: string; status: string; search: string };\n  sql: { search: string; slowOnly: boolean; errorOnly: boolean };\n  logs: { level: string; search: string; autoScroll: boolean };\n  routes: { method: string; search: string };\n  custom: { search: string };\n  objects: { search: string };\n};\n\ntype DebugState = {\n  template: Record<string, any>;\n  session: Record<string, any>;\n  requests: RequestEntry[];\n  sql: SQLEntry[];\n  logs: LogEntry[];\n  config: Record<string, any>;\n  routes: RouteEntry[];\n  custom: { data: Record<string, any>; logs: CustomLogEntry[] };\n};\n\nconst defaultPanels = ['template', 'session', 'requests', 'sql', 'logs', 'config', 'routes', 'custom'];\n\nconst panelLabels: Record<string, string> = {\n  template: 'Template',\n  session: 'Session',\n  requests: 'Requests',\n  sql: 'SQL Queries',\n  logs: 'Logs',\n  config: 'Config',\n  routes: 'Routes',\n  custom: 'Custom',\n};\n\nconst panelEventMap: Record<string, string> = {\n  template: 'template',\n  session: 'session',\n  requests: 'request',\n  sql: 'sql',\n  logs: 'log',\n  custom: 'custom',\n};\n\nconst eventToPanel: Record<string, string> = {\n  request: 'requests',\n  sql: 'sql',\n  log: 'logs',\n  template: 'template',\n  session: 'session',\n  custom: 'custom',\n};\n\nconst parseJSON = (value: string | undefined): any => {\n  if (!value) {\n    return null;\n  }\n  try {\n    return JSON.parse(value);\n  } catch {\n    return null;\n  }\n};\n\nconst escapeHTML = (value: any): string => {\n  const str = String(value ?? '');\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n};\n\nconst formatTimestamp = (value: any): string => {\n  if (!value) {\n    return '';\n  }\n  if (typeof value === 'number') {\n    return new Date(value).toLocaleTimeString();\n  }\n  if (typeof value === 'string') {\n    const date = new Date(value);\n    if (!Number.isNaN(date.getTime())) {\n      return date.toLocaleTimeString();\n    }\n    return value;\n  }\n  return '';\n};\n\nconst formatDuration = (value: any): string => {\n  if (value === null || value === undefined) {\n    return '0ms';\n  }\n  if (typeof value === 'string') {\n    return value;\n  }\n  const nanos = Number(value);\n  if (Number.isNaN(nanos)) {\n    return '0ms';\n  }\n  const ms = nanos / 1e6;\n  if (ms < 1) {\n    const micros = nanos / 1e3;\n    return `${micros.toFixed(1)}us`;\n  }\n  if (ms < 1000) {\n    return `${ms.toFixed(2)}ms`;\n  }\n  return `${(ms / 1000).toFixed(2)}s`;\n};\n\nconst formatNumber = (value: any): string => {\n  if (value === null || value === undefined || value === '') {\n    return '0';\n  }\n  const num = Number(value);\n  if (Number.isNaN(num)) {\n    return String(value);\n  }\n  return num.toLocaleString();\n};\n\nconst formatJSON = (value: any): string => {\n  if (value === undefined) {\n    return '{}';\n  }\n  try {\n    return JSON.stringify(value, null, 2);\n  } catch {\n    return String(value ?? '');\n  }\n};\n\nconst normalizePanelList = (value: any): string[] => {\n  if (Array.isArray(value) && value.length > 0) {\n    return value.filter((panel) => typeof panel === 'string' && panel.trim()).map((panel) => panel.trim());\n  }\n  return [...defaultPanels];\n};\n\nconst panelLabel = (panelId: string): string => {\n  if (panelLabels[panelId]) {\n    return panelLabels[panelId];\n  }\n  if (!panelId) {\n    return '';\n  }\n  return panelId\n    .replace(/[-_.]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n    .replace(/\\bsql\\b/i, 'SQL')\n    .replace(/\\b([a-z])/g, (match) => match.toUpperCase());\n};\n\nconst filterObjectByKey = (data: Record<string, any>, search: string): Record<string, any> => {\n  if (!search) {\n    return data;\n  }\n  const needle = search.toLowerCase();\n  const out: Record<string, any> = {};\n  for (const [key, value] of Object.entries(data || {})) {\n    if (key.toLowerCase().includes(needle)) {\n      out[key] = value;\n    }\n  }\n  return out;\n};\n\nconst setNestedValue = (dest: Record<string, any>, key: string, value: any): void => {\n  if (!dest || !key) {\n    return;\n  }\n  const parts = key.split('.').map((part) => part.trim()).filter(Boolean);\n  if (parts.length === 0) {\n    return;\n  }\n  let current = dest;\n  for (let i = 0; i < parts.length - 1; i += 1) {\n    const part = parts[i];\n    if (!current[part] || typeof current[part] !== 'object') {\n      current[part] = {};\n    }\n    current = current[part];\n  }\n  current[parts[parts.length - 1]] = value;\n};\n\nconst ensureArray = <T>(value: any): T[] => (Array.isArray(value) ? value : []);\n\nconst parseNumber = (value: string | undefined, fallback: number): number => {\n  if (!value) {\n    return fallback;\n  }\n  const parsed = Number(value);\n  if (Number.isNaN(parsed)) {\n    return fallback;\n  }\n  return parsed;\n};\n\nexport class DebugPanel {\n  private container: HTMLElement;\n  private debugPath: string;\n  private panels: string[];\n  private activePanel: string;\n  private state: DebugState;\n  private filters: PanelFilters;\n  private paused = false;\n  private maxLogEntries: number;\n  private maxSQLQueries: number;\n  private slowThresholdMs: number;\n  private eventCount = 0;\n  private lastEventAt: Date | null = null;\n  private stream: DebugStream;\n  private tabsEl: HTMLElement;\n  private panelEl: HTMLElement;\n  private filtersEl: HTMLElement;\n  private statusEl: HTMLElement;\n  private connectionEl: HTMLElement;\n  private eventCountEl: HTMLElement;\n  private lastEventEl: HTMLElement;\n\n  constructor(container: HTMLElement) {\n    this.container = container;\n    const panelsData = parseJSON(container.dataset.panels);\n    this.panels = normalizePanelList(panelsData);\n    this.activePanel = this.panels[0] || 'template';\n\n    this.debugPath = container.dataset.debugPath || '';\n    this.maxLogEntries = parseNumber(container.dataset.maxLogEntries, 500);\n    this.maxSQLQueries = parseNumber(container.dataset.maxSqlQueries, 200);\n    this.slowThresholdMs = parseNumber(container.dataset.slowThresholdMs, 50);\n\n    this.state = {\n      template: {},\n      session: {},\n      requests: [],\n      sql: [],\n      logs: [],\n      config: {},\n      routes: [],\n      custom: { data: {}, logs: [] },\n    };\n\n    this.filters = {\n      requests: { method: 'all', status: 'all', search: '' },\n      sql: { search: '', slowOnly: false, errorOnly: false },\n      logs: { level: 'all', search: '', autoScroll: true },\n      routes: { method: 'all', search: '' },\n      custom: { search: '' },\n      objects: { search: '' },\n    };\n\n    this.tabsEl = this.requireElement('[data-debug-tabs]');\n    this.panelEl = this.requireElement('[data-debug-panel]');\n    this.filtersEl = this.requireElement('[data-debug-filters]');\n    this.statusEl = this.requireElement('[data-debug-status]');\n    this.connectionEl = this.requireElement('[data-debug-connection]');\n    this.eventCountEl = this.requireElement('[data-debug-events]');\n    this.lastEventEl = this.requireElement('[data-debug-last]');\n\n    this.renderTabs();\n    this.renderActivePanel();\n    this.bindActions();\n\n    this.stream = new DebugStream({\n      basePath: this.debugPath,\n      onEvent: (event) => this.handleEvent(event),\n      onStatusChange: (status) => this.updateConnectionStatus(status),\n    });\n\n    this.fetchSnapshot();\n    this.stream.connect();\n    this.stream.subscribe(this.panels.map((panel) => panelEventMap[panel] || panel));\n  }\n\n  private requireElement(selector: string): HTMLElement {\n    const el = this.container.querySelector(selector);\n    if (!el) {\n      throw new Error(`Missing debug element: ${selector}`);\n    }\n    return el as HTMLElement;\n  }\n\n  private bindActions(): void {\n    this.tabsEl.addEventListener('click', (event) => {\n      const target = event.target as HTMLElement | null;\n      if (!target) {\n        return;\n      }\n      const button = target.closest<HTMLButtonElement>('[data-panel]');\n      if (!button) {\n        return;\n      }\n      const panel = button.dataset.panel || '';\n      if (!panel || panel === this.activePanel) {\n        return;\n      }\n      this.activePanel = panel;\n      this.renderActivePanel();\n    });\n\n    const actions = this.container.querySelectorAll<HTMLButtonElement>('[data-debug-action]');\n    actions.forEach((button) => {\n      button.addEventListener('click', () => {\n        const action = button.dataset.debugAction || '';\n        switch (action) {\n          case 'snapshot':\n            this.stream.requestSnapshot();\n            break;\n          case 'clear':\n            this.clearAll();\n            break;\n          case 'pause':\n            this.togglePause(button);\n            break;\n          case 'clear-panel':\n            this.clearActivePanel();\n            break;\n          default:\n            break;\n        }\n      });\n    });\n  }\n\n  private renderTabs(): void {\n    const tabs = this.panels\n      .map((panel) => {\n        const active = panel === this.activePanel ? 'debug-tab--active' : '';\n        return `\n          <button class=\"debug-tab ${active}\" data-panel=\"${escapeHTML(panel)}\">\n            <span class=\"debug-tab__label\">${escapeHTML(panelLabel(panel))}</span>\n            <span class=\"debug-tab__count\" data-panel-count=\"${escapeHTML(panel)}\">0</span>\n          </button>\n        `;\n      })\n      .join('');\n    this.tabsEl.innerHTML = tabs;\n    this.updateTabCounts();\n  }\n\n  private renderActivePanel(): void {\n    this.renderTabs();\n    this.renderFilters();\n    this.renderPanel();\n  }\n\n  private renderFilters(): void {\n    const panel = this.activePanel;\n    let content = '';\n    if (panel === 'requests') {\n      const values = this.filters.requests;\n      content = `\n        <div class=\"debug-filter-group\">\n          <label>Method</label>\n          <select data-filter=\"method\">\n            ${this.renderSelectOptions(['all', 'GET', 'POST', 'PUT', 'PATCH', 'DELETE'], values.method)}\n          </select>\n        </div>\n        <div class=\"debug-filter-group\">\n          <label>Status</label>\n          <select data-filter=\"status\">\n            ${this.renderSelectOptions(['all', '200', '201', '204', '400', '401', '403', '404', '500'], values.status)}\n          </select>\n        </div>\n        <div class=\"debug-filter-group grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"/admin/users\" />\n        </div>\n      `;\n    } else if (panel === 'sql') {\n      const values = this.filters.sql;\n      content = `\n        <div class=\"debug-filter-group grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"SELECT\" />\n        </div>\n        <label class=\"debug-toggle\">\n          <input type=\"checkbox\" data-filter=\"slowOnly\" ${values.slowOnly ? 'checked' : ''} />\n          <span>Slow only</span>\n        </label>\n        <label class=\"debug-toggle\">\n          <input type=\"checkbox\" data-filter=\"errorOnly\" ${values.errorOnly ? 'checked' : ''} />\n          <span>Errors</span>\n        </label>\n      `;\n    } else if (panel === 'logs') {\n      const values = this.filters.logs;\n      content = `\n        <div class=\"debug-filter-group\">\n          <label>Level</label>\n          <select data-filter=\"level\">\n            ${this.renderSelectOptions(['all', 'debug', 'info', 'warn', 'error'], values.level)}\n          </select>\n        </div>\n        <div class=\"debug-filter-group grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"database\" />\n        </div>\n        <label class=\"debug-toggle\">\n          <input type=\"checkbox\" data-filter=\"autoScroll\" ${values.autoScroll ? 'checked' : ''} />\n          <span>Auto-scroll</span>\n        </label>\n      `;\n    } else if (panel === 'routes') {\n      const values = this.filters.routes;\n      content = `\n        <div class=\"debug-filter-group\">\n          <label>Method</label>\n          <select data-filter=\"method\">\n            ${this.renderSelectOptions(['all', 'GET', 'POST', 'PUT', 'PATCH', 'DELETE'], values.method)}\n          </select>\n        </div>\n        <div class=\"debug-filter-group grow\">\n          <label>Search</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"/admin\" />\n        </div>\n      `;\n    } else {\n      const values = this.filters.objects;\n      content = `\n        <div class=\"debug-filter-group grow\">\n          <label>Search keys</label>\n          <input type=\"search\" data-filter=\"search\" value=\"${escapeHTML(values.search)}\" placeholder=\"token\" />\n        </div>\n      `;\n    }\n\n    this.filtersEl.innerHTML = content || '<span class=\"debug-muted\">No filters</span>';\n    this.bindFilterInputs();\n  }\n\n  private bindFilterInputs(): void {\n    const inputs = this.filtersEl.querySelectorAll<HTMLInputElement | HTMLSelectElement>('input, select');\n    inputs.forEach((input) => {\n      input.addEventListener('input', () => this.updateFiltersFromInputs());\n      input.addEventListener('change', () => this.updateFiltersFromInputs());\n    });\n  }\n\n  private updateFiltersFromInputs(): void {\n    const panel = this.activePanel;\n    const inputs = this.filtersEl.querySelectorAll<HTMLInputElement | HTMLSelectElement>('[data-filter]');\n    if (panel === 'requests') {\n      const next = { ...this.filters.requests };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key && key in next) {\n          next[key as keyof typeof next] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.requests = next;\n    } else if (panel === 'sql') {\n      const next = { ...this.filters.sql };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key === 'slowOnly' || key === 'errorOnly') {\n          next[key] = (input as HTMLInputElement).checked;\n        } else if (key === 'search') {\n          next[key] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.sql = next;\n    } else if (panel === 'logs') {\n      const next = { ...this.filters.logs };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key === 'autoScroll') {\n          next[key] = (input as HTMLInputElement).checked;\n        } else if (key === 'level' || key === 'search') {\n          next[key] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.logs = next;\n    } else if (panel === 'routes') {\n      const next = { ...this.filters.routes };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key && key in next) {\n          next[key as keyof typeof next] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.routes = next;\n    } else {\n      const next = { ...this.filters.objects };\n      inputs.forEach((input) => {\n        const key = input.dataset.filter || '';\n        if (key && key in next) {\n          next[key as keyof typeof next] = (input as HTMLInputElement).value;\n        }\n      });\n      this.filters.objects = next;\n    }\n    this.renderPanel();\n  }\n\n  private renderPanel(): void {\n    const panel = this.activePanel;\n    let content = '';\n    if (panel === 'template') {\n      content = this.renderJSONPanel('Template Context', this.state.template, this.filters.objects.search);\n    } else if (panel === 'session') {\n      content = this.renderJSONPanel('Session', this.state.session, this.filters.objects.search);\n    } else if (panel === 'config') {\n      content = this.renderJSONPanel('Config', this.state.config, this.filters.objects.search);\n    } else if (panel === 'requests') {\n      content = this.renderRequests();\n    } else if (panel === 'sql') {\n      content = this.renderSQL();\n    } else if (panel === 'logs') {\n      content = this.renderLogs();\n    } else if (panel === 'routes') {\n      content = this.renderRoutes();\n    } else if (panel === 'custom') {\n      content = this.renderCustom();\n    } else {\n      content = this.renderJSONPanel(panelLabel(panel), (this.state as any)[panel] || {}, this.filters.objects.search);\n    }\n\n    this.panelEl.innerHTML = content;\n    if (panel === 'logs' && this.filters.logs.autoScroll) {\n      this.panelEl.scrollTop = this.panelEl.scrollHeight;\n    }\n  }\n\n  private renderRequests(): string {\n    const { method, status, search } = this.filters.requests;\n    const needle = search.toLowerCase();\n    const entries = this.state.requests.filter((entry) => {\n      if (method !== 'all' && (entry.method || '').toUpperCase() !== method) {\n        return false;\n      }\n      if (status !== 'all' && String(entry.status || '') !== status) {\n        return false;\n      }\n      if (needle && !(entry.path || '').toLowerCase().includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No requests captured yet.');\n    }\n\n    const rows = entries\n      .map((entry) => {\n        const headers = entry.headers ? formatJSON(entry.headers) : '{}';\n        const query = entry.query ? formatJSON(entry.query) : '{}';\n        return `\n          <article class=\"debug-card\">\n            <div class=\"debug-card__row\">\n              <span class=\"debug-badge debug-badge--method\">${escapeHTML(entry.method || 'GET')}</span>\n              <span class=\"debug-card__path\">${escapeHTML(entry.path || '')}</span>\n              <span class=\"debug-badge debug-badge--status\">${escapeHTML(entry.status || 0)}</span>\n              <span class=\"debug-card__meta\">${formatDuration(entry.duration)}</span>\n              <span class=\"debug-card__meta\">${escapeHTML(formatTimestamp(entry.timestamp))}</span>\n            </div>\n            <details class=\"debug-card__details\">\n              <summary>Details</summary>\n              ${entry.error ? `<div class=\"debug-card__error\">${escapeHTML(entry.error)}</div>` : ''}\n              <div class=\"debug-card__grid\">\n                <div>\n                  <h4>Query</h4>\n                  <pre>${escapeHTML(query)}</pre>\n                </div>\n                <div>\n                  <h4>Headers</h4>\n                  <pre>${escapeHTML(headers)}</pre>\n                </div>\n              </div>\n            </details>\n          </article>\n        `;\n      })\n      .join('');\n\n    return `<div class=\"debug-stack\">${rows}</div>`;\n  }\n\n  private renderSQL(): string {\n    const { search, slowOnly, errorOnly } = this.filters.sql;\n    const needle = search.toLowerCase();\n    const entries = this.state.sql.filter((entry) => {\n      if (errorOnly && !entry.error) {\n        return false;\n      }\n      if (slowOnly && !this.isSlowQuery(entry)) {\n        return false;\n      }\n      if (needle && !(entry.query || '').toLowerCase().includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No SQL queries captured yet.');\n    }\n\n    const rows = entries\n      .map((entry) => {\n        const isSlow = this.isSlowQuery(entry);\n        const args = entry.args ? formatJSON(entry.args) : '[]';\n        return `\n          <article class=\"debug-card ${isSlow ? 'debug-card--slow' : ''}\">\n            <div class=\"debug-card__row\">\n              <span class=\"debug-badge debug-badge--sql\">SQL</span>\n              <span class=\"debug-card__meta\">${escapeHTML(formatTimestamp(entry.timestamp))}</span>\n              <span class=\"debug-card__meta\">${formatDuration(entry.duration)}</span>\n              <span class=\"debug-card__meta\">Rows: ${escapeHTML(formatNumber(entry.row_count || 0))}</span>\n              ${entry.error ? `<span class=\"debug-badge debug-badge--error\">Error</span>` : ''}\n            </div>\n            <pre class=\"debug-code\">${escapeHTML(entry.query || '')}</pre>\n            <div class=\"debug-card__grid\">\n              <div>\n                <h4>Args</h4>\n                <pre>${escapeHTML(args)}</pre>\n              </div>\n              ${entry.error ? `<div><h4>Error</h4><pre>${escapeHTML(entry.error)}</pre></div>` : ''}\n            </div>\n          </article>\n        `;\n      })\n      .join('');\n\n    return `<div class=\"debug-stack\">${rows}</div>`;\n  }\n\n  private renderLogs(): string {\n    const { level, search } = this.filters.logs;\n    const needle = search.toLowerCase();\n    const entries = this.state.logs.filter((entry) => {\n      if (level !== 'all' && (entry.level || '').toLowerCase() !== level) {\n        return false;\n      }\n      const haystack = `${entry.message || ''} ${entry.source || ''} ${formatJSON(entry.fields || {})}`.toLowerCase();\n      if (needle && !haystack.includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No logs captured yet.');\n    }\n\n    const rows = entries\n      .map((entry) => {\n        return `\n          <article class=\"debug-card\">\n            <div class=\"debug-card__row\">\n              <span class=\"debug-badge debug-badge--level\">${escapeHTML((entry.level || 'info').toUpperCase())}</span>\n              <span class=\"debug-card__meta\">${escapeHTML(formatTimestamp(entry.timestamp))}</span>\n              <span class=\"debug-card__path\">${escapeHTML(entry.message || '')}</span>\n            </div>\n            <div class=\"debug-card__grid\">\n              ${entry.source ? `<div><h4>Source</h4><pre>${escapeHTML(entry.source)}</pre></div>` : ''}\n              ${entry.fields ? `<div><h4>Fields</h4><pre>${escapeHTML(formatJSON(entry.fields))}</pre></div>` : ''}\n            </div>\n          </article>\n        `;\n      })\n      .join('');\n\n    return `<div class=\"debug-stack\">${rows}</div>`;\n  }\n\n  private renderRoutes(): string {\n    const { method, search } = this.filters.routes;\n    const needle = search.toLowerCase();\n    const entries = this.state.routes.filter((entry) => {\n      if (method !== 'all' && (entry.method || '').toUpperCase() !== method) {\n        return false;\n      }\n      const haystack = `${entry.path || ''} ${entry.handler || ''} ${entry.summary || ''}`.toLowerCase();\n      if (needle && !haystack.includes(needle)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (entries.length === 0) {\n      return this.renderEmptyState('No routes captured yet.');\n    }\n\n    const rows = entries\n      .map((entry) => {\n        return `\n          <article class=\"debug-card\">\n            <div class=\"debug-card__row\">\n              <span class=\"debug-badge debug-badge--method\">${escapeHTML(entry.method || '')}</span>\n              <span class=\"debug-card__path\">${escapeHTML(entry.path || '')}</span>\n              ${entry.handler ? `<span class=\"debug-card__meta\">${escapeHTML(entry.handler)}</span>` : ''}\n            </div>\n            <div class=\"debug-card__grid\">\n              ${entry.summary ? `<div><h4>Summary</h4><pre>${escapeHTML(entry.summary)}</pre></div>` : ''}\n              ${entry.middleware && entry.middleware.length > 0 ? `<div><h4>Middleware</h4><pre>${escapeHTML(formatJSON(entry.middleware))}</pre></div>` : ''}\n              ${entry.tags && entry.tags.length > 0 ? `<div><h4>Tags</h4><pre>${escapeHTML(formatJSON(entry.tags))}</pre></div>` : ''}\n            </div>\n          </article>\n        `;\n      })\n      .join('');\n\n    return `<div class=\"debug-stack\">${rows}</div>`;\n  }\n\n  private renderCustom(): string {\n    const { search } = this.filters.custom;\n    const data = filterObjectByKey(this.state.custom.data, search);\n    const dataPanel = this.renderJSONPanel('Custom Data', data, '');\n    const logs = this.state.custom.logs;\n\n    const logPanel = logs.length\n      ? `\n        <div class=\"debug-stack\">\n          ${logs\n            .map((entry) => {\n              return `\n                <article class=\"debug-card\">\n                  <div class=\"debug-card__row\">\n                    <span class=\"debug-badge debug-badge--custom\">${escapeHTML(entry.category || 'custom')}</span>\n                    <span class=\"debug-card__meta\">${escapeHTML(formatTimestamp(entry.timestamp))}</span>\n                    <span class=\"debug-card__path\">${escapeHTML(entry.message || '')}</span>\n                  </div>\n                  ${entry.fields ? `<pre>${escapeHTML(formatJSON(entry.fields))}</pre>` : ''}\n                </article>\n              `;\n            })\n            .join('')}\n        </div>\n      `\n      : this.renderEmptyState('No custom logs yet.');\n\n    return `\n      <div class=\"debug-grid\">\n        <section>\n          <h3 class=\"debug-section-title\">Custom Data</h3>\n          ${dataPanel}\n        </section>\n        <section>\n          <h3 class=\"debug-section-title\">Custom Logs</h3>\n          ${logPanel}\n        </section>\n      </div>\n    `;\n  }\n\n  private renderJSONPanel(title: string, data: Record<string, any>, search: string): string {\n    const filtered = filterObjectByKey(data || {}, search);\n    return `\n      <section class=\"debug-json-panel\">\n        <div class=\"debug-json-header\">\n          <h3>${escapeHTML(title)}</h3>\n          <span class=\"debug-muted\">${formatNumber(Object.keys(filtered || {}).length)} keys</span>\n        </div>\n        <pre>${escapeHTML(formatJSON(filtered))}</pre>\n      </section>\n    `;\n  }\n\n  private renderEmptyState(message: string): string {\n    return `\n      <div class=\"debug-empty\">\n        <p>${escapeHTML(message)}</p>\n      </div>\n    `;\n  }\n\n  private renderSelectOptions(options: string[], current: string): string {\n    return options\n      .map((option) => {\n        const selected = option.toLowerCase() === current.toLowerCase() ? 'selected' : '';\n        return `<option value=\"${escapeHTML(option)}\" ${selected}>${escapeHTML(option)}</option>`;\n      })\n      .join('');\n  }\n\n  private updateTabCounts(): void {\n    const counts: Record<string, number> = {\n      template: Object.keys(this.state.template || {}).length,\n      session: Object.keys(this.state.session || {}).length,\n      requests: this.state.requests.length,\n      sql: this.state.sql.length,\n      logs: this.state.logs.length,\n      config: Object.keys(this.state.config || {}).length,\n      routes: this.state.routes.length,\n      custom: Object.keys(this.state.custom.data || {}).length + this.state.custom.logs.length,\n    };\n\n    Object.entries(counts).forEach(([panel, count]) => {\n      const badge = this.tabsEl.querySelector<HTMLElement>(`[data-panel-count=\"${panel}\"]`);\n      if (badge) {\n        badge.textContent = formatNumber(count);\n      }\n    });\n  }\n\n  private updateConnectionStatus(status: DebugStreamStatus): void {\n    this.connectionEl.textContent = status;\n    this.statusEl.setAttribute('data-status', status);\n  }\n\n  private updateStatusMeta(): void {\n    this.eventCountEl.textContent = `${formatNumber(this.eventCount)} events`;\n    if (this.lastEventAt) {\n      this.lastEventEl.textContent = this.lastEventAt.toLocaleTimeString();\n    }\n  }\n\n  private handleEvent(event: DebugEvent): void {\n    if (!event || !event.type) {\n      return;\n    }\n    if (event.type === 'snapshot') {\n      this.applySnapshot(event.payload as DebugSnapshot);\n      return;\n    }\n\n    this.eventCount += 1;\n    this.lastEventAt = new Date();\n    this.updateStatusMeta();\n\n    if (this.paused) {\n      return;\n    }\n\n    const panel = eventToPanel[event.type] || event.type;\n    switch (event.type) {\n      case 'request':\n        this.state.requests.push(event.payload as RequestEntry);\n        this.trim(this.state.requests, this.maxLogEntries);\n        break;\n      case 'sql':\n        this.state.sql.push(event.payload as SQLEntry);\n        this.trim(this.state.sql, this.maxSQLQueries);\n        break;\n      case 'log':\n        this.state.logs.push(event.payload as LogEntry);\n        this.trim(this.state.logs, this.maxLogEntries);\n        break;\n      case 'template':\n        this.state.template = (event.payload as Record<string, any>) || {};\n        break;\n      case 'session':\n        this.state.session = (event.payload as Record<string, any>) || {};\n        break;\n      case 'custom':\n        this.handleCustomEvent(event.payload);\n        break;\n      default:\n        break;\n    }\n\n    this.updateTabCounts();\n    if (panel === this.activePanel) {\n      this.renderPanel();\n    }\n  }\n\n  private handleCustomEvent(payload: any): void {\n    if (!payload) {\n      return;\n    }\n    if (typeof payload === 'object' && 'key' in payload && 'value' in payload) {\n      setNestedValue(this.state.custom.data, String(payload.key), payload.value);\n      return;\n    }\n    if (typeof payload === 'object' && ('category' in payload || 'message' in payload)) {\n      this.state.custom.logs.push(payload as CustomLogEntry);\n      this.trim(this.state.custom.logs, this.maxLogEntries);\n      return;\n    }\n  }\n\n  private applySnapshot(snapshot: DebugSnapshot): void {\n    const next = snapshot || {};\n    this.state.template = next.template || {};\n    this.state.session = next.session || {};\n    this.state.requests = ensureArray<RequestEntry>(next.requests);\n    this.state.sql = ensureArray<SQLEntry>(next.sql);\n    this.state.logs = ensureArray<LogEntry>(next.logs);\n    this.state.config = next.config || {};\n    this.state.routes = ensureArray<RouteEntry>(next.routes);\n    const custom = next.custom || {};\n    this.state.custom = {\n      data: custom.data || {},\n      logs: ensureArray<CustomLogEntry>(custom.logs),\n    };\n\n    this.updateTabCounts();\n    this.renderPanel();\n  }\n\n  private trim<T>(list: T[], max: number): void {\n    if (!Array.isArray(list) || max <= 0) {\n      return;\n    }\n    while (list.length > max) {\n      list.shift();\n    }\n  }\n\n  private isSlowQuery(entry: SQLEntry): boolean {\n    if (!entry || entry.duration === undefined || entry.duration === null) {\n      return false;\n    }\n    const nanos = Number(entry.duration);\n    if (Number.isNaN(nanos)) {\n      return false;\n    }\n    const ms = nanos / 1e6;\n    return ms >= this.slowThresholdMs;\n  }\n\n  private async fetchSnapshot(): Promise<void> {\n    if (!this.debugPath) {\n      return;\n    }\n    try {\n      const response = await fetch(`${this.debugPath}/api/snapshot`, {\n        credentials: 'same-origin',\n      });\n      if (!response.ok) {\n        return;\n      }\n      const payload = (await response.json()) as DebugSnapshot;\n      this.applySnapshot(payload);\n    } catch {\n      // ignore fetch errors\n    }\n  }\n\n  private clearAll(): void {\n    if (!this.debugPath) {\n      return;\n    }\n    this.stream.clear();\n    fetch(`${this.debugPath}/api/clear`, { method: 'POST', credentials: 'same-origin' }).catch(() => {\n      // ignore\n    });\n  }\n\n  private clearActivePanel(): void {\n    if (!this.debugPath) {\n      return;\n    }\n    const panel = this.activePanel;\n    this.stream.clear([panel]);\n    fetch(`${this.debugPath}/api/clear/${panel}`, { method: 'POST', credentials: 'same-origin' }).catch(() => {\n      // ignore\n    });\n  }\n\n  private togglePause(button: HTMLButtonElement): void {\n    this.paused = !this.paused;\n    button.textContent = this.paused ? 'Resume' : 'Pause';\n    if (!this.paused) {\n      this.stream.requestSnapshot();\n    }\n  }\n}\n\nexport const initDebugPanel = (container?: HTMLElement | null): DebugPanel | null => {\n  const target = container || document.querySelector<HTMLElement>('[data-debug-console]');\n  if (!target) {\n    return null;\n  }\n  return new DebugPanel(target);\n};\n","import { DebugPanel, initDebugPanel } from './debug-panel.js';\nimport { DebugStream } from './debug-stream.js';\n\nconst autoInit = () => {\n  initDebugPanel();\n};\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', autoInit);\n} else {\n  autoInit();\n}\n\nexport { DebugPanel, DebugStream, initDebugPanel };\n"],"names":["normalizeBasePath","basePath","trimmed","buildWebSocketURL","protocol","normalized","DebugStream","options","url","event","parsed","cmd","panels","status","pending","maxAttempts","baseDelay","maxDelay","attempt","backoff","jitter","defaultPanels","panelLabels","panelEventMap","eventToPanel","parseJSON","value","escapeHTML","formatTimestamp","date","formatDuration","nanos","ms","formatNumber","num","formatJSON","normalizePanelList","panel","panelLabel","panelId","match","filterObjectByKey","data","search","needle","out","key","setNestedValue","dest","parts","part","current","ensureArray","parseNumber","fallback","DebugPanel","container","panelsData","selector","el","target","button","tabs","content","values","input","inputs","next","method","entries","entry","headers","query","slowOnly","errorOnly","isSlow","args","level","haystack","dataPanel","logs","logPanel","title","filtered","message","option","selected","counts","count","badge","payload","snapshot","custom","list","max","response","initDebugPanel","autoInit"],"mappings":"AA2BA,MAAMA,IAAoB,CAACC,MAA6B;AACtD,QAAMC,KAAWD,KAAY,IAAI,KAAA;AACjC,SAAKC,IAGDA,EAAQ,WAAW,GAAG,IACjBA,EAAQ,QAAQ,QAAQ,EAAE,IAE5B,IAAIA,EAAQ,QAAQ,QAAQ,EAAE,CAAC,KAL7B;AAMX,GAEMC,IAAoB,CAACF,MAA6B;AACtD,QAAMG,IAAW,OAAO,SAAS,aAAa,WAAW,SAAS,OAC5DC,IAAaL,EAAkBC,CAAQ;AAC7C,SAAO,GAAGG,CAAQ,KAAK,OAAO,SAAS,IAAI,GAAGC,CAAU;AAC1D;AAEO,MAAMC,EAAY;AAAA,EASvB,YAAYC,GAA6B;AAPzC,SAAQ,KAAuB,MAC/B,KAAQ,iBAAgC,MACxC,KAAQ,oBAAoB,GAC5B,KAAQ,cAAc,IACtB,KAAQ,kBAAkC,CAAA,GAC1C,KAAQ,SAA4B,gBAGlC,KAAK,UAAUA;AAAA,EACjB;AAAA,EAEA,UAAgB;AACd,QAAI,KAAK,OAAO,KAAK,GAAG,eAAe,UAAU,QAAQ,KAAK,GAAG,eAAe,UAAU;AACxF;AAGF,SAAK,cAAc;AACnB,UAAMC,IAAML,EAAkB,KAAK,QAAQ,QAAQ;AACnD,SAAK,KAAK,IAAI,UAAUK,CAAG,GAE3B,KAAK,GAAG,SAAS,MAAM;AACrB,WAAK,oBAAoB,GACzB,KAAK,UAAU,WAAW,GAC1B,KAAK,aAAA;AAAA,IACP,GAEA,KAAK,GAAG,YAAY,CAACC,MAAU;AAC7B,UAAI,GAACA,KAAS,OAAOA,EAAM,QAAS;AAGpC,YAAI;AACF,gBAAMC,IAAS,KAAK,MAAMD,EAAM,IAAI;AACpC,eAAK,QAAQ,UAAUC,CAAM;AAAA,QAC/B,QAAQ;AAAA,QAER;AAAA,IACF,GAEA,KAAK,GAAG,UAAU,MAAM;AAEtB,UADA,KAAK,KAAK,MACN,KAAK,aAAa;AACpB,aAAK,UAAU,cAAc;AAC7B;AAAA,MACF;AACA,WAAK,UAAU,cAAc,GAC7B,KAAK,kBAAA;AAAA,IACP,GAEA,KAAK,GAAG,UAAU,CAACD,MAAU;AAC3B,WAAK,QAAQ,UAAUA,CAAK,GAC5B,KAAK,UAAU,OAAO;AAAA,IACxB;AAAA,EACF;AAAA,EAEA,QAAc;AACZ,SAAK,cAAc,IACf,KAAK,mBAAmB,SAC1B,OAAO,aAAa,KAAK,cAAc,GACvC,KAAK,iBAAiB,OAEpB,KAAK,MACP,KAAK,GAAG,MAAA;AAAA,EAEZ;AAAA,EAEA,YAAYE,GAAyB;AACnC,QAAI,GAACA,KAAO,CAACA,EAAI,OAGjB;AAAA,UAAI,KAAK,MAAM,KAAK,GAAG,eAAe,UAAU,MAAM;AACpD,aAAK,GAAG,KAAK,KAAK,UAAUA,CAAG,CAAC;AAChC;AAAA,MACF;AACA,WAAK,gBAAgB,KAAKA,CAAG;AAAA;AAAA,EAC/B;AAAA,EAEA,UAAUC,GAAwB;AAChC,SAAK,YAAY,EAAE,MAAM,aAAa,QAAAA,GAAQ;AAAA,EAChD;AAAA,EAEA,YAAYA,GAAwB;AAClC,SAAK,YAAY,EAAE,MAAM,eAAe,QAAAA,GAAQ;AAAA,EAClD;AAAA,EAEA,kBAAwB;AACtB,SAAK,YAAY,EAAE,MAAM,WAAA,CAAY;AAAA,EACvC;AAAA,EAEA,MAAMA,GAAyB;AAC7B,SAAK,YAAY,EAAE,MAAM,SAAS,QAAAA,GAAQ;AAAA,EAC5C;AAAA,EAEA,YAA+B;AAC7B,WAAO,KAAK;AAAA,EACd;AAAA,EAEQ,UAAUC,GAAiC;AACjD,IAAI,KAAK,WAAWA,MAGpB,KAAK,SAASA,GACd,KAAK,QAAQ,iBAAiBA,CAAM;AAAA,EACtC;AAAA,EAEQ,eAAqB;AAI3B,QAHI,CAAC,KAAK,MAAM,KAAK,GAAG,eAAe,UAAU,QAG7C,KAAK,gBAAgB,WAAW;AAClC;AAEF,UAAMC,IAAU,CAAC,GAAG,KAAK,eAAe;AACxC,SAAK,kBAAkB,CAAA;AACvB,eAAWH,KAAOG;AAChB,WAAK,GAAG,KAAK,KAAK,UAAUH,CAAG,CAAC;AAAA,EAEpC;AAAA,EAEQ,oBAA0B;AAChC,UAAMI,IAAc,KAAK,QAAQ,wBAAwB,GACnDC,IAAY,KAAK,QAAQ,oBAAoB,KAC7CC,IAAW,KAAK,QAAQ,uBAAuB;AACrD,QAAI,KAAK,qBAAqBF,GAAa;AACzC,WAAK,UAAU,cAAc;AAC7B;AAAA,IACF;AACA,UAAMG,IAAU,KAAK,mBACfC,IAAU,KAAK,IAAIH,IAAY,KAAK,IAAI,GAAGE,CAAO,GAAGD,CAAQ,GAC7DG,IAASD,KAAW,MAAM,KAAK,WAAW;AAChD,SAAK,qBAAqB,GAC1B,KAAK,iBAAiB,OAAO,WAAW,MAAM;AAC5C,WAAK,QAAA;AAAA,IACP,GAAGA,IAAUC,CAAM;AAAA,EACrB;AACF;AC/FA,MAAMC,IAAgB,CAAC,YAAY,WAAW,YAAY,OAAO,QAAQ,UAAU,UAAU,QAAQ,GAE/FC,IAAsC;AAAA,EAC1C,UAAU;AAAA,EACV,SAAS;AAAA,EACT,UAAU;AAAA,EACV,KAAK;AAAA,EACL,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,QAAQ;AACV,GAEMC,IAAwC;AAAA,EAC5C,UAAU;AAAA,EACV,SAAS;AAAA,EACT,UAAU;AAAA,EACV,KAAK;AAAA,EACL,MAAM;AAAA,EACN,QAAQ;AACV,GAEMC,IAAuC;AAAA,EAC3C,SAAS;AAAA,EACT,KAAK;AAAA,EACL,KAAK;AAAA,EACL,UAAU;AAAA,EACV,SAAS;AAAA,EACT,QAAQ;AACV,GAEMC,IAAY,CAACC,MAAmC;AACpD,MAAI,CAACA;AACH,WAAO;AAET,MAAI;AACF,WAAO,KAAK,MAAMA,CAAK;AAAA,EACzB,QAAQ;AACN,WAAO;AAAA,EACT;AACF,GAEMC,IAAa,CAACD,MACN,OAAOA,KAAS,EAAE,EAE3B,QAAQ,MAAM,OAAO,EACrB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,QAAQ,EACtB,QAAQ,MAAM,OAAO,GAGpBE,IAAkB,CAACF,MAAuB;AAC9C,MAAI,CAACA;AACH,WAAO;AAET,MAAI,OAAOA,KAAU;AACnB,WAAO,IAAI,KAAKA,CAAK,EAAE,mBAAA;AAEzB,MAAI,OAAOA,KAAU,UAAU;AAC7B,UAAMG,IAAO,IAAI,KAAKH,CAAK;AAC3B,WAAK,OAAO,MAAMG,EAAK,QAAA,CAAS,IAGzBH,IAFEG,EAAK,mBAAA;AAAA,EAGhB;AACA,SAAO;AACT,GAEMC,IAAiB,CAACJ,MAAuB;AAC7C,MAAIA,KAAU;AACZ,WAAO;AAET,MAAI,OAAOA,KAAU;AACnB,WAAOA;AAET,QAAMK,IAAQ,OAAOL,CAAK;AAC1B,MAAI,OAAO,MAAMK,CAAK;AACpB,WAAO;AAET,QAAMC,IAAKD,IAAQ;AACnB,SAAIC,IAAK,IAEA,IADQD,IAAQ,KACN,QAAQ,CAAC,CAAC,OAEzBC,IAAK,MACA,GAAGA,EAAG,QAAQ,CAAC,CAAC,OAElB,IAAIA,IAAK,KAAM,QAAQ,CAAC,CAAC;AAClC,GAEMC,IAAe,CAACP,MAAuB;AAC3C,MAAIA,KAAU,QAA+BA,MAAU;AACrD,WAAO;AAET,QAAMQ,IAAM,OAAOR,CAAK;AACxB,SAAI,OAAO,MAAMQ,CAAG,IACX,OAAOR,CAAK,IAEdQ,EAAI,eAAA;AACb,GAEMC,IAAa,CAACT,MAAuB;AACzC,MAAIA,MAAU;AACZ,WAAO;AAET,MAAI;AACF,WAAO,KAAK,UAAUA,GAAO,MAAM,CAAC;AAAA,EACtC,QAAQ;AACN,WAAO,OAAOA,KAAS,EAAE;AAAA,EAC3B;AACF,GAEMU,IAAqB,CAACV,MACtB,MAAM,QAAQA,CAAK,KAAKA,EAAM,SAAS,IAClCA,EAAM,OAAO,CAACW,MAAU,OAAOA,KAAU,YAAYA,EAAM,KAAA,CAAM,EAAE,IAAI,CAACA,MAAUA,EAAM,MAAM,IAEhG,CAAC,GAAGhB,CAAa,GAGpBiB,IAAa,CAACC,MACdjB,EAAYiB,CAAO,IACdjB,EAAYiB,CAAO,IAEvBA,IAGEA,EACJ,QAAQ,UAAU,GAAG,EACrB,QAAQ,QAAQ,GAAG,EACnB,KAAA,EACA,QAAQ,YAAY,KAAK,EACzB,QAAQ,cAAc,CAACC,MAAUA,EAAM,aAAa,IAP9C,IAULC,IAAoB,CAACC,GAA2BC,MAAwC;AAC5F,MAAI,CAACA;AACH,WAAOD;AAET,QAAME,IAASD,EAAO,YAAA,GAChBE,IAA2B,CAAA;AACjC,aAAW,CAACC,GAAKpB,CAAK,KAAK,OAAO,QAAQgB,KAAQ,CAAA,CAAE;AAClD,IAAII,EAAI,YAAA,EAAc,SAASF,CAAM,MACnCC,EAAIC,CAAG,IAAIpB;AAGf,SAAOmB;AACT,GAEME,IAAiB,CAACC,GAA2BF,GAAapB,MAAqB;AACnF,MAAI,CAACsB,KAAQ,CAACF;AACZ;AAEF,QAAMG,IAAQH,EAAI,MAAM,GAAG,EAAE,IAAI,CAACI,MAASA,EAAK,KAAA,CAAM,EAAE,OAAO,OAAO;AACtE,MAAID,EAAM,WAAW;AACnB;AAEF,MAAIE,IAAUH;AACd,WAAS,IAAI,GAAG,IAAIC,EAAM,SAAS,GAAG,KAAK,GAAG;AAC5C,UAAMC,IAAOD,EAAM,CAAC;AACpB,KAAI,CAACE,EAAQD,CAAI,KAAK,OAAOC,EAAQD,CAAI,KAAM,cAC7CC,EAAQD,CAAI,IAAI,CAAA,IAElBC,IAAUA,EAAQD,CAAI;AAAA,EACxB;AACA,EAAAC,EAAQF,EAAMA,EAAM,SAAS,CAAC,CAAC,IAAIvB;AACrC,GAEM0B,IAAc,CAAI1B,MAAqB,MAAM,QAAQA,CAAK,IAAIA,IAAQ,CAAA,GAEtE2B,IAAc,CAAC3B,GAA2B4B,MAA6B;AAC3E,MAAI,CAAC5B;AACH,WAAO4B;AAET,QAAM5C,IAAS,OAAOgB,CAAK;AAC3B,SAAI,OAAO,MAAMhB,CAAM,IACd4C,IAEF5C;AACT;AAEO,MAAM6C,EAAW;AAAA,EAsBtB,YAAYC,GAAwB;AAfpC,SAAQ,SAAS,IAIjB,KAAQ,aAAa,GACrB,KAAQ,cAA2B,MAWjC,KAAK,YAAYA;AACjB,UAAMC,IAAahC,EAAU+B,EAAU,QAAQ,MAAM;AACrD,SAAK,SAASpB,EAAmBqB,CAAU,GAC3C,KAAK,cAAc,KAAK,OAAO,CAAC,KAAK,YAErC,KAAK,YAAYD,EAAU,QAAQ,aAAa,IAChD,KAAK,gBAAgBH,EAAYG,EAAU,QAAQ,eAAe,GAAG,GACrE,KAAK,gBAAgBH,EAAYG,EAAU,QAAQ,eAAe,GAAG,GACrE,KAAK,kBAAkBH,EAAYG,EAAU,QAAQ,iBAAiB,EAAE,GAExE,KAAK,QAAQ;AAAA,MACX,UAAU,CAAA;AAAA,MACV,SAAS,CAAA;AAAA,MACT,UAAU,CAAA;AAAA,MACV,KAAK,CAAA;AAAA,MACL,MAAM,CAAA;AAAA,MACN,QAAQ,CAAA;AAAA,MACR,QAAQ,CAAA;AAAA,MACR,QAAQ,EAAE,MAAM,CAAA,GAAI,MAAM,CAAA,EAAC;AAAA,IAAE,GAG/B,KAAK,UAAU;AAAA,MACb,UAAU,EAAE,QAAQ,OAAO,QAAQ,OAAO,QAAQ,GAAA;AAAA,MAClD,KAAK,EAAE,QAAQ,IAAI,UAAU,IAAO,WAAW,GAAA;AAAA,MAC/C,MAAM,EAAE,OAAO,OAAO,QAAQ,IAAI,YAAY,GAAA;AAAA,MAC9C,QAAQ,EAAE,QAAQ,OAAO,QAAQ,GAAA;AAAA,MACjC,QAAQ,EAAE,QAAQ,GAAA;AAAA,MAClB,SAAS,EAAE,QAAQ,GAAA;AAAA,IAAG,GAGxB,KAAK,SAAS,KAAK,eAAe,mBAAmB,GACrD,KAAK,UAAU,KAAK,eAAe,oBAAoB,GACvD,KAAK,YAAY,KAAK,eAAe,sBAAsB,GAC3D,KAAK,WAAW,KAAK,eAAe,qBAAqB,GACzD,KAAK,eAAe,KAAK,eAAe,yBAAyB,GACjE,KAAK,eAAe,KAAK,eAAe,qBAAqB,GAC7D,KAAK,cAAc,KAAK,eAAe,mBAAmB,GAE1D,KAAK,WAAA,GACL,KAAK,kBAAA,GACL,KAAK,YAAA,GAEL,KAAK,SAAS,IAAIlD,EAAY;AAAA,MAC5B,UAAU,KAAK;AAAA,MACf,SAAS,CAACG,MAAU,KAAK,YAAYA,CAAK;AAAA,MAC1C,gBAAgB,CAACI,MAAW,KAAK,uBAAuBA,CAAM;AAAA,IAAA,CAC/D,GAED,KAAK,cAAA,GACL,KAAK,OAAO,QAAA,GACZ,KAAK,OAAO,UAAU,KAAK,OAAO,IAAI,CAACwB,MAAUd,EAAcc,CAAK,KAAKA,CAAK,CAAC;AAAA,EACjF;AAAA,EAEQ,eAAeqB,GAA+B;AACpD,UAAMC,IAAK,KAAK,UAAU,cAAcD,CAAQ;AAChD,QAAI,CAACC;AACH,YAAM,IAAI,MAAM,0BAA0BD,CAAQ,EAAE;AAEtD,WAAOC;AAAA,EACT;AAAA,EAEQ,cAAoB;AAC1B,SAAK,OAAO,iBAAiB,SAAS,CAAClD,MAAU;AAC/C,YAAMmD,IAASnD,EAAM;AACrB,UAAI,CAACmD;AACH;AAEF,YAAMC,IAASD,EAAO,QAA2B,cAAc;AAC/D,UAAI,CAACC;AACH;AAEF,YAAMxB,IAAQwB,EAAO,QAAQ,SAAS;AACtC,MAAI,CAACxB,KAASA,MAAU,KAAK,gBAG7B,KAAK,cAAcA,GACnB,KAAK,kBAAA;AAAA,IACP,CAAC,GAEe,KAAK,UAAU,iBAAoC,qBAAqB,EAChF,QAAQ,CAACwB,MAAW;AAC1B,MAAAA,EAAO,iBAAiB,SAAS,MAAM;AAErC,gBADeA,EAAO,QAAQ,eAAe,IACrC;AAAA,UACN,KAAK;AACH,iBAAK,OAAO,gBAAA;AACZ;AAAA,UACF,KAAK;AACH,iBAAK,SAAA;AACL;AAAA,UACF,KAAK;AACH,iBAAK,YAAYA,CAAM;AACvB;AAAA,UACF,KAAK;AACH,iBAAK,iBAAA;AACL;AAAA,QAEA;AAAA,MAEN,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA,EAEQ,aAAmB;AACzB,UAAMC,IAAO,KAAK,OACf,IAAI,CAACzB,MAEG;AAAA,qCADQA,MAAU,KAAK,cAAc,sBAAsB,EAE/B,iBAAiBV,EAAWU,CAAK,CAAC;AAAA,6CAChCV,EAAWW,EAAWD,CAAK,CAAC,CAAC;AAAA,+DACXV,EAAWU,CAAK,CAAC;AAAA;AAAA,SAGzE,EACA,KAAK,EAAE;AACV,SAAK,OAAO,YAAYyB,GACxB,KAAK,gBAAA;AAAA,EACP;AAAA,EAEQ,oBAA0B;AAChC,SAAK,WAAA,GACL,KAAK,cAAA,GACL,KAAK,YAAA;AAAA,EACP;AAAA,EAEQ,gBAAsB;AAC5B,UAAMzB,IAAQ,KAAK;AACnB,QAAI0B,IAAU;AACd,QAAI1B,MAAU,YAAY;AACxB,YAAM2B,IAAS,KAAK,QAAQ;AAC5B,MAAAD,IAAU;AAAA;AAAA;AAAA;AAAA,cAIF,KAAK,oBAAoB,CAAC,OAAO,OAAO,QAAQ,OAAO,SAAS,QAAQ,GAAGC,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAMzF,KAAK,oBAAoB,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAK,GAAGA,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,6DAKzDrC,EAAWqC,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA,IAGlF,WAAW3B,MAAU,OAAO;AAC1B,YAAM2B,IAAS,KAAK,QAAQ;AAC5B,MAAAD,IAAU;AAAA;AAAA;AAAA,6DAG6CpC,EAAWqC,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA,0DAG5BA,EAAO,WAAW,YAAY,EAAE;AAAA;AAAA;AAAA;AAAA,2DAI/BA,EAAO,YAAY,YAAY,EAAE;AAAA;AAAA;AAAA;AAAA,IAIxF,WAAW3B,MAAU,QAAQ;AAC3B,YAAM2B,IAAS,KAAK,QAAQ;AAC5B,MAAAD,IAAU;AAAA;AAAA;AAAA;AAAA,cAIF,KAAK,oBAAoB,CAAC,OAAO,SAAS,QAAQ,QAAQ,OAAO,GAAGC,EAAO,KAAK,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,6DAKlCrC,EAAWqC,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA,4DAG1BA,EAAO,aAAa,YAAY,EAAE;AAAA;AAAA;AAAA;AAAA,IAI1F,WAAW3B,MAAU,UAAU;AAC7B,YAAM2B,IAAS,KAAK,QAAQ;AAC5B,MAAAD,IAAU;AAAA;AAAA;AAAA;AAAA,cAIF,KAAK,oBAAoB,CAAC,OAAO,OAAO,QAAQ,OAAO,SAAS,QAAQ,GAAGC,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,6DAK1CrC,EAAWqC,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA,IAGlF,OAAO;AACL,YAAMA,IAAS,KAAK,QAAQ;AAC5B,MAAAD,IAAU;AAAA;AAAA;AAAA,6DAG6CpC,EAAWqC,EAAO,MAAM,CAAC;AAAA;AAAA;AAAA,IAGlF;AAEA,SAAK,UAAU,YAAYD,KAAW,+CACtC,KAAK,iBAAA;AAAA,EACP;AAAA,EAEQ,mBAAyB;AAE/B,IADe,KAAK,UAAU,iBAAuD,eAAe,EAC7F,QAAQ,CAACE,MAAU;AACxB,MAAAA,EAAM,iBAAiB,SAAS,MAAM,KAAK,yBAAyB,GACpEA,EAAM,iBAAiB,UAAU,MAAM,KAAK,yBAAyB;AAAA,IACvE,CAAC;AAAA,EACH;AAAA,EAEQ,0BAAgC;AACtC,UAAM5B,IAAQ,KAAK,aACb6B,IAAS,KAAK,UAAU,iBAAuD,eAAe;AACpG,QAAI7B,MAAU,YAAY;AACxB,YAAM8B,IAAO,EAAE,GAAG,KAAK,QAAQ,SAAA;AAC/B,MAAAD,EAAO,QAAQ,CAACD,MAAU;AACxB,cAAMnB,IAAMmB,EAAM,QAAQ,UAAU;AACpC,QAAInB,KAAOA,KAAOqB,MAChBA,EAAKrB,CAAwB,IAAKmB,EAA2B;AAAA,MAEjE,CAAC,GACD,KAAK,QAAQ,WAAWE;AAAA,IAC1B,WAAW9B,MAAU,OAAO;AAC1B,YAAM8B,IAAO,EAAE,GAAG,KAAK,QAAQ,IAAA;AAC/B,MAAAD,EAAO,QAAQ,CAACD,MAAU;AACxB,cAAMnB,IAAMmB,EAAM,QAAQ,UAAU;AACpC,QAAInB,MAAQ,cAAcA,MAAQ,cAChCqB,EAAKrB,CAAG,IAAKmB,EAA2B,UAC/BnB,MAAQ,aACjBqB,EAAKrB,CAAG,IAAKmB,EAA2B;AAAA,MAE5C,CAAC,GACD,KAAK,QAAQ,MAAME;AAAA,IACrB,WAAW9B,MAAU,QAAQ;AAC3B,YAAM8B,IAAO,EAAE,GAAG,KAAK,QAAQ,KAAA;AAC/B,MAAAD,EAAO,QAAQ,CAACD,MAAU;AACxB,cAAMnB,IAAMmB,EAAM,QAAQ,UAAU;AACpC,QAAInB,MAAQ,eACVqB,EAAKrB,CAAG,IAAKmB,EAA2B,WAC/BnB,MAAQ,WAAWA,MAAQ,cACpCqB,EAAKrB,CAAG,IAAKmB,EAA2B;AAAA,MAE5C,CAAC,GACD,KAAK,QAAQ,OAAOE;AAAA,IACtB,WAAW9B,MAAU,UAAU;AAC7B,YAAM8B,IAAO,EAAE,GAAG,KAAK,QAAQ,OAAA;AAC/B,MAAAD,EAAO,QAAQ,CAACD,MAAU;AACxB,cAAMnB,IAAMmB,EAAM,QAAQ,UAAU;AACpC,QAAInB,KAAOA,KAAOqB,MAChBA,EAAKrB,CAAwB,IAAKmB,EAA2B;AAAA,MAEjE,CAAC,GACD,KAAK,QAAQ,SAASE;AAAA,IACxB,OAAO;AACL,YAAMA,IAAO,EAAE,GAAG,KAAK,QAAQ,QAAA;AAC/B,MAAAD,EAAO,QAAQ,CAACD,MAAU;AACxB,cAAMnB,IAAMmB,EAAM,QAAQ,UAAU;AACpC,QAAInB,KAAOA,KAAOqB,MAChBA,EAAKrB,CAAwB,IAAKmB,EAA2B;AAAA,MAEjE,CAAC,GACD,KAAK,QAAQ,UAAUE;AAAA,IACzB;AACA,SAAK,YAAA;AAAA,EACP;AAAA,EAEQ,cAAoB;AAC1B,UAAM9B,IAAQ,KAAK;AACnB,QAAI0B,IAAU;AACd,IAAI1B,MAAU,aACZ0B,IAAU,KAAK,gBAAgB,oBAAoB,KAAK,MAAM,UAAU,KAAK,QAAQ,QAAQ,MAAM,IAC1F1B,MAAU,YACnB0B,IAAU,KAAK,gBAAgB,WAAW,KAAK,MAAM,SAAS,KAAK,QAAQ,QAAQ,MAAM,IAChF1B,MAAU,WACnB0B,IAAU,KAAK,gBAAgB,UAAU,KAAK,MAAM,QAAQ,KAAK,QAAQ,QAAQ,MAAM,IAC9E1B,MAAU,aACnB0B,IAAU,KAAK,eAAA,IACN1B,MAAU,QACnB0B,IAAU,KAAK,UAAA,IACN1B,MAAU,SACnB0B,IAAU,KAAK,WAAA,IACN1B,MAAU,WACnB0B,IAAU,KAAK,aAAA,IACN1B,MAAU,WACnB0B,IAAU,KAAK,aAAA,IAEfA,IAAU,KAAK,gBAAgBzB,EAAWD,CAAK,GAAI,KAAK,MAAcA,CAAK,KAAK,CAAA,GAAI,KAAK,QAAQ,QAAQ,MAAM,GAGjH,KAAK,QAAQ,YAAY0B,GACrB1B,MAAU,UAAU,KAAK,QAAQ,KAAK,eACxC,KAAK,QAAQ,YAAY,KAAK,QAAQ;AAAA,EAE1C;AAAA,EAEQ,iBAAyB;AAC/B,UAAM,EAAE,QAAA+B,GAAQ,QAAAvD,GAAQ,QAAA8B,EAAA,IAAW,KAAK,QAAQ,UAC1CC,IAASD,EAAO,YAAA,GAChB0B,IAAU,KAAK,MAAM,SAAS,OAAO,CAACC,MACtC,EAAAF,MAAW,UAAUE,EAAM,UAAU,IAAI,YAAA,MAAkBF,KAG3DvD,MAAW,SAAS,OAAOyD,EAAM,UAAU,EAAE,MAAMzD,KAGnD+B,KAAU,EAAE0B,EAAM,QAAQ,IAAI,YAAA,EAAc,SAAS1B,CAAM,EAIhE;AAED,WAAIyB,EAAQ,WAAW,IACd,KAAK,iBAAiB,2BAA2B,IAmCnD,4BAhCMA,EACV,IAAI,CAACC,MAAU;AACd,YAAMC,IAAUD,EAAM,UAAUnC,EAAWmC,EAAM,OAAO,IAAI,MACtDE,IAAQF,EAAM,QAAQnC,EAAWmC,EAAM,KAAK,IAAI;AACtD,aAAO;AAAA;AAAA;AAAA,8DAG+C3C,EAAW2C,EAAM,UAAU,KAAK,CAAC;AAAA,+CAChD3C,EAAW2C,EAAM,QAAQ,EAAE,CAAC;AAAA,8DACb3C,EAAW2C,EAAM,UAAU,CAAC,CAAC;AAAA,+CAC5CxC,EAAewC,EAAM,QAAQ,CAAC;AAAA,+CAC9B3C,EAAWC,EAAgB0C,EAAM,SAAS,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,gBAI3EA,EAAM,QAAQ,kCAAkC3C,EAAW2C,EAAM,KAAK,CAAC,WAAW,EAAE;AAAA;AAAA;AAAA;AAAA,yBAI3E3C,EAAW6C,CAAK,CAAC;AAAA;AAAA;AAAA;AAAA,yBAIjB7C,EAAW4C,CAAO,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAMtC,CAAC,EACA,KAAK,EAAE,CAE6B;AAAA,EACzC;AAAA,EAEQ,YAAoB;AAC1B,UAAM,EAAE,QAAA5B,GAAQ,UAAA8B,GAAU,WAAAC,EAAA,IAAc,KAAK,QAAQ,KAC/C9B,IAASD,EAAO,YAAA,GAChB0B,IAAU,KAAK,MAAM,IAAI,OAAO,CAACC,MACjC,EAAAI,KAAa,CAACJ,EAAM,SAGpBG,KAAY,CAAC,KAAK,YAAYH,CAAK,KAGnC1B,KAAU,EAAE0B,EAAM,SAAS,IAAI,YAAA,EAAc,SAAS1B,CAAM,EAIjE;AAED,WAAIyB,EAAQ,WAAW,IACd,KAAK,iBAAiB,8BAA8B,IA6BtD,4BA1BMA,EACV,IAAI,CAACC,MAAU;AACd,YAAMK,IAAS,KAAK,YAAYL,CAAK,GAC/BM,IAAON,EAAM,OAAOnC,EAAWmC,EAAM,IAAI,IAAI;AACnD,aAAO;AAAA,uCACwBK,IAAS,qBAAqB,EAAE;AAAA;AAAA;AAAA,+CAGxBhD,EAAWC,EAAgB0C,EAAM,SAAS,CAAC,CAAC;AAAA,+CAC5CxC,EAAewC,EAAM,QAAQ,CAAC;AAAA,qDACxB3C,EAAWM,EAAaqC,EAAM,aAAa,CAAC,CAAC,CAAC;AAAA,gBACnFA,EAAM,QAAQ,8DAA8D,EAAE;AAAA;AAAA,sCAExD3C,EAAW2C,EAAM,SAAS,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,uBAI5C3C,EAAWiD,CAAI,CAAC;AAAA;AAAA,gBAEvBN,EAAM,QAAQ,2BAA2B3C,EAAW2C,EAAM,KAAK,CAAC,iBAAiB,EAAE;AAAA;AAAA;AAAA;AAAA,IAI7F,CAAC,EACA,KAAK,EAAE,CAE6B;AAAA,EACzC;AAAA,EAEQ,aAAqB;AAC3B,UAAM,EAAE,OAAAO,GAAO,QAAAlC,EAAA,IAAW,KAAK,QAAQ,MACjCC,IAASD,EAAO,YAAA,GAChB0B,IAAU,KAAK,MAAM,KAAK,OAAO,CAACC,MAAU;AAChD,UAAIO,MAAU,UAAUP,EAAM,SAAS,IAAI,YAAA,MAAkBO;AAC3D,eAAO;AAET,YAAMC,IAAW,GAAGR,EAAM,WAAW,EAAE,IAAIA,EAAM,UAAU,EAAE,IAAInC,EAAWmC,EAAM,UAAU,EAAE,CAAC,GAAG,YAAA;AAClG,aAAI,EAAA1B,KAAU,CAACkC,EAAS,SAASlC,CAAM;AAAA,IAIzC,CAAC;AAED,WAAIyB,EAAQ,WAAW,IACd,KAAK,iBAAiB,uBAAuB,IAqB/C,4BAlBMA,EACV,IAAI,CAACC,MACG;AAAA;AAAA;AAAA,6DAG8C3C,GAAY2C,EAAM,SAAS,QAAQ,YAAA,CAAa,CAAC;AAAA,+CAC/D3C,EAAWC,EAAgB0C,EAAM,SAAS,CAAC,CAAC;AAAA,+CAC5C3C,EAAW2C,EAAM,WAAW,EAAE,CAAC;AAAA;AAAA;AAAA,gBAG9DA,EAAM,SAAS,4BAA4B3C,EAAW2C,EAAM,MAAM,CAAC,iBAAiB,EAAE;AAAA,gBACtFA,EAAM,SAAS,4BAA4B3C,EAAWQ,EAAWmC,EAAM,MAAM,CAAC,CAAC,iBAAiB,EAAE;AAAA;AAAA;AAAA,SAI3G,EACA,KAAK,EAAE,CAE6B;AAAA,EACzC;AAAA,EAEQ,eAAuB;AAC7B,UAAM,EAAE,QAAAF,GAAQ,QAAAzB,EAAA,IAAW,KAAK,QAAQ,QAClCC,IAASD,EAAO,YAAA,GAChB0B,IAAU,KAAK,MAAM,OAAO,OAAO,CAACC,MAAU;AAClD,UAAIF,MAAW,UAAUE,EAAM,UAAU,IAAI,YAAA,MAAkBF;AAC7D,eAAO;AAET,YAAMU,IAAW,GAAGR,EAAM,QAAQ,EAAE,IAAIA,EAAM,WAAW,EAAE,IAAIA,EAAM,WAAW,EAAE,GAAG,YAAA;AACrF,aAAI,EAAA1B,KAAU,CAACkC,EAAS,SAASlC,CAAM;AAAA,IAIzC,CAAC;AAED,WAAIyB,EAAQ,WAAW,IACd,KAAK,iBAAiB,yBAAyB,IAsBjD,4BAnBMA,EACV,IAAI,CAACC,MACG;AAAA;AAAA;AAAA,8DAG+C3C,EAAW2C,EAAM,UAAU,EAAE,CAAC;AAAA,+CAC7C3C,EAAW2C,EAAM,QAAQ,EAAE,CAAC;AAAA,gBAC3DA,EAAM,UAAU,kCAAkC3C,EAAW2C,EAAM,OAAO,CAAC,YAAY,EAAE;AAAA;AAAA;AAAA,gBAGzFA,EAAM,UAAU,6BAA6B3C,EAAW2C,EAAM,OAAO,CAAC,iBAAiB,EAAE;AAAA,gBACzFA,EAAM,cAAcA,EAAM,WAAW,SAAS,IAAI,gCAAgC3C,EAAWQ,EAAWmC,EAAM,UAAU,CAAC,CAAC,iBAAiB,EAAE;AAAA,gBAC7IA,EAAM,QAAQA,EAAM,KAAK,SAAS,IAAI,0BAA0B3C,EAAWQ,EAAWmC,EAAM,IAAI,CAAC,CAAC,iBAAiB,EAAE;AAAA;AAAA;AAAA,SAI9H,EACA,KAAK,EAAE,CAE6B;AAAA,EACzC;AAAA,EAEQ,eAAuB;AAC7B,UAAM,EAAE,QAAA3B,EAAA,IAAW,KAAK,QAAQ,QAC1BD,IAAOD,EAAkB,KAAK,MAAM,OAAO,MAAME,CAAM,GACvDoC,IAAY,KAAK,gBAAgB,eAAerC,GAAM,EAAE,GACxDsC,IAAO,KAAK,MAAM,OAAO,MAEzBC,IAAWD,EAAK,SAClB;AAAA;AAAA,YAEIA,EACC,IAAI,CAACV,MACG;AAAA;AAAA;AAAA,oEAG+C3C,EAAW2C,EAAM,YAAY,QAAQ,CAAC;AAAA,qDACrD3C,EAAWC,EAAgB0C,EAAM,SAAS,CAAC,CAAC;AAAA,qDAC5C3C,EAAW2C,EAAM,WAAW,EAAE,CAAC;AAAA;AAAA,oBAEhEA,EAAM,SAAS,QAAQ3C,EAAWQ,EAAWmC,EAAM,MAAM,CAAC,CAAC,WAAW,EAAE;AAAA;AAAA,eAG/E,EACA,KAAK,EAAE,CAAC;AAAA;AAAA,UAGb,KAAK,iBAAiB,qBAAqB;AAE/C,WAAO;AAAA;AAAA;AAAA;AAAA,YAICS,CAAS;AAAA;AAAA;AAAA;AAAA,YAITE,CAAQ;AAAA;AAAA;AAAA;AAAA,EAIlB;AAAA,EAEQ,gBAAgBC,GAAexC,GAA2BC,GAAwB;AACxF,UAAMwC,IAAW1C,EAAkBC,KAAQ,CAAA,GAAIC,CAAM;AACrD,WAAO;AAAA;AAAA;AAAA,gBAGKhB,EAAWuD,CAAK,CAAC;AAAA,sCACKjD,EAAa,OAAO,KAAKkD,KAAY,CAAA,CAAE,EAAE,MAAM,CAAC;AAAA;AAAA,eAEvExD,EAAWQ,EAAWgD,CAAQ,CAAC,CAAC;AAAA;AAAA;AAAA,EAG7C;AAAA,EAEQ,iBAAiBC,GAAyB;AAChD,WAAO;AAAA;AAAA,aAEEzD,EAAWyD,CAAO,CAAC;AAAA;AAAA;AAAA,EAG9B;AAAA,EAEQ,oBAAoB7E,GAAmB4C,GAAyB;AACtE,WAAO5C,EACJ,IAAI,CAAC8E,MAAW;AACf,YAAMC,IAAWD,EAAO,YAAA,MAAkBlC,EAAQ,YAAA,IAAgB,aAAa;AAC/E,aAAO,kBAAkBxB,EAAW0D,CAAM,CAAC,KAAKC,CAAQ,IAAI3D,EAAW0D,CAAM,CAAC;AAAA,IAChF,CAAC,EACA,KAAK,EAAE;AAAA,EACZ;AAAA,EAEQ,kBAAwB;AAC9B,UAAME,IAAiC;AAAA,MACrC,UAAU,OAAO,KAAK,KAAK,MAAM,YAAY,CAAA,CAAE,EAAE;AAAA,MACjD,SAAS,OAAO,KAAK,KAAK,MAAM,WAAW,CAAA,CAAE,EAAE;AAAA,MAC/C,UAAU,KAAK,MAAM,SAAS;AAAA,MAC9B,KAAK,KAAK,MAAM,IAAI;AAAA,MACpB,MAAM,KAAK,MAAM,KAAK;AAAA,MACtB,QAAQ,OAAO,KAAK,KAAK,MAAM,UAAU,CAAA,CAAE,EAAE;AAAA,MAC7C,QAAQ,KAAK,MAAM,OAAO;AAAA,MAC1B,QAAQ,OAAO,KAAK,KAAK,MAAM,OAAO,QAAQ,CAAA,CAAE,EAAE,SAAS,KAAK,MAAM,OAAO,KAAK;AAAA,IAAA;AAGpF,WAAO,QAAQA,CAAM,EAAE,QAAQ,CAAC,CAAClD,GAAOmD,CAAK,MAAM;AACjD,YAAMC,IAAQ,KAAK,OAAO,cAA2B,sBAAsBpD,CAAK,IAAI;AACpF,MAAIoD,MACFA,EAAM,cAAcxD,EAAauD,CAAK;AAAA,IAE1C,CAAC;AAAA,EACH;AAAA,EAEQ,uBAAuB3E,GAAiC;AAC9D,SAAK,aAAa,cAAcA,GAChC,KAAK,SAAS,aAAa,eAAeA,CAAM;AAAA,EAClD;AAAA,EAEQ,mBAAyB;AAC/B,SAAK,aAAa,cAAc,GAAGoB,EAAa,KAAK,UAAU,CAAC,WAC5D,KAAK,gBACP,KAAK,YAAY,cAAc,KAAK,YAAY,mBAAA;AAAA,EAEpD;AAAA,EAEQ,YAAYxB,GAAyB;AAC3C,QAAI,CAACA,KAAS,CAACA,EAAM;AACnB;AAEF,QAAIA,EAAM,SAAS,YAAY;AAC7B,WAAK,cAAcA,EAAM,OAAwB;AACjD;AAAA,IACF;AAMA,QAJA,KAAK,cAAc,GACnB,KAAK,kCAAkB,KAAA,GACvB,KAAK,iBAAA,GAED,KAAK;AACP;AAGF,UAAM4B,IAAQb,EAAaf,EAAM,IAAI,KAAKA,EAAM;AAChD,YAAQA,EAAM,MAAA;AAAA,MACZ,KAAK;AACH,aAAK,MAAM,SAAS,KAAKA,EAAM,OAAuB,GACtD,KAAK,KAAK,KAAK,MAAM,UAAU,KAAK,aAAa;AACjD;AAAA,MACF,KAAK;AACH,aAAK,MAAM,IAAI,KAAKA,EAAM,OAAmB,GAC7C,KAAK,KAAK,KAAK,MAAM,KAAK,KAAK,aAAa;AAC5C;AAAA,MACF,KAAK;AACH,aAAK,MAAM,KAAK,KAAKA,EAAM,OAAmB,GAC9C,KAAK,KAAK,KAAK,MAAM,MAAM,KAAK,aAAa;AAC7C;AAAA,MACF,KAAK;AACH,aAAK,MAAM,WAAYA,EAAM,WAAmC,CAAA;AAChE;AAAA,MACF,KAAK;AACH,aAAK,MAAM,UAAWA,EAAM,WAAmC,CAAA;AAC/D;AAAA,MACF,KAAK;AACH,aAAK,kBAAkBA,EAAM,OAAO;AACpC;AAAA,IAEA;AAGJ,SAAK,gBAAA,GACD4B,MAAU,KAAK,eACjB,KAAK,YAAA;AAAA,EAET;AAAA,EAEQ,kBAAkBqD,GAAoB;AAC5C,QAAKA,GAGL;AAAA,UAAI,OAAOA,KAAY,YAAY,SAASA,KAAW,WAAWA,GAAS;AACzE,QAAA3C,EAAe,KAAK,MAAM,OAAO,MAAM,OAAO2C,EAAQ,GAAG,GAAGA,EAAQ,KAAK;AACzE;AAAA,MACF;AACA,UAAI,OAAOA,KAAY,aAAa,cAAcA,KAAW,aAAaA,IAAU;AAClF,aAAK,MAAM,OAAO,KAAK,KAAKA,CAAyB,GACrD,KAAK,KAAK,KAAK,MAAM,OAAO,MAAM,KAAK,aAAa;AACpD;AAAA,MACF;AAAA;AAAA,EACF;AAAA,EAEQ,cAAcC,GAA+B;AACnD,UAAMxB,IAAOwB,KAAY,CAAA;AACzB,SAAK,MAAM,WAAWxB,EAAK,YAAY,CAAA,GACvC,KAAK,MAAM,UAAUA,EAAK,WAAW,CAAA,GACrC,KAAK,MAAM,WAAWf,EAA0Be,EAAK,QAAQ,GAC7D,KAAK,MAAM,MAAMf,EAAsBe,EAAK,GAAG,GAC/C,KAAK,MAAM,OAAOf,EAAsBe,EAAK,IAAI,GACjD,KAAK,MAAM,SAASA,EAAK,UAAU,CAAA,GACnC,KAAK,MAAM,SAASf,EAAwBe,EAAK,MAAM;AACvD,UAAMyB,IAASzB,EAAK,UAAU,CAAA;AAC9B,SAAK,MAAM,SAAS;AAAA,MAClB,MAAMyB,EAAO,QAAQ,CAAA;AAAA,MACrB,MAAMxC,EAA4BwC,EAAO,IAAI;AAAA,IAAA,GAG/C,KAAK,gBAAA,GACL,KAAK,YAAA;AAAA,EACP;AAAA,EAEQ,KAAQC,GAAWC,GAAmB;AAC5C,QAAI,GAAC,MAAM,QAAQD,CAAI,KAAKC,KAAO;AAGnC,aAAOD,EAAK,SAASC;AACnB,QAAAD,EAAK,MAAA;AAAA,EAET;AAAA,EAEQ,YAAYvB,GAA0B;AAC5C,QAAI,CAACA,KAASA,EAAM,aAAa,UAAaA,EAAM,aAAa;AAC/D,aAAO;AAET,UAAMvC,IAAQ,OAAOuC,EAAM,QAAQ;AACnC,WAAI,OAAO,MAAMvC,CAAK,IACb,KAEEA,IAAQ,OACN,KAAK;AAAA,EACpB;AAAA,EAEA,MAAc,gBAA+B;AAC3C,QAAK,KAAK;AAGV,UAAI;AACF,cAAMgE,IAAW,MAAM,MAAM,GAAG,KAAK,SAAS,iBAAiB;AAAA,UAC7D,aAAa;AAAA,QAAA,CACd;AACD,YAAI,CAACA,EAAS;AACZ;AAEF,cAAML,IAAW,MAAMK,EAAS,KAAA;AAChC,aAAK,cAAcL,CAAO;AAAA,MAC5B,QAAQ;AAAA,MAER;AAAA,EACF;AAAA,EAEQ,WAAiB;AACvB,IAAK,KAAK,cAGV,KAAK,OAAO,MAAA,GACZ,MAAM,GAAG,KAAK,SAAS,cAAc,EAAE,QAAQ,QAAQ,aAAa,eAAe,EAAE,MAAM,MAAM;AAAA,IAEjG,CAAC;AAAA,EACH;AAAA,EAEQ,mBAAyB;AAC/B,QAAI,CAAC,KAAK;AACR;AAEF,UAAMrD,IAAQ,KAAK;AACnB,SAAK,OAAO,MAAM,CAACA,CAAK,CAAC,GACzB,MAAM,GAAG,KAAK,SAAS,cAAcA,CAAK,IAAI,EAAE,QAAQ,QAAQ,aAAa,cAAA,CAAe,EAAE,MAAM,MAAM;AAAA,IAE1G,CAAC;AAAA,EACH;AAAA,EAEQ,YAAYwB,GAAiC;AACnD,SAAK,SAAS,CAAC,KAAK,QACpBA,EAAO,cAAc,KAAK,SAAS,WAAW,SACzC,KAAK,UACR,KAAK,OAAO,gBAAA;AAAA,EAEhB;AACF;AAEO,MAAMmC,IAAiB,CAACxC,MAAsD;AACnF,QAAMI,IAASJ,KAAa,SAAS,cAA2B,sBAAsB;AACtF,SAAKI,IAGE,IAAIL,EAAWK,CAAM,IAFnB;AAGX,GC1gCMqC,IAAW,MAAM;AACrB,EAAAD,EAAA;AACF;AAEI,SAAS,eAAe,YAC1B,SAAS,iBAAiB,oBAAoBC,CAAQ,IAEtDA,EAAA;"}