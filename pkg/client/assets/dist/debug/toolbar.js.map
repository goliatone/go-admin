{"version":3,"file":"toolbar.js","sources":["../../src/debug/toolbar/toolbar-styles.ts","../../src/debug/toolbar/panel-renderers.ts","../../src/debug/toolbar/debug-toolbar.ts"],"sourcesContent":["// Shadow DOM styles for the debug toolbar\n// Self-contained CSS that won't leak to or from the host page\n\nexport const toolbarStyles = `\n  :host {\n    --toolbar-bg: #1e1e2e;\n    --toolbar-bg-secondary: #181825;\n    --toolbar-border: #313244;\n    --toolbar-text: #cdd6f4;\n    --toolbar-text-muted: #6c7086;\n    --toolbar-accent: #89b4fa;\n    --toolbar-accent-hover: #b4befe;\n    --toolbar-success: #a6e3a1;\n    --toolbar-warning: #f9e2af;\n    --toolbar-error: #f38ba8;\n    --toolbar-info: #89dceb;\n    --toolbar-height-collapsed: 36px;\n    --toolbar-height-expanded: 320px;\n    --toolbar-font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;\n\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 99999;\n    font-family: var(--toolbar-font);\n    font-size: 12px;\n    line-height: 1.4;\n    pointer-events: auto;\n  }\n\n  * {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n  }\n\n  .toolbar {\n    background: var(--toolbar-bg);\n    border-top: 1px solid var(--toolbar-border);\n    color: var(--toolbar-text);\n    transition: height 0.2s ease-out;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .toolbar.collapsed {\n    height: var(--toolbar-height-collapsed);\n  }\n\n  .toolbar.expanded {\n    height: var(--toolbar-height-expanded);\n  }\n\n  /* Header with tabs */\n  .toolbar-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 12px;\n    height: 36px;\n    min-height: 36px;\n    border-bottom: 1px solid var(--toolbar-border);\n    background: var(--toolbar-bg-secondary);\n  }\n\n  .toolbar-tabs {\n    display: flex;\n    gap: 2px;\n    overflow-x: auto;\n    scrollbar-width: none;\n  }\n\n  .toolbar-tabs::-webkit-scrollbar {\n    display: none;\n  }\n\n  .tab {\n    background: transparent;\n    border: none;\n    color: var(--toolbar-text-muted);\n    padding: 6px 10px;\n    cursor: pointer;\n    border-radius: 4px;\n    font-size: 11px;\n    font-family: inherit;\n    white-space: nowrap;\n    transition: all 0.15s ease;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .tab:hover {\n    background: rgba(137, 180, 250, 0.1);\n    color: var(--toolbar-text);\n  }\n\n  .tab.active {\n    background: var(--toolbar-accent);\n    color: var(--toolbar-bg);\n  }\n\n  .tab-count {\n    font-size: 10px;\n    background: rgba(255, 255, 255, 0.15);\n    padding: 1px 5px;\n    border-radius: 8px;\n    min-width: 18px;\n    text-align: center;\n  }\n\n  .tab.active .tab-count {\n    background: rgba(0, 0, 0, 0.2);\n  }\n\n  /* Actions */\n  .toolbar-actions {\n    display: flex;\n    gap: 4px;\n    align-items: center;\n  }\n\n  .action-btn {\n    background: transparent;\n    border: none;\n    color: var(--toolbar-text-muted);\n    cursor: pointer;\n    padding: 6px 8px;\n    font-size: 14px;\n    font-family: inherit;\n    border-radius: 4px;\n    transition: all 0.15s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .action-btn:hover {\n    background: rgba(137, 180, 250, 0.1);\n    color: var(--toolbar-text);\n  }\n\n  .action-btn.toggle-btn {\n    font-size: 12px;\n    padding: 6px 10px;\n  }\n\n  .expand-link {\n    color: var(--toolbar-text-muted);\n    text-decoration: none;\n    padding: 6px 8px;\n    font-size: 14px;\n    border-radius: 4px;\n    transition: all 0.15s ease;\n  }\n\n  .expand-link:hover {\n    background: rgba(137, 180, 250, 0.1);\n    color: var(--toolbar-text);\n  }\n\n  /* Content area */\n  .toolbar-content {\n    flex: 1;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .panel-container {\n    flex: 1;\n    overflow: auto;\n    padding: 8px 12px;\n    scrollbar-width: thin;\n    scrollbar-color: var(--toolbar-border) transparent;\n  }\n\n  .panel-container::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  .panel-container::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  .panel-container::-webkit-scrollbar-thumb {\n    background: var(--toolbar-border);\n    border-radius: 3px;\n  }\n\n  /* Summary bar (shown when collapsed) */\n  .toolbar-summary {\n    display: flex;\n    gap: 16px;\n    padding: 0 12px;\n    height: 36px;\n    align-items: center;\n    cursor: pointer;\n    background: var(--toolbar-bg);\n    transition: background 0.15s ease;\n  }\n\n  .toolbar-summary:hover {\n    background: var(--toolbar-bg-secondary);\n  }\n\n  .toolbar.expanded .toolbar-summary {\n    display: none;\n  }\n\n  .summary-item {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    color: var(--toolbar-text-muted);\n    font-size: 11px;\n  }\n\n  .summary-item .count {\n    color: var(--toolbar-text);\n    font-weight: 600;\n  }\n\n  .summary-item.has-errors .count {\n    color: var(--toolbar-error);\n  }\n\n  .summary-item.has-slow .count {\n    color: var(--toolbar-warning);\n  }\n\n  .connection-status {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    margin-left: auto;\n  }\n\n  .status-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    background: var(--toolbar-text-muted);\n  }\n\n  .status-dot.connected {\n    background: var(--toolbar-success);\n    box-shadow: 0 0 4px var(--toolbar-success);\n  }\n\n  .status-dot.error {\n    background: var(--toolbar-error);\n    box-shadow: 0 0 4px var(--toolbar-error);\n  }\n\n  .status-dot.reconnecting {\n    background: var(--toolbar-warning);\n    animation: pulse 1s ease-in-out infinite;\n  }\n\n  @keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.4; }\n  }\n\n  /* Table styles */\n  table {\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 11px;\n  }\n\n  th, td {\n    text-align: left;\n    padding: 6px 8px;\n    border-bottom: 1px solid var(--toolbar-border);\n    vertical-align: top;\n  }\n\n  th {\n    color: var(--toolbar-text-muted);\n    font-weight: 500;\n    font-size: 10px;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    position: sticky;\n    top: 0;\n    background: var(--toolbar-bg);\n    z-index: 1;\n  }\n\n  tr:hover td {\n    background: rgba(137, 180, 250, 0.05);\n  }\n\n  /* Badges */\n  .badge {\n    display: inline-block;\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.03em;\n  }\n\n  .badge-method {\n    background: rgba(137, 180, 250, 0.2);\n    color: var(--toolbar-accent);\n  }\n\n  .badge-method.get { background: rgba(166, 227, 161, 0.2); color: var(--toolbar-success); }\n  .badge-method.post { background: rgba(137, 180, 250, 0.2); color: var(--toolbar-accent); }\n  .badge-method.put { background: rgba(249, 226, 175, 0.2); color: var(--toolbar-warning); }\n  .badge-method.patch { background: rgba(249, 226, 175, 0.2); color: var(--toolbar-warning); }\n  .badge-method.delete { background: rgba(243, 139, 168, 0.2); color: var(--toolbar-error); }\n\n  .badge-status {\n    background: rgba(166, 227, 161, 0.2);\n    color: var(--toolbar-success);\n  }\n\n  .badge-status.error {\n    background: rgba(243, 139, 168, 0.2);\n    color: var(--toolbar-error);\n  }\n\n  .badge-status.warn {\n    background: rgba(249, 226, 175, 0.2);\n    color: var(--toolbar-warning);\n  }\n\n  .badge-level {\n    min-width: 40px;\n    text-align: center;\n  }\n\n  .badge-level.debug { background: rgba(108, 112, 134, 0.3); color: var(--toolbar-text-muted); }\n  .badge-level.info { background: rgba(137, 220, 235, 0.2); color: var(--toolbar-info); }\n  .badge-level.warn { background: rgba(249, 226, 175, 0.2); color: var(--toolbar-warning); }\n  .badge-level.error { background: rgba(243, 139, 168, 0.2); color: var(--toolbar-error); }\n\n  /* Query highlighting */\n  .slow-query {\n    color: var(--toolbar-warning);\n  }\n\n  .error-query {\n    color: var(--toolbar-error);\n  }\n\n  /* Code/pre */\n  pre, code {\n    font-family: var(--toolbar-font);\n    font-size: 11px;\n  }\n\n  pre {\n    margin: 0;\n    white-space: pre-wrap;\n    word-break: break-word;\n    color: var(--toolbar-text);\n  }\n\n  .query-text {\n    max-width: 400px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .query-text:hover {\n    white-space: pre-wrap;\n    word-break: break-all;\n  }\n\n  /* Empty state */\n  .empty-state {\n    color: var(--toolbar-text-muted);\n    text-align: center;\n    padding: 24px;\n    font-size: 12px;\n  }\n\n  /* JSON viewer */\n  .json-viewer {\n    background: var(--toolbar-bg-secondary);\n    border-radius: 4px;\n    padding: 8px;\n    overflow: auto;\n    max-height: 100%;\n  }\n\n  .json-viewer pre {\n    font-size: 11px;\n    line-height: 1.5;\n  }\n\n  /* Duration formatting */\n  .duration {\n    color: var(--toolbar-text-muted);\n    font-variant-numeric: tabular-nums;\n  }\n\n  .duration.slow {\n    color: var(--toolbar-warning);\n    font-weight: 600;\n  }\n\n  /* Timestamp */\n  .timestamp {\n    color: var(--toolbar-text-muted);\n    font-variant-numeric: tabular-nums;\n    white-space: nowrap;\n  }\n\n  /* Path/URL */\n  .path {\n    color: var(--toolbar-text);\n    max-width: 300px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  /* Message */\n  .message {\n    color: var(--toolbar-text);\n    max-width: 400px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .message:hover {\n    white-space: normal;\n    word-break: break-word;\n  }\n\n  /* Responsive */\n  @media (max-width: 768px) {\n    :host {\n      --toolbar-height-expanded: 50vh;\n    }\n\n    .toolbar-tabs {\n      max-width: 60%;\n    }\n  }\n`;\n","// Panel renderers for the debug toolbar\n// Each function returns HTML string for a specific panel type\n\nexport type RequestEntry = {\n  id?: string;\n  timestamp?: string;\n  method?: string;\n  path?: string;\n  status?: number;\n  duration?: number;\n  headers?: Record<string, string>;\n  query?: Record<string, string>;\n  error?: string;\n};\n\nexport type SQLEntry = {\n  id?: string;\n  timestamp?: string;\n  query?: string;\n  args?: unknown[];\n  duration?: number;\n  row_count?: number;\n  error?: string;\n};\n\nexport type LogEntry = {\n  timestamp?: string;\n  level?: string;\n  message?: string;\n  fields?: Record<string, unknown>;\n  source?: string;\n};\n\nexport type RouteEntry = {\n  method?: string;\n  path?: string;\n  name?: string;\n  handler?: string;\n  middleware?: string[];\n  summary?: string;\n  tags?: string[];\n};\n\nexport type CustomLogEntry = {\n  timestamp?: string;\n  category?: string;\n  message?: string;\n  fields?: Record<string, unknown>;\n};\n\nexport type CustomSnapshot = {\n  data?: Record<string, unknown>;\n  logs?: CustomLogEntry[];\n};\n\nexport type DebugSnapshot = {\n  template?: Record<string, unknown>;\n  session?: Record<string, unknown>;\n  requests?: RequestEntry[];\n  sql?: SQLEntry[];\n  logs?: LogEntry[];\n  config?: Record<string, unknown>;\n  routes?: RouteEntry[];\n  custom?: CustomSnapshot;\n};\n\n// Utility functions\nconst escapeHTML = (value: unknown): string => {\n  const str = String(value ?? '');\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n};\n\nconst formatTimestamp = (value: unknown): string => {\n  if (!value) return '';\n  if (typeof value === 'number') {\n    return new Date(value).toLocaleTimeString();\n  }\n  if (typeof value === 'string') {\n    const date = new Date(value);\n    if (!Number.isNaN(date.getTime())) {\n      return date.toLocaleTimeString();\n    }\n    return value;\n  }\n  return '';\n};\n\nconst formatDuration = (value: unknown, slowThresholdMs = 50): { text: string; isSlow: boolean } => {\n  if (value === null || value === undefined) {\n    return { text: '0ms', isSlow: false };\n  }\n  const nanos = Number(value);\n  if (Number.isNaN(nanos)) {\n    return { text: '0ms', isSlow: false };\n  }\n  const ms = nanos / 1e6;\n  const isSlow = ms >= slowThresholdMs;\n  if (ms < 1) {\n    const micros = nanos / 1e3;\n    return { text: `${micros.toFixed(1)}Âµs`, isSlow };\n  }\n  if (ms < 1000) {\n    return { text: `${ms.toFixed(2)}ms`, isSlow };\n  }\n  return { text: `${(ms / 1000).toFixed(2)}s`, isSlow };\n};\n\nconst formatJSON = (value: unknown): string => {\n  if (value === undefined || value === null) return '{}';\n  try {\n    return JSON.stringify(value, null, 2);\n  } catch {\n    return String(value ?? '');\n  }\n};\n\nconst truncate = (str: string, len: number): string => {\n  if (!str) return '';\n  return str.length > len ? str.substring(0, len) + '...' : str;\n};\n\nconst getStatusClass = (status: number | undefined): string => {\n  if (!status) return '';\n  if (status >= 500) return 'error';\n  if (status >= 400) return 'warn';\n  return '';\n};\n\nconst getLevelClass = (level: string | undefined): string => {\n  if (!level) return 'info';\n  const l = level.toLowerCase();\n  if (l === 'error' || l === 'fatal') return 'error';\n  if (l === 'warn' || l === 'warning') return 'warn';\n  if (l === 'debug' || l === 'trace') return 'debug';\n  return 'info';\n};\n\n// Panel render functions\nexport function renderPanel(\n  panel: string,\n  snapshot: DebugSnapshot,\n  slowThresholdMs = 50\n): string {\n  switch (panel) {\n    case 'requests':\n      return renderRequests(snapshot.requests || []);\n    case 'sql':\n      return renderSQL(snapshot.sql || [], slowThresholdMs);\n    case 'logs':\n      return renderLogs(snapshot.logs || []);\n    case 'config':\n      return renderJSON('Config', snapshot.config || {});\n    case 'routes':\n      return renderRoutes(snapshot.routes || []);\n    case 'template':\n      return renderJSON('Template Context', snapshot.template || {});\n    case 'session':\n      return renderJSON('Session', snapshot.session || {});\n    case 'custom':\n      return renderCustom(snapshot.custom || {});\n    default:\n      return `<div class=\"empty-state\">Panel \"${escapeHTML(panel)}\" not available</div>`;\n  }\n}\n\nfunction renderRequests(requests: RequestEntry[]): string {\n  if (!requests.length) {\n    return '<div class=\"empty-state\">No requests captured</div>';\n  }\n\n  const rows = requests\n    .slice(-50)\n    .reverse()\n    .map((req) => {\n      const methodClass = (req.method || 'get').toLowerCase();\n      const statusClass = getStatusClass(req.status);\n      const duration = formatDuration(req.duration);\n      return `\n        <tr>\n          <td><span class=\"badge badge-method ${methodClass}\">${escapeHTML(req.method || 'GET')}</span></td>\n          <td class=\"path\" title=\"${escapeHTML(req.path || '')}\">${escapeHTML(truncate(req.path || '', 50))}</td>\n          <td><span class=\"badge badge-status ${statusClass}\">${escapeHTML(req.status || '-')}</span></td>\n          <td class=\"duration ${duration.isSlow ? 'slow' : ''}\">${duration.text}</td>\n          <td class=\"timestamp\">${escapeHTML(formatTimestamp(req.timestamp))}</td>\n        </tr>\n      `;\n    })\n    .join('');\n\n  return `\n    <table>\n      <thead>\n        <tr>\n          <th>Method</th>\n          <th>Path</th>\n          <th>Status</th>\n          <th>Duration</th>\n          <th>Time</th>\n        </tr>\n      </thead>\n      <tbody>${rows}</tbody>\n    </table>\n  `;\n}\n\nfunction renderSQL(queries: SQLEntry[], slowThresholdMs: number): string {\n  if (!queries.length) {\n    return '<div class=\"empty-state\">No SQL queries captured</div>';\n  }\n\n  const rows = queries\n    .slice(-50)\n    .reverse()\n    .map((q) => {\n      const duration = formatDuration(q.duration, slowThresholdMs);\n      const rowClasses = [];\n      if (duration.isSlow) rowClasses.push('slow-query');\n      if (q.error) rowClasses.push('error-query');\n      return `\n        <tr class=\"${rowClasses.join(' ')}\">\n          <td class=\"query-text\" title=\"${escapeHTML(q.query || '')}\">${escapeHTML(truncate(q.query || '', 80))}</td>\n          <td class=\"duration ${duration.isSlow ? 'slow' : ''}\">${duration.text}</td>\n          <td>${escapeHTML(q.row_count ?? '-')}</td>\n          <td class=\"timestamp\">${escapeHTML(formatTimestamp(q.timestamp))}</td>\n        </tr>\n      `;\n    })\n    .join('');\n\n  return `\n    <table>\n      <thead>\n        <tr>\n          <th>Query</th>\n          <th>Duration</th>\n          <th>Rows</th>\n          <th>Time</th>\n        </tr>\n      </thead>\n      <tbody>${rows}</tbody>\n    </table>\n  `;\n}\n\nfunction renderLogs(logs: LogEntry[]): string {\n  if (!logs.length) {\n    return '<div class=\"empty-state\">No logs captured</div>';\n  }\n\n  const rows = logs\n    .slice(-100)\n    .reverse()\n    .map((log) => {\n      const levelClass = getLevelClass(log.level);\n      return `\n        <tr>\n          <td><span class=\"badge badge-level ${levelClass}\">${escapeHTML((log.level || 'INFO').toUpperCase())}</span></td>\n          <td class=\"message\" title=\"${escapeHTML(log.message || '')}\">${escapeHTML(truncate(log.message || '', 100))}</td>\n          <td class=\"timestamp\">${escapeHTML(formatTimestamp(log.timestamp))}</td>\n        </tr>\n      `;\n    })\n    .join('');\n\n  return `\n    <table>\n      <thead>\n        <tr>\n          <th>Level</th>\n          <th>Message</th>\n          <th>Time</th>\n        </tr>\n      </thead>\n      <tbody>${rows}</tbody>\n    </table>\n  `;\n}\n\nfunction renderRoutes(routes: RouteEntry[]): string {\n  if (!routes.length) {\n    return '<div class=\"empty-state\">No routes available</div>';\n  }\n\n  const rows = routes\n    .map((r) => {\n      const methodClass = (r.method || 'get').toLowerCase();\n      return `\n        <tr>\n          <td><span class=\"badge badge-method ${methodClass}\">${escapeHTML(r.method || '')}</span></td>\n          <td class=\"path\">${escapeHTML(r.path || '')}</td>\n          <td>${escapeHTML(r.handler || '-')}</td>\n        </tr>\n      `;\n    })\n    .join('');\n\n  return `\n    <table>\n      <thead>\n        <tr>\n          <th>Method</th>\n          <th>Path</th>\n          <th>Handler</th>\n        </tr>\n      </thead>\n      <tbody>${rows}</tbody>\n    </table>\n  `;\n}\n\nfunction renderJSON(title: string, data: Record<string, unknown>): string {\n  const keys = Object.keys(data || {});\n  if (!keys.length) {\n    return `<div class=\"empty-state\">No ${title.toLowerCase()} data available</div>`;\n  }\n\n  return `\n    <div class=\"json-viewer\">\n      <pre>${escapeHTML(formatJSON(data))}</pre>\n    </div>\n  `;\n}\n\nfunction renderCustom(custom: CustomSnapshot): string {\n  const data = custom.data || {};\n  const logs = custom.logs || [];\n\n  if (!Object.keys(data).length && !logs.length) {\n    return '<div class=\"empty-state\">No custom data captured</div>';\n  }\n\n  let content = '';\n\n  if (Object.keys(data).length) {\n    content += `\n      <div class=\"json-viewer\">\n        <pre>${escapeHTML(formatJSON(data))}</pre>\n      </div>\n    `;\n  }\n\n  if (logs.length) {\n    const logRows = logs\n      .slice(-50)\n      .reverse()\n      .map((log) => `\n        <tr>\n          <td><span class=\"badge\">${escapeHTML(log.category || 'custom')}</span></td>\n          <td class=\"message\">${escapeHTML(log.message || '')}</td>\n          <td class=\"timestamp\">${escapeHTML(formatTimestamp(log.timestamp))}</td>\n        </tr>\n      `)\n      .join('');\n\n    content += `\n      <table>\n        <thead>\n          <tr>\n            <th>Category</th>\n            <th>Message</th>\n            <th>Time</th>\n          </tr>\n        </thead>\n        <tbody>${logRows}</tbody>\n      </table>\n    `;\n  }\n\n  return content;\n}\n\n// Get counts for summary display\nexport function getCounts(snapshot: DebugSnapshot): {\n  requests: number;\n  sql: number;\n  logs: number;\n  errors: number;\n  slowQueries: number;\n} {\n  const requests = snapshot.requests?.length || 0;\n  const sql = snapshot.sql?.length || 0;\n  const logs = snapshot.logs?.length || 0;\n\n  // Count errors\n  const requestErrors = (snapshot.requests || []).filter((r) => (r.status || 0) >= 400).length;\n  const sqlErrors = (snapshot.sql || []).filter((q) => q.error).length;\n  const logErrors = (snapshot.logs || []).filter((l) => {\n    const level = (l.level || '').toLowerCase();\n    return level === 'error' || level === 'fatal';\n  }).length;\n\n  // Count slow queries (using default 50ms threshold)\n  const slowQueries = (snapshot.sql || []).filter((q) => {\n    const nanos = Number(q.duration);\n    if (Number.isNaN(nanos)) return false;\n    return nanos / 1e6 >= 50;\n  }).length;\n\n  return {\n    requests,\n    sql,\n    logs,\n    errors: requestErrors + sqlErrors + logErrors,\n    slowQueries,\n  };\n}\n","// Debug Toolbar Web Component\n// A self-contained toolbar that displays debug information at the bottom of the page\n\nimport { DebugStream, type DebugEvent, type DebugStreamStatus } from '../debug-stream.js';\nimport { toolbarStyles } from './toolbar-styles.js';\nimport { renderPanel, getCounts, type DebugSnapshot } from './panel-renderers.js';\n\n// Panel configuration\nconst defaultPanels = ['requests', 'sql', 'logs', 'routes', 'config'];\n\nconst panelLabels: Record<string, string> = {\n  template: 'Template',\n  session: 'Session',\n  requests: 'Requests',\n  sql: 'SQL',\n  logs: 'Logs',\n  config: 'Config',\n  routes: 'Routes',\n  custom: 'Custom',\n};\n\nconst panelEventMap: Record<string, string> = {\n  template: 'template',\n  session: 'session',\n  requests: 'request',\n  sql: 'sql',\n  logs: 'log',\n  custom: 'custom',\n};\n\nconst eventToPanel: Record<string, string> = {\n  request: 'requests',\n  sql: 'sql',\n  log: 'logs',\n  template: 'template',\n  session: 'session',\n  custom: 'custom',\n};\n\nexport class DebugToolbar extends HTMLElement {\n  private shadow: ShadowRoot;\n  private stream: DebugStream | null = null;\n  private snapshot: DebugSnapshot = {};\n  private expanded = false;\n  private activePanel = 'requests';\n  private connectionStatus: DebugStreamStatus = 'disconnected';\n  private slowThresholdMs = 50;\n\n  static get observedAttributes(): string[] {\n    return ['base-path', 'debug-path', 'panels', 'expanded', 'slow-threshold-ms'];\n  }\n\n  constructor() {\n    super();\n    this.shadow = this.attachShadow({ mode: 'open' });\n  }\n\n  connectedCallback(): void {\n    this.render();\n    this.initWebSocket();\n    this.fetchInitialSnapshot();\n  }\n\n  disconnectedCallback(): void {\n    this.stream?.close();\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n    if (oldValue === newValue) return;\n\n    if (name === 'expanded') {\n      this.expanded = newValue === 'true' || newValue === '';\n      this.render();\n    } else if (name === 'slow-threshold-ms') {\n      this.slowThresholdMs = parseInt(newValue || '50', 10) || 50;\n    }\n  }\n\n  // Attribute getters\n  private get basePath(): string {\n    return this.getAttribute('base-path') || '/admin';\n  }\n\n  private get debugPath(): string {\n    const attr = this.getAttribute('debug-path');\n    if (attr) return attr;\n    return `${this.basePath}/debug`;\n  }\n\n  private get panels(): string[] {\n    const attr = this.getAttribute('panels');\n    if (attr) {\n      const parsed = attr\n        .split(',')\n        .map((p) => p.trim().toLowerCase())\n        .filter(Boolean);\n      return parsed.length ? parsed : defaultPanels;\n    }\n    return defaultPanels;\n  }\n\n  private get wsUrl(): string {\n    return `${this.debugPath}/ws`;\n  }\n\n  // WebSocket initialization\n  private initWebSocket(): void {\n    this.stream = new DebugStream({\n      basePath: this.debugPath,\n      onEvent: (event) => this.handleEvent(event),\n      onStatusChange: (status) => this.handleStatusChange(status),\n    });\n\n    this.stream.connect();\n    this.stream.subscribe(this.panels.map((panel) => panelEventMap[panel] || panel));\n  }\n\n  // Fetch initial snapshot via HTTP\n  private async fetchInitialSnapshot(): Promise<void> {\n    try {\n      const response = await fetch(`${this.debugPath}/api/snapshot`, {\n        credentials: 'same-origin',\n      });\n      if (response.ok) {\n        const data = await response.json();\n        this.applySnapshot(data);\n      }\n    } catch {\n      // Ignore fetch errors - WebSocket will provide data\n    }\n  }\n\n  // Event handlers\n  private handleEvent(event: DebugEvent): void {\n    if (!event || !event.type) return;\n\n    if (event.type === 'snapshot') {\n      this.applySnapshot(event.payload as DebugSnapshot);\n      return;\n    }\n\n    // Apply incremental updates\n    const panel = eventToPanel[event.type] || event.type;\n    switch (event.type) {\n      case 'request':\n        this.snapshot.requests = this.snapshot.requests || [];\n        this.snapshot.requests.push(event.payload);\n        this.trimArray(this.snapshot.requests, 500);\n        break;\n      case 'sql':\n        this.snapshot.sql = this.snapshot.sql || [];\n        this.snapshot.sql.push(event.payload);\n        this.trimArray(this.snapshot.sql, 200);\n        break;\n      case 'log':\n        this.snapshot.logs = this.snapshot.logs || [];\n        this.snapshot.logs.push(event.payload);\n        this.trimArray(this.snapshot.logs, 500);\n        break;\n      case 'template':\n        this.snapshot.template = event.payload || {};\n        break;\n      case 'session':\n        this.snapshot.session = event.payload || {};\n        break;\n      case 'custom':\n        this.handleCustomEvent(event.payload);\n        break;\n    }\n\n    // Update UI if showing affected panel or summary\n    if (panel === this.activePanel || !this.expanded) {\n      this.updateContent();\n    }\n  }\n\n  private handleCustomEvent(payload: unknown): void {\n    if (!payload || typeof payload !== 'object') return;\n    this.snapshot.custom = this.snapshot.custom || { data: {}, logs: [] };\n\n    const p = payload as Record<string, unknown>;\n    if ('key' in p && 'value' in p) {\n      this.snapshot.custom.data = this.snapshot.custom.data || {};\n      this.snapshot.custom.data[String(p.key)] = p.value;\n    } else if ('category' in p || 'message' in p) {\n      this.snapshot.custom.logs = this.snapshot.custom.logs || [];\n      this.snapshot.custom.logs.push(payload as { category?: string; message?: string });\n      this.trimArray(this.snapshot.custom.logs, 500);\n    }\n  }\n\n  private handleStatusChange(status: DebugStreamStatus): void {\n    this.connectionStatus = status;\n    this.updateConnectionStatus();\n  }\n\n  private applySnapshot(data: DebugSnapshot): void {\n    this.snapshot = data || {};\n    this.updateContent();\n  }\n\n  private trimArray<T>(arr: T[], max: number): void {\n    while (arr.length > max) {\n      arr.shift();\n    }\n  }\n\n  // Rendering\n  private render(): void {\n    const counts = getCounts(this.snapshot);\n    const panelTabs = this.panels\n      .map((panel) => {\n        const label = panelLabels[panel] || panel;\n        const count = this.getPanelCount(panel);\n        const active = this.activePanel === panel ? 'active' : '';\n        return `\n          <button class=\"tab ${active}\" data-panel=\"${panel}\">\n            ${label}\n            <span class=\"tab-count\">${count}</span>\n          </button>\n        `;\n      })\n      .join('');\n\n    const expandedClass = this.expanded ? 'expanded' : 'collapsed';\n    const toggleIcon = this.expanded ? 'â–¼' : 'â–²';\n\n    this.shadow.innerHTML = `\n      <style>${toolbarStyles}</style>\n      <div class=\"toolbar ${expandedClass}\">\n        ${this.expanded ? `\n          <div class=\"toolbar-header\">\n            <div class=\"toolbar-tabs\">${panelTabs}</div>\n            <div class=\"toolbar-actions\">\n              <button class=\"action-btn\" data-action=\"refresh\" title=\"Refresh\">â†»</button>\n              <button class=\"action-btn\" data-action=\"clear\" title=\"Clear\">ðŸ—‘</button>\n              <a class=\"expand-link\" href=\"${this.debugPath}\" title=\"Open full debug page\">â›¶</a>\n              <button class=\"action-btn toggle-btn\" data-action=\"toggle\" title=\"Collapse\">${toggleIcon}</button>\n            </div>\n          </div>\n          <div class=\"toolbar-content\">\n            <div class=\"panel-container\" id=\"panel-content\">\n              ${renderPanel(this.activePanel, this.snapshot, this.slowThresholdMs)}\n            </div>\n          </div>\n        ` : ''}\n        <div class=\"toolbar-summary\">\n          <div class=\"summary-item ${counts.errors > 0 ? 'has-errors' : ''}\">\n            <span>Requests:</span>\n            <span class=\"count\">${counts.requests}</span>\n          </div>\n          <div class=\"summary-item ${counts.slowQueries > 0 ? 'has-slow' : ''}\">\n            <span>SQL:</span>\n            <span class=\"count\">${counts.sql}</span>\n          </div>\n          <div class=\"summary-item\">\n            <span>Logs:</span>\n            <span class=\"count\">${counts.logs}</span>\n          </div>\n          ${counts.errors > 0 ? `\n            <div class=\"summary-item has-errors\">\n              <span>Errors:</span>\n              <span class=\"count\">${counts.errors}</span>\n            </div>\n          ` : ''}\n          <div class=\"connection-status\">\n            <span class=\"status-dot ${this.connectionStatus}\"></span>\n            <span>${this.connectionStatus}</span>\n          </div>\n        </div>\n      </div>\n    `;\n\n    this.attachEventListeners();\n  }\n\n  private updateContent(): void {\n    // Update panel content if expanded\n    if (this.expanded) {\n      const container = this.shadow.getElementById('panel-content');\n      if (container) {\n        container.innerHTML = renderPanel(this.activePanel, this.snapshot, this.slowThresholdMs);\n      }\n      // Update tab counts\n      this.panels.forEach((panel) => {\n        const tab = this.shadow.querySelector(`[data-panel=\"${panel}\"] .tab-count`);\n        if (tab) {\n          tab.textContent = String(this.getPanelCount(panel));\n        }\n      });\n    }\n\n    // Update summary counts\n    this.updateSummary();\n  }\n\n  private updateSummary(): void {\n    const counts = getCounts(this.snapshot);\n    const summary = this.shadow.querySelector('.toolbar-summary');\n    if (!summary) return;\n\n    const items = summary.querySelectorAll('.summary-item');\n    items.forEach((item) => {\n      const label = item.querySelector('span:first-child')?.textContent?.replace(':', '').toLowerCase();\n      const countEl = item.querySelector('.count');\n      if (!countEl || !label) return;\n\n      if (label === 'requests') {\n        countEl.textContent = String(counts.requests);\n        item.classList.toggle('has-errors', counts.errors > 0);\n      } else if (label === 'sql') {\n        countEl.textContent = String(counts.sql);\n        item.classList.toggle('has-slow', counts.slowQueries > 0);\n      } else if (label === 'logs') {\n        countEl.textContent = String(counts.logs);\n      } else if (label === 'errors') {\n        countEl.textContent = String(counts.errors);\n      }\n    });\n  }\n\n  private updateConnectionStatus(): void {\n    const dot = this.shadow.querySelector('.status-dot');\n    const text = this.shadow.querySelector('.connection-status span:last-child');\n    if (dot) {\n      dot.className = `status-dot ${this.connectionStatus}`;\n    }\n    if (text) {\n      text.textContent = this.connectionStatus;\n    }\n  }\n\n  private getPanelCount(panel: string): number {\n    switch (panel) {\n      case 'requests':\n        return this.snapshot.requests?.length || 0;\n      case 'sql':\n        return this.snapshot.sql?.length || 0;\n      case 'logs':\n        return this.snapshot.logs?.length || 0;\n      case 'routes':\n        return this.snapshot.routes?.length || 0;\n      case 'template':\n        return Object.keys(this.snapshot.template || {}).length;\n      case 'session':\n        return Object.keys(this.snapshot.session || {}).length;\n      case 'config':\n        return Object.keys(this.snapshot.config || {}).length;\n      case 'custom':\n        const custom = this.snapshot.custom || {};\n        return Object.keys(custom.data || {}).length + (custom.logs?.length || 0);\n      default:\n        return 0;\n    }\n  }\n\n  private attachEventListeners(): void {\n    // Tab clicks\n    this.shadow.querySelectorAll('.tab').forEach((tab) => {\n      tab.addEventListener('click', (e) => {\n        const panel = (e.currentTarget as HTMLElement).dataset.panel;\n        if (panel && panel !== this.activePanel) {\n          this.activePanel = panel;\n          // Update active state\n          this.shadow.querySelectorAll('.tab').forEach((t) => t.classList.remove('active'));\n          (e.currentTarget as HTMLElement).classList.add('active');\n          // Render panel content\n          const container = this.shadow.getElementById('panel-content');\n          if (container) {\n            container.innerHTML = renderPanel(this.activePanel, this.snapshot, this.slowThresholdMs);\n          }\n        }\n      });\n    });\n\n    // Action buttons\n    this.shadow.querySelectorAll('[data-action]').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        const action = (e.currentTarget as HTMLElement).dataset.action;\n        switch (action) {\n          case 'toggle':\n            this.expanded = !this.expanded;\n            this.render();\n            break;\n          case 'refresh':\n            this.stream?.requestSnapshot();\n            break;\n          case 'clear':\n            this.stream?.clear();\n            this.snapshot = {};\n            this.updateContent();\n            break;\n        }\n      });\n    });\n\n    // Summary click to expand\n    const summary = this.shadow.querySelector('.toolbar-summary');\n    if (summary) {\n      summary.addEventListener('click', () => {\n        if (!this.expanded) {\n          this.expanded = true;\n          this.render();\n        }\n      });\n    }\n  }\n}\n\n// Register the custom element\nif (!customElements.get('debug-toolbar')) {\n  customElements.define('debug-toolbar', DebugToolbar);\n}\n"],"names":["toolbarStyles","escapeHTML","value","formatTimestamp","date","formatDuration","slowThresholdMs","nanos","ms","isSlow","formatJSON","truncate","str","len","getStatusClass","status","getLevelClass","level","l","renderPanel","panel","snapshot","renderRequests","renderSQL","renderLogs","renderJSON","renderRoutes","renderCustom","requests","req","methodClass","statusClass","duration","queries","q","rowClasses","logs","log","routes","r","title","data","custom","content","logRows","getCounts","sql","requestErrors","sqlErrors","logErrors","slowQueries","defaultPanels","panelLabels","panelEventMap","eventToPanel","DebugToolbar","name","oldValue","newValue","attr","parsed","p","DebugStream","event","response","payload","arr","max","counts","panelTabs","label","count","expandedClass","toggleIcon","container","tab","summary","item","countEl","dot","text","e","t","btn"],"mappings":";AAGO,MAAMA,IAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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"}