{"version":3,"file":"index.js","sources":["../../src/esign/api-client.ts","../../src/esign/utils/formatters.ts","../../src/esign/utils/status-badges.ts","../../src/esign/utils/dom-helpers.ts","../../src/esign/utils/async-helpers.ts","../../src/esign/pages/landing.ts","../../src/esign/pages/signer-complete.ts","../../src/esign/pages/detail-formatters.ts","../../src/esign/pages/google-callback.ts","../../src/esign/pages/google-integration.ts","../../src/esign/pages/google-drive-picker.ts"],"sourcesContent":["/**\n * E-Sign API Client\n * Centralized API client for all e-sign operations\n */\n\nimport type {\n  AgreementSummary,\n  AgreementStats,\n  DocumentSummary,\n  ListResponse,\n  APIResponse,\n  APIError,\n  GoogleIntegrationStatus,\n  GoogleImportRun,\n  DraftSummary,\n  DraftDetail,\n  WizardState,\n} from './types.js';\n\nexport interface ESignAPIClientConfig {\n  basePath: string;\n  apiBasePath?: string;\n  defaultHeaders?: Record<string, string>;\n}\n\nexport class ESignAPIClient {\n  private readonly basePath: string;\n  private readonly apiBasePath: string;\n  private readonly defaultHeaders: Record<string, string>;\n\n  constructor(config: ESignAPIClientConfig) {\n    this.basePath = config.basePath;\n    this.apiBasePath = config.apiBasePath || `${config.basePath}/api`;\n    this.defaultHeaders = {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n      ...config.defaultHeaders,\n    };\n  }\n\n  // Agreement endpoints\n  async listAgreements(params?: {\n    page?: number;\n    per_page?: number;\n    status?: string;\n    search?: string;\n  }): Promise<ListResponse<AgreementSummary>> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.status) queryParams.set('status', params.status);\n    if (params?.search) queryParams.set('search', params.search);\n\n    return this.get<ListResponse<AgreementSummary>>(\n      `/esign_agreements?${queryParams.toString()}`\n    );\n  }\n\n  async getAgreementStats(): Promise<AgreementStats> {\n    const allRows: AgreementSummary[] = [];\n    let page = 1;\n    const perPage = 200;\n    const maxPages = 25;\n\n    while (page <= maxPages) {\n      const response = await this.listAgreements({ page, per_page: perPage });\n      const rows = response.items || response.records || [];\n      allRows.push(...rows);\n\n      if (rows.length === 0 || allRows.length >= response.total) {\n        break;\n      }\n      page += 1;\n    }\n\n    const counters: Partial<Record<string, number>> = {};\n    for (const row of allRows) {\n      const status = String(row?.status || '').trim().toLowerCase();\n      if (!status) continue;\n      counters[status] = (counters[status] || 0) + 1;\n    }\n\n    const pending = (counters.sent || 0) + (counters.in_progress || 0);\n    const actionRequired = pending + (counters.declined || 0);\n\n    return {\n      draft: counters.draft || 0,\n      sent: counters.sent || 0,\n      in_progress: counters.in_progress || 0,\n      completed: counters.completed || 0,\n      voided: counters.voided || 0,\n      declined: counters.declined || 0,\n      expired: counters.expired || 0,\n      pending,\n      action_required: actionRequired,\n    };\n  }\n\n  // Document endpoints\n  async listDocuments(params?: {\n    page?: number;\n    per_page?: number;\n    search?: string;\n  }): Promise<ListResponse<DocumentSummary>> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.search) queryParams.set('search', params.search);\n\n    return this.get<ListResponse<DocumentSummary>>(\n      `/esign_documents?${queryParams.toString()}`\n    );\n  }\n\n  // Google integration endpoints\n  async getGoogleIntegrationStatus(): Promise<GoogleIntegrationStatus> {\n    return this.get<GoogleIntegrationStatus>('/v1/esign/integrations/google/status');\n  }\n\n  async startGoogleImport(params: {\n    google_file_id: string;\n    document_title?: string;\n    agreement_title?: string;\n  }): Promise<GoogleImportRun> {\n    return this.post<GoogleImportRun>('/v1/esign/google-drive/imports', params);\n  }\n\n  async getGoogleImportStatus(importRunId: string): Promise<GoogleImportRun> {\n    return this.get<GoogleImportRun>(`/v1/esign/google-drive/imports/${importRunId}`);\n  }\n\n  // Draft persistence endpoints\n  async listDrafts(params?: {\n    limit?: number;\n    cursor?: string;\n  }): Promise<{ drafts: DraftSummary[]; next_cursor: string | null; total: number }> {\n    const queryParams = new URLSearchParams();\n    if (params?.limit) queryParams.set('limit', String(params.limit));\n    if (params?.cursor) queryParams.set('cursor', params.cursor);\n\n    return this.get(`/v1/esign/drafts?${queryParams.toString()}`);\n  }\n\n  async getDraft(id: string): Promise<DraftDetail> {\n    return this.get<DraftDetail>(`/v1/esign/drafts/${id}`);\n  }\n\n  async createDraft(params: {\n    wizard_id: string;\n    wizard_state: WizardState;\n    title: string;\n    current_step: number;\n    document_id?: string | null;\n  }): Promise<DraftDetail> {\n    return this.post<DraftDetail>('/v1/esign/drafts', params);\n  }\n\n  async updateDraft(\n    id: string,\n    params: {\n      expected_revision: number;\n      wizard_state: WizardState;\n      title: string;\n      current_step: number;\n      document_id?: string | null;\n    }\n  ): Promise<DraftDetail> {\n    return this.put<DraftDetail>(`/v1/esign/drafts/${id}`, params);\n  }\n\n  async deleteDraft(id: string): Promise<void> {\n    return this.delete(`/v1/esign/drafts/${id}`);\n  }\n\n  async sendDraft(\n    id: string,\n    params: { expected_revision: number }\n  ): Promise<{\n    agreement_id: string;\n    status: 'queued' | 'sent';\n    draft_id: string;\n    draft_deleted: boolean;\n  }> {\n    return this.post(`/v1/esign/drafts/${id}/send`, params);\n  }\n\n  // Generic HTTP methods\n  private async get<T>(path: string): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'GET',\n      headers: this.defaultHeaders,\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async post<T>(path: string, body?: unknown): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'POST',\n      headers: this.defaultHeaders,\n      body: body ? JSON.stringify(body) : undefined,\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async put<T>(path: string, body: unknown): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'PUT',\n      headers: this.defaultHeaders,\n      body: JSON.stringify(body),\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async delete<T>(path: string): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'DELETE',\n      headers: this.defaultHeaders,\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async handleResponse<T>(response: Response): Promise<T> {\n    if (!response.ok) {\n      let error: APIError;\n      try {\n        const errorData = await response.json();\n        error = errorData.error || {\n          code: `HTTP_${response.status}`,\n          message: response.statusText,\n        };\n      } catch {\n        error = {\n          code: `HTTP_${response.status}`,\n          message: response.statusText,\n        };\n      }\n      throw new ESignAPIError(error.code, error.message, error.details);\n    }\n\n    if (response.status === 204) {\n      return undefined as T;\n    }\n\n    return response.json() as Promise<T>;\n  }\n}\n\nexport class ESignAPIError extends Error {\n  constructor(\n    public readonly code: string,\n    message: string,\n    public readonly details?: Record<string, unknown>\n  ) {\n    super(message);\n    this.name = 'ESignAPIError';\n  }\n}\n\n// Singleton instance management\nlet defaultClient: ESignAPIClient | null = null;\n\nexport function getESignClient(): ESignAPIClient {\n  if (!defaultClient) {\n    throw new Error('ESign API client not initialized. Call setESignClient first.');\n  }\n  return defaultClient;\n}\n\nexport function setESignClient(client: ESignAPIClient): void {\n  defaultClient = client;\n}\n\nexport function createESignClient(config: ESignAPIClientConfig): ESignAPIClient {\n  const client = new ESignAPIClient(config);\n  setESignClient(client);\n  return client;\n}\n","/**\n * E-Sign Formatters\n * Common formatting utilities for dates, file sizes, and document metadata\n */\n\n/**\n * Format bytes to human-readable file size\n */\nexport function formatFileSize(bytes: number | string | undefined | null): string {\n  if (bytes === undefined || bytes === null || bytes === '' || bytes === 0) return '-';\n  const numBytes = typeof bytes === 'string' ? parseInt(bytes, 10) : bytes;\n  if (!Number.isFinite(numBytes) || numBytes <= 0) return '-';\n\n  if (numBytes < 1024) return `${numBytes} B`;\n  if (numBytes < 1024 * 1024) return `${(numBytes / 1024).toFixed(1)} KB`;\n  return `${(numBytes / (1024 * 1024)).toFixed(2)} MB`;\n}\n\n/**\n * Format page count with proper pluralization\n */\nexport function formatPageCount(count: number | string | undefined | null): string {\n  if (!count) return '-';\n  const numCount = typeof count === 'string' ? parseInt(count, 10) : count;\n  if (!Number.isFinite(numCount) || numCount <= 0) return '-';\n  return numCount === 1 ? '1 page' : `${numCount} pages`;\n}\n\n/**\n * Format date/time for display\n */\nexport function formatDateTime(\n  value: string | Date | undefined | null,\n  options?: Intl.DateTimeFormatOptions\n): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const defaultOptions: Intl.DateTimeFormatOptions = {\n      dateStyle: 'short',\n      timeStyle: 'short',\n    };\n\n    return date.toLocaleString(undefined, options || defaultOptions);\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format date only (no time)\n */\nexport function formatDate(\n  value: string | Date | undefined | null,\n  options?: Intl.DateTimeFormatOptions\n): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const defaultOptions: Intl.DateTimeFormatOptions = {\n      dateStyle: 'medium',\n    };\n\n    return date.toLocaleDateString(undefined, options || defaultOptions);\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format time only (no date)\n */\nexport function formatTime(\n  value: string | Date | undefined | null,\n  options?: Intl.DateTimeFormatOptions\n): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const defaultOptions: Intl.DateTimeFormatOptions = {\n      hour: '2-digit',\n      minute: '2-digit',\n    };\n\n    return date.toLocaleTimeString(undefined, options || defaultOptions);\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format relative time (e.g., \"2 hours ago\", \"in 3 days\")\n */\nexport function formatRelativeTime(value: string | Date | undefined | null): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const now = new Date();\n    const diffMs = date.getTime() - now.getTime();\n    const diffSec = Math.round(diffMs / 1000);\n    const diffMin = Math.round(diffSec / 60);\n    const diffHour = Math.round(diffMin / 60);\n    const diffDay = Math.round(diffHour / 24);\n\n    const rtf = new Intl.RelativeTimeFormat(undefined, { numeric: 'auto' });\n\n    if (Math.abs(diffDay) >= 1) {\n      return rtf.format(diffDay, 'day');\n    }\n    if (Math.abs(diffHour) >= 1) {\n      return rtf.format(diffHour, 'hour');\n    }\n    if (Math.abs(diffMin) >= 1) {\n      return rtf.format(diffMin, 'minute');\n    }\n    return rtf.format(diffSec, 'second');\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format recipient count with proper pluralization\n */\nexport function formatRecipientCount(count: number | undefined | null): string {\n  if (count === undefined || count === null) return '0 recipients';\n  return count === 1 ? '1 recipient' : `${count} recipients`;\n}\n\n/**\n * Capitalize first letter of a string\n */\nexport function capitalize(str: string): string {\n  if (!str) return '';\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Convert snake_case to Title Case\n */\nexport function snakeToTitle(str: string): string {\n  if (!str) return '';\n  return str\n    .split('_')\n    .map((word) => capitalize(word))\n    .join(' ');\n}\n\n/**\n * Truncate string with ellipsis\n */\nexport function truncate(str: string, maxLength: number): string {\n  if (!str || str.length <= maxLength) return str;\n  return `${str.slice(0, maxLength - 3)}...`;\n}\n","/**\n * E-Sign Status Badges\n * Status badge rendering utilities for agreements and documents\n */\n\nimport type { AgreementStatus } from '../types.js';\n\nexport interface BadgeConfig {\n  label: string;\n  bgClass: string;\n  textClass: string;\n  dotClass?: string;\n}\n\n/**\n * Agreement status badge configurations\n */\nexport const AGREEMENT_STATUS_BADGES: Record<AgreementStatus, BadgeConfig> = {\n  draft: {\n    label: 'Draft',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-700',\n    dotClass: 'bg-gray-400',\n  },\n  sent: {\n    label: 'Sent',\n    bgClass: 'bg-blue-100',\n    textClass: 'text-blue-700',\n    dotClass: 'bg-blue-400',\n  },\n  in_progress: {\n    label: 'In Progress',\n    bgClass: 'bg-amber-100',\n    textClass: 'text-amber-700',\n    dotClass: 'bg-amber-400',\n  },\n  completed: {\n    label: 'Completed',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    dotClass: 'bg-green-500',\n  },\n  voided: {\n    label: 'Voided',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    dotClass: 'bg-red-500',\n  },\n  declined: {\n    label: 'Declined',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    dotClass: 'bg-red-500',\n  },\n  expired: {\n    label: 'Expired',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-500',\n    dotClass: 'bg-gray-400',\n  },\n};\n\n/**\n * Get badge configuration for an agreement status\n */\nexport function getAgreementStatusBadge(\n  status: AgreementStatus | string\n): BadgeConfig {\n  const normalizedStatus = String(status || '')\n    .trim()\n    .toLowerCase() as AgreementStatus;\n  return (\n    AGREEMENT_STATUS_BADGES[normalizedStatus] || {\n      label: status || 'Unknown',\n      bgClass: 'bg-gray-100',\n      textClass: 'text-gray-600',\n      dotClass: 'bg-gray-400',\n    }\n  );\n}\n\n/**\n * Render a status badge as HTML\n */\nexport function renderStatusBadge(\n  status: AgreementStatus | string,\n  options?: {\n    showDot?: boolean;\n    size?: 'sm' | 'md' | 'lg';\n  }\n): string {\n  const badge = getAgreementStatusBadge(status);\n  const showDot = options?.showDot ?? false;\n  const size = options?.size ?? 'sm';\n\n  const sizeClasses = {\n    sm: 'px-2.5 py-0.5 text-xs',\n    md: 'px-3 py-1 text-sm',\n    lg: 'px-4 py-1.5 text-base',\n  };\n\n  const dotHtml = showDot\n    ? `<span class=\"w-2 h-2 rounded-full ${badge.dotClass} mr-1.5\" aria-hidden=\"true\"></span>`\n    : '';\n\n  return `<span class=\"inline-flex items-center ${sizeClasses[size]} rounded-full font-medium ${badge.bgClass} ${badge.textClass}\">${dotHtml}${badge.label}</span>`;\n}\n\n/**\n * Render a status badge element (returns DOM element)\n */\nexport function createStatusBadgeElement(\n  status: AgreementStatus | string,\n  options?: {\n    showDot?: boolean;\n    size?: 'sm' | 'md' | 'lg';\n  }\n): HTMLSpanElement {\n  const container = document.createElement('span');\n  container.innerHTML = renderStatusBadge(status, options);\n  return container.firstElementChild as HTMLSpanElement;\n}\n\n/**\n * Update an existing badge element with new status\n */\nexport function updateStatusBadge(\n  element: HTMLElement,\n  status: AgreementStatus | string,\n  options?: {\n    showDot?: boolean;\n    size?: 'sm' | 'md' | 'lg';\n  }\n): void {\n  const badge = getAgreementStatusBadge(status);\n  const size = options?.size ?? 'sm';\n\n  const sizeClasses = {\n    sm: 'px-2.5 py-0.5 text-xs',\n    md: 'px-3 py-1 text-sm',\n    lg: 'px-4 py-1.5 text-base',\n  };\n\n  // Remove old status classes\n  element.className = '';\n  element.className = `inline-flex items-center ${sizeClasses[size]} rounded-full font-medium ${badge.bgClass} ${badge.textClass}`;\n\n  // Update content\n  const showDot = options?.showDot ?? false;\n  if (showDot) {\n    const existingDot = element.querySelector('.rounded-full');\n    if (existingDot) {\n      existingDot.className = `w-2 h-2 rounded-full ${badge.dotClass} mr-1.5`;\n    } else {\n      const dotSpan = document.createElement('span');\n      dotSpan.className = `w-2 h-2 rounded-full ${badge.dotClass} mr-1.5`;\n      dotSpan.setAttribute('aria-hidden', 'true');\n      element.prepend(dotSpan);\n    }\n  }\n\n  // Update label text (find text node or last child)\n  const textContent = element.childNodes[element.childNodes.length - 1];\n  if (textContent && textContent.nodeType === Node.TEXT_NODE) {\n    textContent.textContent = badge.label;\n  } else {\n    element.appendChild(document.createTextNode(badge.label));\n  }\n}\n","/**\n * E-Sign DOM Helpers\n * Utilities for DOM manipulation, element selection, and event handling\n */\n\n/**\n * Safely query selector that returns null instead of throwing\n */\nexport function qs<T extends Element = Element>(\n  selector: string,\n  parent: ParentNode = document\n): T | null {\n  try {\n    return parent.querySelector<T>(selector);\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Query all matching elements\n */\nexport function qsa<T extends Element = Element>(\n  selector: string,\n  parent: ParentNode = document\n): T[] {\n  try {\n    return Array.from(parent.querySelectorAll<T>(selector));\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get element by ID with type safety\n */\nexport function byId<T extends HTMLElement = HTMLElement>(id: string): T | null {\n  return document.getElementById(id) as T | null;\n}\n\n/**\n * Create an element with attributes and children\n */\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\n  tagName: K,\n  attributes?: Record<string, string | undefined>,\n  children?: (Node | string)[]\n): HTMLElementTagNameMap[K] {\n  const element = document.createElement(tagName);\n\n  if (attributes) {\n    for (const [key, value] of Object.entries(attributes)) {\n      if (value !== undefined) {\n        element.setAttribute(key, value);\n      }\n    }\n  }\n\n  if (children) {\n    for (const child of children) {\n      if (typeof child === 'string') {\n        element.appendChild(document.createTextNode(child));\n      } else {\n        element.appendChild(child);\n      }\n    }\n  }\n\n  return element;\n}\n\n/**\n * Add event listener with automatic cleanup on AbortSignal\n */\nexport function on<K extends keyof HTMLElementEventMap>(\n  element: HTMLElement | Document | Window,\n  event: K,\n  handler: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void,\n  options?: AddEventListenerOptions & { signal?: AbortSignal }\n): () => void {\n  element.addEventListener(event, handler as EventListener, options);\n  return () => element.removeEventListener(event, handler as EventListener, options);\n}\n\n/**\n * Add delegated event listener\n */\nexport function delegate<K extends keyof HTMLElementEventMap>(\n  parent: HTMLElement | Document,\n  selector: string,\n  event: K,\n  handler: (this: HTMLElement, ev: HTMLElementEventMap[K], target: HTMLElement) => void,\n  options?: AddEventListenerOptions\n): () => void {\n  const delegatedHandler = (ev: Event) => {\n    const target = (ev.target as HTMLElement).closest(selector);\n    if (target && parent.contains(target)) {\n      handler.call(target as HTMLElement, ev as HTMLElementEventMap[K], target as HTMLElement);\n    }\n  };\n\n  parent.addEventListener(event, delegatedHandler, options);\n  return () => parent.removeEventListener(event, delegatedHandler, options);\n}\n\n/**\n * Run callback when DOM is ready\n */\nexport function onReady(callback: () => void): void {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', callback, { once: true });\n  } else {\n    callback();\n  }\n}\n\n/**\n * Show element (remove hidden classes)\n */\nexport function show(element: HTMLElement | null): void {\n  if (!element) return;\n  element.classList.remove('hidden', 'invisible');\n  element.style.display = '';\n}\n\n/**\n * Hide element (add hidden class)\n */\nexport function hide(element: HTMLElement | null): void {\n  if (!element) return;\n  element.classList.add('hidden');\n}\n\n/**\n * Toggle element visibility\n */\nexport function toggle(element: HTMLElement | null, visible?: boolean): void {\n  if (!element) return;\n  const shouldShow = visible ?? element.classList.contains('hidden');\n  if (shouldShow) {\n    show(element);\n  } else {\n    hide(element);\n  }\n}\n\n/**\n * Set element loading state\n */\nexport function setLoading(\n  element: HTMLElement | null,\n  loading: boolean,\n  options?: { spinnerClass?: string }\n): void {\n  if (!element) return;\n\n  if (loading) {\n    element.setAttribute('aria-busy', 'true');\n    element.classList.add('opacity-50', 'pointer-events-none');\n    if (element instanceof HTMLButtonElement || element instanceof HTMLInputElement) {\n      element.disabled = true;\n    }\n  } else {\n    element.removeAttribute('aria-busy');\n    element.classList.remove('opacity-50', 'pointer-events-none');\n    if (element instanceof HTMLButtonElement || element instanceof HTMLInputElement) {\n      element.disabled = false;\n    }\n  }\n}\n\n/**\n * Update text content of element by data attribute\n */\nexport function updateDataText(\n  key: string,\n  value: string | number,\n  parent: ParentNode = document\n): void {\n  const element = qs(`[data-esign-${key}]`, parent);\n  if (element) {\n    element.textContent = String(value);\n  }\n}\n\n/**\n * Update multiple data text elements\n */\nexport function updateDataTexts(\n  values: Record<string, string | number>,\n  parent: ParentNode = document\n): void {\n  for (const [key, value] of Object.entries(values)) {\n    updateDataText(key, value, parent);\n  }\n}\n\n/**\n * Extract page config from script tag or data attribute\n */\nexport function getPageConfig<T extends Record<string, unknown>>(\n  selector = '[data-esign-page]',\n  configAttr = 'data-esign-config'\n): T | null {\n  const element = qs(selector);\n  if (!element) return null;\n\n  // Try data attribute first\n  const configStr = element.getAttribute(configAttr);\n  if (configStr) {\n    try {\n      return JSON.parse(configStr) as T;\n    } catch {\n      console.warn('Failed to parse page config from attribute:', configStr);\n    }\n  }\n\n  // Try script tag with type=\"application/json\"\n  const scriptEl = qs<HTMLScriptElement>(\n    'script[type=\"application/json\"]',\n    element\n  );\n  if (scriptEl?.textContent) {\n    try {\n      return JSON.parse(scriptEl.textContent) as T;\n    } catch {\n      console.warn('Failed to parse page config from script:', scriptEl.textContent);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Announce message to screen readers\n */\nexport function announce(\n  message: string,\n  priority: 'polite' | 'assertive' = 'polite'\n): void {\n  const announcer =\n    qs(`[aria-live=\"${priority}\"]`) ||\n    (() => {\n      const el = createElement('div', {\n        'aria-live': priority,\n        'aria-atomic': 'true',\n        class: 'sr-only',\n      });\n      document.body.appendChild(el);\n      return el;\n    })();\n\n  announcer.textContent = '';\n  requestAnimationFrame(() => {\n    announcer.textContent = message;\n  });\n}\n","/**\n * E-Sign Async Helpers\n * Utilities for polling, retrying, and async operations\n */\n\nexport interface PollOptions<T> {\n  /** Function to call on each poll */\n  fn: () => Promise<T>;\n  /** Function to check if polling should stop (return true to stop) */\n  until: (result: T) => boolean;\n  /** Interval between polls in milliseconds (default: 2000) */\n  interval?: number;\n  /** Maximum time to poll in milliseconds (default: 60000) */\n  timeout?: number;\n  /** Maximum number of poll attempts (default: 30) */\n  maxAttempts?: number;\n  /** Callback on each poll result */\n  onProgress?: (result: T, attempt: number) => void;\n  /** Abort signal for cancellation */\n  signal?: AbortSignal;\n}\n\nexport interface PollResult<T> {\n  result: T;\n  attempts: number;\n  stopped: boolean;\n  timedOut: boolean;\n}\n\n/**\n * Poll a function until a condition is met or timeout\n */\nexport async function poll<T>(options: PollOptions<T>): Promise<PollResult<T>> {\n  const {\n    fn,\n    until,\n    interval = 2000,\n    timeout = 60000,\n    maxAttempts = 30,\n    onProgress,\n    signal,\n  } = options;\n\n  const startTime = Date.now();\n  let attempts = 0;\n  let lastResult: T;\n\n  while (attempts < maxAttempts) {\n    if (signal?.aborted) {\n      throw new DOMException('Polling aborted', 'AbortError');\n    }\n\n    const elapsedTime = Date.now() - startTime;\n    if (elapsedTime >= timeout) {\n      return {\n        result: lastResult!,\n        attempts,\n        stopped: false,\n        timedOut: true,\n      };\n    }\n\n    attempts++;\n    lastResult = await fn();\n\n    if (onProgress) {\n      onProgress(lastResult, attempts);\n    }\n\n    if (until(lastResult)) {\n      return {\n        result: lastResult,\n        attempts,\n        stopped: true,\n        timedOut: false,\n      };\n    }\n\n    // Wait before next poll\n    await sleep(interval, signal);\n  }\n\n  return {\n    result: lastResult!,\n    attempts,\n    stopped: false,\n    timedOut: false,\n  };\n}\n\nexport interface RetryOptions<T> {\n  /** Function to retry */\n  fn: () => Promise<T>;\n  /** Maximum number of retry attempts (default: 3) */\n  maxAttempts?: number;\n  /** Base delay between retries in ms (default: 1000) */\n  baseDelay?: number;\n  /** Maximum delay between retries in ms (default: 30000) */\n  maxDelay?: number;\n  /** Whether to use exponential backoff (default: true) */\n  exponentialBackoff?: boolean;\n  /** Function to determine if error is retryable (default: all errors) */\n  shouldRetry?: (error: unknown, attempt: number) => boolean;\n  /** Callback on each retry */\n  onRetry?: (error: unknown, attempt: number, delay: number) => void;\n  /** Abort signal for cancellation */\n  signal?: AbortSignal;\n}\n\n/**\n * Retry a function with exponential backoff\n */\nexport async function retry<T>(options: RetryOptions<T>): Promise<T> {\n  const {\n    fn,\n    maxAttempts = 3,\n    baseDelay = 1000,\n    maxDelay = 30000,\n    exponentialBackoff = true,\n    shouldRetry = () => true,\n    onRetry,\n    signal,\n  } = options;\n\n  let lastError: unknown;\n\n  for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n    if (signal?.aborted) {\n      throw new DOMException('Retry aborted', 'AbortError');\n    }\n\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error;\n\n      if (attempt >= maxAttempts || !shouldRetry(error, attempt)) {\n        throw error;\n      }\n\n      const delay = exponentialBackoff\n        ? Math.min(baseDelay * Math.pow(2, attempt - 1), maxDelay)\n        : baseDelay;\n\n      if (onRetry) {\n        onRetry(error, attempt, delay);\n      }\n\n      await sleep(delay, signal);\n    }\n  }\n\n  throw lastError;\n}\n\n/**\n * Sleep for a specified duration\n */\nexport function sleep(ms: number, signal?: AbortSignal): Promise<void> {\n  return new Promise((resolve, reject) => {\n    if (signal?.aborted) {\n      reject(new DOMException('Sleep aborted', 'AbortError'));\n      return;\n    }\n\n    const timeoutId = setTimeout(resolve, ms);\n\n    if (signal) {\n      const abortHandler = () => {\n        clearTimeout(timeoutId);\n        reject(new DOMException('Sleep aborted', 'AbortError'));\n      };\n      signal.addEventListener('abort', abortHandler, { once: true });\n    }\n  });\n}\n\n/**\n * Debounce a function\n */\nexport function debounce<T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  delay: number\n): (...args: Parameters<T>) => void {\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n  return (...args: Parameters<T>) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      fn(...args);\n      timeoutId = null;\n    }, delay);\n  };\n}\n\n/**\n * Throttle a function\n */\nexport function throttle<T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  delay: number\n): (...args: Parameters<T>) => void {\n  let lastCall = 0;\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n  return (...args: Parameters<T>) => {\n    const now = Date.now();\n\n    if (now - lastCall >= delay) {\n      lastCall = now;\n      fn(...args);\n    } else if (!timeoutId) {\n      timeoutId = setTimeout(\n        () => {\n          lastCall = Date.now();\n          timeoutId = null;\n          fn(...args);\n        },\n        delay - (now - lastCall)\n      );\n    }\n  };\n}\n\n/**\n * Create an AbortController with timeout\n */\nexport function createTimeoutController(\n  timeoutMs: number\n): { controller: AbortController; cleanup: () => void } {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n  return {\n    controller,\n    cleanup: () => clearTimeout(timeoutId),\n  };\n}\n\n/**\n * Race a promise against a timeout\n */\nexport async function withTimeout<T>(\n  promise: Promise<T>,\n  timeoutMs: number,\n  errorMessage = 'Operation timed out'\n): Promise<T> {\n  let timeoutId: ReturnType<typeof setTimeout>;\n\n  const timeoutPromise = new Promise<never>((_, reject) => {\n    timeoutId = setTimeout(() => {\n      reject(new Error(errorMessage));\n    }, timeoutMs);\n  });\n\n  try {\n    return await Promise.race([promise, timeoutPromise]);\n  } finally {\n    clearTimeout(timeoutId!);\n  }\n}\n","/**\n * E-Sign Landing Page Controller\n * Handles dynamic stats loading and page initialization for the landing page\n */\n\nimport type { ESignPageConfig, AgreementStats } from '../types.js';\nimport { ESignAPIClient, createESignClient } from '../api-client.js';\nimport { onReady, updateDataText, getPageConfig } from '../utils/dom-helpers.js';\n\nexport interface LandingPageConfig extends ESignPageConfig {\n  initialStats?: Partial<AgreementStats>;\n}\n\n/**\n * Landing page controller\n * Fetches and displays agreement statistics dynamically\n */\nexport class LandingPageController {\n  private readonly config: LandingPageConfig;\n  private readonly client: ESignAPIClient;\n\n  constructor(config: LandingPageConfig) {\n    this.config = config;\n    this.client = createESignClient({\n      basePath: config.basePath,\n      apiBasePath: config.apiBasePath,\n    });\n  }\n\n  /**\n   * Initialize the landing page\n   */\n  async init(): Promise<void> {\n    try {\n      await this.loadStats();\n    } catch (err) {\n      console.debug('Could not fetch agreement stats:', err);\n    }\n  }\n\n  /**\n   * Load and display agreement statistics\n   */\n  private async loadStats(): Promise<void> {\n    const stats = await this.client.getAgreementStats();\n\n    updateDataText('count=\"draft\"', stats.draft);\n    updateDataText('count=\"pending\"', stats.pending);\n    updateDataText('count=\"completed\"', stats.completed);\n    updateDataText('count=\"action_required\"', stats.action_required);\n\n    // Also update using the standard data attribute pattern\n    this.updateStatElement('draft', stats.draft);\n    this.updateStatElement('pending', stats.pending);\n    this.updateStatElement('completed', stats.completed);\n    this.updateStatElement('action_required', stats.action_required);\n  }\n\n  /**\n   * Update a stat element by key\n   */\n  private updateStatElement(key: string, value: number): void {\n    const el = document.querySelector(`[data-esign-count=\"${key}\"]`);\n    if (el) {\n      el.textContent = String(value);\n    }\n  }\n}\n\n/**\n * Auto-initialize landing page from page config\n */\nexport function initLandingPage(config?: LandingPageConfig): LandingPageController {\n  const pageConfig = config || getPageConfig<LandingPageConfig>('[data-esign-page=\"landing\"]');\n\n  if (!pageConfig) {\n    throw new Error('Landing page config not found. Add data-esign-page=\"landing\" with config.');\n  }\n\n  const controller = new LandingPageController(pageConfig);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap landing page from inline config (for migration compatibility)\n */\nexport function bootstrapLandingPage(basePath: string, apiBasePath?: string): void {\n  const config: LandingPageConfig = {\n    basePath,\n    apiBasePath: apiBasePath || `${basePath}/api`,\n  };\n\n  const controller = new LandingPageController(config);\n  onReady(() => controller.init());\n}\n\n// Auto-init if page marker is present\nif (typeof document !== 'undefined') {\n  onReady(() => {\n    const pageEl = document.querySelector('[data-esign-page=\"landing\"]');\n    if (pageEl) {\n      const configAttr = pageEl.getAttribute('data-esign-config');\n      if (configAttr) {\n        try {\n          const config = JSON.parse(configAttr) as LandingPageConfig;\n          const controller = new LandingPageController(config);\n          controller.init();\n        } catch (e) {\n          console.warn('Failed to parse landing page config:', e);\n        }\n      }\n    }\n  });\n}\n","/**\n * E-Sign Signer Complete Page Controller\n * Handles artifact loading and display after signing completion\n */\n\nimport type { ESignPageConfig } from '../types.js';\nimport { onReady, qs, show, hide } from '../utils/dom-helpers.js';\nimport { poll } from '../utils/async-helpers.js';\n\nexport interface SignerCompleteConfig extends ESignPageConfig {\n  token: string;\n  apiBasePath: string;\n  agreementCompleted: boolean;\n  hasServerDownloadUrl: boolean;\n}\n\nexport interface ArtifactUrls {\n  executed: string | null;\n  source: string | null;\n  certificate: string | null;\n}\n\ninterface ArtifactState {\n  loaded: boolean;\n  loading: boolean;\n  hasArtifacts: boolean;\n  retryCount: number;\n  maxRetries: number;\n}\n\n/**\n * Signer completion page controller\n * Manages artifact loading states and display\n */\nexport class SignerCompletePageController {\n  private readonly config: SignerCompleteConfig;\n  private state: ArtifactState = {\n    loaded: false,\n    loading: false,\n    hasArtifacts: false,\n    retryCount: 0,\n    maxRetries: 3,\n  };\n\n  constructor(config: SignerCompleteConfig) {\n    this.config = config;\n  }\n\n  /**\n   * Initialize the completion page\n   */\n  async init(): Promise<void> {\n    await this.loadArtifacts();\n  }\n\n  /**\n   * Load artifacts from the assets endpoint\n   */\n  async loadArtifacts(): Promise<void> {\n    if (this.state.loading) return;\n\n    this.state.loading = true;\n    this.showArtifactState('loading');\n\n    try {\n      const response = await fetch(\n        `${this.config.apiBasePath}/assets/${this.config.token}`,\n        {\n          method: 'GET',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error('Failed to load artifacts');\n      }\n\n      const payload = await response.json();\n      const assets = payload?.assets || {};\n      const artifacts = this.resolveArtifacts(assets);\n\n      if (artifacts) {\n        this.state.hasArtifacts = true;\n        this.displayArtifacts(artifacts);\n        this.showArtifactState('available');\n      } else if (this.config.agreementCompleted) {\n        // Agreement is complete but artifacts not yet generated - show processing state\n        this.showArtifactState('processing');\n        // Schedule a retry after a delay\n        if (this.state.retryCount < this.state.maxRetries) {\n          this.state.retryCount++;\n          setTimeout(() => this.loadArtifacts(), 5000);\n        }\n      } else {\n        // Agreement not complete yet - show processing (waiting for other signers)\n        this.showArtifactState('processing');\n      }\n\n      this.state.loaded = true;\n    } catch (error) {\n      console.error('Artifact load error:', error);\n\n      // If we have a server-rendered fallback, use it\n      if (this.config.hasServerDownloadUrl) {\n        this.showArtifactState('fallback');\n      } else {\n        this.showArtifactState('unavailable');\n      }\n    } finally {\n      this.state.loading = false;\n    }\n  }\n\n  /**\n   * Resolve binary asset URLs from the assets response.\n   * Never uses contract_url (which returns JSON).\n   */\n  private resolveArtifacts(\n    assets: Record<string, string | undefined>\n  ): ArtifactUrls | null {\n    const artifacts: ArtifactUrls = {\n      executed: assets.executed_url || null,\n      source: assets.source_url || null,\n      certificate: assets.certificate_url || null,\n    };\n\n    const hasAny = !!(\n      artifacts.executed ||\n      artifacts.source ||\n      artifacts.certificate\n    );\n\n    return hasAny ? artifacts : null;\n  }\n\n  /**\n   * Show a specific artifact section and hide others\n   */\n  private showArtifactState(state: string): void {\n    const states = ['loading', 'processing', 'available', 'unavailable', 'fallback'];\n    states.forEach((s) => {\n      const el = qs(`#artifacts-${s}`);\n      if (el) {\n        if (s === state) {\n          show(el as HTMLElement);\n        } else {\n          hide(el as HTMLElement);\n        }\n      }\n    });\n  }\n\n  /**\n   * Display available artifacts in the UI\n   */\n  private displayArtifacts(artifacts: ArtifactUrls): void {\n    if (artifacts.executed) {\n      const container = qs('#artifact-executed');\n      const link = qs<HTMLAnchorElement>('#artifact-executed-link');\n      if (container && link) {\n        link.href = new URL(artifacts.executed, window.location.origin).toString();\n        show(container as HTMLElement);\n      }\n    }\n\n    if (artifacts.source) {\n      const container = qs('#artifact-source');\n      const link = qs<HTMLAnchorElement>('#artifact-source-link');\n      if (container && link) {\n        link.href = new URL(artifacts.source, window.location.origin).toString();\n        show(container as HTMLElement);\n      }\n    }\n\n    if (artifacts.certificate) {\n      const container = qs('#artifact-certificate');\n      const link = qs<HTMLAnchorElement>('#artifact-certificate-link');\n      if (container && link) {\n        link.href = new URL(artifacts.certificate, window.location.origin).toString();\n        show(container as HTMLElement);\n      }\n    }\n  }\n\n  /**\n   * Get current state (for testing)\n   */\n  getState(): ArtifactState {\n    return { ...this.state };\n  }\n}\n\n/**\n * Initialize signer complete page from config\n */\nexport function initSignerCompletePage(\n  config: SignerCompleteConfig\n): SignerCompletePageController {\n  const controller = new SignerCompletePageController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap signer complete page from inline config\n */\nexport function bootstrapSignerCompletePage(config: SignerCompleteConfig): void {\n  const controller = new SignerCompletePageController(config);\n  onReady(() => controller.init());\n\n  // Export for testing and retry functionality\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignCompletionController = controller;\n    (window as unknown as Record<string, unknown>).loadArtifacts = () => controller.loadArtifacts();\n  }\n}\n","/**\n * E-Sign Detail Page Formatters\n * Applies client-side formatting to detail page elements\n */\n\nimport { formatFileSize, formatDateTime } from '../utils/formatters.js';\nimport { onReady, qsa, qs } from '../utils/dom-helpers.js';\n\n/**\n * Apply file size formatting to elements with data-size-bytes attribute\n */\nexport function formatSizeElements(parent: ParentNode = document): void {\n  qsa<HTMLElement>('[data-size-bytes]', parent).forEach((el) => {\n    const bytes = el.getAttribute('data-size-bytes');\n    if (bytes) {\n      el.textContent = formatFileSize(bytes);\n    }\n  });\n}\n\n/**\n * Apply timestamp formatting to elements with data-timestamp attribute\n */\nexport function formatTimestampElements(parent: ParentNode = document): void {\n  qsa<HTMLElement>('[data-timestamp]', parent).forEach((el) => {\n    const ts = el.getAttribute('data-timestamp');\n    if (ts) {\n      el.textContent = formatDateTime(ts);\n    }\n  });\n}\n\n/**\n * Apply all detail page formatters\n */\nexport function applyDetailFormatters(parent: ParentNode = document): void {\n  formatSizeElements(parent);\n  formatTimestampElements(parent);\n}\n\n/**\n * Initialize detail page formatters on DOM ready\n */\nexport function initDetailFormatters(): void {\n  onReady(() => {\n    applyDetailFormatters();\n  });\n}\n\n// Auto-init on module load\nif (typeof document !== 'undefined') {\n  initDetailFormatters();\n}\n","/**\n * E-Sign Google OAuth Callback Page Controller\n * Handles OAuth redirect/callback flow from Google\n */\n\nimport type { ESignPageConfig, GoogleOAuthCallbackData, GoogleOAuthState } from '../types.js';\nimport { qs, show, hide, onReady } from '../utils/dom-helpers.js';\n\nexport interface GoogleCallbackConfig extends ESignPageConfig {\n  /** If popup not opened, redirect to this path on close */\n  fallbackRedirectPath?: string;\n}\n\ntype CallbackState = 'loading' | 'success' | 'error';\n\n/**\n * Error messages for OAuth error codes\n */\nconst ERROR_MESSAGES: Record<string, string> = {\n  access_denied: 'You denied access to your Google account.',\n  invalid_request: 'The authorization request was invalid.',\n  unauthorized_client: 'This application is not authorized.',\n  unsupported_response_type: 'The response type is not supported.',\n  invalid_scope: 'The requested scope is invalid.',\n  server_error: 'Google encountered a server error.',\n  temporarily_unavailable: 'Google is temporarily unavailable. Please try again.',\n  unknown: 'Authorization failed.',\n};\n\n/**\n * Google OAuth callback page controller\n * Handles the OAuth redirect from Google and communicates back to the opener window\n */\nexport class GoogleCallbackController {\n  private readonly config: GoogleCallbackConfig;\n  private readonly elements: {\n    loadingState: HTMLElement | null;\n    successState: HTMLElement | null;\n    errorState: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    errorDetail: HTMLElement | null;\n    closeBtn: HTMLElement | null;\n  };\n\n  constructor(config: GoogleCallbackConfig) {\n    this.config = config;\n    this.elements = {\n      loadingState: qs('#loading-state'),\n      successState: qs('#success-state'),\n      errorState: qs('#error-state'),\n      errorMessage: qs('#error-message'),\n      errorDetail: qs('#error-detail'),\n      closeBtn: qs('#close-btn'),\n    };\n  }\n\n  /**\n   * Initialize the callback page\n   */\n  init(): void {\n    this.setupEventListeners();\n    this.processCallback();\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const { closeBtn } = this.elements;\n\n    if (closeBtn) {\n      closeBtn.addEventListener('click', () => this.handleClose());\n    }\n  }\n\n  /**\n   * Process the OAuth callback parameters\n   */\n  private processCallback(): void {\n    const params = new URLSearchParams(window.location.search);\n    const code = params.get('code');\n    const error = params.get('error');\n    const errorDescription = params.get('error_description');\n    const state = params.get('state');\n\n    // Parse state to extract user_id and account_id\n    const stateData = this.parseOAuthState(state);\n\n    // Also check for account_id in query params (fallback)\n    if (!stateData.account_id) {\n      stateData.account_id = (params.get('account_id') || '').trim();\n    }\n\n    if (error) {\n      this.handleError(error, errorDescription, stateData);\n    } else if (code) {\n      this.handleSuccess(code, stateData);\n    } else {\n      this.handleError('unknown', 'No authorization code was received from Google.', stateData);\n    }\n  }\n\n  /**\n   * Parse OAuth state parameter\n   */\n  private parseOAuthState(rawState: string | null): GoogleOAuthState {\n    const result: GoogleOAuthState = {\n      user_id: '',\n      account_id: '',\n    };\n\n    if (!rawState) {\n      return result;\n    }\n\n    try {\n      const parsed = JSON.parse(rawState);\n      if (parsed && typeof parsed === 'object') {\n        if (typeof parsed.user_id === 'string') {\n          result.user_id = parsed.user_id.trim();\n        }\n        if (typeof parsed.account_id === 'string') {\n          result.account_id = parsed.account_id.trim();\n        }\n        return result;\n      }\n    } catch {\n      // Backward compatibility: older state payloads may contain only user ID\n    }\n\n    // Fallback: treat raw state as user_id\n    result.user_id = String(rawState || '').trim();\n    return result;\n  }\n\n  /**\n   * Show a specific state and hide others\n   */\n  private showState(state: CallbackState): void {\n    const { loadingState, successState, errorState } = this.elements;\n\n    hide(loadingState);\n    hide(successState);\n    hide(errorState);\n\n    switch (state) {\n      case 'loading':\n        show(loadingState);\n        break;\n      case 'success':\n        show(successState);\n        break;\n      case 'error':\n        show(errorState);\n        break;\n    }\n  }\n\n  /**\n   * Send message to opener window\n   */\n  private sendToOpener(data: GoogleOAuthCallbackData): void {\n    if (window.opener && !window.opener.closed) {\n      window.opener.postMessage(data, window.location.origin);\n    }\n  }\n\n  /**\n   * Handle OAuth error\n   */\n  private handleError(\n    error: string,\n    description: string | null,\n    stateData: GoogleOAuthState\n  ): void {\n    this.showState('error');\n\n    const { errorMessage, errorDetail, closeBtn } = this.elements;\n\n    if (errorMessage) {\n      errorMessage.textContent = ERROR_MESSAGES[error] || ERROR_MESSAGES.unknown;\n    }\n\n    if (description && errorDetail) {\n      errorDetail.textContent = description;\n      show(errorDetail);\n    }\n\n    // Send error to opener\n    this.sendToOpener({\n      type: 'google_oauth_callback',\n      error,\n      error_description: description || undefined,\n      account_id: stateData.account_id || undefined,\n    });\n\n    // If not a popup, change button to redirect\n    this.setupCloseButton(stateData);\n  }\n\n  /**\n   * Handle OAuth success\n   */\n  private handleSuccess(code: string, stateData: GoogleOAuthState): void {\n    this.showState('success');\n\n    // Send success to opener\n    this.sendToOpener({\n      type: 'google_oauth_callback',\n      code,\n      account_id: stateData.account_id || undefined,\n    });\n\n    // Auto-close after a short delay\n    setTimeout(() => {\n      window.close();\n    }, 2000);\n\n    // If not a popup, setup redirect\n    this.setupCloseButton(stateData);\n  }\n\n  /**\n   * Setup close button behavior based on whether this is a popup\n   */\n  private setupCloseButton(stateData: GoogleOAuthState): void {\n    const { closeBtn } = this.elements;\n\n    if (!window.opener && closeBtn) {\n      closeBtn.textContent = 'Return to App';\n    }\n  }\n\n  /**\n   * Handle close button click\n   */\n  private handleClose(): void {\n    if (window.opener) {\n      window.close();\n    } else {\n      // Redirect back to integration page\n      const basePath = this.config.basePath || '/admin';\n      const redirectPath =\n        this.config.fallbackRedirectPath || `${basePath}/esign/integrations/google`;\n\n      const redirectURL = new URL(redirectPath, window.location.origin);\n\n      // Get account_id from URL params if available\n      const params = new URLSearchParams(window.location.search);\n      const state = params.get('state');\n      const stateData = this.parseOAuthState(state);\n      const accountId = stateData.account_id || params.get('account_id');\n\n      if (accountId) {\n        redirectURL.searchParams.set('account_id', accountId);\n      }\n\n      window.location.href = redirectURL.toString();\n    }\n  }\n}\n\n/**\n * Initialize Google callback page from config\n */\nexport function initGoogleCallback(config?: GoogleCallbackConfig): GoogleCallbackController {\n  const pageConfig = config || {\n    basePath: '/admin',\n    apiBasePath: '/admin/api',\n  };\n\n  const controller = new GoogleCallbackController(pageConfig);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap Google callback page (auto-init)\n */\nexport function bootstrapGoogleCallback(basePath: string): void {\n  const config: GoogleCallbackConfig = {\n    basePath,\n    apiBasePath: `${basePath}/api`,\n  };\n\n  const controller = new GoogleCallbackController(config);\n  onReady(() => controller.init());\n}\n","/**\n * E-Sign Google Integration Page Controller\n * Handles Google Drive integration status, OAuth flow, and account management\n */\n\nimport type {\n  GoogleIntegrationStatus,\n  GoogleIntegrationPageConfig,\n  GoogleOAuthCallbackData,\n  GoogleOAuthState,\n} from '../types.js';\nimport { qs, show, hide, onReady, announce } from '../utils/dom-helpers.js';\n\ntype IntegrationState = 'loading' | 'disconnected' | 'connected' | 'error';\n\nconst GOOGLE_ACCOUNT_STORAGE_KEY = 'esign.google.account_id';\n\nconst SCOPE_DESCRIPTIONS: Record<string, { label: string; description: string }> = {\n  'https://www.googleapis.com/auth/drive.readonly': {\n    label: 'Drive (Read Only)',\n    description: 'View files in your Google Drive',\n  },\n  openid: {\n    label: 'OpenID',\n    description: 'Verify your Google identity for account linking',\n  },\n  'https://www.googleapis.com/auth/userinfo.email': {\n    label: 'Account Email',\n    description: 'Read your Google account email address',\n  },\n  'https://www.googleapis.com/auth/drive.file': {\n    label: 'Drive (App Files)',\n    description: 'Access files opened with this app',\n  },\n  'drive.readonly': {\n    label: 'Drive (Read Only)',\n    description: 'View files in your Google Drive',\n  },\n  'userinfo.email': {\n    label: 'Account Email',\n    description: 'Read your Google account email address',\n  },\n  'drive.file': {\n    label: 'Drive (App Files)',\n    description: 'Access files opened with this app',\n  },\n};\n\n/**\n * Google integration page controller\n * Manages OAuth flow, connection status, and account switching\n */\nexport class GoogleIntegrationController {\n  private readonly config: GoogleIntegrationPageConfig;\n  private readonly apiBase: string;\n  private currentAccountId: string;\n  private oauthWindow: Window | null = null;\n  private oauthTimeout: ReturnType<typeof setTimeout> | null = null;\n  private pendingOAuthAccountId = '';\n  private messageHandler: ((event: MessageEvent) => void) | null = null;\n\n  private readonly elements: {\n    loadingState: HTMLElement | null;\n    disconnectedState: HTMLElement | null;\n    connectedState: HTMLElement | null;\n    errorState: HTMLElement | null;\n    statusBadge: HTMLElement | null;\n    announcements: HTMLElement | null;\n    accountIdInput: HTMLInputElement | null;\n    connectBtn: HTMLElement | null;\n    disconnectBtn: HTMLElement | null;\n    refreshBtn: HTMLElement | null;\n    retryBtn: HTMLElement | null;\n    reauthBtn: HTMLElement | null;\n    oauthModal: HTMLElement | null;\n    oauthCancelBtn: HTMLElement | null;\n    disconnectModal: HTMLElement | null;\n    disconnectCancelBtn: HTMLElement | null;\n    disconnectConfirmBtn: HTMLElement | null;\n    connectedEmail: HTMLElement | null;\n    connectedAccountId: HTMLElement | null;\n    scopesList: HTMLElement | null;\n    expiryInfo: HTMLElement | null;\n    reauthWarning: HTMLElement | null;\n    reauthReason: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    degradedWarning: HTMLElement | null;\n    degradedReason: HTMLElement | null;\n    importDriveLink: HTMLAnchorElement | null;\n    integrationSettingsLink: HTMLAnchorElement | null;\n  };\n\n  constructor(config: GoogleIntegrationPageConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n    this.currentAccountId = this.resolveInitialAccountId();\n\n    this.elements = {\n      loadingState: qs('#loading-state'),\n      disconnectedState: qs('#disconnected-state'),\n      connectedState: qs('#connected-state'),\n      errorState: qs('#error-state'),\n      statusBadge: qs('#status-badge'),\n      announcements: qs('#integration-announcements'),\n      accountIdInput: qs<HTMLInputElement>('#account-id-input'),\n      connectBtn: qs('#connect-btn'),\n      disconnectBtn: qs('#disconnect-btn'),\n      refreshBtn: qs('#refresh-status-btn'),\n      retryBtn: qs('#retry-btn'),\n      reauthBtn: qs('#reauth-btn'),\n      oauthModal: qs('#oauth-modal'),\n      oauthCancelBtn: qs('#oauth-cancel-btn'),\n      disconnectModal: qs('#disconnect-modal'),\n      disconnectCancelBtn: qs('#disconnect-cancel-btn'),\n      disconnectConfirmBtn: qs('#disconnect-confirm-btn'),\n      connectedEmail: qs('#connected-email'),\n      connectedAccountId: qs('#connected-account-id'),\n      scopesList: qs('#scopes-list'),\n      expiryInfo: qs('#expiry-info'),\n      reauthWarning: qs('#reauth-warning'),\n      reauthReason: qs('#reauth-reason'),\n      errorMessage: qs('#error-message'),\n      degradedWarning: qs('#degraded-warning'),\n      degradedReason: qs('#degraded-reason'),\n      importDriveLink: qs<HTMLAnchorElement>('#import-drive-link'),\n      integrationSettingsLink: qs<HTMLAnchorElement>('#integration-settings-link'),\n    };\n  }\n\n  /**\n   * Initialize the integration page\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    this.updateAccountScopeUI();\n    await this.checkStatus();\n  }\n\n  /**\n   * Setup all event listeners\n   */\n  private setupEventListeners(): void {\n    const {\n      connectBtn,\n      disconnectBtn,\n      refreshBtn,\n      retryBtn,\n      reauthBtn,\n      oauthCancelBtn,\n      disconnectCancelBtn,\n      disconnectConfirmBtn,\n      accountIdInput,\n      oauthModal,\n      disconnectModal,\n    } = this.elements;\n\n    // Connect button\n    if (connectBtn) {\n      connectBtn.addEventListener('click', () => this.startOAuthFlow());\n    }\n\n    // Re-auth button\n    if (reauthBtn) {\n      reauthBtn.addEventListener('click', () => this.startOAuthFlow());\n    }\n\n    // Disconnect button\n    if (disconnectBtn) {\n      disconnectBtn.addEventListener('click', () => {\n        if (disconnectModal) {\n          show(disconnectModal);\n        }\n      });\n    }\n\n    // Disconnect modal buttons\n    if (disconnectCancelBtn) {\n      disconnectCancelBtn.addEventListener('click', () => {\n        if (disconnectModal) {\n          hide(disconnectModal);\n        }\n      });\n    }\n\n    if (disconnectConfirmBtn) {\n      disconnectConfirmBtn.addEventListener('click', () => this.disconnect());\n    }\n\n    // OAuth modal cancel\n    if (oauthCancelBtn) {\n      oauthCancelBtn.addEventListener('click', () => this.cancelOAuthFlow());\n    }\n\n    // Refresh and retry buttons\n    if (refreshBtn) {\n      refreshBtn.addEventListener('click', () => this.checkStatus());\n    }\n\n    if (retryBtn) {\n      retryBtn.addEventListener('click', () => this.checkStatus());\n    }\n\n    // Account ID input\n    if (accountIdInput) {\n      accountIdInput.addEventListener('change', () => {\n        this.setCurrentAccountId(accountIdInput.value, true);\n      });\n\n      accountIdInput.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter') {\n          event.preventDefault();\n          this.setCurrentAccountId(accountIdInput.value, true);\n        }\n      });\n    }\n\n    // Close modals on escape\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (oauthModal && !oauthModal.classList.contains('hidden')) {\n          this.cancelOAuthFlow();\n        }\n        if (disconnectModal && !disconnectModal.classList.contains('hidden')) {\n          hide(disconnectModal);\n        }\n      }\n    });\n\n    // Close modals on backdrop click\n    [oauthModal, disconnectModal].forEach((modal) => {\n      if (modal) {\n        modal.addEventListener('click', (e) => {\n          const target = e.target as HTMLElement;\n          if (target === modal || target.getAttribute('aria-hidden') === 'true') {\n            hide(modal);\n            if (modal === oauthModal) {\n              this.cancelOAuthFlow();\n            }\n          }\n        });\n      }\n    });\n  }\n\n  /**\n   * Resolve initial account ID from various sources\n   */\n  private resolveInitialAccountId(): string {\n    // 1. Check URL query params\n    const params = new URLSearchParams(window.location.search);\n    const fromQuery = this.normalizeAccountId(params.get('account_id'));\n    if (fromQuery) {\n      return fromQuery;\n    }\n\n    // 2. Check template config\n    const fromTemplate = this.normalizeAccountId(this.config.googleAccountId);\n    if (fromTemplate) {\n      return fromTemplate;\n    }\n\n    // 3. Check localStorage\n    try {\n      return this.normalizeAccountId(\n        window.localStorage.getItem(GOOGLE_ACCOUNT_STORAGE_KEY)\n      );\n    } catch {\n      return '';\n    }\n  }\n\n  /**\n   * Normalize account ID value\n   */\n  private normalizeAccountId(value: string | null | undefined): string {\n    return (value || '').trim();\n  }\n\n  /**\n   * Set current account ID and optionally refresh status\n   */\n  private setCurrentAccountId(value: string, refreshStatus = false): void {\n    const normalized = this.normalizeAccountId(value);\n    if (normalized === this.currentAccountId) {\n      this.updateAccountScopeUI();\n      return;\n    }\n\n    this.currentAccountId = normalized;\n    this.updateAccountScopeUI();\n\n    if (refreshStatus) {\n      this.checkStatus();\n    }\n  }\n\n  /**\n   * Update UI elements related to account scope\n   */\n  private updateAccountScopeUI(): void {\n    const { accountIdInput, connectedAccountId, importDriveLink, integrationSettingsLink } =\n      this.elements;\n\n    // Update input\n    if (accountIdInput) {\n      accountIdInput.value = this.currentAccountId;\n    }\n\n    // Update connected account display\n    if (connectedAccountId) {\n      connectedAccountId.textContent = this.currentAccountId\n        ? `Account ID: ${this.currentAccountId}`\n        : 'Account ID: default';\n    }\n\n    // Persist to storage\n    this.persistAccountId();\n\n    // Sync URL\n    this.syncAccountIdInURL();\n\n    // Update links\n    this.updateScopedLinks([importDriveLink, integrationSettingsLink]);\n  }\n\n  /**\n   * Persist account ID to localStorage\n   */\n  private persistAccountId(): void {\n    try {\n      if (this.currentAccountId) {\n        window.localStorage.setItem(GOOGLE_ACCOUNT_STORAGE_KEY, this.currentAccountId);\n      } else {\n        window.localStorage.removeItem(GOOGLE_ACCOUNT_STORAGE_KEY);\n      }\n    } catch {\n      // Ignore storage failures\n    }\n  }\n\n  /**\n   * Sync account ID to URL without navigation\n   */\n  private syncAccountIdInURL(): void {\n    const url = new URL(window.location.href);\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      url.searchParams.delete('account_id');\n    }\n    window.history.replaceState({}, '', url.toString());\n  }\n\n  /**\n   * Update scoped links with current account ID\n   */\n  private updateScopedLinks(links: (HTMLAnchorElement | null)[]): void {\n    links.forEach((link) => {\n      if (!link) return;\n      const baseHref = link.dataset.baseHref || link.getAttribute('href');\n      if (!baseHref) return;\n      link.setAttribute('href', this.applyAccountIdToPath(baseHref));\n    });\n  }\n\n  /**\n   * Apply account ID to a path/URL\n   */\n  private applyAccountIdToPath(pathOrURL: string): string {\n    const parsed = new URL(pathOrURL, window.location.origin);\n    if (this.currentAccountId) {\n      parsed.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      parsed.searchParams.delete('account_id');\n    }\n    return `${parsed.pathname}${parsed.search}${parsed.hash}`;\n  }\n\n  /**\n   * Build API URL with user/account scope\n   */\n  private buildScopedAPIURL(path: string, accountId = this.currentAccountId): string {\n    const url = new URL(`${this.apiBase}${path}`, window.location.origin);\n    url.searchParams.set('user_id', this.config.userId || '');\n    if (accountId) {\n      url.searchParams.set('account_id', accountId);\n    }\n    return url.toString();\n  }\n\n  /**\n   * Announce message to screen readers\n   */\n  private announce(message: string): void {\n    const { announcements } = this.elements;\n    if (announcements) {\n      announcements.textContent = message;\n    }\n    announce(message);\n  }\n\n  /**\n   * Show a specific state and hide others\n   */\n  private showState(state: IntegrationState): void {\n    const { loadingState, disconnectedState, connectedState, errorState } = this.elements;\n\n    hide(loadingState);\n    hide(disconnectedState);\n    hide(connectedState);\n    hide(errorState);\n\n    switch (state) {\n      case 'loading':\n        show(loadingState);\n        break;\n      case 'disconnected':\n        show(disconnectedState);\n        break;\n      case 'connected':\n        show(connectedState);\n        break;\n      case 'error':\n        show(errorState);\n        break;\n    }\n  }\n\n  /**\n   * Update status badge\n   */\n  private updateStatusBadge(\n    connected: boolean,\n    expiring = false,\n    degraded = false\n  ): void {\n    const { statusBadge } = this.elements;\n    if (!statusBadge) return;\n\n    if (degraded) {\n      statusBadge.innerHTML = `\n        <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-700\">\n          <span class=\"w-2 h-2 rounded-full bg-amber-500\" aria-hidden=\"true\"></span>\n          Degraded\n        </span>\n      `;\n      return;\n    }\n\n    if (connected) {\n      if (expiring) {\n        statusBadge.innerHTML = `\n          <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-700\">\n            <span class=\"w-2 h-2 rounded-full bg-amber-500\" aria-hidden=\"true\"></span>\n            Expiring Soon\n          </span>\n        `;\n      } else {\n        statusBadge.innerHTML = `\n          <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700\">\n            <span class=\"w-2 h-2 rounded-full bg-green-500\" aria-hidden=\"true\"></span>\n            Connected\n          </span>\n        `;\n      }\n    } else {\n      statusBadge.innerHTML = `\n        <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600\">\n          <span class=\"w-2 h-2 rounded-full bg-gray-400\" aria-hidden=\"true\"></span>\n          Not Connected\n        </span>\n      `;\n    }\n  }\n\n  /**\n   * Check integration status from API\n   */\n  async checkStatus(): Promise<void> {\n    this.showState('loading');\n\n    try {\n      const response = await fetch(\n        this.buildScopedAPIURL('/esign/integrations/google/status'),\n        {\n          credentials: 'same-origin',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          // Not connected\n          this.showState('disconnected');\n          this.updateStatusBadge(false);\n          this.announce('Google Drive is not connected');\n          return;\n        }\n\n        let message = `Failed to check status: ${response.status}`;\n        try {\n          const errorData = await response.json();\n          if (errorData?.error?.message) {\n            message = errorData.error.message;\n          }\n        } catch {\n          // Ignore parse errors\n        }\n        throw new Error(message);\n      }\n\n      const data = await response.json();\n      const integration = this.normalizeIntegrationPayload(data.integration || {});\n\n      // Update account ID if returned from API\n      if (!this.currentAccountId && integration.account_id) {\n        this.currentAccountId = integration.account_id;\n        this.updateAccountScopeUI();\n      }\n\n      // Render degraded state\n      const isDegraded = integration.degraded === true;\n      this.renderDegradedState(isDegraded, integration.degraded_reason);\n\n      if (integration.connected) {\n        this.renderConnectedState(integration);\n        this.showState('connected');\n        this.updateStatusBadge(true, integration.needs_reauthorization, isDegraded);\n        this.announce(\n          isDegraded\n            ? 'Google Drive connected with degraded provider health'\n            : 'Google Drive is connected'\n        );\n      } else {\n        this.showState('disconnected');\n        this.updateStatusBadge(false, false, isDegraded);\n        this.announce(\n          isDegraded\n            ? 'Google Drive integration is degraded'\n            : 'Google Drive is not connected'\n        );\n      }\n    } catch (error) {\n      console.error('Error checking status:', error);\n      const { errorMessage } = this.elements;\n      if (errorMessage) {\n        errorMessage.textContent =\n          error instanceof Error\n            ? error.message\n            : 'An error occurred while checking the integration status.';\n      }\n      this.showState('error');\n      this.renderDegradedState(false, '');\n      this.updateStatusBadge(false);\n      this.announce('Error checking Google Drive status');\n    }\n  }\n\n  /**\n   * Normalize integration payload from API (handles both camelCase and snake_case)\n   */\n  private normalizeIntegrationPayload(\n    raw: Record<string, unknown>\n  ): GoogleIntegrationStatus {\n    const firstDefined = <T>(keys: string[], fallback: T): T => {\n      for (const key of keys) {\n        if (Object.prototype.hasOwnProperty.call(raw, key) && raw[key] !== undefined && raw[key] !== null) {\n          return raw[key] as T;\n        }\n      }\n      return fallback;\n    };\n\n    const expiresAt = firstDefined<string>(['expires_at', 'ExpiresAt'], '');\n    const scopes = firstDefined<string[]>(['scopes', 'Scopes'], []);\n    const accountId = this.normalizeAccountId(\n      firstDefined<string>(['account_id', 'AccountID'], '')\n    );\n    const connected = firstDefined<boolean>(['connected', 'Connected'], false);\n    const degraded = firstDefined<boolean>(['degraded', 'Degraded'], false);\n    const degradedReason = firstDefined<string>(['degraded_reason', 'DegradedReason'], '');\n    const email = firstDefined<string>(\n      ['email', 'user_email', 'account_email', 'AccountEmail'],\n      ''\n    );\n    const canAutoRefresh = firstDefined<boolean>(\n      ['can_auto_refresh', 'CanAutoRefresh'],\n      false\n    );\n    const explicitNeedsReauth = firstDefined<boolean | undefined>(\n      ['needs_reauthorization', 'NeedsReauthorization', 'NeedsReauth'],\n      undefined\n    );\n\n    let isExpired = firstDefined<boolean | undefined>(['is_expired', 'IsExpired'], undefined);\n    let isExpiringSoon = firstDefined<boolean | undefined>(\n      ['is_expiring_soon', 'IsExpiringSoon'],\n      undefined\n    );\n\n    // Compute expiry if not provided\n    if (typeof isExpired !== 'boolean' || typeof isExpiringSoon !== 'boolean') {\n      if (expiresAt) {\n        const expiryDate = new Date(expiresAt);\n        if (!Number.isNaN(expiryDate.getTime())) {\n          const deltaMs = expiryDate.getTime() - Date.now();\n          const expiringSoonMs = 5 * 60 * 1000;\n          isExpired = deltaMs <= 0;\n          isExpiringSoon = deltaMs > 0 && deltaMs <= expiringSoonMs;\n        }\n      }\n    }\n\n    const needsReauthorization =\n      typeof explicitNeedsReauth === 'boolean'\n        ? explicitNeedsReauth\n        : (isExpired === true || isExpiringSoon === true) && !canAutoRefresh;\n\n    return {\n      connected,\n      account_id: accountId,\n      email,\n      scopes: Array.isArray(scopes) ? scopes : [],\n      expires_at: expiresAt,\n      is_expired: isExpired === true,\n      is_expiring_soon: isExpiringSoon === true,\n      can_auto_refresh: canAutoRefresh,\n      needs_reauthorization: needsReauthorization,\n      degraded,\n      degraded_reason: degradedReason,\n    };\n  }\n\n  /**\n   * Render connected state details\n   */\n  private renderConnectedState(integration: GoogleIntegrationStatus): void {\n    const { connectedEmail, connectedAccountId, scopesList, expiryInfo, reauthWarning, reauthReason } =\n      this.elements;\n\n    // Email\n    if (connectedEmail) {\n      connectedEmail.textContent = integration.email || 'Connected';\n    }\n\n    // Account ID\n    if (connectedAccountId) {\n      connectedAccountId.textContent =\n        integration.account_id || this.currentAccountId\n          ? `Account ID: ${integration.account_id || this.currentAccountId}`\n          : 'Account ID: default';\n    }\n\n    // Scopes\n    this.renderScopes(integration.scopes || []);\n\n    // Expiry\n    this.renderExpiry(\n      integration.expires_at,\n      integration.is_expired,\n      integration.is_expiring_soon,\n      integration.can_auto_refresh,\n      integration.needs_reauthorization\n    );\n  }\n\n  /**\n   * Render scopes list\n   */\n  private renderScopes(scopes: string[]): void {\n    const { scopesList } = this.elements;\n    if (!scopesList) return;\n\n    if (!scopes || scopes.length === 0) {\n      scopesList.innerHTML =\n        '<li class=\"text-sm text-gray-500\">No specific scopes granted</li>';\n      return;\n    }\n\n    scopesList.innerHTML = scopes\n      .map((scope) => {\n        const info = SCOPE_DESCRIPTIONS[scope] || { label: scope, description: '' };\n        return `\n        <li class=\"flex items-start gap-2\">\n          <svg class=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n          </svg>\n          <div>\n            <span class=\"text-sm font-medium text-gray-700\">${this.escapeHtml(info.label)}</span>\n            ${info.description ? `<p class=\"text-xs text-gray-500\">${this.escapeHtml(info.description)}</p>` : ''}\n          </div>\n        </li>\n      `;\n      })\n      .join('');\n  }\n\n  /**\n   * Render token expiry information\n   */\n  private renderExpiry(\n    expiryTime: string | undefined,\n    isExpired: boolean | undefined,\n    isExpiringSoon: boolean | undefined,\n    canAutoRefresh: boolean | undefined,\n    needsReauthorization: boolean | undefined\n  ): void {\n    const { expiryInfo, reauthWarning, reauthReason } = this.elements;\n    if (!expiryInfo) return;\n\n    expiryInfo.classList.remove('text-red-600', 'text-amber-600');\n    expiryInfo.classList.add('text-gray-500');\n\n    if (!expiryTime) {\n      expiryInfo.textContent = 'Access token status unknown';\n      if (reauthWarning) hide(reauthWarning);\n      return;\n    }\n\n    const expiryDate = new Date(expiryTime);\n    const now = new Date();\n    const minutesLeft = Math.max(\n      1,\n      Math.round((expiryDate.getTime() - now.getTime()) / (1000 * 60))\n    );\n\n    if (isExpired) {\n      if (canAutoRefresh) {\n        expiryInfo.textContent =\n          'Access token expired, but refresh is available and will be applied automatically.';\n        expiryInfo.classList.remove('text-gray-500');\n        expiryInfo.classList.add('text-amber-600');\n        if (reauthWarning) hide(reauthWarning);\n      } else {\n        expiryInfo.textContent = 'Access token has expired. Please re-authorize.';\n        expiryInfo.classList.remove('text-gray-500');\n        expiryInfo.classList.add('text-red-600');\n        if (reauthWarning) show(reauthWarning);\n        if (reauthReason) {\n          reauthReason.textContent =\n            'Your access token has expired and cannot be refreshed automatically. Re-authorize to continue using Google Drive import.';\n        }\n      }\n    } else if (isExpiringSoon) {\n      expiryInfo.classList.remove('text-gray-500');\n      expiryInfo.classList.add('text-amber-600');\n      if (canAutoRefresh) {\n        expiryInfo.textContent = `Token expires in approximately ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''}. Refresh is available automatically.`;\n        if (reauthWarning) hide(reauthWarning);\n      } else {\n        expiryInfo.textContent = `Token expires in approximately ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''}`;\n        if (reauthWarning) show(reauthWarning);\n        if (reauthReason) {\n          reauthReason.textContent = `Your access token will expire in ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''} and cannot be refreshed automatically. Re-authorize now to avoid interruption.`;\n        }\n      }\n    } else {\n      expiryInfo.textContent = `Token valid until ${expiryDate.toLocaleDateString()} ${expiryDate.toLocaleTimeString()}`;\n      if (reauthWarning) hide(reauthWarning);\n    }\n\n    if (!needsReauthorization && reauthWarning) {\n      hide(reauthWarning);\n    }\n  }\n\n  /**\n   * Render degraded provider state\n   */\n  private renderDegradedState(isDegraded: boolean, reason?: string): void {\n    const { degradedWarning, degradedReason } = this.elements;\n    if (!degradedWarning) return;\n\n    if (isDegraded) {\n      show(degradedWarning);\n      if (degradedReason) {\n        degradedReason.textContent =\n          reason ||\n          'Google API health checks are failing. Import actions may be unavailable until provider recovery.';\n      }\n    } else {\n      hide(degradedWarning);\n    }\n  }\n\n  /**\n   * Escape HTML for safe rendering\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  // OAuth Flow Methods\n\n  /**\n   * Start OAuth flow\n   */\n  async startOAuthFlow(): Promise<void> {\n    const { oauthModal, errorMessage } = this.elements;\n\n    // Show modal\n    if (oauthModal) {\n      show(oauthModal);\n    }\n\n    const redirectUri = this.resolveOAuthRedirectURI();\n    this.pendingOAuthAccountId = this.currentAccountId;\n    const authUrl = this.buildGoogleOAuthUrl(redirectUri, this.pendingOAuthAccountId);\n\n    if (!authUrl) {\n      if (oauthModal) hide(oauthModal);\n      if (errorMessage) {\n        errorMessage.textContent = 'Google OAuth is not configured: missing client ID.';\n      }\n      this.showState('error');\n      this.announce('Google OAuth is not configured');\n      return;\n    }\n\n    // Open popup\n    const width = 500;\n    const height = 600;\n    const left = (window.screen.width - width) / 2;\n    const top = (window.screen.height - height) / 2;\n\n    this.oauthWindow = window.open(\n      authUrl,\n      'google_oauth',\n      `width=${width},height=${height},left=${left},top=${top},popup=yes`\n    );\n\n    if (!this.oauthWindow) {\n      if (oauthModal) hide(oauthModal);\n      this.showToast('Popup blocked. Allow popups for this site and try again.', 'error');\n      this.announce('Popup blocked');\n      return;\n    }\n\n    // Listen for callback message\n    this.messageHandler = (event: MessageEvent) => this.handleOAuthCallback(event);\n    window.addEventListener('message', this.messageHandler);\n\n    // Timeout\n    this.oauthTimeout = setTimeout(() => {\n      this.cleanupOAuthFlow();\n      if (oauthModal) hide(oauthModal);\n      this.showToast('Google authorization timed out. Please try again.', 'error');\n      this.announce('Authorization timed out');\n    }, 120000);\n  }\n\n  /**\n   * Resolve OAuth redirect URI\n   */\n  private resolveOAuthRedirectURI(): string {\n    if (this.config.googleRedirectUri) {\n      return this.config.googleRedirectUri;\n    }\n    return `${window.location.origin}${this.config.basePath}/esign/integrations/google/callback`;\n  }\n\n  /**\n   * Build OAuth state parameter\n   */\n  private buildOAuthState(accountId: string): string {\n    const state: GoogleOAuthState = {\n      user_id: this.config.userId || '',\n      account_id: accountId || '',\n    };\n    return JSON.stringify(state);\n  }\n\n  /**\n   * Build Google OAuth URL\n   */\n  private buildGoogleOAuthUrl(redirectUri: string, accountId: string): string | null {\n    const clientId = this.config.googleClientId;\n    if (!clientId) {\n      return null;\n    }\n\n    const scopes = [\n      'https://www.googleapis.com/auth/drive.readonly',\n      'openid',\n      'https://www.googleapis.com/auth/userinfo.email',\n    ].join(' ');\n\n    const params = new URLSearchParams({\n      client_id: clientId,\n      redirect_uri: redirectUri,\n      response_type: 'code',\n      scope: scopes,\n      access_type: 'offline',\n      prompt: 'consent',\n      state: this.buildOAuthState(accountId),\n    });\n\n    return `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;\n  }\n\n  /**\n   * Handle OAuth callback message\n   */\n  private async handleOAuthCallback(event: MessageEvent): Promise<void> {\n    // Verify origin\n    if (event.origin !== window.location.origin) return;\n\n    const data = event.data as GoogleOAuthCallbackData;\n    if (data.type !== 'google_oauth_callback') return;\n\n    const { oauthModal } = this.elements;\n\n    this.cleanupOAuthFlow();\n    if (oauthModal) hide(oauthModal);\n    this.closeOAuthWindow();\n\n    if (data.error) {\n      this.showToast(`OAuth failed: ${data.error}`, 'error');\n      this.announce(`OAuth failed: ${data.error}`);\n      return;\n    }\n\n    if (data.code) {\n      try {\n        const redirectUri = this.resolveOAuthRedirectURI();\n        const callbackAccountId = this.normalizeAccountId(data.account_id);\n        const accountIdForConnect =\n          callbackAccountId || this.pendingOAuthAccountId || this.currentAccountId;\n\n        if (callbackAccountId && callbackAccountId !== this.currentAccountId) {\n          this.currentAccountId = callbackAccountId;\n          this.updateAccountScopeUI();\n        }\n\n        const response = await fetch(\n          this.buildScopedAPIURL('/esign/integrations/google/connect', accountIdForConnect),\n          {\n            method: 'POST',\n            credentials: 'same-origin',\n            headers: {\n              'Content-Type': 'application/json',\n              Accept: 'application/json',\n            },\n            body: JSON.stringify({\n              auth_code: data.code,\n              account_id: accountIdForConnect || undefined,\n              redirect_uri: redirectUri,\n            }),\n          }\n        );\n\n        if (!response.ok) {\n          const errorData = await response.json();\n          throw new Error(errorData.error?.message || 'Failed to connect');\n        }\n\n        this.showToast('Google Drive connected successfully', 'success');\n        this.announce('Google Drive connected successfully');\n        await this.checkStatus();\n      } catch (error) {\n        console.error('Connect error:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        this.showToast(`Failed to connect: ${message}`, 'error');\n        this.announce(`Failed to connect: ${message}`);\n      }\n    }\n  }\n\n  /**\n   * Cancel OAuth flow\n   */\n  private cancelOAuthFlow(): void {\n    const { oauthModal } = this.elements;\n    if (oauthModal) hide(oauthModal);\n    this.closeOAuthWindow();\n    this.cleanupOAuthFlow();\n  }\n\n  /**\n   * Cleanup OAuth flow resources\n   */\n  private cleanupOAuthFlow(): void {\n    if (this.oauthTimeout) {\n      clearTimeout(this.oauthTimeout);\n      this.oauthTimeout = null;\n    }\n\n    if (this.messageHandler) {\n      window.removeEventListener('message', this.messageHandler);\n      this.messageHandler = null;\n    }\n  }\n\n  /**\n   * Close OAuth popup window\n   */\n  private closeOAuthWindow(): void {\n    if (!this.oauthWindow) return;\n    try {\n      this.oauthWindow.close();\n    } catch {\n      // Ignore errors closing window\n    }\n    this.oauthWindow = null;\n  }\n\n  /**\n   * Disconnect Google account\n   */\n  async disconnect(): Promise<void> {\n    const { disconnectModal } = this.elements;\n    if (disconnectModal) hide(disconnectModal);\n\n    try {\n      const response = await fetch(\n        this.buildScopedAPIURL('/esign/integrations/google/disconnect'),\n        {\n          method: 'POST',\n          credentials: 'same-origin',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error?.message || 'Failed to disconnect');\n      }\n\n      this.showToast('Google Drive disconnected', 'success');\n      this.announce('Google Drive disconnected');\n      await this.checkStatus();\n    } catch (error) {\n      console.error('Disconnect error:', error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed to disconnect: ${message}`, 'error');\n      this.announce(`Failed to disconnect: ${message}`);\n    }\n  }\n\n  /**\n   * Show toast notification\n   */\n  private showToast(message: string, type: 'success' | 'error'): void {\n    // Use global toast manager if available\n    const win = window as unknown as Record<string, unknown>;\n    const toastManager = win.toastManager as\n      | { success: (msg: string) => void; error: (msg: string) => void }\n      | undefined;\n\n    if (toastManager) {\n      if (type === 'success') {\n        toastManager.success(message);\n      } else {\n        toastManager.error(message);\n      }\n    }\n  }\n}\n\n/**\n * Initialize Google integration page from config\n */\nexport function initGoogleIntegration(\n  config: GoogleIntegrationPageConfig\n): GoogleIntegrationController {\n  const controller = new GoogleIntegrationController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap Google integration page from template context\n */\nexport function bootstrapGoogleIntegration(config: {\n  basePath: string;\n  apiBasePath?: string;\n  userId: string;\n  googleAccountId?: string;\n  googleRedirectUri?: string;\n  googleClientId?: string;\n  googleEnabled?: boolean;\n}): void {\n  const pageConfig: GoogleIntegrationPageConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n    userId: config.userId,\n    googleAccountId: config.googleAccountId,\n    googleRedirectUri: config.googleRedirectUri,\n    googleClientId: config.googleClientId,\n    googleEnabled: config.googleEnabled !== false,\n  };\n\n  const controller = new GoogleIntegrationController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignGoogleIntegrationController =\n      controller;\n  }\n}\n","/**\n * E-Sign Google Drive Picker Page Controller\n * Handles Google Drive file browsing, selection, and import\n */\n\nimport type { ESignPageConfig, GoogleDriveFile } from '../types.js';\nimport { qs, qsa, show, hide, onReady, announce, on, setLoading } from '../utils/dom-helpers.js';\nimport { debounce } from '../utils/async-helpers.js';\nimport { formatDateTime } from '../utils/formatters.js';\n\nexport interface GoogleDrivePickerConfig extends ESignPageConfig {\n  userId: string;\n  googleAccountId?: string;\n  googleConnected: boolean;\n  pickerRoutes?: {\n    integrations?: string;\n    agreements?: string;\n    documents?: string;\n  };\n}\n\ninterface FolderPathItem {\n  id: string;\n  name: string;\n}\n\ninterface NormalizedDriveFile {\n  id: string;\n  name: string;\n  mimeType: string;\n  modifiedTime: string;\n  webViewLink: string;\n  parents: string[];\n  owners: Array<{ emailAddress?: string }>;\n  size?: number;\n  iconLink?: string;\n  thumbnailLink?: string;\n}\n\nconst GOOGLE_ACCOUNT_STORAGE_KEY = 'esign.google.account_id';\n\nconst MIME_TYPE_ICONS: Record<string, string> = {\n  'application/vnd.google-apps.folder': 'folder',\n  'application/vnd.google-apps.document': 'doc',\n  'application/vnd.google-apps.spreadsheet': 'sheet',\n  'application/vnd.google-apps.presentation': 'slide',\n  'application/pdf': 'pdf',\n  default: 'file',\n};\n\nconst IMPORTABLE_TYPES = [\n  'application/vnd.google-apps.document',\n  'application/pdf',\n];\n\n/**\n * Google Drive Picker page controller\n * Manages file browsing, search, selection, and import\n */\nexport class GoogleDrivePickerController {\n  private readonly config: GoogleDrivePickerConfig;\n  private readonly apiBase: string;\n  private currentAccountId: string;\n\n  // State\n  private currentFiles: NormalizedDriveFile[] = [];\n  private nextPageToken: string | null = null;\n  private currentFolderPath: FolderPathItem[] = [{ id: 'root', name: 'My Drive' }];\n  private selectedFile: NormalizedDriveFile | null = null;\n  private searchQuery = '';\n  private isListView = true;\n  private isLoading = false;\n\n  // Elements\n  private readonly elements: {\n    searchInput: HTMLInputElement | null;\n    clearSearchBtn: HTMLElement | null;\n    fileList: HTMLElement | null;\n    loadingState: HTMLElement | null;\n    breadcrumb: HTMLElement | null;\n    listTitle: HTMLElement | null;\n    resultCount: HTMLElement | null;\n    pagination: HTMLElement | null;\n    loadMoreBtn: HTMLElement | null;\n    refreshBtn: HTMLElement | null;\n    announcements: HTMLElement | null;\n    accountScopeHelp: HTMLElement | null;\n    connectGoogleLink: HTMLAnchorElement | null;\n    // Selection panel\n    noSelection: HTMLElement | null;\n    filePreview: HTMLElement | null;\n    previewIcon: HTMLElement | null;\n    previewTitle: HTMLElement | null;\n    previewType: HTMLElement | null;\n    previewFileId: HTMLElement | null;\n    previewOwner: HTMLElement | null;\n    previewLocation: HTMLElement | null;\n    previewModified: HTMLElement | null;\n    importBtn: HTMLElement | null;\n    openInGoogleBtn: HTMLAnchorElement | null;\n    clearSelectionBtn: HTMLElement | null;\n    // Import modal\n    importModal: HTMLElement | null;\n    importForm: HTMLFormElement | null;\n    importGoogleFileId: HTMLInputElement | null;\n    importDocumentTitle: HTMLInputElement | null;\n    importAgreementTitle: HTMLInputElement | null;\n    importCancelBtn: HTMLElement | null;\n    importConfirmBtn: HTMLElement | null;\n    importSpinner: HTMLElement | null;\n    importBtnText: HTMLElement | null;\n    // View toggle\n    viewListBtn: HTMLElement | null;\n    viewGridBtn: HTMLElement | null;\n  };\n\n  constructor(config: GoogleDrivePickerConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n    this.currentAccountId = this.resolveInitialAccountId();\n\n    this.elements = {\n      searchInput: qs<HTMLInputElement>('#drive-search'),\n      clearSearchBtn: qs('#clear-search-btn'),\n      fileList: qs('#file-list'),\n      loadingState: qs('#loading-state'),\n      breadcrumb: qs('#breadcrumb'),\n      listTitle: qs('#list-title'),\n      resultCount: qs('#result-count'),\n      pagination: qs('#pagination'),\n      loadMoreBtn: qs('#load-more-btn'),\n      refreshBtn: qs('#refresh-btn'),\n      announcements: qs('#drive-announcements'),\n      accountScopeHelp: qs('#account-scope-help'),\n      connectGoogleLink: qs<HTMLAnchorElement>('#connect-google-link'),\n      noSelection: qs('#no-selection'),\n      filePreview: qs('#file-preview'),\n      previewIcon: qs('#preview-icon'),\n      previewTitle: qs('#preview-title'),\n      previewType: qs('#preview-type'),\n      previewFileId: qs('#preview-file-id'),\n      previewOwner: qs('#preview-owner'),\n      previewLocation: qs('#preview-location'),\n      previewModified: qs('#preview-modified'),\n      importBtn: qs('#import-btn'),\n      openInGoogleBtn: qs<HTMLAnchorElement>('#open-in-google-btn'),\n      clearSelectionBtn: qs('#clear-selection-btn'),\n      importModal: qs('#import-modal'),\n      importForm: qs<HTMLFormElement>('#import-form'),\n      importGoogleFileId: qs<HTMLInputElement>('#import-google-file-id'),\n      importDocumentTitle: qs<HTMLInputElement>('#import-document-title'),\n      importAgreementTitle: qs<HTMLInputElement>('#import-agreement-title'),\n      importCancelBtn: qs('#import-cancel-btn'),\n      importConfirmBtn: qs('#import-confirm-btn'),\n      importSpinner: qs('#import-spinner'),\n      importBtnText: qs('#import-btn-text'),\n      viewListBtn: qs('#view-list-btn'),\n      viewGridBtn: qs('#view-grid-btn'),\n    };\n  }\n\n  /**\n   * Initialize the drive picker page\n   */\n  async init(): Promise<void> {\n    if (!this.config.googleConnected) {\n      return; // Nothing to initialize if not connected\n    }\n\n    this.setupEventListeners();\n    this.updateScopedUI();\n    await this.loadFiles();\n  }\n\n  /**\n   * Setup all event listeners\n   */\n  private setupEventListeners(): void {\n    const {\n      searchInput,\n      clearSearchBtn,\n      refreshBtn,\n      loadMoreBtn,\n      importBtn,\n      clearSelectionBtn,\n      importCancelBtn,\n      importConfirmBtn,\n      importForm,\n      importModal,\n      viewListBtn,\n      viewGridBtn,\n    } = this.elements;\n\n    // Search input with debounce\n    if (searchInput) {\n      const debouncedSearch = debounce(() => this.handleSearch(), 300);\n      searchInput.addEventListener('input', debouncedSearch);\n      searchInput.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          this.handleSearch();\n        }\n      });\n    }\n\n    // Clear search\n    if (clearSearchBtn) {\n      clearSearchBtn.addEventListener('click', () => this.clearSearch());\n    }\n\n    // Refresh\n    if (refreshBtn) {\n      refreshBtn.addEventListener('click', () => this.refresh());\n    }\n\n    // Load more\n    if (loadMoreBtn) {\n      loadMoreBtn.addEventListener('click', () => this.loadMore());\n    }\n\n    // Import button\n    if (importBtn) {\n      importBtn.addEventListener('click', () => this.showImportModal());\n    }\n\n    // Clear selection\n    if (clearSelectionBtn) {\n      clearSelectionBtn.addEventListener('click', () => this.clearSelection());\n    }\n\n    // Import modal\n    if (importCancelBtn) {\n      importCancelBtn.addEventListener('click', () => this.hideImportModal());\n    }\n\n    if (importConfirmBtn && importForm) {\n      importForm.addEventListener('submit', (e) => {\n        e.preventDefault();\n        this.handleImport();\n      });\n    }\n\n    // Close modal on backdrop click\n    if (importModal) {\n      importModal.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        if (target === importModal || target.getAttribute('aria-hidden') === 'true') {\n          this.hideImportModal();\n        }\n      });\n    }\n\n    // View toggle\n    if (viewListBtn) {\n      viewListBtn.addEventListener('click', () => this.setViewMode('list'));\n    }\n    if (viewGridBtn) {\n      viewGridBtn.addEventListener('click', () => this.setViewMode('grid'));\n    }\n\n    // Escape key\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (importModal && !importModal.classList.contains('hidden')) {\n          this.hideImportModal();\n        }\n      }\n    });\n\n    // File list click delegation\n    const { fileList } = this.elements;\n    if (fileList) {\n      fileList.addEventListener('click', (e) => this.handleFileListClick(e));\n    }\n  }\n\n  /**\n   * Resolve initial account ID from various sources\n   */\n  private resolveInitialAccountId(): string {\n    const params = new URLSearchParams(window.location.search);\n    const fromQuery = this.normalizeAccountId(params.get('account_id'));\n    if (fromQuery) return fromQuery;\n\n    const fromTemplate = this.normalizeAccountId(this.config.googleAccountId);\n    if (fromTemplate) return fromTemplate;\n\n    try {\n      return this.normalizeAccountId(\n        window.localStorage.getItem(GOOGLE_ACCOUNT_STORAGE_KEY)\n      );\n    } catch {\n      return '';\n    }\n  }\n\n  /**\n   * Normalize account ID\n   */\n  private normalizeAccountId(value: string | null | undefined): string {\n    return (value || '').trim();\n  }\n\n  /**\n   * Update UI elements with account scope\n   */\n  private updateScopedUI(): void {\n    this.syncScopedURLState();\n\n    const { accountScopeHelp, connectGoogleLink } = this.elements;\n\n    if (accountScopeHelp) {\n      if (this.currentAccountId) {\n        accountScopeHelp.textContent = `Account scope: ${this.currentAccountId}`;\n        show(accountScopeHelp);\n      } else {\n        hide(accountScopeHelp);\n      }\n    }\n\n    if (connectGoogleLink) {\n      const baseHref =\n        connectGoogleLink.dataset.baseHref || connectGoogleLink.getAttribute('href');\n      if (baseHref) {\n        connectGoogleLink.setAttribute('href', this.applyAccountIdToPath(baseHref));\n      }\n    }\n  }\n\n  /**\n   * Sync account ID to URL and localStorage\n   */\n  private syncScopedURLState(): void {\n    const url = new URL(window.location.href);\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      url.searchParams.delete('account_id');\n    }\n    window.history.replaceState({}, '', url.toString());\n\n    try {\n      if (this.currentAccountId) {\n        window.localStorage.setItem(GOOGLE_ACCOUNT_STORAGE_KEY, this.currentAccountId);\n      } else {\n        window.localStorage.removeItem(GOOGLE_ACCOUNT_STORAGE_KEY);\n      }\n    } catch {\n      // Ignore storage failures\n    }\n  }\n\n  /**\n   * Apply account ID to a path\n   */\n  private applyAccountIdToPath(pathOrURL: string): string {\n    const parsed = new URL(pathOrURL, window.location.origin);\n    if (this.currentAccountId) {\n      parsed.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      parsed.searchParams.delete('account_id');\n    }\n    return `${parsed.pathname}${parsed.search}${parsed.hash}`;\n  }\n\n  /**\n   * Build scoped API URL\n   */\n  private buildScopedAPIURL(path: string): string {\n    const url = new URL(`${this.apiBase}${path}`, window.location.origin);\n    url.searchParams.set('user_id', this.config.userId || '');\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    }\n    return url.toString();\n  }\n\n  /**\n   * Normalize drive file from API response\n   */\n  private normalizeDriveFile(file: Record<string, unknown>): NormalizedDriveFile {\n    if (!file || typeof file !== 'object') {\n      return {\n        id: '',\n        name: '',\n        mimeType: '',\n        modifiedTime: '',\n        webViewLink: '',\n        parents: [],\n        owners: [],\n      };\n    }\n\n    const id = String(file.id || file.ID || '').trim();\n    const name = String(file.name || file.Name || '').trim();\n    const mimeType = String(file.mimeType || file.MimeType || '').trim();\n    const modifiedTime = String(file.modifiedTime || file.ModifiedTime || '').trim();\n    const webViewLink = String(\n      file.webViewLink || file.webViewURL || file.WebViewURL || ''\n    ).trim();\n    const parentID = String(file.parentId || file.ParentID || '').trim();\n    const ownerEmail = String(file.ownerEmail || file.OwnerEmail || '').trim();\n    const parents = Array.isArray(file.parents)\n      ? (file.parents as string[])\n      : parentID\n        ? [parentID]\n        : [];\n    const owners = Array.isArray(file.owners)\n      ? (file.owners as Array<{ emailAddress?: string }>)\n      : ownerEmail\n        ? [{ emailAddress: ownerEmail }]\n        : [];\n\n    return {\n      id,\n      name,\n      mimeType,\n      modifiedTime,\n      webViewLink,\n      parents,\n      owners,\n      size: file.size as number | undefined,\n      iconLink: file.iconLink as string | undefined,\n      thumbnailLink: file.thumbnailLink as string | undefined,\n    };\n  }\n\n  /**\n   * Load files from current folder or search\n   */\n  async loadFiles(append = false): Promise<void> {\n    if (this.isLoading) return;\n\n    this.isLoading = true;\n    const { loadingState, fileList } = this.elements;\n\n    if (!append) {\n      this.currentFiles = [];\n      this.nextPageToken = null;\n      if (loadingState) show(loadingState);\n    }\n\n    try {\n      const currentFolder = this.currentFolderPath[this.currentFolderPath.length - 1];\n      let url: string;\n\n      if (this.searchQuery) {\n        url = this.buildScopedAPIURL(\n          `/esign/integrations/google/files?q=${encodeURIComponent(this.searchQuery)}`\n        );\n      } else {\n        url = this.buildScopedAPIURL(\n          `/esign/integrations/google/files?folder_id=${encodeURIComponent(currentFolder.id)}`\n        );\n      }\n\n      if (this.nextPageToken) {\n        url += `&page_token=${encodeURIComponent(this.nextPageToken)}`;\n      }\n\n      const response = await fetch(url, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to load files: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const files = Array.isArray(data.files)\n        ? data.files.map((f: Record<string, unknown>) => this.normalizeDriveFile(f))\n        : [];\n\n      if (append) {\n        this.currentFiles = [...this.currentFiles, ...files];\n      } else {\n        this.currentFiles = files;\n      }\n\n      this.nextPageToken = data.next_page_token || null;\n      this.renderFiles();\n      this.updateResultCount();\n      this.updatePagination();\n\n      announce(\n        this.searchQuery\n          ? `Found ${this.currentFiles.length} files`\n          : `Loaded ${this.currentFiles.length} files`\n      );\n    } catch (error) {\n      console.error('Error loading files:', error);\n      this.renderError(error instanceof Error ? error.message : 'Failed to load files');\n      announce('Error loading files');\n    } finally {\n      this.isLoading = false;\n      if (loadingState) hide(loadingState);\n    }\n  }\n\n  /**\n   * Render files in the file list\n   */\n  private renderFiles(): void {\n    const { fileList, loadingState } = this.elements;\n    if (!fileList) return;\n\n    if (loadingState) hide(loadingState);\n\n    if (this.currentFiles.length === 0) {\n      fileList.innerHTML = `\n        <div class=\"p-8 text-center\">\n          <div class=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <svg class=\"w-8 h-8 text-gray-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z\"/>\n            </svg>\n          </div>\n          <h3 class=\"text-lg font-medium text-gray-900 mb-2\">\n            ${this.searchQuery ? 'No files found' : 'This folder is empty'}\n          </h3>\n          <p class=\"text-sm text-gray-500\">\n            ${this.searchQuery ? 'Try a different search term' : 'No files in this folder'}\n          </p>\n        </div>\n      `;\n      return;\n    }\n\n    const html = this.currentFiles\n      .map((file) => this.renderFileItem(file))\n      .join('');\n\n    fileList.innerHTML = html;\n  }\n\n  /**\n   * Render a single file item\n   */\n  private renderFileItem(file: NormalizedDriveFile): string {\n    const isFolder = file.mimeType === 'application/vnd.google-apps.folder';\n    const isImportable = IMPORTABLE_TYPES.includes(file.mimeType);\n    const isSelected = this.selectedFile?.id === file.id;\n\n    const iconType =\n      MIME_TYPE_ICONS[file.mimeType] || MIME_TYPE_ICONS.default;\n    const icon = this.getFileIcon(iconType);\n\n    return `\n      <div\n        class=\"file-item flex items-center gap-4 px-4 py-3 hover:bg-gray-50 cursor-pointer ${isSelected ? 'bg-blue-50 border-l-2 border-blue-500' : ''}\"\n        data-file-id=\"${this.escapeHtml(file.id)}\"\n        data-is-folder=\"${isFolder}\"\n        role=\"option\"\n        aria-selected=\"${isSelected}\"\n        tabindex=\"0\"\n      >\n        <div class=\"w-8 h-8 flex items-center justify-center flex-shrink-0\">\n          ${icon}\n        </div>\n        <div class=\"flex-1 min-w-0\">\n          <p class=\"text-sm font-medium text-gray-900 truncate\">\n            ${this.escapeHtml(file.name)}\n          </p>\n          <p class=\"text-xs text-gray-500\">\n            ${formatDateTime(file.modifiedTime)}\n          </p>\n        </div>\n        ${\n          isImportable\n            ? `<span class=\"px-2 py-0.5 text-xs font-medium bg-green-100 text-green-700 rounded\">Importable</span>`\n            : ''\n        }\n      </div>\n    `;\n  }\n\n  /**\n   * Get SVG icon for file type\n   */\n  private getFileIcon(type: string): string {\n    const iconMap: Record<string, string> = {\n      folder: `<svg class=\"w-6 h-6 text-amber-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z\"/></svg>`,\n      doc: `<svg class=\"w-6 h-6 text-blue-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z\"/></svg>`,\n      sheet: `<svg class=\"w-6 h-6 text-green-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z\"/><path d=\"M7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7zm4-8h6v2h-6zm0 4h6v2h-6zm0 4h6v2h-6z\"/></svg>`,\n      slide: `<svg class=\"w-6 h-6 text-yellow-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z\"/></svg>`,\n      pdf: `<svg class=\"w-6 h-6 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z\"/></svg>`,\n      file: `<svg class=\"w-6 h-6 text-gray-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z\"/></svg>`,\n    };\n    return iconMap[type] || iconMap.file;\n  }\n\n  /**\n   * Handle file list clicks\n   */\n  private handleFileListClick(e: Event): void {\n    const target = e.target as HTMLElement;\n    const fileItem = target.closest('.file-item') as HTMLElement | null;\n\n    if (!fileItem) return;\n\n    const fileId = fileItem.dataset.fileId;\n    const isFolder = fileItem.dataset.isFolder === 'true';\n\n    if (!fileId) return;\n\n    if (isFolder) {\n      this.navigateToFolder(fileId);\n    } else {\n      this.selectFile(fileId);\n    }\n  }\n\n  /**\n   * Navigate into a folder\n   */\n  private navigateToFolder(folderId: string): void {\n    const folder = this.currentFiles.find((f) => f.id === folderId);\n    if (!folder) return;\n\n    this.currentFolderPath.push({ id: folder.id, name: folder.name });\n    this.searchQuery = '';\n    this.clearSelection();\n    this.updateBreadcrumb();\n    this.loadFiles();\n  }\n\n  /**\n   * Select a file\n   */\n  private selectFile(fileId: string): void {\n    const file = this.currentFiles.find((f) => f.id === fileId);\n    if (!file) return;\n\n    this.selectedFile = file;\n    this.renderSelection();\n    this.renderFiles(); // Re-render to update selection state\n    announce(`Selected: ${file.name}`);\n  }\n\n  /**\n   * Clear file selection\n   */\n  private clearSelection(): void {\n    this.selectedFile = null;\n    this.renderSelection();\n    this.renderFiles();\n  }\n\n  /**\n   * Render selection panel\n   */\n  private renderSelection(): void {\n    const {\n      noSelection,\n      filePreview,\n      previewIcon,\n      previewTitle,\n      previewType,\n      previewFileId,\n      previewOwner,\n      previewModified,\n      importBtn,\n      openInGoogleBtn,\n    } = this.elements;\n\n    if (!this.selectedFile) {\n      if (noSelection) show(noSelection);\n      if (filePreview) hide(filePreview);\n      return;\n    }\n\n    if (noSelection) hide(noSelection);\n    if (filePreview) show(filePreview);\n\n    const file = this.selectedFile;\n    const isImportable = IMPORTABLE_TYPES.includes(file.mimeType);\n\n    if (previewTitle) {\n      previewTitle.textContent = file.name;\n    }\n\n    if (previewType) {\n      previewType.textContent = this.getMimeTypeLabel(file.mimeType);\n    }\n\n    if (previewFileId) {\n      previewFileId.textContent = file.id;\n    }\n\n    if (previewOwner && file.owners.length > 0) {\n      previewOwner.textContent = file.owners[0].emailAddress || '-';\n    }\n\n    if (previewModified) {\n      previewModified.textContent = formatDateTime(file.modifiedTime);\n    }\n\n    if (importBtn) {\n      if (isImportable) {\n        importBtn.removeAttribute('disabled');\n        importBtn.classList.remove('opacity-50', 'cursor-not-allowed');\n      } else {\n        importBtn.setAttribute('disabled', 'true');\n        importBtn.classList.add('opacity-50', 'cursor-not-allowed');\n      }\n    }\n\n    if (openInGoogleBtn && file.webViewLink) {\n      openInGoogleBtn.href = file.webViewLink;\n    }\n  }\n\n  /**\n   * Get human-readable mime type label\n   */\n  private getMimeTypeLabel(mimeType: string): string {\n    const labels: Record<string, string> = {\n      'application/vnd.google-apps.folder': 'Folder',\n      'application/vnd.google-apps.document': 'Google Doc',\n      'application/vnd.google-apps.spreadsheet': 'Google Sheet',\n      'application/vnd.google-apps.presentation': 'Google Slides',\n      'application/pdf': 'PDF',\n    };\n    return labels[mimeType] || 'File';\n  }\n\n  /**\n   * Update breadcrumb navigation\n   */\n  private updateBreadcrumb(): void {\n    const { breadcrumb, listTitle } = this.elements;\n    if (!breadcrumb) return;\n\n    if (this.searchQuery) {\n      hide(breadcrumb);\n      if (listTitle) listTitle.textContent = 'Search Results';\n      return;\n    }\n\n    show(breadcrumb);\n    const currentFolder = this.currentFolderPath[this.currentFolderPath.length - 1];\n    if (listTitle) listTitle.textContent = currentFolder.name;\n\n    const ol = breadcrumb.querySelector('ol');\n    if (!ol) return;\n\n    ol.innerHTML = this.currentFolderPath\n      .map(\n        (item, index) => `\n        <li class=\"flex items-center\">\n          ${index > 0 ? '<span class=\"text-gray-400 mx-2\">/</span>' : ''}\n          <button\n            type=\"button\"\n            data-folder-id=\"${this.escapeHtml(item.id)}\"\n            data-folder-index=\"${index}\"\n            class=\"breadcrumb-item text-blue-600 hover:text-blue-800 hover:underline\"\n          >\n            ${this.escapeHtml(item.name)}\n          </button>\n        </li>\n      `\n      )\n      .join('');\n\n    // Add click handlers to breadcrumb items\n    qsa('.breadcrumb-item', ol).forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const index = parseInt((btn as HTMLElement).dataset.folderIndex || '0', 10);\n        this.navigateToBreadcrumb(index);\n      });\n    });\n  }\n\n  /**\n   * Navigate to breadcrumb item\n   */\n  private navigateToBreadcrumb(index: number): void {\n    if (index < 0 || index >= this.currentFolderPath.length - 1) return;\n\n    this.currentFolderPath = this.currentFolderPath.slice(0, index + 1);\n    this.searchQuery = '';\n    this.clearSelection();\n    this.updateBreadcrumb();\n    this.loadFiles();\n  }\n\n  /**\n   * Update result count display\n   */\n  private updateResultCount(): void {\n    const { resultCount } = this.elements;\n    if (!resultCount) return;\n\n    if (this.currentFiles.length > 0) {\n      resultCount.textContent = `(${this.currentFiles.length}${this.nextPageToken ? '+' : ''} files)`;\n    } else {\n      resultCount.textContent = '';\n    }\n  }\n\n  /**\n   * Update pagination controls\n   */\n  private updatePagination(): void {\n    const { pagination, loadMoreBtn } = this.elements;\n    if (!pagination) return;\n\n    if (this.nextPageToken) {\n      show(pagination);\n    } else {\n      hide(pagination);\n    }\n  }\n\n  /**\n   * Handle search\n   */\n  private handleSearch(): void {\n    const { searchInput, clearSearchBtn } = this.elements;\n    if (!searchInput) return;\n\n    const query = searchInput.value.trim();\n    this.searchQuery = query;\n\n    if (clearSearchBtn) {\n      if (query) {\n        show(clearSearchBtn);\n      } else {\n        hide(clearSearchBtn);\n      }\n    }\n\n    this.clearSelection();\n    this.loadFiles();\n  }\n\n  /**\n   * Clear search\n   */\n  private clearSearch(): void {\n    const { searchInput, clearSearchBtn } = this.elements;\n    if (searchInput) searchInput.value = '';\n    if (clearSearchBtn) hide(clearSearchBtn);\n\n    this.searchQuery = '';\n    this.clearSelection();\n    this.updateBreadcrumb();\n    this.loadFiles();\n  }\n\n  /**\n   * Refresh file list\n   */\n  private refresh(): void {\n    this.clearSelection();\n    this.loadFiles();\n  }\n\n  /**\n   * Load more files (pagination)\n   */\n  private loadMore(): void {\n    if (this.nextPageToken) {\n      this.loadFiles(true);\n    }\n  }\n\n  /**\n   * Set view mode\n   */\n  private setViewMode(mode: 'list' | 'grid'): void {\n    const { viewListBtn, viewGridBtn } = this.elements;\n    this.isListView = mode === 'list';\n\n    if (viewListBtn) {\n      viewListBtn.setAttribute('aria-pressed', String(this.isListView));\n    }\n    if (viewGridBtn) {\n      viewGridBtn.setAttribute('aria-pressed', String(!this.isListView));\n    }\n\n    this.renderFiles();\n  }\n\n  /**\n   * Show import modal\n   */\n  private showImportModal(): void {\n    if (!this.selectedFile) return;\n\n    const { importModal, importGoogleFileId, importDocumentTitle, importAgreementTitle } =\n      this.elements;\n\n    if (importGoogleFileId) {\n      importGoogleFileId.value = this.selectedFile.id;\n    }\n\n    if (importDocumentTitle) {\n      // Remove file extension for default title\n      const name = this.selectedFile.name.replace(/\\.[^/.]+$/, '');\n      importDocumentTitle.value = name;\n    }\n\n    if (importAgreementTitle) {\n      importAgreementTitle.value = '';\n    }\n\n    if (importModal) {\n      show(importModal);\n    }\n  }\n\n  /**\n   * Hide import modal\n   */\n  private hideImportModal(): void {\n    const { importModal } = this.elements;\n    if (importModal) hide(importModal);\n  }\n\n  /**\n   * Handle import form submission\n   */\n  private async handleImport(): Promise<void> {\n    if (!this.selectedFile) return;\n\n    const {\n      importConfirmBtn,\n      importSpinner,\n      importBtnText,\n      importDocumentTitle,\n      importAgreementTitle,\n    } = this.elements;\n\n    const googleFileId = this.selectedFile.id;\n    const documentTitle = importDocumentTitle?.value.trim() || this.selectedFile.name;\n    const agreementTitle = importAgreementTitle?.value.trim() || '';\n\n    // Set loading state\n    if (importConfirmBtn) {\n      importConfirmBtn.setAttribute('disabled', 'true');\n    }\n    if (importSpinner) show(importSpinner);\n    if (importBtnText) importBtnText.textContent = 'Importing...';\n\n    try {\n      const response = await fetch(this.buildScopedAPIURL('/esign/google-drive/imports'), {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n        body: JSON.stringify({\n          google_file_id: googleFileId,\n          document_title: documentTitle,\n          agreement_title: agreementTitle || undefined,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error?.message || 'Import failed');\n      }\n\n      const result = await response.json();\n\n      this.showToast('Import started successfully', 'success');\n      announce('Import started');\n\n      this.hideImportModal();\n\n      // Redirect to document or agreement if created\n      if (result.document?.id && this.config.pickerRoutes?.documents) {\n        window.location.href = `${this.config.pickerRoutes.documents}/${result.document.id}`;\n      } else if (result.agreement?.id && this.config.pickerRoutes?.agreements) {\n        window.location.href = `${this.config.pickerRoutes.agreements}/${result.agreement.id}`;\n      }\n    } catch (error) {\n      console.error('Import error:', error);\n      const message = error instanceof Error ? error.message : 'Import failed';\n      this.showToast(message, 'error');\n      announce(`Error: ${message}`);\n    } finally {\n      if (importConfirmBtn) {\n        importConfirmBtn.removeAttribute('disabled');\n      }\n      if (importSpinner) hide(importSpinner);\n      if (importBtnText) importBtnText.textContent = 'Import';\n    }\n  }\n\n  /**\n   * Render error state\n   */\n  private renderError(message: string): void {\n    const { fileList } = this.elements;\n    if (!fileList) return;\n\n    fileList.innerHTML = `\n      <div class=\"p-8 text-center\">\n        <div class=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <svg class=\"w-8 h-8 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n        </div>\n        <h3 class=\"text-lg font-medium text-gray-900 mb-2\">Error Loading Files</h3>\n        <p class=\"text-sm text-gray-500 mb-4\">${this.escapeHtml(message)}</p>\n        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"location.reload()\">\n          Try Again\n        </button>\n      </div>\n    `;\n  }\n\n  /**\n   * Show toast notification\n   */\n  private showToast(message: string, type: 'success' | 'error'): void {\n    const win = window as unknown as Record<string, unknown>;\n    const toastManager = win.toastManager as\n      | { success: (msg: string) => void; error: (msg: string) => void }\n      | undefined;\n\n    if (toastManager) {\n      if (type === 'success') {\n        toastManager.success(message);\n      } else {\n        toastManager.error(message);\n      }\n    }\n  }\n\n  /**\n   * Escape HTML\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n/**\n * Initialize Google Drive picker page from config\n */\nexport function initGoogleDrivePicker(\n  config: GoogleDrivePickerConfig\n): GoogleDrivePickerController {\n  const controller = new GoogleDrivePickerController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap Google Drive picker page from template context\n */\nexport function bootstrapGoogleDrivePicker(config: {\n  basePath: string;\n  apiBasePath?: string;\n  userId: string;\n  googleAccountId?: string;\n  googleConnected?: boolean;\n  pickerRoutes?: {\n    integrations?: string;\n    agreements?: string;\n    documents?: string;\n  };\n}): void {\n  const pageConfig: GoogleDrivePickerConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n    userId: config.userId,\n    googleAccountId: config.googleAccountId,\n    googleConnected: config.googleConnected !== false,\n    pickerRoutes: config.pickerRoutes,\n  };\n\n  const controller = new GoogleDrivePickerController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignGoogleDrivePickerController =\n      controller;\n  }\n}\n"],"names":["ESignAPIClient","config","params","queryParams","allRows","page","perPage","maxPages","response","rows","counters","row","status","pending","actionRequired","importRunId","id","path","body","error","ESignAPIError","code","message","details","defaultClient","getESignClient","setESignClient","client","createESignClient","formatFileSize","bytes","numBytes","formatPageCount","count","numCount","formatDateTime","value","options","date","defaultOptions","formatDate","formatTime","formatRelativeTime","now","diffMs","diffSec","diffMin","diffHour","diffDay","rtf","formatRecipientCount","capitalize","str","snakeToTitle","word","truncate","maxLength","AGREEMENT_STATUS_BADGES","getAgreementStatusBadge","normalizedStatus","renderStatusBadge","badge","showDot","size","sizeClasses","dotHtml","createStatusBadgeElement","container","updateStatusBadge","element","existingDot","dotSpan","textContent","qs","selector","parent","qsa","byId","createElement","tagName","attributes","children","key","child","on","event","handler","delegate","delegatedHandler","ev","target","onReady","callback","show","hide","toggle","visible","setLoading","loading","updateDataText","updateDataTexts","values","getPageConfig","configAttr","configStr","scriptEl","announce","priority","announcer","el","poll","fn","until","interval","timeout","maxAttempts","onProgress","signal","startTime","attempts","lastResult","sleep","retry","baseDelay","maxDelay","exponentialBackoff","shouldRetry","onRetry","lastError","attempt","delay","ms","resolve","reject","timeoutId","abortHandler","debounce","args","throttle","lastCall","createTimeoutController","timeoutMs","controller","withTimeout","promise","errorMessage","timeoutPromise","_","LandingPageController","err","stats","initLandingPage","pageConfig","bootstrapLandingPage","basePath","apiBasePath","pageEl","e","SignerCompletePageController","assets","artifacts","state","s","link","initSignerCompletePage","bootstrapSignerCompletePage","formatSizeElements","formatTimestampElements","ts","applyDetailFormatters","initDetailFormatters","ERROR_MESSAGES","GoogleCallbackController","closeBtn","errorDescription","stateData","rawState","result","parsed","loadingState","successState","errorState","data","description","errorDetail","redirectPath","redirectURL","accountId","initGoogleCallback","bootstrapGoogleCallback","GOOGLE_ACCOUNT_STORAGE_KEY","SCOPE_DESCRIPTIONS","GoogleIntegrationController","connectBtn","disconnectBtn","refreshBtn","retryBtn","reauthBtn","oauthCancelBtn","disconnectCancelBtn","disconnectConfirmBtn","accountIdInput","oauthModal","disconnectModal","modal","fromQuery","fromTemplate","refreshStatus","normalized","connectedAccountId","importDriveLink","integrationSettingsLink","url","links","baseHref","pathOrURL","announcements","disconnectedState","connectedState","connected","expiring","degraded","statusBadge","errorData","integration","isDegraded","raw","firstDefined","keys","fallback","expiresAt","scopes","degradedReason","email","canAutoRefresh","explicitNeedsReauth","isExpired","isExpiringSoon","expiryDate","deltaMs","expiringSoonMs","needsReauthorization","connectedEmail","scopesList","expiryInfo","reauthWarning","reauthReason","scope","info","expiryTime","minutesLeft","reason","degradedWarning","text","div","redirectUri","authUrl","width","height","left","top","clientId","callbackAccountId","accountIdForConnect","type","toastManager","initGoogleIntegration","bootstrapGoogleIntegration","MIME_TYPE_ICONS","IMPORTABLE_TYPES","GoogleDrivePickerController","searchInput","clearSearchBtn","loadMoreBtn","importBtn","clearSelectionBtn","importCancelBtn","importConfirmBtn","importForm","importModal","viewListBtn","viewGridBtn","debouncedSearch","fileList","accountScopeHelp","connectGoogleLink","file","name","mimeType","modifiedTime","webViewLink","parentID","ownerEmail","parents","owners","append","currentFolder","files","f","html","isFolder","isImportable","isSelected","iconType","icon","iconMap","fileItem","fileId","folderId","folder","noSelection","filePreview","previewIcon","previewTitle","previewType","previewFileId","previewOwner","previewModified","openInGoogleBtn","breadcrumb","listTitle","ol","item","index","btn","resultCount","pagination","query","mode","importGoogleFileId","importDocumentTitle","importAgreementTitle","importSpinner","importBtnText","googleFileId","documentTitle","agreementTitle","initGoogleDrivePicker","bootstrapGoogleDrivePicker"],"mappings":"AAyBO,MAAMA,EAAe;AAAA,EAK1B,YAAYC,GAA8B;AACxC,SAAK,WAAWA,EAAO,UACvB,KAAK,cAAcA,EAAO,eAAe,GAAGA,EAAO,QAAQ,QAC3D,KAAK,iBAAiB;AAAA,MACpB,QAAQ;AAAA,MACR,gBAAgB;AAAA,MAChB,GAAGA,EAAO;AAAA,IAAA;AAAA,EAEd;AAAA;AAAA,EAGA,MAAM,eAAeC,GAKuB;AAC1C,UAAMC,IAAc,IAAI,gBAAA;AACxB,WAAID,GAAQ,QAAMC,EAAY,IAAI,QAAQ,OAAOD,EAAO,IAAI,CAAC,GACzDA,GAAQ,YAAUC,EAAY,IAAI,YAAY,OAAOD,EAAO,QAAQ,CAAC,GACrEA,GAAQ,UAAQC,EAAY,IAAI,UAAUD,EAAO,MAAM,GACvDA,GAAQ,UAAQC,EAAY,IAAI,UAAUD,EAAO,MAAM,GAEpD,KAAK;AAAA,MACV,qBAAqBC,EAAY,UAAU;AAAA,IAAA;AAAA,EAE/C;AAAA,EAEA,MAAM,oBAA6C;AACjD,UAAMC,IAA8B,CAAA;AACpC,QAAIC,IAAO;AACX,UAAMC,IAAU,KACVC,IAAW;AAEjB,WAAOF,KAAQE,KAAU;AACvB,YAAMC,IAAW,MAAM,KAAK,eAAe,EAAE,MAAAH,GAAM,UAAUC,GAAS,GAChEG,IAAOD,EAAS,SAASA,EAAS,WAAW,CAAA;AAGnD,UAFAJ,EAAQ,KAAK,GAAGK,CAAI,GAEhBA,EAAK,WAAW,KAAKL,EAAQ,UAAUI,EAAS;AAClD;AAEF,MAAAH,KAAQ;AAAA,IACV;AAEA,UAAMK,IAA4C,CAAA;AAClD,eAAWC,KAAOP,GAAS;AACzB,YAAMQ,IAAS,OAAOD,GAAK,UAAU,EAAE,EAAE,KAAA,EAAO,YAAA;AAChD,MAAKC,MACLF,EAASE,CAAM,KAAKF,EAASE,CAAM,KAAK,KAAK;AAAA,IAC/C;AAEA,UAAMC,KAAWH,EAAS,QAAQ,MAAMA,EAAS,eAAe,IAC1DI,IAAiBD,KAAWH,EAAS,YAAY;AAEvD,WAAO;AAAA,MACL,OAAOA,EAAS,SAAS;AAAA,MACzB,MAAMA,EAAS,QAAQ;AAAA,MACvB,aAAaA,EAAS,eAAe;AAAA,MACrC,WAAWA,EAAS,aAAa;AAAA,MACjC,QAAQA,EAAS,UAAU;AAAA,MAC3B,UAAUA,EAAS,YAAY;AAAA,MAC/B,SAASA,EAAS,WAAW;AAAA,MAC7B,SAAAG;AAAA,MACA,iBAAiBC;AAAA,IAAA;AAAA,EAErB;AAAA;AAAA,EAGA,MAAM,cAAcZ,GAIuB;AACzC,UAAMC,IAAc,IAAI,gBAAA;AACxB,WAAID,GAAQ,QAAMC,EAAY,IAAI,QAAQ,OAAOD,EAAO,IAAI,CAAC,GACzDA,GAAQ,YAAUC,EAAY,IAAI,YAAY,OAAOD,EAAO,QAAQ,CAAC,GACrEA,GAAQ,UAAQC,EAAY,IAAI,UAAUD,EAAO,MAAM,GAEpD,KAAK;AAAA,MACV,oBAAoBC,EAAY,UAAU;AAAA,IAAA;AAAA,EAE9C;AAAA;AAAA,EAGA,MAAM,6BAA+D;AACnE,WAAO,KAAK,IAA6B,sCAAsC;AAAA,EACjF;AAAA,EAEA,MAAM,kBAAkBD,GAIK;AAC3B,WAAO,KAAK,KAAsB,kCAAkCA,CAAM;AAAA,EAC5E;AAAA,EAEA,MAAM,sBAAsBa,GAA+C;AACzE,WAAO,KAAK,IAAqB,kCAAkCA,CAAW,EAAE;AAAA,EAClF;AAAA;AAAA,EAGA,MAAM,WAAWb,GAGkE;AACjF,UAAMC,IAAc,IAAI,gBAAA;AACxB,WAAID,GAAQ,SAAOC,EAAY,IAAI,SAAS,OAAOD,EAAO,KAAK,CAAC,GAC5DA,GAAQ,UAAQC,EAAY,IAAI,UAAUD,EAAO,MAAM,GAEpD,KAAK,IAAI,oBAAoBC,EAAY,SAAA,CAAU,EAAE;AAAA,EAC9D;AAAA,EAEA,MAAM,SAASa,GAAkC;AAC/C,WAAO,KAAK,IAAiB,oBAAoBA,CAAE,EAAE;AAAA,EACvD;AAAA,EAEA,MAAM,YAAYd,GAMO;AACvB,WAAO,KAAK,KAAkB,oBAAoBA,CAAM;AAAA,EAC1D;AAAA,EAEA,MAAM,YACJc,GACAd,GAOsB;AACtB,WAAO,KAAK,IAAiB,oBAAoBc,CAAE,IAAId,CAAM;AAAA,EAC/D;AAAA,EAEA,MAAM,YAAYc,GAA2B;AAC3C,WAAO,KAAK,OAAO,oBAAoBA,CAAE,EAAE;AAAA,EAC7C;AAAA,EAEA,MAAM,UACJA,GACAd,GAMC;AACD,WAAO,KAAK,KAAK,oBAAoBc,CAAE,SAASd,CAAM;AAAA,EACxD;AAAA;AAAA,EAGA,MAAc,IAAOe,GAA0B;AAC7C,UAAMT,IAAW,MAAM,MAAM,GAAG,KAAK,WAAW,GAAGS,CAAI,IAAI;AAAA,MACzD,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,IAAA,CACf;AACD,WAAO,KAAK,eAAkBT,CAAQ;AAAA,EACxC;AAAA,EAEA,MAAc,KAAQS,GAAcC,GAA4B;AAC9D,UAAMV,IAAW,MAAM,MAAM,GAAG,KAAK,WAAW,GAAGS,CAAI,IAAI;AAAA,MACzD,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,MAAMC,IAAO,KAAK,UAAUA,CAAI,IAAI;AAAA,IAAA,CACrC;AACD,WAAO,KAAK,eAAkBV,CAAQ;AAAA,EACxC;AAAA,EAEA,MAAc,IAAOS,GAAcC,GAA2B;AAC5D,UAAMV,IAAW,MAAM,MAAM,GAAG,KAAK,WAAW,GAAGS,CAAI,IAAI;AAAA,MACzD,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,MAAM,KAAK,UAAUC,CAAI;AAAA,IAAA,CAC1B;AACD,WAAO,KAAK,eAAkBV,CAAQ;AAAA,EACxC;AAAA,EAEA,MAAc,OAAUS,GAA0B;AAChD,UAAMT,IAAW,MAAM,MAAM,GAAG,KAAK,WAAW,GAAGS,CAAI,IAAI;AAAA,MACzD,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,IAAA,CACf;AACD,WAAO,KAAK,eAAkBT,CAAQ;AAAA,EACxC;AAAA,EAEA,MAAc,eAAkBA,GAAgC;AAC9D,QAAI,CAACA,EAAS,IAAI;AAChB,UAAIW;AACJ,UAAI;AAEF,QAAAA,KADkB,MAAMX,EAAS,KAAA,GACf,SAAS;AAAA,UACzB,MAAM,QAAQA,EAAS,MAAM;AAAA,UAC7B,SAASA,EAAS;AAAA,QAAA;AAAA,MAEtB,QAAQ;AACN,QAAAW,IAAQ;AAAA,UACN,MAAM,QAAQX,EAAS,MAAM;AAAA,UAC7B,SAASA,EAAS;AAAA,QAAA;AAAA,MAEtB;AACA,YAAM,IAAIY,EAAcD,EAAM,MAAMA,EAAM,SAASA,EAAM,OAAO;AAAA,IAClE;AAEA,QAAIX,EAAS,WAAW;AAIxB,aAAOA,EAAS,KAAA;AAAA,EAClB;AACF;AAEO,MAAMY,UAAsB,MAAM;AAAA,EACvC,YACkBC,GAChBC,GACgBC,GAChB;AACA,UAAMD,CAAO,GAJG,KAAA,OAAAD,GAEA,KAAA,UAAAE,GAGhB,KAAK,OAAO;AAAA,EACd;AACF;AAGA,IAAIC,IAAuC;AAEpC,SAASC,KAAiC;AAC/C,MAAI,CAACD;AACH,UAAM,IAAI,MAAM,8DAA8D;AAEhF,SAAOA;AACT;AAEO,SAASE,EAAeC,GAA8B;AAC3D,EAAAH,IAAgBG;AAClB;AAEO,SAASC,EAAkB3B,GAA8C;AAC9E,QAAM0B,IAAS,IAAI3B,EAAeC,CAAM;AACxC,SAAAyB,EAAeC,CAAM,GACdA;AACT;AC5QO,SAASE,EAAeC,GAAmD;AAChF,MAA2BA,KAAU,QAAQA,MAAU,MAAMA,MAAU,EAAG,QAAO;AACjF,QAAMC,IAAW,OAAOD,KAAU,WAAW,SAASA,GAAO,EAAE,IAAIA;AACnE,SAAI,CAAC,OAAO,SAASC,CAAQ,KAAKA,KAAY,IAAU,MAEpDA,IAAW,OAAa,GAAGA,CAAQ,OACnCA,IAAW,OAAO,OAAa,IAAIA,IAAW,MAAM,QAAQ,CAAC,CAAC,QAC3D,IAAIA,KAAY,OAAO,OAAO,QAAQ,CAAC,CAAC;AACjD;AAKO,SAASC,GAAgBC,GAAmD;AACjF,MAAI,CAACA,EAAO,QAAO;AACnB,QAAMC,IAAW,OAAOD,KAAU,WAAW,SAASA,GAAO,EAAE,IAAIA;AACnE,SAAI,CAAC,OAAO,SAASC,CAAQ,KAAKA,KAAY,IAAU,MACjDA,MAAa,IAAI,WAAW,GAAGA,CAAQ;AAChD;AAKO,SAASC,EACdC,GACAC,GACQ;AACR,MAAI,CAACD,EAAO,QAAO;AACnB,MAAI;AACF,UAAME,IAAOF,aAAiB,OAAOA,IAAQ,IAAI,KAAKA,CAAK;AAC3D,QAAI,MAAME,EAAK,QAAA,CAAS,EAAG,QAAO;AAElC,UAAMC,IAA6C;AAAA,MACjD,WAAW;AAAA,MACX,WAAW;AAAA,IAAA;AAGb,WAAOD,EAAK,eAAe,QAAWD,KAAWE,CAAc;AAAA,EACjE,QAAQ;AACN,WAAO,OAAOH,CAAK;AAAA,EACrB;AACF;AAKO,SAASI,GACdJ,GACAC,GACQ;AACR,MAAI,CAACD,EAAO,QAAO;AACnB,MAAI;AACF,UAAME,IAAOF,aAAiB,OAAOA,IAAQ,IAAI,KAAKA,CAAK;AAC3D,QAAI,MAAME,EAAK,QAAA,CAAS,EAAG,QAAO;AAElC,UAAMC,IAA6C;AAAA,MACjD,WAAW;AAAA,IAAA;AAGb,WAAOD,EAAK,mBAAmB,QAAWD,KAAWE,CAAc;AAAA,EACrE,QAAQ;AACN,WAAO,OAAOH,CAAK;AAAA,EACrB;AACF;AAKO,SAASK,GACdL,GACAC,GACQ;AACR,MAAI,CAACD,EAAO,QAAO;AACnB,MAAI;AACF,UAAME,IAAOF,aAAiB,OAAOA,IAAQ,IAAI,KAAKA,CAAK;AAC3D,QAAI,MAAME,EAAK,QAAA,CAAS,EAAG,QAAO;AAElC,UAAMC,IAA6C;AAAA,MACjD,MAAM;AAAA,MACN,QAAQ;AAAA,IAAA;AAGV,WAAOD,EAAK,mBAAmB,QAAWD,KAAWE,CAAc;AAAA,EACrE,QAAQ;AACN,WAAO,OAAOH,CAAK;AAAA,EACrB;AACF;AAKO,SAASM,GAAmBN,GAAiD;AAClF,MAAI,CAACA,EAAO,QAAO;AACnB,MAAI;AACF,UAAME,IAAOF,aAAiB,OAAOA,IAAQ,IAAI,KAAKA,CAAK;AAC3D,QAAI,MAAME,EAAK,QAAA,CAAS,EAAG,QAAO;AAElC,UAAMK,wBAAU,KAAA,GACVC,IAASN,EAAK,QAAA,IAAYK,EAAI,QAAA,GAC9BE,IAAU,KAAK,MAAMD,IAAS,GAAI,GAClCE,IAAU,KAAK,MAAMD,IAAU,EAAE,GACjCE,IAAW,KAAK,MAAMD,IAAU,EAAE,GAClCE,IAAU,KAAK,MAAMD,IAAW,EAAE,GAElCE,IAAM,IAAI,KAAK,mBAAmB,QAAW,EAAE,SAAS,QAAQ;AAEtE,WAAI,KAAK,IAAID,CAAO,KAAK,IAChBC,EAAI,OAAOD,GAAS,KAAK,IAE9B,KAAK,IAAID,CAAQ,KAAK,IACjBE,EAAI,OAAOF,GAAU,MAAM,IAEhC,KAAK,IAAID,CAAO,KAAK,IAChBG,EAAI,OAAOH,GAAS,QAAQ,IAE9BG,EAAI,OAAOJ,GAAS,QAAQ;AAAA,EACrC,QAAQ;AACN,WAAO,OAAOT,CAAK;AAAA,EACrB;AACF;AAKO,SAASc,GAAqBjB,GAA0C;AAC7E,SAA2BA,KAAU,OAAa,iBAC3CA,MAAU,IAAI,gBAAgB,GAAGA,CAAK;AAC/C;AAKO,SAASkB,EAAWC,GAAqB;AAC9C,SAAKA,IACEA,EAAI,OAAO,CAAC,EAAE,gBAAgBA,EAAI,MAAM,CAAC,IAD/B;AAEnB;AAKO,SAASC,GAAaD,GAAqB;AAChD,SAAKA,IACEA,EACJ,MAAM,GAAG,EACT,IAAI,CAACE,MAASH,EAAWG,CAAI,CAAC,EAC9B,KAAK,GAAG,IAJM;AAKnB;AAKO,SAASC,GAASH,GAAaI,GAA2B;AAC/D,SAAI,CAACJ,KAAOA,EAAI,UAAUI,IAAkBJ,IACrC,GAAGA,EAAI,MAAM,GAAGI,IAAY,CAAC,CAAC;AACvC;ACjJO,MAAMC,IAAgE;AAAA,EAC3E,OAAO;AAAA,IACL,OAAO;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,MAAM;AAAA,IACJ,OAAO;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,aAAa;AAAA,IACX,OAAO;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,WAAW;AAAA,IACT,OAAO;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,QAAQ;AAAA,IACN,OAAO;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,UAAU;AAAA,IACR,OAAO;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,SAAS;AAAA,IACP,OAAO;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAEd;AAKO,SAASC,EACd9C,GACa;AACb,QAAM+C,IAAmB,OAAO/C,KAAU,EAAE,EACzC,KAAA,EACA,YAAA;AACH,SACE6C,EAAwBE,CAAgB,KAAK;AAAA,IAC3C,OAAO/C,KAAU;AAAA,IACjB,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAGhB;AAKO,SAASgD,EACdhD,GACAyB,GAIQ;AACR,QAAMwB,IAAQH,EAAwB9C,CAAM,GACtCkD,IAAUzB,GAAS,WAAW,IAC9B0B,IAAO1B,GAAS,QAAQ,MAExB2B,IAAc;AAAA,IAClB,IAAI;AAAA,IACJ,IAAI;AAAA,IACJ,IAAI;AAAA,EAAA,GAGAC,IAAUH,IACZ,qCAAqCD,EAAM,QAAQ,wCACnD;AAEJ,SAAO,yCAAyCG,EAAYD,CAAI,CAAC,6BAA6BF,EAAM,OAAO,IAAIA,EAAM,SAAS,KAAKI,CAAO,GAAGJ,EAAM,KAAK;AAC1J;AAKO,SAASK,GACdtD,GACAyB,GAIiB;AACjB,QAAM8B,IAAY,SAAS,cAAc,MAAM;AAC/C,SAAAA,EAAU,YAAYP,EAAkBhD,GAAQyB,CAAO,GAChD8B,EAAU;AACnB;AAKO,SAASC,GACdC,GACAzD,GACAyB,GAIM;AACN,QAAMwB,IAAQH,EAAwB9C,CAAM,GACtCmD,IAAO1B,GAAS,QAAQ,MAExB2B,IAAc;AAAA,IAClB,IAAI;AAAA,IACJ,IAAI;AAAA,IACJ,IAAI;AAAA,EAAA;AASN,MALAK,EAAQ,YAAY,IACpBA,EAAQ,YAAY,4BAA4BL,EAAYD,CAAI,CAAC,6BAA6BF,EAAM,OAAO,IAAIA,EAAM,SAAS,IAG9GxB,GAAS,WAAW,IACvB;AACX,UAAMiC,IAAcD,EAAQ,cAAc,eAAe;AACzD,QAAIC;AACF,MAAAA,EAAY,YAAY,wBAAwBT,EAAM,QAAQ;AAAA,SACzD;AACL,YAAMU,IAAU,SAAS,cAAc,MAAM;AAC7C,MAAAA,EAAQ,YAAY,wBAAwBV,EAAM,QAAQ,WAC1DU,EAAQ,aAAa,eAAe,MAAM,GAC1CF,EAAQ,QAAQE,CAAO;AAAA,IACzB;AAAA,EACF;AAGA,QAAMC,IAAcH,EAAQ,WAAWA,EAAQ,WAAW,SAAS,CAAC;AACpE,EAAIG,KAAeA,EAAY,aAAa,KAAK,YAC/CA,EAAY,cAAcX,EAAM,QAEhCQ,EAAQ,YAAY,SAAS,eAAeR,EAAM,KAAK,CAAC;AAE5D;AChKO,SAASY,EACdC,GACAC,IAAqB,UACX;AACV,MAAI;AACF,WAAOA,EAAO,cAAiBD,CAAQ;AAAA,EACzC,QAAQ;AACN,WAAO;AAAA,EACT;AACF;AAKO,SAASE,EACdF,GACAC,IAAqB,UAChB;AACL,MAAI;AACF,WAAO,MAAM,KAAKA,EAAO,iBAAoBD,CAAQ,CAAC;AAAA,EACxD,QAAQ;AACN,WAAO,CAAA;AAAA,EACT;AACF;AAKO,SAASG,GAA0C7D,GAAsB;AAC9E,SAAO,SAAS,eAAeA,CAAE;AACnC;AAKO,SAAS8D,EACdC,GACAC,GACAC,GAC0B;AAC1B,QAAMZ,IAAU,SAAS,cAAcU,CAAO;AAE9C,MAAIC;AACF,eAAW,CAACE,GAAK9C,CAAK,KAAK,OAAO,QAAQ4C,CAAU;AAClD,MAAI5C,MAAU,UACZiC,EAAQ,aAAaa,GAAK9C,CAAK;AAKrC,MAAI6C;AACF,eAAWE,KAASF;AAClB,MAAI,OAAOE,KAAU,WACnBd,EAAQ,YAAY,SAAS,eAAec,CAAK,CAAC,IAElDd,EAAQ,YAAYc,CAAK;AAK/B,SAAOd;AACT;AAKO,SAASe,GACdf,GACAgB,GACAC,GACAjD,GACY;AACZ,SAAAgC,EAAQ,iBAAiBgB,GAAOC,GAA0BjD,CAAO,GAC1D,MAAMgC,EAAQ,oBAAoBgB,GAAOC,GAA0BjD,CAAO;AACnF;AAKO,SAASkD,GACdZ,GACAD,GACAW,GACAC,GACAjD,GACY;AACZ,QAAMmD,IAAmB,CAACC,MAAc;AACtC,UAAMC,IAAUD,EAAG,OAAuB,QAAQf,CAAQ;AAC1D,IAAIgB,KAAUf,EAAO,SAASe,CAAM,KAClCJ,EAAQ,KAAKI,GAAuBD,GAA8BC,CAAqB;AAAA,EAE3F;AAEA,SAAAf,EAAO,iBAAiBU,GAAOG,GAAkBnD,CAAO,GACjD,MAAMsC,EAAO,oBAAoBU,GAAOG,GAAkBnD,CAAO;AAC1E;AAKO,SAASsD,EAAQC,GAA4B;AAClD,EAAI,SAAS,eAAe,YAC1B,SAAS,iBAAiB,oBAAoBA,GAAU,EAAE,MAAM,IAAM,IAEtEA,EAAA;AAEJ;AAKO,SAASC,EAAKxB,GAAmC;AACtD,EAAKA,MACLA,EAAQ,UAAU,OAAO,UAAU,WAAW,GAC9CA,EAAQ,MAAM,UAAU;AAC1B;AAKO,SAASyB,EAAKzB,GAAmC;AACtD,EAAKA,KACLA,EAAQ,UAAU,IAAI,QAAQ;AAChC;AAKO,SAAS0B,GAAO1B,GAA6B2B,GAAyB;AAC3E,MAAI,CAAC3B,EAAS;AAEd,EADmB2B,KAAW3B,EAAQ,UAAU,SAAS,QAAQ,IAE/DwB,EAAKxB,CAAO,IAEZyB,EAAKzB,CAAO;AAEhB;AAKO,SAAS4B,GACd5B,GACA6B,GACA7D,GACM;AACN,EAAKgC,MAED6B,KACF7B,EAAQ,aAAa,aAAa,MAAM,GACxCA,EAAQ,UAAU,IAAI,cAAc,qBAAqB,IACrDA,aAAmB,qBAAqBA,aAAmB,sBAC7DA,EAAQ,WAAW,QAGrBA,EAAQ,gBAAgB,WAAW,GACnCA,EAAQ,UAAU,OAAO,cAAc,qBAAqB,IACxDA,aAAmB,qBAAqBA,aAAmB,sBAC7DA,EAAQ,WAAW;AAGzB;AAKO,SAAS8B,EACdjB,GACA9C,GACAuC,IAAqB,UACf;AACN,QAAMN,IAAUI,EAAG,eAAeS,CAAG,KAAKP,CAAM;AAChD,EAAIN,MACFA,EAAQ,cAAc,OAAOjC,CAAK;AAEtC;AAKO,SAASgE,GACdC,GACA1B,IAAqB,UACf;AACN,aAAW,CAACO,GAAK9C,CAAK,KAAK,OAAO,QAAQiE,CAAM;AAC9C,IAAAF,EAAejB,GAAK9C,GAAOuC,CAAM;AAErC;AAKO,SAAS2B,EACd5B,IAAW,qBACX6B,IAAa,qBACH;AACV,QAAMlC,IAAUI,EAAGC,CAAQ;AAC3B,MAAI,CAACL,EAAS,QAAO;AAGrB,QAAMmC,IAAYnC,EAAQ,aAAakC,CAAU;AACjD,MAAIC;AACF,QAAI;AACF,aAAO,KAAK,MAAMA,CAAS;AAAA,IAC7B,QAAQ;AACN,cAAQ,KAAK,+CAA+CA,CAAS;AAAA,IACvE;AAIF,QAAMC,IAAWhC;AAAA,IACf;AAAA,IACAJ;AAAA,EAAA;AAEF,MAAIoC,GAAU;AACZ,QAAI;AACF,aAAO,KAAK,MAAMA,EAAS,WAAW;AAAA,IACxC,QAAQ;AACN,cAAQ,KAAK,4CAA4CA,EAAS,WAAW;AAAA,IAC/E;AAGF,SAAO;AACT;AAKO,SAASC,EACdpF,GACAqF,IAAmC,UAC7B;AACN,QAAMC,IACJnC,EAAG,eAAekC,CAAQ,IAAI,MAC7B,MAAM;AACL,UAAME,IAAK/B,EAAc,OAAO;AAAA,MAC9B,aAAa6B;AAAA,MACb,eAAe;AAAA,MACf,OAAO;AAAA,IAAA,CACR;AACD,oBAAS,KAAK,YAAYE,CAAE,GACrBA;AAAA,EACT,GAAA;AAEF,EAAAD,EAAU,cAAc,IACxB,sBAAsB,MAAM;AAC1B,IAAAA,EAAU,cAActF;AAAA,EAC1B,CAAC;AACH;AChOA,eAAsBwF,GAAQzE,GAAiD;AAC7E,QAAM;AAAA,IACJ,IAAA0E;AAAA,IACA,OAAAC;AAAA,IACA,UAAAC,IAAW;AAAA,IACX,SAAAC,IAAU;AAAA,IACV,aAAAC,IAAc;AAAA,IACd,YAAAC;AAAA,IACA,QAAAC;AAAA,EAAA,IACEhF,GAEEiF,IAAY,KAAK,IAAA;AACvB,MAAIC,IAAW,GACXC;AAEJ,SAAOD,IAAWJ,KAAa;AAC7B,QAAIE,GAAQ;AACV,YAAM,IAAI,aAAa,mBAAmB,YAAY;AAIxD,QADoB,KAAK,IAAA,IAAQC,KACdJ;AACjB,aAAO;AAAA,QACL,QAAQM;AAAA,QACR,UAAAD;AAAA,QACA,SAAS;AAAA,QACT,UAAU;AAAA,MAAA;AAWd,QAPAA,KACAC,IAAa,MAAMT,EAAA,GAEfK,KACFA,EAAWI,GAAYD,CAAQ,GAG7BP,EAAMQ,CAAU;AAClB,aAAO;AAAA,QACL,QAAQA;AAAA,QACR,UAAAD;AAAA,QACA,SAAS;AAAA,QACT,UAAU;AAAA,MAAA;AAKd,UAAME,EAAMR,GAAUI,CAAM;AAAA,EAC9B;AAEA,SAAO;AAAA,IACL,QAAQG;AAAA,IACR,UAAAD;AAAA,IACA,SAAS;AAAA,IACT,UAAU;AAAA,EAAA;AAEd;AAwBA,eAAsBG,GAASrF,GAAsC;AACnE,QAAM;AAAA,IACJ,IAAA0E;AAAA,IACA,aAAAI,IAAc;AAAA,IACd,WAAAQ,IAAY;AAAA,IACZ,UAAAC,IAAW;AAAA,IACX,oBAAAC,IAAqB;AAAA,IACrB,aAAAC,IAAc,MAAM;AAAA,IACpB,SAAAC;AAAA,IACA,QAAAV;AAAA,EAAA,IACEhF;AAEJ,MAAI2F;AAEJ,WAASC,IAAU,GAAGA,KAAWd,GAAac,KAAW;AACvD,QAAIZ,GAAQ;AACV,YAAM,IAAI,aAAa,iBAAiB,YAAY;AAGtD,QAAI;AACF,aAAO,MAAMN,EAAA;AAAA,IACf,SAAS5F,GAAO;AAGd,UAFA6G,IAAY7G,GAER8G,KAAWd,KAAe,CAACW,EAAY3G,GAAO8G,CAAO;AACvD,cAAM9G;AAGR,YAAM+G,IAAQL,IACV,KAAK,IAAIF,IAAY,KAAK,IAAI,GAAGM,IAAU,CAAC,GAAGL,CAAQ,IACvDD;AAEJ,MAAII,KACFA,EAAQ5G,GAAO8G,GAASC,CAAK,GAG/B,MAAMT,EAAMS,GAAOb,CAAM;AAAA,IAC3B;AAAA,EACF;AAEA,QAAMW;AACR;AAKO,SAASP,EAAMU,GAAYd,GAAqC;AACrE,SAAO,IAAI,QAAQ,CAACe,GAASC,MAAW;AACtC,QAAIhB,GAAQ,SAAS;AACnB,MAAAgB,EAAO,IAAI,aAAa,iBAAiB,YAAY,CAAC;AACtD;AAAA,IACF;AAEA,UAAMC,IAAY,WAAWF,GAASD,CAAE;AAExC,QAAId,GAAQ;AACV,YAAMkB,IAAe,MAAM;AACzB,qBAAaD,CAAS,GACtBD,EAAO,IAAI,aAAa,iBAAiB,YAAY,CAAC;AAAA,MACxD;AACA,MAAAhB,EAAO,iBAAiB,SAASkB,GAAc,EAAE,MAAM,IAAM;AAAA,IAC/D;AAAA,EACF,CAAC;AACH;AAKO,SAASC,EACdzB,GACAmB,GACkC;AAClC,MAAII,IAAkD;AAEtD,SAAO,IAAIG,MAAwB;AACjC,IAAIH,KACF,aAAaA,CAAS,GAExBA,IAAY,WAAW,MAAM;AAC3B,MAAAvB,EAAG,GAAG0B,CAAI,GACVH,IAAY;AAAA,IACd,GAAGJ,CAAK;AAAA,EACV;AACF;AAKO,SAASQ,GACd3B,GACAmB,GACkC;AAClC,MAAIS,IAAW,GACXL,IAAkD;AAEtD,SAAO,IAAIG,MAAwB;AACjC,UAAM9F,IAAM,KAAK,IAAA;AAEjB,IAAIA,IAAMgG,KAAYT,KACpBS,IAAWhG,GACXoE,EAAG,GAAG0B,CAAI,KACAH,MACVA,IAAY;AAAA,MACV,MAAM;AACJ,QAAAK,IAAW,KAAK,IAAA,GAChBL,IAAY,MACZvB,EAAG,GAAG0B,CAAI;AAAA,MACZ;AAAA,MACAP,KAASvF,IAAMgG;AAAA,IAAA;AAAA,EAGrB;AACF;AAKO,SAASC,GACdC,GACsD;AACtD,QAAMC,IAAa,IAAI,gBAAA,GACjBR,IAAY,WAAW,MAAMQ,EAAW,MAAA,GAASD,CAAS;AAEhE,SAAO;AAAA,IACL,YAAAC;AAAA,IACA,SAAS,MAAM,aAAaR,CAAS;AAAA,EAAA;AAEzC;AAKA,eAAsBS,GACpBC,GACAH,GACAI,IAAe,uBACH;AACZ,MAAIX;AAEJ,QAAMY,IAAiB,IAAI,QAAe,CAACC,GAAGd,MAAW;AACvD,IAAAC,IAAY,WAAW,MAAM;AAC3B,MAAAD,EAAO,IAAI,MAAMY,CAAY,CAAC;AAAA,IAChC,GAAGJ,CAAS;AAAA,EACd,CAAC;AAED,MAAI;AACF,WAAO,MAAM,QAAQ,KAAK,CAACG,GAASE,CAAc,CAAC;AAAA,EACrD,UAAA;AACE,iBAAaZ,CAAU;AAAA,EACzB;AACF;ACrPO,MAAMc,EAAsB;AAAA,EAIjC,YAAYnJ,GAA2B;AACrC,SAAK,SAASA,GACd,KAAK,SAAS2B,EAAkB;AAAA,MAC9B,UAAU3B,EAAO;AAAA,MACjB,aAAaA,EAAO;AAAA,IAAA,CACrB;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAsB;AAC1B,QAAI;AACF,YAAM,KAAK,UAAA;AAAA,IACb,SAASoJ,GAAK;AACZ,cAAQ,MAAM,oCAAoCA,CAAG;AAAA,IACvD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YAA2B;AACvC,UAAMC,IAAQ,MAAM,KAAK,OAAO,kBAAA;AAEhC,IAAAnD,EAAe,iBAAiBmD,EAAM,KAAK,GAC3CnD,EAAe,mBAAmBmD,EAAM,OAAO,GAC/CnD,EAAe,qBAAqBmD,EAAM,SAAS,GACnDnD,EAAe,2BAA2BmD,EAAM,eAAe,GAG/D,KAAK,kBAAkB,SAASA,EAAM,KAAK,GAC3C,KAAK,kBAAkB,WAAWA,EAAM,OAAO,GAC/C,KAAK,kBAAkB,aAAaA,EAAM,SAAS,GACnD,KAAK,kBAAkB,mBAAmBA,EAAM,eAAe;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkBpE,GAAa9C,GAAqB;AAC1D,UAAMyE,IAAK,SAAS,cAAc,sBAAsB3B,CAAG,IAAI;AAC/D,IAAI2B,MACFA,EAAG,cAAc,OAAOzE,CAAK;AAAA,EAEjC;AACF;AAKO,SAASmH,GAAgBtJ,GAAmD;AACjF,QAAMuJ,IAAavJ,KAAUqG,EAAiC,6BAA6B;AAE3F,MAAI,CAACkD;AACH,UAAM,IAAI,MAAM,2EAA2E;AAG7F,QAAMV,IAAa,IAAIM,EAAsBI,CAAU;AACvD,SAAA7D,EAAQ,MAAMmD,EAAW,MAAM,GACxBA;AACT;AAKO,SAASW,GAAqBC,GAAkBC,GAA4B;AACjF,QAAM1J,IAA4B;AAAA,IAChC,UAAAyJ;AAAA,IACA,aAAaC,KAAe,GAAGD,CAAQ;AAAA,EAAA,GAGnCZ,IAAa,IAAIM,EAAsBnJ,CAAM;AACnD,EAAA0F,EAAQ,MAAMmD,EAAW,MAAM;AACjC;AAGI,OAAO,WAAa,OACtBnD,EAAQ,MAAM;AACZ,QAAMiE,IAAS,SAAS,cAAc,6BAA6B;AACnE,MAAIA,GAAQ;AACV,UAAMrD,IAAaqD,EAAO,aAAa,mBAAmB;AAC1D,QAAIrD;AACF,UAAI;AACF,cAAMtG,IAAS,KAAK,MAAMsG,CAAU;AAEpC,QADmB,IAAI6C,EAAsBnJ,CAAM,EACxC,KAAA;AAAA,MACb,SAAS4J,GAAG;AACV,gBAAQ,KAAK,wCAAwCA,CAAC;AAAA,MACxD;AAAA,EAEJ;AACF,CAAC;AC/EI,MAAMC,EAA6B;AAAA,EAUxC,YAAY7J,GAA8B;AAR1C,SAAQ,QAAuB;AAAA,MAC7B,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,cAAc;AAAA,MACd,YAAY;AAAA,MACZ,YAAY;AAAA,IAAA,GAIZ,KAAK,SAASA;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAsB;AAC1B,UAAM,KAAK,cAAA;AAAA,EACb;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,gBAA+B;AACnC,QAAI,MAAK,MAAM,SAEf;AAAA,WAAK,MAAM,UAAU,IACrB,KAAK,kBAAkB,SAAS;AAEhC,UAAI;AACF,cAAMO,IAAW,MAAM;AAAA,UACrB,GAAG,KAAK,OAAO,WAAW,WAAW,KAAK,OAAO,KAAK;AAAA,UACtD;AAAA,YACE,QAAQ;AAAA,YACR,SAAS,EAAE,QAAQ,mBAAA;AAAA,UAAmB;AAAA,QACxC;AAGF,YAAI,CAACA,EAAS;AACZ,gBAAM,IAAI,MAAM,0BAA0B;AAI5C,cAAMuJ,KADU,MAAMvJ,EAAS,KAAA,IACP,UAAU,CAAA,GAC5BwJ,IAAY,KAAK,iBAAiBD,CAAM;AAE9C,QAAIC,KACF,KAAK,MAAM,eAAe,IAC1B,KAAK,iBAAiBA,CAAS,GAC/B,KAAK,kBAAkB,WAAW,KACzB,KAAK,OAAO,sBAErB,KAAK,kBAAkB,YAAY,GAE/B,KAAK,MAAM,aAAa,KAAK,MAAM,eACrC,KAAK,MAAM,cACX,WAAW,MAAM,KAAK,cAAA,GAAiB,GAAI,MAI7C,KAAK,kBAAkB,YAAY,GAGrC,KAAK,MAAM,SAAS;AAAA,MACtB,SAAS7I,GAAO;AACd,gBAAQ,MAAM,wBAAwBA,CAAK,GAGvC,KAAK,OAAO,uBACd,KAAK,kBAAkB,UAAU,IAEjC,KAAK,kBAAkB,aAAa;AAAA,MAExC,UAAA;AACE,aAAK,MAAM,UAAU;AAAA,MACvB;AAAA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,iBACN4I,GACqB;AACrB,UAAMC,IAA0B;AAAA,MAC9B,UAAUD,EAAO,gBAAgB;AAAA,MACjC,QAAQA,EAAO,cAAc;AAAA,MAC7B,aAAaA,EAAO,mBAAmB;AAAA,IAAA;AASzC,WANe,CAAC,EACdC,EAAU,YACVA,EAAU,UACVA,EAAU,eAGIA,IAAY;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkBC,GAAqB;AAE7C,IADe,CAAC,WAAW,cAAc,aAAa,eAAe,UAAU,EACxE,QAAQ,CAACC,MAAM;AACpB,YAAMrD,IAAKpC,EAAG,cAAcyF,CAAC,EAAE;AAC/B,MAAIrD,MACEqD,MAAMD,IACRpE,EAAKgB,CAAiB,IAEtBf,EAAKe,CAAiB;AAAA,IAG5B,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiBmD,GAA+B;AACtD,QAAIA,EAAU,UAAU;AACtB,YAAM7F,IAAYM,EAAG,oBAAoB,GACnC0F,IAAO1F,EAAsB,yBAAyB;AAC5D,MAAIN,KAAagG,MACfA,EAAK,OAAO,IAAI,IAAIH,EAAU,UAAU,OAAO,SAAS,MAAM,EAAE,SAAA,GAChEnE,EAAK1B,CAAwB;AAAA,IAEjC;AAEA,QAAI6F,EAAU,QAAQ;AACpB,YAAM7F,IAAYM,EAAG,kBAAkB,GACjC0F,IAAO1F,EAAsB,uBAAuB;AAC1D,MAAIN,KAAagG,MACfA,EAAK,OAAO,IAAI,IAAIH,EAAU,QAAQ,OAAO,SAAS,MAAM,EAAE,SAAA,GAC9DnE,EAAK1B,CAAwB;AAAA,IAEjC;AAEA,QAAI6F,EAAU,aAAa;AACzB,YAAM7F,IAAYM,EAAG,uBAAuB,GACtC0F,IAAO1F,EAAsB,4BAA4B;AAC/D,MAAIN,KAAagG,MACfA,EAAK,OAAO,IAAI,IAAIH,EAAU,aAAa,OAAO,SAAS,MAAM,EAAE,SAAA,GACnEnE,EAAK1B,CAAwB;AAAA,IAEjC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAA0B;AACxB,WAAO,EAAE,GAAG,KAAK,MAAA;AAAA,EACnB;AACF;AAKO,SAASiG,GACdnK,GAC8B;AAC9B,QAAM6I,IAAa,IAAIgB,EAA6B7J,CAAM;AAC1D,SAAA0F,EAAQ,MAAMmD,EAAW,MAAM,GACxBA;AACT;AAKO,SAASuB,GAA4BpK,GAAoC;AAC9E,QAAM6I,IAAa,IAAIgB,EAA6B7J,CAAM;AAC1D,EAAA0F,EAAQ,MAAMmD,EAAW,MAAM,GAG3B,OAAO,SAAW,QACnB,OAA8C,4BAA4BA,GAC1E,OAA8C,gBAAgB,MAAMA,EAAW,cAAA;AAEpF;AC5MO,SAASwB,EAAmB3F,IAAqB,UAAgB;AACtE,EAAAC,EAAiB,qBAAqBD,CAAM,EAAE,QAAQ,CAACkC,MAAO;AAC5D,UAAM/E,IAAQ+E,EAAG,aAAa,iBAAiB;AAC/C,IAAI/E,MACF+E,EAAG,cAAchF,EAAeC,CAAK;AAAA,EAEzC,CAAC;AACH;AAKO,SAASyI,EAAwB5F,IAAqB,UAAgB;AAC3E,EAAAC,EAAiB,oBAAoBD,CAAM,EAAE,QAAQ,CAACkC,MAAO;AAC3D,UAAM2D,IAAK3D,EAAG,aAAa,gBAAgB;AAC3C,IAAI2D,MACF3D,EAAG,cAAc1E,EAAeqI,CAAE;AAAA,EAEtC,CAAC;AACH;AAKO,SAASC,EAAsB9F,IAAqB,UAAgB;AACzE,EAAA2F,EAAmB3F,CAAM,GACzB4F,EAAwB5F,CAAM;AAChC;AAKO,SAAS+F,IAA6B;AAC3C,EAAA/E,EAAQ,MAAM;AACZ,IAAA8E,EAAA;AAAA,EACF,CAAC;AACH;AAGI,OAAO,WAAa,OACtBC,EAAA;ACjCF,MAAMC,IAAyC;AAAA,EAC7C,eAAe;AAAA,EACf,iBAAiB;AAAA,EACjB,qBAAqB;AAAA,EACrB,2BAA2B;AAAA,EAC3B,eAAe;AAAA,EACf,cAAc;AAAA,EACd,yBAAyB;AAAA,EACzB,SAAS;AACX;AAMO,MAAMC,EAAyB;AAAA,EAWpC,YAAY3K,GAA8B;AACxC,SAAK,SAASA,GACd,KAAK,WAAW;AAAA,MACd,cAAcwE,EAAG,gBAAgB;AAAA,MACjC,cAAcA,EAAG,gBAAgB;AAAA,MACjC,YAAYA,EAAG,cAAc;AAAA,MAC7B,cAAcA,EAAG,gBAAgB;AAAA,MACjC,aAAaA,EAAG,eAAe;AAAA,MAC/B,UAAUA,EAAG,YAAY;AAAA,IAAA;AAAA,EAE7B;AAAA;AAAA;AAAA;AAAA,EAKA,OAAa;AACX,SAAK,oBAAA,GACL,KAAK,gBAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAA4B;AAClC,UAAM,EAAE,UAAAoG,MAAa,KAAK;AAE1B,IAAIA,KACFA,EAAS,iBAAiB,SAAS,MAAM,KAAK,aAAa;AAAA,EAE/D;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAwB;AAC9B,UAAM3K,IAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,GACnDmB,IAAOnB,EAAO,IAAI,MAAM,GACxBiB,IAAQjB,EAAO,IAAI,OAAO,GAC1B4K,IAAmB5K,EAAO,IAAI,mBAAmB,GACjD+J,IAAQ/J,EAAO,IAAI,OAAO,GAG1B6K,IAAY,KAAK,gBAAgBd,CAAK;AAG5C,IAAKc,EAAU,eACbA,EAAU,cAAc7K,EAAO,IAAI,YAAY,KAAK,IAAI,KAAA,IAGtDiB,IACF,KAAK,YAAYA,GAAO2J,GAAkBC,CAAS,IAC1C1J,IACT,KAAK,cAAcA,GAAM0J,CAAS,IAElC,KAAK,YAAY,WAAW,mDAAmDA,CAAS;AAAA,EAE5F;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgBC,GAA2C;AACjE,UAAMC,IAA2B;AAAA,MAC/B,SAAS;AAAA,MACT,YAAY;AAAA,IAAA;AAGd,QAAI,CAACD;AACH,aAAOC;AAGT,QAAI;AACF,YAAMC,IAAS,KAAK,MAAMF,CAAQ;AAClC,UAAIE,KAAU,OAAOA,KAAW;AAC9B,eAAI,OAAOA,EAAO,WAAY,aAC5BD,EAAO,UAAUC,EAAO,QAAQ,KAAA,IAE9B,OAAOA,EAAO,cAAe,aAC/BD,EAAO,aAAaC,EAAO,WAAW,KAAA,IAEjCD;AAAA,IAEX,QAAQ;AAAA,IAER;AAGA,WAAAA,EAAO,UAAU,OAAOD,KAAY,EAAE,EAAE,KAAA,GACjCC;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAUhB,GAA4B;AAC5C,UAAM,EAAE,cAAAkB,GAAc,cAAAC,GAAc,YAAAC,EAAA,IAAe,KAAK;AAMxD,YAJAvF,EAAKqF,CAAY,GACjBrF,EAAKsF,CAAY,GACjBtF,EAAKuF,CAAU,GAEPpB,GAAA;AAAA,MACN,KAAK;AACH,QAAApE,EAAKsF,CAAY;AACjB;AAAA,MACF,KAAK;AACH,QAAAtF,EAAKuF,CAAY;AACjB;AAAA,MACF,KAAK;AACH,QAAAvF,EAAKwF,CAAU;AACf;AAAA,IAAA;AAAA,EAEN;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAaC,GAAqC;AACxD,IAAI,OAAO,UAAU,CAAC,OAAO,OAAO,UAClC,OAAO,OAAO,YAAYA,GAAM,OAAO,SAAS,MAAM;AAAA,EAE1D;AAAA;AAAA;AAAA;AAAA,EAKQ,YACNnK,GACAoK,GACAR,GACM;AACN,SAAK,UAAU,OAAO;AAEtB,UAAM,EAAE,cAAA9B,GAAc,aAAAuC,GAAa,UAAAX,EAAA,IAAa,KAAK;AAErD,IAAI5B,MACFA,EAAa,cAAc0B,EAAexJ,CAAK,KAAKwJ,EAAe,UAGjEY,KAAeC,MACjBA,EAAY,cAAcD,GAC1B1F,EAAK2F,CAAW,IAIlB,KAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,OAAArK;AAAA,MACA,mBAAmBoK,KAAe;AAAA,MAClC,YAAYR,EAAU,cAAc;AAAA,IAAA,CACrC,GAGD,KAAK,iBAAiBA,CAAS;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAc1J,GAAc0J,GAAmC;AACrE,SAAK,UAAU,SAAS,GAGxB,KAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,MAAA1J;AAAA,MACA,YAAY0J,EAAU,cAAc;AAAA,IAAA,CACrC,GAGD,WAAW,MAAM;AACf,aAAO,MAAA;AAAA,IACT,GAAG,GAAI,GAGP,KAAK,iBAAiBA,CAAS;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiBA,GAAmC;AAC1D,UAAM,EAAE,UAAAF,MAAa,KAAK;AAE1B,IAAI,CAAC,OAAO,UAAUA,MACpBA,EAAS,cAAc;AAAA,EAE3B;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAoB;AAC1B,QAAI,OAAO;AACT,aAAO,MAAA;AAAA,SACF;AAEL,YAAMnB,IAAW,KAAK,OAAO,YAAY,UACnC+B,IACJ,KAAK,OAAO,wBAAwB,GAAG/B,CAAQ,8BAE3CgC,IAAc,IAAI,IAAID,GAAc,OAAO,SAAS,MAAM,GAG1DvL,IAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,GACnD+J,IAAQ/J,EAAO,IAAI,OAAO,GAE1ByL,IADY,KAAK,gBAAgB1B,CAAK,EAChB,cAAc/J,EAAO,IAAI,YAAY;AAEjE,MAAIyL,KACFD,EAAY,aAAa,IAAI,cAAcC,CAAS,GAGtD,OAAO,SAAS,OAAOD,EAAY,SAAA;AAAA,IACrC;AAAA,EACF;AACF;AAKO,SAASE,GAAmB3L,GAAyD;AAC1F,QAAMuJ,IAAavJ,KAAU;AAAA,IAC3B,UAAU;AAAA,IACV,aAAa;AAAA,EAAA,GAGT6I,IAAa,IAAI8B,EAAyBpB,CAAU;AAC1D,SAAA7D,EAAQ,MAAMmD,EAAW,MAAM,GACxBA;AACT;AAKO,SAAS+C,GAAwBnC,GAAwB;AAC9D,QAAMzJ,IAA+B;AAAA,IACnC,UAAAyJ;AAAA,IACA,aAAa,GAAGA,CAAQ;AAAA,EAAA,GAGpBZ,IAAa,IAAI8B,EAAyB3K,CAAM;AACtD,EAAA0F,EAAQ,MAAMmD,EAAW,MAAM;AACjC;AChRA,MAAMgD,IAA6B,2BAE7BC,KAA6E;AAAA,EACjF,kDAAkD;AAAA,IAChD,OAAO;AAAA,IACP,aAAa;AAAA,EAAA;AAAA,EAEf,QAAQ;AAAA,IACN,OAAO;AAAA,IACP,aAAa;AAAA,EAAA;AAAA,EAEf,kDAAkD;AAAA,IAChD,OAAO;AAAA,IACP,aAAa;AAAA,EAAA;AAAA,EAEf,8CAA8C;AAAA,IAC5C,OAAO;AAAA,IACP,aAAa;AAAA,EAAA;AAAA,EAEf,kBAAkB;AAAA,IAChB,OAAO;AAAA,IACP,aAAa;AAAA,EAAA;AAAA,EAEf,kBAAkB;AAAA,IAChB,OAAO;AAAA,IACP,aAAa;AAAA,EAAA;AAAA,EAEf,cAAc;AAAA,IACZ,OAAO;AAAA,IACP,aAAa;AAAA,EAAA;AAEjB;AAMO,MAAMC,EAA4B;AAAA,EAwCvC,YAAY/L,GAAqC;AApCjD,SAAQ,cAA6B,MACrC,KAAQ,eAAqD,MAC7D,KAAQ,wBAAwB,IAChC,KAAQ,iBAAyD,MAkC/D,KAAK,SAASA,GACd,KAAK,UAAUA,EAAO,eAAe,GAAGA,EAAO,QAAQ,QACvD,KAAK,mBAAmB,KAAK,wBAAA,GAE7B,KAAK,WAAW;AAAA,MACd,cAAcwE,EAAG,gBAAgB;AAAA,MACjC,mBAAmBA,EAAG,qBAAqB;AAAA,MAC3C,gBAAgBA,EAAG,kBAAkB;AAAA,MACrC,YAAYA,EAAG,cAAc;AAAA,MAC7B,aAAaA,EAAG,eAAe;AAAA,MAC/B,eAAeA,EAAG,4BAA4B;AAAA,MAC9C,gBAAgBA,EAAqB,mBAAmB;AAAA,MACxD,YAAYA,EAAG,cAAc;AAAA,MAC7B,eAAeA,EAAG,iBAAiB;AAAA,MACnC,YAAYA,EAAG,qBAAqB;AAAA,MACpC,UAAUA,EAAG,YAAY;AAAA,MACzB,WAAWA,EAAG,aAAa;AAAA,MAC3B,YAAYA,EAAG,cAAc;AAAA,MAC7B,gBAAgBA,EAAG,mBAAmB;AAAA,MACtC,iBAAiBA,EAAG,mBAAmB;AAAA,MACvC,qBAAqBA,EAAG,wBAAwB;AAAA,MAChD,sBAAsBA,EAAG,yBAAyB;AAAA,MAClD,gBAAgBA,EAAG,kBAAkB;AAAA,MACrC,oBAAoBA,EAAG,uBAAuB;AAAA,MAC9C,YAAYA,EAAG,cAAc;AAAA,MAC7B,YAAYA,EAAG,cAAc;AAAA,MAC7B,eAAeA,EAAG,iBAAiB;AAAA,MACnC,cAAcA,EAAG,gBAAgB;AAAA,MACjC,cAAcA,EAAG,gBAAgB;AAAA,MACjC,iBAAiBA,EAAG,mBAAmB;AAAA,MACvC,gBAAgBA,EAAG,kBAAkB;AAAA,MACrC,iBAAiBA,EAAsB,oBAAoB;AAAA,MAC3D,yBAAyBA,EAAsB,4BAA4B;AAAA,IAAA;AAAA,EAE/E;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAsB;AAC1B,SAAK,oBAAA,GACL,KAAK,qBAAA,GACL,MAAM,KAAK,YAAA;AAAA,EACb;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAA4B;AAClC,UAAM;AAAA,MACJ,YAAAwH;AAAA,MACA,eAAAC;AAAA,MACA,YAAAC;AAAA,MACA,UAAAC;AAAA,MACA,WAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,qBAAAC;AAAA,MACA,sBAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,YAAAC;AAAA,MACA,iBAAAC;AAAA,IAAA,IACE,KAAK;AAGT,IAAIV,KACFA,EAAW,iBAAiB,SAAS,MAAM,KAAK,gBAAgB,GAI9DI,KACFA,EAAU,iBAAiB,SAAS,MAAM,KAAK,gBAAgB,GAI7DH,KACFA,EAAc,iBAAiB,SAAS,MAAM;AAC5C,MAAIS,KACF9G,EAAK8G,CAAe;AAAA,IAExB,CAAC,GAICJ,KACFA,EAAoB,iBAAiB,SAAS,MAAM;AAClD,MAAII,KACF7G,EAAK6G,CAAe;AAAA,IAExB,CAAC,GAGCH,KACFA,EAAqB,iBAAiB,SAAS,MAAM,KAAK,YAAY,GAIpEF,KACFA,EAAe,iBAAiB,SAAS,MAAM,KAAK,iBAAiB,GAInEH,KACFA,EAAW,iBAAiB,SAAS,MAAM,KAAK,aAAa,GAG3DC,KACFA,EAAS,iBAAiB,SAAS,MAAM,KAAK,aAAa,GAIzDK,MACFA,EAAe,iBAAiB,UAAU,MAAM;AAC9C,WAAK,oBAAoBA,EAAe,OAAO,EAAI;AAAA,IACrD,CAAC,GAEDA,EAAe,iBAAiB,WAAW,CAACpH,MAAU;AACpD,MAAIA,EAAM,QAAQ,YAChBA,EAAM,eAAA,GACN,KAAK,oBAAoBoH,EAAe,OAAO,EAAI;AAAA,IAEvD,CAAC,IAIH,SAAS,iBAAiB,WAAW,CAAC5C,MAAM;AAC1C,MAAIA,EAAE,QAAQ,aACR6C,KAAc,CAACA,EAAW,UAAU,SAAS,QAAQ,KACvD,KAAK,gBAAA,GAEHC,KAAmB,CAACA,EAAgB,UAAU,SAAS,QAAQ,KACjE7G,EAAK6G,CAAe;AAAA,IAG1B,CAAC,GAGD,CAACD,GAAYC,CAAe,EAAE,QAAQ,CAACC,MAAU;AAC/C,MAAIA,KACFA,EAAM,iBAAiB,SAAS,CAAC/C,MAAM;AACrC,cAAMnE,IAASmE,EAAE;AACjB,SAAInE,MAAWkH,KAASlH,EAAO,aAAa,aAAa,MAAM,YAC7DI,EAAK8G,CAAK,GACNA,MAAUF,KACZ,KAAK,gBAAA;AAAA,MAGX,CAAC;AAAA,IAEL,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAAkC;AAExC,UAAMxM,IAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,GACnD2M,IAAY,KAAK,mBAAmB3M,EAAO,IAAI,YAAY,CAAC;AAClE,QAAI2M;AACF,aAAOA;AAIT,UAAMC,IAAe,KAAK,mBAAmB,KAAK,OAAO,eAAe;AACxE,QAAIA;AACF,aAAOA;AAIT,QAAI;AACF,aAAO,KAAK;AAAA,QACV,OAAO,aAAa,QAAQhB,CAA0B;AAAA,MAAA;AAAA,IAE1D,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB1J,GAA0C;AACnE,YAAQA,KAAS,IAAI,KAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoBA,GAAe2K,IAAgB,IAAa;AACtE,UAAMC,IAAa,KAAK,mBAAmB5K,CAAK;AAChD,QAAI4K,MAAe,KAAK,kBAAkB;AACxC,WAAK,qBAAA;AACL;AAAA,IACF;AAEA,SAAK,mBAAmBA,GACxB,KAAK,qBAAA,GAEDD,KACF,KAAK,YAAA;AAAA,EAET;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAA6B;AACnC,UAAM,EAAE,gBAAAN,GAAgB,oBAAAQ,GAAoB,iBAAAC,GAAiB,yBAAAC,EAAA,IAC3D,KAAK;AAGP,IAAIV,MACFA,EAAe,QAAQ,KAAK,mBAI1BQ,MACFA,EAAmB,cAAc,KAAK,mBAClC,eAAe,KAAK,gBAAgB,KACpC,wBAIN,KAAK,iBAAA,GAGL,KAAK,mBAAA,GAGL,KAAK,kBAAkB,CAACC,GAAiBC,CAAuB,CAAC;AAAA,EACnE;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAyB;AAC/B,QAAI;AACF,MAAI,KAAK,mBACP,OAAO,aAAa,QAAQrB,GAA4B,KAAK,gBAAgB,IAE7E,OAAO,aAAa,WAAWA,CAA0B;AAAA,IAE7D,QAAQ;AAAA,IAER;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAA2B;AACjC,UAAMsB,IAAM,IAAI,IAAI,OAAO,SAAS,IAAI;AACxC,IAAI,KAAK,mBACPA,EAAI,aAAa,IAAI,cAAc,KAAK,gBAAgB,IAExDA,EAAI,aAAa,OAAO,YAAY,GAEtC,OAAO,QAAQ,aAAa,CAAA,GAAI,IAAIA,EAAI,UAAU;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkBC,GAA2C;AACnE,IAAAA,EAAM,QAAQ,CAAClD,MAAS;AACtB,UAAI,CAACA,EAAM;AACX,YAAMmD,IAAWnD,EAAK,QAAQ,YAAYA,EAAK,aAAa,MAAM;AAClE,MAAKmD,KACLnD,EAAK,aAAa,QAAQ,KAAK,qBAAqBmD,CAAQ,CAAC;AAAA,IAC/D,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqBC,GAA2B;AACtD,UAAMrC,IAAS,IAAI,IAAIqC,GAAW,OAAO,SAAS,MAAM;AACxD,WAAI,KAAK,mBACPrC,EAAO,aAAa,IAAI,cAAc,KAAK,gBAAgB,IAE3DA,EAAO,aAAa,OAAO,YAAY,GAElC,GAAGA,EAAO,QAAQ,GAAGA,EAAO,MAAM,GAAGA,EAAO,IAAI;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkBjK,GAAc0K,IAAY,KAAK,kBAA0B;AACjF,UAAMyB,IAAM,IAAI,IAAI,GAAG,KAAK,OAAO,GAAGnM,CAAI,IAAI,OAAO,SAAS,MAAM;AACpE,WAAAmM,EAAI,aAAa,IAAI,WAAW,KAAK,OAAO,UAAU,EAAE,GACpDzB,KACFyB,EAAI,aAAa,IAAI,cAAczB,CAAS,GAEvCyB,EAAI,SAAA;AAAA,EACb;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAS9L,GAAuB;AACtC,UAAM,EAAE,eAAAkM,MAAkB,KAAK;AAC/B,IAAIA,MACFA,EAAc,cAAclM,IAE9BoF,EAASpF,CAAO;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAU2I,GAA+B;AAC/C,UAAM,EAAE,cAAAkB,GAAc,mBAAAsC,GAAmB,gBAAAC,GAAgB,YAAArC,EAAA,IAAe,KAAK;AAO7E,YALAvF,EAAKqF,CAAY,GACjBrF,EAAK2H,CAAiB,GACtB3H,EAAK4H,CAAc,GACnB5H,EAAKuF,CAAU,GAEPpB,GAAA;AAAA,MACN,KAAK;AACH,QAAApE,EAAKsF,CAAY;AACjB;AAAA,MACF,KAAK;AACH,QAAAtF,EAAK4H,CAAiB;AACtB;AAAA,MACF,KAAK;AACH,QAAA5H,EAAK6H,CAAc;AACnB;AAAA,MACF,KAAK;AACH,QAAA7H,EAAKwF,CAAU;AACf;AAAA,IAAA;AAAA,EAEN;AAAA;AAAA;AAAA;AAAA,EAKQ,kBACNsC,GACAC,IAAW,IACXC,IAAW,IACL;AACN,UAAM,EAAE,aAAAC,MAAgB,KAAK;AAC7B,QAAKA,GAEL;AAAA,UAAID,GAAU;AACZ,QAAAC,EAAY,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAMxB;AAAA,MACF;AAEA,MAAIH,IACEC,IACFE,EAAY,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,YAOxBA,EAAY,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,YAQ1BA,EAAY,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAO5B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAA6B;AACjC,SAAK,UAAU,SAAS;AAExB,QAAI;AACF,YAAMtN,IAAW,MAAM;AAAA,QACrB,KAAK,kBAAkB,mCAAmC;AAAA,QAC1D;AAAA,UACE,aAAa;AAAA,UACb,SAAS,EAAE,QAAQ,mBAAA;AAAA,QAAmB;AAAA,MACxC;AAGF,UAAI,CAACA,EAAS,IAAI;AAChB,YAAIA,EAAS,WAAW,KAAK;AAE3B,eAAK,UAAU,cAAc,GAC7B,KAAK,kBAAkB,EAAK,GAC5B,KAAK,SAAS,+BAA+B;AAC7C;AAAA,QACF;AAEA,YAAIc,IAAU,2BAA2Bd,EAAS,MAAM;AACxD,YAAI;AACF,gBAAMuN,IAAY,MAAMvN,EAAS,KAAA;AACjC,UAAIuN,GAAW,OAAO,YACpBzM,IAAUyM,EAAU,MAAM;AAAA,QAE9B,QAAQ;AAAA,QAER;AACA,cAAM,IAAI,MAAMzM,CAAO;AAAA,MACzB;AAEA,YAAMgK,IAAO,MAAM9K,EAAS,KAAA,GACtBwN,IAAc,KAAK,4BAA4B1C,EAAK,eAAe,CAAA,CAAE;AAG3E,MAAI,CAAC,KAAK,oBAAoB0C,EAAY,eACxC,KAAK,mBAAmBA,EAAY,YACpC,KAAK,qBAAA;AAIP,YAAMC,IAAaD,EAAY,aAAa;AAC5C,WAAK,oBAAoBC,GAAYD,EAAY,eAAe,GAE5DA,EAAY,aACd,KAAK,qBAAqBA,CAAW,GACrC,KAAK,UAAU,WAAW,GAC1B,KAAK,kBAAkB,IAAMA,EAAY,uBAAuBC,CAAU,GAC1E,KAAK;AAAA,QACHA,IACI,yDACA;AAAA,MAAA,MAGN,KAAK,UAAU,cAAc,GAC7B,KAAK,kBAAkB,IAAO,IAAOA,CAAU,GAC/C,KAAK;AAAA,QACHA,IACI,yCACA;AAAA,MAAA;AAAA,IAGV,SAAS9M,GAAO;AACd,cAAQ,MAAM,0BAA0BA,CAAK;AAC7C,YAAM,EAAE,cAAA8H,MAAiB,KAAK;AAC9B,MAAIA,MACFA,EAAa,cACX9H,aAAiB,QACbA,EAAM,UACN,6DAER,KAAK,UAAU,OAAO,GACtB,KAAK,oBAAoB,IAAO,EAAE,GAClC,KAAK,kBAAkB,EAAK,GAC5B,KAAK,SAAS,oCAAoC;AAAA,IACpD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,4BACN+M,GACyB;AACzB,UAAMC,IAAe,CAAIC,GAAgBC,MAAmB;AAC1D,iBAAWnJ,KAAOkJ;AAChB,YAAI,OAAO,UAAU,eAAe,KAAKF,GAAKhJ,CAAG,KAAKgJ,EAAIhJ,CAAG,MAAM,UAAagJ,EAAIhJ,CAAG,MAAM;AAC3F,iBAAOgJ,EAAIhJ,CAAG;AAGlB,aAAOmJ;AAAA,IACT,GAEMC,IAAYH,EAAqB,CAAC,cAAc,WAAW,GAAG,EAAE,GAChEI,IAASJ,EAAuB,CAAC,UAAU,QAAQ,GAAG,CAAA,CAAE,GACxDxC,IAAY,KAAK;AAAA,MACrBwC,EAAqB,CAAC,cAAc,WAAW,GAAG,EAAE;AAAA,IAAA,GAEhDR,IAAYQ,EAAsB,CAAC,aAAa,WAAW,GAAG,EAAK,GACnEN,IAAWM,EAAsB,CAAC,YAAY,UAAU,GAAG,EAAK,GAChEK,IAAiBL,EAAqB,CAAC,mBAAmB,gBAAgB,GAAG,EAAE,GAC/EM,IAAQN;AAAA,MACZ,CAAC,SAAS,cAAc,iBAAiB,cAAc;AAAA,MACvD;AAAA,IAAA,GAEIO,IAAiBP;AAAA,MACrB,CAAC,oBAAoB,gBAAgB;AAAA,MACrC;AAAA,IAAA,GAEIQ,IAAsBR;AAAA,MAC1B,CAAC,yBAAyB,wBAAwB,aAAa;AAAA,MAC/D;AAAA,IAAA;AAGF,QAAIS,IAAYT,EAAkC,CAAC,cAAc,WAAW,GAAG,MAAS,GACpFU,IAAiBV;AAAA,MACnB,CAAC,oBAAoB,gBAAgB;AAAA,MACrC;AAAA,IAAA;AAIF,SAAI,OAAOS,KAAc,aAAa,OAAOC,KAAmB,cAC1DP,GAAW;AACb,YAAMQ,IAAa,IAAI,KAAKR,CAAS;AACrC,UAAI,CAAC,OAAO,MAAMQ,EAAW,QAAA,CAAS,GAAG;AACvC,cAAMC,IAAUD,EAAW,QAAA,IAAY,KAAK,IAAA,GACtCE,IAAiB,IAAI,KAAK;AAChC,QAAAJ,IAAYG,KAAW,GACvBF,IAAiBE,IAAU,KAAKA,KAAWC;AAAA,MAC7C;AAAA,IACF;AAGF,UAAMC,IACJ,OAAON,KAAwB,YAC3BA,KACCC,MAAc,MAAQC,MAAmB,OAAS,CAACH;AAE1D,WAAO;AAAA,MACL,WAAAf;AAAA,MACA,YAAYhC;AAAA,MACZ,OAAA8C;AAAA,MACA,QAAQ,MAAM,QAAQF,CAAM,IAAIA,IAAS,CAAA;AAAA,MACzC,YAAYD;AAAA,MACZ,YAAYM,MAAc;AAAA,MAC1B,kBAAkBC,MAAmB;AAAA,MACrC,kBAAkBH;AAAA,MAClB,uBAAuBO;AAAA,MACvB,UAAApB;AAAA,MACA,iBAAiBW;AAAA,IAAA;AAAA,EAErB;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqBR,GAA4C;AACvE,UAAM,EAAE,gBAAAkB,GAAgB,oBAAAjC,GAAoB,YAAAkC,GAAY,YAAAC,GAAY,eAAAC,GAAe,cAAAC,MACjF,KAAK;AAGP,IAAIJ,MACFA,EAAe,cAAclB,EAAY,SAAS,cAIhDf,MACFA,EAAmB,cACjBe,EAAY,cAAc,KAAK,mBAC3B,eAAeA,EAAY,cAAc,KAAK,gBAAgB,KAC9D,wBAIR,KAAK,aAAaA,EAAY,UAAU,CAAA,CAAE,GAG1C,KAAK;AAAA,MACHA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,IAAA;AAAA,EAEhB;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAaO,GAAwB;AAC3C,UAAM,EAAE,YAAAY,MAAe,KAAK;AAC5B,QAAKA,GAEL;AAAA,UAAI,CAACZ,KAAUA,EAAO,WAAW,GAAG;AAClC,QAAAY,EAAW,YACT;AACF;AAAA,MACF;AAEA,MAAAA,EAAW,YAAYZ,EACpB,IAAI,CAACgB,MAAU;AACd,cAAMC,IAAOzD,GAAmBwD,CAAK,KAAK,EAAE,OAAOA,GAAO,aAAa,GAAA;AACvE,eAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8DAM+C,KAAK,WAAWC,EAAK,KAAK,CAAC;AAAA,cAC3EA,EAAK,cAAc,oCAAoC,KAAK,WAAWA,EAAK,WAAW,CAAC,SAAS,EAAE;AAAA;AAAA;AAAA;AAAA,MAI3G,CAAC,EACA,KAAK,EAAE;AAAA;AAAA,EACZ;AAAA;AAAA;AAAA;AAAA,EAKQ,aACNC,GACAb,GACAC,GACAH,GACAO,GACM;AACN,UAAM,EAAE,YAAAG,GAAY,eAAAC,GAAe,cAAAC,EAAA,IAAiB,KAAK;AACzD,QAAI,CAACF,EAAY;AAKjB,QAHAA,EAAW,UAAU,OAAO,gBAAgB,gBAAgB,GAC5DA,EAAW,UAAU,IAAI,eAAe,GAEpC,CAACK,GAAY;AACf,MAAAL,EAAW,cAAc,+BACrBC,OAAoBA,CAAa;AACrC;AAAA,IACF;AAEA,UAAMP,IAAa,IAAI,KAAKW,CAAU,GAChC9M,wBAAU,KAAA,GACV+M,IAAc,KAAK;AAAA,MACvB;AAAA,MACA,KAAK,OAAOZ,EAAW,QAAA,IAAYnM,EAAI,QAAA,MAAc,MAAO,GAAG;AAAA,IAAA;AAGjE,IAAIiM,IACEF,KACFU,EAAW,cACT,qFACFA,EAAW,UAAU,OAAO,eAAe,GAC3CA,EAAW,UAAU,IAAI,gBAAgB,GACrCC,OAAoBA,CAAa,MAErCD,EAAW,cAAc,kDACzBA,EAAW,UAAU,OAAO,eAAe,GAC3CA,EAAW,UAAU,IAAI,cAAc,GACnCC,OAAoBA,CAAa,GACjCC,MACFA,EAAa,cACX,+HAGGT,KACTO,EAAW,UAAU,OAAO,eAAe,GAC3CA,EAAW,UAAU,IAAI,gBAAgB,GACrCV,KACFU,EAAW,cAAc,kCAAkCM,CAAW,UAAUA,MAAgB,IAAI,MAAM,EAAE,yCACxGL,OAAoBA,CAAa,MAErCD,EAAW,cAAc,kCAAkCM,CAAW,UAAUA,MAAgB,IAAI,MAAM,EAAE,IACxGL,OAAoBA,CAAa,GACjCC,MACFA,EAAa,cAAc,oCAAoCI,CAAW,UAAUA,MAAgB,IAAI,MAAM,EAAE,wFAIpHN,EAAW,cAAc,qBAAqBN,EAAW,mBAAA,CAAoB,IAAIA,EAAW,oBAAoB,IAC5GO,OAAoBA,CAAa,IAGnC,CAACJ,KAAwBI,KAC3BvJ,EAAKuJ,CAAa;AAAA,EAEtB;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoBpB,GAAqB0B,GAAuB;AACtE,UAAM,EAAE,iBAAAC,GAAiB,gBAAApB,EAAA,IAAmB,KAAK;AACjD,IAAKoB,MAED3B,KACFpI,EAAK+J,CAAe,GAChBpB,MACFA,EAAe,cACbmB,KACA,uGAGJ7J,EAAK8J,CAAe;AAAA,EAExB;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAWC,GAAsB;AACvC,UAAMC,IAAM,SAAS,cAAc,KAAK;AACxC,WAAAA,EAAI,cAAcD,GACXC,EAAI;AAAA,EACb;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,iBAAgC;AACpC,UAAM,EAAE,YAAApD,GAAY,cAAAzD,EAAA,IAAiB,KAAK;AAG1C,IAAIyD,KACF7G,EAAK6G,CAAU;AAGjB,UAAMqD,IAAc,KAAK,wBAAA;AACzB,SAAK,wBAAwB,KAAK;AAClC,UAAMC,IAAU,KAAK,oBAAoBD,GAAa,KAAK,qBAAqB;AAEhF,QAAI,CAACC,GAAS;AACZ,MAAItD,OAAiBA,CAAU,GAC3BzD,MACFA,EAAa,cAAc,uDAE7B,KAAK,UAAU,OAAO,GACtB,KAAK,SAAS,gCAAgC;AAC9C;AAAA,IACF;AAGA,UAAMgH,IAAQ,KACRC,IAAS,KACTC,KAAQ,OAAO,OAAO,QAAQF,KAAS,GACvCG,KAAO,OAAO,OAAO,SAASF,KAAU;AAQ9C,QANA,KAAK,cAAc,OAAO;AAAA,MACxBF;AAAA,MACA;AAAA,MACA,SAASC,CAAK,WAAWC,CAAM,SAASC,CAAI,QAAQC,CAAG;AAAA,IAAA,GAGrD,CAAC,KAAK,aAAa;AACrB,MAAI1D,OAAiBA,CAAU,GAC/B,KAAK,UAAU,4DAA4D,OAAO,GAClF,KAAK,SAAS,eAAe;AAC7B;AAAA,IACF;AAGA,SAAK,iBAAiB,CAACrH,MAAwB,KAAK,oBAAoBA,CAAK,GAC7E,OAAO,iBAAiB,WAAW,KAAK,cAAc,GAGtD,KAAK,eAAe,WAAW,MAAM;AACnC,WAAK,iBAAA,GACDqH,OAAiBA,CAAU,GAC/B,KAAK,UAAU,qDAAqD,OAAO,GAC3E,KAAK,SAAS,yBAAyB;AAAA,IACzC,GAAG,IAAM;AAAA,EACX;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAAkC;AACxC,WAAI,KAAK,OAAO,oBACP,KAAK,OAAO,oBAEd,GAAG,OAAO,SAAS,MAAM,GAAG,KAAK,OAAO,QAAQ;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgBf,GAA2B;AACjD,UAAM1B,IAA0B;AAAA,MAC9B,SAAS,KAAK,OAAO,UAAU;AAAA,MAC/B,YAAY0B,KAAa;AAAA,IAAA;AAE3B,WAAO,KAAK,UAAU1B,CAAK;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB8F,GAAqBpE,GAAkC;AACjF,UAAM0E,IAAW,KAAK,OAAO;AAC7B,QAAI,CAACA;AACH,aAAO;AAGT,UAAM9B,IAAS;AAAA,MACb;AAAA,MACA;AAAA,MACA;AAAA,IAAA,EACA,KAAK,GAAG;AAYV,WAAO,gDAVQ,IAAI,gBAAgB;AAAA,MACjC,WAAW8B;AAAA,MACX,cAAcN;AAAA,MACd,eAAe;AAAA,MACf,OAAOxB;AAAA,MACP,aAAa;AAAA,MACb,QAAQ;AAAA,MACR,OAAO,KAAK,gBAAgB5C,CAAS;AAAA,IAAA,CACtC,EAE6D,SAAA,CAAU;AAAA,EAC1E;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAoBtG,GAAoC;AAEpE,QAAIA,EAAM,WAAW,OAAO,SAAS,OAAQ;AAE7C,UAAMiG,IAAOjG,EAAM;AACnB,QAAIiG,EAAK,SAAS,wBAAyB;AAE3C,UAAM,EAAE,YAAAoB,MAAe,KAAK;AAM5B,QAJA,KAAK,iBAAA,GACDA,OAAiBA,CAAU,GAC/B,KAAK,iBAAA,GAEDpB,EAAK,OAAO;AACd,WAAK,UAAU,iBAAiBA,EAAK,KAAK,IAAI,OAAO,GACrD,KAAK,SAAS,iBAAiBA,EAAK,KAAK,EAAE;AAC3C;AAAA,IACF;AAEA,QAAIA,EAAK;AACP,UAAI;AACF,cAAMyE,IAAc,KAAK,wBAAA,GACnBO,IAAoB,KAAK,mBAAmBhF,EAAK,UAAU,GAC3DiF,IACJD,KAAqB,KAAK,yBAAyB,KAAK;AAE1D,QAAIA,KAAqBA,MAAsB,KAAK,qBAClD,KAAK,mBAAmBA,GACxB,KAAK,qBAAA;AAGP,cAAM9P,IAAW,MAAM;AAAA,UACrB,KAAK,kBAAkB,sCAAsC+P,CAAmB;AAAA,UAChF;AAAA,YACE,QAAQ;AAAA,YACR,aAAa;AAAA,YACb,SAAS;AAAA,cACP,gBAAgB;AAAA,cAChB,QAAQ;AAAA,YAAA;AAAA,YAEV,MAAM,KAAK,UAAU;AAAA,cACnB,WAAWjF,EAAK;AAAA,cAChB,YAAYiF,KAAuB;AAAA,cACnC,cAAcR;AAAA,YAAA,CACf;AAAA,UAAA;AAAA,QACH;AAGF,YAAI,CAACvP,EAAS,IAAI;AAChB,gBAAMuN,IAAY,MAAMvN,EAAS,KAAA;AACjC,gBAAM,IAAI,MAAMuN,EAAU,OAAO,WAAW,mBAAmB;AAAA,QACjE;AAEA,aAAK,UAAU,uCAAuC,SAAS,GAC/D,KAAK,SAAS,qCAAqC,GACnD,MAAM,KAAK,YAAA;AAAA,MACb,SAAS5M,GAAO;AACd,gBAAQ,MAAM,kBAAkBA,CAAK;AACrC,cAAMG,IAAUH,aAAiB,QAAQA,EAAM,UAAU;AACzD,aAAK,UAAU,sBAAsBG,CAAO,IAAI,OAAO,GACvD,KAAK,SAAS,sBAAsBA,CAAO,EAAE;AAAA,MAC/C;AAAA,EAEJ;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAwB;AAC9B,UAAM,EAAE,YAAAoL,MAAe,KAAK;AAC5B,IAAIA,OAAiBA,CAAU,GAC/B,KAAK,iBAAA,GACL,KAAK,iBAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAyB;AAC/B,IAAI,KAAK,iBACP,aAAa,KAAK,YAAY,GAC9B,KAAK,eAAe,OAGlB,KAAK,mBACP,OAAO,oBAAoB,WAAW,KAAK,cAAc,GACzD,KAAK,iBAAiB;AAAA,EAE1B;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAyB;AAC/B,QAAK,KAAK,aACV;AAAA,UAAI;AACF,aAAK,YAAY,MAAA;AAAA,MACnB,QAAQ;AAAA,MAER;AACA,WAAK,cAAc;AAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAA4B;AAChC,UAAM,EAAE,iBAAAC,MAAoB,KAAK;AACjC,IAAIA,OAAsBA,CAAe;AAEzC,QAAI;AACF,YAAMnM,IAAW,MAAM;AAAA,QACrB,KAAK,kBAAkB,uCAAuC;AAAA,QAC9D;AAAA,UACE,QAAQ;AAAA,UACR,aAAa;AAAA,UACb,SAAS,EAAE,QAAQ,mBAAA;AAAA,QAAmB;AAAA,MACxC;AAGF,UAAI,CAACA,EAAS,IAAI;AAChB,cAAMuN,IAAY,MAAMvN,EAAS,KAAA;AACjC,cAAM,IAAI,MAAMuN,EAAU,OAAO,WAAW,sBAAsB;AAAA,MACpE;AAEA,WAAK,UAAU,6BAA6B,SAAS,GACrD,KAAK,SAAS,2BAA2B,GACzC,MAAM,KAAK,YAAA;AAAA,IACb,SAAS5M,GAAO;AACd,cAAQ,MAAM,qBAAqBA,CAAK;AACxC,YAAMG,IAAUH,aAAiB,QAAQA,EAAM,UAAU;AACzD,WAAK,UAAU,yBAAyBG,CAAO,IAAI,OAAO,GAC1D,KAAK,SAAS,yBAAyBA,CAAO,EAAE;AAAA,IAClD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAUA,GAAiBkP,GAAiC;AAGlE,UAAMC,IADM,OACa;AAIzB,IAAIA,MACED,MAAS,YACXC,EAAa,QAAQnP,CAAO,IAE5BmP,EAAa,MAAMnP,CAAO;AAAA,EAGhC;AACF;AAKO,SAASoP,GACdzQ,GAC6B;AAC7B,QAAM6I,IAAa,IAAIkD,EAA4B/L,CAAM;AACzD,SAAA0F,EAAQ,MAAMmD,EAAW,MAAM,GACxBA;AACT;AAKO,SAAS6H,GAA2B1Q,GAQlC;AACP,QAAMuJ,IAA0C;AAAA,IAC9C,UAAUvJ,EAAO;AAAA,IACjB,aAAaA,EAAO,eAAe,GAAGA,EAAO,QAAQ;AAAA,IACrD,QAAQA,EAAO;AAAA,IACf,iBAAiBA,EAAO;AAAA,IACxB,mBAAmBA,EAAO;AAAA,IAC1B,gBAAgBA,EAAO;AAAA,IACvB,eAAeA,EAAO,kBAAkB;AAAA,EAAA,GAGpC6I,IAAa,IAAIkD,EAA4BxC,CAAU;AAC7D,EAAA7D,EAAQ,MAAMmD,EAAW,MAAM,GAG3B,OAAO,SAAW,QACnB,OAA8C,mCAC7CA;AAEN;ACviCA,MAAMgD,IAA6B,2BAE7B8E,IAA0C;AAAA,EAC9C,sCAAsC;AAAA,EACtC,wCAAwC;AAAA,EACxC,2CAA2C;AAAA,EAC3C,4CAA4C;AAAA,EAC5C,mBAAmB;AAAA,EACnB,SAAS;AACX,GAEMC,IAAmB;AAAA,EACvB;AAAA,EACA;AACF;AAMO,MAAMC,EAA4B;AAAA,EAyDvC,YAAY7Q,GAAiC;AAnD7C,SAAQ,eAAsC,CAAA,GAC9C,KAAQ,gBAA+B,MACvC,KAAQ,oBAAsC,CAAC,EAAE,IAAI,QAAQ,MAAM,YAAY,GAC/E,KAAQ,eAA2C,MACnD,KAAQ,cAAc,IACtB,KAAQ,aAAa,IACrB,KAAQ,YAAY,IA8ClB,KAAK,SAASA,GACd,KAAK,UAAUA,EAAO,eAAe,GAAGA,EAAO,QAAQ,QACvD,KAAK,mBAAmB,KAAK,wBAAA,GAE7B,KAAK,WAAW;AAAA,MACd,aAAawE,EAAqB,eAAe;AAAA,MACjD,gBAAgBA,EAAG,mBAAmB;AAAA,MACtC,UAAUA,EAAG,YAAY;AAAA,MACzB,cAAcA,EAAG,gBAAgB;AAAA,MACjC,YAAYA,EAAG,aAAa;AAAA,MAC5B,WAAWA,EAAG,aAAa;AAAA,MAC3B,aAAaA,EAAG,eAAe;AAAA,MAC/B,YAAYA,EAAG,aAAa;AAAA,MAC5B,aAAaA,EAAG,gBAAgB;AAAA,MAChC,YAAYA,EAAG,cAAc;AAAA,MAC7B,eAAeA,EAAG,sBAAsB;AAAA,MACxC,kBAAkBA,EAAG,qBAAqB;AAAA,MAC1C,mBAAmBA,EAAsB,sBAAsB;AAAA,MAC/D,aAAaA,EAAG,eAAe;AAAA,MAC/B,aAAaA,EAAG,eAAe;AAAA,MAC/B,aAAaA,EAAG,eAAe;AAAA,MAC/B,cAAcA,EAAG,gBAAgB;AAAA,MACjC,aAAaA,EAAG,eAAe;AAAA,MAC/B,eAAeA,EAAG,kBAAkB;AAAA,MACpC,cAAcA,EAAG,gBAAgB;AAAA,MACjC,iBAAiBA,EAAG,mBAAmB;AAAA,MACvC,iBAAiBA,EAAG,mBAAmB;AAAA,MACvC,WAAWA,EAAG,aAAa;AAAA,MAC3B,iBAAiBA,EAAsB,qBAAqB;AAAA,MAC5D,mBAAmBA,EAAG,sBAAsB;AAAA,MAC5C,aAAaA,EAAG,eAAe;AAAA,MAC/B,YAAYA,EAAoB,cAAc;AAAA,MAC9C,oBAAoBA,EAAqB,wBAAwB;AAAA,MACjE,qBAAqBA,EAAqB,wBAAwB;AAAA,MAClE,sBAAsBA,EAAqB,yBAAyB;AAAA,MACpE,iBAAiBA,EAAG,oBAAoB;AAAA,MACxC,kBAAkBA,EAAG,qBAAqB;AAAA,MAC1C,eAAeA,EAAG,iBAAiB;AAAA,MACnC,eAAeA,EAAG,kBAAkB;AAAA,MACpC,aAAaA,EAAG,gBAAgB;AAAA,MAChC,aAAaA,EAAG,gBAAgB;AAAA,IAAA;AAAA,EAEpC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAsB;AAC1B,IAAK,KAAK,OAAO,oBAIjB,KAAK,oBAAA,GACL,KAAK,eAAA,GACL,MAAM,KAAK,UAAA;AAAA,EACb;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAA4B;AAClC,UAAM;AAAA,MACJ,aAAAsM;AAAA,MACA,gBAAAC;AAAA,MACA,YAAA7E;AAAA,MACA,aAAA8E;AAAA,MACA,WAAAC;AAAA,MACA,mBAAAC;AAAA,MACA,iBAAAC;AAAA,MACA,kBAAAC;AAAA,MACA,YAAAC;AAAA,MACA,aAAAC;AAAA,MACA,aAAAC;AAAA,MACA,aAAAC;AAAA,IAAA,IACE,KAAK;AAGT,QAAIV,GAAa;AACf,YAAMW,IAAkBlJ,EAAS,MAAM,KAAK,aAAA,GAAgB,GAAG;AAC/D,MAAAuI,EAAY,iBAAiB,SAASW,CAAe,GACrDX,EAAY,iBAAiB,WAAW,CAAClH,MAAM;AAC7C,QAAIA,EAAE,QAAQ,YACZA,EAAE,eAAA,GACF,KAAK,aAAA;AAAA,MAET,CAAC;AAAA,IACH;AAGA,IAAImH,KACFA,EAAe,iBAAiB,SAAS,MAAM,KAAK,aAAa,GAI/D7E,KACFA,EAAW,iBAAiB,SAAS,MAAM,KAAK,SAAS,GAIvD8E,KACFA,EAAY,iBAAiB,SAAS,MAAM,KAAK,UAAU,GAIzDC,KACFA,EAAU,iBAAiB,SAAS,MAAM,KAAK,iBAAiB,GAI9DC,KACFA,EAAkB,iBAAiB,SAAS,MAAM,KAAK,gBAAgB,GAIrEC,KACFA,EAAgB,iBAAiB,SAAS,MAAM,KAAK,iBAAiB,GAGpEC,KAAoBC,KACtBA,EAAW,iBAAiB,UAAU,CAACzH,MAAM;AAC3C,MAAAA,EAAE,eAAA,GACF,KAAK,aAAA;AAAA,IACP,CAAC,GAIC0H,KACFA,EAAY,iBAAiB,SAAS,CAAC1H,MAAM;AAC3C,YAAMnE,IAASmE,EAAE;AACjB,OAAInE,MAAW6L,KAAe7L,EAAO,aAAa,aAAa,MAAM,WACnE,KAAK,gBAAA;AAAA,IAET,CAAC,GAIC8L,KACFA,EAAY,iBAAiB,SAAS,MAAM,KAAK,YAAY,MAAM,CAAC,GAElEC,KACFA,EAAY,iBAAiB,SAAS,MAAM,KAAK,YAAY,MAAM,CAAC,GAItE,SAAS,iBAAiB,WAAW,CAAC5H,MAAM;AAC1C,MAAIA,EAAE,QAAQ,YACR0H,KAAe,CAACA,EAAY,UAAU,SAAS,QAAQ,KACzD,KAAK,gBAAA;AAAA,IAGX,CAAC;AAGD,UAAM,EAAE,UAAAI,MAAa,KAAK;AAC1B,IAAIA,KACFA,EAAS,iBAAiB,SAAS,CAAC9H,MAAM,KAAK,oBAAoBA,CAAC,CAAC;AAAA,EAEzE;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAAkC;AACxC,UAAM3J,IAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,GACnD2M,IAAY,KAAK,mBAAmB3M,EAAO,IAAI,YAAY,CAAC;AAClE,QAAI2M,EAAW,QAAOA;AAEtB,UAAMC,IAAe,KAAK,mBAAmB,KAAK,OAAO,eAAe;AACxE,QAAIA,EAAc,QAAOA;AAEzB,QAAI;AACF,aAAO,KAAK;AAAA,QACV,OAAO,aAAa,QAAQhB,CAA0B;AAAA,MAAA;AAAA,IAE1D,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB1J,GAA0C;AACnE,YAAQA,KAAS,IAAI,KAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAuB;AAC7B,SAAK,mBAAA;AAEL,UAAM,EAAE,kBAAAwP,GAAkB,mBAAAC,EAAA,IAAsB,KAAK;AAWrD,QATID,MACE,KAAK,oBACPA,EAAiB,cAAc,kBAAkB,KAAK,gBAAgB,IACtE/L,EAAK+L,CAAgB,KAErB9L,EAAK8L,CAAgB,IAIrBC,GAAmB;AACrB,YAAMvE,IACJuE,EAAkB,QAAQ,YAAYA,EAAkB,aAAa,MAAM;AAC7E,MAAIvE,KACFuE,EAAkB,aAAa,QAAQ,KAAK,qBAAqBvE,CAAQ,CAAC;AAAA,IAE9E;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAA2B;AACjC,UAAMF,IAAM,IAAI,IAAI,OAAO,SAAS,IAAI;AACxC,IAAI,KAAK,mBACPA,EAAI,aAAa,IAAI,cAAc,KAAK,gBAAgB,IAExDA,EAAI,aAAa,OAAO,YAAY,GAEtC,OAAO,QAAQ,aAAa,CAAA,GAAI,IAAIA,EAAI,UAAU;AAElD,QAAI;AACF,MAAI,KAAK,mBACP,OAAO,aAAa,QAAQtB,GAA4B,KAAK,gBAAgB,IAE7E,OAAO,aAAa,WAAWA,CAA0B;AAAA,IAE7D,QAAQ;AAAA,IAER;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqByB,GAA2B;AACtD,UAAMrC,IAAS,IAAI,IAAIqC,GAAW,OAAO,SAAS,MAAM;AACxD,WAAI,KAAK,mBACPrC,EAAO,aAAa,IAAI,cAAc,KAAK,gBAAgB,IAE3DA,EAAO,aAAa,OAAO,YAAY,GAElC,GAAGA,EAAO,QAAQ,GAAGA,EAAO,MAAM,GAAGA,EAAO,IAAI;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkBjK,GAAsB;AAC9C,UAAMmM,IAAM,IAAI,IAAI,GAAG,KAAK,OAAO,GAAGnM,CAAI,IAAI,OAAO,SAAS,MAAM;AACpE,WAAAmM,EAAI,aAAa,IAAI,WAAW,KAAK,OAAO,UAAU,EAAE,GACpD,KAAK,oBACPA,EAAI,aAAa,IAAI,cAAc,KAAK,gBAAgB,GAEnDA,EAAI,SAAA;AAAA,EACb;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB0E,GAAoD;AAC7E,QAAI,CAACA,KAAQ,OAAOA,KAAS;AAC3B,aAAO;AAAA,QACL,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,UAAU;AAAA,QACV,cAAc;AAAA,QACd,aAAa;AAAA,QACb,SAAS,CAAA;AAAA,QACT,QAAQ,CAAA;AAAA,MAAC;AAIb,UAAM9Q,IAAK,OAAO8Q,EAAK,MAAMA,EAAK,MAAM,EAAE,EAAE,KAAA,GACtCC,IAAO,OAAOD,EAAK,QAAQA,EAAK,QAAQ,EAAE,EAAE,KAAA,GAC5CE,IAAW,OAAOF,EAAK,YAAYA,EAAK,YAAY,EAAE,EAAE,KAAA,GACxDG,IAAe,OAAOH,EAAK,gBAAgBA,EAAK,gBAAgB,EAAE,EAAE,KAAA,GACpEI,IAAc;AAAA,MAClBJ,EAAK,eAAeA,EAAK,cAAcA,EAAK,cAAc;AAAA,IAAA,EAC1D,KAAA,GACIK,IAAW,OAAOL,EAAK,YAAYA,EAAK,YAAY,EAAE,EAAE,KAAA,GACxDM,IAAa,OAAON,EAAK,cAAcA,EAAK,cAAc,EAAE,EAAE,KAAA,GAC9DO,IAAU,MAAM,QAAQP,EAAK,OAAO,IACrCA,EAAK,UACNK,IACE,CAACA,CAAQ,IACT,CAAA,GACAG,IAAS,MAAM,QAAQR,EAAK,MAAM,IACnCA,EAAK,SACNM,IACE,CAAC,EAAE,cAAcA,EAAA,CAAY,IAC7B,CAAA;AAEN,WAAO;AAAA,MACL,IAAApR;AAAA,MACA,MAAA+Q;AAAA,MACA,UAAAC;AAAA,MACA,cAAAC;AAAA,MACA,aAAAC;AAAA,MACA,SAAAG;AAAA,MACA,QAAAC;AAAA,MACA,MAAMR,EAAK;AAAA,MACX,UAAUA,EAAK;AAAA,MACf,eAAeA,EAAK;AAAA,IAAA;AAAA,EAExB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAUS,IAAS,IAAsB;AAC7C,QAAI,KAAK,UAAW;AAEpB,SAAK,YAAY;AACjB,UAAM,EAAE,cAAApH,GAAc,UAAAwG,EAAA,IAAa,KAAK;AAExC,IAAKY,MACH,KAAK,eAAe,CAAA,GACpB,KAAK,gBAAgB,MACjBpH,OAAmBA,CAAY;AAGrC,QAAI;AACF,YAAMqH,IAAgB,KAAK,kBAAkB,KAAK,kBAAkB,SAAS,CAAC;AAC9E,UAAIpF;AAEJ,MAAI,KAAK,cACPA,IAAM,KAAK;AAAA,QACT,sCAAsC,mBAAmB,KAAK,WAAW,CAAC;AAAA,MAAA,IAG5EA,IAAM,KAAK;AAAA,QACT,8CAA8C,mBAAmBoF,EAAc,EAAE,CAAC;AAAA,MAAA,GAIlF,KAAK,kBACPpF,KAAO,eAAe,mBAAmB,KAAK,aAAa,CAAC;AAG9D,YAAM5M,IAAW,MAAM,MAAM4M,GAAK;AAAA,QAChC,aAAa;AAAA,QACb,SAAS,EAAE,QAAQ,mBAAA;AAAA,MAAmB,CACvC;AAED,UAAI,CAAC5M,EAAS;AACZ,cAAM,IAAI,MAAM,yBAAyBA,EAAS,MAAM,EAAE;AAG5D,YAAM8K,IAAO,MAAM9K,EAAS,KAAA,GACtBiS,IAAQ,MAAM,QAAQnH,EAAK,KAAK,IAClCA,EAAK,MAAM,IAAI,CAACoH,MAA+B,KAAK,mBAAmBA,CAAC,CAAC,IACzE,CAAA;AAEJ,MAAIH,IACF,KAAK,eAAe,CAAC,GAAG,KAAK,cAAc,GAAGE,CAAK,IAEnD,KAAK,eAAeA,GAGtB,KAAK,gBAAgBnH,EAAK,mBAAmB,MAC7C,KAAK,YAAA,GACL,KAAK,kBAAA,GACL,KAAK,iBAAA,GAEL5E;AAAA,QACE,KAAK,cACD,SAAS,KAAK,aAAa,MAAM,WACjC,UAAU,KAAK,aAAa,MAAM;AAAA,MAAA;AAAA,IAE1C,SAASvF,GAAO;AACd,cAAQ,MAAM,wBAAwBA,CAAK,GAC3C,KAAK,YAAYA,aAAiB,QAAQA,EAAM,UAAU,sBAAsB,GAChFuF,EAAS,qBAAqB;AAAA,IAChC,UAAA;AACE,WAAK,YAAY,IACbyE,OAAmBA,CAAY;AAAA,IACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAoB;AAC1B,UAAM,EAAE,UAAAwG,GAAU,cAAAxG,EAAA,IAAiB,KAAK;AACxC,QAAI,CAACwG,EAAU;AAIf,QAFIxG,OAAmBA,CAAY,GAE/B,KAAK,aAAa,WAAW,GAAG;AAClC,MAAAwG,EAAS,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAQb,KAAK,cAAc,mBAAmB,sBAAsB;AAAA;AAAA;AAAA,cAG5D,KAAK,cAAc,gCAAgC,yBAAyB;AAAA;AAAA;AAAA;AAIpF;AAAA,IACF;AAEA,UAAMgB,IAAO,KAAK,aACf,IAAI,CAACb,MAAS,KAAK,eAAeA,CAAI,CAAC,EACvC,KAAK,EAAE;AAEV,IAAAH,EAAS,YAAYgB;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAeb,GAAmC;AACxD,UAAMc,IAAWd,EAAK,aAAa,sCAC7Be,IAAehC,EAAiB,SAASiB,EAAK,QAAQ,GACtDgB,IAAa,KAAK,cAAc,OAAOhB,EAAK,IAE5CiB,IACJnC,EAAgBkB,EAAK,QAAQ,KAAKlB,EAAgB,SAC9CoC,IAAO,KAAK,YAAYD,CAAQ;AAEtC,WAAO;AAAA;AAAA,6FAEkFD,IAAa,0CAA0C,EAAE;AAAA,wBAC9H,KAAK,WAAWhB,EAAK,EAAE,CAAC;AAAA,0BACtBc,CAAQ;AAAA;AAAA,yBAETE,CAAU;AAAA;AAAA;AAAA;AAAA,YAIvBE,CAAI;AAAA;AAAA;AAAA;AAAA,cAIF,KAAK,WAAWlB,EAAK,IAAI,CAAC;AAAA;AAAA;AAAA,cAG1B3P,EAAe2P,EAAK,YAAY,CAAC;AAAA;AAAA;AAAA,UAIrCe,IACI,wGACA,EACN;AAAA;AAAA;AAAA,EAGN;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAYrC,GAAsB;AACxC,UAAMyC,IAAkC;AAAA,MACtC,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,OAAO;AAAA,MACP,OAAO;AAAA,MACP,KAAK;AAAA,MACL,MAAM;AAAA,IAAA;AAER,WAAOA,EAAQzC,CAAI,KAAKyC,EAAQ;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,GAAgB;AAE1C,UAAMC,IADS,EAAE,OACO,QAAQ,YAAY;AAE5C,QAAI,CAACA,EAAU;AAEf,UAAMC,IAASD,EAAS,QAAQ,QAC1BN,IAAWM,EAAS,QAAQ,aAAa;AAE/C,IAAKC,MAEDP,IACF,KAAK,iBAAiBO,CAAM,IAE5B,KAAK,WAAWA,CAAM;AAAA,EAE1B;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiBC,GAAwB;AAC/C,UAAMC,IAAS,KAAK,aAAa,KAAK,CAACX,MAAMA,EAAE,OAAOU,CAAQ;AAC9D,IAAKC,MAEL,KAAK,kBAAkB,KAAK,EAAE,IAAIA,EAAO,IAAI,MAAMA,EAAO,MAAM,GAChE,KAAK,cAAc,IACnB,KAAK,eAAA,GACL,KAAK,iBAAA,GACL,KAAK,UAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAWF,GAAsB;AACvC,UAAMrB,IAAO,KAAK,aAAa,KAAK,CAACY,MAAMA,EAAE,OAAOS,CAAM;AAC1D,IAAKrB,MAEL,KAAK,eAAeA,GACpB,KAAK,gBAAA,GACL,KAAK,YAAA,GACLpL,EAAS,aAAaoL,EAAK,IAAI,EAAE;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAuB;AAC7B,SAAK,eAAe,MACpB,KAAK,gBAAA,GACL,KAAK,YAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAwB;AAC9B,UAAM;AAAA,MACJ,aAAAwB;AAAA,MACA,aAAAC;AAAA,MACA,aAAAC;AAAA,MACA,cAAAC;AAAA,MACA,aAAAC;AAAA,MACA,eAAAC;AAAA,MACA,cAAAC;AAAA,MACA,iBAAAC;AAAA,MACA,WAAA3C;AAAA,MACA,iBAAA4C;AAAA,IAAA,IACE,KAAK;AAET,QAAI,CAAC,KAAK,cAAc;AACtB,MAAIR,OAAkBA,CAAW,GAC7BC,OAAkBA,CAAW;AACjC;AAAA,IACF;AAEA,IAAID,OAAkBA,CAAW,GAC7BC,OAAkBA,CAAW;AAEjC,UAAMzB,IAAO,KAAK,cACZe,IAAehC,EAAiB,SAASiB,EAAK,QAAQ;AAE5D,IAAI2B,MACFA,EAAa,cAAc3B,EAAK,OAG9B4B,MACFA,EAAY,cAAc,KAAK,iBAAiB5B,EAAK,QAAQ,IAG3D6B,MACFA,EAAc,cAAc7B,EAAK,KAG/B8B,KAAgB9B,EAAK,OAAO,SAAS,MACvC8B,EAAa,cAAc9B,EAAK,OAAO,CAAC,EAAE,gBAAgB,MAGxD+B,MACFA,EAAgB,cAAc1R,EAAe2P,EAAK,YAAY,IAG5DZ,MACE2B,KACF3B,EAAU,gBAAgB,UAAU,GACpCA,EAAU,UAAU,OAAO,cAAc,oBAAoB,MAE7DA,EAAU,aAAa,YAAY,MAAM,GACzCA,EAAU,UAAU,IAAI,cAAc,oBAAoB,KAI1D4C,KAAmBhC,EAAK,gBAC1BgC,EAAgB,OAAOhC,EAAK;AAAA,EAEhC;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiBE,GAA0B;AAQjD,WAPuC;AAAA,MACrC,sCAAsC;AAAA,MACtC,wCAAwC;AAAA,MACxC,2CAA2C;AAAA,MAC3C,4CAA4C;AAAA,MAC5C,mBAAmB;AAAA,IAAA,EAEPA,CAAQ,KAAK;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAyB;AAC/B,UAAM,EAAE,YAAA+B,GAAY,WAAAC,EAAA,IAAc,KAAK;AACvC,QAAI,CAACD,EAAY;AAEjB,QAAI,KAAK,aAAa;AACpB,MAAAjO,EAAKiO,CAAU,GACXC,QAAqB,cAAc;AACvC;AAAA,IACF;AAEA,IAAAnO,EAAKkO,CAAU;AACf,UAAMvB,IAAgB,KAAK,kBAAkB,KAAK,kBAAkB,SAAS,CAAC;AAC9E,IAAIwB,MAAWA,EAAU,cAAcxB,EAAc;AAErD,UAAMyB,IAAKF,EAAW,cAAc,IAAI;AACxC,IAAKE,MAELA,EAAG,YAAY,KAAK,kBACjB;AAAA,MACC,CAACC,GAAMC,MAAU;AAAA;AAAA,YAEbA,IAAQ,IAAI,8CAA8C,EAAE;AAAA;AAAA;AAAA,8BAG1C,KAAK,WAAWD,EAAK,EAAE,CAAC;AAAA,iCACrBC,CAAK;AAAA;AAAA;AAAA,cAGxB,KAAK,WAAWD,EAAK,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA,IAAA,EAKjC,KAAK,EAAE,GAGVtP,EAAI,oBAAoBqP,CAAE,EAAE,QAAQ,CAACG,MAAQ;AAC3C,MAAAA,EAAI,iBAAiB,SAAS,MAAM;AAClC,cAAMD,IAAQ,SAAUC,EAAoB,QAAQ,eAAe,KAAK,EAAE;AAC1E,aAAK,qBAAqBD,CAAK;AAAA,MACjC,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqBA,GAAqB;AAChD,IAAIA,IAAQ,KAAKA,KAAS,KAAK,kBAAkB,SAAS,MAE1D,KAAK,oBAAoB,KAAK,kBAAkB,MAAM,GAAGA,IAAQ,CAAC,GAClE,KAAK,cAAc,IACnB,KAAK,eAAA,GACL,KAAK,iBAAA,GACL,KAAK,UAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAA0B;AAChC,UAAM,EAAE,aAAAE,MAAgB,KAAK;AAC7B,IAAKA,MAED,KAAK,aAAa,SAAS,IAC7BA,EAAY,cAAc,IAAI,KAAK,aAAa,MAAM,GAAG,KAAK,gBAAgB,MAAM,EAAE,YAEtFA,EAAY,cAAc;AAAA,EAE9B;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAyB;AAC/B,UAAM,EAAE,YAAAC,GAAY,aAAArD,EAAA,IAAgB,KAAK;AACzC,IAAKqD,MAED,KAAK,gBACPzO,EAAKyO,CAAU,IAEfxO,EAAKwO,CAAU;AAAA,EAEnB;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAqB;AAC3B,UAAM,EAAE,aAAAvD,GAAa,gBAAAC,EAAA,IAAmB,KAAK;AAC7C,QAAI,CAACD,EAAa;AAElB,UAAMwD,IAAQxD,EAAY,MAAM,KAAA;AAChC,SAAK,cAAcwD,GAEfvD,MACEuD,IACF1O,EAAKmL,CAAc,IAEnBlL,EAAKkL,CAAc,IAIvB,KAAK,eAAA,GACL,KAAK,UAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAoB;AAC1B,UAAM,EAAE,aAAAD,GAAa,gBAAAC,EAAA,IAAmB,KAAK;AAC7C,IAAID,QAAyB,QAAQ,KACjCC,OAAqBA,CAAc,GAEvC,KAAK,cAAc,IACnB,KAAK,eAAA,GACL,KAAK,iBAAA,GACL,KAAK,UAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAgB;AACtB,SAAK,eAAA,GACL,KAAK,UAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAiB;AACvB,IAAI,KAAK,iBACP,KAAK,UAAU,EAAI;AAAA,EAEvB;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAYwD,GAA6B;AAC/C,UAAM,EAAE,aAAAhD,GAAa,aAAAC,EAAA,IAAgB,KAAK;AAC1C,SAAK,aAAa+C,MAAS,QAEvBhD,KACFA,EAAY,aAAa,gBAAgB,OAAO,KAAK,UAAU,CAAC,GAE9DC,KACFA,EAAY,aAAa,gBAAgB,OAAO,CAAC,KAAK,UAAU,CAAC,GAGnE,KAAK,YAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAwB;AAC9B,QAAI,CAAC,KAAK,aAAc;AAExB,UAAM,EAAE,aAAAF,GAAa,oBAAAkD,GAAoB,qBAAAC,GAAqB,sBAAAC,EAAA,IAC5D,KAAK;AAMP,QAJIF,MACFA,EAAmB,QAAQ,KAAK,aAAa,KAG3CC,GAAqB;AAEvB,YAAM3C,IAAO,KAAK,aAAa,KAAK,QAAQ,aAAa,EAAE;AAC3D,MAAA2C,EAAoB,QAAQ3C;AAAA,IAC9B;AAEA,IAAI4C,MACFA,EAAqB,QAAQ,KAG3BpD,KACF1L,EAAK0L,CAAW;AAAA,EAEpB;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAwB;AAC9B,UAAM,EAAE,aAAAA,MAAgB,KAAK;AAC7B,IAAIA,OAAkBA,CAAW;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAA8B;AAC1C,QAAI,CAAC,KAAK,aAAc;AAExB,UAAM;AAAA,MACJ,kBAAAF;AAAA,MACA,eAAAuD;AAAA,MACA,eAAAC;AAAA,MACA,qBAAAH;AAAA,MACA,sBAAAC;AAAA,IAAA,IACE,KAAK,UAEHG,IAAe,KAAK,aAAa,IACjCC,IAAgBL,GAAqB,MAAM,KAAA,KAAU,KAAK,aAAa,MACvEM,IAAiBL,GAAsB,MAAM,KAAA,KAAU;AAG7D,IAAItD,KACFA,EAAiB,aAAa,YAAY,MAAM,GAE9CuD,OAAoBA,CAAa,GACjCC,QAA6B,cAAc;AAE/C,QAAI;AACF,YAAMrU,IAAW,MAAM,MAAM,KAAK,kBAAkB,6BAA6B,GAAG;AAAA,QAClF,QAAQ;AAAA,QACR,aAAa;AAAA,QACb,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,QAAQ;AAAA,QAAA;AAAA,QAEV,MAAM,KAAK,UAAU;AAAA,UACnB,gBAAgBsU;AAAA,UAChB,gBAAgBC;AAAA,UAChB,iBAAiBC,KAAkB;AAAA,QAAA,CACpC;AAAA,MAAA,CACF;AAED,UAAI,CAACxU,EAAS,IAAI;AAChB,cAAMuN,IAAY,MAAMvN,EAAS,KAAA;AACjC,cAAM,IAAI,MAAMuN,EAAU,OAAO,WAAW,eAAe;AAAA,MAC7D;AAEA,YAAM9C,IAAS,MAAMzK,EAAS,KAAA;AAE9B,WAAK,UAAU,+BAA+B,SAAS,GACvDkG,EAAS,gBAAgB,GAEzB,KAAK,gBAAA,GAGDuE,EAAO,UAAU,MAAM,KAAK,OAAO,cAAc,YACnD,OAAO,SAAS,OAAO,GAAG,KAAK,OAAO,aAAa,SAAS,IAAIA,EAAO,SAAS,EAAE,KACzEA,EAAO,WAAW,MAAM,KAAK,OAAO,cAAc,eAC3D,OAAO,SAAS,OAAO,GAAG,KAAK,OAAO,aAAa,UAAU,IAAIA,EAAO,UAAU,EAAE;AAAA,IAExF,SAAS9J,GAAO;AACd,cAAQ,MAAM,iBAAiBA,CAAK;AACpC,YAAMG,IAAUH,aAAiB,QAAQA,EAAM,UAAU;AACzD,WAAK,UAAUG,GAAS,OAAO,GAC/BoF,EAAS,UAAUpF,CAAO,EAAE;AAAA,IAC9B,UAAA;AACE,MAAI+P,KACFA,EAAiB,gBAAgB,UAAU,GAEzCuD,OAAoBA,CAAa,GACjCC,QAA6B,cAAc;AAAA,IACjD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAYvT,GAAuB;AACzC,UAAM,EAAE,UAAAqQ,MAAa,KAAK;AAC1B,IAAKA,MAELA,EAAS,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAQuB,KAAK,WAAWrQ,CAAO,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMtE;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAUA,GAAiBkP,GAAiC;AAElE,UAAMC,IADM,OACa;AAIzB,IAAIA,MACED,MAAS,YACXC,EAAa,QAAQnP,CAAO,IAE5BmP,EAAa,MAAMnP,CAAO;AAAA,EAGhC;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAWuO,GAAsB;AACvC,UAAMC,IAAM,SAAS,cAAc,KAAK;AACxC,WAAAA,EAAI,cAAcD,GACXC,EAAI;AAAA,EACb;AACF;AAKO,SAASmF,GACdhV,GAC6B;AAC7B,QAAM6I,IAAa,IAAIgI,EAA4B7Q,CAAM;AACzD,SAAA0F,EAAQ,MAAMmD,EAAW,MAAM,GACxBA;AACT;AAKO,SAASoM,GAA2BjV,GAWlC;AACP,QAAMuJ,IAAsC;AAAA,IAC1C,UAAUvJ,EAAO;AAAA,IACjB,aAAaA,EAAO,eAAe,GAAGA,EAAO,QAAQ;AAAA,IACrD,QAAQA,EAAO;AAAA,IACf,iBAAiBA,EAAO;AAAA,IACxB,iBAAiBA,EAAO,oBAAoB;AAAA,IAC5C,cAAcA,EAAO;AAAA,EAAA,GAGjB6I,IAAa,IAAIgI,EAA4BtH,CAAU;AAC7D,EAAA7D,EAAQ,MAAMmD,EAAW,MAAM,GAG3B,OAAO,SAAW,QACnB,OAA8C,mCAC7CA;AAEN;"}