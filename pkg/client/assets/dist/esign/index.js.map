{"version":3,"file":"index.js","sources":["../../src/esign/api-client.ts","../../src/esign/utils/formatters.ts","../../src/esign/utils/status-badges.ts","../../src/esign/utils/dom-helpers.ts","../../src/esign/utils/async-helpers.ts","../../src/esign/pages/landing.ts","../../src/esign/pages/signer-complete.ts","../../src/esign/pages/detail-formatters.ts","../../src/esign/pages/google-callback.ts","../../src/esign/pages/google-integration.ts","../../src/esign/pages/google-drive-picker.ts","../../src/esign/pages/integration-health.ts","../../src/esign/pages/integration-mappings.ts","../../src/esign/pages/integration-conflicts.ts","../../src/esign/pages/integration-sync-runs.ts","../../src/esign/pages/document-form.ts","../../src/esign/pages/agreement-form.ts","../../src/esign/pages/signer-review.ts","../../src/esign/pages/signer-error.ts","../../src/esign/pages/document-detail.ts","../../src/esign/pages/datatable-bootstrap.ts","../../src/esign/utils/google-drive-utils.ts"],"sourcesContent":["/**\n * E-Sign API Client\n * Centralized API client for all e-sign operations\n */\n\nimport type {\n  AgreementSummary,\n  AgreementStats,\n  DocumentSummary,\n  ListResponse,\n  APIResponse,\n  APIError,\n  GoogleIntegrationStatus,\n  GoogleImportRun,\n  DraftSummary,\n  DraftDetail,\n  WizardState,\n} from './types.js';\n\nexport interface ESignAPIClientConfig {\n  basePath: string;\n  apiBasePath?: string;\n  defaultHeaders?: Record<string, string>;\n}\n\nexport class ESignAPIClient {\n  private readonly basePath: string;\n  private readonly apiBasePath: string;\n  private readonly defaultHeaders: Record<string, string>;\n\n  constructor(config: ESignAPIClientConfig) {\n    this.basePath = config.basePath;\n    this.apiBasePath = config.apiBasePath || `${config.basePath}/api`;\n    this.defaultHeaders = {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n      ...config.defaultHeaders,\n    };\n  }\n\n  // Agreement endpoints\n  async listAgreements(params?: {\n    page?: number;\n    per_page?: number;\n    status?: string;\n    search?: string;\n  }): Promise<ListResponse<AgreementSummary>> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.status) queryParams.set('status', params.status);\n    if (params?.search) queryParams.set('search', params.search);\n\n    return this.get<ListResponse<AgreementSummary>>(\n      `/esign_agreements?${queryParams.toString()}`\n    );\n  }\n\n  async getAgreementStats(): Promise<AgreementStats> {\n    const allRows: AgreementSummary[] = [];\n    let page = 1;\n    const perPage = 200;\n    const maxPages = 25;\n\n    while (page <= maxPages) {\n      const response = await this.listAgreements({ page, per_page: perPage });\n      const rows = response.items || response.records || [];\n      allRows.push(...rows);\n\n      if (rows.length === 0 || allRows.length >= response.total) {\n        break;\n      }\n      page += 1;\n    }\n\n    const counters: Partial<Record<string, number>> = {};\n    for (const row of allRows) {\n      const status = String(row?.status || '').trim().toLowerCase();\n      if (!status) continue;\n      counters[status] = (counters[status] || 0) + 1;\n    }\n\n    const pending = (counters.sent || 0) + (counters.in_progress || 0);\n    const actionRequired = pending + (counters.declined || 0);\n\n    return {\n      draft: counters.draft || 0,\n      sent: counters.sent || 0,\n      in_progress: counters.in_progress || 0,\n      completed: counters.completed || 0,\n      voided: counters.voided || 0,\n      declined: counters.declined || 0,\n      expired: counters.expired || 0,\n      pending,\n      action_required: actionRequired,\n    };\n  }\n\n  // Document endpoints\n  async listDocuments(params?: {\n    page?: number;\n    per_page?: number;\n    search?: string;\n  }): Promise<ListResponse<DocumentSummary>> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.set('page', String(params.page));\n    if (params?.per_page) queryParams.set('per_page', String(params.per_page));\n    if (params?.search) queryParams.set('search', params.search);\n\n    return this.get<ListResponse<DocumentSummary>>(\n      `/esign_documents?${queryParams.toString()}`\n    );\n  }\n\n  // Google integration endpoints\n  async getGoogleIntegrationStatus(): Promise<GoogleIntegrationStatus> {\n    return this.get<GoogleIntegrationStatus>('/v1/esign/integrations/google/status');\n  }\n\n  async startGoogleImport(params: {\n    google_file_id: string;\n    document_title?: string;\n    agreement_title?: string;\n  }): Promise<GoogleImportRun> {\n    return this.post<GoogleImportRun>('/v1/esign/google-drive/imports', params);\n  }\n\n  async getGoogleImportStatus(importRunId: string): Promise<GoogleImportRun> {\n    return this.get<GoogleImportRun>(`/v1/esign/google-drive/imports/${importRunId}`);\n  }\n\n  // Draft persistence endpoints\n  async listDrafts(params?: {\n    limit?: number;\n    cursor?: string;\n  }): Promise<{ drafts: DraftSummary[]; next_cursor: string | null; total: number }> {\n    const queryParams = new URLSearchParams();\n    if (params?.limit) queryParams.set('limit', String(params.limit));\n    if (params?.cursor) queryParams.set('cursor', params.cursor);\n\n    return this.get(`/v1/esign/drafts?${queryParams.toString()}`);\n  }\n\n  async getDraft(id: string): Promise<DraftDetail> {\n    return this.get<DraftDetail>(`/v1/esign/drafts/${id}`);\n  }\n\n  async createDraft(params: {\n    wizard_id: string;\n    wizard_state: WizardState;\n    title: string;\n    current_step: number;\n    document_id?: string | null;\n  }): Promise<DraftDetail> {\n    return this.post<DraftDetail>('/v1/esign/drafts', params);\n  }\n\n  async updateDraft(\n    id: string,\n    params: {\n      expected_revision: number;\n      wizard_state: WizardState;\n      title: string;\n      current_step: number;\n      document_id?: string | null;\n    }\n  ): Promise<DraftDetail> {\n    return this.put<DraftDetail>(`/v1/esign/drafts/${id}`, params);\n  }\n\n  async deleteDraft(id: string): Promise<void> {\n    return this.delete(`/v1/esign/drafts/${id}`);\n  }\n\n  async sendDraft(\n    id: string,\n    params: { expected_revision: number }\n  ): Promise<{\n    agreement_id: string;\n    status: 'queued' | 'sent';\n    draft_id: string;\n    draft_deleted: boolean;\n  }> {\n    return this.post(`/v1/esign/drafts/${id}/send`, params);\n  }\n\n  // Generic HTTP methods\n  private async get<T>(path: string): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'GET',\n      headers: this.defaultHeaders,\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async post<T>(path: string, body?: unknown): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'POST',\n      headers: this.defaultHeaders,\n      body: body ? JSON.stringify(body) : undefined,\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async put<T>(path: string, body: unknown): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'PUT',\n      headers: this.defaultHeaders,\n      body: JSON.stringify(body),\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async delete<T>(path: string): Promise<T> {\n    const response = await fetch(`${this.apiBasePath}${path}`, {\n      method: 'DELETE',\n      headers: this.defaultHeaders,\n    });\n    return this.handleResponse<T>(response);\n  }\n\n  private async handleResponse<T>(response: Response): Promise<T> {\n    if (!response.ok) {\n      let error: APIError;\n      try {\n        const errorData = await response.json();\n        error = errorData.error || {\n          code: `HTTP_${response.status}`,\n          message: response.statusText,\n        };\n      } catch {\n        error = {\n          code: `HTTP_${response.status}`,\n          message: response.statusText,\n        };\n      }\n      throw new ESignAPIError(error.code, error.message, error.details);\n    }\n\n    if (response.status === 204) {\n      return undefined as T;\n    }\n\n    return response.json() as Promise<T>;\n  }\n}\n\nexport class ESignAPIError extends Error {\n  constructor(\n    public readonly code: string,\n    message: string,\n    public readonly details?: Record<string, unknown>\n  ) {\n    super(message);\n    this.name = 'ESignAPIError';\n  }\n}\n\n// Singleton instance management\nlet defaultClient: ESignAPIClient | null = null;\n\nexport function getESignClient(): ESignAPIClient {\n  if (!defaultClient) {\n    throw new Error('ESign API client not initialized. Call setESignClient first.');\n  }\n  return defaultClient;\n}\n\nexport function setESignClient(client: ESignAPIClient): void {\n  defaultClient = client;\n}\n\nexport function createESignClient(config: ESignAPIClientConfig): ESignAPIClient {\n  const client = new ESignAPIClient(config);\n  setESignClient(client);\n  return client;\n}\n","/**\n * E-Sign Formatters\n * Common formatting utilities for dates, file sizes, and document metadata\n */\n\n/**\n * Format bytes to human-readable file size\n */\nexport function formatFileSize(bytes: number | string | undefined | null): string {\n  if (bytes === undefined || bytes === null || bytes === '' || bytes === 0) return '-';\n  const numBytes = typeof bytes === 'string' ? parseInt(bytes, 10) : bytes;\n  if (!Number.isFinite(numBytes) || numBytes <= 0) return '-';\n\n  if (numBytes < 1024) return `${numBytes} B`;\n  if (numBytes < 1024 * 1024) return `${(numBytes / 1024).toFixed(1)} KB`;\n  return `${(numBytes / (1024 * 1024)).toFixed(2)} MB`;\n}\n\n/**\n * Format page count with proper pluralization\n */\nexport function formatPageCount(count: number | string | undefined | null): string {\n  if (!count) return '-';\n  const numCount = typeof count === 'string' ? parseInt(count, 10) : count;\n  if (!Number.isFinite(numCount) || numCount <= 0) return '-';\n  return numCount === 1 ? '1 page' : `${numCount} pages`;\n}\n\n/**\n * Format date/time for display\n */\nexport function formatDateTime(\n  value: string | Date | undefined | null,\n  options?: Intl.DateTimeFormatOptions\n): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const defaultOptions: Intl.DateTimeFormatOptions = {\n      dateStyle: 'short',\n      timeStyle: 'short',\n    };\n\n    return date.toLocaleString(undefined, options || defaultOptions);\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format date only (no time)\n */\nexport function formatDate(\n  value: string | Date | undefined | null,\n  options?: Intl.DateTimeFormatOptions\n): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const defaultOptions: Intl.DateTimeFormatOptions = {\n      dateStyle: 'medium',\n    };\n\n    return date.toLocaleDateString(undefined, options || defaultOptions);\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format time only (no date)\n */\nexport function formatTime(\n  value: string | Date | undefined | null,\n  options?: Intl.DateTimeFormatOptions\n): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const defaultOptions: Intl.DateTimeFormatOptions = {\n      hour: '2-digit',\n      minute: '2-digit',\n    };\n\n    return date.toLocaleTimeString(undefined, options || defaultOptions);\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format relative time (e.g., \"2 hours ago\", \"in 3 days\")\n */\nexport function formatRelativeTime(value: string | Date | undefined | null): string {\n  if (!value) return '-';\n  try {\n    const date = value instanceof Date ? value : new Date(value);\n    if (isNaN(date.getTime())) return '-';\n\n    const now = new Date();\n    const diffMs = date.getTime() - now.getTime();\n    const diffSec = Math.round(diffMs / 1000);\n    const diffMin = Math.round(diffSec / 60);\n    const diffHour = Math.round(diffMin / 60);\n    const diffDay = Math.round(diffHour / 24);\n\n    const rtf = new Intl.RelativeTimeFormat(undefined, { numeric: 'auto' });\n\n    if (Math.abs(diffDay) >= 1) {\n      return rtf.format(diffDay, 'day');\n    }\n    if (Math.abs(diffHour) >= 1) {\n      return rtf.format(diffHour, 'hour');\n    }\n    if (Math.abs(diffMin) >= 1) {\n      return rtf.format(diffMin, 'minute');\n    }\n    return rtf.format(diffSec, 'second');\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * Format recipient count with proper pluralization\n */\nexport function formatRecipientCount(count: number | undefined | null): string {\n  if (count === undefined || count === null) return '0 recipients';\n  return count === 1 ? '1 recipient' : `${count} recipients`;\n}\n\n/**\n * Capitalize first letter of a string\n */\nexport function capitalize(str: string): string {\n  if (!str) return '';\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Convert snake_case to Title Case\n */\nexport function snakeToTitle(str: string): string {\n  if (!str) return '';\n  return str\n    .split('_')\n    .map((word) => capitalize(word))\n    .join(' ');\n}\n\n/**\n * Truncate string with ellipsis\n */\nexport function truncate(str: string, maxLength: number): string {\n  if (!str || str.length <= maxLength) return str;\n  return `${str.slice(0, maxLength - 3)}...`;\n}\n","/**\n * E-Sign Status Badges\n * Status badge rendering utilities for agreements and documents\n */\n\nimport type { AgreementStatus } from '../types.js';\n\nexport interface BadgeConfig {\n  label: string;\n  bgClass: string;\n  textClass: string;\n  dotClass?: string;\n}\n\n/**\n * Agreement status badge configurations\n */\nexport const AGREEMENT_STATUS_BADGES: Record<AgreementStatus, BadgeConfig> = {\n  draft: {\n    label: 'Draft',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-700',\n    dotClass: 'bg-gray-400',\n  },\n  sent: {\n    label: 'Sent',\n    bgClass: 'bg-blue-100',\n    textClass: 'text-blue-700',\n    dotClass: 'bg-blue-400',\n  },\n  in_progress: {\n    label: 'In Progress',\n    bgClass: 'bg-amber-100',\n    textClass: 'text-amber-700',\n    dotClass: 'bg-amber-400',\n  },\n  completed: {\n    label: 'Completed',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    dotClass: 'bg-green-500',\n  },\n  voided: {\n    label: 'Voided',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    dotClass: 'bg-red-500',\n  },\n  declined: {\n    label: 'Declined',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    dotClass: 'bg-red-500',\n  },\n  expired: {\n    label: 'Expired',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-500',\n    dotClass: 'bg-gray-400',\n  },\n};\n\n/**\n * Get badge configuration for an agreement status\n */\nexport function getAgreementStatusBadge(\n  status: AgreementStatus | string\n): BadgeConfig {\n  const normalizedStatus = String(status || '')\n    .trim()\n    .toLowerCase() as AgreementStatus;\n  return (\n    AGREEMENT_STATUS_BADGES[normalizedStatus] || {\n      label: status || 'Unknown',\n      bgClass: 'bg-gray-100',\n      textClass: 'text-gray-600',\n      dotClass: 'bg-gray-400',\n    }\n  );\n}\n\n/**\n * Render a status badge as HTML\n */\nexport function renderStatusBadge(\n  status: AgreementStatus | string,\n  options?: {\n    showDot?: boolean;\n    size?: 'sm' | 'md' | 'lg';\n  }\n): string {\n  const badge = getAgreementStatusBadge(status);\n  const showDot = options?.showDot ?? false;\n  const size = options?.size ?? 'sm';\n\n  const sizeClasses = {\n    sm: 'px-2.5 py-0.5 text-xs',\n    md: 'px-3 py-1 text-sm',\n    lg: 'px-4 py-1.5 text-base',\n  };\n\n  const dotHtml = showDot\n    ? `<span class=\"w-2 h-2 rounded-full ${badge.dotClass} mr-1.5\" aria-hidden=\"true\"></span>`\n    : '';\n\n  return `<span class=\"inline-flex items-center ${sizeClasses[size]} rounded-full font-medium ${badge.bgClass} ${badge.textClass}\">${dotHtml}${badge.label}</span>`;\n}\n\n/**\n * Render a status badge element (returns DOM element)\n */\nexport function createStatusBadgeElement(\n  status: AgreementStatus | string,\n  options?: {\n    showDot?: boolean;\n    size?: 'sm' | 'md' | 'lg';\n  }\n): HTMLSpanElement {\n  const container = document.createElement('span');\n  container.innerHTML = renderStatusBadge(status, options);\n  return container.firstElementChild as HTMLSpanElement;\n}\n\n/**\n * Update an existing badge element with new status\n */\nexport function updateStatusBadge(\n  element: HTMLElement,\n  status: AgreementStatus | string,\n  options?: {\n    showDot?: boolean;\n    size?: 'sm' | 'md' | 'lg';\n  }\n): void {\n  const badge = getAgreementStatusBadge(status);\n  const size = options?.size ?? 'sm';\n\n  const sizeClasses = {\n    sm: 'px-2.5 py-0.5 text-xs',\n    md: 'px-3 py-1 text-sm',\n    lg: 'px-4 py-1.5 text-base',\n  };\n\n  // Remove old status classes\n  element.className = '';\n  element.className = `inline-flex items-center ${sizeClasses[size]} rounded-full font-medium ${badge.bgClass} ${badge.textClass}`;\n\n  // Update content\n  const showDot = options?.showDot ?? false;\n  if (showDot) {\n    const existingDot = element.querySelector('.rounded-full');\n    if (existingDot) {\n      existingDot.className = `w-2 h-2 rounded-full ${badge.dotClass} mr-1.5`;\n    } else {\n      const dotSpan = document.createElement('span');\n      dotSpan.className = `w-2 h-2 rounded-full ${badge.dotClass} mr-1.5`;\n      dotSpan.setAttribute('aria-hidden', 'true');\n      element.prepend(dotSpan);\n    }\n  }\n\n  // Update label text (find text node or last child)\n  const textContent = element.childNodes[element.childNodes.length - 1];\n  if (textContent && textContent.nodeType === Node.TEXT_NODE) {\n    textContent.textContent = badge.label;\n  } else {\n    element.appendChild(document.createTextNode(badge.label));\n  }\n}\n","/**\n * E-Sign DOM Helpers\n * Utilities for DOM manipulation, element selection, and event handling\n */\n\n/**\n * Safely query selector that returns null instead of throwing\n */\nexport function qs<T extends Element = Element>(\n  selector: string,\n  parent: ParentNode = document\n): T | null {\n  try {\n    return parent.querySelector<T>(selector);\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Query all matching elements\n */\nexport function qsa<T extends Element = Element>(\n  selector: string,\n  parent: ParentNode = document\n): T[] {\n  try {\n    return Array.from(parent.querySelectorAll<T>(selector));\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get element by ID with type safety\n */\nexport function byId<T extends HTMLElement = HTMLElement>(id: string): T | null {\n  return document.getElementById(id) as T | null;\n}\n\n/**\n * Create an element with attributes and children\n */\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\n  tagName: K,\n  attributes?: Record<string, string | undefined>,\n  children?: (Node | string)[]\n): HTMLElementTagNameMap[K] {\n  const element = document.createElement(tagName);\n\n  if (attributes) {\n    for (const [key, value] of Object.entries(attributes)) {\n      if (value !== undefined) {\n        element.setAttribute(key, value);\n      }\n    }\n  }\n\n  if (children) {\n    for (const child of children) {\n      if (typeof child === 'string') {\n        element.appendChild(document.createTextNode(child));\n      } else {\n        element.appendChild(child);\n      }\n    }\n  }\n\n  return element;\n}\n\n/**\n * Add event listener with automatic cleanup on AbortSignal\n */\nexport function on<K extends keyof HTMLElementEventMap>(\n  element: HTMLElement | Document | Window,\n  event: K,\n  handler: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void,\n  options?: AddEventListenerOptions & { signal?: AbortSignal }\n): () => void {\n  element.addEventListener(event, handler as EventListener, options);\n  return () => element.removeEventListener(event, handler as EventListener, options);\n}\n\n/**\n * Add delegated event listener\n */\nexport function delegate<K extends keyof HTMLElementEventMap>(\n  parent: HTMLElement | Document,\n  selector: string,\n  event: K,\n  handler: (this: HTMLElement, ev: HTMLElementEventMap[K], target: HTMLElement) => void,\n  options?: AddEventListenerOptions\n): () => void {\n  const delegatedHandler = (ev: Event) => {\n    const target = (ev.target as HTMLElement).closest(selector);\n    if (target && parent.contains(target)) {\n      handler.call(target as HTMLElement, ev as HTMLElementEventMap[K], target as HTMLElement);\n    }\n  };\n\n  parent.addEventListener(event, delegatedHandler, options);\n  return () => parent.removeEventListener(event, delegatedHandler, options);\n}\n\n/**\n * Run callback when DOM is ready\n */\nexport function onReady(callback: () => void): void {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', callback, { once: true });\n  } else {\n    callback();\n  }\n}\n\n/**\n * Show element (remove hidden classes)\n */\nexport function show(element: HTMLElement | null): void {\n  if (!element) return;\n  element.classList.remove('hidden', 'invisible');\n  element.style.display = '';\n}\n\n/**\n * Hide element (add hidden class)\n */\nexport function hide(element: HTMLElement | null): void {\n  if (!element) return;\n  element.classList.add('hidden');\n}\n\n/**\n * Toggle element visibility\n */\nexport function toggle(element: HTMLElement | null, visible?: boolean): void {\n  if (!element) return;\n  const shouldShow = visible ?? element.classList.contains('hidden');\n  if (shouldShow) {\n    show(element);\n  } else {\n    hide(element);\n  }\n}\n\n/**\n * Set element loading state\n */\nexport function setLoading(\n  element: HTMLElement | null,\n  loading: boolean,\n  options?: { spinnerClass?: string }\n): void {\n  if (!element) return;\n\n  if (loading) {\n    element.setAttribute('aria-busy', 'true');\n    element.classList.add('opacity-50', 'pointer-events-none');\n    if (element instanceof HTMLButtonElement || element instanceof HTMLInputElement) {\n      element.disabled = true;\n    }\n  } else {\n    element.removeAttribute('aria-busy');\n    element.classList.remove('opacity-50', 'pointer-events-none');\n    if (element instanceof HTMLButtonElement || element instanceof HTMLInputElement) {\n      element.disabled = false;\n    }\n  }\n}\n\n/**\n * Update text content of element by data attribute\n */\nexport function updateDataText(\n  key: string,\n  value: string | number,\n  parent: ParentNode = document\n): void {\n  const element = qs(`[data-esign-${key}]`, parent);\n  if (element) {\n    element.textContent = String(value);\n  }\n}\n\n/**\n * Update multiple data text elements\n */\nexport function updateDataTexts(\n  values: Record<string, string | number>,\n  parent: ParentNode = document\n): void {\n  for (const [key, value] of Object.entries(values)) {\n    updateDataText(key, value, parent);\n  }\n}\n\n/**\n * Extract page config from script tag or data attribute\n */\nexport function getPageConfig<T extends Record<string, unknown>>(\n  selector = '[data-esign-page]',\n  configAttr = 'data-esign-config'\n): T | null {\n  const element = qs(selector);\n  if (!element) return null;\n\n  // Try data attribute first\n  const configStr = element.getAttribute(configAttr);\n  if (configStr) {\n    try {\n      return JSON.parse(configStr) as T;\n    } catch {\n      console.warn('Failed to parse page config from attribute:', configStr);\n    }\n  }\n\n  // Try script tag with type=\"application/json\"\n  const scriptEl = qs<HTMLScriptElement>(\n    'script[type=\"application/json\"]',\n    element\n  );\n  if (scriptEl?.textContent) {\n    try {\n      return JSON.parse(scriptEl.textContent) as T;\n    } catch {\n      console.warn('Failed to parse page config from script:', scriptEl.textContent);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Announce message to screen readers\n */\nexport function announce(\n  message: string,\n  priority: 'polite' | 'assertive' = 'polite'\n): void {\n  const announcer =\n    qs(`[aria-live=\"${priority}\"]`) ||\n    (() => {\n      const el = createElement('div', {\n        'aria-live': priority,\n        'aria-atomic': 'true',\n        class: 'sr-only',\n      });\n      document.body.appendChild(el);\n      return el;\n    })();\n\n  announcer.textContent = '';\n  requestAnimationFrame(() => {\n    announcer.textContent = message;\n  });\n}\n","/**\n * E-Sign Async Helpers\n * Utilities for polling, retrying, and async operations\n */\n\nexport interface PollOptions<T> {\n  /** Function to call on each poll */\n  fn: () => Promise<T>;\n  /** Function to check if polling should stop (return true to stop) */\n  until: (result: T) => boolean;\n  /** Interval between polls in milliseconds (default: 2000) */\n  interval?: number;\n  /** Maximum time to poll in milliseconds (default: 60000) */\n  timeout?: number;\n  /** Maximum number of poll attempts (default: 30) */\n  maxAttempts?: number;\n  /** Callback on each poll result */\n  onProgress?: (result: T, attempt: number) => void;\n  /** Abort signal for cancellation */\n  signal?: AbortSignal;\n}\n\nexport interface PollResult<T> {\n  result: T;\n  attempts: number;\n  stopped: boolean;\n  timedOut: boolean;\n}\n\n/**\n * Poll a function until a condition is met or timeout\n */\nexport async function poll<T>(options: PollOptions<T>): Promise<PollResult<T>> {\n  const {\n    fn,\n    until,\n    interval = 2000,\n    timeout = 60000,\n    maxAttempts = 30,\n    onProgress,\n    signal,\n  } = options;\n\n  const startTime = Date.now();\n  let attempts = 0;\n  let lastResult: T;\n\n  while (attempts < maxAttempts) {\n    if (signal?.aborted) {\n      throw new DOMException('Polling aborted', 'AbortError');\n    }\n\n    const elapsedTime = Date.now() - startTime;\n    if (elapsedTime >= timeout) {\n      return {\n        result: lastResult!,\n        attempts,\n        stopped: false,\n        timedOut: true,\n      };\n    }\n\n    attempts++;\n    lastResult = await fn();\n\n    if (onProgress) {\n      onProgress(lastResult, attempts);\n    }\n\n    if (until(lastResult)) {\n      return {\n        result: lastResult,\n        attempts,\n        stopped: true,\n        timedOut: false,\n      };\n    }\n\n    // Wait before next poll\n    await sleep(interval, signal);\n  }\n\n  return {\n    result: lastResult!,\n    attempts,\n    stopped: false,\n    timedOut: false,\n  };\n}\n\nexport interface RetryOptions<T> {\n  /** Function to retry */\n  fn: () => Promise<T>;\n  /** Maximum number of retry attempts (default: 3) */\n  maxAttempts?: number;\n  /** Base delay between retries in ms (default: 1000) */\n  baseDelay?: number;\n  /** Maximum delay between retries in ms (default: 30000) */\n  maxDelay?: number;\n  /** Whether to use exponential backoff (default: true) */\n  exponentialBackoff?: boolean;\n  /** Function to determine if error is retryable (default: all errors) */\n  shouldRetry?: (error: unknown, attempt: number) => boolean;\n  /** Callback on each retry */\n  onRetry?: (error: unknown, attempt: number, delay: number) => void;\n  /** Abort signal for cancellation */\n  signal?: AbortSignal;\n}\n\n/**\n * Retry a function with exponential backoff\n */\nexport async function retry<T>(options: RetryOptions<T>): Promise<T> {\n  const {\n    fn,\n    maxAttempts = 3,\n    baseDelay = 1000,\n    maxDelay = 30000,\n    exponentialBackoff = true,\n    shouldRetry = () => true,\n    onRetry,\n    signal,\n  } = options;\n\n  let lastError: unknown;\n\n  for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n    if (signal?.aborted) {\n      throw new DOMException('Retry aborted', 'AbortError');\n    }\n\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error;\n\n      if (attempt >= maxAttempts || !shouldRetry(error, attempt)) {\n        throw error;\n      }\n\n      const delay = exponentialBackoff\n        ? Math.min(baseDelay * Math.pow(2, attempt - 1), maxDelay)\n        : baseDelay;\n\n      if (onRetry) {\n        onRetry(error, attempt, delay);\n      }\n\n      await sleep(delay, signal);\n    }\n  }\n\n  throw lastError;\n}\n\n/**\n * Sleep for a specified duration\n */\nexport function sleep(ms: number, signal?: AbortSignal): Promise<void> {\n  return new Promise((resolve, reject) => {\n    if (signal?.aborted) {\n      reject(new DOMException('Sleep aborted', 'AbortError'));\n      return;\n    }\n\n    const timeoutId = setTimeout(resolve, ms);\n\n    if (signal) {\n      const abortHandler = () => {\n        clearTimeout(timeoutId);\n        reject(new DOMException('Sleep aborted', 'AbortError'));\n      };\n      signal.addEventListener('abort', abortHandler, { once: true });\n    }\n  });\n}\n\n/**\n * Debounce a function\n */\nexport function debounce<T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  delay: number\n): (...args: Parameters<T>) => void {\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n  return (...args: Parameters<T>) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      fn(...args);\n      timeoutId = null;\n    }, delay);\n  };\n}\n\n/**\n * Throttle a function\n */\nexport function throttle<T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  delay: number\n): (...args: Parameters<T>) => void {\n  let lastCall = 0;\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n  return (...args: Parameters<T>) => {\n    const now = Date.now();\n\n    if (now - lastCall >= delay) {\n      lastCall = now;\n      fn(...args);\n    } else if (!timeoutId) {\n      timeoutId = setTimeout(\n        () => {\n          lastCall = Date.now();\n          timeoutId = null;\n          fn(...args);\n        },\n        delay - (now - lastCall)\n      );\n    }\n  };\n}\n\n/**\n * Create an AbortController with timeout\n */\nexport function createTimeoutController(\n  timeoutMs: number\n): { controller: AbortController; cleanup: () => void } {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n  return {\n    controller,\n    cleanup: () => clearTimeout(timeoutId),\n  };\n}\n\n/**\n * Race a promise against a timeout\n */\nexport async function withTimeout<T>(\n  promise: Promise<T>,\n  timeoutMs: number,\n  errorMessage = 'Operation timed out'\n): Promise<T> {\n  let timeoutId: ReturnType<typeof setTimeout>;\n\n  const timeoutPromise = new Promise<never>((_, reject) => {\n    timeoutId = setTimeout(() => {\n      reject(new Error(errorMessage));\n    }, timeoutMs);\n  });\n\n  try {\n    return await Promise.race([promise, timeoutPromise]);\n  } finally {\n    clearTimeout(timeoutId!);\n  }\n}\n","/**\n * E-Sign Landing Page Controller\n * Handles dynamic stats loading and page initialization for the landing page\n */\n\nimport type { ESignPageConfig, AgreementStats } from '../types.js';\nimport { ESignAPIClient, createESignClient } from '../api-client.js';\nimport { onReady, updateDataText, getPageConfig } from '../utils/dom-helpers.js';\n\nexport interface LandingPageConfig extends ESignPageConfig {\n  initialStats?: Partial<AgreementStats>;\n}\n\n/**\n * Landing page controller\n * Fetches and displays agreement statistics dynamically\n */\nexport class LandingPageController {\n  private readonly config: LandingPageConfig;\n  private readonly client: ESignAPIClient;\n\n  constructor(config: LandingPageConfig) {\n    this.config = config;\n    this.client = createESignClient({\n      basePath: config.basePath,\n      apiBasePath: config.apiBasePath,\n    });\n  }\n\n  /**\n   * Initialize the landing page\n   */\n  async init(): Promise<void> {\n    try {\n      await this.loadStats();\n    } catch (err) {\n      console.debug('Could not fetch agreement stats:', err);\n    }\n  }\n\n  /**\n   * Load and display agreement statistics\n   */\n  private async loadStats(): Promise<void> {\n    const stats = await this.client.getAgreementStats();\n\n    updateDataText('count=\"draft\"', stats.draft);\n    updateDataText('count=\"pending\"', stats.pending);\n    updateDataText('count=\"completed\"', stats.completed);\n    updateDataText('count=\"action_required\"', stats.action_required);\n\n    // Also update using the standard data attribute pattern\n    this.updateStatElement('draft', stats.draft);\n    this.updateStatElement('pending', stats.pending);\n    this.updateStatElement('completed', stats.completed);\n    this.updateStatElement('action_required', stats.action_required);\n  }\n\n  /**\n   * Update a stat element by key\n   */\n  private updateStatElement(key: string, value: number): void {\n    const el = document.querySelector(`[data-esign-count=\"${key}\"]`);\n    if (el) {\n      el.textContent = String(value);\n    }\n  }\n}\n\n/**\n * Auto-initialize landing page from page config\n */\nexport function initLandingPage(config?: LandingPageConfig): LandingPageController {\n  const pageConfig =\n    config ||\n    getPageConfig<LandingPageConfig>(\n      '[data-esign-page=\"admin.landing\"], [data-esign-page=\"landing\"]'\n    );\n\n  if (!pageConfig) {\n    throw new Error('Landing page config not found. Add data-esign-page=\"landing\" with config.');\n  }\n\n  const controller = new LandingPageController(pageConfig);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap landing page from inline config (for migration compatibility)\n */\nexport function bootstrapLandingPage(basePath: string, apiBasePath?: string): void {\n  const config: LandingPageConfig = {\n    basePath,\n    apiBasePath: apiBasePath || `${basePath}/api`,\n  };\n\n  const controller = new LandingPageController(config);\n  onReady(() => controller.init());\n}\n\n// Auto-init if page marker is present\nif (typeof document !== 'undefined') {\n  onReady(() => {\n    const pageEl = document.querySelector(\n      '[data-esign-page=\"admin.landing\"], [data-esign-page=\"landing\"]'\n    );\n    if (pageEl) {\n      const configScript = document.getElementById('esign-page-config');\n      const configAttr = pageEl.getAttribute('data-esign-config');\n      const rawConfig = (() => {\n        if (configScript?.textContent) {\n          try {\n            return JSON.parse(configScript.textContent) as Record<string, unknown>;\n          } catch (e) {\n            console.warn('Failed to parse landing page config script:', e);\n          }\n        }\n        if (configAttr) {\n          try {\n            return JSON.parse(configAttr) as Record<string, unknown>;\n          } catch (e) {\n            console.warn('Failed to parse landing page config attribute:', e);\n          }\n        }\n        return null;\n      })();\n      if (rawConfig) {\n        const basePath = String(rawConfig.basePath || rawConfig.base_path || '/admin');\n        const apiBasePath = String(\n          rawConfig.apiBasePath || rawConfig.api_base_path || `${basePath}/api`\n        );\n        const controller = new LandingPageController({ basePath, apiBasePath });\n        controller.init();\n      }\n    }\n  });\n}\n","/**\n * E-Sign Signer Complete Page Controller\n * Handles artifact loading and display after signing completion\n */\n\nimport type { ESignPageConfig } from '../types.js';\nimport { onReady, qs, show, hide } from '../utils/dom-helpers.js';\nimport { poll } from '../utils/async-helpers.js';\n\nexport interface SignerCompleteConfig extends ESignPageConfig {\n  token: string;\n  apiBasePath: string;\n  agreementCompleted: boolean;\n  hasServerDownloadUrl: boolean;\n}\n\nexport interface ArtifactUrls {\n  executed: string | null;\n  source: string | null;\n  certificate: string | null;\n}\n\ninterface ArtifactState {\n  loaded: boolean;\n  loading: boolean;\n  hasArtifacts: boolean;\n  retryCount: number;\n  maxRetries: number;\n}\n\n/**\n * Signer completion page controller\n * Manages artifact loading states and display\n */\nexport class SignerCompletePageController {\n  private readonly config: SignerCompleteConfig;\n  private state: ArtifactState = {\n    loaded: false,\n    loading: false,\n    hasArtifacts: false,\n    retryCount: 0,\n    maxRetries: 3,\n  };\n\n  constructor(config: SignerCompleteConfig) {\n    this.config = config;\n  }\n\n  /**\n   * Initialize the completion page\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    await this.loadArtifacts();\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const retryBtn = qs('#retry-artifacts-btn');\n    if (retryBtn) {\n      retryBtn.addEventListener('click', () => this.loadArtifacts());\n    }\n  }\n\n  /**\n   * Load artifacts from the assets endpoint\n   */\n  async loadArtifacts(): Promise<void> {\n    if (this.state.loading) return;\n\n    this.state.loading = true;\n    this.showArtifactState('loading');\n\n    try {\n      const response = await fetch(\n        `${this.config.apiBasePath}/assets/${this.config.token}`,\n        {\n          method: 'GET',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error('Failed to load artifacts');\n      }\n\n      const payload = await response.json();\n      const assets = payload?.assets || {};\n      const artifacts = this.resolveArtifacts(assets);\n\n      if (artifacts) {\n        this.state.hasArtifacts = true;\n        this.displayArtifacts(artifacts);\n        this.showArtifactState('available');\n      } else if (this.config.agreementCompleted) {\n        // Agreement is complete but artifacts not yet generated - show processing state\n        this.showArtifactState('processing');\n        // Schedule a retry after a delay\n        if (this.state.retryCount < this.state.maxRetries) {\n          this.state.retryCount++;\n          setTimeout(() => this.loadArtifacts(), 5000);\n        }\n      } else {\n        // Agreement not complete yet - show processing (waiting for other signers)\n        this.showArtifactState('processing');\n      }\n\n      this.state.loaded = true;\n    } catch (error) {\n      console.error('Artifact load error:', error);\n\n      // If we have a server-rendered fallback, use it\n      if (this.config.hasServerDownloadUrl) {\n        this.showArtifactState('fallback');\n      } else {\n        this.showArtifactState('unavailable');\n      }\n    } finally {\n      this.state.loading = false;\n    }\n  }\n\n  /**\n   * Resolve binary asset URLs from the assets response.\n   * Never uses contract_url (which returns JSON).\n   */\n  private resolveArtifacts(\n    assets: Record<string, string | undefined>\n  ): ArtifactUrls | null {\n    const artifacts: ArtifactUrls = {\n      executed: assets.executed_url || null,\n      source: assets.source_url || null,\n      certificate: assets.certificate_url || null,\n    };\n\n    const hasAny = !!(\n      artifacts.executed ||\n      artifacts.source ||\n      artifacts.certificate\n    );\n\n    return hasAny ? artifacts : null;\n  }\n\n  /**\n   * Show a specific artifact section and hide others\n   */\n  private showArtifactState(state: string): void {\n    const states = ['loading', 'processing', 'available', 'unavailable', 'fallback'];\n    states.forEach((s) => {\n      const el = qs(`#artifacts-${s}`);\n      if (el) {\n        if (s === state) {\n          show(el as HTMLElement);\n        } else {\n          hide(el as HTMLElement);\n        }\n      }\n    });\n  }\n\n  /**\n   * Display available artifacts in the UI\n   */\n  private displayArtifacts(artifacts: ArtifactUrls): void {\n    if (artifacts.executed) {\n      const container = qs('#artifact-executed');\n      const link = qs<HTMLAnchorElement>('#artifact-executed-link');\n      if (container && link) {\n        link.href = new URL(artifacts.executed, window.location.origin).toString();\n        show(container as HTMLElement);\n      }\n    }\n\n    if (artifacts.source) {\n      const container = qs('#artifact-source');\n      const link = qs<HTMLAnchorElement>('#artifact-source-link');\n      if (container && link) {\n        link.href = new URL(artifacts.source, window.location.origin).toString();\n        show(container as HTMLElement);\n      }\n    }\n\n    if (artifacts.certificate) {\n      const container = qs('#artifact-certificate');\n      const link = qs<HTMLAnchorElement>('#artifact-certificate-link');\n      if (container && link) {\n        link.href = new URL(artifacts.certificate, window.location.origin).toString();\n        show(container as HTMLElement);\n      }\n    }\n  }\n\n  /**\n   * Get current state (for testing)\n   */\n  getState(): ArtifactState {\n    return { ...this.state };\n  }\n}\n\n/**\n * Initialize signer complete page from config\n */\nexport function initSignerCompletePage(\n  config: SignerCompleteConfig\n): SignerCompletePageController {\n  const controller = new SignerCompletePageController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap signer complete page from inline config\n */\nexport function bootstrapSignerCompletePage(config: SignerCompleteConfig): void {\n  const controller = new SignerCompletePageController(config);\n  onReady(() => controller.init());\n\n  // Export for testing and retry functionality\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignCompletionController = controller;\n    (window as unknown as Record<string, unknown>).loadArtifacts = () => controller.loadArtifacts();\n  }\n}\n","/**\n * E-Sign Detail Page Formatters\n * Applies client-side formatting to detail page elements\n */\n\nimport { formatFileSize, formatDateTime } from '../utils/formatters.js';\nimport { onReady, qsa, qs } from '../utils/dom-helpers.js';\n\n/**\n * Apply file size formatting to elements with data-size-bytes attribute\n */\nexport function formatSizeElements(parent: ParentNode = document): void {\n  qsa<HTMLElement>('[data-size-bytes]', parent).forEach((el) => {\n    const bytes = el.getAttribute('data-size-bytes');\n    if (bytes) {\n      el.textContent = formatFileSize(bytes);\n    }\n  });\n}\n\n/**\n * Apply timestamp formatting to elements with data-timestamp attribute\n */\nexport function formatTimestampElements(parent: ParentNode = document): void {\n  qsa<HTMLElement>('[data-timestamp]', parent).forEach((el) => {\n    const ts = el.getAttribute('data-timestamp');\n    if (ts) {\n      el.textContent = formatDateTime(ts);\n    }\n  });\n}\n\n/**\n * Apply all detail page formatters\n */\nexport function applyDetailFormatters(parent: ParentNode = document): void {\n  formatSizeElements(parent);\n  formatTimestampElements(parent);\n}\n\n/**\n * Initialize detail page formatters on DOM ready\n */\nexport function initDetailFormatters(): void {\n  onReady(() => {\n    applyDetailFormatters();\n  });\n}\n\n// Auto-init on module load\nif (typeof document !== 'undefined') {\n  initDetailFormatters();\n}\n","/**\n * E-Sign Google OAuth Callback Page Controller\n * Handles OAuth redirect/callback flow from Google\n */\n\nimport type { ESignPageConfig, GoogleOAuthCallbackData, GoogleOAuthState } from '../types.js';\nimport { qs, show, hide, onReady } from '../utils/dom-helpers.js';\n\nexport interface GoogleCallbackConfig extends ESignPageConfig {\n  /** If popup not opened, redirect to this path on close */\n  fallbackRedirectPath?: string;\n}\n\ntype CallbackState = 'loading' | 'success' | 'error';\n\n/**\n * Error messages for OAuth error codes\n */\nconst ERROR_MESSAGES: Record<string, string> = {\n  access_denied: 'You denied access to your Google account.',\n  invalid_request: 'The authorization request was invalid.',\n  unauthorized_client: 'This application is not authorized.',\n  unsupported_response_type: 'The response type is not supported.',\n  invalid_scope: 'The requested scope is invalid.',\n  server_error: 'Google encountered a server error.',\n  temporarily_unavailable: 'Google is temporarily unavailable. Please try again.',\n  unknown: 'Authorization failed.',\n};\n\n/**\n * Google OAuth callback page controller\n * Handles the OAuth redirect from Google and communicates back to the opener window\n */\nexport class GoogleCallbackController {\n  private readonly config: GoogleCallbackConfig;\n  private readonly elements: {\n    loadingState: HTMLElement | null;\n    successState: HTMLElement | null;\n    errorState: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    errorDetail: HTMLElement | null;\n    closeBtn: HTMLElement | null;\n  };\n\n  constructor(config: GoogleCallbackConfig) {\n    this.config = config;\n    this.elements = {\n      loadingState: qs('#loading-state'),\n      successState: qs('#success-state'),\n      errorState: qs('#error-state'),\n      errorMessage: qs('#error-message'),\n      errorDetail: qs('#error-detail'),\n      closeBtn: qs('#close-btn'),\n    };\n  }\n\n  /**\n   * Initialize the callback page\n   */\n  init(): void {\n    this.setupEventListeners();\n    this.processCallback();\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const { closeBtn } = this.elements;\n\n    if (closeBtn) {\n      closeBtn.addEventListener('click', () => this.handleClose());\n    }\n  }\n\n  /**\n   * Process the OAuth callback parameters\n   */\n  private processCallback(): void {\n    const params = new URLSearchParams(window.location.search);\n    const code = params.get('code');\n    const error = params.get('error');\n    const errorDescription = params.get('error_description');\n    const state = params.get('state');\n\n    // Parse state to extract user_id and account_id\n    const stateData = this.parseOAuthState(state);\n\n    // Also check for account_id in query params (fallback)\n    if (!stateData.account_id) {\n      stateData.account_id = (params.get('account_id') || '').trim();\n    }\n\n    if (error) {\n      this.handleError(error, errorDescription, stateData);\n    } else if (code) {\n      this.handleSuccess(code, stateData);\n    } else {\n      this.handleError('unknown', 'No authorization code was received from Google.', stateData);\n    }\n  }\n\n  /**\n   * Parse OAuth state parameter\n   */\n  private parseOAuthState(rawState: string | null): GoogleOAuthState {\n    const result: GoogleOAuthState = {\n      user_id: '',\n      account_id: '',\n    };\n\n    if (!rawState) {\n      return result;\n    }\n\n    try {\n      const parsed = JSON.parse(rawState);\n      if (parsed && typeof parsed === 'object') {\n        if (typeof parsed.user_id === 'string') {\n          result.user_id = parsed.user_id.trim();\n        }\n        if (typeof parsed.account_id === 'string') {\n          result.account_id = parsed.account_id.trim();\n        }\n        return result;\n      }\n    } catch {\n      // Backward compatibility: older state payloads may contain only user ID\n    }\n\n    // Fallback: treat raw state as user_id\n    result.user_id = String(rawState || '').trim();\n    return result;\n  }\n\n  /**\n   * Show a specific state and hide others\n   */\n  private showState(state: CallbackState): void {\n    const { loadingState, successState, errorState } = this.elements;\n\n    hide(loadingState);\n    hide(successState);\n    hide(errorState);\n\n    switch (state) {\n      case 'loading':\n        show(loadingState);\n        break;\n      case 'success':\n        show(successState);\n        break;\n      case 'error':\n        show(errorState);\n        break;\n    }\n  }\n\n  /**\n   * Send message to opener window\n   */\n  private sendToOpener(data: GoogleOAuthCallbackData): void {\n    if (window.opener && !window.opener.closed) {\n      window.opener.postMessage(data, window.location.origin);\n    }\n  }\n\n  /**\n   * Handle OAuth error\n   */\n  private handleError(\n    error: string,\n    description: string | null,\n    stateData: GoogleOAuthState\n  ): void {\n    this.showState('error');\n\n    const { errorMessage, errorDetail, closeBtn } = this.elements;\n\n    if (errorMessage) {\n      errorMessage.textContent = ERROR_MESSAGES[error] || ERROR_MESSAGES.unknown;\n    }\n\n    if (description && errorDetail) {\n      errorDetail.textContent = description;\n      show(errorDetail);\n    }\n\n    // Send error to opener\n    this.sendToOpener({\n      type: 'google_oauth_callback',\n      error,\n      error_description: description || undefined,\n      account_id: stateData.account_id || undefined,\n    });\n\n    // If not a popup, change button to redirect\n    this.setupCloseButton(stateData);\n  }\n\n  /**\n   * Handle OAuth success\n   */\n  private handleSuccess(code: string, stateData: GoogleOAuthState): void {\n    this.showState('success');\n\n    // Send success to opener\n    this.sendToOpener({\n      type: 'google_oauth_callback',\n      code,\n      account_id: stateData.account_id || undefined,\n    });\n\n    // Auto-close after a short delay\n    setTimeout(() => {\n      window.close();\n    }, 2000);\n\n    // If not a popup, setup redirect\n    this.setupCloseButton(stateData);\n  }\n\n  /**\n   * Setup close button behavior based on whether this is a popup\n   */\n  private setupCloseButton(stateData: GoogleOAuthState): void {\n    const { closeBtn } = this.elements;\n\n    if (!window.opener && closeBtn) {\n      closeBtn.textContent = 'Return to App';\n    }\n  }\n\n  /**\n   * Handle close button click\n   */\n  private handleClose(): void {\n    if (window.opener) {\n      window.close();\n    } else {\n      // Redirect back to integration page\n      const basePath = this.config.basePath || '/admin';\n      const redirectPath =\n        this.config.fallbackRedirectPath || `${basePath}/esign/integrations/google`;\n\n      const redirectURL = new URL(redirectPath, window.location.origin);\n\n      // Get account_id from URL params if available\n      const params = new URLSearchParams(window.location.search);\n      const state = params.get('state');\n      const stateData = this.parseOAuthState(state);\n      const accountId = stateData.account_id || params.get('account_id');\n\n      if (accountId) {\n        redirectURL.searchParams.set('account_id', accountId);\n      }\n\n      window.location.href = redirectURL.toString();\n    }\n  }\n}\n\n/**\n * Initialize Google callback page from config\n */\nexport function initGoogleCallback(config?: GoogleCallbackConfig): GoogleCallbackController {\n  const pageConfig = config || {\n    basePath: '/admin',\n    apiBasePath: '/admin/api',\n  };\n\n  const controller = new GoogleCallbackController(pageConfig);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap Google callback page (auto-init)\n */\nexport function bootstrapGoogleCallback(basePath: string): void {\n  const config: GoogleCallbackConfig = {\n    basePath,\n    apiBasePath: `${basePath}/api`,\n  };\n\n  const controller = new GoogleCallbackController(config);\n  onReady(() => controller.init());\n}\n","/**\n * E-Sign Google Integration Page Controller\n * Handles Google Drive integration status, OAuth flow, and account management\n */\n\nimport type {\n  GoogleIntegrationStatus,\n  GoogleIntegrationPageConfig,\n  GoogleOAuthCallbackData,\n  GoogleOAuthState,\n  GoogleAccountInfo,\n} from '../types.js';\nimport { qs, show, hide, onReady, announce } from '../utils/dom-helpers.js';\n\ntype IntegrationState = 'loading' | 'disconnected' | 'connected' | 'error';\n\nconst GOOGLE_ACCOUNT_STORAGE_KEY = 'esign.google.account_id';\n\nconst SCOPE_DESCRIPTIONS: Record<string, { label: string; description: string }> = {\n  'https://www.googleapis.com/auth/drive.readonly': {\n    label: 'Drive (Read Only)',\n    description: 'View files in your Google Drive',\n  },\n  openid: {\n    label: 'OpenID',\n    description: 'Verify your Google identity for account linking',\n  },\n  'https://www.googleapis.com/auth/userinfo.email': {\n    label: 'Account Email',\n    description: 'Read your Google account email address',\n  },\n  'https://www.googleapis.com/auth/drive.file': {\n    label: 'Drive (App Files)',\n    description: 'Access files opened with this app',\n  },\n  'drive.readonly': {\n    label: 'Drive (Read Only)',\n    description: 'View files in your Google Drive',\n  },\n  'userinfo.email': {\n    label: 'Account Email',\n    description: 'Read your Google account email address',\n  },\n  'drive.file': {\n    label: 'Drive (App Files)',\n    description: 'Access files opened with this app',\n  },\n};\n\n/**\n * Google integration page controller\n * Manages OAuth flow, connection status, and account switching\n */\nexport class GoogleIntegrationController {\n  private readonly config: GoogleIntegrationPageConfig;\n  private readonly apiBase: string;\n  private currentAccountId: string;\n  private accounts: GoogleAccountInfo[] = [];\n  private oauthWindow: Window | null = null;\n  private oauthTimeout: ReturnType<typeof setTimeout> | null = null;\n  private pendingOAuthAccountId: string | null = null;\n  private pendingDisconnectAccountId: string | null = null;\n  private messageHandler: ((event: MessageEvent) => void) | null = null;\n\n  private readonly elements: {\n    loadingState: HTMLElement | null;\n    disconnectedState: HTMLElement | null;\n    connectedState: HTMLElement | null;\n    errorState: HTMLElement | null;\n    statusBadge: HTMLElement | null;\n    announcements: HTMLElement | null;\n    accountIdInput: HTMLInputElement | null;\n    connectBtn: HTMLElement | null;\n    disconnectBtn: HTMLElement | null;\n    refreshBtn: HTMLElement | null;\n    retryBtn: HTMLElement | null;\n    reauthBtn: HTMLElement | null;\n    oauthModal: HTMLElement | null;\n    oauthCancelBtn: HTMLElement | null;\n    disconnectModal: HTMLElement | null;\n    disconnectCancelBtn: HTMLElement | null;\n    disconnectConfirmBtn: HTMLElement | null;\n    connectedEmail: HTMLElement | null;\n    connectedAccountId: HTMLElement | null;\n    scopesList: HTMLElement | null;\n    expiryInfo: HTMLElement | null;\n    reauthWarning: HTMLElement | null;\n    reauthReason: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    degradedWarning: HTMLElement | null;\n    degradedReason: HTMLElement | null;\n    importDriveLink: HTMLAnchorElement | null;\n    integrationSettingsLink: HTMLAnchorElement | null;\n    // Option A - Dropdown\n    accountDropdown: HTMLSelectElement | null;\n    // Option B - Cards Grid\n    accountsSection: HTMLElement | null;\n    accountsLoading: HTMLElement | null;\n    accountsEmpty: HTMLElement | null;\n    accountsGrid: HTMLElement | null;\n    connectFirstBtn: HTMLElement | null;\n  };\n\n  constructor(config: GoogleIntegrationPageConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n    this.currentAccountId = this.resolveInitialAccountId();\n\n    this.elements = {\n      loadingState: qs('#loading-state'),\n      disconnectedState: qs('#disconnected-state'),\n      connectedState: qs('#connected-state'),\n      errorState: qs('#error-state'),\n      statusBadge: qs('#status-badge'),\n      announcements: qs('#integration-announcements'),\n      accountIdInput: qs<HTMLInputElement>('#account-id-input'),\n      connectBtn: qs('#connect-btn'),\n      disconnectBtn: qs('#disconnect-btn'),\n      refreshBtn: qs('#refresh-status-btn'),\n      retryBtn: qs('#retry-btn'),\n      reauthBtn: qs('#reauth-btn'),\n      oauthModal: qs('#oauth-modal'),\n      oauthCancelBtn: qs('#oauth-cancel-btn'),\n      disconnectModal: qs('#disconnect-modal'),\n      disconnectCancelBtn: qs('#disconnect-cancel-btn'),\n      disconnectConfirmBtn: qs('#disconnect-confirm-btn'),\n      connectedEmail: qs('#connected-email'),\n      connectedAccountId: qs('#connected-account-id'),\n      scopesList: qs('#scopes-list'),\n      expiryInfo: qs('#expiry-info'),\n      reauthWarning: qs('#reauth-warning'),\n      reauthReason: qs('#reauth-reason'),\n      errorMessage: qs('#error-message'),\n      degradedWarning: qs('#degraded-warning'),\n      degradedReason: qs('#degraded-reason'),\n      importDriveLink: qs<HTMLAnchorElement>('#import-drive-link'),\n      integrationSettingsLink: qs<HTMLAnchorElement>('#integration-settings-link'),\n      // Option A - Dropdown\n      accountDropdown: qs<HTMLSelectElement>('#account-dropdown'),\n      // Option B - Cards Grid\n      accountsSection: qs('#accounts-section'),\n      accountsLoading: qs('#accounts-loading'),\n      accountsEmpty: qs('#accounts-empty'),\n      accountsGrid: qs('#accounts-grid'),\n      connectFirstBtn: qs('#connect-first-btn'),\n    };\n  }\n\n  /**\n   * Initialize the integration page\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    this.updateAccountScopeUI();\n    await Promise.all([this.checkStatus(), this.loadAccounts()]);\n  }\n\n  /**\n   * Setup all event listeners\n   */\n  private setupEventListeners(): void {\n    const {\n      connectBtn,\n      disconnectBtn,\n      refreshBtn,\n      retryBtn,\n      reauthBtn,\n      oauthCancelBtn,\n      disconnectCancelBtn,\n      disconnectConfirmBtn,\n      accountIdInput,\n      oauthModal,\n      disconnectModal,\n    } = this.elements;\n\n    // Connect button\n    if (connectBtn) {\n      connectBtn.addEventListener('click', () => this.startOAuthFlow());\n    }\n\n    // Re-auth button\n    if (reauthBtn) {\n      reauthBtn.addEventListener('click', () => this.startOAuthFlow());\n    }\n\n    // Disconnect button\n    if (disconnectBtn) {\n      disconnectBtn.addEventListener('click', () => {\n        this.pendingDisconnectAccountId = this.currentAccountId;\n        if (disconnectModal) {\n          show(disconnectModal);\n        }\n      });\n    }\n\n    // Disconnect modal buttons\n    if (disconnectCancelBtn) {\n      disconnectCancelBtn.addEventListener('click', () => {\n        this.pendingDisconnectAccountId = null;\n        if (disconnectModal) {\n          hide(disconnectModal);\n        }\n      });\n    }\n\n    if (disconnectConfirmBtn) {\n      disconnectConfirmBtn.addEventListener('click', () => this.disconnect());\n    }\n\n    // OAuth modal cancel\n    if (oauthCancelBtn) {\n      oauthCancelBtn.addEventListener('click', () => this.cancelOAuthFlow());\n    }\n\n    // Refresh and retry buttons\n    if (refreshBtn) {\n      refreshBtn.addEventListener('click', () => this.checkStatus());\n    }\n\n    if (retryBtn) {\n      retryBtn.addEventListener('click', () => this.checkStatus());\n    }\n\n    // Account ID input (fallback manual entry)\n    if (accountIdInput) {\n      accountIdInput.addEventListener('change', () => {\n        this.setCurrentAccountId(accountIdInput.value, true);\n      });\n\n      accountIdInput.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter') {\n          event.preventDefault();\n          this.setCurrentAccountId(accountIdInput.value, true);\n        }\n      });\n    }\n\n    // Account dropdown (Option A)\n    const { accountDropdown, connectFirstBtn } = this.elements;\n    if (accountDropdown) {\n      accountDropdown.addEventListener('change', () => {\n        if (accountDropdown.value === '__new__') {\n          // Reset to current and start OAuth\n          accountDropdown.value = this.currentAccountId;\n          this.startOAuthFlowForNewAccount();\n        } else {\n          this.setCurrentAccountId(accountDropdown.value, true);\n        }\n      });\n    }\n\n    // Connect first button (Option B - empty state)\n    if (connectFirstBtn) {\n      connectFirstBtn.addEventListener('click', () => this.startOAuthFlowForNewAccount());\n    }\n\n    // Close modals on escape\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (oauthModal && !oauthModal.classList.contains('hidden')) {\n          this.cancelOAuthFlow();\n        }\n        if (disconnectModal && !disconnectModal.classList.contains('hidden')) {\n          this.pendingDisconnectAccountId = null;\n          hide(disconnectModal);\n        }\n      }\n    });\n\n    // Close modals on backdrop click\n    [oauthModal, disconnectModal].forEach((modal) => {\n      if (modal) {\n        modal.addEventListener('click', (e) => {\n          const target = e.target as HTMLElement;\n          if (target === modal || target.getAttribute('aria-hidden') === 'true') {\n            hide(modal);\n            if (modal === oauthModal) {\n              this.cancelOAuthFlow();\n            } else if (modal === disconnectModal) {\n              this.pendingDisconnectAccountId = null;\n            }\n          }\n        });\n      }\n    });\n  }\n\n  /**\n   * Resolve initial account ID from various sources\n   */\n  private resolveInitialAccountId(): string {\n    // 1. Check URL query params\n    const params = new URLSearchParams(window.location.search);\n    const fromQuery = this.normalizeAccountId(params.get('account_id'));\n    if (fromQuery) {\n      return fromQuery;\n    }\n\n    // 2. Check template config\n    const fromTemplate = this.normalizeAccountId(this.config.googleAccountId);\n    if (fromTemplate) {\n      return fromTemplate;\n    }\n\n    // 3. Check localStorage\n    try {\n      return this.normalizeAccountId(\n        window.localStorage.getItem(GOOGLE_ACCOUNT_STORAGE_KEY)\n      );\n    } catch {\n      return '';\n    }\n  }\n\n  /**\n   * Normalize account ID value\n   */\n  private normalizeAccountId(value: string | null | undefined): string {\n    return (value || '').trim();\n  }\n\n  /**\n   * Set current account ID and optionally refresh status\n   */\n  private setCurrentAccountId(value: string, refreshStatus = false): void {\n    const normalized = this.normalizeAccountId(value);\n    if (normalized === this.currentAccountId) {\n      this.updateAccountScopeUI();\n      return;\n    }\n\n    this.currentAccountId = normalized;\n    this.updateAccountScopeUI();\n\n    if (refreshStatus) {\n      this.checkStatus();\n    }\n  }\n\n  /**\n   * Resolve account ID for \"connect new account\" flow\n   */\n  private resolveNewAccountId(): string {\n    const { accountIdInput } = this.elements;\n    const manualValue = this.normalizeAccountId(accountIdInput?.value);\n    if (!manualValue) {\n      return '';\n    }\n    const isExisting = this.accounts.some(\n      (account) => this.normalizeAccountId(account.account_id) === manualValue\n    );\n    return isExisting ? '' : manualValue;\n  }\n\n  /**\n   * Start OAuth flow using a new/manual account ID\n   */\n  private startOAuthFlowForNewAccount(): void {\n    const accountID = this.resolveNewAccountId();\n    if (!accountID && this.accounts.length > 0) {\n      this.showToast(\n        'Enter a unique account ID (for example: work) before connecting another account.',\n        'error'\n      );\n      this.announce('Enter a unique account ID before connecting another account');\n      const { accountIdInput } = this.elements;\n      if (accountIdInput) {\n        accountIdInput.focus();\n        accountIdInput.select();\n      }\n      return;\n    }\n    if (accountID !== this.currentAccountId) {\n      this.setCurrentAccountId(accountID, false);\n    }\n    this.startOAuthFlow(accountID);\n  }\n\n  /**\n   * Update UI elements related to account scope\n   */\n  private updateAccountScopeUI(): void {\n    const { accountIdInput, connectedAccountId, importDriveLink, integrationSettingsLink } =\n      this.elements;\n\n    // Update input\n    if (accountIdInput) {\n      if (document.activeElement !== accountIdInput) {\n        accountIdInput.value = this.currentAccountId;\n      }\n    }\n\n    // Update connected account display\n    if (connectedAccountId) {\n      connectedAccountId.textContent = this.currentAccountId\n        ? `Account ID: ${this.currentAccountId}`\n        : 'Account ID: default';\n    }\n\n    // Persist to storage\n    this.persistAccountId();\n\n    // Sync URL\n    this.syncAccountIdInURL();\n\n    // Update links\n    this.updateScopedLinks([importDriveLink, integrationSettingsLink]);\n    this.renderAccountDropdown();\n    this.renderAccountsGrid();\n  }\n\n  /**\n   * Persist account ID to localStorage\n   */\n  private persistAccountId(): void {\n    try {\n      if (this.currentAccountId) {\n        window.localStorage.setItem(GOOGLE_ACCOUNT_STORAGE_KEY, this.currentAccountId);\n      } else {\n        window.localStorage.removeItem(GOOGLE_ACCOUNT_STORAGE_KEY);\n      }\n    } catch {\n      // Ignore storage failures\n    }\n  }\n\n  /**\n   * Sync account ID to URL without navigation\n   */\n  private syncAccountIdInURL(): void {\n    const url = new URL(window.location.href);\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      url.searchParams.delete('account_id');\n    }\n    window.history.replaceState({}, '', url.toString());\n  }\n\n  /**\n   * Update scoped links with current account ID\n   */\n  private updateScopedLinks(links: (HTMLAnchorElement | null)[]): void {\n    links.forEach((link) => {\n      if (!link) return;\n      const baseHref = link.dataset.baseHref || link.getAttribute('href');\n      if (!baseHref) return;\n      link.setAttribute('href', this.applyAccountIdToPath(baseHref));\n    });\n  }\n\n  /**\n   * Apply account ID to a path/URL\n   */\n  private applyAccountIdToPath(pathOrURL: string): string {\n    const parsed = new URL(pathOrURL, window.location.origin);\n    if (this.currentAccountId) {\n      parsed.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      parsed.searchParams.delete('account_id');\n    }\n    return `${parsed.pathname}${parsed.search}${parsed.hash}`;\n  }\n\n  /**\n   * Build API URL with user/account scope\n   */\n  private buildScopedAPIURL(path: string, accountId = this.currentAccountId): string {\n    const url = new URL(`${this.apiBase}${path}`, window.location.origin);\n    url.searchParams.set('user_id', this.config.userId || '');\n    if (accountId) {\n      url.searchParams.set('account_id', accountId);\n    }\n    return url.toString();\n  }\n\n  /**\n   * Announce message to screen readers\n   */\n  private announce(message: string): void {\n    const { announcements } = this.elements;\n    if (announcements) {\n      announcements.textContent = message;\n    }\n    announce(message);\n  }\n\n  /**\n   * Show a specific state and hide others\n   */\n  private showState(state: IntegrationState): void {\n    const { loadingState, disconnectedState, connectedState, errorState } = this.elements;\n\n    hide(loadingState);\n    hide(disconnectedState);\n    hide(connectedState);\n    hide(errorState);\n\n    switch (state) {\n      case 'loading':\n        show(loadingState);\n        break;\n      case 'disconnected':\n        show(disconnectedState);\n        break;\n      case 'connected':\n        show(connectedState);\n        break;\n      case 'error':\n        show(errorState);\n        break;\n    }\n  }\n\n  /**\n   * Update status badge\n   */\n  private updateStatusBadge(\n    connected: boolean,\n    expiring = false,\n    degraded = false\n  ): void {\n    const { statusBadge } = this.elements;\n    if (!statusBadge) return;\n\n    if (degraded) {\n      statusBadge.innerHTML = `\n        <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-700\">\n          <span class=\"w-2 h-2 rounded-full bg-amber-500\" aria-hidden=\"true\"></span>\n          Degraded\n        </span>\n      `;\n      return;\n    }\n\n    if (connected) {\n      if (expiring) {\n        statusBadge.innerHTML = `\n          <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-700\">\n            <span class=\"w-2 h-2 rounded-full bg-amber-500\" aria-hidden=\"true\"></span>\n            Expiring Soon\n          </span>\n        `;\n      } else {\n        statusBadge.innerHTML = `\n          <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700\">\n            <span class=\"w-2 h-2 rounded-full bg-green-500\" aria-hidden=\"true\"></span>\n            Connected\n          </span>\n        `;\n      }\n    } else {\n      statusBadge.innerHTML = `\n        <span class=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600\">\n          <span class=\"w-2 h-2 rounded-full bg-gray-400\" aria-hidden=\"true\"></span>\n          Not Connected\n        </span>\n      `;\n    }\n  }\n\n  /**\n   * Check integration status from API\n   */\n  async checkStatus(): Promise<void> {\n    this.showState('loading');\n\n    try {\n      const response = await fetch(\n        this.buildScopedAPIURL('/esign/integrations/google/status'),\n        {\n          credentials: 'same-origin',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          // Not connected\n          this.showState('disconnected');\n          this.updateStatusBadge(false);\n          this.announce('Google Drive is not connected');\n          return;\n        }\n\n        let message = `Failed to check status: ${response.status}`;\n        try {\n          const errorData = await response.json();\n          if (errorData?.error?.message) {\n            message = errorData.error.message;\n          }\n        } catch {\n          // Ignore parse errors\n        }\n        throw new Error(message);\n      }\n\n      const data = await response.json();\n      const integration = this.normalizeIntegrationPayload(data.integration || {});\n\n      // Update account ID if returned from API\n      if (!this.currentAccountId && integration.account_id) {\n        this.currentAccountId = integration.account_id;\n        this.updateAccountScopeUI();\n      }\n\n      // Render degraded state\n      const isDegraded = integration.degraded === true;\n      this.renderDegradedState(isDegraded, integration.degraded_reason);\n\n      if (integration.connected) {\n        this.renderConnectedState(integration);\n        this.showState('connected');\n        this.updateStatusBadge(true, integration.needs_reauthorization, isDegraded);\n        this.announce(\n          isDegraded\n            ? 'Google Drive connected with degraded provider health'\n            : 'Google Drive is connected'\n        );\n      } else {\n        this.showState('disconnected');\n        this.updateStatusBadge(false, false, isDegraded);\n        this.announce(\n          isDegraded\n            ? 'Google Drive integration is degraded'\n            : 'Google Drive is not connected'\n        );\n      }\n    } catch (error) {\n      console.error('Error checking status:', error);\n      const { errorMessage } = this.elements;\n      if (errorMessage) {\n        errorMessage.textContent =\n          error instanceof Error\n            ? error.message\n            : 'An error occurred while checking the integration status.';\n      }\n      this.showState('error');\n      this.renderDegradedState(false, '');\n      this.updateStatusBadge(false);\n      this.announce('Error checking Google Drive status');\n    }\n  }\n\n  /**\n   * Normalize integration payload from API (handles both camelCase and snake_case)\n   */\n  private normalizeIntegrationPayload(\n    raw: Record<string, unknown>\n  ): GoogleIntegrationStatus {\n    const firstDefined = <T>(keys: string[], fallback: T): T => {\n      for (const key of keys) {\n        if (Object.prototype.hasOwnProperty.call(raw, key) && raw[key] !== undefined && raw[key] !== null) {\n          return raw[key] as T;\n        }\n      }\n      return fallback;\n    };\n\n    const expiresAt = firstDefined<string>(['expires_at', 'ExpiresAt'], '');\n    const scopes = firstDefined<string[]>(['scopes', 'Scopes'], []);\n    const accountId = this.normalizeAccountId(\n      firstDefined<string>(['account_id', 'AccountID'], '')\n    );\n    const connected = firstDefined<boolean>(['connected', 'Connected'], false);\n    const degraded = firstDefined<boolean>(['degraded', 'Degraded'], false);\n    const degradedReason = firstDefined<string>(['degraded_reason', 'DegradedReason'], '');\n    const email = firstDefined<string>(\n      ['email', 'user_email', 'account_email', 'AccountEmail'],\n      ''\n    );\n    const canAutoRefresh = firstDefined<boolean>(\n      ['can_auto_refresh', 'CanAutoRefresh'],\n      false\n    );\n    const explicitNeedsReauth = firstDefined<boolean | undefined>(\n      ['needs_reauthorization', 'NeedsReauthorization', 'NeedsReauth'],\n      undefined\n    );\n\n    let isExpired = firstDefined<boolean | undefined>(['is_expired', 'IsExpired'], undefined);\n    let isExpiringSoon = firstDefined<boolean | undefined>(\n      ['is_expiring_soon', 'IsExpiringSoon'],\n      undefined\n    );\n\n    // Compute expiry if not provided\n    if (typeof isExpired !== 'boolean' || typeof isExpiringSoon !== 'boolean') {\n      if (expiresAt) {\n        const expiryDate = new Date(expiresAt);\n        if (!Number.isNaN(expiryDate.getTime())) {\n          const deltaMs = expiryDate.getTime() - Date.now();\n          const expiringSoonMs = 5 * 60 * 1000;\n          isExpired = deltaMs <= 0;\n          isExpiringSoon = deltaMs > 0 && deltaMs <= expiringSoonMs;\n        }\n      }\n    }\n\n    const needsReauthorization =\n      typeof explicitNeedsReauth === 'boolean'\n        ? explicitNeedsReauth\n        : (isExpired === true || isExpiringSoon === true) && !canAutoRefresh;\n\n    return {\n      connected,\n      account_id: accountId,\n      email,\n      scopes: Array.isArray(scopes) ? scopes : [],\n      expires_at: expiresAt,\n      is_expired: isExpired === true,\n      is_expiring_soon: isExpiringSoon === true,\n      can_auto_refresh: canAutoRefresh,\n      needs_reauthorization: needsReauthorization,\n      degraded,\n      degraded_reason: degradedReason,\n    };\n  }\n\n  /**\n   * Render connected state details\n   */\n  private renderConnectedState(integration: GoogleIntegrationStatus): void {\n    const { connectedEmail, connectedAccountId, scopesList, expiryInfo, reauthWarning, reauthReason } =\n      this.elements;\n\n    // Email\n    if (connectedEmail) {\n      connectedEmail.textContent = integration.email || 'Connected';\n    }\n\n    // Account ID\n    if (connectedAccountId) {\n      connectedAccountId.textContent =\n        integration.account_id || this.currentAccountId\n          ? `Account ID: ${integration.account_id || this.currentAccountId}`\n          : 'Account ID: default';\n    }\n\n    // Scopes\n    this.renderScopes(integration.scopes || []);\n\n    // Expiry\n    this.renderExpiry(\n      integration.expires_at,\n      integration.is_expired,\n      integration.is_expiring_soon,\n      integration.can_auto_refresh,\n      integration.needs_reauthorization\n    );\n  }\n\n  /**\n   * Render scopes list\n   */\n  private renderScopes(scopes: string[]): void {\n    const { scopesList } = this.elements;\n    if (!scopesList) return;\n\n    if (!scopes || scopes.length === 0) {\n      scopesList.innerHTML =\n        '<li class=\"text-sm text-gray-500\">No specific scopes granted</li>';\n      return;\n    }\n\n    scopesList.innerHTML = scopes\n      .map((scope) => {\n        const info = SCOPE_DESCRIPTIONS[scope] || { label: scope, description: '' };\n        return `\n        <li class=\"flex items-start gap-2\">\n          <svg class=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n          </svg>\n          <div>\n            <span class=\"text-sm font-medium text-gray-700\">${this.escapeHtml(info.label)}</span>\n            ${info.description ? `<p class=\"text-xs text-gray-500\">${this.escapeHtml(info.description)}</p>` : ''}\n          </div>\n        </li>\n      `;\n      })\n      .join('');\n  }\n\n  /**\n   * Render token expiry information\n   */\n  private renderExpiry(\n    expiryTime: string | undefined,\n    isExpired: boolean | undefined,\n    isExpiringSoon: boolean | undefined,\n    canAutoRefresh: boolean | undefined,\n    needsReauthorization: boolean | undefined\n  ): void {\n    const { expiryInfo, reauthWarning, reauthReason } = this.elements;\n    if (!expiryInfo) return;\n\n    expiryInfo.classList.remove('text-red-600', 'text-amber-600');\n    expiryInfo.classList.add('text-gray-500');\n\n    if (!expiryTime) {\n      expiryInfo.textContent = 'Access token status unknown';\n      if (reauthWarning) hide(reauthWarning);\n      return;\n    }\n\n    const expiryDate = new Date(expiryTime);\n    const now = new Date();\n    const minutesLeft = Math.max(\n      1,\n      Math.round((expiryDate.getTime() - now.getTime()) / (1000 * 60))\n    );\n\n    if (isExpired) {\n      if (canAutoRefresh) {\n        expiryInfo.textContent =\n          'Access token expired, but refresh is available and will be applied automatically.';\n        expiryInfo.classList.remove('text-gray-500');\n        expiryInfo.classList.add('text-amber-600');\n        if (reauthWarning) hide(reauthWarning);\n      } else {\n        expiryInfo.textContent = 'Access token has expired. Please re-authorize.';\n        expiryInfo.classList.remove('text-gray-500');\n        expiryInfo.classList.add('text-red-600');\n        if (reauthWarning) show(reauthWarning);\n        if (reauthReason) {\n          reauthReason.textContent =\n            'Your access token has expired and cannot be refreshed automatically. Re-authorize to continue using Google Drive import.';\n        }\n      }\n    } else if (isExpiringSoon) {\n      expiryInfo.classList.remove('text-gray-500');\n      expiryInfo.classList.add('text-amber-600');\n      if (canAutoRefresh) {\n        expiryInfo.textContent = `Token expires in approximately ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''}. Refresh is available automatically.`;\n        if (reauthWarning) hide(reauthWarning);\n      } else {\n        expiryInfo.textContent = `Token expires in approximately ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''}`;\n        if (reauthWarning) show(reauthWarning);\n        if (reauthReason) {\n          reauthReason.textContent = `Your access token will expire in ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''} and cannot be refreshed automatically. Re-authorize now to avoid interruption.`;\n        }\n      }\n    } else {\n      expiryInfo.textContent = `Token valid until ${expiryDate.toLocaleDateString()} ${expiryDate.toLocaleTimeString()}`;\n      if (reauthWarning) hide(reauthWarning);\n    }\n\n    if (!needsReauthorization && reauthWarning) {\n      hide(reauthWarning);\n    }\n  }\n\n  /**\n   * Render degraded provider state\n   */\n  private renderDegradedState(isDegraded: boolean, reason?: string): void {\n    const { degradedWarning, degradedReason } = this.elements;\n    if (!degradedWarning) return;\n\n    if (isDegraded) {\n      show(degradedWarning);\n      if (degradedReason) {\n        degradedReason.textContent =\n          reason ||\n          'Google API health checks are failing. Import actions may be unavailable until provider recovery.';\n      }\n    } else {\n      hide(degradedWarning);\n    }\n  }\n\n  // Account Management Methods\n\n  /**\n   * Load all connected Google accounts\n   */\n  async loadAccounts(): Promise<void> {\n    try {\n      const url = this.buildScopedAPIURL('/esign/integrations/google/accounts');\n      const response = await fetch(url, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) {\n        console.warn('Failed to load accounts:', response.status);\n        this.accounts = [];\n        this.renderAccountDropdown();\n        this.renderAccountsGrid();\n        return;\n      }\n\n      const data = await response.json();\n      this.accounts = data.accounts || [];\n      this.updateAccountScopeUI();\n    } catch (error) {\n      console.error('Error loading accounts:', error);\n      this.accounts = [];\n      this.updateAccountScopeUI();\n    }\n  }\n\n  /**\n   * Render the account dropdown (Option A)\n   */\n  private renderAccountDropdown(): void {\n    const { accountDropdown } = this.elements;\n    if (!accountDropdown) return;\n\n    accountDropdown.innerHTML = '';\n\n    // Add default/placeholder option\n    const defaultOption = document.createElement('option');\n    defaultOption.value = '';\n    defaultOption.textContent = 'Default Account';\n    if (!this.currentAccountId) {\n      defaultOption.selected = true;\n    }\n    accountDropdown.appendChild(defaultOption);\n\n    // Add connected accounts\n    const seenAccountIDs = new Set<string>(['']);\n    for (const account of this.accounts) {\n      const accountID = this.normalizeAccountId(account.account_id);\n      if (seenAccountIDs.has(accountID)) {\n        continue;\n      }\n      seenAccountIDs.add(accountID);\n      const option = document.createElement('option');\n      option.value = accountID;\n      const label = account.email || accountID || 'Default';\n      const statusBadge = account.status !== 'connected' ? ` (${account.status})` : '';\n      option.textContent = `${label}${statusBadge}`;\n      if (accountID === this.currentAccountId) {\n        option.selected = true;\n      }\n      accountDropdown.appendChild(option);\n    }\n\n    if (this.currentAccountId && !seenAccountIDs.has(this.currentAccountId)) {\n      const customOption = document.createElement('option');\n      customOption.value = this.currentAccountId;\n      customOption.textContent = `${this.currentAccountId} (new)`;\n      customOption.selected = true;\n      accountDropdown.appendChild(customOption);\n    }\n\n    // Add \"Connect new account\" option\n    const addNewOption = document.createElement('option');\n    addNewOption.value = '__new__';\n    addNewOption.textContent = '+ Connect New Account...';\n    accountDropdown.appendChild(addNewOption);\n  }\n\n  /**\n   * Render the accounts cards grid (Option B)\n   */\n  private renderAccountsGrid(): void {\n    const { accountsLoading, accountsEmpty, accountsGrid } = this.elements;\n\n    if (accountsLoading) hide(accountsLoading);\n\n    if (this.accounts.length === 0) {\n      if (accountsEmpty) show(accountsEmpty);\n      if (accountsGrid) hide(accountsGrid);\n      return;\n    }\n\n    if (accountsEmpty) hide(accountsEmpty);\n    if (accountsGrid) {\n      show(accountsGrid);\n      accountsGrid.innerHTML =\n        this.accounts.map((account) => this.renderAccountCard(account)).join('') +\n        this.renderConnectNewCard();\n      this.attachCardEventListeners();\n    }\n  }\n\n  /**\n   * Render a single account card\n   */\n  private renderAccountCard(account: GoogleAccountInfo): string {\n    const isActive =\n      account.account_id === this.currentAccountId ||\n      (account.is_default && !this.currentAccountId);\n\n    const statusClasses: Record<string, string> = {\n      connected: 'bg-green-50 border-green-200',\n      expired: 'bg-red-50 border-red-200',\n      needs_reauth: 'bg-amber-50 border-amber-200',\n      degraded: 'bg-gray-50 border-gray-200',\n    };\n\n    const statusBadgeClasses: Record<string, string> = {\n      connected: 'bg-green-100 text-green-700',\n      expired: 'bg-red-100 text-red-700',\n      needs_reauth: 'bg-amber-100 text-amber-700',\n      degraded: 'bg-gray-100 text-gray-700',\n    };\n\n    const statusLabels: Record<string, string> = {\n      connected: 'Connected',\n      expired: 'Expired',\n      needs_reauth: 'Re-auth needed',\n      degraded: 'Degraded',\n    };\n\n    const borderClass = isActive ? 'ring-2 ring-blue-500' : '';\n    const cardClass = statusClasses[account.status] || 'bg-white border-gray-200';\n    const badgeClass = statusBadgeClasses[account.status] || 'bg-gray-100 text-gray-700';\n    const statusLabel = statusLabels[account.status] || account.status;\n    const accountLabel = account.account_id || 'default';\n    const email = account.email || (account.account_id ? account.account_id : 'Default account');\n\n    const googleIcon = `<svg class=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n      <path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" fill=\"#4285F4\"/>\n      <path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" fill=\"#34A853\"/>\n      <path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" fill=\"#FBBC05\"/>\n      <path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" fill=\"#EA4335\"/>\n    </svg>`;\n\n    return `\n      <div class=\"account-card ${cardClass} ${borderClass} border rounded-xl p-4 relative\" data-account-id=\"${this.escapeHtml(account.account_id)}\">\n        ${isActive ? '<span class=\"absolute top-2 right-2 text-xs font-medium text-blue-600\">Active</span>' : ''}\n        <div class=\"flex items-start gap-3\">\n          <div class=\"w-10 h-10 rounded-full ${account.status === 'connected' ? 'bg-green-100' : 'bg-gray-100'} flex items-center justify-center\">\n            ${googleIcon}\n          </div>\n          <div class=\"flex-1 min-w-0\">\n            <p class=\"text-sm font-medium text-gray-900 truncate\">${this.escapeHtml(email)}</p>\n            <p class=\"text-xs text-gray-500\">Account: ${this.escapeHtml(accountLabel)}</p>\n            <span class=\"inline-flex items-center mt-2 px-2 py-0.5 rounded text-xs font-medium ${badgeClass}\">\n              ${statusLabel}\n            </span>\n          </div>\n        </div>\n        <div class=\"mt-4 flex gap-2\">\n          ${!isActive ? `<button type=\"button\" class=\"select-account-btn flex-1 text-xs px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">Select</button>` : ''}\n          ${account.status === 'needs_reauth' || account.status === 'expired' ? `<button type=\"button\" class=\"reauth-account-btn flex-1 text-xs px-3 py-1.5 bg-amber-600 text-white rounded-lg hover:bg-amber-700\">Re-auth</button>` : ''}\n          <button type=\"button\" class=\"disconnect-account-btn text-xs px-3 py-1.5 text-red-600 border border-red-200 rounded-lg hover:bg-red-50\">Disconnect</button>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render the \"Connect New Account\" card\n   */\n  private renderConnectNewCard(): string {\n    return `\n      <div class=\"account-card-new border-2 border-dashed border-gray-300 rounded-xl p-4 flex flex-col items-center justify-center text-center hover:border-blue-400 hover:bg-blue-50 cursor-pointer transition-colors min-h-[140px]\" id=\"connect-new-card\">\n        <div class=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mb-2\">\n          <svg class=\"w-5 h-5 text-blue-600\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n        </div>\n        <p class=\"text-sm font-medium text-gray-700\">Connect New Account</p>\n        <p class=\"text-xs text-gray-500 mt-1\">Link another Google account</p>\n      </div>\n    `;\n  }\n\n  /**\n   * Attach event listeners to account cards\n   */\n  private attachCardEventListeners(): void {\n    const { accountsGrid, disconnectModal } = this.elements;\n    if (!accountsGrid) return;\n\n    // Select account buttons\n    accountsGrid.querySelectorAll('.select-account-btn').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        const card = (e.target as HTMLElement).closest('.account-card');\n        const accountId = card?.getAttribute('data-account-id') || '';\n        this.setCurrentAccountId(accountId, true);\n      });\n    });\n\n    // Re-auth buttons\n    accountsGrid.querySelectorAll('.reauth-account-btn').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        const card = (e.target as HTMLElement).closest('.account-card');\n        const accountId = card?.getAttribute('data-account-id') || '';\n        this.setCurrentAccountId(accountId, false);\n        this.startOAuthFlow(accountId);\n      });\n    });\n\n    // Disconnect buttons\n    accountsGrid.querySelectorAll('.disconnect-account-btn').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        const card = (e.target as HTMLElement).closest('.account-card');\n        const accountId = card?.getAttribute('data-account-id') || '';\n        this.pendingDisconnectAccountId = accountId;\n        if (disconnectModal) show(disconnectModal);\n      });\n    });\n\n    // Connect new card\n    const connectNewCard = accountsGrid.querySelector('#connect-new-card');\n    if (connectNewCard) {\n      connectNewCard.addEventListener('click', () => this.startOAuthFlowForNewAccount());\n    }\n  }\n\n  /**\n   * Escape HTML for safe rendering\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  // OAuth Flow Methods\n\n  /**\n   * Start OAuth flow\n   */\n  async startOAuthFlow(targetAccountId?: string): Promise<void> {\n    const { oauthModal, errorMessage } = this.elements;\n\n    // Show modal\n    if (oauthModal) {\n      show(oauthModal);\n    }\n\n    const redirectUri = this.resolveOAuthRedirectURI();\n    const oauthAccountId =\n      targetAccountId !== undefined\n        ? this.normalizeAccountId(targetAccountId)\n        : this.currentAccountId;\n    this.pendingOAuthAccountId = oauthAccountId;\n    const authUrl = this.buildGoogleOAuthUrl(redirectUri, oauthAccountId);\n\n    if (!authUrl) {\n      if (oauthModal) hide(oauthModal);\n      if (errorMessage) {\n        errorMessage.textContent = 'Google OAuth is not configured: missing client ID.';\n      }\n      this.pendingOAuthAccountId = null;\n      this.showState('error');\n      this.announce('Google OAuth is not configured');\n      return;\n    }\n\n    // Open popup\n    const width = 500;\n    const height = 600;\n    const left = (window.screen.width - width) / 2;\n    const top = (window.screen.height - height) / 2;\n\n    this.oauthWindow = window.open(\n      authUrl,\n      'google_oauth',\n      `width=${width},height=${height},left=${left},top=${top},popup=yes`\n    );\n\n    if (!this.oauthWindow) {\n      if (oauthModal) hide(oauthModal);\n      this.pendingOAuthAccountId = null;\n      this.showToast('Popup blocked. Allow popups for this site and try again.', 'error');\n      this.announce('Popup blocked');\n      return;\n    }\n\n    // Listen for callback message\n    this.messageHandler = (event: MessageEvent) => this.handleOAuthCallback(event);\n    window.addEventListener('message', this.messageHandler);\n\n    // Timeout\n    this.oauthTimeout = setTimeout(() => {\n      this.cleanupOAuthFlow();\n      if (oauthModal) hide(oauthModal);\n      this.pendingOAuthAccountId = null;\n      this.showToast('Google authorization timed out. Please try again.', 'error');\n      this.announce('Authorization timed out');\n    }, 120000);\n  }\n\n  /**\n   * Resolve OAuth redirect URI\n   */\n  private resolveOAuthRedirectURI(): string {\n    if (this.config.googleRedirectUri) {\n      return this.config.googleRedirectUri;\n    }\n    return `${window.location.origin}${this.config.basePath}/esign/integrations/google/callback`;\n  }\n\n  /**\n   * Build OAuth state parameter\n   */\n  private buildOAuthState(accountId: string): string {\n    const state: GoogleOAuthState = {\n      user_id: this.config.userId || '',\n      account_id: accountId || '',\n    };\n    return JSON.stringify(state);\n  }\n\n  /**\n   * Build Google OAuth URL\n   */\n  private buildGoogleOAuthUrl(redirectUri: string, accountId: string): string | null {\n    const clientId = this.config.googleClientId;\n    if (!clientId) {\n      return null;\n    }\n\n    const scopes = [\n      'https://www.googleapis.com/auth/drive.readonly',\n      'openid',\n      'https://www.googleapis.com/auth/userinfo.email',\n    ].join(' ');\n\n    const params = new URLSearchParams({\n      client_id: clientId,\n      redirect_uri: redirectUri,\n      response_type: 'code',\n      scope: scopes,\n      access_type: 'offline',\n      prompt: 'consent',\n      state: this.buildOAuthState(accountId),\n    });\n\n    return `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;\n  }\n\n  /**\n   * Handle OAuth callback message\n   */\n  private async handleOAuthCallback(event: MessageEvent): Promise<void> {\n    // Verify origin\n    if (event.origin !== window.location.origin) return;\n\n    const data = event.data as GoogleOAuthCallbackData;\n    if (data.type !== 'google_oauth_callback') return;\n\n    const { oauthModal } = this.elements;\n\n    this.cleanupOAuthFlow();\n    if (oauthModal) hide(oauthModal);\n    this.closeOAuthWindow();\n\n    if (data.error) {\n      this.showToast(`OAuth failed: ${data.error}`, 'error');\n      this.announce(`OAuth failed: ${data.error}`);\n      this.pendingOAuthAccountId = null;\n      return;\n    }\n\n    if (data.code) {\n      try {\n        const redirectUri = this.resolveOAuthRedirectURI();\n        const callbackAccountId =\n          typeof data.account_id === 'string'\n            ? this.normalizeAccountId(data.account_id)\n            : null;\n        const accountIdForConnect =\n          callbackAccountId ?? this.pendingOAuthAccountId ?? this.currentAccountId;\n\n        if (accountIdForConnect !== this.currentAccountId) {\n          this.setCurrentAccountId(accountIdForConnect, false);\n        }\n\n        const response = await fetch(\n          this.buildScopedAPIURL('/esign/integrations/google/connect', accountIdForConnect),\n          {\n            method: 'POST',\n            credentials: 'same-origin',\n            headers: {\n              'Content-Type': 'application/json',\n              Accept: 'application/json',\n            },\n            body: JSON.stringify({\n              auth_code: data.code,\n              account_id: accountIdForConnect || undefined,\n              redirect_uri: redirectUri,\n            }),\n          }\n        );\n\n        if (!response.ok) {\n          const errorData = await response.json();\n          throw new Error(errorData.error?.message || 'Failed to connect');\n        }\n\n        this.showToast('Google Drive connected successfully', 'success');\n        this.announce('Google Drive connected successfully');\n        await Promise.all([this.checkStatus(), this.loadAccounts()]);\n      } catch (error) {\n        console.error('Connect error:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        this.showToast(`Failed to connect: ${message}`, 'error');\n        this.announce(`Failed to connect: ${message}`);\n      } finally {\n        this.pendingOAuthAccountId = null;\n      }\n      return;\n    }\n    this.pendingOAuthAccountId = null;\n  }\n\n  /**\n   * Cancel OAuth flow\n   */\n  private cancelOAuthFlow(): void {\n    const { oauthModal } = this.elements;\n    if (oauthModal) hide(oauthModal);\n    this.pendingOAuthAccountId = null;\n    this.closeOAuthWindow();\n    this.cleanupOAuthFlow();\n  }\n\n  /**\n   * Cleanup OAuth flow resources\n   */\n  private cleanupOAuthFlow(): void {\n    if (this.oauthTimeout) {\n      clearTimeout(this.oauthTimeout);\n      this.oauthTimeout = null;\n    }\n\n    if (this.messageHandler) {\n      window.removeEventListener('message', this.messageHandler);\n      this.messageHandler = null;\n    }\n  }\n\n  /**\n   * Close OAuth popup window\n   */\n  private closeOAuthWindow(): void {\n    if (!this.oauthWindow) return;\n    try {\n      this.oauthWindow.close();\n    } catch {\n      // Ignore errors closing window\n    }\n    this.oauthWindow = null;\n  }\n\n  /**\n   * Disconnect Google account\n   */\n  async disconnect(): Promise<void> {\n    const { disconnectModal } = this.elements;\n    if (disconnectModal) hide(disconnectModal);\n    const accountIdToDisconnect = this.pendingDisconnectAccountId ?? this.currentAccountId;\n\n    try {\n      const response = await fetch(\n        this.buildScopedAPIURL('/esign/integrations/google/disconnect', accountIdToDisconnect),\n        {\n          method: 'POST',\n          credentials: 'same-origin',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error?.message || 'Failed to disconnect');\n      }\n\n      this.showToast('Google Drive disconnected', 'success');\n      this.announce('Google Drive disconnected');\n      if (accountIdToDisconnect === this.currentAccountId) {\n        this.setCurrentAccountId('', false);\n      }\n      await Promise.all([this.checkStatus(), this.loadAccounts()]);\n    } catch (error) {\n      console.error('Disconnect error:', error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed to disconnect: ${message}`, 'error');\n      this.announce(`Failed to disconnect: ${message}`);\n    } finally {\n      this.pendingDisconnectAccountId = null;\n    }\n  }\n\n  /**\n   * Show toast notification\n   */\n  private showToast(message: string, type: 'success' | 'error'): void {\n    // Use global toast manager if available\n    const win = window as unknown as Record<string, unknown>;\n    const toastManager = win.toastManager as\n      | { success: (msg: string) => void; error: (msg: string) => void }\n      | undefined;\n\n    if (toastManager) {\n      if (type === 'success') {\n        toastManager.success(message);\n      } else {\n        toastManager.error(message);\n      }\n    }\n  }\n}\n\n/**\n * Initialize Google integration page from config\n */\nexport function initGoogleIntegration(\n  config: GoogleIntegrationPageConfig\n): GoogleIntegrationController {\n  const controller = new GoogleIntegrationController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap Google integration page from template context\n */\nexport function bootstrapGoogleIntegration(config: {\n  basePath: string;\n  apiBasePath?: string;\n  userId: string;\n  googleAccountId?: string;\n  googleRedirectUri?: string;\n  googleClientId?: string;\n  googleEnabled?: boolean;\n}): void {\n  const pageConfig: GoogleIntegrationPageConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n    userId: config.userId,\n    googleAccountId: config.googleAccountId,\n    googleRedirectUri: config.googleRedirectUri,\n    googleClientId: config.googleClientId,\n    googleEnabled: config.googleEnabled !== false,\n  };\n\n  const controller = new GoogleIntegrationController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignGoogleIntegrationController =\n      controller;\n  }\n}\n","/**\n * E-Sign Google Drive Picker Page Controller\n * Handles Google Drive file browsing, selection, and import\n */\n\nimport type { ESignPageConfig, GoogleDriveFile } from '../types.js';\nimport { qs, qsa, show, hide, onReady, announce, on, setLoading } from '../utils/dom-helpers.js';\nimport { debounce } from '../utils/async-helpers.js';\nimport { formatDateTime } from '../utils/formatters.js';\n\nexport interface GoogleDrivePickerConfig extends ESignPageConfig {\n  userId: string;\n  googleAccountId?: string;\n  googleConnected: boolean;\n  pickerRoutes?: {\n    integrations?: string;\n    agreements?: string;\n    documents?: string;\n  };\n}\n\ninterface FolderPathItem {\n  id: string;\n  name: string;\n}\n\ninterface NormalizedDriveFile {\n  id: string;\n  name: string;\n  mimeType: string;\n  modifiedTime: string;\n  webViewLink: string;\n  parents: string[];\n  owners: Array<{ emailAddress?: string }>;\n  size?: number;\n  iconLink?: string;\n  thumbnailLink?: string;\n}\n\nconst GOOGLE_ACCOUNT_STORAGE_KEY = 'esign.google.account_id';\n\nconst MIME_TYPE_ICONS: Record<string, string> = {\n  'application/vnd.google-apps.folder': 'folder',\n  'application/vnd.google-apps.document': 'doc',\n  'application/vnd.google-apps.spreadsheet': 'sheet',\n  'application/vnd.google-apps.presentation': 'slide',\n  'application/pdf': 'pdf',\n  default: 'file',\n};\n\nconst IMPORTABLE_TYPES = [\n  'application/vnd.google-apps.document',\n  'application/pdf',\n];\n\n/**\n * Google Drive Picker page controller\n * Manages file browsing, search, selection, and import\n */\nexport class GoogleDrivePickerController {\n  private readonly config: GoogleDrivePickerConfig;\n  private readonly apiBase: string;\n  private currentAccountId: string;\n\n  // State\n  private currentFiles: NormalizedDriveFile[] = [];\n  private nextPageToken: string | null = null;\n  private currentFolderPath: FolderPathItem[] = [{ id: 'root', name: 'My Drive' }];\n  private selectedFile: NormalizedDriveFile | null = null;\n  private searchQuery = '';\n  private isListView = true;\n  private isLoading = false;\n\n  // Elements\n  private readonly elements: {\n    searchInput: HTMLInputElement | null;\n    clearSearchBtn: HTMLElement | null;\n    fileList: HTMLElement | null;\n    loadingState: HTMLElement | null;\n    breadcrumb: HTMLElement | null;\n    listTitle: HTMLElement | null;\n    resultCount: HTMLElement | null;\n    pagination: HTMLElement | null;\n    loadMoreBtn: HTMLElement | null;\n    refreshBtn: HTMLElement | null;\n    announcements: HTMLElement | null;\n    accountScopeHelp: HTMLElement | null;\n    connectGoogleLink: HTMLAnchorElement | null;\n    // Selection panel\n    noSelection: HTMLElement | null;\n    filePreview: HTMLElement | null;\n    previewIcon: HTMLElement | null;\n    previewTitle: HTMLElement | null;\n    previewType: HTMLElement | null;\n    previewFileId: HTMLElement | null;\n    previewOwner: HTMLElement | null;\n    previewLocation: HTMLElement | null;\n    previewModified: HTMLElement | null;\n    importBtn: HTMLElement | null;\n    openInGoogleBtn: HTMLAnchorElement | null;\n    clearSelectionBtn: HTMLElement | null;\n    // Import modal\n    importModal: HTMLElement | null;\n    importForm: HTMLFormElement | null;\n    importGoogleFileId: HTMLInputElement | null;\n    importDocumentTitle: HTMLInputElement | null;\n    importAgreementTitle: HTMLInputElement | null;\n    importCancelBtn: HTMLElement | null;\n    importConfirmBtn: HTMLElement | null;\n    importSpinner: HTMLElement | null;\n    importBtnText: HTMLElement | null;\n    // View toggle\n    viewListBtn: HTMLElement | null;\n    viewGridBtn: HTMLElement | null;\n  };\n\n  constructor(config: GoogleDrivePickerConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n    this.currentAccountId = this.resolveInitialAccountId();\n\n    this.elements = {\n      searchInput: qs<HTMLInputElement>('#drive-search'),\n      clearSearchBtn: qs('#clear-search-btn'),\n      fileList: qs('#file-list'),\n      loadingState: qs('#loading-state'),\n      breadcrumb: qs('#breadcrumb'),\n      listTitle: qs('#list-title'),\n      resultCount: qs('#result-count'),\n      pagination: qs('#pagination'),\n      loadMoreBtn: qs('#load-more-btn'),\n      refreshBtn: qs('#refresh-btn'),\n      announcements: qs('#drive-announcements'),\n      accountScopeHelp: qs('#account-scope-help'),\n      connectGoogleLink: qs<HTMLAnchorElement>('#connect-google-link'),\n      noSelection: qs('#no-selection'),\n      filePreview: qs('#file-preview'),\n      previewIcon: qs('#preview-icon'),\n      previewTitle: qs('#preview-title'),\n      previewType: qs('#preview-type'),\n      previewFileId: qs('#preview-file-id'),\n      previewOwner: qs('#preview-owner'),\n      previewLocation: qs('#preview-location'),\n      previewModified: qs('#preview-modified'),\n      importBtn: qs('#import-btn'),\n      openInGoogleBtn: qs<HTMLAnchorElement>('#open-in-google-btn'),\n      clearSelectionBtn: qs('#clear-selection-btn'),\n      importModal: qs('#import-modal'),\n      importForm: qs<HTMLFormElement>('#import-form'),\n      importGoogleFileId: qs<HTMLInputElement>('#import-google-file-id'),\n      importDocumentTitle: qs<HTMLInputElement>('#import-document-title'),\n      importAgreementTitle: qs<HTMLInputElement>('#import-agreement-title'),\n      importCancelBtn: qs('#import-cancel-btn'),\n      importConfirmBtn: qs('#import-confirm-btn'),\n      importSpinner: qs('#import-spinner'),\n      importBtnText: qs('#import-btn-text'),\n      viewListBtn: qs('#view-list-btn'),\n      viewGridBtn: qs('#view-grid-btn'),\n    };\n  }\n\n  /**\n   * Initialize the drive picker page\n   */\n  async init(): Promise<void> {\n    if (!this.config.googleConnected) {\n      return; // Nothing to initialize if not connected\n    }\n\n    this.setupEventListeners();\n    this.updateScopedUI();\n    await this.loadFiles();\n  }\n\n  /**\n   * Setup all event listeners\n   */\n  private setupEventListeners(): void {\n    const {\n      searchInput,\n      clearSearchBtn,\n      refreshBtn,\n      loadMoreBtn,\n      importBtn,\n      clearSelectionBtn,\n      importCancelBtn,\n      importConfirmBtn,\n      importForm,\n      importModal,\n      viewListBtn,\n      viewGridBtn,\n    } = this.elements;\n\n    // Search input with debounce\n    if (searchInput) {\n      const debouncedSearch = debounce(() => this.handleSearch(), 300);\n      searchInput.addEventListener('input', debouncedSearch);\n      searchInput.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          this.handleSearch();\n        }\n      });\n    }\n\n    // Clear search\n    if (clearSearchBtn) {\n      clearSearchBtn.addEventListener('click', () => this.clearSearch());\n    }\n\n    // Refresh\n    if (refreshBtn) {\n      refreshBtn.addEventListener('click', () => this.refresh());\n    }\n\n    // Load more\n    if (loadMoreBtn) {\n      loadMoreBtn.addEventListener('click', () => this.loadMore());\n    }\n\n    // Import button\n    if (importBtn) {\n      importBtn.addEventListener('click', () => this.showImportModal());\n    }\n\n    // Clear selection\n    if (clearSelectionBtn) {\n      clearSelectionBtn.addEventListener('click', () => this.clearSelection());\n    }\n\n    // Import modal\n    if (importCancelBtn) {\n      importCancelBtn.addEventListener('click', () => this.hideImportModal());\n    }\n\n    if (importConfirmBtn && importForm) {\n      importForm.addEventListener('submit', (e) => {\n        e.preventDefault();\n        this.handleImport();\n      });\n    }\n\n    // Close modal on backdrop click\n    if (importModal) {\n      importModal.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        if (target === importModal || target.getAttribute('aria-hidden') === 'true') {\n          this.hideImportModal();\n        }\n      });\n    }\n\n    // View toggle\n    if (viewListBtn) {\n      viewListBtn.addEventListener('click', () => this.setViewMode('list'));\n    }\n    if (viewGridBtn) {\n      viewGridBtn.addEventListener('click', () => this.setViewMode('grid'));\n    }\n\n    // Escape key\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (importModal && !importModal.classList.contains('hidden')) {\n          this.hideImportModal();\n        }\n      }\n    });\n\n    // File list click delegation\n    const { fileList } = this.elements;\n    if (fileList) {\n      fileList.addEventListener('click', (e) => this.handleFileListClick(e));\n    }\n  }\n\n  /**\n   * Resolve initial account ID from various sources\n   */\n  private resolveInitialAccountId(): string {\n    const params = new URLSearchParams(window.location.search);\n    const fromQuery = this.normalizeAccountId(params.get('account_id'));\n    if (fromQuery) return fromQuery;\n\n    const fromTemplate = this.normalizeAccountId(this.config.googleAccountId);\n    if (fromTemplate) return fromTemplate;\n\n    try {\n      return this.normalizeAccountId(\n        window.localStorage.getItem(GOOGLE_ACCOUNT_STORAGE_KEY)\n      );\n    } catch {\n      return '';\n    }\n  }\n\n  /**\n   * Normalize account ID\n   */\n  private normalizeAccountId(value: string | null | undefined): string {\n    return (value || '').trim();\n  }\n\n  /**\n   * Update UI elements with account scope\n   */\n  private updateScopedUI(): void {\n    this.syncScopedURLState();\n\n    const { accountScopeHelp, connectGoogleLink } = this.elements;\n\n    if (accountScopeHelp) {\n      if (this.currentAccountId) {\n        accountScopeHelp.textContent = `Account scope: ${this.currentAccountId}`;\n        show(accountScopeHelp);\n      } else {\n        hide(accountScopeHelp);\n      }\n    }\n\n    if (connectGoogleLink) {\n      const baseHref =\n        connectGoogleLink.dataset.baseHref || connectGoogleLink.getAttribute('href');\n      if (baseHref) {\n        connectGoogleLink.setAttribute('href', this.applyAccountIdToPath(baseHref));\n      }\n    }\n  }\n\n  /**\n   * Sync account ID to URL and localStorage\n   */\n  private syncScopedURLState(): void {\n    const url = new URL(window.location.href);\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      url.searchParams.delete('account_id');\n    }\n    window.history.replaceState({}, '', url.toString());\n\n    try {\n      if (this.currentAccountId) {\n        window.localStorage.setItem(GOOGLE_ACCOUNT_STORAGE_KEY, this.currentAccountId);\n      } else {\n        window.localStorage.removeItem(GOOGLE_ACCOUNT_STORAGE_KEY);\n      }\n    } catch {\n      // Ignore storage failures\n    }\n  }\n\n  /**\n   * Apply account ID to a path\n   */\n  private applyAccountIdToPath(pathOrURL: string): string {\n    const parsed = new URL(pathOrURL, window.location.origin);\n    if (this.currentAccountId) {\n      parsed.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      parsed.searchParams.delete('account_id');\n    }\n    return `${parsed.pathname}${parsed.search}${parsed.hash}`;\n  }\n\n  /**\n   * Build scoped API URL\n   */\n  private buildScopedAPIURL(path: string): string {\n    const url = new URL(`${this.apiBase}${path}`, window.location.origin);\n    url.searchParams.set('user_id', this.config.userId || '');\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    }\n    return url.toString();\n  }\n\n  /**\n   * Normalize drive file from API response\n   */\n  private normalizeDriveFile(file: Record<string, unknown>): NormalizedDriveFile {\n    if (!file || typeof file !== 'object') {\n      return {\n        id: '',\n        name: '',\n        mimeType: '',\n        modifiedTime: '',\n        webViewLink: '',\n        parents: [],\n        owners: [],\n      };\n    }\n\n    const id = String(file.id || file.ID || '').trim();\n    const name = String(file.name || file.Name || '').trim();\n    const mimeType = String(file.mimeType || file.MimeType || '').trim();\n    const modifiedTime = String(file.modifiedTime || file.ModifiedTime || '').trim();\n    const webViewLink = String(\n      file.webViewLink || file.webViewURL || file.WebViewURL || ''\n    ).trim();\n    const parentID = String(file.parentId || file.ParentID || '').trim();\n    const ownerEmail = String(file.ownerEmail || file.OwnerEmail || '').trim();\n    const parents = Array.isArray(file.parents)\n      ? (file.parents as string[])\n      : parentID\n        ? [parentID]\n        : [];\n    const owners = Array.isArray(file.owners)\n      ? (file.owners as Array<{ emailAddress?: string }>)\n      : ownerEmail\n        ? [{ emailAddress: ownerEmail }]\n        : [];\n\n    return {\n      id,\n      name,\n      mimeType,\n      modifiedTime,\n      webViewLink,\n      parents,\n      owners,\n      size: file.size as number | undefined,\n      iconLink: file.iconLink as string | undefined,\n      thumbnailLink: file.thumbnailLink as string | undefined,\n    };\n  }\n\n  /**\n   * Load files from current folder or search\n   */\n  async loadFiles(append = false): Promise<void> {\n    if (this.isLoading) return;\n\n    this.isLoading = true;\n    const { loadingState, fileList } = this.elements;\n\n    if (!append) {\n      this.currentFiles = [];\n      this.nextPageToken = null;\n      if (loadingState) show(loadingState);\n    }\n\n    try {\n      const currentFolder = this.currentFolderPath[this.currentFolderPath.length - 1];\n      let url: string;\n\n      if (this.searchQuery) {\n        url = this.buildScopedAPIURL(\n          `/esign/integrations/google/files?q=${encodeURIComponent(this.searchQuery)}`\n        );\n      } else {\n        url = this.buildScopedAPIURL(\n          `/esign/integrations/google/files?folder_id=${encodeURIComponent(currentFolder.id)}`\n        );\n      }\n\n      if (this.nextPageToken) {\n        url += `&page_token=${encodeURIComponent(this.nextPageToken)}`;\n      }\n\n      const response = await fetch(url, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to load files: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const files = Array.isArray(data.files)\n        ? data.files.map((f: Record<string, unknown>) => this.normalizeDriveFile(f))\n        : [];\n\n      if (append) {\n        this.currentFiles = [...this.currentFiles, ...files];\n      } else {\n        this.currentFiles = files;\n      }\n\n      this.nextPageToken = data.next_page_token || null;\n      this.renderFiles();\n      this.updateResultCount();\n      this.updatePagination();\n\n      announce(\n        this.searchQuery\n          ? `Found ${this.currentFiles.length} files`\n          : `Loaded ${this.currentFiles.length} files`\n      );\n    } catch (error) {\n      console.error('Error loading files:', error);\n      this.renderError(error instanceof Error ? error.message : 'Failed to load files');\n      announce('Error loading files');\n    } finally {\n      this.isLoading = false;\n      if (loadingState) hide(loadingState);\n    }\n  }\n\n  /**\n   * Render files in the file list\n   */\n  private renderFiles(): void {\n    const { fileList, loadingState } = this.elements;\n    if (!fileList) return;\n\n    if (loadingState) hide(loadingState);\n\n    if (this.currentFiles.length === 0) {\n      fileList.innerHTML = `\n        <div class=\"p-8 text-center\">\n          <div class=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <svg class=\"w-8 h-8 text-gray-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z\"/>\n            </svg>\n          </div>\n          <h3 class=\"text-lg font-medium text-gray-900 mb-2\">\n            ${this.searchQuery ? 'No files found' : 'This folder is empty'}\n          </h3>\n          <p class=\"text-sm text-gray-500\">\n            ${this.searchQuery ? 'Try a different search term' : 'No files in this folder'}\n          </p>\n        </div>\n      `;\n      return;\n    }\n\n    const html = this.currentFiles\n      .map((file) => this.renderFileItem(file))\n      .join('');\n\n    fileList.innerHTML = html;\n  }\n\n  /**\n   * Render a single file item\n   */\n  private renderFileItem(file: NormalizedDriveFile): string {\n    const isFolder = file.mimeType === 'application/vnd.google-apps.folder';\n    const isImportable = IMPORTABLE_TYPES.includes(file.mimeType);\n    const isSelected = this.selectedFile?.id === file.id;\n\n    const iconType =\n      MIME_TYPE_ICONS[file.mimeType] || MIME_TYPE_ICONS.default;\n    const icon = this.getFileIcon(iconType);\n\n    return `\n      <div\n        class=\"file-item flex items-center gap-4 px-4 py-3 hover:bg-gray-50 cursor-pointer ${isSelected ? 'bg-blue-50 border-l-2 border-blue-500' : ''}\"\n        data-file-id=\"${this.escapeHtml(file.id)}\"\n        data-is-folder=\"${isFolder}\"\n        role=\"option\"\n        aria-selected=\"${isSelected}\"\n        tabindex=\"0\"\n      >\n        <div class=\"w-8 h-8 flex items-center justify-center flex-shrink-0\">\n          ${icon}\n        </div>\n        <div class=\"flex-1 min-w-0\">\n          <p class=\"text-sm font-medium text-gray-900 truncate\">\n            ${this.escapeHtml(file.name)}\n          </p>\n          <p class=\"text-xs text-gray-500\">\n            ${formatDateTime(file.modifiedTime)}\n          </p>\n        </div>\n        ${\n          isImportable\n            ? `<span class=\"px-2 py-0.5 text-xs font-medium bg-green-100 text-green-700 rounded\">Importable</span>`\n            : ''\n        }\n      </div>\n    `;\n  }\n\n  /**\n   * Get SVG icon for file type\n   */\n  private getFileIcon(type: string): string {\n    const iconMap: Record<string, string> = {\n      folder: `<svg class=\"w-6 h-6 text-amber-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z\"/></svg>`,\n      doc: `<svg class=\"w-6 h-6 text-blue-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z\"/></svg>`,\n      sheet: `<svg class=\"w-6 h-6 text-green-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z\"/><path d=\"M7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7zm4-8h6v2h-6zm0 4h6v2h-6zm0 4h6v2h-6z\"/></svg>`,\n      slide: `<svg class=\"w-6 h-6 text-yellow-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z\"/></svg>`,\n      pdf: `<svg class=\"w-6 h-6 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z\"/></svg>`,\n      file: `<svg class=\"w-6 h-6 text-gray-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z\"/></svg>`,\n    };\n    return iconMap[type] || iconMap.file;\n  }\n\n  /**\n   * Handle file list clicks\n   */\n  private handleFileListClick(e: Event): void {\n    const target = e.target as HTMLElement;\n    const fileItem = target.closest('.file-item') as HTMLElement | null;\n\n    if (!fileItem) return;\n\n    const fileId = fileItem.dataset.fileId;\n    const isFolder = fileItem.dataset.isFolder === 'true';\n\n    if (!fileId) return;\n\n    if (isFolder) {\n      this.navigateToFolder(fileId);\n    } else {\n      this.selectFile(fileId);\n    }\n  }\n\n  /**\n   * Navigate into a folder\n   */\n  private navigateToFolder(folderId: string): void {\n    const folder = this.currentFiles.find((f) => f.id === folderId);\n    if (!folder) return;\n\n    this.currentFolderPath.push({ id: folder.id, name: folder.name });\n    this.searchQuery = '';\n    this.clearSelection();\n    this.updateBreadcrumb();\n    this.loadFiles();\n  }\n\n  /**\n   * Select a file\n   */\n  private selectFile(fileId: string): void {\n    const file = this.currentFiles.find((f) => f.id === fileId);\n    if (!file) return;\n\n    this.selectedFile = file;\n    this.renderSelection();\n    this.renderFiles(); // Re-render to update selection state\n    announce(`Selected: ${file.name}`);\n  }\n\n  /**\n   * Clear file selection\n   */\n  private clearSelection(): void {\n    this.selectedFile = null;\n    this.renderSelection();\n    this.renderFiles();\n  }\n\n  /**\n   * Render selection panel\n   */\n  private renderSelection(): void {\n    const {\n      noSelection,\n      filePreview,\n      previewIcon,\n      previewTitle,\n      previewType,\n      previewFileId,\n      previewOwner,\n      previewModified,\n      importBtn,\n      openInGoogleBtn,\n    } = this.elements;\n\n    if (!this.selectedFile) {\n      if (noSelection) show(noSelection);\n      if (filePreview) hide(filePreview);\n      return;\n    }\n\n    if (noSelection) hide(noSelection);\n    if (filePreview) show(filePreview);\n\n    const file = this.selectedFile;\n    const isImportable = IMPORTABLE_TYPES.includes(file.mimeType);\n\n    if (previewTitle) {\n      previewTitle.textContent = file.name;\n    }\n\n    if (previewType) {\n      previewType.textContent = this.getMimeTypeLabel(file.mimeType);\n    }\n\n    if (previewFileId) {\n      previewFileId.textContent = file.id;\n    }\n\n    if (previewOwner && file.owners.length > 0) {\n      previewOwner.textContent = file.owners[0].emailAddress || '-';\n    }\n\n    if (previewModified) {\n      previewModified.textContent = formatDateTime(file.modifiedTime);\n    }\n\n    if (importBtn) {\n      if (isImportable) {\n        importBtn.removeAttribute('disabled');\n        importBtn.classList.remove('opacity-50', 'cursor-not-allowed');\n      } else {\n        importBtn.setAttribute('disabled', 'true');\n        importBtn.classList.add('opacity-50', 'cursor-not-allowed');\n      }\n    }\n\n    if (openInGoogleBtn && file.webViewLink) {\n      openInGoogleBtn.href = file.webViewLink;\n    }\n  }\n\n  /**\n   * Get human-readable mime type label\n   */\n  private getMimeTypeLabel(mimeType: string): string {\n    const labels: Record<string, string> = {\n      'application/vnd.google-apps.folder': 'Folder',\n      'application/vnd.google-apps.document': 'Google Doc',\n      'application/vnd.google-apps.spreadsheet': 'Google Sheet',\n      'application/vnd.google-apps.presentation': 'Google Slides',\n      'application/pdf': 'PDF',\n    };\n    return labels[mimeType] || 'File';\n  }\n\n  /**\n   * Update breadcrumb navigation\n   */\n  private updateBreadcrumb(): void {\n    const { breadcrumb, listTitle } = this.elements;\n    if (!breadcrumb) return;\n\n    if (this.searchQuery) {\n      hide(breadcrumb);\n      if (listTitle) listTitle.textContent = 'Search Results';\n      return;\n    }\n\n    show(breadcrumb);\n    const currentFolder = this.currentFolderPath[this.currentFolderPath.length - 1];\n    if (listTitle) listTitle.textContent = currentFolder.name;\n\n    const ol = breadcrumb.querySelector('ol');\n    if (!ol) return;\n\n    ol.innerHTML = this.currentFolderPath\n      .map(\n        (item, index) => `\n        <li class=\"flex items-center\">\n          ${index > 0 ? '<span class=\"text-gray-400 mx-2\">/</span>' : ''}\n          <button\n            type=\"button\"\n            data-folder-id=\"${this.escapeHtml(item.id)}\"\n            data-folder-index=\"${index}\"\n            class=\"breadcrumb-item text-blue-600 hover:text-blue-800 hover:underline\"\n          >\n            ${this.escapeHtml(item.name)}\n          </button>\n        </li>\n      `\n      )\n      .join('');\n\n    // Add click handlers to breadcrumb items\n    qsa('.breadcrumb-item', ol).forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const index = parseInt((btn as HTMLElement).dataset.folderIndex || '0', 10);\n        this.navigateToBreadcrumb(index);\n      });\n    });\n  }\n\n  /**\n   * Navigate to breadcrumb item\n   */\n  private navigateToBreadcrumb(index: number): void {\n    if (index < 0 || index >= this.currentFolderPath.length - 1) return;\n\n    this.currentFolderPath = this.currentFolderPath.slice(0, index + 1);\n    this.searchQuery = '';\n    this.clearSelection();\n    this.updateBreadcrumb();\n    this.loadFiles();\n  }\n\n  /**\n   * Update result count display\n   */\n  private updateResultCount(): void {\n    const { resultCount } = this.elements;\n    if (!resultCount) return;\n\n    if (this.currentFiles.length > 0) {\n      resultCount.textContent = `(${this.currentFiles.length}${this.nextPageToken ? '+' : ''} files)`;\n    } else {\n      resultCount.textContent = '';\n    }\n  }\n\n  /**\n   * Update pagination controls\n   */\n  private updatePagination(): void {\n    const { pagination, loadMoreBtn } = this.elements;\n    if (!pagination) return;\n\n    if (this.nextPageToken) {\n      show(pagination);\n    } else {\n      hide(pagination);\n    }\n  }\n\n  /**\n   * Handle search\n   */\n  private handleSearch(): void {\n    const { searchInput, clearSearchBtn } = this.elements;\n    if (!searchInput) return;\n\n    const query = searchInput.value.trim();\n    this.searchQuery = query;\n\n    if (clearSearchBtn) {\n      if (query) {\n        show(clearSearchBtn);\n      } else {\n        hide(clearSearchBtn);\n      }\n    }\n\n    this.clearSelection();\n    this.loadFiles();\n  }\n\n  /**\n   * Clear search\n   */\n  private clearSearch(): void {\n    const { searchInput, clearSearchBtn } = this.elements;\n    if (searchInput) searchInput.value = '';\n    if (clearSearchBtn) hide(clearSearchBtn);\n\n    this.searchQuery = '';\n    this.clearSelection();\n    this.updateBreadcrumb();\n    this.loadFiles();\n  }\n\n  /**\n   * Refresh file list\n   */\n  private refresh(): void {\n    this.clearSelection();\n    this.loadFiles();\n  }\n\n  /**\n   * Load more files (pagination)\n   */\n  private loadMore(): void {\n    if (this.nextPageToken) {\n      this.loadFiles(true);\n    }\n  }\n\n  /**\n   * Set view mode\n   */\n  private setViewMode(mode: 'list' | 'grid'): void {\n    const { viewListBtn, viewGridBtn } = this.elements;\n    this.isListView = mode === 'list';\n\n    if (viewListBtn) {\n      viewListBtn.setAttribute('aria-pressed', String(this.isListView));\n    }\n    if (viewGridBtn) {\n      viewGridBtn.setAttribute('aria-pressed', String(!this.isListView));\n    }\n\n    this.renderFiles();\n  }\n\n  /**\n   * Show import modal\n   */\n  private showImportModal(): void {\n    if (!this.selectedFile) return;\n\n    const { importModal, importGoogleFileId, importDocumentTitle, importAgreementTitle } =\n      this.elements;\n\n    if (importGoogleFileId) {\n      importGoogleFileId.value = this.selectedFile.id;\n    }\n\n    if (importDocumentTitle) {\n      // Remove file extension for default title\n      const name = this.selectedFile.name.replace(/\\.[^/.]+$/, '');\n      importDocumentTitle.value = name;\n    }\n\n    if (importAgreementTitle) {\n      importAgreementTitle.value = '';\n    }\n\n    if (importModal) {\n      show(importModal);\n    }\n  }\n\n  /**\n   * Hide import modal\n   */\n  private hideImportModal(): void {\n    const { importModal } = this.elements;\n    if (importModal) hide(importModal);\n  }\n\n  /**\n   * Handle import form submission\n   */\n  private async handleImport(): Promise<void> {\n    if (!this.selectedFile) return;\n\n    const {\n      importConfirmBtn,\n      importSpinner,\n      importBtnText,\n      importDocumentTitle,\n      importAgreementTitle,\n    } = this.elements;\n\n    const googleFileId = this.selectedFile.id;\n    const documentTitle = importDocumentTitle?.value.trim() || this.selectedFile.name;\n    const agreementTitle = importAgreementTitle?.value.trim() || '';\n\n    // Set loading state\n    if (importConfirmBtn) {\n      importConfirmBtn.setAttribute('disabled', 'true');\n    }\n    if (importSpinner) show(importSpinner);\n    if (importBtnText) importBtnText.textContent = 'Importing...';\n\n    try {\n      const response = await fetch(this.buildScopedAPIURL('/esign/google-drive/imports'), {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n        body: JSON.stringify({\n          google_file_id: googleFileId,\n          document_title: documentTitle,\n          agreement_title: agreementTitle || undefined,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error?.message || 'Import failed');\n      }\n\n      const result = await response.json();\n\n      this.showToast('Import started successfully', 'success');\n      announce('Import started');\n\n      this.hideImportModal();\n\n      // Redirect to document or agreement if created\n      if (result.document?.id && this.config.pickerRoutes?.documents) {\n        window.location.href = `${this.config.pickerRoutes.documents}/${result.document.id}`;\n      } else if (result.agreement?.id && this.config.pickerRoutes?.agreements) {\n        window.location.href = `${this.config.pickerRoutes.agreements}/${result.agreement.id}`;\n      }\n    } catch (error) {\n      console.error('Import error:', error);\n      const message = error instanceof Error ? error.message : 'Import failed';\n      this.showToast(message, 'error');\n      announce(`Error: ${message}`);\n    } finally {\n      if (importConfirmBtn) {\n        importConfirmBtn.removeAttribute('disabled');\n      }\n      if (importSpinner) hide(importSpinner);\n      if (importBtnText) importBtnText.textContent = 'Import';\n    }\n  }\n\n  /**\n   * Render error state\n   */\n  private renderError(message: string): void {\n    const { fileList } = this.elements;\n    if (!fileList) return;\n\n    fileList.innerHTML = `\n      <div class=\"p-8 text-center\">\n        <div class=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <svg class=\"w-8 h-8 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n        </div>\n        <h3 class=\"text-lg font-medium text-gray-900 mb-2\">Error Loading Files</h3>\n        <p class=\"text-sm text-gray-500 mb-4\">${this.escapeHtml(message)}</p>\n        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"location.reload()\">\n          Try Again\n        </button>\n      </div>\n    `;\n  }\n\n  /**\n   * Show toast notification\n   */\n  private showToast(message: string, type: 'success' | 'error'): void {\n    const win = window as unknown as Record<string, unknown>;\n    const toastManager = win.toastManager as\n      | { success: (msg: string) => void; error: (msg: string) => void }\n      | undefined;\n\n    if (toastManager) {\n      if (type === 'success') {\n        toastManager.success(message);\n      } else {\n        toastManager.error(message);\n      }\n    }\n  }\n\n  /**\n   * Escape HTML\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n/**\n * Initialize Google Drive picker page from config\n */\nexport function initGoogleDrivePicker(\n  config: GoogleDrivePickerConfig\n): GoogleDrivePickerController {\n  const controller = new GoogleDrivePickerController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap Google Drive picker page from template context\n */\nexport function bootstrapGoogleDrivePicker(config: {\n  basePath: string;\n  apiBasePath?: string;\n  userId: string;\n  googleAccountId?: string;\n  googleConnected?: boolean;\n  pickerRoutes?: {\n    integrations?: string;\n    agreements?: string;\n    documents?: string;\n  };\n}): void {\n  const pageConfig: GoogleDrivePickerConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n    userId: config.userId,\n    googleAccountId: config.googleAccountId,\n    googleConnected: config.googleConnected !== false,\n    pickerRoutes: config.pickerRoutes,\n  };\n\n  const controller = new GoogleDrivePickerController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignGoogleDrivePickerController =\n      controller;\n  }\n}\n","/**\n * E-Sign Integration Health Page Controller\n * Real-time observability dashboard for CRM/HRIS integrations\n */\n\nimport { qs, qsa, onReady, announce } from '../utils/dom-helpers.js';\n\n/**\n * Configuration for the integration health page\n */\nexport interface IntegrationHealthConfig {\n  basePath: string;\n  apiBasePath?: string;\n  autoRefreshInterval?: number;\n}\n\n/**\n * Health data from API\n */\ninterface HealthData {\n  healthScore: number;\n  healthTrend: number;\n  syncStats: {\n    total: number;\n    succeeded: number;\n    failed: number;\n    running: number;\n    successRate: number;\n  };\n  conflictStats: {\n    pending: number;\n    resolvedToday: number;\n    total: number;\n    trend: number;\n  };\n  lagStats: {\n    averageMinutes: number;\n    status: 'normal' | 'elevated' | 'critical';\n    lastSyncMinutesAgo: number;\n  };\n  retryStats: {\n    total: number;\n    recoveryRate: number;\n    avgAttempts: number;\n    recent: Array<{\n      provider: string;\n      entity: string;\n      time: string;\n      status: 'recovered' | 'pending' | 'failed';\n    }>;\n  };\n  providerHealth: Array<{\n    provider: string;\n    status: 'healthy' | 'degraded' | 'unhealthy';\n    successRate: number;\n    lastSync: string;\n    conflicts: number;\n    lagMinutes: number;\n  }>;\n  alerts: Array<{\n    severity: 'info' | 'warning' | 'error';\n    provider: string;\n    message: string;\n    time: string;\n  }>;\n  activityFeed: Array<{\n    type: string;\n    provider: string;\n    message: string;\n    time: string;\n    status: 'success' | 'warning' | 'error';\n  }>;\n  chartData: {\n    sync: ChartData;\n    conflicts: ChartData;\n  };\n}\n\ninterface ChartData {\n  labels: string[];\n  datasets: Record<string, number[]>;\n}\n\n/**\n * Integration Health page controller\n * Manages health dashboard, charts, and real-time updates\n */\nexport class IntegrationHealthController {\n  private readonly config: IntegrationHealthConfig;\n  private readonly apiBase: string;\n  private healthData: HealthData | null = null;\n  private autoRefreshTimer: ReturnType<typeof setInterval> | null = null;\n\n  private readonly elements: {\n    timeRange: HTMLSelectElement | null;\n    providerFilter: HTMLSelectElement | null;\n    refreshBtn: HTMLElement | null;\n    healthScore: HTMLElement | null;\n    healthIndicator: HTMLElement | null;\n    healthTrend: HTMLElement | null;\n    syncSuccessRate: HTMLElement | null;\n    syncSuccessCount: HTMLElement | null;\n    syncFailedCount: HTMLElement | null;\n    syncSuccessBar: HTMLElement | null;\n    conflictCount: HTMLElement | null;\n    conflictPending: HTMLElement | null;\n    conflictResolved: HTMLElement | null;\n    conflictTrend: HTMLElement | null;\n    syncLag: HTMLElement | null;\n    lagStatus: HTMLElement | null;\n    lastSync: HTMLElement | null;\n    retryTotal: HTMLElement | null;\n    retryRecovery: HTMLElement | null;\n    retryAvg: HTMLElement | null;\n    retryList: HTMLElement | null;\n    providerHealthTable: HTMLElement | null;\n    alertsList: HTMLElement | null;\n    noAlerts: HTMLElement | null;\n    alertCount: HTMLElement | null;\n    activityFeed: HTMLElement | null;\n    syncChartCanvas: HTMLCanvasElement | null;\n    conflictChartCanvas: HTMLCanvasElement | null;\n  };\n\n  constructor(config: IntegrationHealthConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n\n    this.elements = {\n      timeRange: qs<HTMLSelectElement>('#time-range'),\n      providerFilter: qs<HTMLSelectElement>('#provider-filter'),\n      refreshBtn: qs('#refresh-btn'),\n      healthScore: qs('#health-score'),\n      healthIndicator: qs('#health-indicator'),\n      healthTrend: qs('#health-trend'),\n      syncSuccessRate: qs('#sync-success-rate'),\n      syncSuccessCount: qs('#sync-success-count'),\n      syncFailedCount: qs('#sync-failed-count'),\n      syncSuccessBar: qs('#sync-success-bar'),\n      conflictCount: qs('#conflict-count'),\n      conflictPending: qs('#conflict-pending'),\n      conflictResolved: qs('#conflict-resolved'),\n      conflictTrend: qs('#conflict-trend'),\n      syncLag: qs('#sync-lag'),\n      lagStatus: qs('#lag-status'),\n      lastSync: qs('#last-sync'),\n      retryTotal: qs('#retry-total'),\n      retryRecovery: qs('#retry-recovery'),\n      retryAvg: qs('#retry-avg'),\n      retryList: qs('#retry-list'),\n      providerHealthTable: qs('#provider-health-table'),\n      alertsList: qs('#alerts-list'),\n      noAlerts: qs('#no-alerts'),\n      alertCount: qs('#alert-count'),\n      activityFeed: qs('#activity-feed'),\n      syncChartCanvas: qs<HTMLCanvasElement>('#sync-chart-canvas'),\n      conflictChartCanvas: qs<HTMLCanvasElement>('#conflict-chart-canvas'),\n    };\n  }\n\n  /**\n   * Initialize the health dashboard\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    this.initCharts();\n    await this.loadHealthData();\n\n    // Setup auto-refresh\n    const interval = this.config.autoRefreshInterval || 30000;\n    this.autoRefreshTimer = setInterval(() => this.loadHealthData(), interval);\n  }\n\n  /**\n   * Cleanup resources\n   */\n  destroy(): void {\n    if (this.autoRefreshTimer) {\n      clearInterval(this.autoRefreshTimer);\n      this.autoRefreshTimer = null;\n    }\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const { refreshBtn, timeRange, providerFilter } = this.elements;\n\n    if (refreshBtn) {\n      refreshBtn.addEventListener('click', () => this.loadHealthData());\n    }\n\n    if (timeRange) {\n      timeRange.addEventListener('change', () => this.loadHealthData());\n    }\n\n    if (providerFilter) {\n      providerFilter.addEventListener('change', () => this.loadHealthData());\n    }\n  }\n\n  /**\n   * Initialize chart canvases\n   */\n  private initCharts(): void {\n    const { syncChartCanvas, conflictChartCanvas } = this.elements;\n\n    if (syncChartCanvas) {\n      syncChartCanvas.width = syncChartCanvas.parentElement?.clientWidth || 400;\n      syncChartCanvas.height = 240;\n    }\n\n    if (conflictChartCanvas) {\n      conflictChartCanvas.width = conflictChartCanvas.parentElement?.clientWidth || 400;\n      conflictChartCanvas.height = 240;\n    }\n  }\n\n  /**\n   * Load health data from API\n   */\n  async loadHealthData(): Promise<void> {\n    const { timeRange, providerFilter } = this.elements;\n    const range = timeRange?.value || '24h';\n    const provider = providerFilter?.value || '';\n\n    try {\n      const url = new URL(`${this.apiBase}/esign/integrations/health`, window.location.origin);\n      url.searchParams.set('range', range);\n      if (provider) {\n        url.searchParams.set('provider', provider);\n      }\n\n      const response = await fetch(url.toString(), {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) {\n        // Use mock data for demo\n        this.healthData = this.generateMockHealthData(range, provider);\n      } else {\n        const data = await response.json();\n        this.healthData = data;\n      }\n\n      this.renderHealthData();\n      announce(`Health data refreshed`);\n    } catch (error) {\n      console.error('Failed to load health data:', error);\n      // Use mock data as fallback\n      this.healthData = this.generateMockHealthData(range, provider);\n      this.renderHealthData();\n    }\n  }\n\n  /**\n   * Generate mock health data for demonstration\n   */\n  private generateMockHealthData(timeRange: string, provider: string): HealthData {\n    const hours =\n      timeRange === '1h' ? 1 : timeRange === '6h' ? 6 : timeRange === '24h' ? 24 : timeRange === '7d' ? 168 : 720;\n    const dataPoints = Math.min(hours, 24);\n    const providers = provider\n      ? [provider]\n      : ['salesforce', 'hubspot', 'bamboohr', 'workday'];\n\n    return {\n      healthScore: 98,\n      healthTrend: 2,\n      syncStats: {\n        total: 300,\n        succeeded: 289,\n        failed: 11,\n        running: 2,\n        successRate: 96.5,\n      },\n      conflictStats: {\n        pending: 7,\n        resolvedToday: 42,\n        total: 49,\n        trend: -3,\n      },\n      lagStats: {\n        averageMinutes: 12,\n        status: 'normal',\n        lastSyncMinutesAgo: 3,\n      },\n      retryStats: {\n        total: 23,\n        recoveryRate: 87,\n        avgAttempts: 1.4,\n        recent: [\n          { provider: 'salesforce', entity: 'Contact', time: '5m ago', status: 'recovered' },\n          { provider: 'hubspot', entity: 'Deal', time: '12m ago', status: 'recovered' },\n          { provider: 'bamboohr', entity: 'Employee', time: '28m ago', status: 'pending' },\n        ],\n      },\n      providerHealth: providers.map((p) => ({\n        provider: p,\n        status: p === 'workday' ? 'degraded' as const : 'healthy' as const,\n        successRate: p === 'workday' ? 89.2 : 97 + Math.random() * 3,\n        lastSync: `${Math.floor(Math.random() * 30) + 1}m ago`,\n        conflicts: Math.floor(Math.random() * 5),\n        lagMinutes: Math.floor(Math.random() * 20) + 5,\n      })),\n      alerts: [\n        { severity: 'warning', provider: 'workday', message: 'Elevated error rate detected', time: '15m ago' },\n        { severity: 'info', provider: 'salesforce', message: 'Rate limit approaching (80%)', time: '1h ago' },\n      ],\n      activityFeed: this.generateActivityFeed(20),\n      chartData: {\n        sync: this.generateTimeSeriesData(dataPoints, 'sync'),\n        conflicts: this.generateTimeSeriesData(dataPoints, 'conflicts'),\n      },\n    };\n  }\n\n  /**\n   * Generate activity feed data\n   */\n  private generateActivityFeed(\n    count: number\n  ): Array<{ type: string; provider: string; message: string; time: string; status: 'success' | 'warning' | 'error' }> {\n    const activities: Array<{ type: string; provider: string; message: string; time: string; status: 'success' | 'warning' | 'error' }> = [];\n    const types = ['sync_completed', 'sync_failed', 'conflict_created', 'conflict_resolved', 'mapping_published'];\n    const providers = ['salesforce', 'hubspot', 'bamboohr', 'workday'];\n\n    for (let i = 0; i < count; i++) {\n      const type = types[Math.floor(Math.random() * types.length)];\n      const provider = providers[Math.floor(Math.random() * providers.length)];\n      activities.push({\n        type,\n        provider,\n        message: this.getActivityMessage(type, provider),\n        time: `${Math.floor(Math.random() * 60) + 1}m ago`,\n        status: type.includes('failed') || type.includes('created') ? 'warning' : 'success',\n      });\n    }\n    return activities;\n  }\n\n  /**\n   * Get activity message\n   */\n  private getActivityMessage(type: string, provider: string): string {\n    const messages: Record<string, string> = {\n      sync_completed: `Sync completed for ${provider} (42 records)`,\n      sync_failed: `Sync failed for ${provider}: Connection timeout`,\n      conflict_created: `New conflict detected in ${provider} binding`,\n      conflict_resolved: `Conflict resolved for ${provider} record`,\n      mapping_published: `Mapping spec published for ${provider}`,\n    };\n    return messages[type] || `Activity for ${provider}`;\n  }\n\n  /**\n   * Generate time series data\n   */\n  private generateTimeSeriesData(points: number, type: string): ChartData {\n    const labels: string[] = [];\n    const datasets: Record<string, number[]> = type === 'sync'\n      ? { success: [], failed: [] }\n      : { pending: [], resolved: [] };\n\n    const now = new Date();\n    for (let i = points - 1; i >= 0; i--) {\n      const time = new Date(now.getTime() - i * 3600000);\n      labels.push(\n        time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })\n      );\n\n      if (type === 'sync') {\n        datasets.success.push(Math.floor(Math.random() * 15) + 10);\n        datasets.failed.push(Math.floor(Math.random() * 3));\n      } else {\n        datasets.pending.push(Math.floor(Math.random() * 5));\n        datasets.resolved.push(Math.floor(Math.random() * 8) + 2);\n      }\n    }\n\n    return { labels, datasets };\n  }\n\n  /**\n   * Render all health data\n   */\n  private renderHealthData(): void {\n    if (!this.healthData) return;\n\n    this.renderHealthScore();\n    this.renderSyncStats();\n    this.renderConflictStats();\n    this.renderLagStats();\n    this.renderRetryActivity();\n    this.renderProviderHealth();\n    this.renderAlerts();\n    this.renderActivityFeed();\n    this.updateCharts();\n  }\n\n  /**\n   * Render health score section\n   */\n  private renderHealthScore(): void {\n    if (!this.healthData) return;\n    const { healthScore, healthIndicator, healthTrend } = this.elements;\n    const data = this.healthData;\n\n    if (healthScore) {\n      healthScore.textContent = `${data.healthScore}%`;\n\n      if (data.healthScore >= 95) {\n        healthScore.className = 'text-3xl font-bold text-green-600';\n      } else if (data.healthScore >= 80) {\n        healthScore.className = 'text-3xl font-bold text-yellow-600';\n      } else {\n        healthScore.className = 'text-3xl font-bold text-red-600';\n      }\n    }\n\n    if (healthIndicator) {\n      if (data.healthScore >= 95) {\n        healthIndicator.className = 'w-12 h-12 rounded-full bg-green-100 flex items-center justify-center';\n        healthIndicator.innerHTML = `<svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path></svg>`;\n      } else if (data.healthScore >= 80) {\n        healthIndicator.className = 'w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center';\n        healthIndicator.innerHTML = `<svg class=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path></svg>`;\n      } else {\n        healthIndicator.className = 'w-12 h-12 rounded-full bg-red-100 flex items-center justify-center';\n        healthIndicator.innerHTML = `<svg class=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg>`;\n      }\n    }\n\n    if (healthTrend) {\n      const trendSign = data.healthTrend >= 0 ? '+' : '';\n      healthTrend.textContent = `${trendSign}${data.healthTrend}% from previous period`;\n    }\n  }\n\n  /**\n   * Render sync statistics\n   */\n  private renderSyncStats(): void {\n    if (!this.healthData) return;\n    const { syncSuccessRate, syncSuccessCount, syncFailedCount, syncSuccessBar } = this.elements;\n    const stats = this.healthData.syncStats;\n\n    if (syncSuccessRate) {\n      syncSuccessRate.textContent = `${stats.successRate.toFixed(1)}%`;\n    }\n    if (syncSuccessCount) {\n      syncSuccessCount.textContent = `${stats.succeeded} succeeded`;\n    }\n    if (syncFailedCount) {\n      syncFailedCount.textContent = `${stats.failed} failed`;\n    }\n    if (syncSuccessBar) {\n      syncSuccessBar.style.width = `${stats.successRate}%`;\n    }\n  }\n\n  /**\n   * Render conflict statistics\n   */\n  private renderConflictStats(): void {\n    if (!this.healthData) return;\n    const { conflictCount, conflictPending, conflictResolved, conflictTrend } = this.elements;\n    const stats = this.healthData.conflictStats;\n\n    if (conflictCount) {\n      conflictCount.textContent = String(stats.pending);\n    }\n    if (conflictPending) {\n      conflictPending.textContent = `${stats.pending} pending`;\n    }\n    if (conflictResolved) {\n      conflictResolved.textContent = `${stats.resolvedToday} resolved today`;\n    }\n    if (conflictTrend) {\n      const trendSign = stats.trend >= 0 ? '+' : '';\n      conflictTrend.textContent = `${trendSign}${stats.trend} from previous period`;\n    }\n  }\n\n  /**\n   * Render lag statistics\n   */\n  private renderLagStats(): void {\n    if (!this.healthData) return;\n    const { syncLag, lagStatus, lastSync } = this.elements;\n    const stats = this.healthData.lagStats;\n\n    if (syncLag) {\n      syncLag.textContent = `${stats.averageMinutes}m`;\n    }\n\n    if (lagStatus) {\n      if (stats.status === 'normal') {\n        lagStatus.className = 'px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full';\n        lagStatus.textContent = 'Normal';\n      } else if (stats.status === 'elevated') {\n        lagStatus.className = 'px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full';\n        lagStatus.textContent = 'Elevated';\n      } else {\n        lagStatus.className = 'px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full';\n        lagStatus.textContent = 'Critical';\n      }\n    }\n\n    if (lastSync) {\n      lastSync.textContent = `Last sync: ${stats.lastSyncMinutesAgo} minutes ago`;\n    }\n  }\n\n  /**\n   * Render retry activity\n   */\n  private renderRetryActivity(): void {\n    if (!this.healthData) return;\n    const { retryTotal, retryRecovery, retryAvg, retryList } = this.elements;\n    const stats = this.healthData.retryStats;\n\n    if (retryTotal) {\n      retryTotal.textContent = String(stats.total);\n    }\n    if (retryRecovery) {\n      retryRecovery.textContent = `${stats.recoveryRate}%`;\n    }\n    if (retryAvg) {\n      retryAvg.textContent = stats.avgAttempts.toFixed(1);\n    }\n\n    if (retryList) {\n      retryList.innerHTML = stats.recent\n        .map(\n          (r) => `\n          <div class=\"flex justify-between items-center py-1\">\n            <span>${this.escapeHtml(r.provider)} / ${this.escapeHtml(r.entity)}</span>\n            <span class=\"${r.status === 'recovered' ? 'text-green-600' : 'text-yellow-600'}\">${this.escapeHtml(r.time)}</span>\n          </div>\n        `\n        )\n        .join('');\n    }\n  }\n\n  /**\n   * Render provider health table\n   */\n  private renderProviderHealth(): void {\n    if (!this.healthData) return;\n    const { providerHealthTable } = this.elements;\n    if (!providerHealthTable) return;\n\n    providerHealthTable.innerHTML = this.healthData.providerHealth\n      .map(\n        (p) => `\n        <tr class=\"border-b last:border-0\">\n          <td class=\"py-3 font-medium capitalize\">${this.escapeHtml(p.provider)}</td>\n          <td class=\"py-3\">\n            <span class=\"px-2 py-1 text-xs rounded-full ${\n              p.status === 'healthy'\n                ? 'bg-green-100 text-green-800'\n                : p.status === 'degraded'\n                  ? 'bg-yellow-100 text-yellow-800'\n                  : 'bg-red-100 text-red-800'\n            }\">\n              ${p.status}\n            </span>\n          </td>\n          <td class=\"py-3 ${\n            p.successRate >= 95\n              ? 'text-green-600'\n              : p.successRate >= 80\n                ? 'text-yellow-600'\n                : 'text-red-600'\n          }\">\n            ${p.successRate.toFixed(1)}%\n          </td>\n          <td class=\"py-3 text-gray-600\">${this.escapeHtml(p.lastSync)}</td>\n          <td class=\"py-3\">\n            ${p.conflicts > 0 ? `<span class=\"text-orange-600\">${p.conflicts}</span>` : '<span class=\"text-gray-400\">0</span>'}\n          </td>\n          <td class=\"py-3 text-gray-600\">${p.lagMinutes}m</td>\n        </tr>\n      `\n      )\n      .join('');\n  }\n\n  /**\n   * Render alerts\n   */\n  private renderAlerts(): void {\n    if (!this.healthData) return;\n    const { alertsList, noAlerts, alertCount } = this.elements;\n\n    if (this.healthData.alerts.length === 0) {\n      if (alertsList) alertsList.classList.add('hidden');\n      if (noAlerts) noAlerts.classList.remove('hidden');\n      if (alertCount) {\n        alertCount.textContent = '0 active';\n        alertCount.className = 'px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full';\n      }\n    } else {\n      if (alertsList) alertsList.classList.remove('hidden');\n      if (noAlerts) noAlerts.classList.add('hidden');\n      if (alertCount) {\n        alertCount.textContent = `${this.healthData.alerts.length} active`;\n        alertCount.className = 'px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full';\n      }\n\n      if (alertsList) {\n        alertsList.innerHTML = this.healthData.alerts\n          .map(\n            (a) => `\n            <div class=\"flex items-start gap-3 p-3 rounded-lg ${\n              a.severity === 'warning'\n                ? 'bg-yellow-50 border border-yellow-200'\n                : a.severity === 'error'\n                  ? 'bg-red-50 border border-red-200'\n                  : 'bg-blue-50 border border-blue-200'\n            }\">\n              <div class=\"flex-shrink-0\">\n                ${this.getAlertIcon(a.severity)}\n              </div>\n              <div class=\"flex-1\">\n                <div class=\"flex justify-between\">\n                  <span class=\"font-medium capitalize\">${this.escapeHtml(a.provider)}</span>\n                  <span class=\"text-xs text-gray-500\">${this.escapeHtml(a.time)}</span>\n                </div>\n                <p class=\"text-sm text-gray-700 mt-1\">${this.escapeHtml(a.message)}</p>\n              </div>\n              <button class=\"flex-shrink-0 text-gray-400 hover:text-gray-600 dismiss-alert-btn\" aria-label=\"Dismiss alert\">\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                </svg>\n              </button>\n            </div>\n          `\n          )\n          .join('');\n\n        // Attach dismiss handlers\n        alertsList.querySelectorAll('.dismiss-alert-btn').forEach((btn) => {\n          btn.addEventListener('click', (e) => this.dismissAlert(e));\n        });\n      }\n    }\n  }\n\n  /**\n   * Get alert icon SVG\n   */\n  private getAlertIcon(severity: string): string {\n    if (severity === 'warning') {\n      return '<svg class=\"w-5 h-5 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path></svg>';\n    }\n    if (severity === 'error') {\n      return '<svg class=\"w-5 h-5 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>';\n    }\n    return '<svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>';\n  }\n\n  /**\n   * Dismiss an alert\n   */\n  private dismissAlert(e: Event): void {\n    const btn = e.currentTarget as HTMLElement;\n    const alertElement = btn.closest('.flex.items-start');\n    if (alertElement) {\n      alertElement.remove();\n    }\n\n    // Update count\n    const { alertsList, noAlerts, alertCount } = this.elements;\n    const remaining = alertsList?.querySelectorAll(':scope > div').length || 0;\n\n    if (alertCount) {\n      alertCount.textContent = `${remaining} active`;\n      if (remaining === 0) {\n        alertCount.className = 'px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full';\n        if (alertsList) alertsList.classList.add('hidden');\n        if (noAlerts) noAlerts.classList.remove('hidden');\n      }\n    }\n  }\n\n  /**\n   * Render activity feed\n   */\n  private renderActivityFeed(): void {\n    if (!this.healthData) return;\n    const { activityFeed } = this.elements;\n    if (!activityFeed) return;\n\n    activityFeed.innerHTML = this.healthData.activityFeed\n      .map(\n        (a) => `\n        <div class=\"flex items-center gap-3 py-2 border-b last:border-0\">\n          <div class=\"w-2 h-2 rounded-full ${a.status === 'success' ? 'bg-green-500' : 'bg-yellow-500'}\"></div>\n          <div class=\"flex-1 text-sm\">\n            <span class=\"text-gray-700\">${this.escapeHtml(a.message)}</span>\n          </div>\n          <span class=\"text-xs text-gray-400\">${this.escapeHtml(a.time)}</span>\n        </div>\n      `\n      )\n      .join('');\n  }\n\n  /**\n   * Update charts\n   */\n  private updateCharts(): void {\n    if (!this.healthData) return;\n\n    this.renderBarChart(\n      'sync-chart-canvas',\n      this.healthData.chartData.sync,\n      ['#22c55e', '#ef4444'],\n      ['Success', 'Failed']\n    );\n    this.renderBarChart(\n      'conflict-chart-canvas',\n      this.healthData.chartData.conflicts,\n      ['#f97316', '#22c55e'],\n      ['New', 'Resolved']\n    );\n  }\n\n  /**\n   * Render a bar chart on canvas\n   */\n  private renderBarChart(\n    canvasId: string,\n    chartData: ChartData,\n    colors: string[],\n    _legends: string[]\n  ): void {\n    const canvas = document.getElementById(canvasId) as HTMLCanvasElement | null;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n    const padding = 40;\n    const chartWidth = width - padding * 2;\n    const chartHeight = height - padding * 2;\n\n    ctx.clearRect(0, 0, width, height);\n\n    const labels = chartData.labels;\n    const datasets = Object.values(chartData.datasets);\n    const barWidth = chartWidth / labels.length / (datasets.length + 1);\n\n    // Find max value for scaling\n    const maxVal = Math.max(...datasets.flat()) || 1;\n\n    // Draw bars\n    labels.forEach((label, i) => {\n      const x = padding + (i * chartWidth) / labels.length + barWidth / 2;\n\n      datasets.forEach((data, j) => {\n        const barHeight = (data[i] / maxVal) * chartHeight;\n        const barX = x + j * barWidth;\n        const barY = height - padding - barHeight;\n\n        ctx.fillStyle = colors[j] || '#6b7280';\n        ctx.fillRect(barX, barY, barWidth - 2, barHeight);\n      });\n\n      // Draw label every few bars to avoid crowding\n      if (i % Math.ceil(labels.length / 6) === 0) {\n        ctx.fillStyle = '#6b7280';\n        ctx.font = '10px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText(label, x + (datasets.length * barWidth) / 2, height - padding + 15);\n      }\n    });\n\n    // Draw y-axis labels\n    ctx.fillStyle = '#6b7280';\n    ctx.font = '10px sans-serif';\n    ctx.textAlign = 'right';\n    for (let i = 0; i <= 4; i++) {\n      const y = height - padding - (i * chartHeight) / 4;\n      const val = Math.round((maxVal * i) / 4);\n      ctx.fillText(val.toString(), padding - 5, y + 3);\n    }\n  }\n\n  /**\n   * Escape HTML\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n/**\n * Initialize integration health page from config\n */\nexport function initIntegrationHealth(config: IntegrationHealthConfig): IntegrationHealthController {\n  const controller = new IntegrationHealthController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap integration health page from template context\n */\nexport function bootstrapIntegrationHealth(config: {\n  basePath: string;\n  apiBasePath?: string;\n  autoRefreshInterval?: number;\n}): void {\n  const pageConfig: IntegrationHealthConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n    autoRefreshInterval: config.autoRefreshInterval || 30000,\n  };\n\n  const controller = new IntegrationHealthController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignIntegrationHealthController = controller;\n  }\n}\n","/**\n * E-Sign Integration Mappings Page Controller\n * CRUD management for integration mapping specifications\n */\n\nimport { qs, qsa, show, hide, onReady, announce } from '../utils/dom-helpers.js';\nimport { debounce } from '../utils/async-helpers.js';\n\n/**\n * Configuration for the integration mappings page\n */\nexport interface IntegrationMappingsConfig {\n  basePath: string;\n  apiBasePath?: string;\n}\n\n/**\n * Mapping specification\n */\ninterface MappingSpec {\n  id: string;\n  name: string;\n  provider: string;\n  status: 'draft' | 'published';\n  version: number;\n  compiled_hash?: string;\n  updated_at?: string;\n  external_schema?: {\n    object_type: string;\n    version?: string;\n    fields: SchemaField[];\n  };\n  rules?: MappingRule[];\n}\n\ninterface SchemaField {\n  object?: string;\n  field: string;\n  type: 'string' | 'number' | 'boolean' | 'date';\n  required?: boolean;\n}\n\ninterface MappingRule {\n  source_object?: string;\n  source_field: string;\n  target_entity: 'participant' | 'agreement' | 'field_definition' | 'field_instance';\n  target_path: string;\n}\n\ninterface TransformResult {\n  participants: Array<Record<string, unknown>>;\n  field_definitions: Array<{ path: string; value: unknown }>;\n  field_instances: Array<{ path: string; value: unknown }>;\n  agreement: Record<string, unknown>;\n  matched_rules: Array<{ source: string; matched: boolean; value?: unknown }>;\n}\n\ntype PageState = 'loading' | 'empty' | 'error' | 'list';\ntype PreviewState = 'empty' | 'loading' | 'error' | 'success';\n\n/**\n * Integration Mappings page controller\n * Manages CRUD operations, validation, and preview for mapping specifications\n */\nexport class IntegrationMappingsController {\n  private readonly config: IntegrationMappingsConfig;\n  private readonly apiBase: string;\n  private readonly mappingsEndpoint: string;\n\n  private mappings: MappingSpec[] = [];\n  private editingMappingId: string | null = null;\n  private pendingPublishId: string | null = null;\n  private pendingDeleteId: string | null = null;\n  private currentPreviewMapping: MappingSpec | null = null;\n\n  private readonly elements: {\n    announcements: HTMLElement | null;\n    loadingState: HTMLElement | null;\n    emptyState: HTMLElement | null;\n    errorState: HTMLElement | null;\n    mappingsList: HTMLElement | null;\n    mappingsTbody: HTMLElement | null;\n    searchInput: HTMLInputElement | null;\n    filterStatus: HTMLSelectElement | null;\n    filterProvider: HTMLSelectElement | null;\n    refreshBtn: HTMLElement | null;\n    retryBtn: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    createMappingBtn: HTMLElement | null;\n    createMappingEmptyBtn: HTMLElement | null;\n    mappingModal: HTMLElement | null;\n    mappingModalTitle: HTMLElement | null;\n    closeModalBtn: HTMLElement | null;\n    cancelModalBtn: HTMLElement | null;\n    mappingForm: HTMLFormElement | null;\n    mappingIdInput: HTMLInputElement | null;\n    mappingVersionInput: HTMLInputElement | null;\n    mappingNameInput: HTMLInputElement | null;\n    mappingProviderInput: HTMLInputElement | null;\n    schemaObjectTypeInput: HTMLInputElement | null;\n    schemaVersionInput: HTMLInputElement | null;\n    schemaFieldsContainer: HTMLElement | null;\n    addFieldBtn: HTMLElement | null;\n    mappingRulesContainer: HTMLElement | null;\n    addRuleBtn: HTMLElement | null;\n    validateBtn: HTMLElement | null;\n    saveBtn: HTMLElement | null;\n    formValidationStatus: HTMLElement | null;\n    mappingStatusBadge: HTMLElement | null;\n    publishModal: HTMLElement | null;\n    publishMappingName: HTMLElement | null;\n    publishMappingVersion: HTMLElement | null;\n    publishCancelBtn: HTMLElement | null;\n    publishConfirmBtn: HTMLElement | null;\n    deleteModal: HTMLElement | null;\n    deleteCancelBtn: HTMLElement | null;\n    deleteConfirmBtn: HTMLElement | null;\n    previewModal: HTMLElement | null;\n    closePreviewBtn: HTMLElement | null;\n    previewMappingName: HTMLElement | null;\n    previewMappingProvider: HTMLElement | null;\n    previewObjectType: HTMLElement | null;\n    previewMappingStatus: HTMLElement | null;\n    previewSourceInput: HTMLTextAreaElement | null;\n    sourceSyntaxError: HTMLElement | null;\n    loadSampleBtn: HTMLElement | null;\n    runPreviewBtn: HTMLElement | null;\n    clearPreviewBtn: HTMLElement | null;\n    previewEmpty: HTMLElement | null;\n    previewLoading: HTMLElement | null;\n    previewError: HTMLElement | null;\n    previewErrorMessage: HTMLElement | null;\n    previewSuccess: HTMLElement | null;\n    previewParticipants: HTMLElement | null;\n    participantsCount: HTMLElement | null;\n    previewFields: HTMLElement | null;\n    fieldsCount: HTMLElement | null;\n    previewMetadata: HTMLElement | null;\n    previewRawJson: HTMLElement | null;\n    previewRulesTbody: HTMLElement | null;\n  };\n\n  constructor(config: IntegrationMappingsConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n    this.mappingsEndpoint = `${this.apiBase}/esign/integrations/mappings`;\n\n    this.elements = {\n      announcements: qs('#mappings-announcements'),\n      loadingState: qs('#loading-state'),\n      emptyState: qs('#empty-state'),\n      errorState: qs('#error-state'),\n      mappingsList: qs('#mappings-list'),\n      mappingsTbody: qs('#mappings-tbody'),\n      searchInput: qs<HTMLInputElement>('#search-mappings'),\n      filterStatus: qs<HTMLSelectElement>('#filter-status'),\n      filterProvider: qs<HTMLSelectElement>('#filter-provider'),\n      refreshBtn: qs('#refresh-btn'),\n      retryBtn: qs('#retry-btn'),\n      errorMessage: qs('#error-message'),\n      createMappingBtn: qs('#create-mapping-btn'),\n      createMappingEmptyBtn: qs('#create-mapping-empty-btn'),\n      mappingModal: qs('#mapping-modal'),\n      mappingModalTitle: qs('#mapping-modal-title'),\n      closeModalBtn: qs('#close-modal-btn'),\n      cancelModalBtn: qs('#cancel-modal-btn'),\n      mappingForm: qs<HTMLFormElement>('#mapping-form'),\n      mappingIdInput: qs<HTMLInputElement>('#mapping-id'),\n      mappingVersionInput: qs<HTMLInputElement>('#mapping-version'),\n      mappingNameInput: qs<HTMLInputElement>('#mapping-name'),\n      mappingProviderInput: qs<HTMLInputElement>('#mapping-provider'),\n      schemaObjectTypeInput: qs<HTMLInputElement>('#schema-object-type'),\n      schemaVersionInput: qs<HTMLInputElement>('#schema-version'),\n      schemaFieldsContainer: qs('#schema-fields-container'),\n      addFieldBtn: qs('#add-field-btn'),\n      mappingRulesContainer: qs('#mapping-rules-container'),\n      addRuleBtn: qs('#add-rule-btn'),\n      validateBtn: qs('#validate-btn'),\n      saveBtn: qs('#save-btn'),\n      formValidationStatus: qs('#form-validation-status'),\n      mappingStatusBadge: qs('#mapping-status-badge'),\n      publishModal: qs('#publish-modal'),\n      publishMappingName: qs('#publish-mapping-name'),\n      publishMappingVersion: qs('#publish-mapping-version'),\n      publishCancelBtn: qs('#publish-cancel-btn'),\n      publishConfirmBtn: qs('#publish-confirm-btn'),\n      deleteModal: qs('#delete-modal'),\n      deleteCancelBtn: qs('#delete-cancel-btn'),\n      deleteConfirmBtn: qs('#delete-confirm-btn'),\n      previewModal: qs('#preview-modal'),\n      closePreviewBtn: qs('#close-preview-btn'),\n      previewMappingName: qs('#preview-mapping-name'),\n      previewMappingProvider: qs('#preview-mapping-provider'),\n      previewObjectType: qs('#preview-object-type'),\n      previewMappingStatus: qs('#preview-mapping-status'),\n      previewSourceInput: qs<HTMLTextAreaElement>('#preview-source-input'),\n      sourceSyntaxError: qs('#source-syntax-error'),\n      loadSampleBtn: qs('#load-sample-btn'),\n      runPreviewBtn: qs('#run-preview-btn'),\n      clearPreviewBtn: qs('#clear-preview-btn'),\n      previewEmpty: qs('#preview-empty'),\n      previewLoading: qs('#preview-loading'),\n      previewError: qs('#preview-error'),\n      previewErrorMessage: qs('#preview-error-message'),\n      previewSuccess: qs('#preview-success'),\n      previewParticipants: qs('#preview-participants'),\n      participantsCount: qs('#participants-count'),\n      previewFields: qs('#preview-fields'),\n      fieldsCount: qs('#fields-count'),\n      previewMetadata: qs('#preview-metadata'),\n      previewRawJson: qs('#preview-raw-json'),\n      previewRulesTbody: qs('#preview-rules-tbody'),\n    };\n  }\n\n  /**\n   * Initialize the mappings page\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    await this.loadMappings();\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const {\n      createMappingBtn,\n      createMappingEmptyBtn,\n      closeModalBtn,\n      cancelModalBtn,\n      refreshBtn,\n      retryBtn,\n      addFieldBtn,\n      addRuleBtn,\n      validateBtn,\n      mappingForm,\n      publishCancelBtn,\n      publishConfirmBtn,\n      deleteCancelBtn,\n      deleteConfirmBtn,\n      closePreviewBtn,\n      loadSampleBtn,\n      runPreviewBtn,\n      clearPreviewBtn,\n      previewSourceInput,\n      searchInput,\n      filterStatus,\n      filterProvider,\n      mappingModal,\n      publishModal,\n      deleteModal,\n      previewModal,\n    } = this.elements;\n\n    // Create/edit modal\n    createMappingBtn?.addEventListener('click', () => this.openCreateModal());\n    createMappingEmptyBtn?.addEventListener('click', () => this.openCreateModal());\n    closeModalBtn?.addEventListener('click', () => this.closeModal());\n    cancelModalBtn?.addEventListener('click', () => this.closeModal());\n\n    // List actions\n    refreshBtn?.addEventListener('click', () => this.loadMappings());\n    retryBtn?.addEventListener('click', () => this.loadMappings());\n\n    // Form actions\n    addFieldBtn?.addEventListener('click', () => this.addSchemaField());\n    addRuleBtn?.addEventListener('click', () => this.addMappingRule());\n    validateBtn?.addEventListener('click', () => this.validateMapping());\n    mappingForm?.addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.saveMapping();\n    });\n\n    // Publish modal\n    publishCancelBtn?.addEventListener('click', () => this.closePublishModal());\n    publishConfirmBtn?.addEventListener('click', () => this.publishMapping());\n\n    // Delete modal\n    deleteCancelBtn?.addEventListener('click', () => this.closeDeleteModal());\n    deleteConfirmBtn?.addEventListener('click', () => this.deleteMapping());\n\n    // Preview modal\n    closePreviewBtn?.addEventListener('click', () => this.closePreviewModal());\n    loadSampleBtn?.addEventListener('click', () => this.loadSamplePayload());\n    runPreviewBtn?.addEventListener('click', () => this.runPreviewTransform());\n    clearPreviewBtn?.addEventListener('click', () => this.clearPreview());\n    previewSourceInput?.addEventListener('input', debounce(() => this.validateSourceJson(), 300));\n\n    // Filters\n    searchInput?.addEventListener('input', debounce(() => this.renderMappings(), 300));\n    filterStatus?.addEventListener('change', () => this.renderMappings());\n    filterProvider?.addEventListener('change', () => this.renderMappings());\n\n    // Escape key\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (mappingModal && !mappingModal.classList.contains('hidden')) this.closeModal();\n        if (publishModal && !publishModal.classList.contains('hidden')) this.closePublishModal();\n        if (deleteModal && !deleteModal.classList.contains('hidden')) this.closeDeleteModal();\n        if (previewModal && !previewModal.classList.contains('hidden')) this.closePreviewModal();\n      }\n    });\n\n    // Backdrop click\n    [mappingModal, publishModal, deleteModal, previewModal].forEach((modal) => {\n      modal?.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        if (target === modal || target.getAttribute('aria-hidden') === 'true') {\n          if (modal === mappingModal) this.closeModal();\n          else if (modal === publishModal) this.closePublishModal();\n          else if (modal === deleteModal) this.closeDeleteModal();\n          else if (modal === previewModal) this.closePreviewModal();\n        }\n      });\n    });\n  }\n\n  /**\n   * Announce message for screen readers\n   */\n  private announce(message: string): void {\n    const { announcements } = this.elements;\n    if (announcements) {\n      announcements.textContent = message;\n    }\n    announce(message);\n  }\n\n  /**\n   * Show a specific page state\n   */\n  private showState(state: PageState): void {\n    const { loadingState, emptyState, errorState, mappingsList } = this.elements;\n\n    hide(loadingState);\n    hide(emptyState);\n    hide(errorState);\n    hide(mappingsList);\n\n    switch (state) {\n      case 'loading':\n        show(loadingState);\n        break;\n      case 'empty':\n        show(emptyState);\n        break;\n      case 'error':\n        show(errorState);\n        break;\n      case 'list':\n        show(mappingsList);\n        break;\n    }\n  }\n\n  /**\n   * Escape HTML for safe rendering\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text || '';\n    return div.innerHTML;\n  }\n\n  /**\n   * Format date string\n   */\n  private formatDate(dateStr?: string): string {\n    if (!dateStr) return '-';\n    try {\n      const date = new Date(dateStr);\n      return (\n        date.toLocaleDateString() +\n        ' ' +\n        date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n      );\n    } catch {\n      return dateStr;\n    }\n  }\n\n  /**\n   * Get status badge HTML\n   */\n  private getStatusBadge(status: string): string {\n    const configs: Record<string, { label: string; bg: string; text: string; dot: string }> = {\n      draft: { label: 'Draft', bg: 'bg-gray-100', text: 'text-gray-700', dot: 'bg-gray-400' },\n      published: { label: 'Published', bg: 'bg-green-100', text: 'text-green-700', dot: 'bg-green-500' },\n    };\n    const config = configs[status] || configs.draft;\n    return `<span class=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${config.bg} ${config.text}\">\n      <span class=\"w-1.5 h-1.5 rounded-full ${config.dot}\" aria-hidden=\"true\"></span>\n      ${config.label}\n    </span>`;\n  }\n\n  /**\n   * Load mappings from API\n   */\n  async loadMappings(): Promise<void> {\n    this.showState('loading');\n\n    try {\n      const response = await fetch(this.mappingsEndpoint, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n\n      const data = await response.json();\n      this.mappings = data.mappings || [];\n\n      // Populate provider filter\n      this.populateProviderFilter();\n\n      this.renderMappings();\n      this.announce(`Loaded ${this.mappings.length} mappings`);\n    } catch (error) {\n      console.error('Error loading mappings:', error);\n      const { errorMessage } = this.elements;\n      if (errorMessage) {\n        errorMessage.textContent = error instanceof Error ? error.message : 'An error occurred';\n      }\n      this.showState('error');\n      this.announce('Error loading mappings');\n    }\n  }\n\n  /**\n   * Populate provider filter dropdown\n   */\n  private populateProviderFilter(): void {\n    const { filterProvider } = this.elements;\n    if (!filterProvider) return;\n\n    const providers = [...new Set(this.mappings.map((m) => m.provider).filter(Boolean))];\n    filterProvider.innerHTML =\n      '<option value=\"\">All Providers</option>' +\n      providers.map((p) => `<option value=\"${this.escapeHtml(p)}\">${this.escapeHtml(p)}</option>`).join('');\n  }\n\n  /**\n   * Render mappings list with filters applied\n   */\n  private renderMappings(): void {\n    const { mappingsTbody, searchInput, filterStatus, filterProvider } = this.elements;\n    if (!mappingsTbody) return;\n\n    const search = (searchInput?.value || '').toLowerCase();\n    const statusFilter = filterStatus?.value || '';\n    const providerFilter = filterProvider?.value || '';\n\n    const filtered = this.mappings.filter((m) => {\n      if (search && !m.name.toLowerCase().includes(search) && !m.provider.toLowerCase().includes(search)) {\n        return false;\n      }\n      if (statusFilter && m.status !== statusFilter) return false;\n      if (providerFilter && m.provider !== providerFilter) return false;\n      return true;\n    });\n\n    if (filtered.length === 0) {\n      this.showState('empty');\n      return;\n    }\n\n    mappingsTbody.innerHTML = filtered\n      .map(\n        (m) => `\n      <tr class=\"hover:bg-gray-50\">\n        <td class=\"px-6 py-4\">\n          <div class=\"font-medium text-gray-900\">${this.escapeHtml(m.name)}</div>\n          <div class=\"text-xs text-gray-500\">${this.escapeHtml(m.compiled_hash ? m.compiled_hash.slice(0, 12) + '...' : '')}</div>\n        </td>\n        <td class=\"px-6 py-4 text-sm text-gray-700\">${this.escapeHtml(m.provider)}</td>\n        <td class=\"px-6 py-4\">${this.getStatusBadge(m.status)}</td>\n        <td class=\"px-6 py-4 text-sm text-gray-700\">v${m.version || 1}</td>\n        <td class=\"px-6 py-4 text-sm text-gray-500\">${this.formatDate(m.updated_at)}</td>\n        <td class=\"px-6 py-4 text-right\">\n          <div class=\"flex items-center justify-end gap-2\">\n            <button type=\"button\" class=\"preview-mapping-btn text-purple-600 hover:text-purple-700 text-sm font-medium\" data-id=\"${this.escapeHtml(m.id)}\" aria-label=\"Preview ${this.escapeHtml(m.name)}\">\n              Preview\n            </button>\n            <button type=\"button\" class=\"edit-mapping-btn text-blue-600 hover:text-blue-700 text-sm font-medium\" data-id=\"${this.escapeHtml(m.id)}\" aria-label=\"Edit ${this.escapeHtml(m.name)}\">\n              Edit\n            </button>\n            ${\n              m.status === 'draft'\n                ? `\n              <button type=\"button\" class=\"publish-mapping-btn text-green-600 hover:text-green-700 text-sm font-medium\" data-id=\"${this.escapeHtml(m.id)}\" aria-label=\"Publish ${this.escapeHtml(m.name)}\">\n                Publish\n              </button>\n            `\n                : ''\n            }\n            <button type=\"button\" class=\"delete-mapping-btn text-red-600 hover:text-red-700 text-sm font-medium\" data-id=\"${this.escapeHtml(m.id)}\" aria-label=\"Delete ${this.escapeHtml(m.name)}\">\n              Delete\n            </button>\n          </div>\n        </td>\n      </tr>\n    `\n      )\n      .join('');\n\n    this.showState('list');\n    this.attachRowListeners();\n  }\n\n  /**\n   * Attach event listeners to table row buttons\n   */\n  private attachRowListeners(): void {\n    const { mappingsTbody } = this.elements;\n    if (!mappingsTbody) return;\n\n    mappingsTbody.querySelectorAll<HTMLElement>('.preview-mapping-btn').forEach((btn) => {\n      btn.addEventListener('click', () => this.openPreviewModal(btn.dataset.id || ''));\n    });\n\n    mappingsTbody.querySelectorAll<HTMLElement>('.edit-mapping-btn').forEach((btn) => {\n      btn.addEventListener('click', () => this.openEditModal(btn.dataset.id || ''));\n    });\n\n    mappingsTbody.querySelectorAll<HTMLElement>('.publish-mapping-btn').forEach((btn) => {\n      btn.addEventListener('click', () => this.openPublishModal(btn.dataset.id || ''));\n    });\n\n    mappingsTbody.querySelectorAll<HTMLElement>('.delete-mapping-btn').forEach((btn) => {\n      btn.addEventListener('click', () => this.openDeleteModal(btn.dataset.id || ''));\n    });\n  }\n\n  // Form management methods\n\n  /**\n   * Create a schema field row element\n   */\n  private createSchemaFieldRow(field: Partial<SchemaField> = {}): HTMLElement {\n    const row = document.createElement('div');\n    row.className = 'flex items-center gap-2 p-2 bg-gray-50 rounded-lg schema-field-row';\n    row.innerHTML = `\n      <input type=\"text\" placeholder=\"object\" value=\"${this.escapeHtml(field.object || '')}\" class=\"field-object flex-1 px-2 py-1 border border-gray-300 rounded text-sm\">\n      <input type=\"text\" placeholder=\"field\" value=\"${this.escapeHtml(field.field || '')}\" class=\"field-name flex-1 px-2 py-1 border border-gray-300 rounded text-sm\" required>\n      <select class=\"field-type px-2 py-1 border border-gray-300 rounded text-sm\">\n        <option value=\"string\" ${field.type === 'string' ? 'selected' : ''}>string</option>\n        <option value=\"number\" ${field.type === 'number' ? 'selected' : ''}>number</option>\n        <option value=\"boolean\" ${field.type === 'boolean' ? 'selected' : ''}>boolean</option>\n        <option value=\"date\" ${field.type === 'date' ? 'selected' : ''}>date</option>\n      </select>\n      <label class=\"flex items-center gap-1 text-xs\">\n        <input type=\"checkbox\" class=\"field-required\" ${field.required ? 'checked' : ''}> Req\n      </label>\n      <button type=\"button\" class=\"remove-field-btn text-red-500 hover:text-red-600\" aria-label=\"Remove field\">\n        <svg class=\"w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n    `;\n    row.querySelector('.remove-field-btn')?.addEventListener('click', () => row.remove());\n    return row;\n  }\n\n  /**\n   * Create a mapping rule row element\n   */\n  private createMappingRuleRow(rule: Partial<MappingRule> = {}): HTMLElement {\n    const row = document.createElement('div');\n    row.className = 'flex items-center gap-2 p-2 bg-gray-50 rounded-lg mapping-rule-row';\n    row.innerHTML = `\n      <input type=\"text\" placeholder=\"source_object\" value=\"${this.escapeHtml(rule.source_object || '')}\" class=\"rule-source-object flex-1 px-2 py-1 border border-gray-300 rounded text-sm\">\n      <input type=\"text\" placeholder=\"source_field\" value=\"${this.escapeHtml(rule.source_field || '')}\" class=\"rule-source-field flex-1 px-2 py-1 border border-gray-300 rounded text-sm\" required>\n      <span class=\"text-gray-400\"></span>\n      <select class=\"rule-target-entity px-2 py-1 border border-gray-300 rounded text-sm\">\n        <option value=\"participant\" ${rule.target_entity === 'participant' ? 'selected' : ''}>participant</option>\n        <option value=\"agreement\" ${rule.target_entity === 'agreement' ? 'selected' : ''}>agreement</option>\n        <option value=\"field_definition\" ${rule.target_entity === 'field_definition' ? 'selected' : ''}>field_definition</option>\n        <option value=\"field_instance\" ${rule.target_entity === 'field_instance' ? 'selected' : ''}>field_instance</option>\n      </select>\n      <input type=\"text\" placeholder=\"target_path\" value=\"${this.escapeHtml(rule.target_path || '')}\" class=\"rule-target-path flex-1 px-2 py-1 border border-gray-300 rounded text-sm\" required>\n      <button type=\"button\" class=\"remove-rule-btn text-red-500 hover:text-red-600\" aria-label=\"Remove rule\">\n        <svg class=\"w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n    `;\n    row.querySelector('.remove-rule-btn')?.addEventListener('click', () => row.remove());\n    return row;\n  }\n\n  /**\n   * Add a new schema field row\n   */\n  private addSchemaField(field?: Partial<SchemaField>): void {\n    const { schemaFieldsContainer } = this.elements;\n    if (schemaFieldsContainer) {\n      schemaFieldsContainer.appendChild(this.createSchemaFieldRow(field));\n    }\n  }\n\n  /**\n   * Add a new mapping rule row\n   */\n  private addMappingRule(rule?: Partial<MappingRule>): void {\n    const { mappingRulesContainer } = this.elements;\n    if (mappingRulesContainer) {\n      mappingRulesContainer.appendChild(this.createMappingRuleRow(rule));\n    }\n  }\n\n  /**\n   * Collect form data into a mapping spec object\n   */\n  private collectFormData(): Partial<MappingSpec> {\n    const {\n      mappingIdInput,\n      mappingVersionInput,\n      mappingNameInput,\n      mappingProviderInput,\n      schemaObjectTypeInput,\n      schemaVersionInput,\n      schemaFieldsContainer,\n      mappingRulesContainer,\n    } = this.elements;\n\n    const fields: SchemaField[] = [];\n    schemaFieldsContainer?.querySelectorAll<HTMLElement>('.schema-field-row').forEach((row) => {\n      fields.push({\n        object: (row.querySelector<HTMLInputElement>('.field-object')?.value || '').trim(),\n        field: (row.querySelector<HTMLInputElement>('.field-name')?.value || '').trim(),\n        type: (row.querySelector<HTMLSelectElement>('.field-type')?.value || 'string') as SchemaField['type'],\n        required: row.querySelector<HTMLInputElement>('.field-required')?.checked || false,\n      });\n    });\n\n    const rules: MappingRule[] = [];\n    mappingRulesContainer?.querySelectorAll<HTMLElement>('.mapping-rule-row').forEach((row) => {\n      rules.push({\n        source_object: (row.querySelector<HTMLInputElement>('.rule-source-object')?.value || '').trim(),\n        source_field: (row.querySelector<HTMLInputElement>('.rule-source-field')?.value || '').trim(),\n        target_entity: (row.querySelector<HTMLSelectElement>('.rule-target-entity')?.value ||\n          'participant') as MappingRule['target_entity'],\n        target_path: (row.querySelector<HTMLInputElement>('.rule-target-path')?.value || '').trim(),\n      });\n    });\n\n    return {\n      id: mappingIdInput?.value.trim() || undefined,\n      version: parseInt(mappingVersionInput?.value || '0', 10) || 0,\n      name: mappingNameInput?.value.trim() || '',\n      provider: mappingProviderInput?.value.trim() || '',\n      external_schema: {\n        object_type: schemaObjectTypeInput?.value.trim() || '',\n        version: schemaVersionInput?.value.trim() || undefined,\n        fields,\n      },\n      rules,\n    };\n  }\n\n  /**\n   * Populate form with mapping data\n   */\n  private populateForm(mapping: MappingSpec): void {\n    const {\n      mappingIdInput,\n      mappingVersionInput,\n      mappingNameInput,\n      mappingProviderInput,\n      schemaObjectTypeInput,\n      schemaVersionInput,\n      schemaFieldsContainer,\n      mappingRulesContainer,\n      mappingStatusBadge,\n      formValidationStatus,\n    } = this.elements;\n\n    if (mappingIdInput) mappingIdInput.value = mapping.id || '';\n    if (mappingVersionInput) mappingVersionInput.value = String(mapping.version || 0);\n    if (mappingNameInput) mappingNameInput.value = mapping.name || '';\n    if (mappingProviderInput) mappingProviderInput.value = mapping.provider || '';\n\n    const schema = mapping.external_schema || { object_type: '', fields: [] };\n    if (schemaObjectTypeInput) schemaObjectTypeInput.value = schema.object_type || '';\n    if (schemaVersionInput) schemaVersionInput.value = schema.version || '';\n\n    if (schemaFieldsContainer) {\n      schemaFieldsContainer.innerHTML = '';\n      (schema.fields || []).forEach((f) => schemaFieldsContainer.appendChild(this.createSchemaFieldRow(f)));\n    }\n\n    if (mappingRulesContainer) {\n      mappingRulesContainer.innerHTML = '';\n      (mapping.rules || []).forEach((r) => mappingRulesContainer.appendChild(this.createMappingRuleRow(r)));\n    }\n\n    if (mapping.status && mappingStatusBadge) {\n      mappingStatusBadge.innerHTML = this.getStatusBadge(mapping.status);\n      mappingStatusBadge.classList.remove('hidden');\n    } else if (mappingStatusBadge) {\n      mappingStatusBadge.classList.add('hidden');\n    }\n\n    hide(formValidationStatus);\n  }\n\n  /**\n   * Reset the form to initial state\n   */\n  private resetForm(): void {\n    const {\n      mappingForm,\n      mappingIdInput,\n      mappingVersionInput,\n      schemaFieldsContainer,\n      mappingRulesContainer,\n      mappingStatusBadge,\n      formValidationStatus,\n    } = this.elements;\n\n    mappingForm?.reset();\n    if (mappingIdInput) mappingIdInput.value = '';\n    if (mappingVersionInput) mappingVersionInput.value = '0';\n    if (schemaFieldsContainer) schemaFieldsContainer.innerHTML = '';\n    if (mappingRulesContainer) mappingRulesContainer.innerHTML = '';\n    if (mappingStatusBadge) mappingStatusBadge.classList.add('hidden');\n    hide(formValidationStatus);\n    this.editingMappingId = null;\n  }\n\n  // Modal methods\n\n  /**\n   * Open create mapping modal\n   */\n  private openCreateModal(): void {\n    const { mappingModal, mappingModalTitle, mappingNameInput } = this.elements;\n\n    this.resetForm();\n    if (mappingModalTitle) mappingModalTitle.textContent = 'New Mapping Specification';\n\n    // Add default field and rule\n    this.addSchemaField({ field: 'email', type: 'string', required: true });\n    this.addMappingRule({ target_entity: 'participant', target_path: 'email' });\n\n    show(mappingModal);\n    mappingNameInput?.focus();\n  }\n\n  /**\n   * Open edit mapping modal\n   */\n  private openEditModal(id: string): void {\n    const mapping = this.mappings.find((m) => m.id === id);\n    if (!mapping) return;\n\n    const { mappingModal, mappingModalTitle, mappingNameInput } = this.elements;\n\n    this.editingMappingId = id;\n    if (mappingModalTitle) mappingModalTitle.textContent = 'Edit Mapping Specification';\n    this.populateForm(mapping);\n\n    show(mappingModal);\n    mappingNameInput?.focus();\n  }\n\n  /**\n   * Close mapping modal\n   */\n  private closeModal(): void {\n    const { mappingModal } = this.elements;\n    hide(mappingModal);\n    this.resetForm();\n  }\n\n  /**\n   * Open publish confirmation modal\n   */\n  private openPublishModal(id: string): void {\n    const mapping = this.mappings.find((m) => m.id === id);\n    if (!mapping) return;\n\n    const { publishModal, publishMappingName, publishMappingVersion } = this.elements;\n\n    this.pendingPublishId = id;\n    if (publishMappingName) publishMappingName.textContent = mapping.name;\n    if (publishMappingVersion) publishMappingVersion.textContent = `v${mapping.version || 1}`;\n\n    show(publishModal);\n  }\n\n  /**\n   * Close publish modal\n   */\n  private closePublishModal(): void {\n    hide(this.elements.publishModal);\n    this.pendingPublishId = null;\n  }\n\n  /**\n   * Open delete confirmation modal\n   */\n  private openDeleteModal(id: string): void {\n    this.pendingDeleteId = id;\n    show(this.elements.deleteModal);\n  }\n\n  /**\n   * Close delete modal\n   */\n  private closeDeleteModal(): void {\n    hide(this.elements.deleteModal);\n    this.pendingDeleteId = null;\n  }\n\n  // CRUD operations\n\n  /**\n   * Validate mapping\n   */\n  async validateMapping(): Promise<void> {\n    const { validateBtn, formValidationStatus } = this.elements;\n    if (!validateBtn) return;\n\n    const data = this.collectFormData();\n\n    validateBtn.setAttribute('disabled', 'true');\n    validateBtn.innerHTML = `<svg class=\"animate-spin w-4 h-4 mr-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"></path></svg> Validating...`;\n\n    try {\n      const response = await fetch(this.mappingsEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\n        body: JSON.stringify({ ...data, validate_only: true }),\n      });\n\n      const result = await response.json();\n\n      if (response.ok && result.status === 'ok') {\n        if (formValidationStatus) {\n          formValidationStatus.innerHTML = `\n            <div class=\"flex items-start gap-3 text-green-700 bg-green-50 border border-green-200\">\n              <svg class=\"w-5 h-5 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              <div>\n                <p class=\"font-medium\">Validation Passed</p>\n                <p class=\"text-sm mt-1\">Mapping specification is valid. Compiled hash: <code class=\"text-xs bg-green-100 px-1 py-0.5 rounded\">${this.escapeHtml((result.mapping?.compiled_hash || '').slice(0, 16))}</code></p>\n              </div>\n            </div>\n          `;\n          formValidationStatus.className = 'rounded-lg p-4';\n        }\n        this.announce('Validation passed');\n      } else {\n        const errors = result.errors || [result.error?.message || 'Validation failed'];\n        if (formValidationStatus) {\n          formValidationStatus.innerHTML = `\n            <div class=\"flex items-start gap-3 text-red-700 bg-red-50 border border-red-200\">\n              <svg class=\"w-5 h-5 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n              </svg>\n              <div>\n                <p class=\"font-medium\">Validation Failed</p>\n                <ul class=\"text-sm mt-1 list-disc list-inside\">${errors.map((e: string) => `<li>${this.escapeHtml(e)}</li>`).join('')}</ul>\n              </div>\n            </div>\n          `;\n          formValidationStatus.className = 'rounded-lg p-4';\n        }\n        this.announce('Validation failed');\n      }\n\n      show(formValidationStatus);\n    } catch (error) {\n      console.error('Validation error:', error);\n      if (formValidationStatus) {\n        formValidationStatus.innerHTML = `<div class=\"text-red-600\">Error: ${this.escapeHtml(error instanceof Error ? error.message : 'Unknown error')}</div>`;\n        show(formValidationStatus);\n      }\n    } finally {\n      validateBtn.removeAttribute('disabled');\n      validateBtn.innerHTML = `<svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg> Validate`;\n    }\n  }\n\n  /**\n   * Save mapping (create or update)\n   */\n  async saveMapping(): Promise<void> {\n    const { saveBtn } = this.elements;\n    if (!saveBtn) return;\n\n    const data = this.collectFormData();\n\n    saveBtn.setAttribute('disabled', 'true');\n    saveBtn.innerHTML = `<svg class=\"animate-spin w-4 h-4 mr-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"></path></svg> Saving...`;\n\n    try {\n      const isUpdate = !!data.id;\n      const url = isUpdate ? `${this.mappingsEndpoint}/${data.id}` : this.mappingsEndpoint;\n      const method = isUpdate ? 'PUT' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        credentials: 'same-origin',\n        headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const result = await response.json();\n        throw new Error(result.error?.message || `HTTP ${response.status}`);\n      }\n\n      this.showToast(isUpdate ? 'Mapping updated' : 'Mapping created', 'success');\n      this.announce(isUpdate ? 'Mapping updated' : 'Mapping created');\n      this.closeModal();\n      await this.loadMappings();\n    } catch (error) {\n      console.error('Save error:', error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed to save: ${message}`, 'error');\n      this.announce(`Failed to save: ${message}`);\n    } finally {\n      saveBtn.removeAttribute('disabled');\n      saveBtn.innerHTML = `<svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg> Save Draft`;\n    }\n  }\n\n  /**\n   * Publish mapping\n   */\n  async publishMapping(): Promise<void> {\n    if (!this.pendingPublishId) return;\n\n    const mapping = this.mappings.find((m) => m.id === this.pendingPublishId);\n    if (!mapping) return;\n\n    const { publishConfirmBtn } = this.elements;\n    if (!publishConfirmBtn) return;\n\n    publishConfirmBtn.setAttribute('disabled', 'true');\n    publishConfirmBtn.textContent = 'Publishing...';\n\n    try {\n      const response = await fetch(`${this.mappingsEndpoint}/${this.pendingPublishId}/publish`, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\n        body: JSON.stringify({ expected_version: mapping.version }),\n      });\n\n      if (!response.ok) {\n        const result = await response.json();\n        throw new Error(result.error?.message || `HTTP ${response.status}`);\n      }\n\n      this.showToast('Mapping published', 'success');\n      this.announce('Mapping published');\n      this.closePublishModal();\n      await this.loadMappings();\n    } catch (error) {\n      console.error('Publish error:', error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed to publish: ${message}`, 'error');\n    } finally {\n      publishConfirmBtn.removeAttribute('disabled');\n      publishConfirmBtn.textContent = 'Publish';\n    }\n  }\n\n  /**\n   * Delete mapping\n   */\n  async deleteMapping(): Promise<void> {\n    if (!this.pendingDeleteId) return;\n\n    const { deleteConfirmBtn } = this.elements;\n    if (!deleteConfirmBtn) return;\n\n    deleteConfirmBtn.setAttribute('disabled', 'true');\n    deleteConfirmBtn.textContent = 'Deleting...';\n\n    try {\n      const response = await fetch(`${this.mappingsEndpoint}/${this.pendingDeleteId}`, {\n        method: 'DELETE',\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) {\n        const result = await response.json();\n        throw new Error(result.error?.message || `HTTP ${response.status}`);\n      }\n\n      this.showToast('Mapping deleted', 'success');\n      this.announce('Mapping deleted');\n      this.closeDeleteModal();\n      await this.loadMappings();\n    } catch (error) {\n      console.error('Delete error:', error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed to delete: ${message}`, 'error');\n    } finally {\n      deleteConfirmBtn.removeAttribute('disabled');\n      deleteConfirmBtn.textContent = 'Delete';\n    }\n  }\n\n  // Preview methods\n\n  /**\n   * Open preview modal\n   */\n  private openPreviewModal(id: string): void {\n    const mapping = this.mappings.find((m) => m.id === id);\n    if (!mapping) return;\n\n    const {\n      previewModal,\n      previewMappingName,\n      previewMappingProvider,\n      previewObjectType,\n      previewMappingStatus,\n      previewSourceInput,\n      sourceSyntaxError,\n    } = this.elements;\n\n    this.currentPreviewMapping = mapping;\n\n    if (previewMappingName) previewMappingName.textContent = mapping.name;\n    if (previewMappingProvider) previewMappingProvider.textContent = mapping.provider;\n    if (previewObjectType) previewObjectType.textContent = mapping.external_schema?.object_type || '-';\n    if (previewMappingStatus) previewMappingStatus.innerHTML = this.getStatusBadge(mapping.status);\n\n    this.renderPreviewRules(mapping.rules || []);\n    this.showPreviewState('empty');\n\n    if (previewSourceInput) previewSourceInput.value = '';\n    hide(sourceSyntaxError);\n\n    show(previewModal);\n    previewSourceInput?.focus();\n  }\n\n  /**\n   * Close preview modal\n   */\n  private closePreviewModal(): void {\n    hide(this.elements.previewModal);\n    this.currentPreviewMapping = null;\n    if (this.elements.previewSourceInput) {\n      this.elements.previewSourceInput.value = '';\n    }\n  }\n\n  /**\n   * Show preview state\n   */\n  private showPreviewState(state: PreviewState): void {\n    const { previewEmpty, previewLoading, previewError, previewSuccess } = this.elements;\n\n    hide(previewEmpty);\n    hide(previewLoading);\n    hide(previewError);\n    hide(previewSuccess);\n\n    switch (state) {\n      case 'empty':\n        show(previewEmpty);\n        break;\n      case 'loading':\n        show(previewLoading);\n        break;\n      case 'error':\n        show(previewError);\n        break;\n      case 'success':\n        show(previewSuccess);\n        break;\n    }\n  }\n\n  /**\n   * Render preview rules table\n   */\n  private renderPreviewRules(rules: MappingRule[]): void {\n    const { previewRulesTbody } = this.elements;\n    if (!previewRulesTbody) return;\n\n    if (!rules || rules.length === 0) {\n      previewRulesTbody.innerHTML =\n        '<tr><td colspan=\"5\" class=\"px-3 py-4 text-center text-sm text-gray-500\">No mapping rules defined</td></tr>';\n      return;\n    }\n\n    previewRulesTbody.innerHTML = rules\n      .map(\n        (rule) => `\n      <tr>\n        <td class=\"px-3 py-2 font-mono text-xs\">${this.escapeHtml(rule.source_object ? rule.source_object + '.' : '')}${this.escapeHtml(rule.source_field)}</td>\n        <td class=\"px-3 py-2 text-center text-gray-400\"></td>\n        <td class=\"px-3 py-2\">\n          <span class=\"px-2 py-0.5 bg-gray-100 rounded text-xs font-medium\">${this.escapeHtml(rule.target_entity)}</span>\n        </td>\n        <td class=\"px-3 py-2 font-mono text-xs\">${this.escapeHtml(rule.target_path)}</td>\n        <td class=\"px-3 py-2\" data-rule-source=\"${this.escapeHtml(rule.source_field)}\">\n          <span class=\"px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600\">Pending</span>\n        </td>\n      </tr>\n    `\n      )\n      .join('');\n  }\n\n  /**\n   * Load sample payload\n   */\n  private loadSamplePayload(): void {\n    if (!this.currentPreviewMapping) return;\n\n    const { previewSourceInput, sourceSyntaxError } = this.elements;\n    const schema = this.currentPreviewMapping.external_schema || { object_type: 'data', fields: [] };\n    const objectType = schema.object_type || 'data';\n    const fields = schema.fields || [];\n\n    const sample: Record<string, Record<string, unknown>> = {};\n    const innerObj: Record<string, unknown> = {};\n\n    fields.forEach((field) => {\n      const key = field.field || 'field';\n      switch (field.type) {\n        case 'string':\n          innerObj[key] = key === 'email' ? 'john.doe@example.com' : key === 'name' ? 'John Doe' : `sample_${key}`;\n          break;\n        case 'number':\n          innerObj[key] = 123;\n          break;\n        case 'boolean':\n          innerObj[key] = true;\n          break;\n        case 'date':\n          innerObj[key] = new Date().toISOString().split('T')[0];\n          break;\n        default:\n          innerObj[key] = `sample_${key}`;\n      }\n    });\n\n    sample[objectType] = innerObj;\n\n    if (previewSourceInput) {\n      previewSourceInput.value = JSON.stringify(sample, null, 2);\n    }\n    hide(sourceSyntaxError);\n  }\n\n  /**\n   * Validate source JSON\n   */\n  private validateSourceJson(): unknown | null {\n    const { previewSourceInput, sourceSyntaxError } = this.elements;\n    const value = previewSourceInput?.value.trim() || '';\n\n    if (!value) {\n      hide(sourceSyntaxError);\n      return null;\n    }\n\n    try {\n      const parsed = JSON.parse(value);\n      hide(sourceSyntaxError);\n      return parsed;\n    } catch (e) {\n      if (sourceSyntaxError) {\n        sourceSyntaxError.textContent = `JSON Syntax Error: ${e instanceof Error ? e.message : 'Invalid JSON'}`;\n        show(sourceSyntaxError);\n      }\n      return null;\n    }\n  }\n\n  /**\n   * Run preview transform\n   */\n  private async runPreviewTransform(): Promise<void> {\n    const { previewSourceInput, previewErrorMessage } = this.elements;\n    const sourcePayload = this.validateSourceJson();\n\n    if (sourcePayload === null && previewSourceInput?.value.trim()) {\n      return; // JSON syntax error\n    }\n\n    if (!sourcePayload) {\n      this.showPreviewState('empty');\n      return;\n    }\n\n    if (!this.currentPreviewMapping) return;\n\n    this.showPreviewState('loading');\n\n    try {\n      const result = this.simulateTransform(sourcePayload as Record<string, unknown>, this.currentPreviewMapping);\n      this.renderPreviewResult(result);\n      this.showPreviewState('success');\n    } catch (error) {\n      console.error('Transform error:', error);\n      if (previewErrorMessage) {\n        previewErrorMessage.textContent = error instanceof Error ? error.message : 'Transform failed';\n      }\n      this.showPreviewState('error');\n    }\n  }\n\n  /**\n   * Simulate transform (client-side preview)\n   */\n  private simulateTransform(sourcePayload: Record<string, unknown>, mapping: MappingSpec): TransformResult {\n    const rules = mapping.rules || [];\n    const result: TransformResult = {\n      participants: [],\n      field_definitions: [],\n      field_instances: [],\n      agreement: {},\n      matched_rules: [],\n    };\n\n    const participantData: Record<string, unknown> = {};\n    const agreementData: Record<string, unknown> = {};\n    const fieldDefData: Array<{ path: string; value: unknown }> = [];\n\n    rules.forEach((rule) => {\n      const sourceValue = this.resolveSourceValue(sourcePayload, rule.source_object, rule.source_field);\n      const matched = sourceValue !== undefined;\n\n      result.matched_rules.push({\n        source: rule.source_field,\n        matched,\n        value: sourceValue,\n      });\n\n      if (!matched) return;\n\n      switch (rule.target_entity) {\n        case 'participant':\n          participantData[rule.target_path] = sourceValue;\n          break;\n        case 'agreement':\n          agreementData[rule.target_path] = sourceValue;\n          break;\n        case 'field_definition':\n          fieldDefData.push({ path: rule.target_path, value: sourceValue });\n          break;\n      }\n    });\n\n    if (Object.keys(participantData).length > 0) {\n      result.participants.push({\n        ...participantData,\n        role: (participantData.role as string) || 'signer',\n        signing_stage: (participantData.signing_stage as number) || 1,\n      });\n    }\n\n    result.agreement = agreementData;\n    result.field_definitions = fieldDefData;\n\n    return result;\n  }\n\n  /**\n   * Resolve source value from payload\n   */\n  private resolveSourceValue(\n    payload: Record<string, unknown>,\n    sourceObject?: string,\n    sourceField?: string\n  ): unknown {\n    if (!payload || !sourceField) return undefined;\n\n    // Try direct field access with source object\n    if (sourceObject && payload[sourceObject]) {\n      const obj = payload[sourceObject] as Record<string, unknown>;\n      return obj[sourceField];\n    }\n\n    // Try nested access using first key\n    for (const key of Object.keys(payload)) {\n      if (typeof payload[key] === 'object' && payload[key] !== null) {\n        const obj = payload[key] as Record<string, unknown>;\n        if (sourceField in obj) {\n          return obj[sourceField];\n        }\n      }\n    }\n\n    // Try direct access\n    return payload[sourceField];\n  }\n\n  /**\n   * Render preview result\n   */\n  private renderPreviewResult(result: TransformResult): void {\n    const {\n      previewParticipants,\n      participantsCount,\n      previewFields,\n      fieldsCount,\n      previewMetadata,\n      previewRawJson,\n      previewRulesTbody,\n    } = this.elements;\n\n    // Render participants\n    const participants = result.participants || [];\n    if (participantsCount) participantsCount.textContent = `(${participants.length})`;\n\n    if (previewParticipants) {\n      if (participants.length === 0) {\n        previewParticipants.innerHTML = '<p class=\"text-sm text-gray-500\">No participants resolved</p>';\n      } else {\n        previewParticipants.innerHTML = participants\n          .map(\n            (p) => `\n          <div class=\"flex items-center gap-3 p-2 bg-gray-50 rounded-lg\">\n            <div class=\"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-sm font-medium text-blue-700\">\n              ${this.escapeHtml(String(p.name || p.email || '?').charAt(0).toUpperCase())}\n            </div>\n            <div class=\"flex-1 min-w-0\">\n              <p class=\"text-sm font-medium text-gray-900 truncate\">${this.escapeHtml(String(p.name || '-'))}</p>\n              <p class=\"text-xs text-gray-500 truncate\">${this.escapeHtml(String(p.email || '-'))}</p>\n            </div>\n            <div class=\"flex items-center gap-2\">\n              <span class=\"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-medium\">${this.escapeHtml(String(p.role))}</span>\n              <span class=\"text-xs text-gray-500\">Stage ${p.signing_stage}</span>\n            </div>\n          </div>\n        `\n          )\n          .join('');\n      }\n    }\n\n    // Render field definitions\n    const fields = result.field_definitions || [];\n    if (fieldsCount) fieldsCount.textContent = `(${fields.length})`;\n\n    if (previewFields) {\n      if (fields.length === 0) {\n        previewFields.innerHTML = '<p class=\"text-sm text-gray-500\">No field definitions resolved</p>';\n      } else {\n        previewFields.innerHTML = fields\n          .map(\n            (f) => `\n          <div class=\"flex items-center gap-2 p-2 bg-gray-50 rounded-lg text-sm\">\n            <span class=\"font-mono text-xs text-gray-600\">${this.escapeHtml(f.path)}</span>\n            <span class=\"text-gray-400\">=</span>\n            <span class=\"text-gray-900\">${this.escapeHtml(String(f.value))}</span>\n          </div>\n        `\n          )\n          .join('');\n      }\n    }\n\n    // Render agreement metadata\n    const metadata = result.agreement || {};\n    const metaEntries = Object.entries(metadata);\n\n    if (previewMetadata) {\n      if (metaEntries.length === 0) {\n        previewMetadata.innerHTML = '<p class=\"text-sm text-gray-500\">No agreement metadata resolved</p>';\n      } else {\n        previewMetadata.innerHTML = metaEntries\n          .map(\n            ([key, value]) => `\n          <div class=\"flex items-center gap-2 text-sm\">\n            <span class=\"text-gray-600\">${this.escapeHtml(key)}:</span>\n            <span class=\"text-gray-900\">${this.escapeHtml(String(value))}</span>\n          </div>\n        `\n          )\n          .join('');\n      }\n    }\n\n    // Render raw JSON\n    if (previewRawJson) {\n      previewRawJson.textContent = JSON.stringify(result, null, 2);\n    }\n\n    // Update rule status indicators\n    (result.matched_rules || []).forEach((rule) => {\n      const cell = previewRulesTbody?.querySelector(`[data-rule-source=\"${this.escapeHtml(rule.source)}\"] span`);\n      if (cell) {\n        if (rule.matched) {\n          cell.className = 'px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-700';\n          cell.textContent = 'Matched';\n        } else {\n          cell.className = 'px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-700';\n          cell.textContent = 'Not Found';\n        }\n      }\n    });\n  }\n\n  /**\n   * Clear preview\n   */\n  private clearPreview(): void {\n    const { previewSourceInput, sourceSyntaxError } = this.elements;\n\n    if (previewSourceInput) previewSourceInput.value = '';\n    hide(sourceSyntaxError);\n    this.showPreviewState('empty');\n    this.renderPreviewRules(this.currentPreviewMapping?.rules || []);\n  }\n\n  /**\n   * Show toast notification\n   */\n  private showToast(message: string, type: 'success' | 'error'): void {\n    const win = window as unknown as Record<string, unknown>;\n    const toastManager = win.toastManager as\n      | { success: (msg: string) => void; error: (msg: string) => void }\n      | undefined;\n\n    if (toastManager) {\n      if (type === 'success') {\n        toastManager.success(message);\n      } else {\n        toastManager.error(message);\n      }\n    }\n  }\n}\n\n/**\n * Initialize integration mappings page from config\n */\nexport function initIntegrationMappings(config: IntegrationMappingsConfig): IntegrationMappingsController {\n  const controller = new IntegrationMappingsController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap integration mappings page from template context\n */\nexport function bootstrapIntegrationMappings(config: { basePath: string; apiBasePath?: string }): void {\n  const pageConfig: IntegrationMappingsConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n  };\n\n  const controller = new IntegrationMappingsController(pageConfig);\n  onReady(() => controller.init());\n\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignIntegrationMappingsController = controller;\n  }\n}\n","/**\n * E-Sign Integration Conflicts Page Controller\n * Conflict queue management for CRM/HRIS sync operations\n */\n\nimport { qs, show, hide, onReady, announce } from '../utils/dom-helpers.js';\n\n/**\n * Configuration for the integration conflicts page\n */\nexport interface IntegrationConflictsConfig {\n  basePath: string;\n  apiBasePath?: string;\n}\n\n/**\n * Conflict record\n */\ninterface ConflictRecord {\n  id: string;\n  status: 'pending' | 'resolved' | 'ignored';\n  reason?: string;\n  provider: string;\n  entity_kind: string;\n  external_id: string;\n  internal_id?: string;\n  binding_id?: string;\n  run_id?: string;\n  version?: number;\n  payload?: Record<string, unknown>;\n  payload_json?: string;\n  resolution?: Record<string, unknown>;\n  resolution_json?: string;\n  resolved_at?: string;\n  resolved_by_user_id?: string;\n  created_at?: string;\n}\n\ntype PageState = 'loading' | 'empty' | 'error' | 'list';\n\n/**\n * Integration Conflicts page controller\n * Manages conflict queue, detail view, and resolution workflow\n */\nexport class IntegrationConflictsController {\n  private readonly config: IntegrationConflictsConfig;\n  private readonly apiBase: string;\n  private readonly conflictsEndpoint: string;\n\n  private conflicts: ConflictRecord[] = [];\n  private currentConflictId: string | null = null;\n\n  private readonly elements: {\n    announcements: HTMLElement | null;\n    loadingState: HTMLElement | null;\n    emptyState: HTMLElement | null;\n    errorState: HTMLElement | null;\n    conflictsList: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    refreshBtn: HTMLElement | null;\n    retryBtn: HTMLElement | null;\n    filterStatus: HTMLSelectElement | null;\n    filterProvider: HTMLSelectElement | null;\n    filterEntity: HTMLSelectElement | null;\n    statPending: HTMLElement | null;\n    statResolved: HTMLElement | null;\n    statIgnored: HTMLElement | null;\n    conflictDetailModal: HTMLElement | null;\n    closeDetailBtn: HTMLElement | null;\n    detailReason: HTMLElement | null;\n    detailEntityType: HTMLElement | null;\n    detailStatusBadge: HTMLElement | null;\n    detailProvider: HTMLElement | null;\n    detailExternalId: HTMLElement | null;\n    detailInternalId: HTMLElement | null;\n    detailBindingId: HTMLElement | null;\n    detailPayload: HTMLElement | null;\n    resolutionSection: HTMLElement | null;\n    detailResolvedAt: HTMLElement | null;\n    detailResolvedBy: HTMLElement | null;\n    detailResolution: HTMLElement | null;\n    detailConflictId: HTMLElement | null;\n    detailRunId: HTMLElement | null;\n    detailCreatedAt: HTMLElement | null;\n    detailVersion: HTMLElement | null;\n    actionButtons: HTMLElement | null;\n    actionResolveBtn: HTMLElement | null;\n    actionIgnoreBtn: HTMLElement | null;\n    resolveModal: HTMLElement | null;\n    resolveForm: HTMLFormElement | null;\n    cancelResolveBtn: HTMLElement | null;\n    submitResolveBtn: HTMLElement | null;\n    resolutionAction: HTMLSelectElement | null;\n  };\n\n  constructor(config: IntegrationConflictsConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n    this.conflictsEndpoint = `${this.apiBase}/esign/integrations/conflicts`;\n\n    this.elements = {\n      announcements: qs('#conflicts-announcements'),\n      loadingState: qs('#loading-state'),\n      emptyState: qs('#empty-state'),\n      errorState: qs('#error-state'),\n      conflictsList: qs('#conflicts-list'),\n      errorMessage: qs('#error-message'),\n      refreshBtn: qs('#refresh-btn'),\n      retryBtn: qs('#retry-btn'),\n      filterStatus: qs<HTMLSelectElement>('#filter-status'),\n      filterProvider: qs<HTMLSelectElement>('#filter-provider'),\n      filterEntity: qs<HTMLSelectElement>('#filter-entity'),\n      statPending: qs('#stat-pending'),\n      statResolved: qs('#stat-resolved'),\n      statIgnored: qs('#stat-ignored'),\n      conflictDetailModal: qs('#conflict-detail-modal'),\n      closeDetailBtn: qs('#close-detail-btn'),\n      detailReason: qs('#detail-reason'),\n      detailEntityType: qs('#detail-entity-type'),\n      detailStatusBadge: qs('#detail-status-badge'),\n      detailProvider: qs('#detail-provider'),\n      detailExternalId: qs('#detail-external-id'),\n      detailInternalId: qs('#detail-internal-id'),\n      detailBindingId: qs('#detail-binding-id'),\n      detailPayload: qs('#detail-payload'),\n      resolutionSection: qs('#resolution-section'),\n      detailResolvedAt: qs('#detail-resolved-at'),\n      detailResolvedBy: qs('#detail-resolved-by'),\n      detailResolution: qs('#detail-resolution'),\n      detailConflictId: qs('#detail-conflict-id'),\n      detailRunId: qs('#detail-run-id'),\n      detailCreatedAt: qs('#detail-created-at'),\n      detailVersion: qs('#detail-version'),\n      actionButtons: qs('#action-buttons'),\n      actionResolveBtn: qs('#action-resolve-btn'),\n      actionIgnoreBtn: qs('#action-ignore-btn'),\n      resolveModal: qs('#resolve-modal'),\n      resolveForm: qs<HTMLFormElement>('#resolve-form'),\n      cancelResolveBtn: qs('#cancel-resolve-btn'),\n      submitResolveBtn: qs('#submit-resolve-btn'),\n      resolutionAction: qs<HTMLSelectElement>('#resolution-action'),\n    };\n  }\n\n  /**\n   * Initialize the conflicts page\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    await this.loadConflicts();\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const {\n      refreshBtn,\n      retryBtn,\n      closeDetailBtn,\n      filterStatus,\n      filterProvider,\n      filterEntity,\n      actionResolveBtn,\n      actionIgnoreBtn,\n      cancelResolveBtn,\n      resolveForm,\n      conflictDetailModal,\n      resolveModal,\n    } = this.elements;\n\n    // List actions\n    refreshBtn?.addEventListener('click', () => this.loadConflicts());\n    retryBtn?.addEventListener('click', () => this.loadConflicts());\n\n    // Detail modal\n    closeDetailBtn?.addEventListener('click', () => this.closeConflictDetail());\n\n    // Filters\n    filterStatus?.addEventListener('change', () => this.loadConflicts());\n    filterProvider?.addEventListener('change', () => this.renderConflicts());\n    filterEntity?.addEventListener('change', () => this.renderConflicts());\n\n    // Actions\n    actionResolveBtn?.addEventListener('click', () => this.openResolveModal('resolved'));\n    actionIgnoreBtn?.addEventListener('click', () => this.openResolveModal('ignored'));\n    cancelResolveBtn?.addEventListener('click', () => this.closeResolveModal());\n    resolveForm?.addEventListener('submit', (e) => this.submitResolution(e));\n\n    // Modal escape/backdrop\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (resolveModal && !resolveModal.classList.contains('hidden')) {\n          this.closeResolveModal();\n        } else if (conflictDetailModal && !conflictDetailModal.classList.contains('hidden')) {\n          this.closeConflictDetail();\n        }\n      }\n    });\n\n    [conflictDetailModal, resolveModal].forEach((modal) => {\n      modal?.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        if (target === modal || target.getAttribute('aria-hidden') === 'true') {\n          if (modal === conflictDetailModal) this.closeConflictDetail();\n          else if (modal === resolveModal) this.closeResolveModal();\n        }\n      });\n    });\n  }\n\n  /**\n   * Announce message for screen readers\n   */\n  private announce(message: string): void {\n    const { announcements } = this.elements;\n    if (announcements) {\n      announcements.textContent = message;\n    }\n    announce(message);\n  }\n\n  /**\n   * Show a specific page state\n   */\n  private showState(state: PageState): void {\n    const { loadingState, emptyState, errorState, conflictsList } = this.elements;\n\n    hide(loadingState);\n    hide(emptyState);\n    hide(errorState);\n    hide(conflictsList);\n\n    switch (state) {\n      case 'loading':\n        show(loadingState);\n        break;\n      case 'empty':\n        show(emptyState);\n        break;\n      case 'error':\n        show(errorState);\n        break;\n      case 'list':\n        show(conflictsList);\n        break;\n    }\n  }\n\n  /**\n   * Escape HTML for safe rendering\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text || '';\n    return div.innerHTML;\n  }\n\n  /**\n   * Format date string\n   */\n  private formatDate(dateStr?: string): string {\n    if (!dateStr) return '-';\n    try {\n      const date = new Date(dateStr);\n      return (\n        date.toLocaleDateString() +\n        ' ' +\n        date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n      );\n    } catch {\n      return dateStr;\n    }\n  }\n\n  /**\n   * Get status badge HTML\n   */\n  private getStatusBadge(status: string): string {\n    const configs: Record<string, { label: string; bg: string; text: string; dot: string }> = {\n      pending: { label: 'Pending', bg: 'bg-amber-100', text: 'text-amber-700', dot: 'bg-amber-500' },\n      resolved: { label: 'Resolved', bg: 'bg-green-100', text: 'text-green-700', dot: 'bg-green-500' },\n      ignored: { label: 'Ignored', bg: 'bg-gray-100', text: 'text-gray-700', dot: 'bg-gray-400' },\n    };\n    const config = configs[status] || configs.pending;\n    return `<span class=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${config.bg} ${config.text}\">\n      <span class=\"w-1.5 h-1.5 rounded-full ${config.dot}\" aria-hidden=\"true\"></span>\n      ${config.label}\n    </span>`;\n  }\n\n  /**\n   * Get entity badge HTML\n   */\n  private getEntityBadge(entityKind: string): string {\n    const configs: Record<string, { label: string; bg: string; text: string }> = {\n      participant: { label: 'Participant', bg: 'bg-blue-100', text: 'text-blue-700' },\n      agreement: { label: 'Agreement', bg: 'bg-purple-100', text: 'text-purple-700' },\n      field_definition: { label: 'Field Definition', bg: 'bg-teal-100', text: 'text-teal-700' },\n    };\n    const config = configs[entityKind] || { label: entityKind, bg: 'bg-gray-100', text: 'text-gray-700' };\n    return `<span class=\"px-2 py-0.5 rounded text-xs font-medium ${config.bg} ${config.text}\">${config.label}</span>`;\n  }\n\n  /**\n   * Load conflicts from API\n   */\n  async loadConflicts(): Promise<void> {\n    this.showState('loading');\n\n    try {\n      const { filterStatus } = this.elements;\n      const params = new URLSearchParams();\n      if (filterStatus?.value) {\n        params.set('status', filterStatus.value);\n      }\n\n      const response = await fetch(`${this.conflictsEndpoint}${params.toString() ? '?' + params : ''}`, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n\n      const data = await response.json();\n      this.conflicts = data.conflicts || [];\n\n      // Populate provider filter\n      this.populateProviderFilter();\n\n      this.updateStats();\n      this.renderConflicts();\n      this.announce(`Loaded ${this.conflicts.length} conflicts`);\n    } catch (error) {\n      console.error('Error loading conflicts:', error);\n      const { errorMessage } = this.elements;\n      if (errorMessage) {\n        errorMessage.textContent = error instanceof Error ? error.message : 'An error occurred';\n      }\n      this.showState('error');\n    }\n  }\n\n  /**\n   * Populate provider filter dropdown\n   */\n  private populateProviderFilter(): void {\n    const { filterProvider } = this.elements;\n    if (!filterProvider) return;\n\n    const currentProvider = filterProvider.value;\n    const providers = [...new Set(this.conflicts.map((c) => c.provider).filter(Boolean))];\n\n    filterProvider.innerHTML =\n      '<option value=\"\">All Providers</option>' +\n      providers\n        .map(\n          (p) =>\n            `<option value=\"${this.escapeHtml(p)}\" ${p === currentProvider ? 'selected' : ''}>${this.escapeHtml(p)}</option>`\n        )\n        .join('');\n  }\n\n  /**\n   * Update stats display\n   */\n  private updateStats(): void {\n    const { statPending, statResolved, statIgnored } = this.elements;\n\n    const pending = this.conflicts.filter((c) => c.status === 'pending').length;\n    const resolved = this.conflicts.filter((c) => c.status === 'resolved').length;\n    const ignored = this.conflicts.filter((c) => c.status === 'ignored').length;\n\n    if (statPending) statPending.textContent = String(pending);\n    if (statResolved) statResolved.textContent = String(resolved);\n    if (statIgnored) statIgnored.textContent = String(ignored);\n  }\n\n  /**\n   * Render conflicts list with filters applied\n   */\n  private renderConflicts(): void {\n    const { conflictsList, filterStatus, filterProvider, filterEntity } = this.elements;\n    if (!conflictsList) return;\n\n    const statusFilter = filterStatus?.value || '';\n    const providerFilter = filterProvider?.value || '';\n    const entityFilter = filterEntity?.value || '';\n\n    const filtered = this.conflicts.filter((c) => {\n      if (statusFilter && c.status !== statusFilter) return false;\n      if (providerFilter && c.provider !== providerFilter) return false;\n      if (entityFilter && c.entity_kind !== entityFilter) return false;\n      return true;\n    });\n\n    if (filtered.length === 0) {\n      this.showState('empty');\n      return;\n    }\n\n    conflictsList.innerHTML = filtered\n      .map(\n        (conflict) => `\n      <div class=\"bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-shadow cursor-pointer conflict-card\" data-id=\"${this.escapeHtml(conflict.id)}\">\n        <div class=\"p-4\">\n          <div class=\"flex items-start justify-between\">\n            <div class=\"flex items-center gap-3\">\n              <div class=\"w-10 h-10 rounded-lg ${conflict.status === 'pending' ? 'bg-amber-100' : conflict.status === 'resolved' ? 'bg-green-100' : 'bg-gray-100'} flex items-center justify-center\">\n                <svg class=\"w-5 h-5 ${conflict.status === 'pending' ? 'text-amber-600' : conflict.status === 'resolved' ? 'text-green-600' : 'text-gray-500'}\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n                </svg>\n              </div>\n              <div>\n                <div class=\"flex items-center gap-2 mb-1\">\n                  <span class=\"font-medium text-gray-900\">${this.escapeHtml(conflict.reason || 'Data conflict')}</span>\n                  ${this.getEntityBadge(conflict.entity_kind)}\n                </div>\n                <div class=\"flex items-center gap-2 text-xs text-gray-500\">\n                  <span>${this.escapeHtml(conflict.provider)}</span>\n                  <span></span>\n                  <span class=\"font-mono\">${this.escapeHtml((conflict.external_id || '').slice(0, 12))}...</span>\n                </div>\n              </div>\n            </div>\n            <div class=\"text-right\">\n              ${this.getStatusBadge(conflict.status)}\n              <p class=\"text-xs text-gray-500 mt-1\">${this.formatDate(conflict.created_at)}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    `\n      )\n      .join('');\n\n    this.showState('list');\n\n    // Attach click listeners\n    conflictsList.querySelectorAll<HTMLElement>('.conflict-card').forEach((card) => {\n      card.addEventListener('click', () => this.openConflictDetail(card.dataset.id || ''));\n    });\n  }\n\n  /**\n   * Open conflict detail modal\n   */\n  private openConflictDetail(conflictId: string): void {\n    this.currentConflictId = conflictId;\n    const conflict = this.conflicts.find((c) => c.id === conflictId);\n    if (!conflict) return;\n\n    const {\n      conflictDetailModal,\n      detailReason,\n      detailEntityType,\n      detailStatusBadge,\n      detailProvider,\n      detailExternalId,\n      detailInternalId,\n      detailBindingId,\n      detailConflictId,\n      detailRunId,\n      detailCreatedAt,\n      detailVersion,\n      detailPayload,\n      resolutionSection,\n      actionButtons,\n      detailResolvedAt,\n      detailResolvedBy,\n      detailResolution,\n    } = this.elements;\n\n    // Populate detail view\n    if (detailReason) detailReason.textContent = conflict.reason || 'Data conflict';\n    if (detailEntityType) detailEntityType.textContent = conflict.entity_kind || '-';\n    if (detailStatusBadge) detailStatusBadge.innerHTML = this.getStatusBadge(conflict.status);\n    if (detailProvider) detailProvider.textContent = conflict.provider || '-';\n    if (detailExternalId) detailExternalId.textContent = conflict.external_id || '-';\n    if (detailInternalId) detailInternalId.textContent = conflict.internal_id || '-';\n    if (detailBindingId) detailBindingId.textContent = conflict.binding_id || '-';\n    if (detailConflictId) detailConflictId.textContent = conflict.id;\n    if (detailRunId) detailRunId.textContent = conflict.run_id || '-';\n    if (detailCreatedAt) detailCreatedAt.textContent = this.formatDate(conflict.created_at);\n    if (detailVersion) detailVersion.textContent = String(conflict.version || 1);\n\n    // Payload\n    if (detailPayload) {\n      try {\n        const payload = conflict.payload_json\n          ? JSON.parse(conflict.payload_json)\n          : conflict.payload || {};\n        detailPayload.textContent = JSON.stringify(payload, null, 2);\n      } catch {\n        detailPayload.textContent = conflict.payload_json || '{}';\n      }\n    }\n\n    // Resolution section\n    if (conflict.status === 'resolved' || conflict.status === 'ignored') {\n      show(resolutionSection);\n      hide(actionButtons);\n\n      if (detailResolvedAt) {\n        detailResolvedAt.textContent = conflict.resolved_at ? this.formatDate(conflict.resolved_at) : '';\n      }\n      if (detailResolvedBy) {\n        detailResolvedBy.textContent = conflict.resolved_by_user_id\n          ? `By user ${conflict.resolved_by_user_id}`\n          : '-';\n      }\n      if (detailResolution) {\n        try {\n          const resolution = conflict.resolution_json\n            ? JSON.parse(conflict.resolution_json)\n            : conflict.resolution || {};\n          detailResolution.textContent = JSON.stringify(resolution, null, 2);\n        } catch {\n          detailResolution.textContent = conflict.resolution_json || '{}';\n        }\n      }\n    } else {\n      hide(resolutionSection);\n      show(actionButtons);\n    }\n\n    show(conflictDetailModal);\n  }\n\n  /**\n   * Close conflict detail modal\n   */\n  private closeConflictDetail(): void {\n    hide(this.elements.conflictDetailModal);\n    this.currentConflictId = null;\n  }\n\n  /**\n   * Open resolve modal\n   */\n  private openResolveModal(presetStatus: 'resolved' | 'ignored' = 'resolved'): void {\n    const { resolveModal, resolveForm, resolutionAction } = this.elements;\n\n    resolveForm?.reset();\n    if (resolutionAction) resolutionAction.value = presetStatus;\n\n    show(resolveModal);\n  }\n\n  /**\n   * Close resolve modal\n   */\n  private closeResolveModal(): void {\n    hide(this.elements.resolveModal);\n  }\n\n  /**\n   * Submit resolution\n   */\n  private async submitResolution(e: Event): Promise<void> {\n    e.preventDefault();\n\n    if (!this.currentConflictId) return;\n\n    const { resolveForm, submitResolveBtn } = this.elements;\n    if (!resolveForm || !submitResolveBtn) return;\n\n    const formData = new FormData(resolveForm);\n    let resolution: Record<string, unknown> = {};\n\n    const resolutionData = formData.get('resolution') as string;\n    if (resolutionData) {\n      try {\n        resolution = JSON.parse(resolutionData);\n      } catch {\n        resolution = { raw: resolutionData };\n      }\n    }\n\n    const notes = formData.get('notes') as string;\n    if (notes) {\n      resolution.notes = notes;\n    }\n\n    const payload = {\n      status: formData.get('status'),\n      resolution,\n    };\n\n    submitResolveBtn.setAttribute('disabled', 'true');\n    submitResolveBtn.innerHTML = `<svg class=\"animate-spin w-4 h-4 mr-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"></path></svg> Submitting...`;\n\n    try {\n      const response = await fetch(`${this.conflictsEndpoint}/${this.currentConflictId}/resolve`, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n          'Idempotency-Key': `resolve-${this.currentConflictId}-${Date.now()}`,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        const result = await response.json();\n        throw new Error(result.error?.message || `HTTP ${response.status}`);\n      }\n\n      this.showToast('Conflict resolved', 'success');\n      this.announce('Conflict resolved');\n      this.closeResolveModal();\n      this.closeConflictDetail();\n      await this.loadConflicts();\n    } catch (error) {\n      console.error('Resolution error:', error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed: ${message}`, 'error');\n    } finally {\n      submitResolveBtn.removeAttribute('disabled');\n      submitResolveBtn.innerHTML = `<svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg> Submit Resolution`;\n    }\n  }\n\n  /**\n   * Show toast notification\n   */\n  private showToast(message: string, type: 'success' | 'error'): void {\n    const win = window as unknown as Record<string, unknown>;\n    const toastManager = win.toastManager as\n      | { success: (msg: string) => void; error: (msg: string) => void }\n      | undefined;\n\n    if (toastManager) {\n      if (type === 'success') {\n        toastManager.success(message);\n      } else {\n        toastManager.error(message);\n      }\n    }\n  }\n}\n\n/**\n * Initialize integration conflicts page from config\n */\nexport function initIntegrationConflicts(\n  config: IntegrationConflictsConfig\n): IntegrationConflictsController {\n  const controller = new IntegrationConflictsController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap integration conflicts page from template context\n */\nexport function bootstrapIntegrationConflicts(config: {\n  basePath: string;\n  apiBasePath?: string;\n}): void {\n  const pageConfig: IntegrationConflictsConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n  };\n\n  const controller = new IntegrationConflictsController(pageConfig);\n  onReady(() => controller.init());\n\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignIntegrationConflictsController = controller;\n  }\n}\n","/**\n * E-Sign Integration Sync Runs Page Controller\n * Timeline view for CRM/HRIS sync operations\n */\n\nimport { qs, show, hide, onReady, announce } from '../utils/dom-helpers.js';\n\n/**\n * Configuration for the integration sync runs page\n */\nexport interface IntegrationSyncRunsConfig {\n  basePath: string;\n  apiBasePath?: string;\n}\n\n/**\n * Sync run record\n */\ninterface SyncRun {\n  id: string;\n  provider: string;\n  direction: 'inbound' | 'outbound';\n  status: 'pending' | 'running' | 'completed' | 'failed';\n  mapping_spec_id?: string;\n  cursor?: string;\n  started_at?: string;\n  completed_at?: string;\n  last_error?: string;\n  attempt_count?: number;\n}\n\n/**\n * Mapping spec (for start sync modal)\n */\ninterface MappingSpec {\n  id: string;\n  name: string;\n  provider: string;\n  status: 'draft' | 'published';\n}\n\n/**\n * Checkpoint record\n */\ninterface Checkpoint {\n  checkpoint_key: string;\n  cursor: string;\n  created_at?: string;\n}\n\ntype PageState = 'loading' | 'empty' | 'error' | 'list';\n\n/**\n * Integration Sync Runs page controller\n * Manages sync operations timeline, start sync, and run detail\n */\nexport class IntegrationSyncRunsController {\n  private readonly config: IntegrationSyncRunsConfig;\n  private readonly apiBase: string;\n  private readonly syncRunsEndpoint: string;\n  private readonly mappingsEndpoint: string;\n\n  private syncRuns: SyncRun[] = [];\n  private mappings: MappingSpec[] = [];\n  private currentRunId: string | null = null;\n\n  private readonly elements: {\n    announcements: HTMLElement | null;\n    loadingState: HTMLElement | null;\n    emptyState: HTMLElement | null;\n    errorState: HTMLElement | null;\n    runsTimeline: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    refreshBtn: HTMLElement | null;\n    retryBtn: HTMLElement | null;\n    filterProvider: HTMLSelectElement | null;\n    filterStatus: HTMLSelectElement | null;\n    filterDirection: HTMLSelectElement | null;\n    statTotal: HTMLElement | null;\n    statRunning: HTMLElement | null;\n    statCompleted: HTMLElement | null;\n    statFailed: HTMLElement | null;\n    startSyncBtn: HTMLElement | null;\n    startSyncEmptyBtn: HTMLElement | null;\n    startSyncModal: HTMLElement | null;\n    startSyncForm: HTMLFormElement | null;\n    cancelSyncBtn: HTMLElement | null;\n    submitSyncBtn: HTMLElement | null;\n    syncMappingSelect: HTMLSelectElement | null;\n    runDetailModal: HTMLElement | null;\n    closeDetailBtn: HTMLElement | null;\n    detailRunId: HTMLElement | null;\n    detailProvider: HTMLElement | null;\n    detailDirection: HTMLElement | null;\n    detailStatus: HTMLElement | null;\n    detailStarted: HTMLElement | null;\n    detailCompleted: HTMLElement | null;\n    detailCursor: HTMLElement | null;\n    detailAttempt: HTMLElement | null;\n    detailErrorSection: HTMLElement | null;\n    detailLastError: HTMLElement | null;\n    detailCheckpoints: HTMLElement | null;\n    actionResumeBtn: HTMLElement | null;\n    actionRetryBtn: HTMLElement | null;\n    actionCompleteBtn: HTMLElement | null;\n    actionFailBtn: HTMLElement | null;\n    actionDiagnosticsBtn: HTMLElement | null;\n  };\n\n  constructor(config: IntegrationSyncRunsConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api`;\n    this.syncRunsEndpoint = `${this.apiBase}/esign/integrations/sync-runs`;\n    this.mappingsEndpoint = `${this.apiBase}/esign/integrations/mappings`;\n\n    this.elements = {\n      announcements: qs('#sync-announcements'),\n      loadingState: qs('#loading-state'),\n      emptyState: qs('#empty-state'),\n      errorState: qs('#error-state'),\n      runsTimeline: qs('#runs-timeline'),\n      errorMessage: qs('#error-message'),\n      refreshBtn: qs('#refresh-btn'),\n      retryBtn: qs('#retry-btn'),\n      filterProvider: qs<HTMLSelectElement>('#filter-provider'),\n      filterStatus: qs<HTMLSelectElement>('#filter-status'),\n      filterDirection: qs<HTMLSelectElement>('#filter-direction'),\n      statTotal: qs('#stat-total'),\n      statRunning: qs('#stat-running'),\n      statCompleted: qs('#stat-completed'),\n      statFailed: qs('#stat-failed'),\n      startSyncBtn: qs('#start-sync-btn'),\n      startSyncEmptyBtn: qs('#start-sync-empty-btn'),\n      startSyncModal: qs('#start-sync-modal'),\n      startSyncForm: qs<HTMLFormElement>('#start-sync-form'),\n      cancelSyncBtn: qs('#cancel-sync-btn'),\n      submitSyncBtn: qs('#submit-sync-btn'),\n      syncMappingSelect: qs<HTMLSelectElement>('#sync-mapping'),\n      runDetailModal: qs('#run-detail-modal'),\n      closeDetailBtn: qs('#close-detail-btn'),\n      detailRunId: qs('#detail-run-id'),\n      detailProvider: qs('#detail-provider'),\n      detailDirection: qs('#detail-direction'),\n      detailStatus: qs('#detail-status'),\n      detailStarted: qs('#detail-started'),\n      detailCompleted: qs('#detail-completed'),\n      detailCursor: qs('#detail-cursor'),\n      detailAttempt: qs('#detail-attempt'),\n      detailErrorSection: qs('#detail-error-section'),\n      detailLastError: qs('#detail-last-error'),\n      detailCheckpoints: qs('#detail-checkpoints'),\n      actionResumeBtn: qs('#action-resume-btn'),\n      actionRetryBtn: qs('#action-retry-btn'),\n      actionCompleteBtn: qs('#action-complete-btn'),\n      actionFailBtn: qs('#action-fail-btn'),\n      actionDiagnosticsBtn: qs('#action-diagnostics-btn'),\n    };\n  }\n\n  /**\n   * Initialize the sync runs page\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    await Promise.all([this.loadMappings(), this.loadSyncRuns()]);\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const {\n      startSyncBtn,\n      startSyncEmptyBtn,\n      cancelSyncBtn,\n      startSyncForm,\n      refreshBtn,\n      retryBtn,\n      closeDetailBtn,\n      filterProvider,\n      filterStatus,\n      filterDirection,\n      actionResumeBtn,\n      actionRetryBtn,\n      actionCompleteBtn,\n      actionFailBtn,\n      actionDiagnosticsBtn,\n      startSyncModal,\n      runDetailModal,\n    } = this.elements;\n\n    // Start sync modal\n    startSyncBtn?.addEventListener('click', () => this.openStartSyncModal());\n    startSyncEmptyBtn?.addEventListener('click', () => this.openStartSyncModal());\n    cancelSyncBtn?.addEventListener('click', () => this.closeStartSyncModal());\n    startSyncForm?.addEventListener('submit', (e) => this.startSync(e));\n\n    // List actions\n    refreshBtn?.addEventListener('click', () => this.loadSyncRuns());\n    retryBtn?.addEventListener('click', () => this.loadSyncRuns());\n    closeDetailBtn?.addEventListener('click', () => this.closeRunDetail());\n\n    // Filters\n    filterProvider?.addEventListener('change', () => this.renderTimeline());\n    filterStatus?.addEventListener('change', () => this.renderTimeline());\n    filterDirection?.addEventListener('change', () => this.renderTimeline());\n\n    // Run actions\n    actionResumeBtn?.addEventListener('click', () => this.runAction('resume'));\n    actionRetryBtn?.addEventListener('click', () => this.runAction('resume'));\n    actionCompleteBtn?.addEventListener('click', () => this.runAction('complete'));\n    actionFailBtn?.addEventListener('click', () => this.runAction('fail'));\n    actionDiagnosticsBtn?.addEventListener('click', () => this.openDiagnostics());\n\n    // Modal escape/backdrop\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        if (startSyncModal && !startSyncModal.classList.contains('hidden')) {\n          this.closeStartSyncModal();\n        }\n        if (runDetailModal && !runDetailModal.classList.contains('hidden')) {\n          this.closeRunDetail();\n        }\n      }\n    });\n\n    [startSyncModal, runDetailModal].forEach((modal) => {\n      modal?.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        if (target === modal || target.getAttribute('aria-hidden') === 'true') {\n          if (modal === startSyncModal) this.closeStartSyncModal();\n          else if (modal === runDetailModal) this.closeRunDetail();\n        }\n      });\n    });\n  }\n\n  /**\n   * Announce message for screen readers\n   */\n  private announce(message: string): void {\n    const { announcements } = this.elements;\n    if (announcements) {\n      announcements.textContent = message;\n    }\n    announce(message);\n  }\n\n  /**\n   * Show a specific page state\n   */\n  private showState(state: PageState): void {\n    const { loadingState, emptyState, errorState, runsTimeline } = this.elements;\n\n    hide(loadingState);\n    hide(emptyState);\n    hide(errorState);\n    hide(runsTimeline);\n\n    switch (state) {\n      case 'loading':\n        show(loadingState);\n        break;\n      case 'empty':\n        show(emptyState);\n        break;\n      case 'error':\n        show(errorState);\n        break;\n      case 'list':\n        show(runsTimeline);\n        break;\n    }\n  }\n\n  /**\n   * Escape HTML for safe rendering\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text || '';\n    return div.innerHTML;\n  }\n\n  /**\n   * Format date string\n   */\n  private formatDate(dateStr?: string): string {\n    if (!dateStr) return '-';\n    try {\n      const date = new Date(dateStr);\n      return (\n        date.toLocaleDateString() +\n        ' ' +\n        date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n      );\n    } catch {\n      return dateStr;\n    }\n  }\n\n  /**\n   * Get status badge HTML\n   */\n  private getStatusBadge(status: string): string {\n    const configs: Record<\n      string,\n      { label: string; bg: string; text: string; dot: string; animate?: boolean }\n    > = {\n      pending: { label: 'Pending', bg: 'bg-gray-100', text: 'text-gray-700', dot: 'bg-gray-400' },\n      running: {\n        label: 'Running',\n        bg: 'bg-blue-100',\n        text: 'text-blue-700',\n        dot: 'bg-blue-500',\n        animate: true,\n      },\n      completed: { label: 'Completed', bg: 'bg-green-100', text: 'text-green-700', dot: 'bg-green-500' },\n      failed: { label: 'Failed', bg: 'bg-red-100', text: 'text-red-700', dot: 'bg-red-500' },\n    };\n    const config = configs[status] || configs.pending;\n    return `<span class=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${config.bg} ${config.text}\">\n      <span class=\"w-1.5 h-1.5 rounded-full ${config.dot} ${config.animate ? 'animate-pulse' : ''}\" aria-hidden=\"true\"></span>\n      ${config.label}\n    </span>`;\n  }\n\n  /**\n   * Get direction badge HTML\n   */\n  private getDirectionBadge(direction: string): string {\n    if (direction === 'inbound') {\n      return '<span class=\"px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs font-medium\"> Inbound</span>';\n    }\n    return '<span class=\"px-2 py-0.5 bg-teal-100 text-teal-700 rounded text-xs font-medium\"> Outbound</span>';\n  }\n\n  /**\n   * Load mappings from API\n   */\n  async loadMappings(): Promise<void> {\n    try {\n      const response = await fetch(this.mappingsEndpoint, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        this.mappings = (data.mappings || []).filter((m: MappingSpec) => m.status === 'published');\n        this.populateMappingSelect();\n      }\n    } catch (error) {\n      console.error('Error loading mappings:', error);\n    }\n  }\n\n  /**\n   * Populate mapping select dropdown\n   */\n  private populateMappingSelect(): void {\n    const { syncMappingSelect } = this.elements;\n    if (!syncMappingSelect) return;\n\n    syncMappingSelect.innerHTML =\n      '<option value=\"\">Select mapping...</option>' +\n      this.mappings\n        .map(\n          (m) =>\n            `<option value=\"${this.escapeHtml(m.id)}\">${this.escapeHtml(m.name)} (${this.escapeHtml(m.provider)})</option>`\n        )\n        .join('');\n  }\n\n  /**\n   * Load sync runs from API\n   */\n  async loadSyncRuns(): Promise<void> {\n    this.showState('loading');\n\n    try {\n      const { filterProvider } = this.elements;\n      const params = new URLSearchParams();\n      if (filterProvider?.value) {\n        params.set('provider', filterProvider.value);\n      }\n\n      const response = await fetch(\n        `${this.syncRunsEndpoint}${params.toString() ? '?' + params : ''}`,\n        {\n          credentials: 'same-origin',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n\n      const data = await response.json();\n      this.syncRuns = data.runs || [];\n\n      // Populate provider filter\n      this.populateProviderFilter();\n\n      this.updateStats();\n      this.renderTimeline();\n      this.announce(`Loaded ${this.syncRuns.length} sync runs`);\n    } catch (error) {\n      console.error('Error loading sync runs:', error);\n      const { errorMessage } = this.elements;\n      if (errorMessage) {\n        errorMessage.textContent = error instanceof Error ? error.message : 'An error occurred';\n      }\n      this.showState('error');\n    }\n  }\n\n  /**\n   * Populate provider filter dropdown\n   */\n  private populateProviderFilter(): void {\n    const { filterProvider } = this.elements;\n    if (!filterProvider) return;\n\n    const currentProvider = filterProvider.value;\n    const providers = [...new Set(this.syncRuns.map((r) => r.provider).filter(Boolean))];\n\n    filterProvider.innerHTML =\n      '<option value=\"\">All Providers</option>' +\n      providers\n        .map(\n          (p) =>\n            `<option value=\"${this.escapeHtml(p)}\" ${p === currentProvider ? 'selected' : ''}>${this.escapeHtml(p)}</option>`\n        )\n        .join('');\n  }\n\n  /**\n   * Update stats display\n   */\n  private updateStats(): void {\n    const { statTotal, statRunning, statCompleted, statFailed } = this.elements;\n\n    const total = this.syncRuns.length;\n    const running = this.syncRuns.filter(\n      (r) => r.status === 'running' || r.status === 'pending'\n    ).length;\n    const completed = this.syncRuns.filter((r) => r.status === 'completed').length;\n    const failed = this.syncRuns.filter((r) => r.status === 'failed').length;\n\n    if (statTotal) statTotal.textContent = String(total);\n    if (statRunning) statRunning.textContent = String(running);\n    if (statCompleted) statCompleted.textContent = String(completed);\n    if (statFailed) statFailed.textContent = String(failed);\n  }\n\n  /**\n   * Render sync runs timeline with filters applied\n   */\n  private renderTimeline(): void {\n    const { runsTimeline, filterStatus, filterDirection } = this.elements;\n    if (!runsTimeline) return;\n\n    const statusFilter = filterStatus?.value || '';\n    const directionFilter = filterDirection?.value || '';\n\n    const filtered = this.syncRuns.filter((r) => {\n      if (statusFilter && r.status !== statusFilter) return false;\n      if (directionFilter && r.direction !== directionFilter) return false;\n      return true;\n    });\n\n    if (filtered.length === 0) {\n      this.showState('empty');\n      return;\n    }\n\n    runsTimeline.innerHTML = filtered\n      .map(\n        (run) => `\n      <div class=\"bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-shadow cursor-pointer sync-run-card\" data-id=\"${this.escapeHtml(run.id)}\">\n        <div class=\"p-4\">\n          <div class=\"flex items-start justify-between\">\n            <div class=\"flex items-center gap-3\">\n              <div class=\"w-10 h-10 rounded-lg ${run.status === 'running' ? 'bg-blue-100' : run.status === 'completed' ? 'bg-green-100' : run.status === 'failed' ? 'bg-red-100' : 'bg-gray-100'} flex items-center justify-center\">\n                <svg class=\"w-5 h-5 ${run.status === 'running' ? 'text-blue-600 animate-spin' : run.status === 'completed' ? 'text-green-600' : run.status === 'failed' ? 'text-red-600' : 'text-gray-400'}\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\n                </svg>\n              </div>\n              <div>\n                <div class=\"flex items-center gap-2\">\n                  <span class=\"font-medium text-gray-900\">${this.escapeHtml(run.provider)}</span>\n                  ${this.getDirectionBadge(run.direction)}\n                </div>\n                <p class=\"text-xs text-gray-500 font-mono\">${this.escapeHtml(run.id.slice(0, 8))}...</p>\n              </div>\n            </div>\n            <div class=\"text-right\">\n              ${this.getStatusBadge(run.status)}\n              <p class=\"text-xs text-gray-500 mt-1\">${this.formatDate(run.started_at)}</p>\n            </div>\n          </div>\n\n          ${\n            run.cursor\n              ? `\n            <div class=\"mt-3 pt-3 border-t border-gray-100\">\n              <p class=\"text-xs text-gray-500\">Cursor: <span class=\"font-mono text-gray-700\">${this.escapeHtml(run.cursor)}</span></p>\n            </div>\n          `\n              : ''\n          }\n\n          ${\n            run.last_error\n              ? `\n            <div class=\"mt-3 pt-3 border-t border-gray-100\">\n              <p class=\"text-xs text-red-600 truncate\">Error: ${this.escapeHtml(run.last_error)}</p>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      </div>\n    `\n      )\n      .join('');\n\n    this.showState('list');\n\n    // Attach click listeners\n    runsTimeline.querySelectorAll<HTMLElement>('.sync-run-card').forEach((card) => {\n      card.addEventListener('click', () => this.openRunDetail(card.dataset.id || ''));\n    });\n  }\n\n  /**\n   * Open start sync modal\n   */\n  private openStartSyncModal(): void {\n    const { startSyncModal, startSyncForm } = this.elements;\n\n    startSyncForm?.reset();\n    show(startSyncModal);\n\n    const syncProviderInput = document.getElementById('sync-provider') as HTMLInputElement | null;\n    syncProviderInput?.focus();\n  }\n\n  /**\n   * Close start sync modal\n   */\n  private closeStartSyncModal(): void {\n    hide(this.elements.startSyncModal);\n  }\n\n  /**\n   * Start a new sync run\n   */\n  private async startSync(e: Event): Promise<void> {\n    e.preventDefault();\n\n    const { startSyncForm, submitSyncBtn } = this.elements;\n    if (!startSyncForm || !submitSyncBtn) return;\n\n    const formData = new FormData(startSyncForm);\n    const payload = {\n      provider: formData.get('provider'),\n      direction: formData.get('direction'),\n      mapping_spec_id: formData.get('mapping_spec_id'),\n      cursor: formData.get('cursor') || undefined,\n    };\n\n    submitSyncBtn.setAttribute('disabled', 'true');\n    submitSyncBtn.innerHTML = `<svg class=\"animate-spin w-4 h-4 mr-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"></path></svg> Starting...`;\n\n    try {\n      const response = await fetch(this.syncRunsEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n          'Idempotency-Key': `sync-${Date.now()}`,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        const result = await response.json();\n        throw new Error(result.error?.message || `HTTP ${response.status}`);\n      }\n\n      this.showToast('Sync run started', 'success');\n      this.announce('Sync run started');\n      this.closeStartSyncModal();\n      await this.loadSyncRuns();\n    } catch (error) {\n      console.error('Start sync error:', error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed to start: ${message}`, 'error');\n    } finally {\n      submitSyncBtn.removeAttribute('disabled');\n      submitSyncBtn.innerHTML = `<svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z\"/></svg> Start Sync`;\n    }\n  }\n\n  /**\n   * Open run detail modal\n   */\n  private async openRunDetail(runId: string): Promise<void> {\n    this.currentRunId = runId;\n    const run = this.syncRuns.find((r) => r.id === runId);\n    if (!run) return;\n\n    const {\n      runDetailModal,\n      detailRunId,\n      detailProvider,\n      detailDirection,\n      detailStatus,\n      detailStarted,\n      detailCompleted,\n      detailCursor,\n      detailAttempt,\n      detailErrorSection,\n      detailLastError,\n      detailCheckpoints,\n      actionResumeBtn,\n      actionRetryBtn,\n      actionCompleteBtn,\n      actionFailBtn,\n    } = this.elements;\n\n    // Populate basic info\n    if (detailRunId) detailRunId.textContent = run.id;\n    if (detailProvider) detailProvider.textContent = run.provider;\n    if (detailDirection) {\n      detailDirection.textContent =\n        run.direction === 'inbound' ? 'Inbound (Import)' : 'Outbound (Export)';\n    }\n    if (detailStatus) detailStatus.innerHTML = this.getStatusBadge(run.status);\n    if (detailStarted) detailStarted.textContent = this.formatDate(run.started_at);\n    if (detailCompleted) {\n      detailCompleted.textContent = run.completed_at ? this.formatDate(run.completed_at) : '-';\n    }\n    if (detailCursor) detailCursor.textContent = run.cursor || '-';\n    if (detailAttempt) detailAttempt.textContent = String(run.attempt_count || 1);\n\n    // Error section\n    if (run.last_error) {\n      if (detailLastError) detailLastError.textContent = run.last_error;\n      show(detailErrorSection);\n    } else {\n      hide(detailErrorSection);\n    }\n\n    // Show/hide action buttons based on status\n    if (actionResumeBtn) {\n      actionResumeBtn.classList.toggle('hidden', run.status !== 'running');\n    }\n    if (actionRetryBtn) {\n      actionRetryBtn.classList.toggle('hidden', run.status !== 'failed');\n    }\n    if (actionCompleteBtn) {\n      actionCompleteBtn.classList.toggle('hidden', run.status !== 'running');\n    }\n    if (actionFailBtn) {\n      actionFailBtn.classList.toggle('hidden', run.status !== 'running');\n    }\n\n    // Load checkpoints\n    if (detailCheckpoints) {\n      detailCheckpoints.innerHTML = '<p class=\"text-sm text-gray-500\">Loading checkpoints...</p>';\n    }\n\n    show(runDetailModal);\n\n    // Fetch checkpoints\n    try {\n      const response = await fetch(`${this.syncRunsEndpoint}/${runId}/checkpoints`, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        this.renderCheckpoints(data.checkpoints || []);\n      } else {\n        if (detailCheckpoints) {\n          detailCheckpoints.innerHTML =\n            '<p class=\"text-sm text-gray-500\">No checkpoints available</p>';\n        }\n      }\n    } catch (error) {\n      console.error('Error loading checkpoints:', error);\n      if (detailCheckpoints) {\n        detailCheckpoints.innerHTML =\n          '<p class=\"text-sm text-red-600\">Failed to load checkpoints</p>';\n      }\n    }\n  }\n\n  /**\n   * Render checkpoints\n   */\n  private renderCheckpoints(checkpoints: Checkpoint[]): void {\n    const { detailCheckpoints } = this.elements;\n    if (!detailCheckpoints) return;\n\n    if (checkpoints.length === 0) {\n      detailCheckpoints.innerHTML = '<p class=\"text-sm text-gray-500\">No checkpoints recorded</p>';\n      return;\n    }\n\n    detailCheckpoints.innerHTML = checkpoints\n      .map(\n        (cp, index) => `\n      <div class=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n        <div class=\"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-xs font-medium text-blue-700 flex-shrink-0\">\n          ${index + 1}\n        </div>\n        <div class=\"flex-1 min-w-0\">\n          <div class=\"flex items-center gap-2 mb-1\">\n            <span class=\"text-sm font-medium text-gray-900\">${this.escapeHtml(cp.checkpoint_key)}</span>\n            <span class=\"text-xs text-gray-500\">${this.formatDate(cp.created_at)}</span>\n          </div>\n          <p class=\"text-xs text-gray-600 font-mono truncate\">Cursor: ${this.escapeHtml(cp.cursor)}</p>\n        </div>\n      </div>\n    `\n      )\n      .join('');\n  }\n\n  /**\n   * Close run detail modal\n   */\n  private closeRunDetail(): void {\n    hide(this.elements.runDetailModal);\n    this.currentRunId = null;\n  }\n\n  /**\n   * Run an action on the current sync run\n   */\n  private async runAction(action: 'resume' | 'complete' | 'fail'): Promise<void> {\n    if (!this.currentRunId) return;\n\n    const { actionResumeBtn, actionRetryBtn, actionCompleteBtn, actionFailBtn } = this.elements;\n\n    const btn =\n      action === 'resume'\n        ? actionResumeBtn\n        : action === 'complete'\n          ? actionCompleteBtn\n          : actionFailBtn;\n\n    // Also check retry button for resume action\n    const retryBtn = action === 'resume' ? actionRetryBtn : null;\n\n    if (!btn) return;\n\n    btn.setAttribute('disabled', 'true');\n    retryBtn?.setAttribute('disabled', 'true');\n    const originalText = btn.innerHTML;\n    btn.innerHTML = `<svg class=\"animate-spin w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"></path></svg>`;\n\n    try {\n      const endpoint = `${this.syncRunsEndpoint}/${this.currentRunId}/${action}`;\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n          'Idempotency-Key': `${action}-${this.currentRunId}-${Date.now()}`,\n        },\n        body: JSON.stringify(\n          action === 'fail' ? { last_error: 'Manually marked as failed' } : {}\n        ),\n      });\n\n      if (!response.ok) {\n        const result = await response.json();\n        throw new Error(result.error?.message || `HTTP ${response.status}`);\n      }\n\n      this.showToast(`Sync run ${action} successful`, 'success');\n      this.closeRunDetail();\n      await this.loadSyncRuns();\n    } catch (error) {\n      console.error(`${action} error:`, error);\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.showToast(`Failed: ${message}`, 'error');\n    } finally {\n      btn.removeAttribute('disabled');\n      retryBtn?.removeAttribute('disabled');\n      btn.innerHTML = originalText;\n    }\n  }\n\n  /**\n   * Open diagnostics for current run\n   */\n  private async openDiagnostics(): Promise<void> {\n    if (!this.currentRunId) return;\n\n    try {\n      const response = await fetch(\n        `${this.apiBase}/esign/integrations/diagnostics?run_id=${this.currentRunId}`,\n        {\n          credentials: 'same-origin',\n          headers: { Accept: 'application/json' },\n        }\n      );\n\n      if (response.ok) {\n        const data = await response.json();\n        console.log('Diagnostics:', data);\n        this.showToast('Diagnostics logged to console', 'info');\n      }\n    } catch (error) {\n      console.error('Diagnostics error:', error);\n    }\n  }\n\n  /**\n   * Show toast notification\n   */\n  private showToast(message: string, type: 'success' | 'error' | 'info'): void {\n    const win = window as unknown as Record<string, unknown>;\n    const toastManager = win.toastManager as\n      | { success: (msg: string) => void; error: (msg: string) => void; info?: (msg: string) => void }\n      | undefined;\n\n    if (toastManager) {\n      if (type === 'success') {\n        toastManager.success(message);\n      } else if (type === 'error') {\n        toastManager.error(message);\n      } else if (type === 'info' && toastManager.info) {\n        toastManager.info(message);\n      }\n    }\n  }\n}\n\n/**\n * Initialize integration sync runs page from config\n */\nexport function initIntegrationSyncRuns(\n  config: IntegrationSyncRunsConfig\n): IntegrationSyncRunsController {\n  const controller = new IntegrationSyncRunsController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap integration sync runs page from template context\n */\nexport function bootstrapIntegrationSyncRuns(config: {\n  basePath: string;\n  apiBasePath?: string;\n}): void {\n  const pageConfig: IntegrationSyncRunsConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api`,\n  };\n\n  const controller = new IntegrationSyncRunsController(pageConfig);\n  onReady(() => controller.init());\n\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignIntegrationSyncRunsController = controller;\n  }\n}\n","/**\n * E-Sign Document Form Page Controller\n * Handles PDF upload and Google Drive import for document ingestion\n */\n\nimport { qs, qsa, show, hide, onReady, announce } from '../utils/dom-helpers.js';\nimport { debounce } from '../utils/async-helpers.js';\nimport { formatFileSize, formatDateTime } from '../utils/formatters.js';\n\nexport interface DocumentFormConfig {\n  basePath: string;\n  apiBasePath?: string;\n  userId: string;\n  googleEnabled: boolean;\n  googleConnected: boolean;\n  googleAccountId?: string;\n  maxFileSize?: number;\n  routes: {\n    index: string;\n    create?: string;\n    agreements?: string;\n    integrations?: string;\n  };\n}\n\ninterface NormalizedDriveFile {\n  id: string;\n  name: string;\n  mimeType: string;\n  modifiedTime: string;\n  webViewLink: string;\n  parents: string[];\n  owners: Array<{ emailAddress?: string }>;\n}\n\ninterface FolderPathItem {\n  id: string;\n  name: string;\n}\n\ninterface ConnectedGoogleAccount {\n  account_id: string;\n  email?: string;\n  status?: string;\n  is_default?: boolean;\n}\n\n// Constants\nconst GOOGLE_ACCOUNT_STORAGE_KEY = 'esign.google.account_id';\nconst MAX_FILE_SIZE_DEFAULT = 25 * 1024 * 1024; // 25 MB\nconst POLL_INTERVAL = 2000;\nconst MAX_POLL_ATTEMPTS = 60;\n\nconst MIME_GOOGLE_DOC = 'application/vnd.google-apps.document';\nconst MIME_PDF = 'application/pdf';\nconst MIME_FOLDER = 'application/vnd.google-apps.folder';\n\nconst IMPORTABLE_TYPES = [MIME_GOOGLE_DOC, MIME_PDF];\n\n/**\n * Document form page controller\n * Manages PDF upload and Google Drive import functionality\n */\nexport class DocumentFormController {\n  private readonly config: DocumentFormConfig;\n  private readonly apiBase: string;\n  private readonly maxFileSize: number;\n  private currentAccountId: string;\n\n  // Upload state\n  private isSubmitting = false;\n\n  // Source state\n  private currentSource: 'upload' | 'google' = 'upload';\n\n  // Google Drive state\n  private currentFiles: NormalizedDriveFile[] = [];\n  private nextPageToken: string | null = null;\n  private currentFolderPath: FolderPathItem[] = [{ id: 'root', name: 'My Drive' }];\n  private selectedFile: NormalizedDriveFile | null = null;\n  private searchQuery = '';\n  private searchTimeout: ReturnType<typeof setTimeout> | null = null;\n  private pollTimeout: ReturnType<typeof setTimeout> | null = null;\n  private pollAttempts = 0;\n  private currentImportRunId: string | null = null;\n  private connectedAccounts: ConnectedGoogleAccount[] = [];\n\n  // Element references\n  private readonly elements: {\n    // Upload panel\n    form: HTMLFormElement | null;\n    fileInput: HTMLInputElement | null;\n    uploadZone: HTMLElement | null;\n    placeholder: HTMLElement | null;\n    preview: HTMLElement | null;\n    fileName: HTMLElement | null;\n    fileSize: HTMLElement | null;\n    clearBtn: HTMLElement | null;\n    errorEl: HTMLElement | null;\n    submitBtn: HTMLButtonElement | null;\n    titleInput: HTMLInputElement | null;\n    sourceObjectKeyInput: HTMLInputElement | null;\n    // Source tabs\n    sourceTabs: HTMLElement[];\n    sourcePanels: HTMLElement[];\n    announcements: HTMLElement | null;\n    // Google Drive panel\n    searchInput: HTMLInputElement | null;\n    clearSearchBtn: HTMLElement | null;\n    fileList: HTMLElement | null;\n    loadingState: HTMLElement | null;\n    breadcrumb: HTMLElement | null;\n    listTitle: HTMLElement | null;\n    resultCount: HTMLElement | null;\n    pagination: HTMLElement | null;\n    loadMoreBtn: HTMLElement | null;\n    refreshBtn: HTMLElement | null;\n    driveAccountDropdown: HTMLSelectElement | null;\n    accountScopeHelp: HTMLElement | null;\n    connectGoogleLink: HTMLAnchorElement | null;\n    // Selection panel\n    noSelection: HTMLElement | null;\n    filePreview: HTMLElement | null;\n    previewIcon: HTMLElement | null;\n    previewTitle: HTMLElement | null;\n    previewType: HTMLElement | null;\n    importTypeInfo: HTMLElement | null;\n    importTypeLabel: HTMLElement | null;\n    importTypeDesc: HTMLElement | null;\n    snapshotWarning: HTMLElement | null;\n    importDocumentTitle: HTMLInputElement | null;\n    importBtn: HTMLButtonElement | null;\n    importBtnText: HTMLElement | null;\n    clearSelectionBtn: HTMLElement | null;\n    // Import status\n    importStatus: HTMLElement | null;\n    importStatusQueued: HTMLElement | null;\n    importStatusSuccess: HTMLElement | null;\n    importStatusFailed: HTMLElement | null;\n    importStatusMessage: HTMLElement | null;\n    importErrorMessage: HTMLElement | null;\n    importRetryBtn: HTMLElement | null;\n    importReconnectLink: HTMLAnchorElement | null;\n  };\n\n  constructor(config: DocumentFormConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api/v1`;\n    this.maxFileSize = config.maxFileSize || MAX_FILE_SIZE_DEFAULT;\n    this.currentAccountId = this.resolveInitialAccountId();\n\n    this.elements = {\n      // Upload panel\n      form: qs<HTMLFormElement>('#document-upload-form'),\n      fileInput: qs<HTMLInputElement>('#pdf_file'),\n      uploadZone: qs('#pdf-upload-zone'),\n      placeholder: qs('#upload-placeholder'),\n      preview: qs('#upload-preview'),\n      fileName: qs('#selected-file-name'),\n      fileSize: qs('#selected-file-size'),\n      clearBtn: qs('#clear-file-btn'),\n      errorEl: qs('#upload-error'),\n      submitBtn: qs<HTMLButtonElement>('#submit-btn'),\n      titleInput: qs<HTMLInputElement>('#title'),\n      sourceObjectKeyInput: qs<HTMLInputElement>('#source_object_key'),\n      // Source tabs\n      sourceTabs: qsa<HTMLElement>('.source-tab'),\n      sourcePanels: qsa<HTMLElement>('.source-panel'),\n      announcements: qs('#doc-announcements'),\n      // Google Drive panel\n      searchInput: qs<HTMLInputElement>('#drive-search'),\n      clearSearchBtn: qs('#clear-search-btn'),\n      fileList: qs('#file-list'),\n      loadingState: qs('#loading-state'),\n      breadcrumb: qs('#breadcrumb'),\n      listTitle: qs('#list-title'),\n      resultCount: qs('#result-count'),\n      pagination: qs('#pagination'),\n      loadMoreBtn: qs('#load-more-btn'),\n      refreshBtn: qs('#refresh-btn'),\n      driveAccountDropdown: qs<HTMLSelectElement>('#drive-account-dropdown'),\n      accountScopeHelp: qs('#account-scope-help'),\n      connectGoogleLink: qs<HTMLAnchorElement>('#connect-google-link'),\n      // Selection panel\n      noSelection: qs('#no-selection'),\n      filePreview: qs('#file-preview'),\n      previewIcon: qs('#preview-icon'),\n      previewTitle: qs('#preview-title'),\n      previewType: qs('#preview-type'),\n      importTypeInfo: qs('#import-type-info'),\n      importTypeLabel: qs('#import-type-label'),\n      importTypeDesc: qs('#import-type-desc'),\n      snapshotWarning: qs('#snapshot-warning'),\n      importDocumentTitle: qs<HTMLInputElement>('#import-document-title'),\n      importBtn: qs<HTMLButtonElement>('#import-btn'),\n      importBtnText: qs('#import-btn-text'),\n      clearSelectionBtn: qs('#clear-selection-btn'),\n      // Import status\n      importStatus: qs('#import-status'),\n      importStatusQueued: qs('#import-status-queued'),\n      importStatusSuccess: qs('#import-status-success'),\n      importStatusFailed: qs('#import-status-failed'),\n      importStatusMessage: qs('#import-status-message'),\n      importErrorMessage: qs('#import-error-message'),\n      importRetryBtn: qs('#import-retry-btn'),\n      importReconnectLink: qs<HTMLAnchorElement>('#import-reconnect-link'),\n    };\n  }\n\n  /**\n   * Initialize the document form page\n   */\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    this.updateAccountScopeUI();\n    if (this.config.googleEnabled && this.config.googleConnected) {\n      await this.loadConnectedAccounts();\n    }\n    this.initializeSourceFromURL();\n  }\n\n  /**\n   * Setup all event listeners\n   */\n  private setupEventListeners(): void {\n    this.setupSourceTabListeners();\n    this.setupUploadListeners();\n    if (this.config.googleEnabled && this.config.googleConnected) {\n      this.setupGoogleDriveListeners();\n    }\n  }\n\n  /**\n   * Setup source tab switching listeners\n   */\n  private setupSourceTabListeners(): void {\n    this.elements.sourceTabs.forEach((tab) => {\n      tab.addEventListener('click', () => {\n        if (!(tab as HTMLButtonElement).disabled) {\n          const source = tab.dataset.source as 'upload' | 'google';\n          this.switchSource(source);\n        }\n      });\n    });\n  }\n\n  /**\n   * Setup PDF upload listeners\n   */\n  private setupUploadListeners(): void {\n    const {\n      form,\n      fileInput,\n      uploadZone,\n      clearBtn,\n      titleInput,\n    } = this.elements;\n\n    // File input change\n    if (fileInput) {\n      fileInput.addEventListener('change', () => this.handleFileSelect());\n    }\n\n    // Clear button\n    if (clearBtn) {\n      clearBtn.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.clearFileSelection();\n      });\n    }\n\n    // Title input\n    if (titleInput) {\n      titleInput.addEventListener('input', () => this.updateSubmitState());\n    }\n\n    // Drag and drop\n    if (uploadZone) {\n      ['dragenter', 'dragover'].forEach((eventName) => {\n        uploadZone.addEventListener(eventName, (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          uploadZone.classList.add('border-blue-400', 'bg-blue-50');\n        });\n      });\n\n      ['dragleave', 'drop'].forEach((eventName) => {\n        uploadZone.addEventListener(eventName, (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          uploadZone.classList.remove('border-blue-400', 'bg-blue-50');\n        });\n      });\n\n      uploadZone.addEventListener('drop', (e) => {\n        const dt = (e as DragEvent).dataTransfer;\n        if (dt?.files?.length && this.elements.fileInput) {\n          this.elements.fileInput.files = dt.files;\n          this.handleFileSelect();\n        }\n      });\n\n      // Keyboard accessibility\n      uploadZone.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          this.elements.fileInput?.click();\n        }\n      });\n    }\n\n    // Form submission\n    if (form) {\n      form.addEventListener('submit', (e) => this.handleFormSubmit(e));\n    }\n  }\n\n  /**\n   * Setup Google Drive listeners\n   */\n  private setupGoogleDriveListeners(): void {\n    const {\n      searchInput,\n      clearSearchBtn,\n      loadMoreBtn,\n      refreshBtn,\n      clearSelectionBtn,\n      importBtn,\n      importRetryBtn,\n      driveAccountDropdown,\n    } = this.elements;\n\n    // Search\n    if (searchInput) {\n      const debouncedSearch = debounce(() => this.handleSearch(), 300);\n      searchInput.addEventListener('input', debouncedSearch);\n    }\n\n    // Clear search\n    if (clearSearchBtn) {\n      clearSearchBtn.addEventListener('click', () => this.clearSearch());\n    }\n\n    // Load more\n    if (loadMoreBtn) {\n      loadMoreBtn.addEventListener('click', () => this.loadMoreFiles());\n    }\n\n    // Refresh\n    if (refreshBtn) {\n      refreshBtn.addEventListener('click', () => this.refreshFiles());\n    }\n\n    // Account selector\n    if (driveAccountDropdown) {\n      driveAccountDropdown.addEventListener('change', () => {\n        this.setCurrentAccountId(driveAccountDropdown.value, this.currentSource === 'google');\n      });\n    }\n\n    // Clear selection\n    if (clearSelectionBtn) {\n      clearSelectionBtn.addEventListener('click', () => this.clearFileSelection());\n    }\n\n    // Import button\n    if (importBtn) {\n      importBtn.addEventListener('click', () => this.startImport());\n    }\n\n    // Retry import\n    if (importRetryBtn) {\n      importRetryBtn.addEventListener('click', () => {\n        if (this.selectedFile) {\n          this.startImport();\n        } else {\n          this.clearDriveSelection();\n        }\n      });\n    }\n  }\n\n  // ============================================================\n  // Account ID Management\n  // ============================================================\n\n  /**\n   * Resolve initial account ID from query, template, or localStorage\n   */\n  private resolveInitialAccountId(): string {\n    const params = new URLSearchParams(window.location.search);\n    const fromQuery = this.normalizeAccountId(params.get('account_id'));\n    if (fromQuery) return fromQuery;\n\n    const fromTemplate = this.normalizeAccountId(this.config.googleAccountId);\n    if (fromTemplate) return fromTemplate;\n\n    try {\n      return this.normalizeAccountId(\n        window.localStorage.getItem(GOOGLE_ACCOUNT_STORAGE_KEY)\n      );\n    } catch {\n      return '';\n    }\n  }\n\n  /**\n   * Normalize account ID\n   */\n  private normalizeAccountId(value: string | null | undefined): string {\n    return (value || '').trim();\n  }\n\n  /**\n   * Set current account ID and optionally refresh Drive files\n   */\n  private setCurrentAccountId(value: string, refreshFiles = false): void {\n    const normalized = this.normalizeAccountId(value);\n    if (normalized === this.currentAccountId) {\n      this.updateAccountScopeUI();\n      return;\n    }\n\n    this.currentAccountId = normalized;\n    this.updateAccountScopeUI();\n\n    if (refreshFiles && this.config.googleEnabled && this.config.googleConnected) {\n      this.currentFolderPath = [{ id: 'root', name: 'My Drive' }];\n      this.searchQuery = '';\n      const { searchInput, clearSearchBtn } = this.elements;\n      if (searchInput) searchInput.value = '';\n      if (clearSearchBtn) hide(clearSearchBtn);\n      this.updateBreadcrumb();\n      this.loadFiles({ folderId: 'root' });\n    }\n  }\n\n  /**\n   * Load connected accounts for account selector\n   */\n  private async loadConnectedAccounts(): Promise<void> {\n    const { driveAccountDropdown } = this.elements;\n    if (!driveAccountDropdown) {\n      return;\n    }\n\n    try {\n      const url = new URL(`${this.apiBase}/esign/integrations/google/accounts`, window.location.origin);\n      url.searchParams.set('user_id', this.config.userId || '');\n\n      const response = await fetch(url.toString(), {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) {\n        this.connectedAccounts = [];\n        this.renderConnectedAccountsDropdown();\n        return;\n      }\n\n      const data = await response.json();\n      this.connectedAccounts = Array.isArray(data.accounts)\n        ? (data.accounts as ConnectedGoogleAccount[])\n        : [];\n      this.renderConnectedAccountsDropdown();\n    } catch {\n      this.connectedAccounts = [];\n      this.renderConnectedAccountsDropdown();\n    }\n  }\n\n  /**\n   * Render account selector options\n   */\n  private renderConnectedAccountsDropdown(): void {\n    const { driveAccountDropdown } = this.elements;\n    if (!driveAccountDropdown) {\n      return;\n    }\n\n    driveAccountDropdown.innerHTML = '';\n\n    const defaultOption = document.createElement('option');\n    defaultOption.value = '';\n    defaultOption.textContent = 'Default account';\n    if (!this.currentAccountId) {\n      defaultOption.selected = true;\n    }\n    driveAccountDropdown.appendChild(defaultOption);\n\n    const seen = new Set<string>(['']);\n    for (const account of this.connectedAccounts) {\n      const accountID = this.normalizeAccountId(account?.account_id);\n      if (seen.has(accountID)) {\n        continue;\n      }\n      seen.add(accountID);\n\n      const option = document.createElement('option');\n      option.value = accountID;\n      const email = String(account?.email || '').trim();\n      const status = String(account?.status || '').trim();\n      const label = email || accountID || 'Default account';\n      option.textContent = status && status !== 'connected' ? `${label} (${status})` : label;\n      if (accountID === this.currentAccountId) {\n        option.selected = true;\n      }\n      driveAccountDropdown.appendChild(option);\n    }\n\n    if (this.currentAccountId && !seen.has(this.currentAccountId)) {\n      const customOption = document.createElement('option');\n      customOption.value = this.currentAccountId;\n      customOption.textContent = `${this.currentAccountId} (custom)`;\n      customOption.selected = true;\n      driveAccountDropdown.appendChild(customOption);\n    }\n  }\n\n  /**\n   * Sync account ID to URL and localStorage\n   */\n  private syncScopedAccountState(): void {\n    const url = new URL(window.location.href);\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      url.searchParams.delete('account_id');\n    }\n    window.history.replaceState({}, '', url.toString());\n\n    try {\n      if (this.currentAccountId) {\n        window.localStorage.setItem(GOOGLE_ACCOUNT_STORAGE_KEY, this.currentAccountId);\n      } else {\n        window.localStorage.removeItem(GOOGLE_ACCOUNT_STORAGE_KEY);\n      }\n    } catch {\n      // Ignore storage failures\n    }\n  }\n\n  /**\n   * Apply account ID to a path\n   */\n  private applyAccountIdToPath(pathOrURL: string): string {\n    const parsed = new URL(pathOrURL, window.location.origin);\n    if (this.currentAccountId) {\n      parsed.searchParams.set('account_id', this.currentAccountId);\n    } else {\n      parsed.searchParams.delete('account_id');\n    }\n    return `${parsed.pathname}${parsed.search}${parsed.hash}`;\n  }\n\n  /**\n   * Update account scope UI elements\n   */\n  private updateAccountScopeUI(): void {\n    this.syncScopedAccountState();\n\n    const { accountScopeHelp, connectGoogleLink, driveAccountDropdown } = this.elements;\n\n    if (accountScopeHelp) {\n      if (this.currentAccountId) {\n        accountScopeHelp.textContent = `Account scope: ${this.currentAccountId}`;\n        show(accountScopeHelp);\n      } else {\n        hide(accountScopeHelp);\n      }\n    }\n\n    if (connectGoogleLink) {\n      const baseHref =\n        connectGoogleLink.dataset.baseHref || connectGoogleLink.getAttribute('href');\n      if (baseHref) {\n        connectGoogleLink.setAttribute('href', this.applyAccountIdToPath(baseHref));\n      }\n    }\n\n    if (driveAccountDropdown) {\n      const hasOption = Array.from(driveAccountDropdown.options).some(\n        (option) => this.normalizeAccountId(option.value) === this.currentAccountId\n      );\n      if (!hasOption) {\n        this.renderConnectedAccountsDropdown();\n      }\n      if (driveAccountDropdown.value !== this.currentAccountId) {\n        driveAccountDropdown.value = this.currentAccountId;\n      }\n    }\n  }\n\n  /**\n   * Build scoped API URL\n   */\n  private buildScopedAPIURL(path: string): URL {\n    const url = new URL(`${this.apiBase}${path}`, window.location.origin);\n    url.searchParams.set('user_id', this.config.userId || '');\n    if (this.currentAccountId) {\n      url.searchParams.set('account_id', this.currentAccountId);\n    }\n    return url;\n  }\n\n  // ============================================================\n  // Source Tab Switching\n  // ============================================================\n\n  /**\n   * Switch between upload and Google Drive source\n   */\n  private switchSource(source: 'upload' | 'google'): void {\n    this.currentSource = source;\n\n    // Update tabs\n    this.elements.sourceTabs.forEach((tab) => {\n      const isActive = tab.dataset.source === source;\n      tab.setAttribute('aria-selected', String(isActive));\n      if (isActive) {\n        tab.classList.add('border-blue-500', 'text-blue-600');\n        tab.classList.remove(\n          'border-transparent',\n          'text-gray-500',\n          'hover:text-gray-700',\n          'hover:border-gray-300'\n        );\n      } else {\n        tab.classList.remove('border-blue-500', 'text-blue-600');\n        tab.classList.add(\n          'border-transparent',\n          'text-gray-500',\n          'hover:text-gray-700',\n          'hover:border-gray-300'\n        );\n      }\n    });\n\n    // Update panels\n    this.elements.sourcePanels.forEach((panel) => {\n      const panelSource = panel.id.replace('panel-', '');\n      if (panelSource === source) {\n        show(panel);\n      } else {\n        hide(panel);\n      }\n    });\n\n    // Update URL\n    const url = new URL(window.location.href);\n    if (source === 'google') {\n      url.searchParams.set('source', 'google');\n    } else {\n      url.searchParams.delete('source');\n    }\n    window.history.replaceState({}, '', url.toString());\n\n    // Load Google Drive files if switching to Google and connected\n    if (\n      source === 'google' &&\n      this.config.googleEnabled &&\n      this.config.googleConnected\n    ) {\n      this.loadFiles({ folderId: 'root' });\n    }\n\n    announce(\n      `Switched to ${source === 'google' ? 'Google Drive import' : 'PDF upload'}`\n    );\n  }\n\n  /**\n   * Initialize source from URL parameters\n   */\n  private initializeSourceFromURL(): void {\n    const params = new URLSearchParams(window.location.search);\n    const source = params.get('source');\n    const importRunId = params.get('import_run_id');\n\n    if (source === 'google' && this.config.googleEnabled) {\n      this.switchSource('google');\n      // Resume import if import_run_id is present\n      if (importRunId && this.config.googleConnected) {\n        this.currentImportRunId = importRunId;\n        this.resumeImportPolling(importRunId);\n      }\n    } else {\n      this.switchSource('upload');\n    }\n  }\n\n  // ============================================================\n  // PDF Upload\n  // ============================================================\n\n  /**\n   * Handle file selection\n   */\n  private handleFileSelect(): void {\n    const { fileInput, titleInput, sourceObjectKeyInput } = this.elements;\n    const file = fileInput?.files?.[0];\n\n    if (file && this.validateFile(file)) {\n      this.showPreview(file);\n      if (sourceObjectKeyInput) {\n        sourceObjectKeyInput.value = '';\n      }\n\n      // Auto-fill title from filename if empty\n      if (titleInput && !titleInput.value.trim()) {\n        const nameWithoutExt = file.name.replace(/\\.pdf$/i, '');\n        titleInput.value = nameWithoutExt;\n      }\n    } else {\n      if (fileInput) {\n        fileInput.value = '';\n      }\n      this.clearPreview();\n      if (sourceObjectKeyInput) {\n        sourceObjectKeyInput.value = '';\n      }\n    }\n    this.updateSubmitState();\n  }\n\n  /**\n   * Validate uploaded file\n   */\n  private validateFile(file: File): boolean {\n    this.clearError();\n\n    if (!file) return false;\n\n    // Check file type\n    if (\n      file.type !== 'application/pdf' &&\n      !file.name.toLowerCase().endsWith('.pdf')\n    ) {\n      this.showError('Please select a PDF file.');\n      return false;\n    }\n\n    // Check file size\n    if (file.size > this.maxFileSize) {\n      this.showError(\n        `File is too large (${formatFileSize(file.size)}). Maximum size is ${formatFileSize(this.maxFileSize)}.`\n      );\n      return false;\n    }\n\n    // Check for empty file\n    if (file.size === 0) {\n      this.showError('The selected file appears to be empty.');\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Show file preview\n   */\n  private showPreview(file: File): void {\n    const { placeholder, preview, fileName, fileSize, uploadZone } = this.elements;\n\n    if (fileName) fileName.textContent = file.name;\n    if (fileSize) fileSize.textContent = formatFileSize(file.size);\n    if (placeholder) hide(placeholder);\n    if (preview) show(preview);\n    if (uploadZone) {\n      uploadZone.classList.remove('border-gray-300');\n      uploadZone.classList.add('border-green-400', 'bg-green-50');\n    }\n  }\n\n  /**\n   * Clear file preview\n   */\n  private clearPreview(): void {\n    const { placeholder, preview, uploadZone } = this.elements;\n\n    if (placeholder) show(placeholder);\n    if (preview) hide(preview);\n    if (uploadZone) {\n      uploadZone.classList.add('border-gray-300');\n      uploadZone.classList.remove('border-green-400', 'bg-green-50');\n    }\n  }\n\n  /**\n   * Clear file selection\n   */\n  private clearFileSelection(): void {\n    const { fileInput, sourceObjectKeyInput } = this.elements;\n    if (fileInput) fileInput.value = '';\n    if (sourceObjectKeyInput) sourceObjectKeyInput.value = '';\n    this.clearPreview();\n    this.clearError();\n    this.updateSubmitState();\n  }\n\n  /**\n   * Show error message\n   */\n  private showError(message: string): void {\n    const { errorEl } = this.elements;\n    if (errorEl) {\n      errorEl.textContent = message;\n      show(errorEl);\n    }\n  }\n\n  /**\n   * Clear error message\n   */\n  private clearError(): void {\n    const { errorEl } = this.elements;\n    if (errorEl) {\n      errorEl.textContent = '';\n      hide(errorEl);\n    }\n  }\n\n  /**\n   * Update submit button state\n   */\n  private updateSubmitState(): void {\n    const { fileInput, titleInput, submitBtn } = this.elements;\n    const hasFile = fileInput?.files && fileInput.files.length > 0;\n    const hasTitle = titleInput?.value.trim().length ?? 0 > 0;\n    const isEnabled = hasFile && hasTitle;\n\n    if (submitBtn) {\n      submitBtn.disabled = !isEnabled;\n      submitBtn.setAttribute('aria-disabled', String(!isEnabled));\n    }\n  }\n\n  /**\n   * Set submitting state\n   */\n  private setSubmittingState(submitting: boolean): void {\n    const { submitBtn } = this.elements;\n    if (!submitBtn) return;\n\n    submitBtn.disabled = submitting;\n    submitBtn.setAttribute('aria-disabled', String(submitting));\n\n    if (submitting) {\n      submitBtn.innerHTML = `\n        <svg class=\"animate-spin w-4 h-4 mr-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n          <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n          <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n        </svg>\n        Uploading...\n      `;\n    } else {\n      submitBtn.innerHTML = `\n        <svg class=\"w-4 h-4 mr-1\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"/>\n        </svg>\n        Upload Document\n      `;\n    }\n  }\n\n  /**\n   * Upload source PDF to API\n   */\n  private async uploadSourcePDF(file: File): Promise<string> {\n    const params = new URLSearchParams(window.location.search);\n    const tenantId = params.get('tenant_id');\n    const orgId = params.get('org_id');\n\n    const uploadURL = new URL(\n      `${this.apiBase}/esign/documents/upload`,\n      window.location.origin\n    );\n    if (tenantId) uploadURL.searchParams.set('tenant_id', tenantId);\n    if (orgId) uploadURL.searchParams.set('org_id', orgId);\n\n    const payload = new FormData();\n    payload.append('file', file);\n\n    const response = await fetch(uploadURL.toString(), {\n      method: 'POST',\n      body: payload,\n      credentials: 'same-origin',\n    });\n\n    const body = await response.json().catch(() => ({}));\n    if (!response.ok) {\n      const message =\n        body?.error?.message || body?.message || 'Upload failed. Please try again.';\n      throw new Error(message);\n    }\n\n    const objectKey = body?.object_key ? String(body.object_key).trim() : '';\n    if (!objectKey) {\n      throw new Error('Upload failed: missing source object key.');\n    }\n\n    return objectKey;\n  }\n\n  /**\n   * Handle form submission\n   */\n  private async handleFormSubmit(e: Event): Promise<void> {\n    e.preventDefault();\n\n    if (this.isSubmitting) return;\n\n    const { fileInput, form, sourceObjectKeyInput } = this.elements;\n    const file = fileInput?.files?.[0];\n\n    if (!file || !this.validateFile(file)) {\n      return;\n    }\n\n    this.clearError();\n    this.isSubmitting = true;\n    this.setSubmittingState(true);\n\n    try {\n      const objectKey = await this.uploadSourcePDF(file);\n      if (sourceObjectKeyInput) {\n        sourceObjectKeyInput.value = objectKey;\n      }\n      form?.submit();\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : 'Upload failed. Please try again.';\n      this.showError(message);\n      this.setSubmittingState(false);\n      this.isSubmitting = false;\n      this.updateSubmitState();\n    }\n  }\n\n  // ============================================================\n  // Google Drive Browser\n  // ============================================================\n\n  /**\n   * Normalize drive file from API response\n   */\n  private normalizeDriveFile(file: Record<string, unknown>): NormalizedDriveFile {\n    if (!file || typeof file !== 'object') {\n      return {\n        id: '',\n        name: '',\n        mimeType: '',\n        modifiedTime: '',\n        webViewLink: '',\n        parents: [],\n        owners: [],\n      };\n    }\n\n    const id = String(file.id || file.ID || '').trim();\n    const name = String(file.name || file.Name || '').trim();\n    const mimeType = String(file.mimeType || file.MimeType || '').trim();\n    const modifiedTime = String(file.modifiedTime || file.ModifiedTime || '').trim();\n    const webViewLink = String(\n      file.webViewLink || file.webViewURL || file.WebViewURL || ''\n    ).trim();\n    const parentID = String(file.parentId || file.ParentID || '').trim();\n    const ownerEmail = String(file.ownerEmail || file.OwnerEmail || '').trim();\n    const parents = Array.isArray(file.parents)\n      ? (file.parents as string[])\n      : parentID\n        ? [parentID]\n        : [];\n    const owners = Array.isArray(file.owners)\n      ? (file.owners as Array<{ emailAddress?: string }>)\n      : ownerEmail\n        ? [{ emailAddress: ownerEmail }]\n        : [];\n\n    return {\n      id,\n      name,\n      mimeType,\n      modifiedTime,\n      webViewLink,\n      parents,\n      owners,\n    };\n  }\n\n  /**\n   * Check if file is a Google Doc\n   */\n  private isGoogleDoc(file: NormalizedDriveFile): boolean {\n    return file.mimeType === MIME_GOOGLE_DOC;\n  }\n\n  /**\n   * Check if file is a PDF\n   */\n  private isPDF(file: NormalizedDriveFile): boolean {\n    return file.mimeType === MIME_PDF;\n  }\n\n  /**\n   * Check if file is a folder\n   */\n  private isFolder(file: NormalizedDriveFile): boolean {\n    return file.mimeType === MIME_FOLDER;\n  }\n\n  /**\n   * Check if file is importable\n   */\n  private isImportable(file: NormalizedDriveFile): boolean {\n    return IMPORTABLE_TYPES.includes(file.mimeType);\n  }\n\n  /**\n   * Get file type name\n   */\n  private getFileTypeName(mimeType: string): string {\n    const normalized = String(mimeType || '').trim().toLowerCase();\n    if (normalized === MIME_GOOGLE_DOC) return 'Google Document';\n    if (normalized === MIME_PDF) return 'PDF Document';\n    if (normalized === 'application/vnd.google-apps.spreadsheet')\n      return 'Google Spreadsheet';\n    if (normalized === 'application/vnd.google-apps.presentation')\n      return 'Google Slides';\n    if (normalized === MIME_FOLDER) return 'Folder';\n    return 'File';\n  }\n\n  /**\n   * Get file icon HTML\n   */\n  private getFileIcon(file: NormalizedDriveFile): {\n    html: string;\n    bg: string;\n    text: string;\n  } {\n    const colors = {\n      doc: { bg: 'bg-blue-100', text: 'text-blue-600' },\n      pdf: { bg: 'bg-red-100', text: 'text-red-600' },\n      folder: { bg: 'bg-gray-100', text: 'text-gray-600' },\n      default: { bg: 'bg-gray-100', text: 'text-gray-400' },\n    };\n\n    let type: keyof typeof colors = 'default';\n    if (this.isFolder(file)) type = 'folder';\n    else if (this.isGoogleDoc(file)) type = 'doc';\n    else if (this.isPDF(file)) type = 'pdf';\n\n    const color = colors[type];\n\n    const icons = {\n      doc: '<svg class=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z\"/></svg>',\n      pdf: '<svg class=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5z\"/></svg>',\n      folder:\n        '<svg class=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z\"/></svg>',\n      default:\n        '<svg class=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z\"/></svg>',\n    };\n\n    return { html: icons[type], ...color };\n  }\n\n  /**\n   * Get import type info for display\n   */\n  private getImportTypeInfo(file: NormalizedDriveFile): {\n    label: string;\n    desc: string;\n    bgClass: string;\n    textClass: string;\n    showSnapshot: boolean;\n  } | null {\n    if (this.isGoogleDoc(file)) {\n      return {\n        label: 'Google Doc \\u2192 PDF Export',\n        desc: 'Will be exported as PDF snapshot',\n        bgClass: 'bg-blue-50 border-blue-100',\n        textClass: 'text-blue-700',\n        showSnapshot: true,\n      };\n    } else if (this.isPDF(file)) {\n      return {\n        label: 'Direct PDF Import',\n        desc: 'Will be imported as-is',\n        bgClass: 'bg-green-50 border-green-100',\n        textClass: 'text-green-700',\n        showSnapshot: false,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Load files from Google Drive\n   */\n  async loadFiles(options: {\n    folderId?: string;\n    query?: string;\n    pageToken?: string;\n    append?: boolean;\n  } = {}): Promise<void> {\n    const { folderId, query, pageToken, append } = options;\n    const { fileList } = this.elements;\n\n    if (!append && fileList) {\n      fileList.innerHTML = `\n        <div class=\"p-8 text-center\">\n          <svg class=\"animate-spin h-8 w-8 mx-auto text-gray-400 mb-3\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          <p class=\"text-sm text-gray-500\">Loading files...</p>\n        </div>\n      `;\n    }\n\n    try {\n      let url: URL;\n      if (query) {\n        url = this.buildScopedAPIURL('/esign/google-drive/search');\n        url.searchParams.set('q', query);\n        url.searchParams.set('page_size', '20');\n        if (pageToken) url.searchParams.set('page_token', pageToken);\n      } else {\n        url = this.buildScopedAPIURL('/esign/google-drive/browse');\n        url.searchParams.set('page_size', '20');\n        if (folderId && folderId !== 'root') {\n          url.searchParams.set('folder_id', folderId);\n        }\n        if (pageToken) url.searchParams.set('page_token', pageToken);\n      }\n\n      const response = await fetch(url.toString(), {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error?.message || 'Failed to load files');\n      }\n\n      const files = Array.isArray(data.files)\n        ? data.files.map((f: Record<string, unknown>) => this.normalizeDriveFile(f))\n        : [];\n\n      this.nextPageToken = data.next_page_token || null;\n\n      if (append) {\n        this.currentFiles = [...this.currentFiles, ...files];\n      } else {\n        this.currentFiles = files;\n      }\n\n      this.renderFiles(append);\n\n      // Update result count\n      const { resultCount, listTitle } = this.elements;\n      if (query && resultCount) {\n        resultCount.textContent = `(${this.currentFiles.length} result${this.currentFiles.length !== 1 ? 's' : ''})`;\n        if (listTitle) listTitle.textContent = 'Search Results';\n      } else {\n        if (resultCount) resultCount.textContent = '';\n        if (listTitle) {\n          listTitle.textContent =\n            this.currentFolderPath[this.currentFolderPath.length - 1].name;\n        }\n      }\n\n      // Show/hide pagination\n      const { pagination } = this.elements;\n      if (pagination) {\n        if (this.nextPageToken) {\n          show(pagination);\n        } else {\n          hide(pagination);\n        }\n      }\n\n      announce(`Loaded ${files.length} files`);\n    } catch (error) {\n      console.error('Error loading files:', error);\n      if (fileList) {\n        fileList.innerHTML = `\n          <div class=\"p-8 text-center\">\n            <div class=\"w-12 h-12 mx-auto mb-3 rounded-full bg-red-100 flex items-center justify-center\">\n              <svg class=\"w-6 h-6 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n              </svg>\n            </div>\n            <p class=\"text-sm text-gray-900 font-medium\">Failed to load files</p>\n            <p class=\"text-xs text-gray-500 mt-1\">${this.escapeHtml(error instanceof Error ? error.message : 'Unknown error')}</p>\n            <button type=\"button\" onclick=\"location.reload()\" class=\"mt-3 text-sm text-blue-600 hover:text-blue-800\">Try Again</button>\n          </div>\n        `;\n      }\n      announce(`Error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Render files in the file list\n   */\n  private renderFiles(append = false): void {\n    const { fileList } = this.elements;\n    if (!fileList) return;\n\n    if (this.currentFiles.length === 0) {\n      fileList.innerHTML = `\n        <div class=\"p-8 text-center\">\n          <div class=\"w-12 h-12 mx-auto mb-3 rounded-full bg-gray-100 flex items-center justify-center\">\n            <svg class=\"w-6 h-6 text-gray-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z\"/>\n            </svg>\n          </div>\n          <p class=\"text-sm text-gray-500\">No files found</p>\n        </div>\n      `;\n      return;\n    }\n\n    const html = this.currentFiles\n      .map((file, index) => {\n        const icon = this.getFileIcon(file);\n        const importable = this.isImportable(file);\n        const folder = this.isFolder(file);\n        const selected = this.selectedFile && this.selectedFile.id === file.id;\n        const isDisabled = !importable && !folder;\n\n        return `\n        <button\n          type=\"button\"\n          class=\"file-item w-full p-3 flex items-center gap-3 hover:bg-gray-50 text-left transition-colors ${selected ? 'bg-blue-50 border-l-2 border-l-blue-500' : ''} ${isDisabled ? 'opacity-50 cursor-not-allowed' : ''}\"\n          role=\"option\"\n          aria-selected=\"${selected}\"\n          data-file-index=\"${index}\"\n          ${isDisabled ? 'disabled title=\"Only Google Docs and PDFs can be imported\"' : ''}\n        >\n          <div class=\"w-10 h-10 rounded-lg ${icon.bg} flex items-center justify-center flex-shrink-0 ${icon.text}\">\n            ${icon.html}\n          </div>\n          <div class=\"flex-1 min-w-0\">\n            <p class=\"font-medium text-gray-900 truncate\">${this.escapeHtml(file.name || 'Untitled')}</p>\n            <p class=\"text-xs text-gray-500\">\n              ${this.getFileTypeName(file.mimeType)}\n              ${file.modifiedTime ? ' \\u2022 ' + formatDateTime(file.modifiedTime) : ''}\n              ${isDisabled ? ' \\u2022 Not importable' : ''}\n            </p>\n          </div>\n          ${\n            folder\n              ? `\n            <svg class=\"w-5 h-5 text-gray-400 flex-shrink-0\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/>\n            </svg>\n          `\n              : ''\n          }\n        </button>\n      `;\n      })\n      .join('');\n\n    if (append) {\n      fileList.insertAdjacentHTML('beforeend', html);\n    } else {\n      fileList.innerHTML = html;\n    }\n\n    // Attach click handlers\n    fileList.querySelectorAll('.file-item').forEach((item) => {\n      item.addEventListener('click', () => {\n        const index = parseInt((item as HTMLElement).dataset.fileIndex || '0', 10);\n        const file = this.currentFiles[index];\n        if (this.isFolder(file)) {\n          this.navigateToFolder(file);\n        } else if (this.isImportable(file)) {\n          this.selectFile(file);\n        }\n      });\n    });\n  }\n\n  /**\n   * Navigate to folder\n   */\n  private navigateToFolder(folder: NormalizedDriveFile): void {\n    this.currentFolderPath.push({ id: folder.id, name: folder.name });\n    this.updateBreadcrumb();\n    this.searchQuery = '';\n    const { searchInput, clearSearchBtn } = this.elements;\n    if (searchInput) searchInput.value = '';\n    if (clearSearchBtn) hide(clearSearchBtn);\n    this.loadFiles({ folderId: folder.id });\n  }\n\n  /**\n   * Update breadcrumb navigation\n   */\n  private updateBreadcrumb(): void {\n    const { breadcrumb } = this.elements;\n    if (!breadcrumb) return;\n\n    if (this.currentFolderPath.length <= 1) {\n      hide(breadcrumb);\n      return;\n    }\n\n    show(breadcrumb);\n    const ol = breadcrumb.querySelector('ol');\n    if (ol) {\n      ol.innerHTML = this.currentFolderPath\n        .map((folder, index) => {\n          const isLast = index === this.currentFolderPath.length - 1;\n          return `\n          <li class=\"flex items-center\">\n            ${index > 0 ? '<svg class=\"w-4 h-4 text-gray-400 mx-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/></svg>' : ''}\n            <button type=\"button\" data-folder-index=\"${index}\" class=\"breadcrumb-item ${isLast ? 'text-gray-900 font-medium cursor-default' : 'text-blue-600 hover:text-blue-800 hover:underline'}\">\n              ${this.escapeHtml(folder.name)}\n            </button>\n          </li>\n        `;\n        })\n        .join('');\n\n      ol.querySelectorAll('.breadcrumb-item').forEach((item) => {\n        item.addEventListener('click', () => {\n          const index = parseInt((item as HTMLElement).dataset.folderIndex || '0', 10);\n          this.currentFolderPath = this.currentFolderPath.slice(0, index + 1);\n          this.updateBreadcrumb();\n          const folder = this.currentFolderPath[this.currentFolderPath.length - 1];\n          this.loadFiles({ folderId: folder.id });\n        });\n      });\n    }\n  }\n\n  /**\n   * Select a file\n   */\n  private selectFile(file: NormalizedDriveFile): void {\n    this.selectedFile = file;\n    const icon = this.getFileIcon(file);\n    const typeInfo = this.getImportTypeInfo(file);\n\n    // Update selection visual\n    const { fileList } = this.elements;\n    if (fileList) {\n      fileList.querySelectorAll('.file-item').forEach((item) => {\n        const index = parseInt((item as HTMLElement).dataset.fileIndex || '0', 10);\n        if (this.currentFiles[index].id === file.id) {\n          item.classList.add('bg-blue-50', 'border-l-2', 'border-l-blue-500');\n          item.setAttribute('aria-selected', 'true');\n        } else {\n          item.classList.remove('bg-blue-50', 'border-l-2', 'border-l-blue-500');\n          item.setAttribute('aria-selected', 'false');\n        }\n      });\n    }\n\n    // Show preview\n    const {\n      noSelection,\n      filePreview,\n      importStatus,\n      previewIcon,\n      previewTitle,\n      previewType,\n      importTypeInfo,\n      importTypeLabel,\n      importTypeDesc,\n      snapshotWarning,\n      importDocumentTitle,\n    } = this.elements;\n\n    if (noSelection) hide(noSelection);\n    if (filePreview) show(filePreview);\n    if (importStatus) hide(importStatus);\n\n    if (previewIcon) {\n      previewIcon.className = `w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 ${icon.bg} ${icon.text}`;\n      previewIcon.innerHTML = icon.html.replace('w-5 h-5', 'w-6 h-6');\n    }\n    if (previewTitle) previewTitle.textContent = file.name || 'Untitled';\n    if (previewType) previewType.textContent = this.getFileTypeName(file.mimeType);\n\n    // Update import type info\n    if (typeInfo && importTypeInfo) {\n      importTypeInfo.className = `p-3 rounded-lg border ${typeInfo.bgClass}`;\n      if (importTypeLabel) {\n        importTypeLabel.textContent = typeInfo.label;\n        importTypeLabel.className = `text-xs font-medium ${typeInfo.textClass}`;\n      }\n      if (importTypeDesc) {\n        importTypeDesc.textContent = typeInfo.desc;\n        importTypeDesc.className = `text-xs mt-1 ${typeInfo.textClass}`;\n      }\n      if (snapshotWarning) {\n        if (typeInfo.showSnapshot) {\n          show(snapshotWarning);\n        } else {\n          hide(snapshotWarning);\n        }\n      }\n    }\n\n    // Pre-fill document title\n    if (importDocumentTitle) {\n      importDocumentTitle.value = file.name || '';\n    }\n\n    announce(`Selected: ${file.name}`);\n  }\n\n  /**\n   * Clear drive selection\n   */\n  private clearDriveSelection(): void {\n    this.selectedFile = null;\n    const { noSelection, filePreview, importStatus, fileList } = this.elements;\n\n    if (noSelection) show(noSelection);\n    if (filePreview) hide(filePreview);\n    if (importStatus) hide(importStatus);\n\n    if (fileList) {\n      fileList.querySelectorAll('.file-item').forEach((item) => {\n        item.classList.remove('bg-blue-50', 'border-l-2', 'border-l-blue-500');\n        item.setAttribute('aria-selected', 'false');\n      });\n    }\n  }\n\n  /**\n   * Handle search input\n   */\n  private handleSearch(): void {\n    const { searchInput, clearSearchBtn } = this.elements;\n    if (!searchInput) return;\n\n    const query = searchInput.value.trim();\n\n    if (query) {\n      if (clearSearchBtn) show(clearSearchBtn);\n      this.searchQuery = query;\n      this.loadFiles({ query });\n    } else {\n      if (clearSearchBtn) hide(clearSearchBtn);\n      this.searchQuery = '';\n      const folder = this.currentFolderPath[this.currentFolderPath.length - 1];\n      this.loadFiles({ folderId: folder.id });\n    }\n  }\n\n  /**\n   * Clear search\n   */\n  private clearSearch(): void {\n    const { searchInput, clearSearchBtn } = this.elements;\n    if (searchInput) searchInput.value = '';\n    if (clearSearchBtn) hide(clearSearchBtn);\n    this.searchQuery = '';\n    const folder = this.currentFolderPath[this.currentFolderPath.length - 1];\n    this.loadFiles({ folderId: folder.id });\n  }\n\n  /**\n   * Load more files\n   */\n  private loadMoreFiles(): void {\n    if (this.nextPageToken) {\n      const folder = this.currentFolderPath[this.currentFolderPath.length - 1];\n      this.loadFiles({\n        folderId: this.searchQuery ? undefined : folder.id,\n        query: this.searchQuery || undefined,\n        pageToken: this.nextPageToken,\n        append: true,\n      });\n    }\n  }\n\n  /**\n   * Refresh files\n   */\n  private refreshFiles(): void {\n    if (this.searchQuery) {\n      this.loadFiles({ query: this.searchQuery });\n    } else {\n      const folder = this.currentFolderPath[this.currentFolderPath.length - 1];\n      this.loadFiles({ folderId: folder.id });\n    }\n  }\n\n  // ============================================================\n  // Async Import with Polling\n  // ============================================================\n\n  /**\n   * Show import status panel\n   */\n  private showImportStatus(status: 'queued' | 'running' | 'succeeded' | 'failed'): void {\n    const {\n      noSelection,\n      filePreview,\n      importStatus,\n      importStatusQueued,\n      importStatusSuccess,\n      importStatusFailed,\n    } = this.elements;\n\n    if (noSelection) hide(noSelection);\n    if (filePreview) hide(filePreview);\n    if (importStatus) show(importStatus);\n\n    if (importStatusQueued) hide(importStatusQueued);\n    if (importStatusSuccess) hide(importStatusSuccess);\n    if (importStatusFailed) hide(importStatusFailed);\n\n    switch (status) {\n      case 'queued':\n      case 'running':\n        if (importStatusQueued) show(importStatusQueued);\n        break;\n      case 'succeeded':\n        if (importStatusSuccess) show(importStatusSuccess);\n        break;\n      case 'failed':\n        if (importStatusFailed) show(importStatusFailed);\n        break;\n    }\n  }\n\n  /**\n   * Update import status message\n   */\n  private updateImportStatusMessage(message: string): void {\n    const { importStatusMessage } = this.elements;\n    if (importStatusMessage) {\n      importStatusMessage.textContent = message;\n    }\n  }\n\n  /**\n   * Show import error\n   */\n  private showImportError(message: string, errorCode: string): void {\n    this.showImportStatus('failed');\n    const { importErrorMessage, importReconnectLink } = this.elements;\n\n    if (importErrorMessage) {\n      importErrorMessage.textContent = message;\n    }\n\n    // Show reconnect link for auth errors\n    if (importReconnectLink) {\n      if (\n        errorCode === 'GOOGLE_ACCESS_REVOKED' ||\n        errorCode === 'GOOGLE_SCOPE_VIOLATION'\n      ) {\n        const integrationsPath =\n          this.config.routes.integrations || '/admin/esign/integrations/google';\n        importReconnectLink.href = this.applyAccountIdToPath(integrationsPath);\n        show(importReconnectLink);\n      } else {\n        hide(importReconnectLink);\n      }\n    }\n  }\n\n  /**\n   * Start import process\n   */\n  private async startImport(): Promise<void> {\n    const { importDocumentTitle, importBtn, importBtnText, importReconnectLink } =\n      this.elements;\n\n    if (!this.selectedFile || !importDocumentTitle) return;\n\n    const documentTitle = importDocumentTitle.value.trim();\n    if (!documentTitle) {\n      importDocumentTitle.focus();\n      return;\n    }\n\n    if (this.pollTimeout) {\n      clearTimeout(this.pollTimeout);\n      this.pollTimeout = null;\n    }\n    this.pollAttempts = 0;\n\n    // Disable button\n    if (importBtn) importBtn.disabled = true;\n    if (importBtnText) importBtnText.textContent = 'Starting...';\n    if (importReconnectLink) hide(importReconnectLink);\n\n    this.showImportStatus('queued');\n    this.updateImportStatusMessage('Submitting import request...');\n\n    try {\n      const pendingURL = new URL(window.location.href);\n      pendingURL.searchParams.delete('import_run_id');\n      window.history.replaceState({}, '', pendingURL.toString());\n\n      const response = await fetch(\n        this.buildScopedAPIURL('/esign/google-drive/imports').toString(),\n        {\n          method: 'POST',\n          credentials: 'same-origin',\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n          },\n          body: JSON.stringify({\n            google_file_id: this.selectedFile.id,\n            account_id: this.currentAccountId || undefined,\n            document_title: documentTitle,\n          }),\n        }\n      );\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        const errorCode = data.error?.code || '';\n        const message = data.error?.message || 'Failed to start import';\n        throw { message, code: errorCode };\n      }\n\n      this.currentImportRunId = data.import_run_id;\n      this.pollAttempts = 0;\n\n      // Update URL with import_run_id for resume on refresh\n      const url = new URL(window.location.href);\n      if (this.currentImportRunId) {\n        url.searchParams.set('import_run_id', this.currentImportRunId);\n      }\n      window.history.replaceState({}, '', url.toString());\n\n      this.updateImportStatusMessage('Import queued...');\n      this.startPolling();\n    } catch (error) {\n      console.error('Import error:', error);\n      const err = error as { message?: string; code?: string };\n      this.showImportError(err.message || 'Failed to start import', err.code || '');\n      if (importBtn) importBtn.disabled = false;\n      if (importBtnText) importBtnText.textContent = 'Import Document';\n    }\n  }\n\n  /**\n   * Start polling for import status\n   */\n  private startPolling(): void {\n    this.pollTimeout = setTimeout(() => this.pollImportStatus(), POLL_INTERVAL);\n  }\n\n  /**\n   * Poll import status\n   */\n  private async pollImportStatus(): Promise<void> {\n    if (!this.currentImportRunId) return;\n    this.pollTimeout = null;\n\n    this.pollAttempts++;\n\n    if (this.pollAttempts > MAX_POLL_ATTEMPTS) {\n      this.showImportError(\n        'Import is taking too long. Please check the documents list.',\n        ''\n      );\n      return;\n    }\n\n    try {\n      const statusURL = this.buildScopedAPIURL(\n        `/esign/google-drive/imports/${encodeURIComponent(this.currentImportRunId)}`\n      ).toString();\n\n      const response = await fetch(statusURL, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error?.message || 'Failed to check import status');\n      }\n\n      const status = data.status;\n\n      switch (status) {\n        case 'queued':\n          this.updateImportStatusMessage('Waiting in queue...');\n          this.startPolling();\n          break;\n        case 'running':\n          this.updateImportStatusMessage('Importing document...');\n          this.startPolling();\n          break;\n        case 'succeeded':\n          this.showImportStatus('succeeded');\n          announce('Import complete');\n          // Redirect to created agreement when available; otherwise document\n          setTimeout(() => {\n            if (data.agreement?.id && this.config.routes.agreements) {\n              window.location.href = `${this.config.routes.agreements}/${encodeURIComponent(data.agreement.id)}`;\n            } else if (data.document?.id) {\n              window.location.href = `${this.config.routes.index}/${encodeURIComponent(data.document.id)}`;\n            } else {\n              window.location.href = this.config.routes.index;\n            }\n          }, 1500);\n          break;\n        case 'failed': {\n          const errorCode = data.error?.code || '';\n          const message = data.error?.message || 'Import failed';\n          this.showImportError(message, errorCode);\n          announce('Import failed');\n          break;\n        }\n        default:\n          this.startPolling();\n      }\n    } catch (error) {\n      console.error('Poll error:', error);\n      // Continue polling on transient errors\n      if (this.pollAttempts < MAX_POLL_ATTEMPTS) {\n        this.startPolling();\n      } else {\n        this.showImportError('Unable to check import status', '');\n      }\n    }\n  }\n\n  /**\n   * Resume import polling from URL parameter\n   */\n  private resumeImportPolling(importRunId: string): void {\n    this.currentImportRunId = importRunId;\n    this.pollAttempts = 0;\n    this.showImportStatus('queued');\n    this.updateImportStatusMessage('Resuming import status...');\n    this.pollImportStatus();\n  }\n\n  // ============================================================\n  // Utility\n  // ============================================================\n\n  /**\n   * Escape HTML\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n/**\n * Initialize document form page from config\n */\nexport function initDocumentForm(config: DocumentFormConfig): DocumentFormController {\n  const controller = new DocumentFormController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap document form page from template context\n */\nexport function bootstrapDocumentForm(config: {\n  basePath: string;\n  apiBasePath?: string;\n  userId: string;\n  googleEnabled?: boolean;\n  googleConnected?: boolean;\n  googleAccountId?: string;\n  maxFileSize?: number;\n  routes: {\n    index: string;\n    create?: string;\n    agreements?: string;\n    integrations?: string;\n  };\n}): void {\n  const pageConfig: DocumentFormConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api/v1`,\n    userId: config.userId,\n    googleEnabled: config.googleEnabled !== false,\n    googleConnected: config.googleConnected !== false,\n    googleAccountId: config.googleAccountId,\n    maxFileSize: config.maxFileSize,\n    routes: config.routes,\n  };\n\n  const controller = new DocumentFormController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignDocumentFormController =\n      controller;\n  }\n}\n\nfunction coerceDocumentFormConfig(\n  raw: Record<string, unknown>\n): DocumentFormConfig | null {\n  const basePath = String(raw.basePath || raw.base_path || '').trim();\n  const routes =\n    raw.routes && typeof raw.routes === 'object'\n      ? (raw.routes as Record<string, unknown>)\n      : {};\n  const features =\n    raw.features && typeof raw.features === 'object'\n      ? (raw.features as Record<string, unknown>)\n      : {};\n  const context =\n    raw.context && typeof raw.context === 'object'\n      ? (raw.context as Record<string, unknown>)\n      : {};\n  const indexRoute = String(routes.index || '').trim();\n  if (!basePath && !indexRoute) {\n    return null;\n  }\n  return {\n    basePath: basePath || '/admin',\n    apiBasePath: String(raw.apiBasePath || raw.api_base_path || '').trim() || undefined,\n    userId: String(raw.userId || raw.user_id || context.user_id || '').trim(),\n    googleEnabled: Boolean(raw.googleEnabled ?? features.google_enabled),\n    googleConnected: Boolean(raw.googleConnected ?? features.google_connected),\n    googleAccountId: String(\n      raw.googleAccountId || raw.google_account_id || context.google_account_id || ''\n    ).trim(),\n    maxFileSize:\n      typeof raw.maxFileSize === 'number'\n        ? raw.maxFileSize\n        : typeof raw.max_file_size === 'number'\n          ? raw.max_file_size\n          : undefined,\n    routes: {\n      index: indexRoute,\n      create: String(routes.create || '').trim() || undefined,\n      agreements: String(routes.agreements || '').trim() || undefined,\n      integrations: String(routes.integrations || '').trim() || undefined,\n    },\n  };\n}\n\n// Auto-init if page marker is present\nif (typeof document !== 'undefined') {\n  onReady(() => {\n    const pageEl = document.querySelector(\n      '[data-esign-page=\"admin.documents.ingestion\"], [data-esign-page=\"document-form\"]'\n    );\n    if (pageEl) {\n      const configScript = document.getElementById('esign-page-config');\n      if (configScript) {\n        try {\n          const rawConfig = JSON.parse(\n            configScript.textContent || '{}'\n          ) as Record<string, unknown>;\n          const config = coerceDocumentFormConfig(rawConfig);\n          if (config) {\n            const controller = new DocumentFormController(config);\n            controller.init();\n          }\n        } catch (e) {\n          console.warn('Failed to parse document form page config:', e);\n        }\n      }\n    }\n  });\n}\n","/**\n * E-Sign Agreement Form Page Controller\n * Handles the 6-step wizard for creating/editing agreements\n *\n * Wizard Steps:\n * 1. Document Selection\n * 2. Agreement Details\n * 3. Participants (Recipients)\n * 4. Field Definitions\n * 5. Field Placement\n * 6. Review & Send\n */\n\nimport { qs, qsa, show, hide, onReady, announce } from '../utils/dom-helpers.js';\nimport { debounce } from '../utils/async-helpers.js';\nimport { formatDateTime, formatFileSize } from '../utils/formatters.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface AgreementFormConfig {\n  basePath: string;\n  apiBasePath?: string;\n  isEditMode: boolean;\n  createSuccess?: boolean;\n  agreementId?: string;\n  routes: {\n    index: string;\n    documents?: string;\n    create?: string;\n  };\n}\n\ninterface WizardSessionState {\n  wizardId: string;\n  version: number;\n  createdAt: string;\n  updatedAt: string;\n  currentStep: number;\n  document: {\n    id: string | null;\n    title: string | null;\n    pageCount: number | null;\n  };\n  details: {\n    title: string;\n    message: string;\n  };\n  participants: Participant[];\n  fieldDefinitions: FieldDefinition[];\n  fieldPlacements: FieldPlacement[];\n  serverDraftId: string | null;\n  serverRevision: number;\n  lastSyncedAt: string | null;\n  syncPending: boolean;\n}\n\ninterface Participant {\n  tempId: string;\n  name: string;\n  email: string;\n  role: 'signer' | 'viewer' | 'approver';\n  order: number;\n}\n\ninterface FieldDefinition {\n  id: string;\n  tempId: string;\n  type: string;\n  participantTempId: string;\n  page: number;\n  required: boolean;\n}\n\ninterface FieldPlacement {\n  fieldId: string;\n  page: number;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nconst WIZARD_STATE_VERSION = 1;\nconst WIZARD_STORAGE_KEY = 'esign_wizard_state_v1';\nconst WIZARD_CHANNEL_NAME = 'esign_wizard_sync';\nconst SYNC_DEBOUNCE_MS = 2000;\nconst SYNC_RETRY_DELAYS = [1000, 2000, 5000, 10000, 30000];\n\n// =============================================================================\n// WizardStateManager\n// =============================================================================\n\nclass WizardStateManager {\n  private state: WizardSessionState;\n  private listeners: Array<(state: WizardSessionState) => void> = [];\n  private broadcastChannel: BroadcastChannel | null = null;\n\n  constructor() {\n    this.state = this.loadFromSession() || this.createInitialState();\n    this.setupBroadcastChannel();\n  }\n\n  private createInitialState(): WizardSessionState {\n    return {\n      wizardId: this.generateWizardId(),\n      version: WIZARD_STATE_VERSION,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n      currentStep: 1,\n      document: { id: null, title: null, pageCount: null },\n      details: { title: '', message: '' },\n      participants: [],\n      fieldDefinitions: [],\n      fieldPlacements: [],\n      serverDraftId: null,\n      serverRevision: 0,\n      lastSyncedAt: null,\n      syncPending: false,\n    };\n  }\n\n  private generateWizardId(): string {\n    return `wizard_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private loadFromSession(): WizardSessionState | null {\n    try {\n      const stored = sessionStorage.getItem(WIZARD_STORAGE_KEY);\n      if (!stored) return null;\n\n      const state = JSON.parse(stored) as WizardSessionState;\n\n      // Schema version check\n      if (state.version !== WIZARD_STATE_VERSION) {\n        console.warn('Wizard state version mismatch, migrating...');\n        return this.migrateState(state);\n      }\n\n      return state;\n    } catch (error) {\n      console.warn('Failed to load wizard state from session:', error);\n      return null;\n    }\n  }\n\n  private migrateState(oldState: WizardSessionState): WizardSessionState {\n    // For now, just create a new state if version doesn't match\n    return this.createInitialState();\n  }\n\n  private saveToSession(): void {\n    try {\n      this.state.updatedAt = new Date().toISOString();\n      sessionStorage.setItem(WIZARD_STORAGE_KEY, JSON.stringify(this.state));\n    } catch (error) {\n      console.warn('Failed to save wizard state to session:', error);\n    }\n  }\n\n  private setupBroadcastChannel(): void {\n    if (typeof BroadcastChannel === 'undefined') return;\n\n    try {\n      this.broadcastChannel = new BroadcastChannel(WIZARD_CHANNEL_NAME);\n      this.broadcastChannel.onmessage = (event) => {\n        if (event.data?.type === 'state_update' && event.data.wizardId === this.state.wizardId) {\n          // Another tab updated the state\n          this.handleExternalUpdate(event.data.state);\n        }\n      };\n    } catch (error) {\n      console.debug('BroadcastChannel not available:', error);\n    }\n  }\n\n  private handleExternalUpdate(externalState: WizardSessionState): void {\n    // Merge or handle conflict\n    if (externalState.updatedAt > this.state.updatedAt) {\n      this.state = externalState;\n      this.notifyListeners();\n    }\n  }\n\n  private notifyListeners(): void {\n    for (const listener of this.listeners) {\n      listener(this.state);\n    }\n  }\n\n  private broadcastStateUpdate(): void {\n    if (!this.broadcastChannel) return;\n\n    try {\n      this.broadcastChannel.postMessage({\n        type: 'state_update',\n        wizardId: this.state.wizardId,\n        state: this.state,\n      });\n    } catch (error) {\n      console.debug('Failed to broadcast state update:', error);\n    }\n  }\n\n  getState(): WizardSessionState {\n    return this.state;\n  }\n\n  updateState(updates: Partial<WizardSessionState>): void {\n    this.state = { ...this.state, ...updates, syncPending: true };\n    this.saveToSession();\n    this.broadcastStateUpdate();\n    this.notifyListeners();\n  }\n\n  updateDocument(document: WizardSessionState['document']): void {\n    this.state.document = document;\n    this.saveToSession();\n    this.broadcastStateUpdate();\n    this.notifyListeners();\n  }\n\n  updateDetails(details: WizardSessionState['details']): void {\n    this.state.details = details;\n    this.saveToSession();\n    this.broadcastStateUpdate();\n    this.notifyListeners();\n  }\n\n  updateParticipants(participants: Participant[]): void {\n    this.state.participants = participants;\n    this.saveToSession();\n    this.broadcastStateUpdate();\n    this.notifyListeners();\n  }\n\n  updateFieldDefinitions(fieldDefinitions: FieldDefinition[]): void {\n    this.state.fieldDefinitions = fieldDefinitions;\n    this.saveToSession();\n    this.broadcastStateUpdate();\n    this.notifyListeners();\n  }\n\n  updateFieldPlacements(fieldPlacements: FieldPlacement[]): void {\n    this.state.fieldPlacements = fieldPlacements;\n    this.saveToSession();\n    this.broadcastStateUpdate();\n    this.notifyListeners();\n  }\n\n  setCurrentStep(step: number): void {\n    this.state.currentStep = step;\n    this.saveToSession();\n    this.broadcastStateUpdate();\n    this.notifyListeners();\n  }\n\n  markSynced(serverDraftId: string, revision: number): void {\n    this.state.serverDraftId = serverDraftId;\n    this.state.serverRevision = revision;\n    this.state.lastSyncedAt = new Date().toISOString();\n    this.state.syncPending = false;\n    this.saveToSession();\n  }\n\n  subscribe(listener: (state: WizardSessionState) => void): () => void {\n    this.listeners.push(listener);\n    return () => {\n      const index = this.listeners.indexOf(listener);\n      if (index !== -1) this.listeners.splice(index, 1);\n    };\n  }\n\n  reset(): void {\n    this.state = this.createInitialState();\n    this.saveToSession();\n    this.notifyListeners();\n  }\n\n  clearSession(): void {\n    try {\n      sessionStorage.removeItem(WIZARD_STORAGE_KEY);\n    } catch (error) {\n      console.warn('Failed to clear wizard session:', error);\n    }\n    this.state = this.createInitialState();\n    this.notifyListeners();\n  }\n\n  hasSavedProgress(): boolean {\n    const saved = this.loadFromSession();\n    return saved !== null && saved.currentStep > 1;\n  }\n\n  getSavedSummary(): { title: string; step: number; updatedAt: string } | null {\n    const saved = this.loadFromSession();\n    if (!saved) return null;\n\n    return {\n      title: saved.details.title || 'Untitled Agreement',\n      step: saved.currentStep,\n      updatedAt: saved.updatedAt,\n    };\n  }\n\n  destroy(): void {\n    if (this.broadcastChannel) {\n      this.broadcastChannel.close();\n      this.broadcastChannel = null;\n    }\n    this.listeners = [];\n  }\n}\n\n// =============================================================================\n// ServerSyncManager\n// =============================================================================\n\nclass ServerSyncManager {\n  private stateManager: WizardStateManager;\n  private apiBase: string;\n  private syncTimeout: ReturnType<typeof setTimeout> | null = null;\n  private retryCount = 0;\n  private isSyncing = false;\n  private onStatusChange: (status: 'syncing' | 'synced' | 'error' | 'conflict') => void;\n  private onConflict: (localTime: string, serverTime: string, serverRevision: number) => void;\n\n  constructor(\n    stateManager: WizardStateManager,\n    apiBase: string,\n    onStatusChange: (status: 'syncing' | 'synced' | 'error' | 'conflict') => void,\n    onConflict: (localTime: string, serverTime: string, serverRevision: number) => void\n  ) {\n    this.stateManager = stateManager;\n    this.apiBase = apiBase;\n    this.onStatusChange = onStatusChange;\n    this.onConflict = onConflict;\n  }\n\n  scheduleSave(): void {\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n    }\n    this.syncTimeout = setTimeout(() => this.syncToServer(), SYNC_DEBOUNCE_MS);\n  }\n\n  async syncToServer(): Promise<void> {\n    if (this.isSyncing) return;\n\n    const state = this.stateManager.getState();\n    if (!state.syncPending) return;\n\n    this.isSyncing = true;\n    this.onStatusChange('syncing');\n\n    try {\n      const payload = this.buildDraftPayload(state);\n      const method = state.serverDraftId ? 'PUT' : 'POST';\n      const url = state.serverDraftId\n        ? `${this.apiBase}/esign/drafts/${state.serverDraftId}`\n        : `${this.apiBase}/esign/drafts`;\n\n      const response = await fetch(url, {\n        method,\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n          ...(state.serverDraftId ? { 'If-Match': String(state.serverRevision) } : {}),\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (response.status === 409) {\n        // Conflict\n        const data = await response.json();\n        this.onStatusChange('conflict');\n        this.onConflict(state.updatedAt, data.server_updated_at || '', data.revision || 0);\n        return;\n      }\n\n      if (!response.ok) {\n        throw new Error(`Sync failed: ${response.status}`);\n      }\n\n      const data = await response.json();\n      this.stateManager.markSynced(data.id || data.draft_id, data.revision || 1);\n      this.retryCount = 0;\n      this.onStatusChange('synced');\n    } catch (error) {\n      console.error('Server sync error:', error);\n      this.onStatusChange('error');\n      this.scheduleRetry();\n    } finally {\n      this.isSyncing = false;\n    }\n  }\n\n  private scheduleRetry(): void {\n    if (this.retryCount >= SYNC_RETRY_DELAYS.length) {\n      console.warn('Max sync retries reached');\n      return;\n    }\n\n    const delay = SYNC_RETRY_DELAYS[this.retryCount];\n    this.retryCount++;\n\n    setTimeout(() => this.syncToServer(), delay);\n  }\n\n  private buildDraftPayload(state: WizardSessionState): Record<string, unknown> {\n    return {\n      wizard_id: state.wizardId,\n      current_step: state.currentStep,\n      document_id: state.document.id,\n      title: state.details.title,\n      message: state.details.message,\n      participants: state.participants,\n      field_definitions: state.fieldDefinitions,\n      field_placements: state.fieldPlacements,\n    };\n  }\n\n  async forceOverwrite(): Promise<void> {\n    const state = this.stateManager.getState();\n    this.stateManager.updateState({ serverRevision: 0, syncPending: true });\n    await this.syncToServer();\n  }\n\n  async loadServerVersion(): Promise<void> {\n    const state = this.stateManager.getState();\n    if (!state.serverDraftId) return;\n\n    try {\n      const response = await fetch(`${this.apiBase}/esign/drafts/${state.serverDraftId}`, {\n        credentials: 'same-origin',\n        headers: { Accept: 'application/json' },\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to load draft: ${response.status}`);\n      }\n\n      const data = await response.json();\n      // Update state from server\n      this.stateManager.updateState({\n        document: {\n          id: data.document_id,\n          title: data.document_title,\n          pageCount: data.document_page_count,\n        },\n        details: {\n          title: data.title || '',\n          message: data.message || '',\n        },\n        participants: data.participants || [],\n        fieldDefinitions: data.field_definitions || [],\n        fieldPlacements: data.field_placements || [],\n        serverRevision: data.revision || 0,\n        syncPending: false,\n      });\n      this.onStatusChange('synced');\n    } catch (error) {\n      console.error('Failed to load server version:', error);\n      this.onStatusChange('error');\n    }\n  }\n\n  destroy(): void {\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n      this.syncTimeout = null;\n    }\n  }\n}\n\n// =============================================================================\n// AgreementFormController\n// =============================================================================\n\nexport class AgreementFormController {\n  private readonly config: AgreementFormConfig;\n  private readonly apiBase: string;\n  private stateManager: WizardStateManager;\n  private syncManager: ServerSyncManager;\n  private currentStep = 1;\n\n  private readonly elements: {\n    // Navigation\n    wizardSteps: HTMLElement[];\n    prevBtn: HTMLElement | null;\n    nextBtn: HTMLElement | null;\n    submitBtn: HTMLElement | null;\n    // Sync status\n    syncStatusIndicator: HTMLElement | null;\n    syncStatusIcon: HTMLElement | null;\n    syncStatusText: HTMLElement | null;\n    syncRetryBtn: HTMLElement | null;\n    // Step panels\n    stepPanels: HTMLElement[];\n    // Resume dialog\n    resumeDialogModal: HTMLElement | null;\n    resumeDraftTitle: HTMLElement | null;\n    resumeDraftStep: HTMLElement | null;\n    resumeDraftTime: HTMLElement | null;\n    resumeContinueBtn: HTMLElement | null;\n    resumeNewBtn: HTMLElement | null;\n    resumeDiscardBtn: HTMLElement | null;\n    // Conflict dialog\n    conflictDialogModal: HTMLElement | null;\n    conflictLocalTime: HTMLElement | null;\n    conflictServerTime: HTMLElement | null;\n    conflictServerRevision: HTMLElement | null;\n    conflictReloadBtn: HTMLElement | null;\n    conflictForceBtn: HTMLElement | null;\n    conflictDismissBtn: HTMLElement | null;\n    // Step 1: Document\n    documentSearch: HTMLInputElement | null;\n    documentList: HTMLElement | null;\n    selectedDocumentDisplay: HTMLElement | null;\n    // Step 2: Details\n    titleInput: HTMLInputElement | null;\n    messageInput: HTMLTextAreaElement | null;\n    // Step 3: Participants\n    participantsList: HTMLElement | null;\n    addParticipantBtn: HTMLElement | null;\n    // Step 4: Field definitions\n    fieldDefinitionsList: HTMLElement | null;\n    addFieldBtn: HTMLElement | null;\n    // Step 5: Field placements\n    pdfViewer: HTMLElement | null;\n    fieldPalette: HTMLElement | null;\n    // Form\n    form: HTMLFormElement | null;\n    announcements: HTMLElement | null;\n  };\n\n  constructor(config: AgreementFormConfig) {\n    this.config = config;\n    this.apiBase = config.apiBasePath || `${config.basePath}/api/v1`;\n    this.stateManager = new WizardStateManager();\n    this.syncManager = new ServerSyncManager(\n      this.stateManager,\n      this.apiBase,\n      (status) => this.updateSyncStatusUI(status),\n      (localTime, serverTime, serverRevision) =>\n        this.showConflictDialog(localTime, serverTime, serverRevision)\n    );\n\n    this.elements = {\n      // Navigation\n      wizardSteps: qsa<HTMLElement>('.wizard-step'),\n      prevBtn: qs('#prev-btn'),\n      nextBtn: qs('#next-btn'),\n      submitBtn: qs('#submit-btn'),\n      // Sync status\n      syncStatusIndicator: qs('#sync-status-indicator'),\n      syncStatusIcon: qs('#sync-status-icon'),\n      syncStatusText: qs('#sync-status-text'),\n      syncRetryBtn: qs('#sync-retry-btn'),\n      // Step panels\n      stepPanels: qsa<HTMLElement>('.step-panel'),\n      // Resume dialog\n      resumeDialogModal: qs('#resume-dialog-modal'),\n      resumeDraftTitle: qs('#resume-draft-title'),\n      resumeDraftStep: qs('#resume-draft-step'),\n      resumeDraftTime: qs('#resume-draft-time'),\n      resumeContinueBtn: qs('#resume-continue-btn'),\n      resumeNewBtn: qs('#resume-new-btn'),\n      resumeDiscardBtn: qs('#resume-discard-btn'),\n      // Conflict dialog\n      conflictDialogModal: qs('#conflict-dialog-modal'),\n      conflictLocalTime: qs('#conflict-local-time'),\n      conflictServerTime: qs('#conflict-server-time'),\n      conflictServerRevision: qs('#conflict-server-revision'),\n      conflictReloadBtn: qs('#conflict-reload-btn'),\n      conflictForceBtn: qs('#conflict-force-btn'),\n      conflictDismissBtn: qs('#conflict-dismiss-btn'),\n      // Step 1\n      documentSearch: qs<HTMLInputElement>('#document-search'),\n      documentList: qs('#document-list'),\n      selectedDocumentDisplay: qs('#selected-document-display'),\n      // Step 2\n      titleInput: qs<HTMLInputElement>('#agreement-title'),\n      messageInput: qs<HTMLTextAreaElement>('#agreement-message'),\n      // Step 3\n      participantsList: qs('#participants-list'),\n      addParticipantBtn: qs('#add-participant-btn'),\n      // Step 4\n      fieldDefinitionsList: qs('#field-definitions-list'),\n      addFieldBtn: qs('#add-field-btn'),\n      // Step 5\n      pdfViewer: qs('#pdf-viewer'),\n      fieldPalette: qs('#field-palette'),\n      // Form\n      form: qs<HTMLFormElement>('#agreement-form'),\n      announcements: qs('#agreement-announcements'),\n    };\n  }\n\n  async init(): Promise<void> {\n    this.setupEventListeners();\n    this.checkForSavedProgress();\n\n    // Subscribe to state changes\n    this.stateManager.subscribe(() => {\n      this.syncManager.scheduleSave();\n    });\n\n    // Restore state if in edit mode or resuming\n    const state = this.stateManager.getState();\n    if (state.currentStep > 1) {\n      this.currentStep = state.currentStep;\n    }\n\n    this.updateWizardUI();\n\n    // Hide sync indicator in edit mode until changes are made\n    if (this.config.isEditMode) {\n      if (this.elements.syncStatusIndicator) {\n        hide(this.elements.syncStatusIndicator);\n      }\n    }\n  }\n\n  private setupEventListeners(): void {\n    // Navigation buttons\n    if (this.elements.prevBtn) {\n      this.elements.prevBtn.addEventListener('click', () => this.goToPreviousStep());\n    }\n    if (this.elements.nextBtn) {\n      this.elements.nextBtn.addEventListener('click', () => this.goToNextStep());\n    }\n\n    // Wizard step clicks\n    this.elements.wizardSteps.forEach((step, index) => {\n      step.addEventListener('click', () => {\n        if (this.canNavigateToStep(index + 1)) {\n          this.goToStep(index + 1);\n        }\n      });\n    });\n\n    // Sync retry\n    if (this.elements.syncRetryBtn) {\n      this.elements.syncRetryBtn.addEventListener('click', () => {\n        this.syncManager.syncToServer();\n      });\n    }\n\n    // Resume dialog\n    if (this.elements.resumeContinueBtn) {\n      this.elements.resumeContinueBtn.addEventListener('click', () => {\n        this.resumeSavedProgress();\n      });\n    }\n    if (this.elements.resumeNewBtn) {\n      this.elements.resumeNewBtn.addEventListener('click', () => {\n        this.stateManager.reset();\n        this.hideResumeDialog();\n        this.currentStep = 1;\n        this.updateWizardUI();\n      });\n    }\n    if (this.elements.resumeDiscardBtn) {\n      this.elements.resumeDiscardBtn.addEventListener('click', () => {\n        this.stateManager.clearSession();\n        this.hideResumeDialog();\n      });\n    }\n\n    // Conflict dialog\n    if (this.elements.conflictReloadBtn) {\n      this.elements.conflictReloadBtn.addEventListener('click', async () => {\n        await this.syncManager.loadServerVersion();\n        this.hideConflictDialog();\n        this.updateWizardUI();\n      });\n    }\n    if (this.elements.conflictForceBtn) {\n      this.elements.conflictForceBtn.addEventListener('click', async () => {\n        await this.syncManager.forceOverwrite();\n        this.hideConflictDialog();\n      });\n    }\n    if (this.elements.conflictDismissBtn) {\n      this.elements.conflictDismissBtn.addEventListener('click', () => {\n        this.hideConflictDialog();\n      });\n    }\n\n    // Step 2: Details inputs\n    if (this.elements.titleInput) {\n      this.elements.titleInput.addEventListener(\n        'input',\n        debounce(() => this.handleDetailsChange(), 300)\n      );\n    }\n    if (this.elements.messageInput) {\n      this.elements.messageInput.addEventListener(\n        'input',\n        debounce(() => this.handleDetailsChange(), 300)\n      );\n    }\n\n    // Form submission\n    if (this.elements.form) {\n      this.elements.form.addEventListener('submit', (e) => this.handleFormSubmit(e));\n    }\n  }\n\n  private checkForSavedProgress(): void {\n    if (this.config.isEditMode) return; // Don't show resume dialog in edit mode\n\n    const summary = this.stateManager.getSavedSummary();\n    if (summary && summary.step > 1) {\n      this.showResumeDialog(summary);\n    }\n  }\n\n  private showResumeDialog(summary: { title: string; step: number; updatedAt: string }): void {\n    const { resumeDialogModal, resumeDraftTitle, resumeDraftStep, resumeDraftTime } = this.elements;\n\n    if (resumeDraftTitle) resumeDraftTitle.textContent = summary.title;\n    if (resumeDraftStep) resumeDraftStep.textContent = String(summary.step);\n    if (resumeDraftTime) resumeDraftTime.textContent = formatDateTime(summary.updatedAt);\n\n    if (resumeDialogModal) show(resumeDialogModal);\n  }\n\n  private hideResumeDialog(): void {\n    if (this.elements.resumeDialogModal) hide(this.elements.resumeDialogModal);\n  }\n\n  private resumeSavedProgress(): void {\n    const state = this.stateManager.getState();\n    this.currentStep = state.currentStep;\n    this.restoreStateToUI();\n    this.hideResumeDialog();\n    this.updateWizardUI();\n  }\n\n  private restoreStateToUI(): void {\n    const state = this.stateManager.getState();\n\n    // Restore step 2 details\n    if (this.elements.titleInput) {\n      this.elements.titleInput.value = state.details.title;\n    }\n    if (this.elements.messageInput) {\n      this.elements.messageInput.value = state.details.message;\n    }\n\n    // Other steps would restore their state here...\n    // This would be extended to restore participants, field definitions, etc.\n  }\n\n  private showConflictDialog(localTime: string, serverTime: string, serverRevision: number): void {\n    const { conflictDialogModal, conflictLocalTime, conflictServerTime, conflictServerRevision } =\n      this.elements;\n\n    if (conflictLocalTime) conflictLocalTime.textContent = formatDateTime(localTime);\n    if (conflictServerTime) conflictServerTime.textContent = formatDateTime(serverTime);\n    if (conflictServerRevision) conflictServerRevision.textContent = String(serverRevision);\n\n    if (conflictDialogModal) show(conflictDialogModal);\n  }\n\n  private hideConflictDialog(): void {\n    if (this.elements.conflictDialogModal) hide(this.elements.conflictDialogModal);\n  }\n\n  private updateSyncStatusUI(status: 'syncing' | 'synced' | 'error' | 'conflict'): void {\n    const { syncStatusIndicator, syncStatusIcon, syncStatusText, syncRetryBtn } = this.elements;\n\n    if (!syncStatusIndicator || !syncStatusIcon || !syncStatusText) return;\n\n    show(syncStatusIndicator);\n\n    switch (status) {\n      case 'syncing':\n        syncStatusIcon.className = 'w-2 h-2 rounded-full bg-blue-500 animate-pulse';\n        syncStatusText.textContent = 'Saving...';\n        if (syncRetryBtn) hide(syncRetryBtn);\n        break;\n      case 'synced':\n        syncStatusIcon.className = 'w-2 h-2 rounded-full bg-green-500';\n        syncStatusText.textContent = 'Saved';\n        if (syncRetryBtn) hide(syncRetryBtn);\n        break;\n      case 'error':\n        syncStatusIcon.className = 'w-2 h-2 rounded-full bg-red-500';\n        syncStatusText.textContent = 'Save failed';\n        if (syncRetryBtn) show(syncRetryBtn);\n        break;\n      case 'conflict':\n        syncStatusIcon.className = 'w-2 h-2 rounded-full bg-amber-500';\n        syncStatusText.textContent = 'Conflict';\n        if (syncRetryBtn) hide(syncRetryBtn);\n        break;\n    }\n  }\n\n  private handleDetailsChange(): void {\n    const title = this.elements.titleInput?.value || '';\n    const message = this.elements.messageInput?.value || '';\n\n    this.stateManager.updateDetails({ title, message });\n  }\n\n  private canNavigateToStep(step: number): boolean {\n    // Can always go back\n    if (step < this.currentStep) return true;\n\n    // Check if current step is complete before allowing forward navigation\n    // This would have more complex validation per step\n    return step <= this.currentStep + 1;\n  }\n\n  private goToStep(step: number): void {\n    if (step < 1 || step > 6) return;\n    if (!this.canNavigateToStep(step)) return;\n\n    this.currentStep = step;\n    this.stateManager.setCurrentStep(step);\n    this.updateWizardUI();\n    announce(`Step ${step} of 6`);\n  }\n\n  private goToNextStep(): void {\n    if (this.currentStep < 6) {\n      this.goToStep(this.currentStep + 1);\n    }\n  }\n\n  private goToPreviousStep(): void {\n    if (this.currentStep > 1) {\n      this.goToStep(this.currentStep - 1);\n    }\n  }\n\n  private updateWizardUI(): void {\n    // Update step indicators\n    this.elements.wizardSteps.forEach((step, index) => {\n      const stepNum = index + 1;\n      const isActive = stepNum === this.currentStep;\n      const isComplete = stepNum < this.currentStep;\n\n      step.classList.toggle('active', isActive);\n      step.classList.toggle('completed', isComplete);\n      step.setAttribute('aria-current', isActive ? 'step' : 'false');\n    });\n\n    // Update step panels\n    this.elements.stepPanels.forEach((panel, index) => {\n      const stepNum = index + 1;\n      if (stepNum === this.currentStep) {\n        show(panel);\n      } else {\n        hide(panel);\n      }\n    });\n\n    // Update navigation buttons\n    if (this.elements.prevBtn) {\n      if (this.currentStep === 1) {\n        hide(this.elements.prevBtn);\n      } else {\n        show(this.elements.prevBtn);\n      }\n    }\n\n    if (this.elements.nextBtn) {\n      if (this.currentStep === 6) {\n        hide(this.elements.nextBtn);\n      } else {\n        show(this.elements.nextBtn);\n      }\n    }\n\n    if (this.elements.submitBtn) {\n      if (this.currentStep === 6) {\n        show(this.elements.submitBtn);\n      } else {\n        hide(this.elements.submitBtn);\n      }\n    }\n  }\n\n  private async handleFormSubmit(e: Event): Promise<void> {\n    e.preventDefault();\n\n    // Final validation and submission logic would go here\n    const state = this.stateManager.getState();\n\n    try {\n      const response = await fetch(`${this.apiBase}/esign/agreements`, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n        body: JSON.stringify({\n          document_id: state.document.id,\n          title: state.details.title,\n          message: state.details.message,\n          participants: state.participants,\n          field_definitions: state.fieldDefinitions,\n          field_placements: state.fieldPlacements,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error?.message || 'Failed to create agreement');\n      }\n\n      const data = await response.json();\n\n      // Clear wizard state on successful submission\n      this.stateManager.clearSession();\n\n      // Redirect to agreement detail or list\n      if (data.id) {\n        window.location.href = `${this.config.routes.index}/${data.id}`;\n      } else {\n        window.location.href = this.config.routes.index;\n      }\n    } catch (error) {\n      console.error('Agreement submission error:', error);\n      announce(`Error: ${error instanceof Error ? error.message : 'Submission failed'}`);\n    }\n  }\n\n  destroy(): void {\n    this.stateManager.destroy();\n    this.syncManager.destroy();\n  }\n}\n\n// =============================================================================\n// Initialization\n// =============================================================================\n\nexport function initAgreementForm(config: AgreementFormConfig): AgreementFormController {\n  const controller = new AgreementFormController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\nexport function bootstrapAgreementForm(config: {\n  basePath: string;\n  apiBasePath?: string;\n  isEditMode?: boolean;\n  createSuccess?: boolean;\n  agreementId?: string;\n  routes: {\n    index: string;\n    documents?: string;\n    create?: string;\n  };\n}): void {\n  const pageConfig: AgreementFormConfig = {\n    basePath: config.basePath,\n    apiBasePath: config.apiBasePath || `${config.basePath}/api/v1`,\n    isEditMode: config.isEditMode || false,\n    createSuccess: config.createSuccess,\n    agreementId: config.agreementId,\n    routes: config.routes,\n  };\n\n  const controller = new AgreementFormController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignAgreementFormController = controller;\n  }\n}\n\n// Auto-init if page marker is present\nif (typeof document !== 'undefined') {\n  onReady(() => {\n    const pageEl = document.querySelector('[data-esign-page=\"agreement-form\"]');\n    if (pageEl) {\n      const configScript = document.getElementById('esign-page-config');\n      if (configScript) {\n        try {\n          const config = JSON.parse(configScript.textContent || '{}');\n          if (config.basePath || config.routes?.index) {\n            const controller = new AgreementFormController({\n              basePath: config.base_path || config.basePath || '',\n              apiBasePath: config.api_base_path || config.apiBasePath,\n              isEditMode: config.is_edit || config.isEditMode || false,\n              createSuccess: config.create_success || config.createSuccess,\n              routes: config.routes || { index: '' },\n            });\n            controller.init();\n          }\n        } catch (e) {\n          console.warn('Failed to parse agreement form page config:', e);\n        }\n      }\n    }\n  });\n}\n","/**\n * E-Sign Signer Review Page Controller\n * Handles document viewing, field interactions, and signing flow\n *\n * Features:\n * - PDF document rendering via PDF.js\n * - Field overlays with accessibility support\n * - Signature capture (typed, drawn, uploaded)\n * - Consent/decline workflows\n * - Client-side telemetry\n * - Multi-signer stage support\n */\n\nimport { qs, qsa, show, hide, onReady, announce } from '../utils/dom-helpers.js';\nimport { debounce, throttle } from '../utils/async-helpers.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface SignerReviewConfig {\n  token: string;\n  apiBasePath: string;\n  signerBasePath: string;\n  agreementId: string;\n  recipientId: string;\n  documentUrl: string;\n  pageCount: number;\n  hasConsented: boolean;\n  fields: SignerField[];\n  flowMode: 'unified' | 'legacy';\n  telemetryEnabled: boolean;\n  viewer: ViewerConfig;\n  signerState: 'active' | 'waiting' | 'completed' | 'declined';\n  recipientStage: number;\n  activeStage: number;\n  activeRecipientIds: string[];\n  waitingForRecipientIds: string[];\n}\n\ninterface ViewerConfig {\n  coordinateSpace: 'pdf' | 'screen';\n  contractVersion: string;\n  unit: 'pt' | 'px';\n  origin: 'top-left' | 'bottom-left';\n  yAxisDirection: 'down' | 'up';\n  pages: PageConfig[];\n}\n\ninterface PageConfig {\n  pageNumber: number;\n  width: number;\n  height: number;\n}\n\ninterface SignerField {\n  id: string;\n  type: 'signature' | 'initials' | 'date' | 'text' | 'checkbox';\n  page: number;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  required: boolean;\n  recipientId: string;\n  value?: string;\n  completed?: boolean;\n}\n\ninterface TelemetryEvent {\n  type: string;\n  timestamp: number;\n  data?: Record<string, unknown>;\n}\n\n// =============================================================================\n// Telemetry Module\n// =============================================================================\n\nclass TelemetryManager {\n  private events: TelemetryEvent[] = [];\n  private enabled: boolean;\n  private sessionId: string;\n  private flushInterval: ReturnType<typeof setInterval> | null = null;\n  private apiBasePath: string;\n  private token: string;\n\n  constructor(config: { enabled: boolean; apiBasePath: string; token: string }) {\n    this.enabled = config.enabled;\n    this.apiBasePath = config.apiBasePath;\n    this.token = config.token;\n    this.sessionId = this.generateSessionId();\n\n    if (this.enabled) {\n      this.startAutoFlush();\n      this.setupBeforeUnload();\n    }\n  }\n\n  private generateSessionId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  track(type: string, data?: Record<string, unknown>): void {\n    if (!this.enabled) return;\n\n    this.events.push({\n      type,\n      timestamp: Date.now(),\n      data,\n    });\n\n    // Auto-flush if buffer is large\n    if (this.events.length >= 50) {\n      this.flush();\n    }\n  }\n\n  private startAutoFlush(): void {\n    this.flushInterval = setInterval(() => this.flush(), 30000);\n  }\n\n  private setupBeforeUnload(): void {\n    window.addEventListener('beforeunload', () => {\n      this.flush(true);\n    });\n  }\n\n  async flush(sync = false): Promise<void> {\n    if (this.events.length === 0) return;\n\n    const eventsToSend = [...this.events];\n    this.events = [];\n\n    const payload = {\n      session_id: this.sessionId,\n      events: eventsToSend,\n    };\n\n    try {\n      if (sync && navigator.sendBeacon) {\n        navigator.sendBeacon(\n          `${this.apiBasePath}/telemetry`,\n          JSON.stringify(payload)\n        );\n      } else {\n        await fetch(`${this.apiBasePath}/telemetry`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${this.token}`,\n          },\n          body: JSON.stringify(payload),\n        });\n      }\n    } catch (error) {\n      console.debug('Telemetry flush failed:', error);\n      // Re-add events on failure\n      this.events = [...eventsToSend, ...this.events];\n    }\n  }\n\n  destroy(): void {\n    if (this.flushInterval) {\n      clearInterval(this.flushInterval);\n      this.flushInterval = null;\n    }\n    this.flush(true);\n  }\n}\n\n// =============================================================================\n// PDF Viewer Module\n// =============================================================================\n\nclass PDFViewerController {\n  private config: SignerReviewConfig;\n  private pdfDoc: unknown = null;\n  private currentPage = 1;\n  private scale = 1.0;\n  private minScale = 0.5;\n  private maxScale = 3.0;\n  private onPageChange: (page: number) => void;\n  private onScaleChange: (scale: number) => void;\n\n  // Elements\n  private container: HTMLElement | null;\n  private canvas: HTMLCanvasElement | null;\n  private pageIndicator: HTMLElement | null;\n\n  constructor(\n    config: SignerReviewConfig,\n    container: HTMLElement | null,\n    onPageChange: (page: number) => void,\n    onScaleChange: (scale: number) => void\n  ) {\n    this.config = config;\n    this.container = container;\n    this.canvas = qs<HTMLCanvasElement>('#pdf-canvas', container ?? undefined);\n    this.pageIndicator = qs('#page-indicator', container ?? undefined);\n    this.onPageChange = onPageChange;\n    this.onScaleChange = onScaleChange;\n  }\n\n  async loadDocument(): Promise<void> {\n    if (!this.config.documentUrl) {\n      console.error('No document URL provided');\n      return;\n    }\n\n    try {\n      // PDF.js loading would happen here\n      // This is a placeholder for the actual implementation\n      console.debug('Loading PDF from:', this.config.documentUrl);\n\n      // The actual PDF.js implementation is in the inline script\n      // This controller provides the foundation for future migration\n    } catch (error) {\n      console.error('Failed to load PDF:', error);\n    }\n  }\n\n  goToPage(page: number): void {\n    if (page < 1 || page > this.config.pageCount) return;\n    this.currentPage = page;\n    this.renderCurrentPage();\n    this.onPageChange(page);\n  }\n\n  nextPage(): void {\n    if (this.currentPage < this.config.pageCount) {\n      this.goToPage(this.currentPage + 1);\n    }\n  }\n\n  prevPage(): void {\n    if (this.currentPage > 1) {\n      this.goToPage(this.currentPage - 1);\n    }\n  }\n\n  zoomIn(): void {\n    const newScale = Math.min(this.scale * 1.2, this.maxScale);\n    this.setScale(newScale);\n  }\n\n  zoomOut(): void {\n    const newScale = Math.max(this.scale / 1.2, this.minScale);\n    this.setScale(newScale);\n  }\n\n  fitToWidth(): void {\n    if (!this.container) return;\n    // Calculate scale to fit width\n    const containerWidth = this.container.clientWidth;\n    // This would need the actual page width from PDF.js\n    // Placeholder implementation\n    this.setScale(1.0);\n  }\n\n  private setScale(scale: number): void {\n    this.scale = scale;\n    this.renderCurrentPage();\n    this.onScaleChange(scale);\n  }\n\n  private renderCurrentPage(): void {\n    // Rendering logic would go here\n    // This is handled by the inline script currently\n    if (this.pageIndicator) {\n      this.pageIndicator.textContent = `Page ${this.currentPage} of ${this.config.pageCount}`;\n    }\n  }\n\n  getCurrentPage(): number {\n    return this.currentPage;\n  }\n\n  getScale(): number {\n    return this.scale;\n  }\n\n  destroy(): void {\n    // Cleanup\n    this.pdfDoc = null;\n  }\n}\n\n// =============================================================================\n// Field Overlay Controller\n// =============================================================================\n\nclass FieldOverlayController {\n  private config: SignerReviewConfig;\n  private fields: Map<string, SignerField> = new Map();\n  private currentFieldIndex = 0;\n  private overlayContainer: HTMLElement | null;\n  private onFieldActivate: (field: SignerField) => void;\n  private onFieldComplete: (field: SignerField, value: string) => void;\n\n  constructor(\n    config: SignerReviewConfig,\n    overlayContainer: HTMLElement | null,\n    onFieldActivate: (field: SignerField) => void,\n    onFieldComplete: (field: SignerField, value: string) => void\n  ) {\n    this.config = config;\n    this.overlayContainer = overlayContainer;\n    this.onFieldActivate = onFieldActivate;\n    this.onFieldComplete = onFieldComplete;\n\n    // Initialize fields map\n    for (const field of config.fields) {\n      this.fields.set(field.id, field);\n    }\n  }\n\n  renderOverlays(page: number, scale: number): void {\n    if (!this.overlayContainer) return;\n\n    // Clear existing overlays for this page\n    const existingOverlays = this.overlayContainer.querySelectorAll(\n      `.field-overlay[data-page=\"${page}\"]`\n    );\n    existingOverlays.forEach((el) => el.remove());\n\n    // Render fields for current page\n    const pageFields = this.config.fields.filter((f) => f.page === page);\n\n    for (const field of pageFields) {\n      const overlay = this.createFieldOverlay(field, scale);\n      this.overlayContainer.appendChild(overlay);\n    }\n  }\n\n  private createFieldOverlay(field: SignerField, scale: number): HTMLElement {\n    const overlay = document.createElement('button');\n    overlay.className = `field-overlay field-overlay-${field.type} ${field.completed ? 'completed' : ''}`;\n    overlay.type = 'button';\n    overlay.dataset.fieldId = field.id;\n    overlay.dataset.page = String(field.page);\n    overlay.setAttribute('role', 'button');\n    overlay.setAttribute(\n      'aria-label',\n      `${field.type} field${field.required ? ' (required)' : ''}`\n    );\n\n    // Position overlay\n    overlay.style.left = `${field.x * scale}px`;\n    overlay.style.top = `${field.y * scale}px`;\n    overlay.style.width = `${field.width * scale}px`;\n    overlay.style.height = `${field.height * scale}px`;\n\n    overlay.addEventListener('click', () => {\n      this.onFieldActivate(field);\n    });\n\n    return overlay;\n  }\n\n  getNextIncompleteField(): SignerField | null {\n    const incomplete = this.config.fields.filter(\n      (f) => !f.completed && f.recipientId === this.config.recipientId\n    );\n    return incomplete[0] || null;\n  }\n\n  getAllFields(): SignerField[] {\n    return this.config.fields;\n  }\n\n  getFieldsForPage(page: number): SignerField[] {\n    return this.config.fields.filter((f) => f.page === page);\n  }\n\n  getCompletionStatus(): { completed: number; total: number; required: number; requiredCompleted: number } {\n    const myFields = this.config.fields.filter(\n      (f) => f.recipientId === this.config.recipientId\n    );\n    const required = myFields.filter((f) => f.required);\n\n    return {\n      completed: myFields.filter((f) => f.completed).length,\n      total: myFields.length,\n      required: required.length,\n      requiredCompleted: required.filter((f) => f.completed).length,\n    };\n  }\n\n  markFieldComplete(fieldId: string, value: string): void {\n    const field = this.fields.get(fieldId);\n    if (field) {\n      field.value = value;\n      field.completed = true;\n      this.onFieldComplete(field, value);\n    }\n  }\n\n  destroy(): void {\n    if (this.overlayContainer) {\n      const overlays = this.overlayContainer.querySelectorAll('.field-overlay');\n      overlays.forEach((el) => el.remove());\n    }\n  }\n}\n\n// =============================================================================\n// SignerReviewController\n// =============================================================================\n\nexport class SignerReviewController {\n  private readonly config: SignerReviewConfig;\n  private telemetry: TelemetryManager;\n  private pdfViewer: PDFViewerController | null = null;\n  private fieldOverlay: FieldOverlayController | null = null;\n\n  private readonly elements: {\n    pdfContainer: HTMLElement | null;\n    overlayContainer: HTMLElement | null;\n    fieldList: HTMLElement | null;\n    progressBar: HTMLElement | null;\n    progressText: HTMLElement | null;\n    consentModal: HTMLElement | null;\n    declineModal: HTMLElement | null;\n    signatureModal: HTMLElement | null;\n    submitBtn: HTMLElement | null;\n    declineBtn: HTMLElement | null;\n    prevPageBtn: HTMLElement | null;\n    nextPageBtn: HTMLElement | null;\n    zoomInBtn: HTMLElement | null;\n    zoomOutBtn: HTMLElement | null;\n    announcements: HTMLElement | null;\n  };\n\n  constructor(config: SignerReviewConfig) {\n    this.config = config;\n    this.telemetry = new TelemetryManager({\n      enabled: config.telemetryEnabled,\n      apiBasePath: config.apiBasePath,\n      token: config.token,\n    });\n\n    this.elements = {\n      pdfContainer: qs('#pdf-container'),\n      overlayContainer: qs('#field-overlays'),\n      fieldList: qs('#field-list'),\n      progressBar: qs('#progress-bar'),\n      progressText: qs('#progress-text'),\n      consentModal: qs('#consent-modal'),\n      declineModal: qs('#decline-modal'),\n      signatureModal: qs('#signature-modal'),\n      submitBtn: qs('#submit-btn'),\n      declineBtn: qs('#decline-btn'),\n      prevPageBtn: qs('#prev-page-btn'),\n      nextPageBtn: qs('#next-page-btn'),\n      zoomInBtn: qs('#zoom-in-btn'),\n      zoomOutBtn: qs('#zoom-out-btn'),\n      announcements: qs('#announcements'),\n    };\n  }\n\n  async init(): Promise<void> {\n    this.telemetry.track('page_load', {\n      agreement_id: this.config.agreementId,\n      recipient_id: this.config.recipientId,\n    });\n\n    // Initialize PDF viewer\n    this.pdfViewer = new PDFViewerController(\n      this.config,\n      this.elements.pdfContainer,\n      (page) => this.handlePageChange(page),\n      (scale) => this.handleScaleChange(scale)\n    );\n\n    // Initialize field overlay controller\n    this.fieldOverlay = new FieldOverlayController(\n      this.config,\n      this.elements.overlayContainer,\n      (field) => this.handleFieldActivate(field),\n      (field, value) => this.handleFieldComplete(field, value)\n    );\n\n    this.setupEventListeners();\n\n    // Show consent modal if needed\n    if (!this.config.hasConsented) {\n      this.showConsentModal();\n    } else {\n      await this.pdfViewer.loadDocument();\n      this.updateProgress();\n    }\n  }\n\n  private setupEventListeners(): void {\n    // Navigation\n    if (this.elements.prevPageBtn) {\n      this.elements.prevPageBtn.addEventListener('click', () => {\n        this.pdfViewer?.prevPage();\n      });\n    }\n\n    if (this.elements.nextPageBtn) {\n      this.elements.nextPageBtn.addEventListener('click', () => {\n        this.pdfViewer?.nextPage();\n      });\n    }\n\n    // Zoom\n    if (this.elements.zoomInBtn) {\n      this.elements.zoomInBtn.addEventListener('click', () => {\n        this.pdfViewer?.zoomIn();\n      });\n    }\n\n    if (this.elements.zoomOutBtn) {\n      this.elements.zoomOutBtn.addEventListener('click', () => {\n        this.pdfViewer?.zoomOut();\n      });\n    }\n\n    // Keyboard navigation\n    document.addEventListener('keydown', (e) => this.handleKeyDown(e));\n  }\n\n  private handleKeyDown(e: KeyboardEvent): void {\n    // Arrow keys for page navigation\n    if (e.key === 'ArrowLeft' && !this.isInInputField(e.target)) {\n      this.pdfViewer?.prevPage();\n    } else if (e.key === 'ArrowRight' && !this.isInInputField(e.target)) {\n      this.pdfViewer?.nextPage();\n    }\n\n    // Escape to close modals\n    if (e.key === 'Escape') {\n      this.hideAllModals();\n    }\n  }\n\n  private isInInputField(target: EventTarget | null): boolean {\n    if (!target) return false;\n    const el = target as HTMLElement;\n    return (\n      el.tagName === 'INPUT' ||\n      el.tagName === 'TEXTAREA' ||\n      el.isContentEditable\n    );\n  }\n\n  private handlePageChange(page: number): void {\n    this.telemetry.track('page_view', { page });\n\n    // Re-render field overlays for new page\n    if (this.fieldOverlay && this.pdfViewer) {\n      this.fieldOverlay.renderOverlays(page, this.pdfViewer.getScale());\n    }\n\n    announce(`Page ${page} of ${this.config.pageCount}`);\n  }\n\n  private handleScaleChange(scale: number): void {\n    // Re-render field overlays at new scale\n    if (this.fieldOverlay && this.pdfViewer) {\n      this.fieldOverlay.renderOverlays(\n        this.pdfViewer.getCurrentPage(),\n        scale\n      );\n    }\n  }\n\n  private handleFieldActivate(field: SignerField): void {\n    this.telemetry.track('field_activate', {\n      field_id: field.id,\n      field_type: field.type,\n    });\n\n    // Show appropriate input modal based on field type\n    switch (field.type) {\n      case 'signature':\n      case 'initials':\n        this.showSignatureModal(field);\n        break;\n      case 'date':\n        this.showDatePicker(field);\n        break;\n      case 'text':\n        this.showTextInput(field);\n        break;\n      case 'checkbox':\n        this.toggleCheckbox(field);\n        break;\n    }\n  }\n\n  private handleFieldComplete(field: SignerField, value: string): void {\n    this.telemetry.track('field_complete', {\n      field_id: field.id,\n      field_type: field.type,\n    });\n\n    this.updateProgress();\n\n    // Check if all required fields are complete\n    const status = this.fieldOverlay?.getCompletionStatus();\n    if (status && status.requiredCompleted === status.required) {\n      this.enableSubmit();\n    }\n  }\n\n  private updateProgress(): void {\n    const status = this.fieldOverlay?.getCompletionStatus();\n    if (!status) return;\n\n    const percentage = status.total > 0\n      ? Math.round((status.completed / status.total) * 100)\n      : 0;\n\n    if (this.elements.progressBar) {\n      this.elements.progressBar.style.width = `${percentage}%`;\n    }\n\n    if (this.elements.progressText) {\n      this.elements.progressText.textContent = `${status.completed} of ${status.total} fields completed`;\n    }\n  }\n\n  private enableSubmit(): void {\n    if (this.elements.submitBtn) {\n      this.elements.submitBtn.removeAttribute('disabled');\n      this.elements.submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');\n    }\n    announce('All required fields completed. You can now submit.');\n  }\n\n  private showConsentModal(): void {\n    if (this.elements.consentModal) {\n      show(this.elements.consentModal);\n    }\n  }\n\n  private showSignatureModal(field: SignerField): void {\n    if (this.elements.signatureModal) {\n      show(this.elements.signatureModal);\n      // Configure modal for field type\n    }\n  }\n\n  private showDatePicker(field: SignerField): void {\n    // Date picker implementation\n  }\n\n  private showTextInput(field: SignerField): void {\n    // Text input implementation\n  }\n\n  private toggleCheckbox(field: SignerField): void {\n    const newValue = field.value === 'true' ? 'false' : 'true';\n    this.fieldOverlay?.markFieldComplete(field.id, newValue);\n  }\n\n  private hideAllModals(): void {\n    if (this.elements.consentModal) hide(this.elements.consentModal);\n    if (this.elements.declineModal) hide(this.elements.declineModal);\n    if (this.elements.signatureModal) hide(this.elements.signatureModal);\n  }\n\n  destroy(): void {\n    this.telemetry.destroy();\n    this.pdfViewer?.destroy();\n    this.fieldOverlay?.destroy();\n  }\n}\n\n// =============================================================================\n// Initialization\n// =============================================================================\n\nexport function initSignerReview(config: SignerReviewConfig): SignerReviewController {\n  const controller = new SignerReviewController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\nexport function bootstrapSignerReview(config: {\n  token: string;\n  apiBasePath?: string;\n  signerBasePath?: string;\n  agreementId: string;\n  recipientId: string;\n  documentUrl: string;\n  pageCount?: number;\n  hasConsented?: boolean;\n  fields?: SignerField[];\n  flowMode?: 'unified' | 'legacy';\n  telemetryEnabled?: boolean;\n  viewer?: Partial<ViewerConfig>;\n  signerState?: 'active' | 'waiting' | 'completed' | 'declined';\n  recipientStage?: number;\n  activeStage?: number;\n  activeRecipientIds?: string[];\n  waitingForRecipientIds?: string[];\n}): void {\n  const pageConfig: SignerReviewConfig = {\n    token: config.token,\n    apiBasePath: config.apiBasePath || '/api/v1/esign/signing',\n    signerBasePath: config.signerBasePath || '/esign/sign',\n    agreementId: config.agreementId,\n    recipientId: config.recipientId,\n    documentUrl: config.documentUrl,\n    pageCount: config.pageCount || 1,\n    hasConsented: config.hasConsented || false,\n    fields: config.fields || [],\n    flowMode: config.flowMode || 'unified',\n    telemetryEnabled: config.telemetryEnabled !== false,\n    viewer: {\n      coordinateSpace: config.viewer?.coordinateSpace || 'pdf',\n      contractVersion: config.viewer?.contractVersion || '1.0',\n      unit: config.viewer?.unit || 'pt',\n      origin: config.viewer?.origin || 'top-left',\n      yAxisDirection: config.viewer?.yAxisDirection || 'down',\n      pages: config.viewer?.pages || [],\n    },\n    signerState: config.signerState || 'active',\n    recipientStage: config.recipientStage || 1,\n    activeStage: config.activeStage || 1,\n    activeRecipientIds: config.activeRecipientIds || [],\n    waitingForRecipientIds: config.waitingForRecipientIds || [],\n  };\n\n  const controller = new SignerReviewController(pageConfig);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignSignerReviewController =\n      controller;\n  }\n}\n\n// Auto-init if page marker is present\nif (typeof document !== 'undefined') {\n  onReady(() => {\n    const pageEl = document.querySelector(\n      '[data-esign-page=\"signer-review\"], [data-esign-page=\"signer.review\"]'\n    );\n    if (pageEl) {\n      // Config would be parsed from inline script or config element\n      // The actual initialization is handled by the inline script currently\n      console.debug('Signer review page detected - module loaded');\n    }\n  });\n}\n","/**\n * E-Sign Signer Error Page Controller\n * Handles retry functionality for error pages\n */\n\nimport { onReady, qs, qsa } from '../utils/dom-helpers.js';\n\n/**\n * Configuration for the signer error page\n */\nexport interface SignerErrorConfig {\n  basePath?: string;\n}\n\n/**\n * Signer error page controller\n * Sets up delegated event handling for retry buttons\n */\nexport class SignerErrorPageController {\n  private readonly config: SignerErrorConfig;\n\n  constructor(config: SignerErrorConfig = {}) {\n    this.config = config;\n  }\n\n  /**\n   * Initialize the error page\n   */\n  init(): void {\n    this.setupEventListeners();\n  }\n\n  /**\n   * Setup event listeners using delegation\n   */\n  private setupEventListeners(): void {\n    // Handle all retry buttons using data attributes\n    const retryButtons = qsa<HTMLButtonElement>('[data-action=\"retry\"]');\n    retryButtons.forEach((btn) => {\n      btn.addEventListener('click', () => this.handleRetry());\n    });\n\n    // Fallback: handle any buttons with class indicating retry\n    const fallbackButtons = qsa<HTMLButtonElement>('.retry-btn, [aria-label*=\"Try Again\"]');\n    fallbackButtons.forEach((btn) => {\n      if (!btn.hasAttribute('data-action')) {\n        btn.addEventListener('click', () => this.handleRetry());\n      }\n    });\n  }\n\n  /**\n   * Handle retry action\n   */\n  private handleRetry(): void {\n    window.location.reload();\n  }\n}\n\n/**\n * Initialize signer error page from config\n */\nexport function initSignerErrorPage(config: SignerErrorConfig = {}): SignerErrorPageController {\n  const controller = new SignerErrorPageController(config);\n  onReady(() => controller.init());\n  return controller;\n}\n\n/**\n * Bootstrap signer error page\n */\nexport function bootstrapSignerErrorPage(config: SignerErrorConfig = {}): void {\n  const controller = new SignerErrorPageController(config);\n  onReady(() => controller.init());\n\n  // Export for testing\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignErrorController = controller;\n  }\n}\n","/**\n * E-Sign Document Detail Page Controller\n * Handles lazy loading PDF preview for document detail pages\n */\n\nimport { qs, show, hide, onReady } from '../utils/dom-helpers.js';\n\n// PDF.js types (loaded globally from CDN)\ndeclare const pdfjsLib: {\n  getDocument: (url: string) => {\n    promise: Promise<PDFDocumentProxy>;\n  };\n  GlobalWorkerOptions: {\n    workerSrc: string;\n  };\n};\n\ninterface PDFDocumentProxy {\n  numPages: number;\n  getPage: (pageNumber: number) => Promise<PDFPageProxy>;\n}\n\ninterface PDFPageProxy {\n  getViewport: (options: { scale: number }) => PDFViewport;\n  render: (context: PDFRenderContext) => { promise: Promise<void> };\n}\n\ninterface PDFViewport {\n  width: number;\n  height: number;\n}\n\ninterface PDFRenderContext {\n  canvasContext: CanvasRenderingContext2D;\n  viewport: PDFViewport;\n}\n\nexport interface DocumentDetailPreviewConfig {\n  documentId: string;\n  pdfUrl: string;\n  pageCount: number;\n}\n\n/**\n * Document detail page controller for PDF preview\n */\nexport class DocumentDetailPreviewController {\n  private readonly config: DocumentDetailPreviewConfig;\n  private pdfDoc: PDFDocumentProxy | null = null;\n  private currentPage = 1;\n  private isLoading = false;\n  private isLoaded = false;\n  private scale = 1.5;\n\n  // Element references\n  private readonly elements: {\n    loadBtn: HTMLButtonElement | null;\n    retryBtn: HTMLButtonElement | null;\n    loading: HTMLElement | null;\n    spinner: HTMLElement | null;\n    error: HTMLElement | null;\n    errorMessage: HTMLElement | null;\n    viewer: HTMLElement | null;\n    canvas: HTMLCanvasElement | null;\n    pagination: HTMLElement | null;\n    prevBtn: HTMLButtonElement | null;\n    nextBtn: HTMLButtonElement | null;\n    currentPageEl: HTMLElement | null;\n    totalPagesEl: HTMLElement | null;\n    status: HTMLElement | null;\n  };\n\n  constructor(config: DocumentDetailPreviewConfig) {\n    this.config = config;\n    this.elements = {\n      loadBtn: qs<HTMLButtonElement>('#pdf-load-btn'),\n      retryBtn: qs<HTMLButtonElement>('#pdf-retry-btn'),\n      loading: qs('#pdf-loading'),\n      spinner: qs('#pdf-spinner'),\n      error: qs('#pdf-error'),\n      errorMessage: qs('#pdf-error-message'),\n      viewer: qs('#pdf-viewer'),\n      canvas: qs<HTMLCanvasElement>('#pdf-canvas'),\n      pagination: qs('#pdf-pagination'),\n      prevBtn: qs<HTMLButtonElement>('#pdf-prev-page'),\n      nextBtn: qs<HTMLButtonElement>('#pdf-next-page'),\n      currentPageEl: qs('#pdf-current-page'),\n      totalPagesEl: qs('#pdf-total-pages'),\n      status: qs('#pdf-status'),\n    };\n  }\n\n  /**\n   * Initialize the controller\n   */\n  init(): void {\n    this.setupEventListeners();\n  }\n\n  /**\n   * Setup event listeners\n   */\n  private setupEventListeners(): void {\n    const { loadBtn, retryBtn, prevBtn, nextBtn } = this.elements;\n\n    if (loadBtn) {\n      loadBtn.addEventListener('click', () => this.loadPdf());\n    }\n\n    if (retryBtn) {\n      retryBtn.addEventListener('click', () => this.loadPdf());\n    }\n\n    if (prevBtn) {\n      prevBtn.addEventListener('click', () => this.goToPage(this.currentPage - 1));\n    }\n\n    if (nextBtn) {\n      nextBtn.addEventListener('click', () => this.goToPage(this.currentPage + 1));\n    }\n\n    // Keyboard navigation\n    document.addEventListener('keydown', (e) => {\n      if (!this.isLoaded) return;\n      if (e.key === 'ArrowLeft' || e.key === 'PageUp') {\n        this.goToPage(this.currentPage - 1);\n      } else if (e.key === 'ArrowRight' || e.key === 'PageDown') {\n        this.goToPage(this.currentPage + 1);\n      }\n    });\n  }\n\n  /**\n   * Load the PDF document\n   */\n  async loadPdf(): Promise<void> {\n    if (this.isLoading) return;\n\n    this.isLoading = true;\n    this.showSpinner();\n\n    try {\n      if (typeof pdfjsLib === 'undefined') {\n        throw new Error('PDF.js library not loaded');\n      }\n\n      this.updateStatus('Loading PDF...');\n      const loadingTask = pdfjsLib.getDocument(this.config.pdfUrl);\n      this.pdfDoc = await loadingTask.promise;\n\n      // Update total pages\n      const totalPages = this.pdfDoc.numPages;\n      if (this.elements.totalPagesEl) {\n        this.elements.totalPagesEl.textContent = String(totalPages);\n      }\n\n      this.isLoaded = true;\n      this.showViewer();\n      await this.renderPage(1);\n      this.updateStatus('');\n    } catch (error) {\n      console.error('Failed to load PDF:', error);\n      this.showError(error instanceof Error ? error.message : 'Failed to load document');\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  /**\n   * Render a specific page\n   */\n  private async renderPage(pageNumber: number): Promise<void> {\n    if (!this.pdfDoc || !this.elements.canvas) return;\n\n    const totalPages = this.pdfDoc.numPages;\n    if (pageNumber < 1 || pageNumber > totalPages) return;\n\n    this.currentPage = pageNumber;\n    this.updateStatus(`Rendering page ${pageNumber}...`);\n\n    try {\n      const page = await this.pdfDoc.getPage(pageNumber);\n      const viewport = page.getViewport({ scale: this.scale });\n\n      const canvas = this.elements.canvas;\n      const context = canvas.getContext('2d');\n      if (!context) {\n        throw new Error('Failed to get canvas context');\n      }\n\n      // Set canvas dimensions\n      canvas.height = viewport.height;\n      canvas.width = viewport.width;\n\n      // Render the page\n      await page.render({\n        canvasContext: context,\n        viewport: viewport,\n      }).promise;\n\n      // Update pagination state\n      this.updatePaginationState();\n      this.updateStatus('');\n    } catch (error) {\n      console.error('Failed to render page:', error);\n      this.updateStatus('Failed to render page');\n    }\n  }\n\n  /**\n   * Navigate to a specific page\n   */\n  goToPage(pageNumber: number): void {\n    if (!this.pdfDoc) return;\n\n    const totalPages = this.pdfDoc.numPages;\n    if (pageNumber < 1 || pageNumber > totalPages) return;\n\n    this.renderPage(pageNumber);\n  }\n\n  /**\n   * Update pagination button states\n   */\n  private updatePaginationState(): void {\n    const { prevBtn, nextBtn, currentPageEl, pagination } = this.elements;\n    const totalPages = this.pdfDoc?.numPages || 1;\n\n    if (pagination) {\n      pagination.classList.remove('hidden');\n    }\n\n    if (currentPageEl) {\n      currentPageEl.textContent = String(this.currentPage);\n    }\n\n    if (prevBtn) {\n      prevBtn.disabled = this.currentPage <= 1;\n    }\n\n    if (nextBtn) {\n      nextBtn.disabled = this.currentPage >= totalPages;\n    }\n  }\n\n  /**\n   * Update status text\n   */\n  private updateStatus(message: string): void {\n    if (this.elements.status) {\n      this.elements.status.textContent = message;\n    }\n  }\n\n  /**\n   * Show the loading spinner\n   */\n  private showSpinner(): void {\n    const { loading, spinner, error, viewer } = this.elements;\n    if (loading) hide(loading);\n    if (spinner) show(spinner);\n    if (error) hide(error);\n    if (viewer) hide(viewer);\n  }\n\n  /**\n   * Show the PDF viewer\n   */\n  private showViewer(): void {\n    const { loading, spinner, error, viewer } = this.elements;\n    if (loading) hide(loading);\n    if (spinner) hide(spinner);\n    if (error) hide(error);\n    if (viewer) show(viewer);\n  }\n\n  /**\n   * Show error state\n   */\n  private showError(message: string): void {\n    const { loading, spinner, error, errorMessage, viewer } = this.elements;\n    if (loading) hide(loading);\n    if (spinner) hide(spinner);\n    if (error) show(error);\n    if (viewer) hide(viewer);\n    if (errorMessage) {\n      errorMessage.textContent = message;\n    }\n  }\n}\n\n/**\n * Initialize document detail preview\n */\nexport function initDocumentDetailPreview(\n  config: DocumentDetailPreviewConfig\n): DocumentDetailPreviewController {\n  const controller = new DocumentDetailPreviewController(config);\n  controller.init();\n  return controller;\n}\n\n/**\n * Bootstrap document detail preview from page config\n */\nexport function bootstrapDocumentDetailPreview(config: {\n  documentId: string;\n  pdfUrl: string;\n  pageCount?: number;\n}): void {\n  const previewConfig: DocumentDetailPreviewConfig = {\n    documentId: config.documentId,\n    pdfUrl: config.pdfUrl,\n    pageCount: config.pageCount || 1,\n  };\n\n  const controller = new DocumentDetailPreviewController(previewConfig);\n  onReady(() => controller.init());\n\n  // Export for debugging\n  if (typeof window !== 'undefined') {\n    (window as unknown as Record<string, unknown>).esignDocumentDetailController =\n      controller;\n  }\n}\n\n// Auto-init if page marker is present\nif (typeof document !== 'undefined') {\n  onReady(() => {\n    const container = document.querySelector('[data-esign-page=\"document-detail\"]');\n    if (container instanceof HTMLElement) {\n      const documentId = container.dataset.documentId || '';\n      const pdfUrl = container.dataset.pdfUrl || '';\n      const pageCount = parseInt(container.dataset.pageCount || '1', 10);\n\n      if (documentId && pdfUrl) {\n        const controller = new DocumentDetailPreviewController({\n          documentId,\n          pdfUrl,\n          pageCount,\n        });\n        controller.init();\n      }\n    }\n  });\n}\n","/**\n * E-Sign Datatable Bootstrap Utilities\n * Shared datatable initialization and configuration for e-sign list pages\n */\n\nimport { onReady, qs } from '../utils/dom-helpers.js';\n\n/**\n * Filter field configuration\n */\nexport interface FilterField {\n  name: string;\n  label: string;\n  type: 'text' | 'select' | 'number' | 'date';\n  options?: Array<{ label: string; value: string }>;\n  operators?: string[];\n}\n\n/**\n * Column configuration\n */\nexport interface ColumnConfig {\n  field: string;\n  label?: string;\n  sortable?: boolean;\n  hidden?: boolean;\n  default?: boolean;\n  [key: string]: unknown;\n}\n\n/**\n * Cell renderer function type\n */\nexport type CellRenderer = (value: unknown, row?: Record<string, unknown>) => string;\n\n/**\n * Datatable bootstrap configuration\n */\nexport interface DatatableBootstrapConfig {\n  datatableId: string;\n  basePath: string;\n  apiBasePath?: string;\n  apiEndpoint: string;\n  actionBasePath: string;\n  columns: ColumnConfig[];\n  filters?: Array<{\n    name: string;\n    label: string;\n    type?: string;\n    options?: Array<{ value?: unknown; label?: string }>;\n    operators?: string[];\n    default_operator?: string;\n  }>;\n  env?: string;\n  locale?: string;\n  panelName: string;\n  localStorageKey: string;\n  cellRenderers?: Record<string, CellRenderer>;\n  onActionSuccess?: (actionName: string, result: unknown) => void;\n  onActionError?: (actionName: string, error: ActionError) => void;\n}\n\ninterface ActionError {\n  message?: string;\n  textCode?: string;\n  fields?: Record<string, string>;\n}\n\n/**\n * Panel pagination behavior\n */\nexport class PanelPaginationBehavior {\n  private readonly env?: string;\n\n  constructor(env?: string) {\n    this.env = env;\n  }\n\n  buildQuery(page: number, perPage: number): Record<string, unknown> {\n    const params: Record<string, unknown> = { page, per_page: perPage };\n    if (this.env) params.env = this.env;\n    return params;\n  }\n\n  async onPageChange(_page: number, grid: { refresh: () => Promise<void> }): Promise<void> {\n    await grid.refresh();\n  }\n}\n\n/**\n * Panel search behavior\n */\nexport class PanelSearchBehavior {\n  private readonly env?: string;\n\n  constructor(env?: string) {\n    this.env = env;\n  }\n\n  buildQuery(term: string): Record<string, unknown> {\n    const params: Record<string, unknown> = {};\n    const value = term ? term.trim() : '';\n    if (value) params.search = value;\n    if (this.env) params.env = this.env;\n    return params;\n  }\n\n  async onSearch(_term: string, grid: { resetPagination: () => void; refresh: () => Promise<void> }): Promise<void> {\n    grid.resetPagination();\n    await grid.refresh();\n  }\n}\n\n/**\n * Normalize filter type to standard types\n */\nexport function normalizeFilterType(type?: string): 'text' | 'select' | 'number' | 'date' {\n  switch ((type || '').toLowerCase()) {\n    case 'select':\n    case 'enum':\n      return 'select';\n    case 'number':\n    case 'integer':\n      return 'number';\n    case 'date':\n    case 'datetime':\n    case 'time':\n      return 'date';\n    default:\n      return 'text';\n  }\n}\n\n/**\n * Normalize filter options\n */\nexport function normalizeFilterOptions(\n  options?: Array<{ value?: unknown; label?: string }>\n): Array<{ label: string; value: string }> | undefined {\n  if (!Array.isArray(options)) return undefined;\n  const normalized = options\n    .map((option) => {\n      if (!option) return null;\n      const value = option.value ?? '';\n      const label = option.label ?? String(value);\n      return { label: String(label), value: String(value) };\n    })\n    .filter((o): o is { label: string; value: string } => o !== null);\n  return normalized.length > 0 ? normalized : undefined;\n}\n\n/**\n * Normalize filter operators\n */\nexport function normalizeFilterOperators(\n  operators?: string[],\n  defaultOperator?: string\n): string[] | undefined {\n  if (!Array.isArray(operators) || operators.length === 0) return undefined;\n  const normalized = operators\n    .map((op) => String(op || '').trim().toLowerCase())\n    .filter(Boolean);\n  if (normalized.length === 0) return undefined;\n  const deduped = Array.from(new Set(normalized));\n  const preferred = defaultOperator ? String(defaultOperator).trim().toLowerCase() : '';\n  if (preferred && deduped.includes(preferred)) {\n    return [preferred, ...deduped.filter((op) => op !== preferred)];\n  }\n  return deduped;\n}\n\n/**\n * Prepare grid columns from raw column config\n */\nexport function prepareGridColumns(columns: ColumnConfig[]): ColumnConfig[] {\n  return columns.map((col) => ({\n    ...col,\n    hidden: col.default === false,\n  }));\n}\n\n/**\n * Prepare filter fields from raw filter config\n */\nexport function prepareFilterFields(\n  filters?: DatatableBootstrapConfig['filters']\n): FilterField[] {\n  if (!filters) return [];\n  return filters.map((filter) => ({\n    name: filter.name,\n    label: filter.label,\n    type: normalizeFilterType(filter.type),\n    options: normalizeFilterOptions(filter.options),\n    operators: normalizeFilterOperators(filter.operators, filter.default_operator),\n  }));\n}\n\n/**\n * Common date/time cell renderer\n */\nexport function dateTimeCellRenderer(value: unknown): string {\n  if (!value) return '-';\n  try {\n    const date = new Date(value as string);\n    return (\n      date.toLocaleDateString() +\n      ' ' +\n      date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n    );\n  } catch {\n    return String(value);\n  }\n}\n\n/**\n * File size cell renderer\n */\nexport function fileSizeCellRenderer(value: unknown): string {\n  if (!value || Number(value) <= 0) return '-';\n  const bytes = parseInt(String(value), 10);\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;\n}\n\n/**\n * Default action success handler\n */\nexport function defaultActionSuccessHandler(\n  actionName: string,\n  _result: unknown,\n  notifier?: { success: (msg: string) => void }\n): void {\n  if (notifier) {\n    notifier.success(`${actionName} completed successfully`);\n  }\n}\n\n/**\n * Default action error handler with field details\n */\nexport function defaultActionErrorHandler(\n  actionName: string,\n  error: ActionError,\n  notifier?: { error: (msg: string) => void }\n): void {\n  if (notifier) {\n    const fieldDetails = error?.fields\n      ? Object.entries(error.fields)\n          .map(([field, detail]) => `${field}: ${detail}`)\n          .join('; ')\n      : '';\n    const prefix = error?.textCode ? `${error.textCode}: ` : '';\n    const message = error?.message || `${actionName} failed`;\n    notifier.error(fieldDetails ? `${prefix}${message}: ${fieldDetails}` : `${prefix}${message}`);\n  }\n}\n\n/**\n * Setup refresh button event listener\n */\nexport function setupRefreshButton(\n  buttonId: string,\n  grid: { refresh: () => Promise<void> }\n): void {\n  const refreshBtn = qs<HTMLButtonElement>(`#${buttonId}`);\n  if (refreshBtn) {\n    refreshBtn.addEventListener('click', async () => {\n      refreshBtn.disabled = true;\n      refreshBtn.classList.add('opacity-50');\n      try {\n        await grid.refresh();\n      } finally {\n        refreshBtn.disabled = false;\n        refreshBtn.classList.remove('opacity-50');\n      }\n    });\n  }\n}\n\n/**\n * Create schema action caching wrapper for grid refresh\n */\nexport function createSchemaActionCachingRefresh(\n  grid: { refresh: () => Promise<void>; getSchema: () => { actions?: unknown } | null },\n  setCachedActions: (actions: unknown) => void\n): () => Promise<void> {\n  const originalRefresh = grid.refresh.bind(grid);\n  return async function () {\n    await originalRefresh();\n    const schema = grid.getSchema();\n    if (schema?.actions) {\n      setCachedActions(schema.actions);\n    }\n  };\n}\n\n/**\n * Standard datatable grid selectors\n */\nexport const STANDARD_GRID_SELECTORS = {\n  searchInput: '#table-search',\n  perPageSelect: '#table-per-page',\n  filterRow: '[data-filter-column]',\n  columnToggleBtn: '#column-toggle-btn',\n  columnToggleMenu: '#column-toggle-menu',\n  exportBtn: '#export-btn',\n  exportMenu: '#export-menu',\n  paginationContainer: '#table-pagination',\n  tableInfoStart: '#table-info-start',\n  tableInfoEnd: '#table-info-end',\n  tableInfoTotal: '#table-info-total',\n  selectAllCheckbox: '#table-checkbox-all',\n  rowCheckboxes: '.table-checkbox',\n  bulkActionsBar: '#bulk-actions-overlay',\n  selectedCount: '#selected-count',\n} as const;\n\n// Export all utilities\nexport type {\n  ActionError,\n};\n","/**\n * Google Drive Utilities\n * Shared utilities for Google Drive integration across e-sign pages\n */\n\n// --------------------------------------------------------------------------\n// Constants\n// --------------------------------------------------------------------------\n\n/**\n * Google MIME types\n */\nexport const MIME_GOOGLE_DOC = 'application/vnd.google-apps.document';\nexport const MIME_GOOGLE_SHEET = 'application/vnd.google-apps.spreadsheet';\nexport const MIME_GOOGLE_SLIDES = 'application/vnd.google-apps.presentation';\nexport const MIME_GOOGLE_FOLDER = 'application/vnd.google-apps.folder';\nexport const MIME_PDF = 'application/pdf';\n\n/**\n * Importable MIME types for e-sign\n */\nexport const IMPORTABLE_MIME_TYPES = [MIME_GOOGLE_DOC, MIME_PDF];\n\n/**\n * LocalStorage key for Google account ID\n */\nexport const GOOGLE_ACCOUNT_STORAGE_KEY = 'esign.google.account_id';\n\n// --------------------------------------------------------------------------\n// Types\n// --------------------------------------------------------------------------\n\n/**\n * Normalized Google Drive file\n */\nexport interface NormalizedDriveFile {\n  id: string;\n  name: string;\n  mimeType: string;\n  size: number;\n  modifiedTime: string;\n  iconLink?: string;\n  thumbnailLink?: string;\n  webViewLink?: string;\n  parents?: string[];\n}\n\n/**\n * Folder path item for breadcrumb navigation\n */\nexport interface FolderPathItem {\n  id: string;\n  name: string;\n}\n\n/**\n * Raw Google Drive file from API\n */\nexport interface RawGoogleDriveFile {\n  id?: string;\n  name?: string;\n  mimeType?: string;\n  size?: string | number;\n  modifiedTime?: string;\n  iconLink?: string;\n  thumbnailLink?: string;\n  webViewLink?: string;\n  parents?: string[];\n  [key: string]: unknown;\n}\n\n// --------------------------------------------------------------------------\n// File Type Predicates\n// --------------------------------------------------------------------------\n\n/**\n * Check if file is a Google Doc\n */\nexport function isGoogleDoc(file: NormalizedDriveFile): boolean {\n  return file.mimeType === MIME_GOOGLE_DOC;\n}\n\n/**\n * Check if file is a PDF\n */\nexport function isPDF(file: NormalizedDriveFile): boolean {\n  return file.mimeType === MIME_PDF;\n}\n\n/**\n * Check if file is a folder\n */\nexport function isFolder(file: NormalizedDriveFile): boolean {\n  return file.mimeType === MIME_GOOGLE_FOLDER;\n}\n\n/**\n * Check if file is importable\n */\nexport function isImportable(file: NormalizedDriveFile): boolean {\n  return IMPORTABLE_MIME_TYPES.includes(file.mimeType);\n}\n\n/**\n * Check if file is a Google Workspace file (Doc, Sheet, Slides)\n */\nexport function isGoogleWorkspaceFile(file: NormalizedDriveFile): boolean {\n  return (\n    file.mimeType === MIME_GOOGLE_DOC ||\n    file.mimeType === MIME_GOOGLE_SHEET ||\n    file.mimeType === MIME_GOOGLE_SLIDES\n  );\n}\n\n// --------------------------------------------------------------------------\n// Normalizers\n// --------------------------------------------------------------------------\n\n/**\n * Normalize a raw Google Drive file to a standard format\n */\nexport function normalizeDriveFile(file: RawGoogleDriveFile): NormalizedDriveFile {\n  return {\n    id: file.id || '',\n    name: file.name || 'Untitled',\n    mimeType: file.mimeType || 'application/octet-stream',\n    size: typeof file.size === 'string' ? parseInt(file.size, 10) || 0 : (file.size || 0),\n    modifiedTime: file.modifiedTime || new Date().toISOString(),\n    iconLink: file.iconLink,\n    thumbnailLink: file.thumbnailLink,\n    webViewLink: file.webViewLink,\n    parents: file.parents,\n  };\n}\n\n/**\n * Normalize an array of raw files\n */\nexport function normalizeDriveFiles(files: RawGoogleDriveFile[]): NormalizedDriveFile[] {\n  return files.map(normalizeDriveFile);\n}\n\n// --------------------------------------------------------------------------\n// Display Utilities\n// --------------------------------------------------------------------------\n\n/**\n * Get human-readable file type name from MIME type\n */\nexport function getFileTypeName(mimeType: string): string {\n  const typeMap: Record<string, string> = {\n    [MIME_GOOGLE_DOC]: 'Google Doc',\n    [MIME_GOOGLE_SHEET]: 'Google Sheet',\n    [MIME_GOOGLE_SLIDES]: 'Google Slides',\n    [MIME_GOOGLE_FOLDER]: 'Folder',\n    [MIME_PDF]: 'PDF',\n    'application/msword': 'Word Document',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'Word Document',\n    'application/vnd.ms-excel': 'Excel Spreadsheet',\n    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'Excel Spreadsheet',\n    'image/png': 'PNG Image',\n    'image/jpeg': 'JPEG Image',\n    'text/plain': 'Text File',\n  };\n  return typeMap[mimeType] || 'File';\n}\n\n/**\n * Get file icon configuration based on file type\n */\nexport function getFileIconConfig(file: NormalizedDriveFile): {\n  icon: string;\n  bgClass: string;\n  textClass: string;\n} {\n  if (isFolder(file)) {\n    return {\n      icon: 'iconoir-folder',\n      bgClass: 'bg-yellow-100',\n      textClass: 'text-yellow-600',\n    };\n  }\n  if (isGoogleDoc(file)) {\n    return {\n      icon: 'iconoir-google-docs',\n      bgClass: 'bg-blue-100',\n      textClass: 'text-blue-600',\n    };\n  }\n  if (isPDF(file)) {\n    return {\n      icon: 'iconoir-page',\n      bgClass: 'bg-red-100',\n      textClass: 'text-red-600',\n    };\n  }\n  if (file.mimeType === MIME_GOOGLE_SHEET) {\n    return {\n      icon: 'iconoir-table',\n      bgClass: 'bg-green-100',\n      textClass: 'text-green-600',\n    };\n  }\n  if (file.mimeType === MIME_GOOGLE_SLIDES) {\n    return {\n      icon: 'iconoir-presentation',\n      bgClass: 'bg-orange-100',\n      textClass: 'text-orange-600',\n    };\n  }\n  if (file.mimeType.startsWith('image/')) {\n    return {\n      icon: 'iconoir-media-image',\n      bgClass: 'bg-purple-100',\n      textClass: 'text-purple-600',\n    };\n  }\n  return {\n    icon: 'iconoir-page',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-600',\n  };\n}\n\n/**\n * Format file size for display\n */\nexport function formatFileSize(bytes: number): string {\n  if (!bytes || bytes <= 0) return '-';\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;\n}\n\n/**\n * Format date for display\n */\nexport function formatDate(dateStr: string): string {\n  if (!dateStr) return '-';\n  try {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString();\n  } catch {\n    return dateStr;\n  }\n}\n\n// --------------------------------------------------------------------------\n// Account ID Management\n// --------------------------------------------------------------------------\n\n/**\n * Resolve account ID from multiple sources\n * Priority: queryParams > templateValue > localStorage\n */\nexport function resolveAccountId(\n  queryParams: URLSearchParams,\n  templateAccountId?: string\n): string {\n  // 1. Check query params\n  const queryAccountId = queryParams.get('account_id');\n  if (queryAccountId) {\n    return normalizeAccountId(queryAccountId);\n  }\n\n  // 2. Check template-provided value\n  if (templateAccountId) {\n    return normalizeAccountId(templateAccountId);\n  }\n\n  // 3. Check localStorage\n  const storedAccountId = localStorage.getItem(GOOGLE_ACCOUNT_STORAGE_KEY);\n  if (storedAccountId) {\n    return normalizeAccountId(storedAccountId);\n  }\n\n  return '';\n}\n\n/**\n * Normalize account ID value\n */\nexport function normalizeAccountId(value: string | null | undefined): string {\n  if (!value) return '';\n  const trimmed = value.trim();\n  if (trimmed === 'null' || trimmed === 'undefined' || trimmed === '0') {\n    return '';\n  }\n  return trimmed;\n}\n\n/**\n * Save account ID to localStorage\n */\nexport function saveAccountId(accountId: string): void {\n  const normalized = normalizeAccountId(accountId);\n  if (normalized) {\n    localStorage.setItem(GOOGLE_ACCOUNT_STORAGE_KEY, normalized);\n  }\n}\n\n/**\n * Apply account ID to a URL path or full URL\n */\nexport function applyAccountIdToPath(pathOrUrl: string, accountId: string): string {\n  if (!accountId) return pathOrUrl;\n\n  try {\n    const url = new URL(pathOrUrl, window.location.origin);\n    url.searchParams.set('account_id', accountId);\n    return url.pathname + url.search;\n  } catch {\n    // If not a valid URL, append as query param\n    const separator = pathOrUrl.includes('?') ? '&' : '?';\n    return `${pathOrUrl}${separator}account_id=${encodeURIComponent(accountId)}`;\n  }\n}\n\n/**\n * Build API URL with account ID scoping\n */\nexport function buildScopedApiUrl(apiBase: string, path: string, accountId?: string): URL {\n  const url = new URL(path, window.location.origin);\n  if (!url.pathname.startsWith(apiBase)) {\n    url.pathname = `${apiBase}${path}`;\n  }\n  if (accountId) {\n    url.searchParams.set('account_id', accountId);\n  }\n  return url;\n}\n\n/**\n * Sync account ID to URL state\n */\nexport function syncAccountIdToUrl(accountId: string): void {\n  const url = new URL(window.location.href);\n  const currentAccountId = url.searchParams.get('account_id');\n\n  if (accountId && currentAccountId !== accountId) {\n    url.searchParams.set('account_id', accountId);\n    window.history.replaceState({}, '', url.toString());\n  } else if (!accountId && currentAccountId) {\n    url.searchParams.delete('account_id');\n    window.history.replaceState({}, '', url.toString());\n  }\n}\n\n// --------------------------------------------------------------------------\n// HTML Utilities\n// --------------------------------------------------------------------------\n\n/**\n * Escape HTML to prevent XSS\n */\nexport function escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Render file icon HTML\n */\nexport function renderFileIcon(file: NormalizedDriveFile): string {\n  const config = getFileIconConfig(file);\n  return `\n    <div class=\"w-10 h-10 ${config.bgClass} rounded-lg flex items-center justify-center flex-shrink-0\">\n      <i class=\"${config.icon} ${config.textClass}\" aria-hidden=\"true\"></i>\n    </div>\n  `;\n}\n\n/**\n * Render breadcrumb HTML for folder navigation\n */\nexport function renderBreadcrumb(\n  path: FolderPathItem[],\n  onNavigate: (folderId: string) => void\n): string {\n  if (path.length === 0) {\n    return '<span class=\"text-gray-600 text-sm font-medium\">My Drive</span>';\n  }\n\n  const items = [\n    { id: '', name: 'My Drive' },\n    ...path,\n  ];\n\n  return items\n    .map((item, index) => {\n      const isLast = index === items.length - 1;\n      const separator = index > 0 ? '<span class=\"text-gray-400 mx-1\">/</span>' : '';\n\n      if (isLast) {\n        return `${separator}<span class=\"text-gray-900 font-medium\">${escapeHtml(item.name)}</span>`;\n      }\n\n      return `${separator}<button\n        type=\"button\"\n        class=\"text-blue-600 hover:text-blue-800 hover:underline breadcrumb-nav-btn\"\n        data-folder-id=\"${item.id}\"\n      >${escapeHtml(item.name)}</button>`;\n    })\n    .join('');\n}\n\n// --------------------------------------------------------------------------\n// File List Rendering\n// --------------------------------------------------------------------------\n\n/**\n * Render a single file item HTML\n */\nexport function renderFileItem(\n  file: NormalizedDriveFile,\n  options: {\n    selectable?: boolean;\n    showSize?: boolean;\n    showDate?: boolean;\n  } = {}\n): string {\n  const { selectable = true, showSize = true, showDate = true } = options;\n  const iconHtml = renderFileIcon(file);\n  const isFolder_ = isFolder(file);\n  const isImportable_ = isImportable(file);\n\n  const selectableClass = isFolder_\n    ? 'cursor-pointer hover:bg-gray-50'\n    : isImportable_\n      ? 'cursor-pointer hover:bg-blue-50'\n      : 'opacity-60';\n\n  const dataAttrs = isFolder_\n    ? `data-folder-id=\"${file.id}\" data-folder-name=\"${escapeHtml(file.name)}\"`\n    : isImportable_ && selectable\n      ? `data-file-id=\"${file.id}\" data-file-name=\"${escapeHtml(file.name)}\" data-mime-type=\"${file.mimeType}\"`\n      : '';\n\n  return `\n    <div\n      class=\"flex items-center gap-3 p-3 rounded-lg border border-gray-200 ${selectableClass} file-item\"\n      ${dataAttrs}\n      role=\"listitem\"\n      ${isImportable_ ? 'tabindex=\"0\"' : ''}\n    >\n      ${iconHtml}\n      <div class=\"flex-1 min-w-0\">\n        <p class=\"font-medium text-gray-900 truncate\">${escapeHtml(file.name)}</p>\n        <p class=\"text-xs text-gray-500\">\n          ${getFileTypeName(file.mimeType)}\n          ${showSize && file.size > 0 ? ` &middot; ${formatFileSize(file.size)}` : ''}\n          ${showDate && file.modifiedTime ? ` &middot; ${formatDate(file.modifiedTime)}` : ''}\n        </p>\n      </div>\n      ${isImportable_ && selectable ? '<i class=\"iconoir-nav-arrow-right text-gray-400\" aria-hidden=\"true\"></i>' : ''}\n    </div>\n  `;\n}\n\n/**\n * Render file list HTML\n */\nexport function renderFileList(\n  files: NormalizedDriveFile[],\n  options: {\n    emptyMessage?: string;\n    selectable?: boolean;\n  } = {}\n): string {\n  const { emptyMessage = 'No files found', selectable = true } = options;\n\n  if (files.length === 0) {\n    return `\n      <div class=\"text-center py-8 text-gray-500\">\n        <i class=\"iconoir-folder text-4xl mb-2\" aria-hidden=\"true\"></i>\n        <p>${escapeHtml(emptyMessage)}</p>\n      </div>\n    `;\n  }\n\n  // Sort: folders first, then by name\n  const sorted = [...files].sort((a, b) => {\n    if (isFolder(a) && !isFolder(b)) return -1;\n    if (!isFolder(a) && isFolder(b)) return 1;\n    return a.name.localeCompare(b.name);\n  });\n\n  return `\n    <div class=\"space-y-2\" role=\"list\">\n      ${sorted.map((file) => renderFileItem(file, { selectable })).join('')}\n    </div>\n  `;\n}\n\n// --------------------------------------------------------------------------\n// Selection State\n// --------------------------------------------------------------------------\n\n/**\n * Selected file state\n */\nexport interface SelectedFile {\n  id: string;\n  name: string;\n  mimeType: string;\n  typeName: string;\n}\n\n/**\n * Create selected file state from normalized file\n */\nexport function createSelectedFile(file: NormalizedDriveFile): SelectedFile {\n  return {\n    id: file.id,\n    name: file.name,\n    mimeType: file.mimeType,\n    typeName: getFileTypeName(file.mimeType),\n  };\n}\n"],"names":["ESignAPIClient","config","params","queryParams","allRows","page","perPage","maxPages","response","rows","counters","row","status","pending","actionRequired","importRunId","id","path","body","error","ESignAPIError","code","message","details","defaultClient","getESignClient","setESignClient","client","createESignClient","formatFileSize","bytes","numBytes","formatPageCount","count","numCount","formatDateTime","value","options","date","defaultOptions","formatDate","formatTime","formatRelativeTime","now","diffMs","diffSec","diffMin","diffHour","diffDay","rtf","formatRecipientCount","capitalize","str","snakeToTitle","word","truncate","maxLength","AGREEMENT_STATUS_BADGES","getAgreementStatusBadge","normalizedStatus","renderStatusBadge","badge","showDot","size","sizeClasses","dotHtml","createStatusBadgeElement","container","updateStatusBadge","element","existingDot","dotSpan","textContent","qs","selector","parent","qsa","byId","createElement","tagName","attributes","children","key","child","on","event","handler","delegate","delegatedHandler","ev","target","onReady","callback","show","hide","toggle","visible","setLoading","loading","updateDataText","updateDataTexts","values","getPageConfig","configAttr","configStr","scriptEl","announce","priority","announcer","el","poll","fn","until","interval","timeout","maxAttempts","onProgress","signal","startTime","attempts","lastResult","sleep","retry","baseDelay","maxDelay","exponentialBackoff","shouldRetry","onRetry","lastError","attempt","delay","ms","resolve","reject","timeoutId","abortHandler","debounce","args","throttle","lastCall","createTimeoutController","timeoutMs","controller","withTimeout","promise","errorMessage","timeoutPromise","_","LandingPageController","err","stats","initLandingPage","pageConfig","bootstrapLandingPage","basePath","apiBasePath","pageEl","configScript","rawConfig","e","SignerCompletePageController","retryBtn","assets","artifacts","state","s","link","initSignerCompletePage","bootstrapSignerCompletePage","formatSizeElements","formatTimestampElements","ts","applyDetailFormatters","initDetailFormatters","ERROR_MESSAGES","GoogleCallbackController","closeBtn","errorDescription","stateData","rawState","result","parsed","loadingState","successState","errorState","data","description","errorDetail","redirectPath","redirectURL","accountId","initGoogleCallback","bootstrapGoogleCallback","GOOGLE_ACCOUNT_STORAGE_KEY","SCOPE_DESCRIPTIONS","GoogleIntegrationController","connectBtn","disconnectBtn","refreshBtn","reauthBtn","oauthCancelBtn","disconnectCancelBtn","disconnectConfirmBtn","accountIdInput","oauthModal","disconnectModal","accountDropdown","connectFirstBtn","modal","fromQuery","fromTemplate","refreshStatus","normalized","manualValue","account","accountID","connectedAccountId","importDriveLink","integrationSettingsLink","url","links","baseHref","pathOrURL","announcements","disconnectedState","connectedState","connected","expiring","degraded","statusBadge","errorData","integration","isDegraded","raw","firstDefined","keys","fallback","expiresAt","scopes","degradedReason","email","canAutoRefresh","explicitNeedsReauth","isExpired","isExpiringSoon","expiryDate","deltaMs","expiringSoonMs","needsReauthorization","connectedEmail","scopesList","expiryInfo","reauthWarning","reauthReason","scope","info","expiryTime","minutesLeft","reason","degradedWarning","defaultOption","seenAccountIDs","option","label","customOption","addNewOption","accountsLoading","accountsEmpty","accountsGrid","isActive","statusClasses","statusBadgeClasses","statusLabels","borderClass","cardClass","badgeClass","statusLabel","accountLabel","btn","connectNewCard","text","div","targetAccountId","redirectUri","oauthAccountId","authUrl","width","height","left","top","clientId","accountIdForConnect","accountIdToDisconnect","type","toastManager","initGoogleIntegration","bootstrapGoogleIntegration","MIME_TYPE_ICONS","IMPORTABLE_TYPES","GoogleDrivePickerController","searchInput","clearSearchBtn","loadMoreBtn","importBtn","clearSelectionBtn","importCancelBtn","importConfirmBtn","importForm","importModal","viewListBtn","viewGridBtn","debouncedSearch","fileList","accountScopeHelp","connectGoogleLink","file","name","mimeType","modifiedTime","webViewLink","parentID","ownerEmail","parents","owners","append","currentFolder","files","f","html","isFolder","isImportable","isSelected","iconType","icon","iconMap","fileItem","fileId","folderId","folder","noSelection","filePreview","previewIcon","previewTitle","previewType","previewFileId","previewOwner","previewModified","openInGoogleBtn","breadcrumb","listTitle","ol","item","index","resultCount","pagination","query","mode","importGoogleFileId","importDocumentTitle","importAgreementTitle","importSpinner","importBtnText","googleFileId","documentTitle","agreementTitle","initGoogleDrivePicker","bootstrapGoogleDrivePicker","IntegrationHealthController","timeRange","providerFilter","syncChartCanvas","conflictChartCanvas","range","provider","dataPoints","p","activities","types","providers","i","points","labels","datasets","time","healthScore","healthIndicator","healthTrend","trendSign","syncSuccessRate","syncSuccessCount","syncFailedCount","syncSuccessBar","conflictCount","conflictPending","conflictResolved","conflictTrend","syncLag","lagStatus","lastSync","retryTotal","retryRecovery","retryAvg","retryList","r","providerHealthTable","alertsList","noAlerts","alertCount","a","severity","alertElement","remaining","activityFeed","canvasId","chartData","colors","_legends","canvas","ctx","padding","chartWidth","chartHeight","barWidth","maxVal","x","j","barHeight","barX","barY","y","val","initIntegrationHealth","bootstrapIntegrationHealth","IntegrationMappingsController","createMappingBtn","createMappingEmptyBtn","closeModalBtn","cancelModalBtn","addFieldBtn","addRuleBtn","validateBtn","mappingForm","publishCancelBtn","publishConfirmBtn","deleteCancelBtn","deleteConfirmBtn","closePreviewBtn","loadSampleBtn","runPreviewBtn","clearPreviewBtn","previewSourceInput","filterStatus","filterProvider","mappingModal","publishModal","deleteModal","previewModal","emptyState","mappingsList","dateStr","configs","m","mappingsTbody","search","statusFilter","filtered","field","rule","schemaFieldsContainer","mappingRulesContainer","mappingIdInput","mappingVersionInput","mappingNameInput","mappingProviderInput","schemaObjectTypeInput","schemaVersionInput","fields","rules","mapping","mappingStatusBadge","formValidationStatus","schema","mappingModalTitle","publishMappingName","publishMappingVersion","errors","saveBtn","isUpdate","previewMappingName","previewMappingProvider","previewObjectType","previewMappingStatus","sourceSyntaxError","previewEmpty","previewLoading","previewError","previewSuccess","previewRulesTbody","objectType","sample","innerObj","previewErrorMessage","sourcePayload","participantData","agreementData","fieldDefData","sourceValue","matched","payload","sourceObject","sourceField","obj","previewParticipants","participantsCount","previewFields","fieldsCount","previewMetadata","previewRawJson","participants","metadata","metaEntries","cell","initIntegrationMappings","bootstrapIntegrationMappings","IntegrationConflictsController","closeDetailBtn","filterEntity","actionResolveBtn","actionIgnoreBtn","cancelResolveBtn","resolveForm","conflictDetailModal","resolveModal","conflictsList","entityKind","currentProvider","c","statPending","statResolved","statIgnored","resolved","ignored","entityFilter","conflict","card","conflictId","detailReason","detailEntityType","detailStatusBadge","detailProvider","detailExternalId","detailInternalId","detailBindingId","detailConflictId","detailRunId","detailCreatedAt","detailVersion","detailPayload","resolutionSection","actionButtons","detailResolvedAt","detailResolvedBy","detailResolution","resolution","presetStatus","resolutionAction","submitResolveBtn","formData","resolutionData","notes","initIntegrationConflicts","bootstrapIntegrationConflicts","IntegrationSyncRunsController","startSyncBtn","startSyncEmptyBtn","cancelSyncBtn","startSyncForm","filterDirection","actionResumeBtn","actionRetryBtn","actionCompleteBtn","actionFailBtn","actionDiagnosticsBtn","startSyncModal","runDetailModal","runsTimeline","direction","syncMappingSelect","statTotal","statRunning","statCompleted","statFailed","total","running","completed","failed","directionFilter","run","submitSyncBtn","runId","detailDirection","detailStatus","detailStarted","detailCompleted","detailCursor","detailAttempt","detailErrorSection","detailLastError","detailCheckpoints","checkpoints","cp","action","originalText","endpoint","initIntegrationSyncRuns","bootstrapIntegrationSyncRuns","MAX_FILE_SIZE_DEFAULT","POLL_INTERVAL","MAX_POLL_ATTEMPTS","MIME_GOOGLE_DOC","MIME_PDF","MIME_FOLDER","DocumentFormController","tab","source","form","fileInput","uploadZone","clearBtn","titleInput","eventName","dt","importRetryBtn","driveAccountDropdown","refreshFiles","seen","panel","sourceObjectKeyInput","nameWithoutExt","placeholder","preview","fileName","fileSize","errorEl","submitBtn","hasFile","hasTitle","isEnabled","submitting","tenantId","orgId","uploadURL","objectKey","color","pageToken","importable","selected","isDisabled","isLast","typeInfo","importStatus","importTypeInfo","importTypeLabel","importTypeDesc","snapshotWarning","importStatusQueued","importStatusSuccess","importStatusFailed","importStatusMessage","errorCode","importErrorMessage","importReconnectLink","integrationsPath","pendingURL","statusURL","initDocumentForm","bootstrapDocumentForm","coerceDocumentFormConfig","routes","features","context","indexRoute","WIZARD_STATE_VERSION","WIZARD_STORAGE_KEY","WIZARD_CHANNEL_NAME","SYNC_DEBOUNCE_MS","SYNC_RETRY_DELAYS","WizardStateManager","stored","oldState","externalState","listener","updates","document","fieldDefinitions","fieldPlacements","step","serverDraftId","revision","saved","ServerSyncManager","stateManager","apiBase","onStatusChange","onConflict","method","AgreementFormController","localTime","serverTime","serverRevision","summary","resumeDialogModal","resumeDraftTitle","resumeDraftStep","resumeDraftTime","conflictDialogModal","conflictLocalTime","conflictServerTime","conflictServerRevision","syncStatusIndicator","syncStatusIcon","syncStatusText","syncRetryBtn","title","stepNum","isComplete","initAgreementForm","bootstrapAgreementForm","TelemetryManager","sync","eventsToSend","PDFViewerController","onPageChange","onScaleChange","newScale","scale","FieldOverlayController","overlayContainer","onFieldActivate","onFieldComplete","pageFields","overlay","myFields","required","fieldId","SignerReviewController","percentage","newValue","initSignerReview","bootstrapSignerReview","SignerErrorPageController","initSignerErrorPage","bootstrapSignerErrorPage","DocumentDetailPreviewController","loadBtn","prevBtn","nextBtn","loadingTask","totalPages","pageNumber","viewport","currentPageEl","spinner","viewer","initDocumentDetailPreview","bootstrapDocumentDetailPreview","previewConfig","documentId","pdfUrl","pageCount","PanelPaginationBehavior","env","_page","grid","PanelSearchBehavior","term","_term","normalizeFilterType","normalizeFilterOptions","o","normalizeFilterOperators","operators","defaultOperator","op","deduped","preferred","prepareGridColumns","columns","col","prepareFilterFields","filters","filter","dateTimeCellRenderer","fileSizeCellRenderer","defaultActionSuccessHandler","actionName","_result","notifier","defaultActionErrorHandler","fieldDetails","detail","prefix","setupRefreshButton","buttonId","createSchemaActionCachingRefresh","setCachedActions","originalRefresh","STANDARD_GRID_SELECTORS","MIME_GOOGLE_SHEET","MIME_GOOGLE_SLIDES","MIME_GOOGLE_FOLDER","IMPORTABLE_MIME_TYPES","isGoogleDoc","isPDF","isGoogleWorkspaceFile","normalizeDriveFile","normalizeDriveFiles","getFileTypeName","getFileIconConfig","resolveAccountId","templateAccountId","queryAccountId","normalizeAccountId","storedAccountId","trimmed","saveAccountId","applyAccountIdToPath","pathOrUrl","separator","buildScopedApiUrl","syncAccountIdToUrl","currentAccountId","escapeHtml","renderFileIcon","renderBreadcrumb","onNavigate","items","renderFileItem","selectable","showSize","showDate","iconHtml","isFolder_","isImportable_","selectableClass","dataAttrs","renderFileList","emptyMessage","b","createSelectedFile"],"mappings":"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"}