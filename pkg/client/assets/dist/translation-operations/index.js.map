{"version":3,"file":"index.js","sources":["../../src/translation-operations/index.ts"],"sourcesContent":["/**\n * Translation Operations Entrypoint Module\n *\n * Provides shared UI behavior for translation operations (queue/exchange)\n * based on backend capability metadata gating.\n *\n * Task 19.5: Uses resolver-based links from backend capabilities,\n * not ad-hoc template-only flags.\n */\n\n/**\n * Translation capability profile from backend\n */\nexport type TranslationProfile =\n  | 'none'\n  | 'core'\n  | 'core+exchange'\n  | 'core+queue'\n  | 'full';\n\n/**\n * Module enablement state\n */\nexport interface TranslationModuleState {\n  enabled: boolean;\n}\n\n/**\n * Translation capabilities from backend\n */\nexport interface TranslationCapabilities {\n  /** Active capability profile */\n  profile: TranslationProfile;\n  /** Schema version for compatibility */\n  schema_version: number;\n  /** Module enablement states */\n  modules: {\n    exchange: TranslationModuleState;\n    queue: TranslationModuleState;\n  };\n  /** Feature enablement states */\n  features: {\n    cms: boolean;\n    dashboard: boolean;\n  };\n  /** Resolver-based routes */\n  routes: Record<string, string>;\n  /** Registered panels */\n  panels: string[];\n  /** Available resolver keys */\n  resolver_keys: string[];\n  /** Configuration warnings */\n  warnings: string[];\n}\n\n/**\n * Entrypoint link definition\n */\nexport interface TranslationEntrypoint {\n  /** Unique identifier */\n  id: string;\n  /** Display label */\n  label: string;\n  /** Icon class (iconoir) */\n  icon: string;\n  /** Target URL (resolver-based) */\n  href: string;\n  /** Module that enables this entrypoint */\n  module: 'exchange' | 'queue' | 'core';\n  /** Whether this entrypoint is enabled */\n  enabled: boolean;\n  /** Optional description */\n  description?: string;\n  /** Badge text (e.g., \"New\") */\n  badge?: string;\n  /** Badge variant */\n  badgeVariant?: 'info' | 'warning' | 'success' | 'danger';\n}\n\n/**\n * Configuration for TranslationOperationsManager\n */\nexport interface TranslationOperationsConfig {\n  /** Base path for the admin UI */\n  basePath: string;\n  /** Translation capabilities from backend */\n  capabilities?: TranslationCapabilities;\n  /** Container element or selector for rendering entrypoints */\n  container?: HTMLElement | string;\n  /** Callback when an entrypoint is clicked */\n  onEntrypointClick?: (entrypoint: TranslationEntrypoint) => void;\n}\n\n/**\n * Default empty capabilities\n */\nconst EMPTY_CAPABILITIES: TranslationCapabilities = {\n  profile: 'none',\n  schema_version: 1,\n  modules: {\n    exchange: { enabled: false },\n    queue: { enabled: false },\n  },\n  features: {\n    cms: false,\n    dashboard: false,\n  },\n  routes: {},\n  panels: [],\n  resolver_keys: [],\n  warnings: [],\n};\n\n/**\n * Resolver route keys for translation operations\n */\nconst ROUTE_KEYS = {\n  QUEUE: 'admin.translations.queue',\n  EXCHANGE_UI: 'admin.translations.exchange',\n  EXCHANGE_EXPORT: 'admin.api.translations.export',\n  EXCHANGE_IMPORT_VALIDATE: 'admin.api.translations.import.validate',\n  EXCHANGE_IMPORT_APPLY: 'admin.api.translations.import.apply',\n} as const;\n\n/**\n * Extracts translation capabilities from page context\n * Looks for data embedded in a script tag or window object\n */\nexport function extractTranslationCapabilities(): TranslationCapabilities {\n  // Try window object first (set by layout template)\n  if (typeof window !== 'undefined' && (window as any).__TRANSLATION_CAPABILITIES__) {\n    return normalizeCapabilities((window as any).__TRANSLATION_CAPABILITIES__);\n  }\n\n  // Try script tag with JSON data\n  const scriptEl = document.querySelector('script[data-translation-capabilities]');\n  if (scriptEl) {\n    try {\n      const rawData = scriptEl.textContent || '';\n      const parsed = JSON.parse(rawData);\n      return normalizeCapabilities(parsed);\n    } catch {\n      // Fall through to default\n    }\n  }\n\n  // Try data attribute on body\n  const body = document.body;\n  if (body?.dataset?.translationCapabilities) {\n    try {\n      return normalizeCapabilities(JSON.parse(body.dataset.translationCapabilities));\n    } catch {\n      // Fall through to default\n    }\n  }\n\n  return { ...EMPTY_CAPABILITIES };\n}\n\n/**\n * Normalizes raw capability data to ensure type safety\n */\nfunction normalizeCapabilities(raw: unknown): TranslationCapabilities {\n  if (!raw || typeof raw !== 'object') {\n    return { ...EMPTY_CAPABILITIES };\n  }\n\n  const data = raw as Record<string, unknown>;\n\n  const modules = typeof data.modules === 'object' && data.modules\n    ? data.modules as Record<string, unknown>\n    : {};\n\n  const features = typeof data.features === 'object' && data.features\n    ? data.features as Record<string, unknown>\n    : {};\n\n  return {\n    profile: normalizeProfile(data.profile),\n    schema_version: typeof data.schema_version === 'number' ? data.schema_version : 1,\n    modules: {\n      exchange: { enabled: extractModuleEnabled(modules.exchange) },\n      queue: { enabled: extractModuleEnabled(modules.queue) },\n    },\n    features: {\n      cms: typeof features.cms === 'boolean' ? features.cms : false,\n      dashboard: typeof features.dashboard === 'boolean' ? features.dashboard : false,\n    },\n    routes: typeof data.routes === 'object' && data.routes\n      ? data.routes as Record<string, string>\n      : {},\n    panels: Array.isArray(data.panels) ? data.panels.filter(p => typeof p === 'string') : [],\n    resolver_keys: Array.isArray(data.resolver_keys)\n      ? data.resolver_keys.filter(k => typeof k === 'string')\n      : [],\n    warnings: Array.isArray(data.warnings) ? data.warnings.filter(w => typeof w === 'string') : [],\n  };\n}\n\nfunction normalizeProfile(value: unknown): TranslationProfile {\n  if (typeof value !== 'string') return 'none';\n  const normalized = value.toLowerCase().trim();\n  const valid: TranslationProfile[] = ['none', 'core', 'core+exchange', 'core+queue', 'full'];\n  return valid.includes(normalized as TranslationProfile)\n    ? (normalized as TranslationProfile)\n    : 'none';\n}\n\nfunction extractModuleEnabled(value: unknown): boolean {\n  if (typeof value === 'boolean') return value;\n  if (typeof value === 'object' && value) {\n    const obj = value as Record<string, unknown>;\n    return typeof obj.enabled === 'boolean' ? obj.enabled : false;\n  }\n  return false;\n}\n\n/**\n * Checks if translation exchange module is enabled\n */\nexport function isExchangeEnabled(caps?: TranslationCapabilities): boolean {\n  const c = caps ?? extractTranslationCapabilities();\n  return c.modules.exchange.enabled;\n}\n\n/**\n * Checks if translation queue module is enabled\n */\nexport function isQueueEnabled(caps?: TranslationCapabilities): boolean {\n  const c = caps ?? extractTranslationCapabilities();\n  return c.modules.queue.enabled;\n}\n\n/**\n * Checks if any translation operations module is enabled\n */\nexport function hasTranslationOperations(caps?: TranslationCapabilities): boolean {\n  return isExchangeEnabled(caps) || isQueueEnabled(caps);\n}\n\n/**\n * Gets the resolved route for a translation operation\n */\nexport function getTranslationRoute(\n  key: keyof typeof ROUTE_KEYS,\n  caps?: TranslationCapabilities,\n  basePath?: string\n): string | null {\n  const c = caps ?? extractTranslationCapabilities();\n  const routeKey = ROUTE_KEYS[key];\n\n  // Check resolver-based route first\n  if (c.routes[routeKey]) {\n    return c.routes[routeKey];\n  }\n\n  // Fallback to base path construction\n  const base = (basePath ?? '').replace(/\\/+$/, '');\n  switch (key) {\n    case 'QUEUE':\n      return c.modules.queue.enabled ? `${base}/translations/queue` : null;\n    case 'EXCHANGE_UI':\n      return c.modules.exchange.enabled ? `${base}/translations/exchange` : null;\n    default:\n      return null;\n  }\n}\n\n/**\n * Builds the list of available translation operation entrypoints\n * based on backend capability metadata\n */\nexport function buildTranslationEntrypoints(\n  caps?: TranslationCapabilities,\n  basePath?: string\n): TranslationEntrypoint[] {\n  const c = caps ?? extractTranslationCapabilities();\n  const base = (basePath ?? '').replace(/\\/+$/, '');\n  const entrypoints: TranslationEntrypoint[] = [];\n\n  // Queue entrypoint\n  const queueRoute = getTranslationRoute('QUEUE', c, base);\n  if (c.modules.queue.enabled && queueRoute) {\n    entrypoints.push({\n      id: 'translation-queue',\n      label: 'Translation Queue',\n      icon: 'iconoir-language',\n      href: queueRoute,\n      module: 'queue',\n      enabled: true,\n      description: 'Manage translation assignments and review workflow',\n    });\n  }\n\n  // Exchange entrypoint\n  const exchangeRoute = getTranslationRoute('EXCHANGE_UI', c, base);\n  if (c.modules.exchange.enabled && exchangeRoute) {\n    entrypoints.push({\n      id: 'translation-exchange',\n      label: 'Translation Exchange',\n      icon: 'iconoir-translate',\n      href: exchangeRoute,\n      module: 'exchange',\n      enabled: true,\n      description: 'Export and import translation files',\n    });\n  }\n\n  return entrypoints;\n}\n\n/**\n * Renders a single entrypoint as an HTML element\n * Includes accessibility attributes for screen readers\n */\nexport function renderEntrypointLink(\n  entrypoint: TranslationEntrypoint,\n  options?: { asListItem?: boolean; className?: string }\n): HTMLElement {\n  const { asListItem = false, className = '' } = options ?? {};\n\n  const link = document.createElement('a');\n  link.href = entrypoint.href;\n  link.className = `nav-item translation-operation-link ${className}`.trim();\n  link.setAttribute('data-entrypoint-id', entrypoint.id);\n  link.setAttribute('data-module', entrypoint.module);\n\n  // Accessibility: descriptive label and tooltip\n  const description = entrypoint.description || entrypoint.label;\n  link.setAttribute('aria-label', description);\n  link.setAttribute('title', description);\n\n  // Icon (decorative - hidden from screen readers)\n  const icon = document.createElement('i');\n  icon.className = `${entrypoint.icon} flex-shrink-0`;\n  icon.style.fontSize = 'var(--sidebar-icon-size, 20px)';\n  icon.setAttribute('aria-hidden', 'true');\n  link.appendChild(icon);\n\n  // Label\n  const label = document.createElement('span');\n  label.className = 'nav-text flex-1';\n  label.textContent = entrypoint.label;\n  link.appendChild(label);\n\n  // Badge (if present)\n  if (entrypoint.badge) {\n    const badge = document.createElement('span');\n    const variantClass = entrypoint.badgeVariant === 'warning'\n      ? 'bg-yellow-500/20 text-yellow-400'\n      : entrypoint.badgeVariant === 'danger'\n      ? 'bg-red-500/20 text-red-400'\n      : entrypoint.badgeVariant === 'success'\n      ? 'bg-green-500/20 text-green-400'\n      : 'bg-blue-500/20 text-blue-400';\n    badge.className = `ml-auto px-2 py-0.5 ${variantClass} text-xs font-medium rounded`;\n    badge.textContent = entrypoint.badge;\n    badge.setAttribute('aria-label', `${entrypoint.badge} badge`);\n    link.appendChild(badge);\n  }\n\n  if (asListItem) {\n    const li = document.createElement('li');\n    li.appendChild(link);\n    return li;\n  }\n\n  return link;\n}\n\n/**\n * Renders all enabled translation operation entrypoints\n */\nexport function renderTranslationEntrypoints(\n  container: HTMLElement | string,\n  caps?: TranslationCapabilities,\n  basePath?: string,\n  options?: { asListItems?: boolean; headerLabel?: string }\n): void {\n  const { asListItems = false, headerLabel } = options ?? {};\n  const containerEl = typeof container === 'string'\n    ? document.querySelector<HTMLElement>(container)\n    : container;\n\n  if (!containerEl) return;\n\n  const entrypoints = buildTranslationEntrypoints(caps, basePath);\n  if (entrypoints.length === 0) {\n    containerEl.style.display = 'none';\n    return;\n  }\n\n  containerEl.style.display = '';\n  containerEl.innerHTML = '';\n\n  // Accessibility: wrap in nav element with aria-label\n  const nav = document.createElement('nav');\n  nav.setAttribute('aria-label', headerLabel || 'Translation operations');\n  nav.setAttribute('role', 'navigation');\n\n  // Optional header\n  if (headerLabel) {\n    const headerId = `translation-ops-header-${Date.now()}`;\n    const header = document.createElement('h3');\n    header.id = headerId;\n    header.className = 'text-xs font-medium text-sidebar-text-muted uppercase tracking-wider px-3 py-2';\n    header.textContent = headerLabel;\n    nav.appendChild(header);\n    nav.setAttribute('aria-labelledby', headerId);\n  }\n\n  // Render entrypoints as list for better accessibility\n  const wrapper = asListItems ? document.createElement('ul') : document.createElement('div');\n  wrapper.className = asListItems ? 'space-y-0.5' : 'space-y-0.5';\n  if (asListItems) {\n    wrapper.setAttribute('role', 'list');\n  }\n\n  for (const entrypoint of entrypoints) {\n    const el = renderEntrypointLink(entrypoint, { asListItem: asListItems });\n    wrapper.appendChild(el);\n  }\n\n  nav.appendChild(wrapper);\n  containerEl.appendChild(nav);\n}\n\n/**\n * Manager class for translation operations UI\n */\nexport class TranslationOperationsManager {\n  private config: Required<TranslationOperationsConfig>;\n  private capabilities: TranslationCapabilities;\n  private entrypoints: TranslationEntrypoint[] = [];\n\n  constructor(config: TranslationOperationsConfig) {\n    this.config = {\n      basePath: config.basePath,\n      capabilities: config.capabilities ?? extractTranslationCapabilities(),\n      container: config.container ?? '[data-translation-operations]',\n      onEntrypointClick: config.onEntrypointClick ?? (() => {}),\n    };\n    this.capabilities = this.config.capabilities;\n    this.entrypoints = buildTranslationEntrypoints(this.capabilities, this.config.basePath);\n  }\n\n  /** Get capabilities */\n  getCapabilities(): TranslationCapabilities {\n    return this.capabilities;\n  }\n\n  /** Get available entrypoints */\n  getEntrypoints(): TranslationEntrypoint[] {\n    return this.entrypoints;\n  }\n\n  /** Check if any operations are available */\n  hasOperations(): boolean {\n    return this.entrypoints.length > 0;\n  }\n\n  /** Check if exchange is enabled */\n  isExchangeEnabled(): boolean {\n    return isExchangeEnabled(this.capabilities);\n  }\n\n  /** Check if queue is enabled */\n  isQueueEnabled(): boolean {\n    return isQueueEnabled(this.capabilities);\n  }\n\n  /** Get route for a specific operation */\n  getRoute(key: keyof typeof ROUTE_KEYS): string | null {\n    return getTranslationRoute(key, this.capabilities, this.config.basePath);\n  }\n\n  /** Initialize and render entrypoints */\n  init(): void {\n    if (!this.hasOperations()) return;\n\n    const container = typeof this.config.container === 'string'\n      ? document.querySelector<HTMLElement>(this.config.container)\n      : this.config.container;\n\n    if (!container) return;\n\n    renderTranslationEntrypoints(\n      container,\n      this.capabilities,\n      this.config.basePath,\n      { headerLabel: 'Translations' }\n    );\n\n    // Bind click handlers\n    container.querySelectorAll<HTMLAnchorElement>('.translation-operation-link').forEach(link => {\n      link.addEventListener('click', (e) => {\n        const entrypointId = link.dataset.entrypointId;\n        const entrypoint = this.entrypoints.find(ep => ep.id === entrypointId);\n        if (entrypoint && this.config.onEntrypointClick) {\n          this.config.onEntrypointClick(entrypoint);\n        }\n      });\n    });\n  }\n}\n\n/**\n * Auto-initializes translation operations if container exists\n */\nexport function initTranslationOperations(basePath?: string): TranslationOperationsManager | null {\n  const container = document.querySelector<HTMLElement>('[data-translation-operations]');\n  if (!container) return null;\n\n  const manager = new TranslationOperationsManager({\n    basePath: basePath ?? '',\n  });\n  manager.init();\n  return manager;\n}\n"],"names":["EMPTY_CAPABILITIES","ROUTE_KEYS","extractTranslationCapabilities","normalizeCapabilities","scriptEl","rawData","parsed","body","raw","data","modules","features","normalizeProfile","extractModuleEnabled","p","k","w","value","normalized","obj","isExchangeEnabled","caps","isQueueEnabled","hasTranslationOperations","getTranslationRoute","key","basePath","c","routeKey","base","buildTranslationEntrypoints","entrypoints","queueRoute","exchangeRoute","renderEntrypointLink","entrypoint","options","asListItem","className","link","description","icon","label","badge","variantClass","li","renderTranslationEntrypoints","container","asListItems","headerLabel","containerEl","nav","headerId","header","wrapper","el","TranslationOperationsManager","config","e","entrypointId","ep","initTranslationOperations","manager"],"mappings":"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"}