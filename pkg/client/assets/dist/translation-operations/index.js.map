{"version":3,"file":"index.js","sources":["../../src/translation-operations/index.ts"],"sourcesContent":["/**\n * Translation Operations Entrypoint Module\n *\n * Provides shared UI behavior for translation operations (queue/exchange)\n * based on backend capability metadata gating.\n *\n * Task 19.5: Uses resolver-based links from backend capabilities,\n * not ad-hoc template-only flags.\n */\n\n/**\n * Translation capability profile from backend\n */\nexport type TranslationProfile =\n  | 'none'\n  | 'core'\n  | 'core+exchange'\n  | 'core+queue'\n  | 'full';\n\n/**\n * Module enablement state\n */\nexport interface TranslationModuleState {\n  enabled: boolean;\n  visible?: boolean;\n  entry?: {\n    enabled: boolean;\n    reason?: string;\n    reason_code?: string;\n    permission?: string;\n  };\n  actions?: Record<string, {\n    enabled: boolean;\n    reason?: string;\n    reason_code?: string;\n    permission?: string;\n  }>;\n}\n\n/**\n * Translation capabilities from backend\n */\nexport interface TranslationCapabilities {\n  /** Active capability profile */\n  profile: TranslationProfile;\n  /** Schema version for compatibility */\n  schema_version: number;\n  /** Module enablement states */\n  modules: {\n    exchange: TranslationModuleState;\n    queue: TranslationModuleState;\n  };\n  /** Feature enablement states */\n  features: {\n    cms: boolean;\n    dashboard: boolean;\n  };\n  /** Resolver-based routes */\n  routes: Record<string, string>;\n  /** Registered panels */\n  panels: string[];\n  /** Available resolver keys */\n  resolver_keys: string[];\n  /** Configuration warnings */\n  warnings: string[];\n}\n\n/**\n * Entrypoint link definition\n */\nexport interface TranslationEntrypoint {\n  /** Unique identifier */\n  id: string;\n  /** Display label */\n  label: string;\n  /** Icon class (iconoir) */\n  icon: string;\n  /** Target URL (resolver-based) */\n  href: string;\n  /** Module that enables this entrypoint */\n  module: 'exchange' | 'queue' | 'core';\n  /** Whether this entrypoint is enabled */\n  enabled: boolean;\n  /** Optional description */\n  description?: string;\n  /** Disabled reason when visible but not actionable */\n  disabledReason?: string;\n  /** Machine-readable disabled code */\n  disabledReasonCode?: string;\n  /** Permission evaluated for this entrypoint */\n  permission?: string;\n  /** Badge text (e.g., \"New\") */\n  badge?: string;\n  /** Badge variant */\n  badgeVariant?: 'info' | 'warning' | 'success' | 'danger';\n}\n\n/**\n * Configuration for TranslationOperationsManager\n */\nexport interface TranslationOperationsConfig {\n  /** Base path for the admin UI */\n  basePath: string;\n  /** Translation capabilities from backend */\n  capabilities?: TranslationCapabilities;\n  /** Container element or selector for rendering entrypoints */\n  container?: HTMLElement | string;\n  /** Callback when an entrypoint is clicked */\n  onEntrypointClick?: (entrypoint: TranslationEntrypoint) => void;\n}\n\n/**\n * Default empty capabilities\n */\nconst EMPTY_CAPABILITIES: TranslationCapabilities = {\n  profile: 'none',\n  schema_version: 1,\n  modules: {\n    exchange: { enabled: false },\n    queue: { enabled: false },\n  },\n  features: {\n    cms: false,\n    dashboard: false,\n  },\n  routes: {},\n  panels: [],\n  resolver_keys: [],\n  warnings: [],\n};\n\n/**\n * Resolver route keys for translation operations\n */\nconst ROUTE_KEYS = {\n  QUEUE: 'admin.translations.queue',\n  EXCHANGE_UI: 'admin.translations.exchange',\n  EXCHANGE_EXPORT: 'admin.api.translations.export',\n  EXCHANGE_IMPORT_VALIDATE: 'admin.api.translations.import.validate',\n  EXCHANGE_IMPORT_APPLY: 'admin.api.translations.import.apply',\n} as const;\n\n/**\n * Extracts translation capabilities from page context\n * Looks for data embedded in a script tag or window object\n */\nexport function extractTranslationCapabilities(): TranslationCapabilities {\n  // Try window object first (set by layout template)\n  if (typeof window !== 'undefined' && (window as any).__TRANSLATION_CAPABILITIES__) {\n    return normalizeCapabilities((window as any).__TRANSLATION_CAPABILITIES__);\n  }\n\n  // Try script tag with JSON data\n  const scriptEl = document.querySelector('script[data-translation-capabilities]');\n  if (scriptEl) {\n    try {\n      const rawData = scriptEl.textContent || '';\n      const parsed = JSON.parse(rawData);\n      return normalizeCapabilities(parsed);\n    } catch {\n      // Fall through to default\n    }\n  }\n\n  // Try data attribute on body\n  const body = document.body;\n  if (body?.dataset?.translationCapabilities) {\n    try {\n      return normalizeCapabilities(JSON.parse(body.dataset.translationCapabilities));\n    } catch {\n      // Fall through to default\n    }\n  }\n\n  return { ...EMPTY_CAPABILITIES };\n}\n\n/**\n * Normalizes raw capability data to ensure type safety\n */\nfunction normalizeCapabilities(raw: unknown): TranslationCapabilities {\n  if (!raw || typeof raw !== 'object') {\n    return { ...EMPTY_CAPABILITIES };\n  }\n\n  const data = raw as Record<string, unknown>;\n\n  const modules = typeof data.modules === 'object' && data.modules\n    ? data.modules as Record<string, unknown>\n    : {};\n\n  const features = typeof data.features === 'object' && data.features\n    ? data.features as Record<string, unknown>\n    : {};\n\n  return {\n    profile: normalizeProfile(data.profile),\n    schema_version: typeof data.schema_version === 'number' ? data.schema_version : 1,\n    modules: {\n      exchange: extractModuleState(modules.exchange),\n      queue: extractModuleState(modules.queue),\n    },\n    features: {\n      cms: typeof features.cms === 'boolean' ? features.cms : false,\n      dashboard: typeof features.dashboard === 'boolean' ? features.dashboard : false,\n    },\n    routes: normalizeRoutes(data.routes),\n    panels: Array.isArray(data.panels) ? data.panels.filter(p => typeof p === 'string') : [],\n    resolver_keys: Array.isArray(data.resolver_keys)\n      ? data.resolver_keys.filter(k => typeof k === 'string')\n      : [],\n    warnings: Array.isArray(data.warnings) ? data.warnings.filter(w => typeof w === 'string') : [],\n  };\n}\n\nfunction normalizeRoutes(value: unknown): Record<string, string> {\n  if (!value || typeof value !== 'object') {\n    return {};\n  }\n  const raw = value as Record<string, unknown>;\n  const routes: Record<string, string> = {};\n  for (const [key, candidate] of Object.entries(raw)) {\n    const route = typeof candidate === 'string' ? candidate.trim() : '';\n    if (!route) continue;\n    routes[key] = route;\n  }\n  return routes;\n}\n\nfunction normalizeProfile(value: unknown): TranslationProfile {\n  if (typeof value !== 'string') return 'none';\n  const normalized = value.toLowerCase().trim();\n  const valid: TranslationProfile[] = ['none', 'core', 'core+exchange', 'core+queue', 'full'];\n  return valid.includes(normalized as TranslationProfile)\n    ? (normalized as TranslationProfile)\n    : 'none';\n}\n\nfunction extractModuleState(value: unknown): TranslationModuleState {\n  if (typeof value === 'boolean') {\n    return {\n      enabled: value,\n      visible: value,\n      entry: { enabled: value },\n      actions: {},\n    };\n  }\n  if (!value || typeof value !== 'object') {\n    return { enabled: false, visible: false };\n  }\n  const obj = value as Record<string, unknown>;\n  const enabled = obj.enabled === true;\n  const entry = extractActionState(obj.entry);\n  const visible = typeof obj.visible === 'boolean'\n    ? obj.visible\n    : enabled && (entry ? entry.enabled : true);\n  const actionsRaw = obj.actions && typeof obj.actions === 'object'\n    ? obj.actions as Record<string, unknown>\n    : {};\n  const actions: Record<string, NonNullable<TranslationModuleState['entry']>> = {};\n  for (const [key, actionValue] of Object.entries(actionsRaw)) {\n    const actionState = extractActionState(actionValue);\n    if (actionState) {\n      actions[key] = actionState;\n    }\n  }\n  return {\n    enabled,\n    visible,\n    entry: entry ?? { enabled },\n    actions,\n  };\n}\n\nfunction extractActionState(value: unknown): TranslationModuleState['entry'] | null {\n  if (!value || typeof value !== 'object') {\n    return null;\n  }\n  const raw = value as Record<string, unknown>;\n  return {\n    enabled: raw.enabled === true,\n    reason: typeof raw.reason === 'string' ? raw.reason : undefined,\n    reason_code: typeof raw.reason_code === 'string' ? raw.reason_code : undefined,\n    permission: typeof raw.permission === 'string' ? raw.permission : undefined,\n  };\n}\n\nfunction moduleGate(\n  state: TranslationModuleState | undefined\n): { visible: boolean; enabled: boolean; reason?: string; reasonCode?: string; permission?: string } {\n  if (!state) {\n    return { visible: false, enabled: false };\n  }\n  const visible = state.visible === true || (state.visible === undefined && state.enabled);\n  const entry = state.entry ?? { enabled: state.enabled };\n  const entryEnabled = entry.enabled === true;\n  const reason = entry.reason || (!state.enabled ? 'module disabled by capability mode' : undefined);\n  const reasonCode = entry.reason_code || (!state.enabled ? 'FEATURE_DISABLED' : undefined);\n  const permission = entry.permission;\n  if (!visible) {\n    return {\n      visible: false,\n      enabled: false,\n      reason,\n      reasonCode,\n      permission,\n    };\n  }\n  if (!state.enabled || !entryEnabled) {\n    return {\n      visible: true,\n      enabled: false,\n      reason,\n      reasonCode,\n      permission,\n    };\n  }\n  return { visible: true, enabled: true };\n}\n\n/**\n * Checks if translation exchange module is enabled\n */\nexport function isExchangeEnabled(caps?: TranslationCapabilities): boolean {\n  const c = caps ?? extractTranslationCapabilities();\n  return c.modules.exchange.enabled;\n}\n\n/**\n * Checks if translation queue module is enabled\n */\nexport function isQueueEnabled(caps?: TranslationCapabilities): boolean {\n  const c = caps ?? extractTranslationCapabilities();\n  return c.modules.queue.enabled;\n}\n\n/**\n * Checks if any translation operations module is enabled\n */\nexport function hasTranslationOperations(caps?: TranslationCapabilities): boolean {\n  return isExchangeEnabled(caps) || isQueueEnabled(caps);\n}\n\n/**\n * Gets the resolved route for a translation operation\n */\nexport function getTranslationRoute(\n  key: keyof typeof ROUTE_KEYS,\n  caps?: TranslationCapabilities,\n  basePath?: string\n): string | null {\n  const c = caps ?? extractTranslationCapabilities();\n  const routeKey = ROUTE_KEYS[key];\n\n  // Check resolver-based route first\n  if (c.routes[routeKey]) {\n    return c.routes[routeKey];\n  }\n\n  // Fallback to base path construction\n  const base = (basePath ?? '').replace(/\\/+$/, '');\n  switch (key) {\n    case 'QUEUE':\n      return c.modules.queue.enabled ? `${base}/content/translations` : null;\n    case 'EXCHANGE_UI':\n      return c.modules.exchange.enabled ? `${base}/translations/exchange` : null;\n    default:\n      return null;\n  }\n}\n\n/**\n * Builds the list of available translation operation entrypoints\n * based on backend capability metadata\n */\nexport function buildTranslationEntrypoints(\n  caps?: TranslationCapabilities,\n  basePath?: string\n): TranslationEntrypoint[] {\n  const c = caps ?? extractTranslationCapabilities();\n  const base = (basePath ?? '').replace(/\\/+$/, '');\n  const entrypoints: TranslationEntrypoint[] = [];\n\n  // Queue entrypoint\n  const queueGate = moduleGate(c.modules.queue);\n  const queueRoute = getTranslationRoute('QUEUE', c, base);\n  if (queueGate.visible && queueRoute) {\n    entrypoints.push({\n      id: 'translation-queue',\n      label: 'Translation Queue',\n      icon: 'iconoir-language',\n      href: queueRoute,\n      module: 'queue',\n      enabled: queueGate.enabled,\n      description: 'Manage translation assignments and review workflow',\n      disabledReason: queueGate.reason,\n      disabledReasonCode: queueGate.reasonCode,\n      permission: queueGate.permission,\n    });\n  }\n\n  // Exchange entrypoint\n  const exchangeGate = moduleGate(c.modules.exchange);\n  const exchangeRoute = getTranslationRoute('EXCHANGE_UI', c, base);\n  if (exchangeGate.visible && exchangeRoute) {\n    entrypoints.push({\n      id: 'translation-exchange',\n      label: 'Translation Exchange',\n      icon: 'iconoir-translate',\n      href: exchangeRoute,\n      module: 'exchange',\n      enabled: exchangeGate.enabled,\n      description: 'Export and import translation files',\n      disabledReason: exchangeGate.reason,\n      disabledReasonCode: exchangeGate.reasonCode,\n      permission: exchangeGate.permission,\n    });\n  }\n\n  return entrypoints;\n}\n\n/**\n * Renders a single entrypoint as an HTML element\n * Includes accessibility attributes for screen readers\n */\nexport function renderEntrypointLink(\n  entrypoint: TranslationEntrypoint,\n  options?: { asListItem?: boolean; className?: string }\n): HTMLElement {\n  const { asListItem = false, className = '' } = options ?? {};\n\n  const link = document.createElement('a');\n  link.href = entrypoint.enabled ? entrypoint.href : '#';\n  link.className = `nav-item translation-operation-link ${className}`.trim();\n  link.setAttribute('data-entrypoint-id', entrypoint.id);\n  link.setAttribute('data-module', entrypoint.module);\n  link.setAttribute('data-enabled', entrypoint.enabled ? 'true' : 'false');\n  if (!entrypoint.enabled) {\n    link.setAttribute('aria-disabled', 'true');\n    link.classList.add('opacity-60', 'cursor-not-allowed');\n  }\n\n  // Accessibility: descriptive label and tooltip\n  const disabledReason = entrypoint.disabledReason?.trim();\n  const description = disabledReason\n    ? `${entrypoint.description || entrypoint.label} (${disabledReason})`\n    : (entrypoint.description || entrypoint.label);\n  link.setAttribute('aria-label', description);\n  link.setAttribute('title', description);\n\n  // Icon (decorative - hidden from screen readers)\n  const icon = document.createElement('i');\n  icon.className = `${entrypoint.icon} flex-shrink-0`;\n  icon.style.fontSize = 'var(--sidebar-icon-size, 20px)';\n  icon.setAttribute('aria-hidden', 'true');\n  link.appendChild(icon);\n\n  // Label\n  const label = document.createElement('span');\n  label.className = 'nav-text flex-1';\n  label.textContent = entrypoint.label;\n  link.appendChild(label);\n\n  // Badge (if present)\n  if (entrypoint.badge) {\n    const badge = document.createElement('span');\n    const variantClass = entrypoint.badgeVariant === 'warning'\n      ? 'bg-yellow-500/20 text-yellow-400'\n      : entrypoint.badgeVariant === 'danger'\n      ? 'bg-red-500/20 text-red-400'\n      : entrypoint.badgeVariant === 'success'\n      ? 'bg-green-500/20 text-green-400'\n      : 'bg-blue-500/20 text-blue-400';\n    badge.className = `ml-auto px-2 py-0.5 ${variantClass} text-xs font-medium rounded`;\n    badge.textContent = entrypoint.badge;\n    badge.setAttribute('aria-label', `${entrypoint.badge} badge`);\n    link.appendChild(badge);\n  }\n\n  if (!entrypoint.enabled) {\n    link.addEventListener('click', (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n    });\n  }\n\n  if (asListItem) {\n    const li = document.createElement('li');\n    li.appendChild(link);\n    return li;\n  }\n\n  return link;\n}\n\n/**\n * Renders all enabled translation operation entrypoints\n */\nexport function renderTranslationEntrypoints(\n  container: HTMLElement | string,\n  caps?: TranslationCapabilities,\n  basePath?: string,\n  options?: { asListItems?: boolean; headerLabel?: string }\n): void {\n  const { asListItems = false, headerLabel } = options ?? {};\n  const containerEl = typeof container === 'string'\n    ? document.querySelector<HTMLElement>(container)\n    : container;\n\n  if (!containerEl) return;\n\n  const entrypoints = buildTranslationEntrypoints(caps, basePath);\n  if (entrypoints.length === 0) {\n    containerEl.style.display = 'none';\n    return;\n  }\n\n  containerEl.style.display = '';\n  containerEl.innerHTML = '';\n\n  // Accessibility: wrap in nav element with aria-label\n  const nav = document.createElement('nav');\n  nav.setAttribute('aria-label', headerLabel || 'Translation operations');\n  nav.setAttribute('role', 'navigation');\n\n  // Optional header\n  if (headerLabel) {\n    const headerId = `translation-ops-header-${Date.now()}`;\n    const header = document.createElement('h3');\n    header.id = headerId;\n    header.className = 'text-xs font-medium text-sidebar-text-muted uppercase tracking-wider px-3 py-2';\n    header.textContent = headerLabel;\n    nav.appendChild(header);\n    nav.setAttribute('aria-labelledby', headerId);\n  }\n\n  // Render entrypoints as list for better accessibility\n  const wrapper = asListItems ? document.createElement('ul') : document.createElement('div');\n  wrapper.className = asListItems ? 'space-y-0.5' : 'space-y-0.5';\n  if (asListItems) {\n    wrapper.setAttribute('role', 'list');\n  }\n\n  for (const entrypoint of entrypoints) {\n    const el = renderEntrypointLink(entrypoint, { asListItem: asListItems });\n    wrapper.appendChild(el);\n  }\n\n  nav.appendChild(wrapper);\n  containerEl.appendChild(nav);\n}\n\n/**\n * Manager class for translation operations UI\n */\nexport class TranslationOperationsManager {\n  private config: Required<TranslationOperationsConfig>;\n  private capabilities: TranslationCapabilities;\n  private entrypoints: TranslationEntrypoint[] = [];\n\n  constructor(config: TranslationOperationsConfig) {\n    this.config = {\n      basePath: config.basePath,\n      capabilities: config.capabilities ?? extractTranslationCapabilities(),\n      container: config.container ?? '[data-translation-operations]',\n      onEntrypointClick: config.onEntrypointClick ?? (() => {}),\n    };\n    this.capabilities = this.config.capabilities;\n    this.entrypoints = buildTranslationEntrypoints(this.capabilities, this.config.basePath);\n  }\n\n  /** Get capabilities */\n  getCapabilities(): TranslationCapabilities {\n    return this.capabilities;\n  }\n\n  /** Get available entrypoints */\n  getEntrypoints(): TranslationEntrypoint[] {\n    return this.entrypoints;\n  }\n\n  /** Check if any operations are available */\n  hasOperations(): boolean {\n    return this.entrypoints.length > 0;\n  }\n\n  /** Check if exchange is enabled */\n  isExchangeEnabled(): boolean {\n    return isExchangeEnabled(this.capabilities);\n  }\n\n  /** Check if queue is enabled */\n  isQueueEnabled(): boolean {\n    return isQueueEnabled(this.capabilities);\n  }\n\n  /** Get route for a specific operation */\n  getRoute(key: keyof typeof ROUTE_KEYS): string | null {\n    return getTranslationRoute(key, this.capabilities, this.config.basePath);\n  }\n\n  /** Initialize and render entrypoints */\n  init(): void {\n    if (!this.hasOperations()) return;\n\n    const container = typeof this.config.container === 'string'\n      ? document.querySelector<HTMLElement>(this.config.container)\n      : this.config.container;\n\n    if (!container) return;\n\n    renderTranslationEntrypoints(\n      container,\n      this.capabilities,\n      this.config.basePath,\n      { headerLabel: 'Translations' }\n    );\n\n    // Bind click handlers\n    container.querySelectorAll<HTMLAnchorElement>('.translation-operation-link').forEach(link => {\n      link.addEventListener('click', (e) => {\n        const entrypointId = link.dataset.entrypointId;\n        const entrypoint = this.entrypoints.find(ep => ep.id === entrypointId);\n        if (!entrypoint || !entrypoint.enabled) {\n          e.preventDefault();\n          return;\n        }\n        if (this.config.onEntrypointClick) {\n          this.config.onEntrypointClick(entrypoint);\n        }\n      });\n    });\n  }\n}\n\n/**\n * Auto-initializes translation operations if container exists\n */\nexport function initTranslationOperations(basePath?: string): TranslationOperationsManager | null {\n  const container = document.querySelector<HTMLElement>('[data-translation-operations]');\n  if (!container) return null;\n\n  const manager = new TranslationOperationsManager({\n    basePath: basePath ?? '',\n  });\n  manager.init();\n  return manager;\n}\n"],"names":["EMPTY_CAPABILITIES","ROUTE_KEYS","extractTranslationCapabilities","normalizeCapabilities","scriptEl","rawData","parsed","body","raw","data","modules","features","normalizeProfile","extractModuleState","normalizeRoutes","p","k","w","value","routes","key","candidate","route","normalized","obj","enabled","entry","extractActionState","visible","actionsRaw","actions","actionValue","actionState","moduleGate","state","entryEnabled","reason","reasonCode","permission","isExchangeEnabled","caps","isQueueEnabled","hasTranslationOperations","getTranslationRoute","basePath","c","routeKey","base","buildTranslationEntrypoints","entrypoints","queueGate","queueRoute","exchangeGate","exchangeRoute","renderEntrypointLink","entrypoint","options","asListItem","className","link","disabledReason","description","icon","label","badge","variantClass","event","li","renderTranslationEntrypoints","container","asListItems","headerLabel","containerEl","nav","headerId","header","wrapper","el","TranslationOperationsManager","config","e","entrypointId","ep","initTranslationOperations","manager"],"mappings":"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"}