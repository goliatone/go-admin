{"version":3,"file":"permission-pills.js","sources":["../../src/components/permission-pills.ts"],"sourcesContent":["type ActionConfig = {\n  initial: string;\n  bg: string;\n  text: string;\n  border: string;\n};\n\ntype PermissionPillsOptions = {\n  maxVisible?: number;\n};\n\nexport const actionConfig: Record<string, ActionConfig> = {\n  view: { initial: 'V', bg: 'bg-blue-100', text: 'text-blue-700', border: 'border-blue-200' },\n  create: { initial: 'C', bg: 'bg-green-100', text: 'text-green-700', border: 'border-green-200' },\n  edit: { initial: 'E', bg: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-200' },\n  delete: { initial: 'D', bg: 'bg-red-100', text: 'text-red-700', border: 'border-red-200' },\n};\n\nconst parsePermissions = (value: unknown) => {\n  if (!value) return [];\n  if (Array.isArray(value)) return value.filter(Boolean).map(String);\n  return String(value)\n    .split(/[,\\n]/)\n    .map((item) => item.trim())\n    .filter(Boolean);\n};\n\nconst groupByResource = (perms: string[]) => {\n  const grouped: Record<string, string[]> = {};\n  perms.forEach((perm) => {\n    const parts = perm.split('.');\n    const action = parts.pop() || '';\n    const resource = parts.join('.');\n    if (!grouped[resource]) {\n      grouped[resource] = [];\n    }\n    grouped[resource].push(action);\n  });\n  return grouped;\n};\n\nconst buildActionBadges = (actions: string[]) =>\n  actions\n    .map((action) => {\n      const config = actionConfig[action] || {\n        initial: action[0]?.toUpperCase() || '?',\n        bg: 'bg-gray-100',\n        text: 'text-gray-700',\n        border: 'border-gray-200',\n      };\n      return `<span class=\"inline-flex items-center justify-center w-5 h-5 rounded text-xs font-semibold ${config.bg} ${config.text}\" title=\"${action}\">${config.initial}</span>`;\n    })\n    .join('');\n\nconst buildPill = (resource: string, actions: string[]) => {\n  const resourceName = resource.split('.').pop();\n  const actionBadges = buildActionBadges(actions);\n  return `<span class=\"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-gray-50 border border-gray-200 text-xs\">\n    <span class=\"flex gap-0.5\">${actionBadges}</span>\n    <span class=\"text-gray-600 font-medium\">${resourceName || resource}</span>\n  </span>`;\n};\n\nconst generateId = () => `perm-${Math.random().toString(36).slice(2, 11)}`;\n\nexport function togglePermissions(containerId: string) {\n  const container = document.getElementById(containerId);\n  if (!container) return;\n  const collapsed = container.querySelector<HTMLElement>('.permission-pills-collapsed');\n  const expanded = container.querySelector<HTMLElement>('.permission-pills-expanded');\n  if (collapsed && expanded) {\n    collapsed.classList.toggle('hidden');\n    expanded.classList.toggle('hidden');\n    expanded.classList.toggle('flex');\n  }\n}\n\ndeclare global {\n  interface Window {\n    togglePermissions?: (containerId: string) => void;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.togglePermissions = togglePermissions;\n}\n\nexport function permissionPillsRenderer(value: unknown, options: PermissionPillsOptions = {}) {\n  const maxVisible = options.maxVisible ?? 4;\n  const perms = parsePermissions(value);\n  if (perms.length === 0) {\n    return '<span class=\"text-gray-400 text-sm\">No permissions</span>';\n  }\n  const grouped = groupByResource(perms);\n  const resources = Object.keys(grouped);\n  const visiblePills = resources.slice(0, maxVisible).map((resource) => buildPill(resource, grouped[resource]));\n  const hiddenCount = resources.length - maxVisible;\n  const containerId = generateId();\n\n  let html = `<div class=\"permission-pills-container\" id=\"${containerId}\">`;\n  html += `<div class=\"flex flex-wrap gap-1 items-center permission-pills-collapsed\">`;\n  html += visiblePills.join('');\n  if (hiddenCount > 0) {\n    html += `<button type=\"button\" class=\"permission-expand-btn inline-flex items-center px-2 py-1 rounded-md bg-gray-100 hover:bg-gray-200 border border-gray-200 text-xs text-gray-600 font-medium transition-colors\" onclick=\"togglePermissions('${containerId}')\">+${hiddenCount} more</button>`;\n  }\n  html += '</div>';\n  if (hiddenCount > 0) {\n    const allPills = resources.map((resource) => buildPill(resource, grouped[resource]));\n    html += `<div class=\"hidden flex-wrap gap-1 items-center permission-pills-expanded\">`;\n    html += allPills.join('');\n    html += `<button type=\"button\" class=\"permission-collapse-btn inline-flex items-center px-2 py-1 rounded-md bg-gray-100 hover:bg-gray-200 border border-gray-200 text-xs text-gray-600 font-medium transition-colors\" onclick=\"togglePermissions('${containerId}')\">Show less</button>`;\n    html += '</div>';\n  }\n  html += '</div>';\n  return html;\n}\n\nexport function permissionPills(options: PermissionPillsOptions = {}) {\n  return (value: unknown) => permissionPillsRenderer(value, options);\n}\n\nexport default permissionPillsRenderer;\n"],"names":["actionConfig","parsePermissions","value","item","groupByResource","perms","grouped","perm","parts","action","resource","buildActionBadges","actions","config","buildPill","resourceName","generateId","togglePermissions","containerId","container","collapsed","expanded","permissionPillsRenderer","options","maxVisible","resources","visiblePills","hiddenCount","html","allPills","permissionPills"],"mappings":"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"}