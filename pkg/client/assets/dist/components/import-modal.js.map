{"version":3,"file":"import-modal.js","sources":["../../src/components/import-modal.ts"],"sourcesContent":["/**\n * Import Modal Component\n *\n * A reusable modal component for bulk file imports with drag & drop support,\n * file preview, results display with summary cards, fullscreen toggle,\n * and result filtering.\n *\n * Usage:\n *   import { ImportModal } from '/admin/assets/components/import-modal.js';\n *\n *   const importModal = new ImportModal({\n *     modalId: 'import-users-modal',\n *     endpoint: '/admin/api/users/import',\n *     onSuccess: (summary) => grid.refresh(),\n *     notifier: window.toastManager\n *   });\n *\n *   // Open modal\n *   document.getElementById('import-btn')?.addEventListener('click', () => importModal.open());\n */\n\ntype ImportModalNotifier = {\n  success: (message: string) => void;\n  error: (message: string) => void;\n};\n\ntype ImportModalOptions = {\n  modalId?: string;\n  endpoint?: string;\n  onSuccess?: (summary: Record<string, number>) => void;\n  notifier?: ImportModalNotifier;\n  resourceName?: string;\n};\n\n/**\n * Format file size in human-readable format\n * @param bytes - File size in bytes\n * @returns Formatted size string\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;\n}\n\n/**\n * Import Modal class for handling bulk file imports\n */\nexport class ImportModal {\n  modalId: string;\n  endpoint: string;\n  onSuccess: (summary: Record<string, number>) => void;\n  notifier: ImportModalNotifier;\n  resourceName: string;\n  elements: Record<string, HTMLElement | null>;\n  isFullscreen: boolean;\n  currentFilter: string;\n  resultItems: any[];\n\n  /**\n   * @param options - Configuration options\n   * @param options.modalId - ID of the modal element\n   * @param options.endpoint - API endpoint for file upload\n   * @param options.onSuccess - Callback when import succeeds (receives summary)\n   * @param options.notifier - Toast notification manager (with success/error methods)\n   * @param options.resourceName - Name of resource being imported (default: 'items')\n   */\n  constructor(options: ImportModalOptions = {}) {\n    this.modalId = options.modalId || 'import-modal';\n    this.endpoint = options.endpoint || '/api/import';\n    this.onSuccess = options.onSuccess || (() => {});\n    this.notifier = options.notifier || { success: console.log, error: console.error };\n    this.resourceName = options.resourceName || 'items';\n\n    this.elements = {};\n    this.isFullscreen = false;\n    this.currentFilter = 'all';\n    this.resultItems = [];\n    this.bindElements();\n    this.bindEvents();\n  }\n\n  /**\n   * Bind DOM elements\n   */\n  bindElements() {\n    // Extract prefix from modal ID (e.g., 'import-users-modal' -> 'import-users')\n    const prefix = this.modalId.replace('-modal', '');\n\n    this.elements = {\n      modal: document.getElementById(this.modalId),\n      container: document.getElementById(`${prefix}-container`),\n      backdrop: document.getElementById(`${prefix}-backdrop`),\n      closeBtn: document.getElementById(`${prefix}-close`),\n      cancelBtn: document.getElementById(`${prefix}-cancel`),\n      fullscreenBtn: document.getElementById(`${prefix}-fullscreen`),\n      expandIcon: document.getElementById(`${prefix}-expand-icon`),\n      collapseIcon: document.getElementById(`${prefix}-collapse-icon`),\n      form: document.getElementById(`${prefix}-form`),\n      fileInput: document.getElementById(`${prefix}-file`),\n      submitBtn: document.getElementById(`${prefix}-submit`),\n      anotherBtn: document.getElementById(`${prefix}-another`),\n      spinner: document.getElementById(`${prefix}-spinner`),\n      results: document.getElementById(`${prefix}-results`),\n      error: document.getElementById(`${prefix}-error`),\n      errorBanner: document.getElementById(`${prefix}-error-banner`),\n      resultsBody: document.getElementById(`${prefix}-results-body`),\n      tableScroll: document.getElementById(`${prefix}-table-scroll`),\n      dropzone: document.getElementById(`${prefix}-dropzone`),\n      dropzoneEmpty: document.getElementById(`${prefix}-dropzone-empty`),\n      dropzoneSelected: document.getElementById(`${prefix}-dropzone-selected`),\n      fileName: document.getElementById(`${prefix}-file-name`),\n      fileSize: document.getElementById(`${prefix}-file-size`),\n      fileRemove: document.getElementById(`${prefix}-file-remove`),\n      statProcessed: document.getElementById(`${prefix}-stat-processed`),\n      statSucceeded: document.getElementById(`${prefix}-stat-succeeded`),\n      statFailed: document.getElementById(`${prefix}-stat-failed`),\n      visibleCount: document.getElementById(`${prefix}-visible-count`),\n      totalCount: document.getElementById(`${prefix}-total-count`)\n    };\n  }\n\n  /**\n   * Bind event listeners\n   */\n  bindEvents() {\n    const { modal, backdrop, closeBtn, cancelBtn, fileInput, fileRemove, anotherBtn, submitBtn, fullscreenBtn } = this.elements;\n\n    if (closeBtn) {\n      closeBtn.addEventListener('click', () => this.close());\n    }\n    if (cancelBtn) {\n      cancelBtn.addEventListener('click', () => this.close());\n    }\n    if (backdrop) {\n      backdrop.addEventListener('click', () => this.close());\n    }\n    if (fileInput) {\n      fileInput.addEventListener('change', () => this.updateFilePreview());\n    }\n    if (fileRemove) {\n      fileRemove.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        const file = this.elements.fileInput as HTMLInputElement | null;\n        if (file) file.value = '';\n        this.updateFilePreview();\n      });\n    }\n    if (anotherBtn) {\n      anotherBtn.addEventListener('click', () => this.reset());\n    }\n    if (submitBtn) {\n      submitBtn.addEventListener('click', (e) => this.handleSubmit(e));\n    }\n    if (fullscreenBtn) {\n      fullscreenBtn.addEventListener('click', () => this.toggleFullscreen());\n    }\n\n    // Drag and drop\n    this.bindDragAndDrop();\n\n    // Filter buttons\n    this.bindFilterButtons();\n\n    // Escape key\n    document.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape' && modal && !modal.classList.contains('hidden')) {\n        if (this.isFullscreen) {\n          this.toggleFullscreen();\n        } else {\n          this.close();\n        }\n      }\n    });\n  }\n\n  /**\n   * Bind filter button events\n   */\n  bindFilterButtons() {\n    const { modal } = this.elements;\n    if (!modal) return;\n\n    const filterBtns = modal.querySelectorAll('.import-filter-btn');\n    filterBtns.forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const filter = btn.getAttribute('data-filter') || 'all';\n        this.setFilter(filter);\n        // Update active state\n        filterBtns.forEach((b) => {\n          b.classList.toggle('active', b === btn);\n          b.classList.toggle('bg-gray-100', b === btn);\n          b.classList.toggle('text-gray-700', b === btn);\n          b.classList.toggle('text-gray-500', b !== btn);\n        });\n      });\n    });\n  }\n\n  /**\n   * Set the current filter and update display\n   * @param filter - 'all', 'succeeded', or 'failed'\n   */\n  setFilter(filter: string) {\n    this.currentFilter = filter;\n    this.applyFilter();\n  }\n\n  /**\n   * Apply the current filter to results\n   */\n  applyFilter() {\n    const { resultsBody, visibleCount } = this.elements;\n    if (!resultsBody) return;\n\n    const rows = resultsBody.querySelectorAll('tr');\n    let visible = 0;\n\n    rows.forEach((row) => {\n      const status = row.getAttribute('data-status');\n      let show = true;\n\n      if (this.currentFilter === 'succeeded') {\n        show = status === 'succeeded';\n      } else if (this.currentFilter === 'failed') {\n        show = status === 'failed';\n      }\n\n      (row as HTMLElement).style.display = show ? '' : 'none';\n      if (show) visible++;\n    });\n\n    if (visibleCount) {\n      visibleCount.textContent = String(visible);\n    }\n  }\n\n  /**\n   * Toggle fullscreen mode\n   */\n  toggleFullscreen() {\n    const { container, expandIcon, collapseIcon, tableScroll } = this.elements;\n    if (!container) return;\n\n    this.isFullscreen = !this.isFullscreen;\n\n    if (this.isFullscreen) {\n      // Enter fullscreen\n      container.classList.remove('max-w-3xl', 'max-h-[90vh]');\n      container.classList.add('w-full', 'h-full', 'm-0');\n      (container as HTMLElement).style.maxWidth = 'none';\n      (container as HTMLElement).style.maxHeight = 'none';\n      (container as HTMLElement).style.borderRadius = '0';\n      if (expandIcon) expandIcon.classList.add('hidden');\n      if (collapseIcon) collapseIcon.classList.remove('hidden');\n      if (tableScroll) (tableScroll as HTMLElement).style.maxHeight = '60vh';\n    } else {\n      // Exit fullscreen - keep w-full since it's part of the original classes\n      container.classList.add('w-full', 'max-w-3xl', 'max-h-[90vh]');\n      container.classList.remove('h-full', 'm-0');\n      (container as HTMLElement).style.maxWidth = '';\n      (container as HTMLElement).style.maxHeight = '';\n      (container as HTMLElement).style.borderRadius = '';\n      if (expandIcon) expandIcon.classList.remove('hidden');\n      if (collapseIcon) collapseIcon.classList.add('hidden');\n      if (tableScroll) (tableScroll as HTMLElement).style.maxHeight = '40vh';\n    }\n  }\n\n  /**\n   * Bind drag and drop events\n   */\n  bindDragAndDrop() {\n    const { dropzone } = this.elements;\n    const fileInput = this.elements.fileInput as HTMLInputElement | null;\n    if (!dropzone) return;\n\n    ['dragenter', 'dragover'].forEach((eventName) => {\n      dropzone.addEventListener(eventName, (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        dropzone.classList.add('border-blue-400', 'bg-blue-50');\n      });\n    });\n\n    ['dragleave', 'drop'].forEach((eventName) => {\n      dropzone.addEventListener(eventName, (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        dropzone.classList.remove('border-blue-400', 'bg-blue-50');\n      });\n    });\n\n    dropzone.addEventListener('drop', (e) => {\n      const dtEvent = e as DragEvent;\n      const files = dtEvent.dataTransfer?.files;\n      if (files && files.length > 0 && fileInput) {\n        const dt = new DataTransfer();\n        dt.items.add(files[0]);\n        fileInput.files = dt.files;\n        this.updateFilePreview();\n      }\n    });\n  }\n\n  /**\n   * Update the file preview display\n   */\n  updateFilePreview() {\n    const fileInput = this.elements.fileInput as HTMLInputElement | null;\n    const { dropzoneEmpty, dropzoneSelected, fileName, fileSize, submitBtn } = this.elements;\n    const file = fileInput?.files?.[0] ?? null;\n    const hasFile = Boolean(file);\n\n    if (hasFile) {\n      if (file && fileName) fileName.textContent = file.name;\n      if (file && fileSize) fileSize.textContent = formatFileSize(file.size);\n      if (dropzoneEmpty) dropzoneEmpty.classList.add('hidden');\n      if (dropzoneSelected) dropzoneSelected.classList.remove('hidden');\n      if (submitBtn) (submitBtn as HTMLButtonElement).disabled = false;\n    } else {\n      if (dropzoneEmpty) dropzoneEmpty.classList.remove('hidden');\n      if (dropzoneSelected) dropzoneSelected.classList.add('hidden');\n      if (submitBtn) (submitBtn as HTMLButtonElement).disabled = true;\n    }\n  }\n\n  /**\n   * Reset the modal to initial state\n   */\n  reset() {\n    const { fileInput, results, form, errorBanner, error, resultsBody, submitBtn, anotherBtn, statProcessed, statSucceeded, statFailed, visibleCount, totalCount, modal } = this.elements;\n\n    if (fileInput) (fileInput as HTMLInputElement).value = '';\n    this.updateFilePreview();\n    if (results) results.classList.add('hidden');\n    if (form) form.classList.remove('hidden');\n    if (errorBanner) errorBanner.classList.add('hidden');\n    if (error) error.textContent = '';\n    if (resultsBody) resultsBody.innerHTML = '';\n    if (submitBtn) {\n      submitBtn.classList.remove('hidden');\n      (submitBtn as HTMLButtonElement).disabled = true;\n    }\n    if (anotherBtn) anotherBtn.classList.add('hidden');\n    if (statProcessed) statProcessed.textContent = '0';\n    if (statSucceeded) statSucceeded.textContent = '0';\n    if (statFailed) statFailed.textContent = '0';\n    if (visibleCount) visibleCount.textContent = '0';\n    if (totalCount) totalCount.textContent = '0';\n\n    // Reset filter to 'all'\n    this.currentFilter = 'all';\n    this.resultItems = [];\n    if (modal) {\n      const filterBtns = modal.querySelectorAll('.import-filter-btn');\n      filterBtns.forEach((btn) => {\n        const isAll = btn.getAttribute('data-filter') === 'all';\n        btn.classList.toggle('active', isAll);\n        btn.classList.toggle('bg-gray-100', isAll);\n        btn.classList.toggle('text-gray-700', isAll);\n        btn.classList.toggle('text-gray-500', !isAll);\n      });\n    }\n\n    // Exit fullscreen if active\n    if (this.isFullscreen) {\n      this.toggleFullscreen();\n    }\n  }\n\n  /**\n   * Set loading state\n   * @param isLoading - Whether loading is in progress\n   */\n  setLoading(isLoading: boolean) {\n    const { submitBtn, cancelBtn, spinner } = this.elements;\n\n    if (submitBtn) {\n      (submitBtn as HTMLButtonElement).disabled = isLoading;\n      submitBtn.classList.toggle('opacity-50', isLoading);\n    }\n    if (cancelBtn) {\n      (cancelBtn as HTMLButtonElement).disabled = isLoading;\n    }\n    if (spinner) {\n      spinner.classList.toggle('hidden', !isLoading);\n      spinner.classList.toggle('flex', isLoading);\n    }\n  }\n\n  /**\n   * Open the modal\n   */\n  open() {\n    const { modal } = this.elements;\n    if (!modal) return;\n    this.reset();\n    modal.classList.remove('hidden');\n    document.body.classList.add('overflow-hidden');\n  }\n\n  /**\n   * Close the modal\n   */\n  close() {\n    const { modal } = this.elements;\n    if (!modal) return;\n    modal.classList.add('hidden');\n    document.body.classList.remove('overflow-hidden');\n  }\n\n  /**\n   * Build a table cell element\n   * @param value - Cell content\n   * @param className - CSS classes\n   */\n  buildCell(value: string, className: string) {\n    const cell = document.createElement('td');\n    cell.className = className;\n    cell.textContent = value;\n    return cell;\n  }\n\n  /**\n   * Render import results\n   * @param payload - API response payload\n   */\n  renderResults(payload: any) {\n    const { results, resultsBody, form, submitBtn, anotherBtn, errorBanner, error, statProcessed, statSucceeded, statFailed, visibleCount, totalCount } = this.elements;\n\n    if (!results || !resultsBody) return;\n\n    const summary = payload && payload.summary ? payload.summary : {};\n    const processed = Number(summary.processed) || 0;\n    const succeeded = Number(summary.succeeded) || 0;\n    const failed = Number(summary.failed) || 0;\n    const resultItems = Array.isArray(payload && payload.results) ? payload.results : [];\n    const errorMessage = payload && payload.error ? String(payload.error).trim() : '';\n\n    // Store results for filtering\n    this.resultItems = resultItems;\n\n    // Update summary cards\n    if (statProcessed) statProcessed.textContent = String(processed);\n    if (statSucceeded) statSucceeded.textContent = String(succeeded);\n    if (statFailed) statFailed.textContent = String(failed);\n\n    // Update result counts\n    if (totalCount) totalCount.textContent = String(resultItems.length);\n    if (visibleCount) visibleCount.textContent = String(resultItems.length);\n\n    // Show error banner if needed\n    if (errorMessage && errorBanner && error) {\n      error.textContent = errorMessage;\n      errorBanner.classList.remove('hidden');\n    }\n\n    // Build results table\n    resultsBody.innerHTML = '';\n    if (resultItems.length === 0) {\n      const row = document.createElement('tr');\n      const cell = this.buildCell('No results to display', 'px-4 py-4 text-gray-500 text-center');\n      cell.colSpan = 5;\n      row.appendChild(cell);\n      resultsBody.appendChild(row);\n    } else {\n      resultItems.forEach((result: any, idx: number) => {\n        const row = document.createElement('tr');\n        const displayIndex = typeof result.index === 'number' ? result.index + 1 : idx + 1;\n        const email = result.email ? String(result.email) : '-';\n        const userId = result.user_id ? String(result.user_id) : '-';\n        const hasError = result.error && String(result.error).trim() !== '';\n        const statusLabel = hasError ? 'Failed' : (result.status ? String(result.status) : 'Created');\n\n        // Add row background color and data-status attribute for filtering\n        row.className = hasError ? 'bg-red-50' : 'bg-green-50';\n        row.setAttribute('data-status', hasError ? 'failed' : 'succeeded');\n\n        row.appendChild(this.buildCell(String(displayIndex), 'px-4 py-2 text-gray-700 font-medium'));\n        row.appendChild(this.buildCell(email, 'px-4 py-2 text-gray-900'));\n        row.appendChild(this.buildCell(userId, 'px-4 py-2 text-gray-500 font-mono text-xs'));\n\n        // Status badge\n        const statusCell = document.createElement('td');\n        statusCell.className = 'px-4 py-2';\n        const badge = document.createElement('span');\n        badge.className = hasError\n          ? 'inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700'\n          : 'inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700';\n\n        // Add icon to badge\n        const iconSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        iconSvg.setAttribute('class', 'w-3 h-3');\n        iconSvg.setAttribute('fill', 'none');\n        iconSvg.setAttribute('stroke', 'currentColor');\n        iconSvg.setAttribute('viewBox', '0 0 24 24');\n        const iconPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        iconPath.setAttribute('stroke-linecap', 'round');\n        iconPath.setAttribute('stroke-linejoin', 'round');\n        iconPath.setAttribute('stroke-width', '2');\n        iconPath.setAttribute('d', hasError ? 'M6 18L18 6M6 6l12 12' : 'M5 13l4 4L19 7');\n        iconSvg.appendChild(iconPath);\n        badge.appendChild(iconSvg);\n        badge.appendChild(document.createTextNode(statusLabel));\n        statusCell.appendChild(badge);\n        row.appendChild(statusCell);\n\n        row.appendChild(this.buildCell(hasError ? String(result.error) : '-', 'px-4 py-2 text-gray-600 text-xs'));\n        resultsBody.appendChild(row);\n      });\n    }\n\n    // Hide form, show results\n    if (form) form.classList.add('hidden');\n    results.classList.remove('hidden');\n\n    // Toggle buttons\n    if (submitBtn) submitBtn.classList.add('hidden');\n    if (anotherBtn) anotherBtn.classList.remove('hidden');\n\n    // Apply current filter (in case it was set before)\n    this.applyFilter();\n  }\n\n  /**\n   * Handle form submission\n   * @param event - Submit event\n   */\n  async handleSubmit(event: Event) {\n    event.preventDefault();\n    const fileInput = this.elements.fileInput as HTMLInputElement | null;\n\n    if (!fileInput || !fileInput.files || fileInput.files.length === 0) {\n      this.notifier.error(`Select a file to import ${this.resourceName}.`);\n      return;\n    }\n\n    const file = fileInput.files[0];\n    const formData = new FormData();\n    formData.append('file', file);\n\n    this.setLoading(true);\n    let response: Response | null = null;\n    let payload: any = null;\n\n    try {\n      response = await fetch(this.endpoint, {\n        method: 'POST',\n        body: formData\n      });\n      const contentType = response.headers.get('Content-Type') || '';\n      if (contentType.includes('application/json')) {\n        payload = await response.json();\n      } else {\n        payload = { error: 'Import failed' };\n      }\n    } catch (err) {\n      console.error('Import failed:', err);\n      this.notifier.error('Import failed.');\n    } finally {\n      this.setLoading(false);\n    }\n\n    if (!payload) return;\n\n    this.renderResults(payload);\n\n    const summary = payload.summary || {};\n    const succeeded = Number(summary.succeeded) || 0;\n    const failed = Number(summary.failed) || 0;\n\n    if (response && response.ok && failed === 0) {\n      this.notifier.success(`${this.resourceName} imported successfully.`);\n    } else {\n      const errorMessage = payload.error ? String(payload.error) : 'Import completed with errors.';\n      this.notifier.error(errorMessage);\n    }\n\n    if (succeeded > 0) {\n      this.onSuccess(summary);\n    }\n  }\n}\n\n// Default export\nexport default ImportModal;\n"],"names":["formatFileSize","bytes","k","sizes","i","ImportModal","options","prefix","modal","backdrop","closeBtn","cancelBtn","fileInput","fileRemove","anotherBtn","submitBtn","fullscreenBtn","e","file","event","filterBtns","btn","filter","b","resultsBody","visibleCount","rows","visible","row","status","show","container","expandIcon","collapseIcon","tableScroll","dropzone","eventName","files","dt","dropzoneEmpty","dropzoneSelected","fileName","fileSize","results","form","errorBanner","error","statProcessed","statSucceeded","statFailed","totalCount","isAll","isLoading","spinner","value","className","cell","payload","summary","processed","succeeded","failed","resultItems","errorMessage","result","idx","displayIndex","email","userId","hasError","statusLabel","statusCell","badge","iconSvg","iconPath","formData","response","err"],"mappings":"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"}