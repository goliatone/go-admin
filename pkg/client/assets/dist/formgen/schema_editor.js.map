{"version":3,"file":"schema_editor.js","sources":["../../src/formgen/schema_editor.ts"],"sourcesContent":["/**\n * Schema editor component.\n * Adds JSON formatting, validation, metadata helpers, and enhanced editing experience.\n */\n(() => {\n  const slugify = (value: string): string =>\n    value\n      .toLowerCase()\n      .trim()\n      .replace(/[^a-z0-9]+/g, '_')\n      .replace(/^_+|_+$/g, '') || 'block';\n\n  const guessSchemaVersion = (root: HTMLElement): string => {\n    const form = root.closest('form');\n    if (!form) {\n      return 'block@v1.0.0';\n    }\n    const candidates = [\n      'input[name=\"name\"]',\n      'input[name=\"type\"]',\n      'input[name=\"slug\"]',\n    ];\n    for (const selector of candidates) {\n      const input = form.querySelector<HTMLInputElement>(selector);\n      const value = input?.value?.trim();\n      if (value) {\n        return `${slugify(value)}@v1.0.0`;\n      }\n    }\n    return 'block@v1.0.0';\n  };\n\n  const parsePayload = (raw: string): { value: any; error?: string; errorLine?: number } => {\n    const trimmed = raw.trim();\n    if (!trimmed) {\n      return { value: {} };\n    }\n    try {\n      return { value: JSON.parse(trimmed) };\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : 'Invalid JSON';\n      // Try to extract line number from error message\n      const lineMatch = msg.match(/position (\\d+)/i) || msg.match(/line (\\d+)/i);\n      const errorLine = lineMatch ? parseInt(lineMatch[1], 10) : undefined;\n      return { value: null, error: msg, errorLine };\n    }\n  };\n\n  const formatPayload = (payload: any): string => JSON.stringify(payload, null, 2);\n\n  const ensureMetadata = (payload: any, version: string): any => {\n    const root = payload && typeof payload === 'object' ? payload : {};\n    const meta = (root.metadata && typeof root.metadata === 'object' && !Array.isArray(root.metadata))\n      ? root.metadata\n      : {};\n    if (!meta.schema_version) {\n      meta.schema_version = version;\n    }\n    root.metadata = meta;\n    return root;\n  };\n\n  /**\n   * Calculate schema statistics\n   */\n  const getSchemaStats = (payload: any): { properties: number; required: number; depth: number; types: string[] } => {\n    if (!payload || typeof payload !== 'object') {\n      return { properties: 0, required: 0, depth: 0, types: [] };\n    }\n\n    let properties = 0;\n    let required = 0;\n    let maxDepth = 0;\n    const types = new Set<string>();\n\n    const traverse = (obj: any, depth: number) => {\n      if (!obj || typeof obj !== 'object') return;\n      maxDepth = Math.max(maxDepth, depth);\n\n      if (obj.type) {\n        types.add(String(obj.type));\n      }\n\n      if (obj.properties && typeof obj.properties === 'object') {\n        const props = Object.keys(obj.properties);\n        properties += props.length;\n        props.forEach((key) => traverse(obj.properties[key], depth + 1));\n      }\n\n      if (Array.isArray(obj.required)) {\n        required += obj.required.length;\n      }\n\n      if (obj.items) {\n        traverse(obj.items, depth + 1);\n      }\n\n      if (obj.allOf || obj.anyOf || obj.oneOf) {\n        const combiner = obj.allOf || obj.anyOf || obj.oneOf;\n        if (Array.isArray(combiner)) {\n          combiner.forEach((sub: any) => traverse(sub, depth + 1));\n        }\n      }\n    };\n\n    traverse(payload, 0);\n    return { properties, required, depth: maxDepth, types: Array.from(types) };\n  };\n\n  const setStatus = (root: HTMLElement, message: string, state: 'ok' | 'error' | 'info' | '') => {\n    const status = root.querySelector<HTMLElement>('[data-schema-status]');\n    if (!status) {\n      return;\n    }\n    status.textContent = message;\n    status.dataset.state = state;\n    status.classList.remove('text-green-600', 'text-red-600', 'text-blue-600');\n    if (state === 'ok') {\n      status.classList.add('text-green-600');\n    } else if (state === 'error') {\n      status.classList.add('text-red-600');\n    } else if (state === 'info') {\n      status.classList.add('text-blue-600');\n    }\n  };\n\n  /**\n   * Update line numbers display\n   */\n  const updateLineNumbers = (textarea: HTMLTextAreaElement, lineNumbersEl: HTMLElement | null) => {\n    if (!lineNumbersEl) return;\n\n    const lines = textarea.value.split('\\n');\n    const lineCount = lines.length;\n    const digits = String(lineCount).length;\n\n    lineNumbersEl.innerHTML = lines\n      .map((_, idx) => `<span class=\"block text-right pr-2\">${String(idx + 1).padStart(digits, ' ')}</span>`)\n      .join('');\n  };\n\n  /**\n   * Sync scroll between textarea and line numbers\n   */\n  const syncScroll = (textarea: HTMLTextAreaElement, lineNumbersEl: HTMLElement | null) => {\n    if (!lineNumbersEl) return;\n    lineNumbersEl.scrollTop = textarea.scrollTop;\n  };\n\n  /**\n   * Update stats display\n   */\n  const updateStats = (root: HTMLElement, payload: any) => {\n    const statsEl = root.querySelector<HTMLElement>('[data-schema-stats]');\n    if (!statsEl) return;\n\n    const stats = getSchemaStats(payload);\n    statsEl.innerHTML = `\n      <span class=\"text-gray-600 dark:text-gray-400\">\n        ${stats.properties} properties\n        ${stats.required > 0 ? ` · ${stats.required} required` : ''}\n        ${stats.depth > 0 ? ` · depth ${stats.depth}` : ''}\n        ${stats.types.length > 0 ? ` · types: ${stats.types.join(', ')}` : ''}\n      </span>\n    `;\n  };\n\n  /**\n   * Copy text to clipboard\n   */\n  const copyToClipboard = async (text: string): Promise<boolean> => {\n    try {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } catch {\n      // Fallback for older browsers\n      const textarea = document.createElement('textarea');\n      textarea.value = text;\n      textarea.style.position = 'fixed';\n      textarea.style.opacity = '0';\n      document.body.appendChild(textarea);\n      textarea.select();\n      const success = document.execCommand('copy');\n      document.body.removeChild(textarea);\n      return success;\n    }\n  };\n\n  /**\n   * Insert a template at cursor position\n   */\n  const insertTemplate = (textarea: HTMLTextAreaElement, template: string) => {\n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    const text = textarea.value;\n    textarea.value = text.substring(0, start) + template + text.substring(end);\n    textarea.selectionStart = textarea.selectionEnd = start + template.length;\n    textarea.focus();\n    textarea.dispatchEvent(new Event('input', { bubbles: true }));\n  };\n\n  const TEMPLATES = {\n    property: `\"property_name\": {\n  \"type\": \"string\",\n  \"title\": \"Property Title\",\n  \"description\": \"Property description\"\n}`,\n    object: `{\n  \"type\": \"object\",\n  \"title\": \"Object Title\",\n  \"properties\": {},\n  \"required\": []\n}`,\n    array: `{\n  \"type\": \"array\",\n  \"title\": \"Array Title\",\n  \"items\": {\n    \"type\": \"string\"\n  }\n}`,\n    enum: `{\n  \"type\": \"string\",\n  \"title\": \"Enum Title\",\n  \"enum\": [\"option1\", \"option2\", \"option3\"]\n}`,\n  };\n\n  const initSchemaEditor = () => {\n    document.querySelectorAll<HTMLElement>('[data-schema-editor]').forEach((root) => {\n      const textarea = root.querySelector<HTMLTextAreaElement>('[data-schema-input]');\n      if (!textarea) {\n        return;\n      }\n\n      const formatBtn = root.querySelector<HTMLButtonElement>('[data-schema-format]');\n      const validateBtn = root.querySelector<HTMLButtonElement>('[data-schema-validate]');\n      const metadataBtn = root.querySelector<HTMLButtonElement>('[data-schema-metadata]');\n      const copyBtn = root.querySelector<HTMLButtonElement>('[data-schema-copy]');\n      const lineNumbersEl = root.querySelector<HTMLElement>('[data-schema-line-numbers]');\n      const statsEl = root.querySelector<HTMLElement>('[data-schema-stats]');\n\n      // Template insertion buttons\n      root.querySelectorAll<HTMLButtonElement>('[data-schema-template]').forEach((btn) => {\n        const templateKey = btn.dataset.schemaTemplate as keyof typeof TEMPLATES;\n        if (templateKey && TEMPLATES[templateKey]) {\n          btn.addEventListener('click', () => {\n            insertTemplate(textarea, TEMPLATES[templateKey]);\n            setStatus(root, `Inserted ${templateKey} template`, 'info');\n          });\n        }\n      });\n\n      // Update line numbers on input\n      if (lineNumbersEl) {\n        updateLineNumbers(textarea, lineNumbersEl);\n        textarea.addEventListener('input', () => updateLineNumbers(textarea, lineNumbersEl));\n        textarea.addEventListener('scroll', () => syncScroll(textarea, lineNumbersEl));\n      }\n\n      // Format button\n      formatBtn?.addEventListener('click', () => {\n        const parsed = parsePayload(textarea.value);\n        if (parsed.error) {\n          setStatus(root, parsed.error, 'error');\n          return;\n        }\n        textarea.value = formatPayload(parsed.value);\n        if (lineNumbersEl) updateLineNumbers(textarea, lineNumbersEl);\n        if (statsEl) updateStats(root, parsed.value);\n        setStatus(root, 'Formatted', 'ok');\n      });\n\n      // Validate button\n      validateBtn?.addEventListener('click', () => {\n        const parsed = parsePayload(textarea.value);\n        if (parsed.error) {\n          setStatus(root, parsed.error, 'error');\n          return;\n        }\n        if (statsEl) updateStats(root, parsed.value);\n        setStatus(root, 'Valid JSON', 'ok');\n      });\n\n      // Metadata button\n      metadataBtn?.addEventListener('click', () => {\n        const parsed = parsePayload(textarea.value);\n        if (parsed.error) {\n          setStatus(root, parsed.error, 'error');\n          return;\n        }\n        const version = guessSchemaVersion(root);\n        const updated = ensureMetadata(parsed.value, version);\n        textarea.value = formatPayload(updated);\n        if (lineNumbersEl) updateLineNumbers(textarea, lineNumbersEl);\n        if (statsEl) updateStats(root, updated);\n        setStatus(root, 'Metadata inserted', 'ok');\n      });\n\n      // Copy button\n      copyBtn?.addEventListener('click', async () => {\n        const success = await copyToClipboard(textarea.value);\n        setStatus(root, success ? 'Copied to clipboard' : 'Copy failed', success ? 'ok' : 'error');\n      });\n\n      // Clear status on input\n      textarea.addEventListener('input', () => {\n        setStatus(root, '', '');\n      });\n\n      // Keyboard shortcuts\n      textarea.addEventListener('keydown', (event) => {\n        // Ctrl/Cmd + Shift + F = Format\n        if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key === 'f') {\n          event.preventDefault();\n          formatBtn?.click();\n          return;\n        }\n\n        // Ctrl/Cmd + S = Validate (prevent page save)\n        if ((event.ctrlKey || event.metaKey) && event.key === 's') {\n          event.preventDefault();\n          validateBtn?.click();\n          return;\n        }\n\n        // Ctrl/Cmd + M = Add metadata\n        if ((event.ctrlKey || event.metaKey) && event.key === 'm') {\n          event.preventDefault();\n          metadataBtn?.click();\n          return;\n        }\n\n        // Tab handling for JSON editing\n        if (event.key === 'Tab') {\n          event.preventDefault();\n          const start = textarea.selectionStart;\n          const end = textarea.selectionEnd;\n\n          if (event.shiftKey) {\n            // Un-indent: remove leading spaces from current line\n            const text = textarea.value;\n            const lineStart = text.lastIndexOf('\\n', start - 1) + 1;\n            const lineContent = text.substring(lineStart, start);\n            const leadingSpaces = lineContent.match(/^  /);\n            if (leadingSpaces) {\n              textarea.value = text.substring(0, lineStart) + text.substring(lineStart + 2);\n              textarea.selectionStart = textarea.selectionEnd = start - 2;\n            }\n          } else {\n            // Indent: insert 2 spaces\n            textarea.value = textarea.value.substring(0, start) + '  ' + textarea.value.substring(end);\n            textarea.selectionStart = textarea.selectionEnd = start + 2;\n          }\n          textarea.dispatchEvent(new Event('input', { bubbles: true }));\n        }\n\n        // Auto-close brackets\n        const pairs: Record<string, string> = { '{': '}', '[': ']', '\"': '\"' };\n        if (pairs[event.key]) {\n          const start = textarea.selectionStart;\n          const end = textarea.selectionEnd;\n          if (start === end) {\n            event.preventDefault();\n            const openChar = event.key;\n            const closeChar = pairs[openChar];\n            textarea.value = textarea.value.substring(0, start) + openChar + closeChar + textarea.value.substring(end);\n            textarea.selectionStart = textarea.selectionEnd = start + 1;\n            textarea.dispatchEvent(new Event('input', { bubbles: true }));\n          }\n        }\n      });\n\n      // Initial stats update\n      const initialParsed = parsePayload(textarea.value);\n      if (!initialParsed.error && statsEl) {\n        updateStats(root, initialParsed.value);\n      }\n    });\n  };\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initSchemaEditor);\n  } else {\n    initSchemaEditor();\n  }\n})();\n"],"names":["slugify","value","guessSchemaVersion","root","form","candidates","selector","parsePayload","raw","trimmed","err","msg","lineMatch","errorLine","formatPayload","payload","ensureMetadata","version","meta","getSchemaStats","properties","required","maxDepth","types","traverse","obj","depth","props","key","combiner","sub","setStatus","message","state","status","updateLineNumbers","textarea","lineNumbersEl","lines","lineCount","digits","_","idx","syncScroll","updateStats","statsEl","stats","copyToClipboard","text","success","insertTemplate","template","start","end","TEMPLATES","initSchemaEditor","formatBtn","validateBtn","metadataBtn","copyBtn","btn","templateKey","parsed","updated","event","lineStart","pairs","openChar","closeChar","initialParsed"],"mappings":"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"}