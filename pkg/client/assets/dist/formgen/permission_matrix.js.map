{"version":3,"file":"permission_matrix.js","sources":["../../src/formgen/permission_matrix.ts"],"sourcesContent":["/**\n * Permission matrix component.\n * Syncs checkbox state and extra permissions into a hidden input.\n */\n(() => {\n  const parsePermissionList = (raw?: string) =>\n    (raw || '')\n      .split('\\n')\n      .map((item) => item.trim())\n      .filter((item) => item.length > 0);\n\n  const initPermissionMatrix = () => {\n    document.querySelectorAll<HTMLElement>('.permission-matrix').forEach((matrix) => {\n      const hidden = matrix.querySelector<HTMLInputElement>('.permission-matrix-value');\n      const checkboxes = matrix.querySelectorAll<HTMLInputElement>('.perm-checkbox');\n      const extraInput = matrix.querySelector<HTMLTextAreaElement>('.permission-matrix-extra');\n      const checkboxMap: Record<string, HTMLInputElement> = {};\n\n      checkboxes.forEach((cb) => {\n        const perm = cb.dataset.permission;\n        if (perm) {\n          checkboxMap[perm] = cb;\n        }\n      });\n\n      if (!hidden || checkboxes.length === 0) {\n        return;\n      }\n\n      const collectExtraPermissions = () => {\n        let raw = '';\n        if (extraInput) {\n          raw = extraInput.value || '';\n        } else if (matrix.dataset.extraPermissions) {\n          raw = matrix.dataset.extraPermissions || '';\n        }\n        const extras: string[] = [];\n        const seen: Record<string, boolean> = {};\n        parsePermissionList(raw).forEach((perm) => {\n          const target = checkboxMap[perm];\n          if (target) {\n            target.checked = true;\n            return;\n          }\n          if (!seen[perm]) {\n            seen[perm] = true;\n            extras.push(perm);\n          }\n        });\n        return extras;\n      };\n\n      const syncPermissions = () => {\n        const perms: string[] = [];\n        const seen: Record<string, boolean> = {};\n\n        collectExtraPermissions().forEach((perm) => {\n          if (!seen[perm]) {\n            seen[perm] = true;\n            perms.push(perm);\n          }\n        });\n\n        checkboxes.forEach((cb) => {\n          if (cb.checked && cb.dataset.permission) {\n            if (!seen[cb.dataset.permission]) {\n              seen[cb.dataset.permission] = true;\n              perms.push(cb.dataset.permission);\n            }\n          }\n        });\n\n        hidden.value = perms.join('\\n');\n      };\n\n      checkboxes.forEach((cb) => {\n        cb.addEventListener('change', syncPermissions);\n      });\n      if (extraInput) {\n        extraInput.addEventListener('input', syncPermissions);\n      }\n\n      syncPermissions();\n    });\n  };\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initPermissionMatrix);\n  } else {\n    initPermissionMatrix();\n  }\n})();\n"],"names":["parsePermissionList","raw","item","initPermissionMatrix","matrix","hidden","checkboxes","extraInput","checkboxMap","cb","perm","collectExtraPermissions","extras","seen","target","syncPermissions","perms"],"mappings":"CAIC,MAAM;AACL,QAAMA,IAAsB,CAACC,OAC1BA,KAAO,IACL,MAAM;AAAA,CAAI,EACV,IAAI,CAACC,MAASA,EAAK,KAAA,CAAM,EACzB,OAAO,CAACA,MAASA,EAAK,SAAS,CAAC,GAE/BC,IAAuB,MAAM;AACjC,aAAS,iBAA8B,oBAAoB,EAAE,QAAQ,CAACC,MAAW;AAC/E,YAAMC,IAASD,EAAO,cAAgC,0BAA0B,GAC1EE,IAAaF,EAAO,iBAAmC,gBAAgB,GACvEG,IAAaH,EAAO,cAAmC,0BAA0B,GACjFI,IAAgD,CAAA;AAStD,UAPAF,EAAW,QAAQ,CAACG,MAAO;AACzB,cAAMC,IAAOD,EAAG,QAAQ;AACxB,QAAIC,MACFF,EAAYE,CAAI,IAAID;AAAA,MAExB,CAAC,GAEG,CAACJ,KAAUC,EAAW,WAAW;AACnC;AAGF,YAAMK,IAA0B,MAAM;AACpC,YAAIV,IAAM;AACV,QAAIM,IACFN,IAAMM,EAAW,SAAS,KACjBH,EAAO,QAAQ,qBACxBH,IAAMG,EAAO,QAAQ,oBAAoB;AAE3C,cAAMQ,IAAmB,CAAA,GACnBC,IAAgC,CAAA;AACtC,eAAAb,EAAoBC,CAAG,EAAE,QAAQ,CAACS,MAAS;AACzC,gBAAMI,IAASN,EAAYE,CAAI;AAC/B,cAAII,GAAQ;AACV,YAAAA,EAAO,UAAU;AACjB;AAAA,UACF;AACA,UAAKD,EAAKH,CAAI,MACZG,EAAKH,CAAI,IAAI,IACbE,EAAO,KAAKF,CAAI;AAAA,QAEpB,CAAC,GACME;AAAA,MACT,GAEMG,IAAkB,MAAM;AAC5B,cAAMC,IAAkB,CAAA,GAClBH,IAAgC,CAAA;AAEtC,QAAAF,EAAA,EAA0B,QAAQ,CAACD,MAAS;AAC1C,UAAKG,EAAKH,CAAI,MACZG,EAAKH,CAAI,IAAI,IACbM,EAAM,KAAKN,CAAI;AAAA,QAEnB,CAAC,GAEDJ,EAAW,QAAQ,CAACG,MAAO;AACzB,UAAIA,EAAG,WAAWA,EAAG,QAAQ,eACtBI,EAAKJ,EAAG,QAAQ,UAAU,MAC7BI,EAAKJ,EAAG,QAAQ,UAAU,IAAI,IAC9BO,EAAM,KAAKP,EAAG,QAAQ,UAAU;AAAA,QAGtC,CAAC,GAEDJ,EAAO,QAAQW,EAAM,KAAK;AAAA,CAAI;AAAA,MAChC;AAEA,MAAAV,EAAW,QAAQ,CAACG,MAAO;AACzB,QAAAA,EAAG,iBAAiB,UAAUM,CAAe;AAAA,MAC/C,CAAC,GACGR,KACFA,EAAW,iBAAiB,SAASQ,CAAe,GAGtDA,EAAA;AAAA,IACF,CAAC;AAAA,EACH;AAEA,EAAI,SAAS,eAAe,YAC1B,SAAS,iBAAiB,oBAAoBZ,CAAoB,IAElEA,EAAA;AAEJ,GAAA;"}