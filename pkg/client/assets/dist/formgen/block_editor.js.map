{"version":3,"file":"block_editor.js","sources":["../../src/formgen/block_editor.ts"],"sourcesContent":["type BlockEditorConfig = {\n  sortable?: boolean;\n  addLabel?: string;\n  emptyLabel?: string;\n  allowDrag?: boolean;\n  /** Allow dragging from entire header, not just drag handle */\n  dragFromHeader?: boolean;\n  /** Enable touch/mobile drag support */\n  enableTouch?: boolean;\n  /** Enable smooth reorder animations */\n  enableAnimations?: boolean;\n  /** Enable cross-editor drag/drop */\n  enableCrossEditor?: boolean;\n  /** Default schema version pattern: {type}@v1.0.0 */\n  schemaVersionPattern?: string;\n  /** Required fields per block type */\n  requiredFields?: Record<string, string[]>;\n  /** Enable validation on input */\n  validateOnInput?: boolean;\n  /** Legacy blocks for conflict detection */\n  legacyBlocks?: any[];\n  /** Show conflict detection UI when conflicts exist */\n  showConflicts?: boolean;\n};\n\ntype DragState = {\n  dragging: HTMLElement | null;\n  placeholder: HTMLElement | null;\n  touchStartY: number;\n  touchCurrentY: number;\n  scrollInterval: number | null;\n  originalIndex: number;\n};\n\ntype BlockTemplate = {\n  type: string;\n  label: string;\n  icon?: string;\n  collapsed?: boolean;\n  schemaVersion?: string;\n  requiredFields?: string[];\n  template: HTMLTemplateElement;\n};\n\ntype ValidationError = {\n  field: string;\n  message: string;\n};\n\ntype BlockConflict = {\n  blockIndex: number;\n  blockType: string;\n  field: string;\n  embeddedValue: any;\n  legacyValue: any;\n};\n\ntype ConflictReport = {\n  hasConflicts: boolean;\n  conflicts: BlockConflict[];\n  embeddedCount: number;\n  legacyCount: number;\n};\n\ntype BlockEditorElements = {\n  root: HTMLElement;\n  list: HTMLElement;\n  output: HTMLInputElement;\n  addSelect?: HTMLSelectElement;\n  addButton?: HTMLButtonElement;\n  emptyState?: HTMLElement;\n};\n\nfunction parseConfig(raw: string | null): BlockEditorConfig {\n  if (!raw) return {};\n  try {\n    const parsed = JSON.parse(raw) as unknown;\n    if (parsed && typeof parsed === 'object') {\n      return parsed as BlockEditorConfig;\n    }\n  } catch {\n    // ignore\n  }\n  return {};\n}\n\nfunction resolveConfig(root: HTMLElement): BlockEditorConfig {\n  const configRoot = root.closest<HTMLElement>('[data-component-config]');\n  return parseConfig(configRoot?.getAttribute('data-component-config') ?? null);\n}\n\nfunction parseBoolean(value?: string | null): boolean | undefined {\n  if (value == null) return undefined;\n  const normalized = value.trim().toLowerCase();\n  if (normalized === 'true') return true;\n  if (normalized === 'false') return false;\n  return undefined;\n}\n\nfunction resolveElements(root: HTMLElement): BlockEditorElements | null {\n  const list = root.querySelector<HTMLElement>('[data-block-list]');\n  const output = root.querySelector<HTMLInputElement>('input[data-block-output]');\n  if (!list || !output) return null;\n  const addSelect = root.querySelector<HTMLSelectElement>('[data-block-add-select]');\n  const addButton = root.querySelector<HTMLButtonElement>('[data-block-add]');\n  const emptyState = root.querySelector<HTMLElement>('[data-block-empty]');\n  return { root, list, output, addSelect: addSelect ?? undefined, addButton: addButton ?? undefined, emptyState: emptyState ?? undefined };\n}\n\nfunction toPathParts(raw: string): string[] {\n  const cleaned = raw.replace(/\\]/g, '');\n  return cleaned.split(/\\.|\\[/).map((part) => part.trim()).filter((part) => part.length > 0);\n}\n\nfunction buildInputName(base: string, index: number, raw: string): string {\n  if (!base) return raw;\n  const parts = toPathParts(raw);\n  let result = `${base}[${index}]`;\n  for (const part of parts) {\n    result += `[${part}]`;\n  }\n  return result;\n}\n\nfunction getByPath(data: any, rawPath: string): any {\n  if (!data || !rawPath) return undefined;\n  const parts = toPathParts(rawPath);\n  let current = data;\n  for (const part of parts) {\n    if (current == null) return undefined;\n    current = current[part];\n  }\n  return current;\n}\n\nfunction setByPath(target: Record<string, any>, rawPath: string, value: any): void {\n  if (!rawPath) return;\n  const parts = toPathParts(rawPath);\n  if (parts.length === 0) return;\n  let current: any = target;\n  parts.forEach((part, idx) => {\n    const isLast = idx === parts.length - 1;\n    const nextPart = parts[idx + 1];\n    const nextIsIndex = nextPart !== undefined && /^\\d+$/.test(nextPart);\n    if (isLast) {\n      if (part === '') return;\n      current[part] = value;\n      return;\n    }\n    if (current[part] == null || typeof current[part] !== 'object') {\n      current[part] = nextIsIndex ? [] : {};\n    }\n    current = current[part];\n  });\n}\n\nfunction readFieldValue(elements: Array<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>): any {\n  if (elements.length === 0) return undefined;\n  const first = elements[0];\n  if (first instanceof HTMLSelectElement && first.multiple) {\n    return Array.from(first.selectedOptions).map((opt) => opt.value);\n  }\n  if (first instanceof HTMLInputElement) {\n    if (first.type === 'radio') {\n      const checked = elements.find((el) => (el as HTMLInputElement).checked) as HTMLInputElement | undefined;\n      return checked ? checked.value : undefined;\n    }\n    if (first.type === 'checkbox') {\n      if (elements.length > 1) {\n        return elements.filter((el) => (el as HTMLInputElement).checked).map((el) => (el as HTMLInputElement).value);\n      }\n      return first.checked;\n    }\n  }\n  return first.value;\n}\n\nfunction setFieldValue(element: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement, value: any): void {\n  if (value == null) return;\n  if (element instanceof HTMLInputElement) {\n    if (element.type === 'checkbox') {\n      if (Array.isArray(value)) {\n        element.checked = value.map(String).includes(element.value);\n      } else if (typeof value === 'boolean') {\n        element.checked = value;\n      } else {\n        element.checked = String(value) === element.value || value === true;\n      }\n      return;\n    }\n    if (element.type === 'radio') {\n      element.checked = String(value) === element.value;\n      return;\n    }\n  }\n  if (element instanceof HTMLSelectElement && element.multiple) {\n    const values = Array.isArray(value) ? value.map(String) : [String(value)];\n    Array.from(element.options).forEach((opt) => {\n      opt.selected = values.includes(opt.value);\n    });\n    return;\n  }\n  element.value = String(value);\n}\n\nfunction collectTemplates(root: HTMLElement, config: BlockEditorConfig): Map<string, BlockTemplate> {\n  const templates = new Map<string, BlockTemplate>();\n  root.querySelectorAll<HTMLTemplateElement>('template[data-block-template]').forEach((template) => {\n    const type = template.dataset.blockType?.trim();\n    if (!type) return;\n    const label = template.dataset.blockLabel?.trim() || type;\n    const icon = template.dataset.blockIcon?.trim();\n    const collapsed = parseBoolean(template.dataset.blockCollapsed);\n    const schemaVersion = template.dataset.blockSchemaVersion?.trim() || generateSchemaVersion(type, config.schemaVersionPattern);\n    const requiredFieldsRaw = template.dataset.blockRequiredFields?.trim();\n    const requiredFields = requiredFieldsRaw\n      ? requiredFieldsRaw.split(',').map((f) => f.trim()).filter(Boolean)\n      : config.requiredFields?.[type] || [];\n    templates.set(type, {\n      type,\n      label,\n      icon: icon || undefined,\n      collapsed,\n      schemaVersion,\n      requiredFields,\n      template,\n    });\n  });\n  return templates;\n}\n\n/**\n * Generate a schema version string for a block type\n */\nfunction generateSchemaVersion(type: string, pattern?: string): string {\n  if (pattern) {\n    return pattern.replace('{type}', type);\n  }\n  return `${type}@v1.0.0`;\n}\n\n/**\n * Validate a block's required fields\n */\nfunction validateBlock(\n  item: HTMLElement,\n  template: BlockTemplate\n): ValidationError[] {\n  const errors: ValidationError[] = [];\n  const requiredFields = template.requiredFields || [];\n\n  for (const fieldName of requiredFields) {\n    const field = item.querySelector<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>(\n      `[name=\"${fieldName}\"], [data-block-field-name=\"${fieldName}\"]`\n    );\n\n    if (!field) continue;\n\n    let isEmpty = false;\n    if (field instanceof HTMLInputElement) {\n      if (field.type === 'checkbox') {\n        isEmpty = !field.checked;\n      } else if (field.type === 'radio') {\n        const radioGroup = item.querySelectorAll<HTMLInputElement>(`[name=\"${field.name}\"]`);\n        isEmpty = !Array.from(radioGroup).some((r) => r.checked);\n      } else {\n        isEmpty = !field.value.trim();\n      }\n    } else if (field instanceof HTMLSelectElement) {\n      isEmpty = !field.value || field.value === '';\n    } else {\n      isEmpty = !field.value.trim();\n    }\n\n    if (isEmpty) {\n      errors.push({\n        field: fieldName,\n        message: `${fieldName} is required`,\n      });\n    }\n  }\n\n  return errors;\n}\n\n/**\n * Show validation errors on a block item\n */\nfunction showBlockErrors(item: HTMLElement, errors: ValidationError[]): void {\n  // Clear previous errors\n  clearBlockErrors(item);\n\n  if (errors.length === 0) return;\n\n  // Mark block as invalid\n  item.classList.add('block-item--invalid');\n  item.dataset.blockValid = 'false';\n\n  // Add error indicator to header\n  const header = item.querySelector('[data-block-header]');\n  if (header) {\n    const errorBadge = document.createElement('span');\n    errorBadge.className = 'block-error-badge text-xs text-red-600 bg-red-50 px-2 py-0.5 rounded-full dark:bg-red-900/20 dark:text-red-400';\n    errorBadge.textContent = `${errors.length} error${errors.length > 1 ? 's' : ''}`;\n    errorBadge.setAttribute('data-block-error-badge', 'true');\n    header.querySelector('.flex')?.appendChild(errorBadge);\n  }\n\n  // Mark individual fields\n  for (const error of errors) {\n    const field = item.querySelector<HTMLElement>(\n      `[name=\"${error.field}\"], [data-block-field-name=\"${error.field}\"]`\n    );\n    if (field) {\n      field.classList.add('border-red-500', 'focus:ring-red-500');\n      const wrapper = field.closest('[data-component]');\n      if (wrapper) {\n        const errorMsg = document.createElement('p');\n        errorMsg.className = 'block-field-error text-xs text-red-600 mt-1 dark:text-red-400';\n        errorMsg.textContent = error.message;\n        errorMsg.setAttribute('data-block-field-error', 'true');\n        wrapper.appendChild(errorMsg);\n      }\n    }\n  }\n}\n\n/**\n * Clear validation errors from a block item\n */\nfunction clearBlockErrors(item: HTMLElement): void {\n  item.classList.remove('block-item--invalid');\n  item.dataset.blockValid = 'true';\n\n  // Remove error badge\n  item.querySelectorAll('[data-block-error-badge]').forEach((el) => el.remove());\n\n  // Remove field error messages\n  item.querySelectorAll('[data-block-field-error]').forEach((el) => el.remove());\n\n  // Remove error styling from fields\n  item.querySelectorAll('.border-red-500').forEach((el) => {\n    el.classList.remove('border-red-500', 'focus:ring-red-500');\n  });\n}\n\n/**\n * Compare embedded blocks with legacy blocks to detect conflicts\n */\nfunction detectBlockConflicts(embedded: any[], legacy: any[]): ConflictReport {\n  const conflicts: BlockConflict[] = [];\n\n  if (!Array.isArray(embedded) || !Array.isArray(legacy)) {\n    return {\n      hasConflicts: false,\n      conflicts: [],\n      embeddedCount: Array.isArray(embedded) ? embedded.length : 0,\n      legacyCount: Array.isArray(legacy) ? legacy.length : 0,\n    };\n  }\n\n  // Count mismatch is a conflict\n  if (embedded.length !== legacy.length) {\n    // Still compare what we can\n  }\n\n  const maxLen = Math.max(embedded.length, legacy.length);\n  for (let i = 0; i < maxLen; i++) {\n    const embBlock = embedded[i] || {};\n    const legBlock = legacy[i] || {};\n    const blockType = embBlock._type || legBlock._type || `block_${i}`;\n\n    // Compare all fields\n    const allKeys = new Set([...Object.keys(embBlock), ...Object.keys(legBlock)]);\n    for (const key of allKeys) {\n      if (key.startsWith('_')) continue; // Skip metadata fields for comparison\n      const embVal = embBlock[key];\n      const legVal = legBlock[key];\n\n      if (!deepEqual(embVal, legVal)) {\n        conflicts.push({\n          blockIndex: i,\n          blockType,\n          field: key,\n          embeddedValue: embVal,\n          legacyValue: legVal,\n        });\n      }\n    }\n  }\n\n  return {\n    hasConflicts: conflicts.length > 0 || embedded.length !== legacy.length,\n    conflicts,\n    embeddedCount: embedded.length,\n    legacyCount: legacy.length,\n  };\n}\n\n/**\n * Deep equality check for conflict detection\n */\nfunction deepEqual(a: any, b: any): boolean {\n  if (a === b) return true;\n  if (a == null || b == null) return a === b;\n  if (typeof a !== typeof b) return false;\n\n  if (Array.isArray(a) && Array.isArray(b)) {\n    if (a.length !== b.length) return false;\n    return a.every((val, idx) => deepEqual(val, b[idx]));\n  }\n\n  if (typeof a === 'object') {\n    const keysA = Object.keys(a);\n    const keysB = Object.keys(b);\n    if (keysA.length !== keysB.length) return false;\n    return keysA.every((key) => deepEqual(a[key], b[key]));\n  }\n\n  return false;\n}\n\n/**\n * Create conflict report UI element\n */\nfunction createConflictReportUI(report: ConflictReport): HTMLElement {\n  const container = document.createElement('div');\n  container.className = 'block-conflict-report border border-amber-200 bg-amber-50 rounded-lg p-4 mb-4 dark:bg-amber-900/20 dark:border-amber-700';\n  container.setAttribute('data-block-conflict-report', 'true');\n\n  const header = document.createElement('div');\n  header.className = 'flex items-center gap-2 mb-3';\n\n  const icon = document.createElement('span');\n  icon.className = 'text-amber-600 dark:text-amber-400';\n  icon.innerHTML = `<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path></svg>`;\n\n  const title = document.createElement('span');\n  title.className = 'font-medium text-amber-800 dark:text-amber-200';\n  title.textContent = 'Block Conflicts Detected';\n\n  header.appendChild(icon);\n  header.appendChild(title);\n  container.appendChild(header);\n\n  // Summary\n  const summary = document.createElement('p');\n  summary.className = 'text-sm text-amber-700 dark:text-amber-300 mb-3';\n  summary.textContent = `Embedded blocks (${report.embeddedCount}) differ from legacy blocks (${report.legacyCount}). Embedded blocks are authoritative.`;\n  container.appendChild(summary);\n\n  if (report.conflicts.length > 0) {\n    const details = document.createElement('details');\n    details.className = 'text-sm';\n\n    const summaryEl = document.createElement('summary');\n    summaryEl.className = 'cursor-pointer text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300 font-medium';\n    summaryEl.textContent = `View ${report.conflicts.length} field conflict${report.conflicts.length > 1 ? 's' : ''}`;\n    details.appendChild(summaryEl);\n\n    const list = document.createElement('ul');\n    list.className = 'mt-2 space-y-1 pl-4';\n\n    for (const conflict of report.conflicts.slice(0, 10)) {\n      const item = document.createElement('li');\n      item.className = 'text-amber-700 dark:text-amber-300';\n      item.innerHTML = `<span class=\"font-mono text-xs\">${conflict.blockType}[${conflict.blockIndex}].${conflict.field}</span>: <span class=\"text-green-600 dark:text-green-400\">embedded</span> vs <span class=\"text-red-600 dark:text-red-400\">legacy</span>`;\n      list.appendChild(item);\n    }\n\n    if (report.conflicts.length > 10) {\n      const more = document.createElement('li');\n      more.className = 'text-amber-600 dark:text-amber-400 italic';\n      more.textContent = `...and ${report.conflicts.length - 10} more`;\n      list.appendChild(more);\n    }\n\n    details.appendChild(list);\n    container.appendChild(details);\n  }\n\n  // Actions\n  const actions = document.createElement('div');\n  actions.className = 'mt-3 flex gap-2';\n\n  const dismissBtn = document.createElement('button');\n  dismissBtn.type = 'button';\n  dismissBtn.className = 'text-xs px-3 py-1 rounded border border-amber-300 text-amber-700 hover:bg-amber-100 dark:border-amber-600 dark:text-amber-300 dark:hover:bg-amber-900/40';\n  dismissBtn.textContent = 'Dismiss';\n  dismissBtn.addEventListener('click', () => container.remove());\n\n  actions.appendChild(dismissBtn);\n  container.appendChild(actions);\n\n  return container;\n}\n\n/**\n * Show conflict report in the block editor\n */\nfunction showConflictReport(root: HTMLElement, report: ConflictReport): void {\n  // Remove any existing report\n  root.querySelector('[data-block-conflict-report]')?.remove();\n\n  if (!report.hasConflicts) return;\n\n  const reportUI = createConflictReportUI(report);\n  const list = root.querySelector('[data-block-list]');\n  if (list) {\n    list.parentElement?.insertBefore(reportUI, list);\n  } else {\n    root.insertBefore(reportUI, root.firstChild);\n  }\n}\n\n// =============================================================================\n// DRAG & DROP HELPERS\n// =============================================================================\n\n/**\n * Create a drop indicator element\n */\nfunction createDropIndicator(): HTMLElement {\n  const indicator = document.createElement('div');\n  indicator.className = 'block-drop-indicator';\n  indicator.setAttribute('data-block-drop-indicator', 'true');\n  indicator.setAttribute('aria-hidden', 'true');\n  return indicator;\n}\n\n/**\n * Show drop indicator at a specific position\n */\nfunction showDropIndicator(\n  list: HTMLElement,\n  target: HTMLElement | null,\n  position: 'before' | 'after'\n): HTMLElement {\n  hideDropIndicators(list);\n  const indicator = createDropIndicator();\n\n  if (!target) {\n    list.appendChild(indicator);\n  } else if (position === 'before') {\n    target.parentElement?.insertBefore(indicator, target);\n  } else {\n    target.parentElement?.insertBefore(indicator, target.nextSibling);\n  }\n\n  return indicator;\n}\n\n/**\n * Hide all drop indicators in the list\n */\nfunction hideDropIndicators(list: HTMLElement): void {\n  list.querySelectorAll('[data-block-drop-indicator]').forEach((el) => el.remove());\n}\n\n/**\n * Create a drag placeholder element\n */\nfunction createDragPlaceholder(item: HTMLElement): HTMLElement {\n  const placeholder = document.createElement('div');\n  placeholder.className = 'block-drag-placeholder';\n  placeholder.setAttribute('data-block-placeholder', 'true');\n  placeholder.style.height = `${item.offsetHeight}px`;\n  return placeholder;\n}\n\n/**\n * Get the block item at a specific Y coordinate\n */\nfunction getBlockAtY(list: HTMLElement, y: number, exclude?: HTMLElement): { item: HTMLElement; position: 'before' | 'after' } | null {\n  const items = Array.from(list.querySelectorAll<HTMLElement>('[data-block-item]'));\n  for (const item of items) {\n    if (item === exclude) continue;\n    const rect = item.getBoundingClientRect();\n    if (y >= rect.top && y <= rect.bottom) {\n      const position = y < rect.top + rect.height / 2 ? 'before' : 'after';\n      return { item, position };\n    }\n  }\n  // Check if below all items\n  if (items.length > 0) {\n    const lastItem = items[items.length - 1];\n    if (lastItem !== exclude) {\n      const rect = lastItem.getBoundingClientRect();\n      if (y > rect.bottom) {\n        return { item: lastItem, position: 'after' };\n      }\n    }\n  }\n  return null;\n}\n\n/**\n * Animate reorder using FLIP technique\n */\nfunction animateReorder(list: HTMLElement, movedItem: HTMLElement): void {\n  const items = Array.from(list.querySelectorAll<HTMLElement>('[data-block-item]'));\n\n  // Record initial positions\n  const rects = new Map<HTMLElement, DOMRect>();\n  items.forEach((item) => {\n    rects.set(item, item.getBoundingClientRect());\n  });\n\n  // Force layout recalculation\n  void list.offsetHeight;\n\n  // Animate from old to new positions\n  items.forEach((item) => {\n    const oldRect = rects.get(item);\n    if (!oldRect) return;\n\n    const newRect = item.getBoundingClientRect();\n    const deltaY = oldRect.top - newRect.top;\n\n    if (Math.abs(deltaY) < 1) return;\n\n    item.animate(\n      [\n        { transform: `translateY(${deltaY}px)` },\n        { transform: 'translateY(0)' },\n      ],\n      {\n        duration: 200,\n        easing: 'ease-out',\n      }\n    );\n  });\n\n  // Special animation for the moved item\n  movedItem.animate(\n    [\n      { transform: 'scale(1.02)', boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)' },\n      { transform: 'scale(1)', boxShadow: 'none' },\n    ],\n    {\n      duration: 200,\n      easing: 'ease-out',\n    }\n  );\n}\n\n/**\n * Create live region for screen reader announcements\n */\nfunction createLiveRegion(): HTMLElement {\n  const existing = document.getElementById('block-editor-live-region');\n  if (existing) return existing;\n\n  const region = document.createElement('div');\n  region.id = 'block-editor-live-region';\n  region.setAttribute('aria-live', 'polite');\n  region.setAttribute('aria-atomic', 'true');\n  region.className = 'sr-only';\n  region.style.cssText = 'position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;';\n  document.body.appendChild(region);\n  return region;\n}\n\n/**\n * Announce a message to screen readers\n */\nfunction announce(message: string): void {\n  const region = createLiveRegion();\n  region.textContent = '';\n  // Force announcement by clearing and setting\n  requestAnimationFrame(() => {\n    region.textContent = message;\n  });\n}\n\n/**\n * Get block position info for announcements\n */\nfunction getBlockPositionInfo(list: HTMLElement, item: HTMLElement): { label: string; position: number; total: number } {\n  const items = Array.from(list.querySelectorAll<HTMLElement>('[data-block-item]'));\n  const position = items.indexOf(item) + 1;\n  const total = items.length;\n  const label = item.querySelector('[data-block-header] span')?.textContent || item.dataset.blockType || 'Block';\n  return { label, position, total };\n}\n\n/**\n * Collect block data for cross-editor drag\n */\nfunction collectBlockData(item: HTMLElement): Record<string, any> {\n  const data: Record<string, any> = {};\n  item.querySelectorAll<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>('input, select, textarea').forEach((field) => {\n    const key = field.getAttribute('data-block-field-name') || field.name;\n    if (!key || field.dataset.blockIgnore === 'true') return;\n    if (field instanceof HTMLInputElement && field.type === 'checkbox') {\n      data[key] = field.checked;\n    } else if (field instanceof HTMLSelectElement && field.multiple) {\n      data[key] = Array.from(field.selectedOptions).map((opt) => opt.value);\n    } else {\n      data[key] = field.value;\n    }\n  });\n  data._type = item.dataset.blockType || '';\n  data._schema = item.dataset.blockSchema || '';\n  return data;\n}\n\n/**\n * Auto-scroll during drag when near edges\n */\nfunction setupAutoScroll(\n  list: HTMLElement,\n  dragState: DragState,\n  scrollThreshold: number = 50,\n  scrollSpeed: number = 10\n): void {\n  const doScroll = () => {\n    if (!dragState.dragging) {\n      if (dragState.scrollInterval) {\n        clearInterval(dragState.scrollInterval);\n        dragState.scrollInterval = null;\n      }\n      return;\n    }\n\n    const listRect = list.getBoundingClientRect();\n    const y = dragState.touchCurrentY;\n\n    if (y < listRect.top + scrollThreshold) {\n      // Scroll up\n      list.scrollTop -= scrollSpeed;\n    } else if (y > listRect.bottom - scrollThreshold) {\n      // Scroll down\n      list.scrollTop += scrollSpeed;\n    }\n  };\n\n  if (!dragState.scrollInterval) {\n    dragState.scrollInterval = window.setInterval(doScroll, 16);\n  }\n}\n\nfunction ensureTypeField(item: HTMLElement, type: string): void {\n  const inputs = item.querySelectorAll<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>('[name=\"_type\"], [data-block-type-input]');\n  if (inputs.length === 0) {\n    const hidden = document.createElement('input');\n    hidden.type = 'hidden';\n    hidden.name = '_type';\n    hidden.value = type;\n    hidden.setAttribute('data-block-type-input', 'true');\n    hidden.setAttribute('data-block-ignore', 'true');\n    item.appendChild(hidden);\n    return;\n  }\n  inputs.forEach((input) => {\n    input.setAttribute('data-block-type-input', 'true');\n    input.setAttribute('data-block-ignore', 'true');\n    if (input instanceof HTMLInputElement) {\n      input.value = type;\n      input.readOnly = true;\n    } else if (input instanceof HTMLSelectElement) {\n      Array.from(input.options).forEach((opt) => {\n        opt.selected = opt.value === type;\n      });\n      input.disabled = true;\n    } else {\n      input.value = type;\n      input.readOnly = true;\n    }\n    const wrapper = input.closest<HTMLElement>('[data-component]');\n    if (wrapper) {\n      wrapper.classList.add('hidden');\n    }\n  });\n}\n\n/**\n * Ensure _schema field exists on the block item\n */\nfunction ensureSchemaField(item: HTMLElement, schemaVersion: string): void {\n  const inputs = item.querySelectorAll<HTMLInputElement>('[name=\"_schema\"], [data-block-schema-input]');\n  if (inputs.length === 0) {\n    const hidden = document.createElement('input');\n    hidden.type = 'hidden';\n    hidden.name = '_schema';\n    hidden.value = schemaVersion;\n    hidden.setAttribute('data-block-schema-input', 'true');\n    hidden.setAttribute('data-block-ignore', 'true');\n    item.appendChild(hidden);\n    return;\n  }\n  inputs.forEach((input) => {\n    input.setAttribute('data-block-schema-input', 'true');\n    input.setAttribute('data-block-ignore', 'true');\n    input.value = schemaVersion;\n    input.readOnly = true;\n    const wrapper = input.closest<HTMLElement>('[data-component]');\n    if (wrapper) {\n      wrapper.classList.add('hidden');\n    }\n  });\n}\n\nfunction initBlockEditor(root: HTMLElement): void {\n  const elements = resolveElements(root);\n  if (!elements) return;\n  const config = resolveConfig(root);\n  const templates = collectTemplates(root, config);\n  const baseName = root.dataset.blockField || elements.output.name;\n  const sortableHint = parseBoolean(root.dataset.blockSortable);\n  const sortable = config.sortable ?? sortableHint ?? false;\n  const allowDrag = config.allowDrag ?? sortable;\n  const addLabel = config.addLabel || elements.addButton?.dataset.blockAddLabel || 'Add block';\n  const emptyLabel = config.emptyLabel || elements.emptyState?.dataset.blockEmptyLabel || 'No blocks added yet.';\n  const validateOnInput = config.validateOnInput ?? true;\n\n  if (elements.addButton) {\n    elements.addButton.textContent = addLabel;\n  }\n  if (elements.emptyState) {\n    elements.emptyState.textContent = emptyLabel;\n  }\n\n  const list = elements.list;\n  const output = elements.output;\n\n  const syncOutput = () => {\n    const items = Array.from(list.querySelectorAll<HTMLElement>('[data-block-item]'));\n    let hasValidationErrors = false;\n\n    const payload = items.map((item) => {\n      const data: Record<string, any> = {};\n      const groups = new Map<string, Array<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>>();\n      item.querySelectorAll<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>('input, select, textarea').forEach((field) => {\n        if (field.dataset.blockIgnore === 'true' || field.hasAttribute('data-block-ignore')) return;\n        const key = field.getAttribute('data-block-field-name') || field.name || '';\n        if (!key) return;\n        if (!groups.has(key)) groups.set(key, []);\n        groups.get(key)!.push(field);\n      });\n      groups.forEach((group, key) => {\n        const value = readFieldValue(group);\n        if (value !== undefined) {\n          setByPath(data, key, value);\n        }\n      });\n      const blockType = item.dataset.blockType || data._type || '';\n      if (blockType) data._type = blockType;\n\n      // Add _schema version from template or item\n      const schemaVersion = item.dataset.blockSchema || data._schema;\n      if (schemaVersion) {\n        data._schema = schemaVersion;\n      } else {\n        const template = templates.get(blockType);\n        if (template?.schemaVersion) {\n          data._schema = template.schemaVersion;\n        }\n      }\n\n      // Validate block if enabled\n      if (validateOnInput) {\n        const template = templates.get(blockType);\n        if (template) {\n          const errors = validateBlock(item, template);\n          showBlockErrors(item, errors);\n          if (errors.length > 0) {\n            hasValidationErrors = true;\n          }\n        }\n      }\n\n      return data;\n    });\n    output.value = JSON.stringify(payload);\n\n    // Update root element validation state\n    root.dataset.blockEditorValid = hasValidationErrors ? 'false' : 'true';\n  };\n\n  const updateNames = () => {\n    const items = Array.from(list.querySelectorAll<HTMLElement>('[data-block-item]'));\n    items.forEach((item, index) => {\n      item.querySelectorAll<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>('input, select, textarea').forEach((field) => {\n        if (field.dataset.blockIgnore === 'true' || field.hasAttribute('data-block-ignore')) return;\n        const original = field.getAttribute('data-block-field-name') || field.name;\n        if (!original) return;\n        if (!field.hasAttribute('data-block-field-name')) {\n          field.setAttribute('data-block-field-name', original);\n        }\n        field.name = buildInputName(baseName, index, original);\n      });\n    });\n  };\n\n  const updateEmptyState = () => {\n    if (!elements.emptyState) return;\n    const hasItems = list.querySelector('[data-block-item]');\n    elements.emptyState.classList.toggle('hidden', Boolean(hasItems));\n  };\n\n  const syncAll = () => {\n    updateNames();\n    syncOutput();\n    updateEmptyState();\n  };\n\n  const form = root.closest('form');\n  if (form) {\n    form.addEventListener('submit', () => {\n      syncOutput();\n    });\n  }\n\n  const fillValues = (item: HTMLElement, values: Record<string, any>) => {\n    item.querySelectorAll<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>('input, select, textarea').forEach((field) => {\n      const key = field.getAttribute('data-block-field-name') || field.name;\n      if (!key) return;\n      const value = getByPath(values, key);\n      if (value !== undefined) {\n        setFieldValue(field, value);\n      }\n    });\n  };\n\n  const createBlockItem = (template: BlockTemplate, values?: Record<string, any>) => {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'border border-gray-200 rounded-lg bg-white shadow-sm dark:bg-slate-900 dark:border-gray-700';\n    wrapper.setAttribute('data-block-item', 'true');\n    wrapper.dataset.blockType = template.type;\n    if (sortable) {\n      wrapper.setAttribute('draggable', 'true');\n    }\n\n    const header = document.createElement('div');\n    header.className = 'flex flex-wrap items-center justify-between gap-2 p-3 border-b border-gray-200 dark:border-gray-700';\n    header.setAttribute('data-block-header', 'true');\n\n    const titleWrap = document.createElement('div');\n    titleWrap.className = 'flex items-center gap-2 text-sm font-medium text-gray-900 dark:text-white';\n\n    const icon = document.createElement('span');\n    icon.className = 'inline-flex items-center justify-center h-6 min-w-[1.5rem] px-2 text-xs font-semibold uppercase rounded-full bg-gray-100 text-gray-700 dark:bg-slate-800 dark:text-slate-200';\n    icon.textContent = template.icon || template.label.slice(0, 1).toUpperCase();\n\n    const label = document.createElement('span');\n    label.textContent = template.label;\n\n    const typeBadge = document.createElement('span');\n    typeBadge.className = 'text-xs text-gray-500 dark:text-gray-400';\n    typeBadge.textContent = template.type;\n\n    titleWrap.appendChild(icon);\n    titleWrap.appendChild(label);\n    titleWrap.appendChild(typeBadge);\n\n    const actions = document.createElement('div');\n    actions.className = 'flex items-center gap-2';\n\n    if (sortable) {\n      const moveUp = document.createElement('button');\n      moveUp.type = 'button';\n      moveUp.className = 'text-xs text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white';\n      moveUp.textContent = 'Up';\n      moveUp.setAttribute('data-block-move-up', 'true');\n\n      const moveDown = document.createElement('button');\n      moveDown.type = 'button';\n      moveDown.className = 'text-xs text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white';\n      moveDown.textContent = 'Down';\n      moveDown.setAttribute('data-block-move-down', 'true');\n\n      actions.appendChild(moveUp);\n      actions.appendChild(moveDown);\n    }\n\n    const collapseBtn = document.createElement('button');\n    collapseBtn.type = 'button';\n    collapseBtn.className = 'text-xs text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white';\n    collapseBtn.textContent = 'Collapse';\n    collapseBtn.setAttribute('data-block-collapse', 'true');\n\n    const removeBtn = document.createElement('button');\n    removeBtn.type = 'button';\n    removeBtn.className = 'text-xs text-red-600 hover:text-red-700';\n    removeBtn.textContent = 'Remove';\n    removeBtn.setAttribute('data-block-remove', 'true');\n\n    actions.appendChild(collapseBtn);\n    actions.appendChild(removeBtn);\n\n    if (sortable) {\n      const dragHandle = document.createElement('span');\n      dragHandle.className = 'text-xs text-gray-400 cursor-move';\n      dragHandle.textContent = 'Drag';\n      dragHandle.setAttribute('data-block-drag-handle', 'true');\n      actions.appendChild(dragHandle);\n    }\n\n    header.appendChild(titleWrap);\n    header.appendChild(actions);\n\n    const body = document.createElement('div');\n    body.className = 'p-4 space-y-4';\n    body.setAttribute('data-block-body', 'true');\n\n    const fragment = template.template.content.cloneNode(true) as DocumentFragment;\n    body.appendChild(fragment);\n\n    wrapper.appendChild(header);\n    wrapper.appendChild(body);\n\n    ensureTypeField(wrapper, template.type);\n    ensureSchemaField(wrapper, template.schemaVersion || generateSchemaVersion(template.type));\n    wrapper.dataset.blockSchema = template.schemaVersion || generateSchemaVersion(template.type);\n\n    if (values) {\n      fillValues(wrapper, values);\n    }\n\n    const shouldCollapse = template.collapsed ?? false;\n    if (shouldCollapse) {\n      body.classList.add('hidden');\n      wrapper.dataset.blockCollapsed = 'true';\n      collapseBtn.textContent = 'Expand';\n    }\n\n    return wrapper;\n  };\n\n  const addBlock = (type: string, values?: Record<string, any>) => {\n    const template = templates.get(type);\n    if (!template) return;\n    const item = createBlockItem(template, values);\n    list.appendChild(item);\n    syncAll();\n  };\n\n  const addButton = elements.addButton;\n  const addSelect = elements.addSelect;\n  if (addButton && addSelect) {\n    addButton.addEventListener('click', () => {\n      const type = addSelect.value.trim();\n      if (type) {\n        addBlock(type);\n        addSelect.value = '';\n      }\n    });\n  }\n\n  root.addEventListener('click', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const item = target.closest<HTMLElement>('[data-block-item]');\n    if (!item) return;\n    if (target.closest('[data-block-remove]')) {\n      item.remove();\n      syncAll();\n      return;\n    }\n    if (target.closest('[data-block-collapse]')) {\n      const body = item.querySelector<HTMLElement>('[data-block-body]');\n      if (body) {\n        const isCollapsed = body.classList.toggle('hidden');\n        item.dataset.blockCollapsed = isCollapsed ? 'true' : 'false';\n        const button = target.closest<HTMLButtonElement>('[data-block-collapse]');\n        if (button) button.textContent = isCollapsed ? 'Expand' : 'Collapse';\n      }\n      return;\n    }\n    if (target.closest('[data-block-move-up]')) {\n      const prev = item.previousElementSibling;\n      if (prev) list.insertBefore(item, prev);\n      syncAll();\n      return;\n    }\n    if (target.closest('[data-block-move-down]')) {\n      const next = item.nextElementSibling;\n      if (next) list.insertBefore(next, item);\n      syncAll();\n      return;\n    }\n  });\n\n  root.addEventListener('input', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement) || !target.closest('[data-block-item]')) return;\n    syncAll();\n  });\n  root.addEventListener('change', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement) || !target.closest('[data-block-item]')) return;\n    syncAll();\n  });\n\n  // =============================================================================\n  // DRAG & DROP IMPLEMENTATION\n  // =============================================================================\n  if (sortable && allowDrag) {\n    const dragFromHeader = config.dragFromHeader ?? true;\n    const enableTouch = config.enableTouch ?? true;\n    const enableAnimations = config.enableAnimations ?? true;\n    const enableCrossEditor = config.enableCrossEditor ?? false;\n\n    const dragState: DragState = {\n      dragging: null,\n      placeholder: null,\n      touchStartY: 0,\n      touchCurrentY: 0,\n      scrollInterval: null,\n      originalIndex: -1,\n    };\n\n    // Helper to check if drag should start\n    const canStartDrag = (target: HTMLElement): boolean => {\n      // Always allow from drag handle\n      if (target.closest('[data-block-drag-handle]')) return true;\n      // Allow from header if configured\n      if (dragFromHeader && target.closest('[data-block-header]')) {\n        // But not from buttons or inputs\n        if (target.closest('button, input, select, textarea')) return false;\n        return true;\n      }\n      return false;\n    };\n\n    // Get original index before drag\n    const getItemIndex = (item: HTMLElement): number => {\n      const items = Array.from(list.querySelectorAll<HTMLElement>('[data-block-item]'));\n      return items.indexOf(item);\n    };\n\n    // HTML5 Drag Events\n    list.addEventListener('dragstart', (event) => {\n      const target = event.target;\n      if (!(target instanceof HTMLElement)) return;\n\n      if (!canStartDrag(target)) {\n        event.preventDefault();\n        return;\n      }\n\n      const item = target.closest<HTMLElement>('[data-block-item]');\n      if (!item) return;\n\n      dragState.dragging = item;\n      dragState.originalIndex = getItemIndex(item);\n\n      item.classList.add('block-item--dragging');\n\n      // Set drag data for cross-editor support\n      if (event.dataTransfer) {\n        event.dataTransfer.effectAllowed = 'move';\n        event.dataTransfer.setData('text/plain', 'block');\n\n        if (enableCrossEditor) {\n          const blockData = collectBlockData(item);\n          event.dataTransfer.setData('application/x-block', JSON.stringify(blockData));\n        }\n\n        // Create custom drag image\n        const dragImage = item.cloneNode(true) as HTMLElement;\n        dragImage.style.cssText = 'position: absolute; top: -9999px; left: -9999px; opacity: 0.8; transform: rotate(2deg);';\n        document.body.appendChild(dragImage);\n        event.dataTransfer.setDragImage(dragImage, 20, 20);\n        requestAnimationFrame(() => dragImage.remove());\n      }\n\n      const info = getBlockPositionInfo(list, item);\n      announce(`Dragging ${info.label} from position ${info.position} of ${info.total}. Use arrow keys to move.`);\n    });\n\n    list.addEventListener('dragover', (event) => {\n      event.preventDefault();\n      if (event.dataTransfer) {\n        event.dataTransfer.dropEffect = 'move';\n      }\n\n      const y = event.clientY;\n      const result = getBlockAtY(list, y, dragState.dragging || undefined);\n\n      if (result) {\n        showDropIndicator(list, result.item, result.position);\n      } else {\n        hideDropIndicators(list);\n      }\n    });\n\n    list.addEventListener('dragenter', (event) => {\n      event.preventDefault();\n    });\n\n    list.addEventListener('dragleave', (event) => {\n      // Only hide if leaving the list entirely\n      const relatedTarget = event.relatedTarget as HTMLElement | null;\n      if (!relatedTarget || !list.contains(relatedTarget)) {\n        hideDropIndicators(list);\n      }\n    });\n\n    list.addEventListener('drop', (event) => {\n      event.preventDefault();\n      hideDropIndicators(list);\n\n      const y = event.clientY;\n      const result = getBlockAtY(list, y, dragState.dragging || undefined);\n\n      // Handle cross-editor drop\n      if (!dragState.dragging && enableCrossEditor && event.dataTransfer) {\n        const blockDataStr = event.dataTransfer.getData('application/x-block');\n        if (blockDataStr) {\n          try {\n            const blockData = JSON.parse(blockDataStr);\n            const type = blockData._type;\n            if (type && templates.has(type)) {\n              const template = templates.get(type)!;\n              const newItem = createBlockItem(template, blockData);\n              if (result) {\n                if (result.position === 'before') {\n                  list.insertBefore(newItem, result.item);\n                } else {\n                  list.insertBefore(newItem, result.item.nextSibling);\n                }\n              } else {\n                list.appendChild(newItem);\n              }\n              syncAll();\n              announce(`Block ${type} added from another editor`);\n            }\n          } catch {\n            // Ignore invalid data\n          }\n        }\n        return;\n      }\n\n      if (!dragState.dragging) return;\n\n      if (result) {\n        if (result.position === 'before') {\n          list.insertBefore(dragState.dragging, result.item);\n        } else {\n          list.insertBefore(dragState.dragging, result.item.nextSibling);\n        }\n      }\n\n      if (enableAnimations) {\n        animateReorder(list, dragState.dragging);\n      }\n\n      const newIndex = getItemIndex(dragState.dragging);\n      if (newIndex !== dragState.originalIndex) {\n        const info = getBlockPositionInfo(list, dragState.dragging);\n        announce(`${info.label} moved to position ${info.position} of ${info.total}`);\n      }\n    });\n\n    list.addEventListener('dragend', () => {\n      hideDropIndicators(list);\n\n      if (dragState.dragging) {\n        dragState.dragging.classList.remove('block-item--dragging');\n        dragState.dragging = null;\n      }\n\n      dragState.originalIndex = -1;\n      syncAll();\n    });\n\n    // =============================================================================\n    // TOUCH SUPPORT\n    // =============================================================================\n    if (enableTouch) {\n      let touchItem: HTMLElement | null = null;\n      let touchClone: HTMLElement | null = null;\n      let touchStarted = false;\n      const TOUCH_THRESHOLD = 10; // Minimum movement before drag starts\n\n      list.addEventListener('touchstart', (event) => {\n        const touch = event.touches[0];\n        const target = touch.target as HTMLElement;\n\n        if (!canStartDrag(target)) return;\n\n        const item = target.closest<HTMLElement>('[data-block-item]');\n        if (!item) return;\n\n        dragState.touchStartY = touch.clientY;\n        dragState.touchCurrentY = touch.clientY;\n        touchItem = item;\n        touchStarted = false;\n      }, { passive: true });\n\n      list.addEventListener('touchmove', (event) => {\n        if (!touchItem) return;\n\n        const touch = event.touches[0];\n        dragState.touchCurrentY = touch.clientY;\n\n        // Check if we've moved enough to start dragging\n        if (!touchStarted) {\n          const delta = Math.abs(touch.clientY - dragState.touchStartY);\n          if (delta < TOUCH_THRESHOLD) return;\n          touchStarted = true;\n\n          // Create visual clone for dragging\n          touchClone = touchItem.cloneNode(true) as HTMLElement;\n          touchClone.className = 'block-item--touch-dragging';\n          touchClone.style.cssText = `\n            position: fixed;\n            left: 0;\n            right: 0;\n            margin: 0 16px;\n            z-index: 9999;\n            pointer-events: none;\n            opacity: 0.9;\n            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);\n            transform: scale(1.02);\n          `;\n          document.body.appendChild(touchClone);\n\n          // Mark original as placeholder\n          touchItem.classList.add('block-item--placeholder');\n          dragState.dragging = touchItem;\n          dragState.originalIndex = getItemIndex(touchItem);\n\n          const info = getBlockPositionInfo(list, touchItem);\n          announce(`Dragging ${info.label}. Move finger to reposition.`);\n        }\n\n        event.preventDefault();\n\n        // Position clone at touch point\n        if (touchClone) {\n          touchClone.style.top = `${touch.clientY - touchClone.offsetHeight / 2}px`;\n        }\n\n        // Find drop target and show indicator\n        const result = getBlockAtY(list, touch.clientY, touchItem || undefined);\n        if (result) {\n          showDropIndicator(list, result.item, result.position);\n        } else {\n          hideDropIndicators(list);\n        }\n\n        // Auto-scroll\n        setupAutoScroll(list, dragState);\n      }, { passive: false });\n\n      list.addEventListener('touchend', () => {\n        if (dragState.scrollInterval) {\n          clearInterval(dragState.scrollInterval);\n          dragState.scrollInterval = null;\n        }\n\n        hideDropIndicators(list);\n\n        if (touchClone) {\n          touchClone.remove();\n          touchClone = null;\n        }\n\n        if (touchItem && touchStarted) {\n          touchItem.classList.remove('block-item--placeholder');\n\n          // Find final position\n          const result = getBlockAtY(list, dragState.touchCurrentY, touchItem);\n          if (result) {\n            if (result.position === 'before') {\n              list.insertBefore(touchItem, result.item);\n            } else {\n              list.insertBefore(touchItem, result.item.nextSibling);\n            }\n          }\n\n          if (enableAnimations) {\n            animateReorder(list, touchItem);\n          }\n\n          const newIndex = getItemIndex(touchItem);\n          if (newIndex !== dragState.originalIndex) {\n            const info = getBlockPositionInfo(list, touchItem);\n            announce(`${info.label} moved to position ${info.position} of ${info.total}`);\n          }\n\n          syncAll();\n        }\n\n        touchItem = null;\n        touchStarted = false;\n        dragState.dragging = null;\n        dragState.originalIndex = -1;\n      });\n\n      list.addEventListener('touchcancel', () => {\n        if (dragState.scrollInterval) {\n          clearInterval(dragState.scrollInterval);\n          dragState.scrollInterval = null;\n        }\n\n        hideDropIndicators(list);\n\n        if (touchClone) {\n          touchClone.remove();\n          touchClone = null;\n        }\n\n        if (touchItem) {\n          touchItem.classList.remove('block-item--placeholder');\n        }\n\n        touchItem = null;\n        touchStarted = false;\n        dragState.dragging = null;\n        dragState.originalIndex = -1;\n      });\n    }\n  }\n\n  if (elements.addSelect) {\n    const placeholder = document.createElement('option');\n    placeholder.value = '';\n    placeholder.textContent = 'Select block type';\n    elements.addSelect.appendChild(placeholder);\n    templates.forEach((template) => {\n      const option = document.createElement('option');\n      option.value = template.type;\n      option.textContent = template.label;\n      elements.addSelect?.appendChild(option);\n    });\n    elements.addSelect.value = '';\n  }\n\n  // Keyboard accessibility\n  root.addEventListener('keydown', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const item = target.closest<HTMLElement>('[data-block-item]');\n    if (!item) return;\n\n    const isHeader = target.closest('[data-block-header]');\n    if (!isHeader) return;\n\n    switch (event.key) {\n      case 'Delete':\n      case 'Backspace':\n        if (event.shiftKey) {\n          event.preventDefault();\n          item.remove();\n          syncAll();\n          // Focus next or previous item\n          const next = list.querySelector<HTMLElement>('[data-block-item] [data-block-header]');\n          next?.focus();\n        }\n        break;\n      case 'ArrowUp':\n        if (event.altKey && sortable) {\n          event.preventDefault();\n          const prev = item.previousElementSibling;\n          if (prev) {\n            list.insertBefore(item, prev);\n            syncAll();\n            (item.querySelector('[data-block-header]') as HTMLElement)?.focus();\n            const info = getBlockPositionInfo(list, item);\n            announce(`${info.label} moved to position ${info.position} of ${info.total}`);\n          } else {\n            announce('Already at the top');\n          }\n        } else if (!event.altKey) {\n          event.preventDefault();\n          const prevItem = item.previousElementSibling as HTMLElement;\n          const prevHeader = prevItem?.querySelector<HTMLElement>('[data-block-header]');\n          if (prevHeader) {\n            prevHeader.focus();\n          } else {\n            announce('At the first block');\n          }\n        }\n        break;\n      case 'ArrowDown':\n        if (event.altKey && sortable) {\n          event.preventDefault();\n          const next = item.nextElementSibling;\n          if (next) {\n            list.insertBefore(next, item);\n            syncAll();\n            (item.querySelector('[data-block-header]') as HTMLElement)?.focus();\n            const info = getBlockPositionInfo(list, item);\n            announce(`${info.label} moved to position ${info.position} of ${info.total}`);\n          } else {\n            announce('Already at the bottom');\n          }\n        } else if (!event.altKey) {\n          event.preventDefault();\n          const nextItem = item.nextElementSibling as HTMLElement;\n          const nextHeader = nextItem?.querySelector<HTMLElement>('[data-block-header]');\n          if (nextHeader) {\n            nextHeader.focus();\n          } else {\n            announce('At the last block');\n          }\n        }\n        break;\n      case 'Enter':\n      case ' ':\n        if (target.matches('[data-block-collapse]')) {\n          event.preventDefault();\n          target.click();\n        } else if (target.matches('[data-block-remove]')) {\n          event.preventDefault();\n          target.click();\n        } else if (target.matches('[data-block-move-up]')) {\n          event.preventDefault();\n          target.click();\n        } else if (target.matches('[data-block-move-down]')) {\n          event.preventDefault();\n          target.click();\n        } else if (isHeader && !target.matches('button')) {\n          // Toggle collapse when pressing Enter on header\n          event.preventDefault();\n          const collapseBtn = item.querySelector<HTMLButtonElement>('[data-block-collapse]');\n          collapseBtn?.click();\n        }\n        break;\n      case 'Escape':\n        // Collapse the block\n        const body = item.querySelector<HTMLElement>('[data-block-body]');\n        if (body && !body.classList.contains('hidden')) {\n          event.preventDefault();\n          body.classList.add('hidden');\n          item.dataset.blockCollapsed = 'true';\n          const collapseBtn = item.querySelector<HTMLButtonElement>('[data-block-collapse]');\n          if (collapseBtn) collapseBtn.textContent = 'Expand';\n        }\n        break;\n    }\n  });\n\n  // Make block headers focusable for keyboard navigation\n  const makeHeadersFocusable = () => {\n    list.querySelectorAll<HTMLElement>('[data-block-header]').forEach((header) => {\n      if (!header.hasAttribute('tabindex')) {\n        header.setAttribute('tabindex', '0');\n        header.setAttribute('role', 'button');\n        header.setAttribute('aria-label', 'Block header - Press Enter to collapse/expand, Shift+Delete to remove');\n      }\n    });\n  };\n\n  // Observe for new blocks to make their headers focusable\n  const observer = new MutationObserver(() => {\n    makeHeadersFocusable();\n  });\n  observer.observe(list, { childList: true, subtree: true });\n\n  const initialValue = output.value?.trim();\n  let embeddedBlocks: any[] = [];\n  if (initialValue) {\n    try {\n      const parsed = JSON.parse(initialValue) as any;\n      if (Array.isArray(parsed)) {\n        embeddedBlocks = parsed;\n        parsed.forEach((entry) => {\n          const type = typeof entry === 'object' && entry ? (entry._type as string) : '';\n          if (type && templates.has(type)) {\n            addBlock(type, entry);\n          }\n        });\n      }\n    } catch {\n      // ignore malformed data\n    }\n  }\n\n  // Conflict detection\n  const showConflicts = config.showConflicts ?? true;\n  if (showConflicts && config.legacyBlocks && Array.isArray(config.legacyBlocks)) {\n    const report = detectBlockConflicts(embeddedBlocks, config.legacyBlocks);\n    if (report.hasConflicts) {\n      showConflictReport(root, report);\n    }\n  }\n\n  // Also check for legacy blocks from data attribute\n  const legacyBlocksAttr = root.dataset.blockLegacy;\n  if (showConflicts && legacyBlocksAttr) {\n    try {\n      const legacyBlocks = JSON.parse(legacyBlocksAttr);\n      if (Array.isArray(legacyBlocks)) {\n        const report = detectBlockConflicts(embeddedBlocks, legacyBlocks);\n        if (report.hasConflicts) {\n          showConflictReport(root, report);\n        }\n      }\n    } catch {\n      // ignore malformed legacy data\n    }\n  }\n\n  syncAll();\n}\n\nexport function initBlockEditors(scope: ParentNode = document): void {\n  const roots = Array.from(scope.querySelectorAll<HTMLElement>('[data-component=\"block\"], [data-block-editor]'));\n  roots.forEach((root) => initBlockEditor(root));\n}\n\nfunction onReady(fn: () => void): void {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', fn, { once: true });\n  } else {\n    fn();\n  }\n}\n\nonReady(() => initBlockEditors());\n"],"names":["parseConfig","raw","parsed","resolveConfig","root","configRoot","parseBoolean","value","normalized","resolveElements","list","output","addSelect","addButton","emptyState","toPathParts","part","buildInputName","base","index","parts","result","getByPath","data","rawPath","current","setByPath","target","idx","isLast","nextPart","nextIsIndex","readFieldValue","elements","first","opt","checked","el","setFieldValue","element","values","collectTemplates","config","templates","template","type","label","icon","collapsed","schemaVersion","generateSchemaVersion","requiredFieldsRaw","requiredFields","f","pattern","validateBlock","item","errors","fieldName","field","isEmpty","radioGroup","r","showBlockErrors","clearBlockErrors","header","errorBadge","error","wrapper","errorMsg","detectBlockConflicts","embedded","legacy","conflicts","maxLen","i","embBlock","legBlock","blockType","allKeys","key","embVal","legVal","deepEqual","a","b","val","keysA","keysB","createConflictReportUI","report","container","title","summary","details","summaryEl","conflict","more","actions","dismissBtn","showConflictReport","reportUI","createDropIndicator","indicator","showDropIndicator","position","hideDropIndicators","getBlockAtY","y","exclude","items","rect","lastItem","animateReorder","movedItem","rects","oldRect","newRect","deltaY","createLiveRegion","existing","region","announce","message","getBlockPositionInfo","total","collectBlockData","setupAutoScroll","dragState","scrollThreshold","scrollSpeed","doScroll","listRect","ensureTypeField","inputs","hidden","input","ensureSchemaField","initBlockEditor","baseName","sortableHint","sortable","allowDrag","addLabel","emptyLabel","validateOnInput","syncOutput","hasValidationErrors","payload","groups","group","updateNames","original","updateEmptyState","hasItems","syncAll","form","fillValues","createBlockItem","titleWrap","typeBadge","moveUp","moveDown","collapseBtn","removeBtn","dragHandle","body","fragment","addBlock","event","isCollapsed","button","prev","next","dragFromHeader","enableTouch","enableAnimations","enableCrossEditor","canStartDrag","getItemIndex","blockData","dragImage","info","relatedTarget","blockDataStr","newItem","touchItem","touchClone","touchStarted","TOUCH_THRESHOLD","touch","placeholder","option","isHeader","prevHeader","nextHeader","makeHeadersFocusable","initialValue","embeddedBlocks","entry","showConflicts","legacyBlocksAttr","legacyBlocks","initBlockEditors","scope","onReady","fn"],"mappings":"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"}