{"version":3,"file":"error-helpers-DitNcCtC.js","sources":["../../src/shared/modal.ts","../../src/toast/error-helpers.ts"],"sourcesContent":["/**\n * Shared Modal Base Class\n *\n * Provides backdrop management, opacity animations, escape-key handling,\n * z-index stacking for nested modals, body scroll lock, and cleanup.\n *\n * Subclasses implement renderContent() and bindContentEvents() to provide\n * their specific content and behavior.\n *\n * Usage:\n *   class MyModal extends Modal {\n *     constructor() { super({ size: 'lg' }); }\n *     protected renderContent(): string { return '<div>...</div>'; }\n *     protected bindContentEvents(): void { ... }\n *   }\n *   new MyModal().show();\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type ModalSize = 'sm' | 'md' | 'lg' | 'xl' | '2xl' | '3xl' | '4xl';\n\nexport interface ModalOptions {\n  /** Maximum width. Default: 'lg' */\n  size?: ModalSize;\n  /** Maximum height class. Default: 'max-h-[90vh]' */\n  maxHeight?: string;\n  /** Use flex flex-col on container. Default: true */\n  flexColumn?: boolean;\n  /** Animation duration in ms. Default: 150 */\n  animationDuration?: number;\n  /** Backdrop click dismisses modal. Default: true */\n  dismissOnBackdropClick?: boolean;\n  /** Escape key dismisses modal. Default: true */\n  dismissOnEscape?: boolean;\n  /** Lock body scroll when open. Default: true */\n  lockBodyScroll?: boolean;\n  /** CSS selector for element to focus on open */\n  initialFocus?: string | null;\n  /** Extra CSS classes for the container div */\n  containerClass?: string;\n  /** Data attribute name to set on backdrop (e.g. 'data-my-modal-backdrop') */\n  backdropDataAttr?: string;\n}\n\n// ---------------------------------------------------------------------------\n// Size map\n// ---------------------------------------------------------------------------\n\nconst SIZE_MAP: Record<ModalSize, string> = {\n  sm: 'max-w-sm',\n  md: 'max-w-md',\n  lg: 'max-w-lg',\n  xl: 'max-w-xl',\n  '2xl': 'max-w-2xl',\n  '3xl': 'max-w-3xl',\n  '4xl': 'max-w-4xl',\n};\n\n// ---------------------------------------------------------------------------\n// Z-Index Stack Manager (module singleton)\n// ---------------------------------------------------------------------------\n\nconst MODAL_BASE_Z = 100;\nconst MODAL_Z_STEP = 10;\n\nclass ModalStack {\n  private stack: Modal[] = [];\n\n  push(modal: Modal): number {\n    this.stack.push(modal);\n    return MODAL_BASE_Z + this.stack.length * MODAL_Z_STEP;\n  }\n\n  remove(modal: Modal): void {\n    const idx = this.stack.indexOf(modal);\n    if (idx !== -1) this.stack.splice(idx, 1);\n  }\n\n  isTopmost(modal: Modal): boolean {\n    return this.stack.length > 0 && this.stack[this.stack.length - 1] === modal;\n  }\n\n  get count(): number {\n    return this.stack.length;\n  }\n}\n\nconst modalStack = new ModalStack();\n\n// ---------------------------------------------------------------------------\n// Modal Base Class\n// ---------------------------------------------------------------------------\n\nexport abstract class Modal {\n  protected backdrop: HTMLElement | null = null;\n  protected container: HTMLElement | null = null;\n\n  private _options: Required<ModalOptions>;\n  private _escHandler: ((e: KeyboardEvent) => void) | null = null;\n  private _isOpen = false;\n\n  constructor(opts: ModalOptions = {}) {\n    this._options = {\n      size: opts.size ?? 'lg',\n      maxHeight: opts.maxHeight ?? 'max-h-[90vh]',\n      flexColumn: opts.flexColumn ?? true,\n      animationDuration: opts.animationDuration ?? 150,\n      dismissOnBackdropClick: opts.dismissOnBackdropClick ?? true,\n      dismissOnEscape: opts.dismissOnEscape ?? true,\n      lockBodyScroll: opts.lockBodyScroll ?? true,\n      initialFocus: opts.initialFocus ?? null,\n      containerClass: opts.containerClass ?? '',\n      backdropDataAttr: opts.backdropDataAttr ?? '',\n    };\n  }\n\n  get isOpen(): boolean {\n    return this._isOpen;\n  }\n\n  protected get options(): Required<ModalOptions> {\n    return this._options;\n  }\n\n  // ---- Abstract: subclasses must implement --------------------------------\n\n  /** Return inner HTML for the container. Called once during show(). */\n  protected abstract renderContent(): string;\n\n  /** Bind event listeners to content elements. Called after renderContent(). */\n  protected abstract bindContentEvents(): void;\n\n  // ---- Lifecycle ----------------------------------------------------------\n\n  /** Show the modal. Async to support subclass data loading in onAfterShow(). */\n  async show(): Promise<void> {\n    if (this._isOpen) return;\n\n    const zIndex = modalStack.push(this);\n\n    // Backdrop\n    this.backdrop = document.createElement('div');\n    this.backdrop.className =\n      'fixed inset-0 flex items-center justify-center bg-black/50 transition-opacity opacity-0';\n    this.backdrop.style.zIndex = String(zIndex);\n    this.backdrop.style.transitionDuration = `${this._options.animationDuration}ms`;\n\n    if (this._options.backdropDataAttr) {\n      this.backdrop.setAttribute(this._options.backdropDataAttr, 'true');\n    }\n\n    // Container\n    const sizeClass = SIZE_MAP[this._options.size] ?? SIZE_MAP.lg;\n    const flexClass = this._options.flexColumn ? 'flex flex-col' : '';\n    const extra = this._options.containerClass;\n\n    this.container = document.createElement('div');\n    this.container.className = [\n      'bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full overflow-hidden',\n      sizeClass,\n      this._options.maxHeight,\n      flexClass,\n      extra,\n    ]\n      .filter(Boolean)\n      .join(' ');\n\n    // Render subclass content\n    this.container.innerHTML = this.renderContent();\n\n    // Assemble DOM\n    this.backdrop.appendChild(this.container);\n    document.body.appendChild(this.backdrop);\n\n    // Lock body scroll\n    if (this._options.lockBodyScroll) {\n      document.body.classList.add('overflow-hidden');\n    }\n\n    // Animate in\n    requestAnimationFrame(() => {\n      this.backdrop?.classList.remove('opacity-0');\n    });\n\n    // Bind base events (backdrop click, escape)\n    this._bindBaseEvents();\n\n    // Bind subclass content events\n    this.bindContentEvents();\n\n    this._isOpen = true;\n\n    // Hook for subclass async loading\n    await this.onAfterShow();\n\n    // Focus management\n    this._manageFocus();\n  }\n\n  /** Hide the modal with fade-out animation. */\n  hide(): void {\n    if (!this._isOpen || !this.backdrop) return;\n    this._isOpen = false;\n\n    modalStack.remove(this);\n\n    this.backdrop.classList.add('opacity-0');\n    setTimeout(() => {\n      this._cleanup();\n    }, this._options.animationDuration);\n  }\n\n  /** Remove immediately without animation. */\n  destroy(): void {\n    this._isOpen = false;\n    modalStack.remove(this);\n    this._cleanup();\n  }\n\n  // ---- Hooks for subclasses -----------------------------------------------\n\n  /** Called after DOM is mounted and events are bound. Override for data loading. */\n  protected async onAfterShow(): Promise<void> {\n    // no-op by default\n  }\n\n  /** Called before hide. Return false to prevent closing. */\n  protected onBeforeHide(): boolean {\n    return true;\n  }\n\n  // ---- Internal -----------------------------------------------------------\n\n  /** Try to hide; calls onBeforeHide() first. */\n  protected requestHide(): void {\n    if (this.onBeforeHide()) {\n      this.hide();\n    }\n  }\n\n  private _bindBaseEvents(): void {\n    if (this._options.dismissOnBackdropClick && this.backdrop) {\n      this.backdrop.addEventListener('click', (e) => {\n        if (e.target === this.backdrop) {\n          this.requestHide();\n        }\n      });\n    }\n\n    if (this._options.dismissOnEscape) {\n      this._escHandler = (e: KeyboardEvent) => {\n        if (e.key === 'Escape' && modalStack.isTopmost(this)) {\n          e.stopPropagation();\n          this.requestHide();\n        }\n      };\n      document.addEventListener('keydown', this._escHandler, true);\n    }\n  }\n\n  private _manageFocus(): void {\n    if (!this.container || !this._options.initialFocus) return;\n\n    const target = this.container.querySelector<HTMLElement>(this._options.initialFocus);\n    if (target && typeof target.focus === 'function') {\n      target.focus();\n      if (target instanceof HTMLInputElement) {\n        target.select();\n      }\n    }\n  }\n\n  private _cleanup(): void {\n    if (this._escHandler) {\n      document.removeEventListener('keydown', this._escHandler, true);\n      this._escHandler = null;\n    }\n\n    this.backdrop?.remove();\n    this.backdrop = null;\n    this.container = null;\n\n    if (this._options.lockBodyScroll && modalStack.count === 0) {\n      document.body.classList.remove('overflow-hidden');\n    }\n  }\n}\n\n// ---------------------------------------------------------------------------\n// ConfirmModal (Promise-based)\n// ---------------------------------------------------------------------------\n\nexport interface ConfirmModalOptions {\n  title?: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  confirmVariant?: 'primary' | 'danger';\n}\n\nexport class ConfirmModal extends Modal {\n  private _resolve!: (value: boolean) => void;\n  private _opts: Required<ConfirmModalOptions>;\n  private _isDone = false;\n\n  constructor(options: ConfirmModalOptions) {\n    super({\n      size: 'md',\n      maxHeight: '',\n      flexColumn: false,\n      dismissOnBackdropClick: true,\n      dismissOnEscape: true,\n      lockBodyScroll: false,\n    });\n    this._opts = {\n      title: options.title ?? 'Confirm',\n      message: options.message,\n      confirmText: options.confirmText ?? 'Confirm',\n      cancelText: options.cancelText ?? 'Cancel',\n      confirmVariant: options.confirmVariant ?? 'primary',\n    };\n  }\n\n  /** Show and return a promise that resolves when user decides. */\n  static confirm(\n    message: string,\n    options: Omit<ConfirmModalOptions, 'message'> = {},\n  ): Promise<boolean> {\n    const modal = new ConfirmModal({ ...options, message });\n    return modal.prompt();\n  }\n\n  prompt(): Promise<boolean> {\n    return new Promise<boolean>((resolve) => {\n      this._resolve = resolve;\n      this.show();\n    });\n  }\n\n  protected renderContent(): string {\n    const btnClass =\n      this._opts.confirmVariant === 'danger'\n        ? 'bg-red-600 hover:bg-red-700 text-white'\n        : 'bg-blue-600 hover:bg-blue-700 text-white';\n\n    return `\n      <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <h3 class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          ${escapeHtml(this._opts.title)}\n        </h3>\n      </div>\n      <div class=\"px-6 py-4\">\n        <p class=\"text-sm text-gray-600 dark:text-gray-400\">\n          ${escapeHtml(this._opts.message)}\n        </p>\n      </div>\n      <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\n        <button type=\"button\" data-modal-cancel\n          class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer\">\n          ${escapeHtml(this._opts.cancelText)}\n        </button>\n        <button type=\"button\" data-modal-confirm\n          class=\"px-4 py-2 text-sm font-medium rounded-lg cursor-pointer ${btnClass}\">\n          ${escapeHtml(this._opts.confirmText)}\n        </button>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    this.container?.querySelector('[data-modal-cancel]')?.addEventListener('click', () => {\n      this._finish(false);\n    });\n    this.container?.querySelector('[data-modal-confirm]')?.addEventListener('click', () => {\n      this._finish(true);\n    });\n  }\n\n  protected onBeforeHide(): boolean {\n    if (!this._isDone) {\n      this._isDone = true;\n      this._resolve(false);\n    }\n    return true;\n  }\n\n  private _finish(confirmed: boolean): void {\n    if (this._isDone) return;\n    this._isDone = true;\n    this._resolve(confirmed);\n    this.hide();\n  }\n}\n\n// ---------------------------------------------------------------------------\n// TextPromptModal (single text input)\n// ---------------------------------------------------------------------------\n\nexport interface TextPromptModalConfig {\n  title: string;\n  label: string;\n  placeholder?: string;\n  initialValue?: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  /** CSS class string for the text input. Falls back to a sensible default. */\n  inputClass?: string;\n  onConfirm: (value: string) => void;\n  onCancel?: () => void;\n}\n\nconst DEFAULT_INPUT_CLASS =\n  'w-full border rounded-lg bg-white text-gray-900 placeholder-gray-400 ' +\n  'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ' +\n  'dark:border-gray-600 dark:bg-slate-800 dark:text-white dark:placeholder-gray-500 ' +\n  'px-3 py-2 text-sm border-gray-300';\n\nexport class TextPromptModal extends Modal {\n  private config: TextPromptModalConfig;\n\n  constructor(config: TextPromptModalConfig) {\n    super({ size: 'sm', initialFocus: '[data-prompt-input]' });\n    this.config = config;\n  }\n\n  protected renderContent(): string {\n    const cls = this.config.inputClass ?? DEFAULT_INPUT_CLASS;\n    return `\n      <div class=\"p-5\">\n        <div class=\"text-base font-semibold text-gray-900 dark:text-white\">${escapeHtml(this.config.title)}</div>\n        <label class=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mt-3 mb-1\">${escapeHtml(this.config.label)}</label>\n        <input type=\"text\"\n               data-prompt-input\n               value=\"${escapeHtml(this.config.initialValue ?? '')}\"\n               placeholder=\"${escapeHtml(this.config.placeholder ?? '')}\"\n               class=\"${cls}\" />\n        <div data-prompt-error class=\"hidden text-xs text-red-600 dark:text-red-400 mt-1\"></div>\n        <div class=\"flex items-center justify-end gap-2 mt-4\">\n          <button type=\"button\" data-prompt-cancel\n                  class=\"px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer\">\n            ${escapeHtml(this.config.cancelLabel ?? 'Cancel')}\n          </button>\n          <button type=\"button\" data-prompt-confirm\n                  class=\"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer\">\n            ${escapeHtml(this.config.confirmLabel ?? 'Save')}\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    const input = this.container?.querySelector<HTMLInputElement>('[data-prompt-input]');\n    const errorEl = this.container?.querySelector<HTMLElement>('[data-prompt-error]');\n    const confirmBtn = this.container?.querySelector<HTMLButtonElement>('[data-prompt-confirm]');\n    const cancelBtn = this.container?.querySelector<HTMLButtonElement>('[data-prompt-cancel]');\n\n    const showError = (message: string): void => {\n      if (!errorEl) return;\n      errorEl.textContent = message;\n      errorEl.classList.remove('hidden');\n    };\n\n    const handleConfirm = (): void => {\n      const value = input?.value.trim() ?? '';\n      if (!value) {\n        showError('Value is required.');\n        input?.focus();\n        return;\n      }\n      this.config.onConfirm(value);\n      this.hide();\n    };\n\n    confirmBtn?.addEventListener('click', handleConfirm);\n    input?.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        handleConfirm();\n      }\n    });\n    cancelBtn?.addEventListener('click', () => {\n      this.config.onCancel?.();\n      this.hide();\n    });\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\nexport function escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n","/**\n * Error message extraction helpers\n * Matches the repository's actual backend error formats\n */\n\n/**\n * Extract user-friendly error message from fetch Response\n * Handles multiple backend formats used in this repo:\n * 1. /admin/api/* format: {status, error} (quickstart/error_fiber.go)\n * 2. /admin/crud/* format: Problem+JSON {detail, title} (go-crud)\n * 3. go-users errors: Text with \"go-users:\" prefix\n */\nexport async function extractErrorMessage(response: Response): Promise<string> {\n  const contentType = response.headers.get('content-type') || '';\n  const isJson =\n    contentType.includes('application/json') ||\n    contentType.includes('application/problem+json');\n\n  const bodyText = await response.clone().text().catch(() => '');\n\n  if (bodyText) {\n    // Try JSON payloads first (including Problem Details)\n    if (isJson || bodyText.trim().startsWith('{')) {\n      try {\n        const data = JSON.parse(bodyText) as Record<string, unknown>;\n\n        // Priority 1: /admin/api/* format (quickstart/error_fiber.go:18)\n        if (typeof data.error === 'string' && data.error.trim()) return data.error.trim();\n        if (data.error && typeof data.error === 'object') {\n          const errObj = data.error as Record<string, unknown>;\n          const message =\n            typeof errObj.message === 'string' ? errObj.message.trim() : '';\n          const fieldMessages: string[] = [];\n\n          if (Array.isArray(errObj.validation_errors)) {\n            for (const entry of errObj.validation_errors) {\n              if (!entry || typeof entry !== 'object') continue;\n              const field = (entry as Record<string, unknown>).field;\n              const msg = (entry as Record<string, unknown>).message;\n              if (typeof field === 'string' && typeof msg === 'string') {\n                fieldMessages.push(`${field}: ${msg}`);\n              }\n            }\n          }\n\n          const metadata = errObj.metadata;\n          if (metadata && typeof metadata === 'object') {\n            const fields = (metadata as Record<string, unknown>).fields;\n            if (fields && typeof fields === 'object' && !Array.isArray(fields)) {\n              for (const [field, msg] of Object.entries(fields)) {\n                if (typeof msg === 'string') {\n                  fieldMessages.push(`${field}: ${msg}`);\n                }\n              }\n            }\n          }\n\n          if (fieldMessages.length > 0) {\n            const prefix =\n              message && message.toLowerCase() !== 'validation failed'\n                ? `${message}: `\n                : 'Validation failed: ';\n            return `${prefix}${fieldMessages.join('; ')}`;\n          }\n          if (message) return message;\n        }\n\n        // Priority 2: Problem+JSON (go-crud)\n        if (typeof data.detail === 'string' && data.detail.trim()) return data.detail.trim();\n        if (typeof data.title === 'string' && data.title.trim()) return data.title.trim();\n\n        // Priority 3: Generic message field\n        if (typeof data.message === 'string' && data.message.trim()) return data.message.trim();\n      } catch {\n        // Not JSON (or parse failed) - fall through to text handling\n      }\n    }\n\n    // Extract go-users errors: \"... | go-users: lifecycle transition not allowed\"\n    if (bodyText.includes('go-users:')) {\n      const match = bodyText.match(/go-users:\\s*([^|]+)/);\n      if (match) return match[1].trim();\n    }\n\n    // Extract pipe-separated errors (common pattern)\n    const pipeMatch = bodyText.match(/\\|\\s*([^|]+)$/);\n    if (pipeMatch) return pipeMatch[1].trim();\n\n    // If text is short enough, return it directly\n    if (bodyText.trim().length > 0 && bodyText.length < 200) return bodyText.trim();\n  }\n\n  // Fallback to status code\n  return `Request failed (${response.status})`;\n}\n\n/**\n * Extract error message from various error types\n */\nexport function getErrorMessage(error: unknown): string {\n  if (error instanceof Error) {\n    return error.message;\n  }\n\n  if (typeof error === 'string') {\n    return error;\n  }\n\n  return 'An unexpected error occurred';\n}\n"],"names":["SIZE_MAP","MODAL_BASE_Z","MODAL_Z_STEP","ModalStack","modal","idx","modalStack","Modal","opts","zIndex","sizeClass","flexClass","extra","e","target","ConfirmModal","options","message","resolve","btnClass","escapeHtml","confirmed","DEFAULT_INPUT_CLASS","TextPromptModal","config","cls","input","errorEl","confirmBtn","cancelBtn","showError","handleConfirm","value","str","extractErrorMessage","response","contentType","isJson","bodyText","data","errObj","fieldMessages","entry","field","msg","metadata","fields","match","pipeMatch","getErrorMessage","error"],"mappings":"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"}