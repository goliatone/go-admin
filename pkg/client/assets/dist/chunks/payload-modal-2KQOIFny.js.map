{"version":3,"file":"payload-modal-2KQOIFny.js","sources":["../../src/datatable/payload-modal.ts"],"sourcesContent":["/**\n * Payload Input Modal\n *\n * Reusable modal for collecting payload values from users\n * before executing actions that require input.\n */\n\nimport { Modal, escapeHtml } from '../shared/modal.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface PayloadModalFieldOption {\n  value: string;\n  label: string;\n  /** Optional description/hint for the option */\n  description?: string;\n  /** Whether this option is recommended (for preselection) */\n  recommended?: boolean;\n}\n\nexport interface PayloadModalField {\n  name: string;\n  label: string;\n  description?: string;\n  value: string;\n  type: string;\n  options?: PayloadModalFieldOption[];\n}\n\nexport interface PayloadModalConfig {\n  title: string;\n  fields: PayloadModalField[];\n  confirmLabel?: string;\n  cancelLabel?: string;\n}\n\n// ============================================================================\n// PayloadInputModal\n// ============================================================================\n\nexport class PayloadInputModal extends Modal {\n  private readonly modalConfig: PayloadModalConfig;\n  private readonly onConfirm: (values: Record<string, string>) => void;\n  private readonly onCancel: () => void;\n  private resolved = false;\n\n  constructor(\n    config: PayloadModalConfig,\n    onConfirm: (values: Record<string, string>) => void,\n    onCancel: () => void\n  ) {\n    super({ size: 'md', initialFocus: '[data-payload-field]', lockBodyScroll: false });\n    this.modalConfig = config;\n    this.onConfirm = onConfirm;\n    this.onCancel = onCancel;\n  }\n\n  /**\n   * Show modal and return promise that resolves with values or null if cancelled\n   */\n  static prompt(config: PayloadModalConfig): Promise<Record<string, string> | null> {\n    return new Promise<Record<string, string> | null>((resolve) => {\n      const modal = new PayloadInputModal(\n        config,\n        (values) => resolve(values),\n        () => resolve(null)\n      );\n      modal.show();\n    });\n  }\n\n  protected renderContent(): string {\n    const fields = this.modalConfig.fields.map((field) => this.renderField(field)).join('');\n    return `\n      <form class=\"flex flex-col\" data-payload-form>\n        <div class=\"px-6 py-4 border-b border-gray-200\">\n          <h3 class=\"text-lg font-semibold text-gray-900\">${escapeHtml(this.modalConfig.title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">Complete required fields to continue.</p>\n        </div>\n        <div class=\"px-6 py-4 space-y-4 max-h-[60vh] overflow-y-auto\">\n          ${fields}\n        </div>\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200\">\n          <button type=\"button\"\n                  data-payload-cancel\n                  class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer\">\n            ${escapeHtml(this.modalConfig.cancelLabel ?? 'Cancel')}\n          </button>\n          <button type=\"submit\"\n                  data-payload-confirm\n                  class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 cursor-pointer\">\n            ${escapeHtml(this.modalConfig.confirmLabel ?? 'Continue')}\n          </button>\n        </div>\n      </form>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-payload-form]');\n    const cancelBtn = this.container?.querySelector<HTMLButtonElement>('[data-payload-cancel]');\n\n    const submit = (): void => {\n      this.clearErrors();\n      const values: Record<string, string> = {};\n      let firstInvalid: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null = null;\n\n      for (const field of this.modalConfig.fields) {\n        const input = this.container?.querySelector<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>(\n          `[data-payload-field=\"${field.name}\"]`\n        );\n        if (!input) {\n          continue;\n        }\n        const value = input.value.trim();\n        values[field.name] = value;\n        if (!value) {\n          if (!firstInvalid) {\n            firstInvalid = input;\n          }\n          this.showFieldError(field.name, 'This field is required.');\n        }\n      }\n\n      if (firstInvalid) {\n        firstInvalid.focus();\n        return;\n      }\n\n      this.resolved = true;\n      this.onConfirm(values);\n      this.hide();\n    };\n\n    form?.addEventListener('submit', (event) => {\n      event.preventDefault();\n      submit();\n    });\n    cancelBtn?.addEventListener('click', () => {\n      this.hide();\n    });\n\n    // Handle radio group value synchronization\n    const radioGroups = this.container?.querySelectorAll<HTMLElement>('[data-payload-radio-group]');\n    radioGroups?.forEach((group) => {\n      const fieldName = group.dataset.payloadRadioGroup;\n      if (!fieldName) return;\n\n      const radios = group.querySelectorAll<HTMLInputElement>(`[data-payload-radio=\"${fieldName}\"]`);\n      const hiddenInput = group.querySelector<HTMLInputElement>(`[data-payload-field=\"${fieldName}\"]`);\n      if (!hiddenInput) return;\n\n      radios.forEach((radio) => {\n        radio.addEventListener('change', () => {\n          if (radio.checked) {\n            hiddenInput.value = radio.value;\n          }\n        });\n      });\n    });\n  }\n\n  protected onBeforeHide(): boolean {\n    if (!this.resolved) {\n      this.resolved = true;\n      this.onCancel();\n    }\n    return true;\n  }\n\n  private renderField(field: PayloadModalField): string {\n    const description = field.description\n      ? `<p class=\"text-xs text-gray-500 mt-1\">${escapeHtml(field.description)}</p>`\n      : '';\n    const control = field.options && field.options.length > 0\n      ? this.renderSelect(field)\n      : this.renderInput(field);\n    return `\n      <div>\n        <label class=\"block text-sm font-medium text-gray-800 mb-1.5\" for=\"payload-field-${field.name}\">\n          ${escapeHtml(field.label)}\n        </label>\n        ${control}\n        ${description}\n        <p class=\"hidden text-xs text-red-600 mt-1\" data-payload-error=\"${field.name}\"></p>\n      </div>\n    `;\n  }\n\n  private renderSelect(field: PayloadModalField): string {\n    // Find recommended option for preselection if no value is set\n    let selected = field.value;\n    const options = field.options || [];\n    if (!selected) {\n      const recommended = options.find((opt) => opt.recommended);\n      if (recommended) {\n        selected = recommended.value;\n      }\n    }\n\n    // Check if any option has descriptions (for enhanced rendering)\n    const hasDescriptions = options.some((opt) => opt.description);\n\n    if (hasDescriptions) {\n      // Render as radio group for better description display\n      return this.renderRadioGroup(field, options, selected);\n    }\n\n    const optionHtml = options\n      .map((option) => {\n        const isSelected = option.value === selected ? ' selected' : '';\n        return `<option value=\"${escapeHtml(option.value)}\"${isSelected}>${escapeHtml(option.label)}</option>`;\n      })\n      .join('');\n    return `\n      <select id=\"payload-field-${field.name}\"\n              data-payload-field=\"${field.name}\"\n              class=\"w-full border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300\">\n        <option value=\"\">Select an option</option>\n        ${optionHtml}\n      </select>\n    `;\n  }\n\n  private renderRadioGroup(\n    field: PayloadModalField,\n    options: PayloadModalFieldOption[],\n    selected: string\n  ): string {\n    const radioItems = options\n      .map((option, index) => {\n        const isChecked = option.value === selected ? ' checked' : '';\n        const description = option.description\n          ? `<span class=\"text-xs text-gray-500 block ml-6 mt-0.5\">${escapeHtml(option.description)}</span>`\n          : '';\n        return `\n          <label class=\"flex items-start gap-2 p-2 rounded-lg hover:bg-gray-50 cursor-pointer ${option.recommended ? 'bg-blue-50 border border-blue-200' : ''}\">\n            <input type=\"radio\"\n                   name=\"payload-radio-${field.name}\"\n                   value=\"${escapeHtml(option.value)}\"\n                   data-payload-radio=\"${field.name}\"\n                   class=\"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500\"\n                   ${isChecked} />\n            <span class=\"flex-1\">\n              <span class=\"text-sm font-medium text-gray-900\">${escapeHtml(option.label)}</span>\n              ${description}\n            </span>\n          </label>\n        `;\n      })\n      .join('');\n\n    // Hidden input to hold the actual value for form submission\n    const initialValue = selected || '';\n    return `\n      <div class=\"space-y-1\" data-payload-radio-group=\"${field.name}\">\n        <input type=\"hidden\"\n               data-payload-field=\"${field.name}\"\n               value=\"${escapeHtml(initialValue)}\" />\n        ${radioItems}\n      </div>\n    `;\n  }\n\n  private renderInput(field: PayloadModalField): string {\n    const cls = 'w-full border rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300';\n    if (field.type === 'array' || field.type === 'object') {\n      return `\n        <textarea id=\"payload-field-${field.name}\"\n                  data-payload-field=\"${field.name}\"\n                  rows=\"4\"\n                  class=\"${cls}\"\n                  placeholder=\"${field.type === 'array' ? '[...]' : '{...}'}\">${escapeHtml(field.value)}</textarea>\n      `;\n    }\n    const inputType = field.type === 'integer' || field.type === 'number' ? 'number' : 'text';\n    return `\n      <input id=\"payload-field-${field.name}\"\n             type=\"${inputType}\"\n             data-payload-field=\"${field.name}\"\n             value=\"${escapeHtml(field.value)}\"\n             class=\"${cls}\" />\n    `;\n  }\n\n  private clearErrors(): void {\n    const errors = this.container?.querySelectorAll<HTMLElement>('[data-payload-error]');\n    errors?.forEach((el) => {\n      el.textContent = '';\n      el.classList.add('hidden');\n    });\n  }\n\n  private showFieldError(name: string, message: string): void {\n    const errorEl = this.container?.querySelector<HTMLElement>(`[data-payload-error=\"${name}\"]`);\n    if (!errorEl) {\n      return;\n    }\n    errorEl.textContent = message;\n    errorEl.classList.remove('hidden');\n  }\n}\n"],"names":["PayloadInputModal","Modal","config","onConfirm","onCancel","resolve","values","fields","field","escapeHtml","form","cancelBtn","submit","firstInvalid","input","value","event","group","fieldName","radios","hiddenInput","radio","description","control","selected","options","recommended","opt","optionHtml","option","isSelected","radioItems","index","isChecked","initialValue","cls","inputType","el","name","message","errorEl"],"mappings":"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"}