{"version":3,"file":"index.js","sources":["../../src/services/types.ts","../../src/services/api-client.ts","../../src/services/query-state.ts","../../src/services/permissions.ts","../../src/services/ui-states.ts","../../src/services/mutation-feedback.ts","../../src/services/activity-labels.ts","../../src/services/deep-links.ts","../../src/services/accessibility.ts","../../src/services/extension-diagnostics.ts","../../src/services/pages/providers-catalog.ts","../../src/services/pages/connections-list.ts","../../src/services/pages/installations-list.ts","../../src/services/pages/activity.ts","../../src/services/pages/subscriptions-sync.ts","../../src/services/pages/connection-detail.ts"],"sourcesContent":["/**\n * Services Module - Type Definitions\n * Type definitions for the services integration platform API\n */\n\n// =============================================================================\n// Common Types\n// =============================================================================\n\nexport type ScopeType = 'user' | 'org';\n\nexport interface ScopeRef {\n  type: ScopeType;\n  id: string;\n}\n\nexport type ConnectionStatus =\n  | 'active'\n  | 'disconnected'\n  | 'errored'\n  | 'pending_reauth'\n  | 'needs_reconsent';\n\nexport type InstallationStatus =\n  | 'active'\n  | 'suspended'\n  | 'uninstalled'\n  | 'needs_reconsent';\n\nexport type SubscriptionStatus =\n  | 'active'\n  | 'expired'\n  | 'cancelled'\n  | 'errored';\n\nexport type SyncJobStatus =\n  | 'queued'\n  | 'running'\n  | 'succeeded'\n  | 'failed';\n\nexport type SyncJobMode = 'bootstrap' | 'incremental' | 'backfill';\n\nexport type CapabilityDeniedBehavior = 'block' | 'degrade';\n\nexport type ServiceActivityStatus = 'success' | 'failure' | 'pending';\n\n// =============================================================================\n// Provider Types\n// =============================================================================\n\nexport interface ProviderCapability {\n  name: string;\n  required_grants: string[];\n  optional_grants: string[];\n  denied_behavior: CapabilityDeniedBehavior;\n}\n\nexport interface Provider {\n  id: string;\n  auth_kind: string;\n  supported_scope_types: ScopeType[];\n  capabilities: ProviderCapability[];\n}\n\nexport interface ListProvidersResponse {\n  providers: Provider[];\n}\n\n// =============================================================================\n// Connection Types\n// =============================================================================\n\nexport interface Connection {\n  id: string;\n  provider_id: string;\n  scope_type: ScopeType;\n  scope_id: string;\n  external_account_id: string;\n  status: ConnectionStatus;\n  last_error: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ConnectionsListFilter {\n  provider_id?: string;\n  scope_type?: ScopeType;\n  scope_id?: string;\n  status?: ConnectionStatus;\n  q?: string;\n  page?: number;\n  per_page?: number;\n}\n\nexport interface ListConnectionsResponse {\n  connections: Connection[];\n  page: number;\n  per_page: number;\n  total: number;\n  has_next: boolean;\n}\n\nexport interface BeginConnectionRequest {\n  scope_type?: ScopeType;\n  scope_id?: string;\n  redirect_uri?: string;\n  state?: string;\n  requested_grants?: string[];\n  metadata?: Record<string, unknown>;\n}\n\nexport interface BeginConnectionResponse {\n  begin: {\n    authorize_url: string;\n    state: string;\n  };\n}\n\nexport interface CompleteCallbackResponse {\n  completion: {\n    connection_id: string;\n    provider_id: string;\n    scope: ScopeRef;\n    external_account_id: string;\n    granted_scopes: string[];\n  };\n}\n\nexport interface GrantSnapshot {\n  connection_id: string;\n  requested_grants: string[];\n  granted_grants: string[];\n  version: number;\n  captured_at: string;\n}\n\nexport interface GetConnectionGrantsResponse {\n  snapshot: GrantSnapshot;\n}\n\nexport interface ConnectionCredentialHealth {\n  has_active_credential: boolean;\n  refreshable: boolean;\n  expires_at: string | null;\n  last_refresh_at: string | null;\n  next_refresh_attempt_at: string | null;\n  last_error: string;\n}\n\nexport interface ConnectionGrantsSummary {\n  snapshot_found: boolean;\n  version: number;\n  captured_at: string | null;\n  requested_grants: string[];\n  granted_grants: string[];\n  required_grants: string[];\n  missing_grants: string[];\n}\n\nexport interface ConnectionSubscriptionSummary {\n  total: number;\n  active: number;\n  expiring: number;\n  last_delivery_at: string | null;\n  subscriptions: Subscription[];\n}\n\nexport interface ConnectionRateLimitSummary {\n  total_buckets: number;\n  exhausted_buckets: number;\n  next_reset_at: string | null;\n  max_retry_after_seconds: number;\n}\n\nexport interface ConnectionDetailResponse {\n  connection: Connection;\n  credential_health: ConnectionCredentialHealth;\n  grants_summary: ConnectionGrantsSummary;\n  subscription_summary: ConnectionSubscriptionSummary;\n  sync_summary: ConnectionSyncSummary;\n  rate_limit_summary: ConnectionRateLimitSummary;\n}\n\nexport interface BeginReconsentRequest {\n  redirect_uri?: string;\n  state?: string;\n  requested_grants?: string[];\n  metadata?: Record<string, unknown>;\n}\n\nexport interface BeginReconsentResponse {\n  begin: {\n    authorize_url: string;\n    state: string;\n  };\n}\n\nexport interface RefreshConnectionRequest {\n  provider_id?: string;\n}\n\nexport interface RefreshConnectionResponse {\n  refresh?: {\n    connection_id: string;\n    provider_id: string;\n    refreshed_at: string;\n    expires_at?: string;\n  };\n  queued?: boolean;\n  job_id?: string;\n}\n\nexport interface RevokeConnectionRequest {\n  reason?: string;\n}\n\nexport interface RevokeConnectionResponse {\n  status: 'revoked';\n  connection_id: string;\n}\n\n// =============================================================================\n// Installation Types\n// =============================================================================\n\nexport type InstallType = 'user' | 'workspace' | 'org' | 'marketplace_app' | 'standard';\n\nexport interface Installation {\n  id: string;\n  provider_id: string;\n  scope_type: ScopeType;\n  scope_id: string;\n  install_type: InstallType;\n  status: InstallationStatus;\n  granted_at: string | null;\n  revoked_at: string | null;\n  metadata: Record<string, unknown>;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface InstallationsListFilter {\n  provider_id?: string;\n  scope_type?: ScopeType;\n  scope_id?: string;\n  install_type?: InstallType;\n  status?: InstallationStatus;\n  q?: string;\n  page?: number;\n  per_page?: number;\n}\n\nexport interface ListInstallationsResponse {\n  installations: Installation[];\n  page: number;\n  per_page: number;\n  total: number;\n  has_next: boolean;\n}\n\nexport interface BeginInstallationRequest {\n  scope_type?: ScopeType;\n  scope_id?: string;\n  install_type?: InstallType;\n  redirect_uri?: string;\n  state?: string;\n  requested_grants?: string[];\n  metadata?: Record<string, unknown>;\n}\n\nexport interface BeginInstallationResponse {\n  begin: {\n    authorize_url: string;\n    state: string;\n  };\n  installation: Installation;\n}\n\nexport interface UninstallInstallationRequest {\n  reason?: string;\n}\n\nexport interface UninstallInstallationResponse {\n  status: 'ok';\n  installation_id: string;\n  revoked_connections: number;\n}\n\n// =============================================================================\n// Subscription Types\n// =============================================================================\n\nexport interface Subscription {\n  id: string;\n  connection_id: string;\n  provider_id: string;\n  resource_type: string;\n  resource_id: string;\n  channel_id: string;\n  remote_subscription_id: string;\n  callback_url: string;\n  status: SubscriptionStatus;\n  expires_at: string | null;\n  last_notified_at: string | null;\n  metadata: Record<string, unknown>;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface SubscriptionsListFilter {\n  provider_id?: string;\n  connection_id?: string;\n  status?: SubscriptionStatus;\n  q?: string;\n  page?: number;\n  per_page?: number;\n}\n\nexport interface ListSubscriptionsResponse {\n  subscriptions: Subscription[];\n  page: number;\n  per_page: number;\n  total: number;\n  has_next: boolean;\n}\n\nexport interface RenewSubscriptionRequest {\n  metadata?: Record<string, unknown>;\n}\n\nexport interface RenewSubscriptionResponse {\n  subscription?: Subscription;\n  queued?: boolean;\n  job_id?: string;\n}\n\nexport interface CancelSubscriptionRequest {\n  reason?: string;\n}\n\nexport interface CancelSubscriptionResponse {\n  status: 'cancelled';\n  subscription_id: string;\n}\n\n// =============================================================================\n// Sync Types\n// =============================================================================\n\nexport interface SyncJob {\n  id: string;\n  connection_id: string;\n  provider_id: string;\n  mode: SyncJobMode;\n  checkpoint?: string;\n  status: SyncJobStatus;\n  attempts: number;\n  next_attempt_at?: string;\n  metadata: Record<string, unknown>;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface RunSyncRequest {\n  provider_id?: string;\n  resource_type: string;\n  resource_id: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface RunSyncResponse {\n  job?: SyncJob;\n  queued?: boolean;\n  job_id?: string;\n}\n\nexport interface SyncCursor {\n  id: string;\n  connection_id: string;\n  provider_id: string;\n  resource_type: string;\n  resource_id: string;\n  cursor: string;\n  status: string;\n  last_synced_at: string | null;\n  metadata: Record<string, unknown>;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ConnectionSyncSummary {\n  cursor_count: number;\n  last_cursor: string;\n  last_synced_at: string | null;\n  last_sync_error: string;\n  cursors: SyncCursor[];\n  last_job?: SyncJob | null;\n}\n\nexport interface GetSyncStatusResponse {\n  connection_id: string;\n  sync_summary: ConnectionSyncSummary;\n}\n\n// =============================================================================\n// Capability Types\n// =============================================================================\n\nexport interface InvokeCapabilityRequest {\n  scope_type?: ScopeType;\n  scope_id?: string;\n  connection_id?: string;\n  payload?: Record<string, unknown>;\n}\n\nexport interface CapabilityResult {\n  allowed: boolean;\n  mode: CapabilityDeniedBehavior;\n  missing_grants?: string[];\n  result?: unknown;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface InvokeCapabilityResponse {\n  result: CapabilityResult;\n}\n\n// =============================================================================\n// Activity Types\n// =============================================================================\n\nexport interface ServiceActivityEntry {\n  id: string;\n  provider_id: string;\n  scope_type: ScopeType;\n  scope_id: string;\n  connection_id?: string;\n  action: string;\n  status: ServiceActivityStatus;\n  channel?: string;\n  object_type?: string;\n  object_id?: string;\n  metadata: Record<string, unknown>;\n  created_at: string;\n}\n\nexport interface ActivityListFilter {\n  provider_id?: string;\n  scope_type?: ScopeType;\n  scope_id?: string;\n  action?: string;\n  status?: ServiceActivityStatus;\n  from?: string;\n  to?: string;\n  connections?: string[];\n  page?: number;\n  per_page?: number;\n}\n\nexport interface ListActivityResponse {\n  entries: ServiceActivityEntry[];\n  total: number;\n  limit: number;\n  offset: number;\n  has_more: boolean;\n  next_offset: number;\n  filter_applied: ActivityListFilter;\n}\n\n// =============================================================================\n// Status Types\n// =============================================================================\n\nexport interface ServiceStatusInfo {\n  runtime_enabled: boolean;\n  worker_enabled: boolean;\n  webhook_processor_enabled: boolean;\n  inbound_dispatcher_enabled: boolean;\n  sync_orchestrator_enabled: boolean;\n  lifecycle_dispatcher_enabled: boolean;\n  activity_sink_status?: 'active' | 'degraded' | 'fallback';\n  fallback_entries_count?: number;\n  retention_config?: {\n    ttl_days: number;\n    max_rows: number;\n  };\n}\n\nexport interface GetStatusResponse extends ServiceStatusInfo {}\n\nexport interface RunRetentionCleanupResponse {\n  status: 'ok';\n  deleted_count: number;\n  execution_time_ms: number;\n}\n\n// =============================================================================\n// Webhook / Inbound Types\n// =============================================================================\n\nexport interface WebhookProcessResult {\n  status_code: number;\n  processed: boolean;\n  delivery_id?: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface ProcessWebhookResponse {\n  result: WebhookProcessResult;\n}\n\nexport interface InboundDispatchResult {\n  status_code: number;\n  processed: boolean;\n  surface: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface DispatchInboundResponse {\n  result: InboundDispatchResult;\n}\n\n// =============================================================================\n// Error Types\n// =============================================================================\n\nexport interface ServiceErrorResponse {\n  error: string;\n  text_code?: string;\n  message?: string;\n  code?: number;\n  details?: Record<string, unknown>;\n  field?: string;\n}\n\nexport class ServicesAPIError extends Error {\n  public readonly code: string;\n  public readonly statusCode: number;\n  public readonly details?: Record<string, unknown>;\n\n  constructor(message: string, code: string, statusCode: number, details?: Record<string, unknown>) {\n    super(message);\n    this.name = 'ServicesAPIError';\n    this.code = code;\n    this.statusCode = statusCode;\n    this.details = details;\n  }\n\n  static fromResponse(statusCode: number, payload: ServiceErrorResponse): ServicesAPIError {\n    const message = payload.message || payload.error || 'Unknown error';\n    const code = payload.text_code || 'UNKNOWN_ERROR';\n    return new ServicesAPIError(message, code, statusCode, payload.details);\n  }\n\n  get isForbidden(): boolean {\n    return this.statusCode === 403 || this.code === 'FORBIDDEN';\n  }\n\n  get isNotFound(): boolean {\n    return this.statusCode === 404;\n  }\n\n  get isValidationError(): boolean {\n    return this.code === 'VALIDATION_ERROR';\n  }\n\n  get isConflict(): boolean {\n    return this.statusCode === 409 || this.code === 'CONFLICT';\n  }\n}\n\n// =============================================================================\n// Permissions\n// =============================================================================\n\nexport const ServicesPermissions = {\n  VIEW: 'admin.services.view',\n  CONNECT: 'admin.services.connect',\n  EDIT: 'admin.services.edit',\n  REVOKE: 'admin.services.revoke',\n  RECONSENT: 'admin.services.reconsent',\n  ACTIVITY_VIEW: 'admin.services.activity.view',\n  WEBHOOKS: 'admin.services.webhooks',\n} as const;\n\nexport type ServicesPermission = typeof ServicesPermissions[keyof typeof ServicesPermissions];\n","/**\n * Services API Client\n * Unified client for all services integration platform endpoints\n */\n\nimport type {\n  // Provider types\n  ListProvidersResponse,\n  // Connection types\n  ConnectionsListFilter,\n  ListConnectionsResponse,\n  ConnectionDetailResponse,\n  BeginConnectionRequest,\n  BeginConnectionResponse,\n  CompleteCallbackResponse,\n  GetConnectionGrantsResponse,\n  BeginReconsentRequest,\n  BeginReconsentResponse,\n  RefreshConnectionRequest,\n  RefreshConnectionResponse,\n  RevokeConnectionRequest,\n  RevokeConnectionResponse,\n  // Installation types\n  InstallationsListFilter,\n  ListInstallationsResponse,\n  BeginInstallationRequest,\n  BeginInstallationResponse,\n  UninstallInstallationRequest,\n  UninstallInstallationResponse,\n  // Subscription types\n  SubscriptionsListFilter,\n  ListSubscriptionsResponse,\n  RenewSubscriptionRequest,\n  RenewSubscriptionResponse,\n  CancelSubscriptionRequest,\n  CancelSubscriptionResponse,\n  // Sync types\n  RunSyncRequest,\n  RunSyncResponse,\n  GetSyncStatusResponse,\n  // Capability types\n  InvokeCapabilityRequest,\n  InvokeCapabilityResponse,\n  // Activity types\n  ActivityListFilter,\n  ListActivityResponse,\n  // Status types\n  GetStatusResponse,\n  RunRetentionCleanupResponse,\n  // Webhook/Inbound types\n  ProcessWebhookResponse,\n  DispatchInboundResponse,\n  // Error types\n  ServiceErrorResponse,\n} from './types.js';\nimport { ServicesAPIError } from './types.js';\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport interface ServicesAPIClientConfig {\n  /** Base path for admin API (default: /admin/api) */\n  basePath?: string;\n  /** Request timeout in milliseconds (default: 30000) */\n  timeout?: number;\n  /** Custom headers to include with every request */\n  headers?: Record<string, string>;\n  /** Handler for errors (optional) */\n  onError?: (error: ServicesAPIError) => void;\n}\n\nconst DEFAULT_CONFIG: Required<Omit<ServicesAPIClientConfig, 'onError'>> = {\n  basePath: '/admin/api/services',\n  timeout: 30000,\n  headers: {},\n};\n\n// =============================================================================\n// API Client\n// =============================================================================\n\nexport class ServicesAPIClient {\n  private config: Required<Omit<ServicesAPIClientConfig, 'onError'>> & Pick<ServicesAPIClientConfig, 'onError'>;\n  private abortControllers: Map<string, AbortController> = new Map();\n\n  constructor(config: ServicesAPIClientConfig = {}) {\n    this.config = {\n      ...DEFAULT_CONFIG,\n      ...config,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Provider Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * List all registered providers\n   */\n  async listProviders(signal?: AbortSignal): Promise<ListProvidersResponse> {\n    return this.get<ListProvidersResponse>('/providers', {}, signal);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Connection Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * List connections with optional filters\n   */\n  async listConnections(\n    filter: ConnectionsListFilter = {},\n    signal?: AbortSignal\n  ): Promise<ListConnectionsResponse> {\n    const params = this.buildListParams(filter as Record<string, string | number | boolean | string[] | undefined>);\n    return this.get<ListConnectionsResponse>('/connections', params, signal);\n  }\n\n  /**\n   * Get full connection detail payload\n   */\n  async getConnectionDetail(\n    connectionRef: string,\n    signal?: AbortSignal\n  ): Promise<ConnectionDetailResponse> {\n    return this.get<ConnectionDetailResponse>(\n      `/connections/${encodeURIComponent(connectionRef)}`,\n      {},\n      signal\n    );\n  }\n\n  /**\n   * Begin a new connection flow (OAuth2 redirect)\n   */\n  async beginConnection(\n    providerRef: string,\n    request: BeginConnectionRequest = {},\n    idempotencyKey?: string\n  ): Promise<BeginConnectionResponse> {\n    return this.post<BeginConnectionResponse>(\n      `/connections/${encodeURIComponent(providerRef)}/begin`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  /**\n   * Complete OAuth callback (typically called via redirect)\n   */\n  async completeCallback(\n    providerRef: string,\n    params: Record<string, string>,\n    signal?: AbortSignal\n  ): Promise<CompleteCallbackResponse> {\n    return this.get<CompleteCallbackResponse>(\n      `/connections/${encodeURIComponent(providerRef)}/callback`,\n      params,\n      signal\n    );\n  }\n\n  /**\n   * Get grant snapshot for a connection\n   */\n  async getConnectionGrants(\n    connectionRef: string,\n    signal?: AbortSignal\n  ): Promise<GetConnectionGrantsResponse> {\n    return this.get<GetConnectionGrantsResponse>(\n      `/connections/${encodeURIComponent(connectionRef)}/grants`,\n      {},\n      signal\n    );\n  }\n\n  /**\n   * Begin re-consent flow for a connection\n   */\n  async beginReconsent(\n    connectionRef: string,\n    request: BeginReconsentRequest = {},\n    idempotencyKey?: string\n  ): Promise<BeginReconsentResponse> {\n    return this.post<BeginReconsentResponse>(\n      `/connections/${encodeURIComponent(connectionRef)}/reconsent/begin`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  /**\n   * Refresh a connection's credentials\n   */\n  async refreshConnection(\n    connectionRef: string,\n    request: RefreshConnectionRequest = {},\n    idempotencyKey?: string\n  ): Promise<RefreshConnectionResponse> {\n    return this.post<RefreshConnectionResponse>(\n      `/connections/${encodeURIComponent(connectionRef)}/refresh`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  /**\n   * Revoke a connection\n   */\n  async revokeConnection(\n    connectionRef: string,\n    request: RevokeConnectionRequest = {},\n    idempotencyKey?: string\n  ): Promise<RevokeConnectionResponse> {\n    return this.post<RevokeConnectionResponse>(\n      `/connections/${encodeURIComponent(connectionRef)}/revoke`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Installation Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * List installations with optional filters\n   */\n  async listInstallations(\n    filter: InstallationsListFilter = {},\n    signal?: AbortSignal\n  ): Promise<ListInstallationsResponse> {\n    const params = this.buildListParams(filter as Record<string, string | number | boolean | string[] | undefined>);\n    return this.get<ListInstallationsResponse>('/installations', params, signal);\n  }\n\n  /**\n   * Begin a new installation flow\n   */\n  async beginInstallation(\n    providerRef: string,\n    request: BeginInstallationRequest = {},\n    idempotencyKey?: string\n  ): Promise<BeginInstallationResponse> {\n    return this.post<BeginInstallationResponse>(\n      `/installations/${encodeURIComponent(providerRef)}/begin`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  /**\n   * Uninstall an installation\n   */\n  async uninstallInstallation(\n    installationRef: string,\n    request: UninstallInstallationRequest = {},\n    idempotencyKey?: string\n  ): Promise<UninstallInstallationResponse> {\n    return this.post<UninstallInstallationResponse>(\n      `/installations/${encodeURIComponent(installationRef)}/uninstall`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Subscription Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * List subscriptions with optional filters\n   */\n  async listSubscriptions(\n    filter: SubscriptionsListFilter = {},\n    signal?: AbortSignal\n  ): Promise<ListSubscriptionsResponse> {\n    const params = this.buildListParams(filter as Record<string, string | number | boolean | string[] | undefined>);\n    return this.get<ListSubscriptionsResponse>('/subscriptions', params, signal);\n  }\n\n  /**\n   * Renew a subscription\n   */\n  async renewSubscription(\n    subscriptionId: string,\n    request: RenewSubscriptionRequest = {},\n    idempotencyKey?: string\n  ): Promise<RenewSubscriptionResponse> {\n    return this.post<RenewSubscriptionResponse>(\n      `/subscriptions/${encodeURIComponent(subscriptionId)}/renew`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  /**\n   * Cancel a subscription\n   */\n  async cancelSubscription(\n    subscriptionId: string,\n    request: CancelSubscriptionRequest = {},\n    idempotencyKey?: string\n  ): Promise<CancelSubscriptionResponse> {\n    return this.post<CancelSubscriptionResponse>(\n      `/subscriptions/${encodeURIComponent(subscriptionId)}/cancel`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Sync Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Run a sync job for a connection\n   */\n  async runSync(\n    connectionId: string,\n    request: RunSyncRequest,\n    idempotencyKey?: string\n  ): Promise<RunSyncResponse> {\n    return this.post<RunSyncResponse>(\n      `/sync/${encodeURIComponent(connectionId)}/run`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  /**\n   * Get sync status summary for a connection\n   */\n  async getSyncStatus(\n    connectionId: string,\n    signal?: AbortSignal\n  ): Promise<GetSyncStatusResponse> {\n    return this.get<GetSyncStatusResponse>(\n      `/sync/${encodeURIComponent(connectionId)}/status`,\n      {},\n      signal\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Capability Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Invoke a provider capability\n   */\n  async invokeCapability(\n    providerId: string,\n    capability: string,\n    request: InvokeCapabilityRequest = {},\n    idempotencyKey?: string\n  ): Promise<InvokeCapabilityResponse> {\n    return this.post<InvokeCapabilityResponse>(\n      `/capabilities/${encodeURIComponent(providerId)}/${encodeURIComponent(capability)}/invoke`,\n      request,\n      idempotencyKey\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Activity Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * List activity entries with optional filters\n   */\n  async listActivity(\n    filter: ActivityListFilter = {},\n    signal?: AbortSignal\n  ): Promise<ListActivityResponse> {\n    const params = this.buildActivityParams(filter);\n    return this.get<ListActivityResponse>('/activity', params, signal);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Status Endpoints\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get service status\n   */\n  async getStatus(signal?: AbortSignal): Promise<GetStatusResponse> {\n    return this.get<GetStatusResponse>('/status', {}, signal);\n  }\n\n  /**\n   * Run activity retention cleanup\n   */\n  async runRetentionCleanup(idempotencyKey?: string): Promise<RunRetentionCleanupResponse> {\n    return this.post<RunRetentionCleanupResponse>('/activity/retention/cleanup', {}, idempotencyKey);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Webhook/Inbound Endpoints (typically server-to-server)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Process a webhook from a provider\n   */\n  async processWebhook(\n    providerId: string,\n    body: unknown,\n    headers?: Record<string, string>\n  ): Promise<ProcessWebhookResponse> {\n    return this.post<ProcessWebhookResponse>(\n      `/webhooks/${encodeURIComponent(providerId)}`,\n      body,\n      undefined,\n      headers\n    );\n  }\n\n  /**\n   * Dispatch an inbound surface request\n   */\n  async dispatchInbound(\n    providerId: string,\n    surface: string,\n    body: unknown,\n    headers?: Record<string, string>\n  ): Promise<DispatchInboundResponse> {\n    return this.post<DispatchInboundResponse>(\n      `/inbound/${encodeURIComponent(providerId)}/${encodeURIComponent(surface)}`,\n      body,\n      undefined,\n      headers\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Request Helpers\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Cancel all pending requests\n   */\n  cancelAll(): void {\n    this.abortControllers.forEach((controller) => {\n      controller.abort();\n    });\n    this.abortControllers.clear();\n  }\n\n  /**\n   * Cancel a specific request by key\n   */\n  cancel(key: string): void {\n    const controller = this.abortControllers.get(key);\n    if (controller) {\n      controller.abort();\n      this.abortControllers.delete(key);\n    }\n  }\n\n  private async get<T>(\n    path: string,\n    params: Record<string, string | number | boolean | undefined> = {},\n    signal?: AbortSignal\n  ): Promise<T> {\n    const url = this.buildUrl(path, params);\n    const controller = new AbortController();\n    const onAbort = () => controller.abort();\n\n    if (signal) {\n      if (signal.aborted) {\n        controller.abort();\n      } else {\n        signal.addEventListener('abort', onAbort, { once: true });\n      }\n    }\n    this.abortControllers.set(path, controller);\n\n    try {\n      const response = await this.fetchWithTimeout(url, {\n        method: 'GET',\n        headers: {\n          Accept: 'application/json',\n          ...this.config.headers,\n        },\n        signal: controller.signal,\n      }, path);\n\n      return this.handleResponse<T>(response);\n    } finally {\n      if (signal) {\n        signal.removeEventListener('abort', onAbort);\n      }\n      this.abortControllers.delete(path);\n    }\n  }\n\n  private async post<T>(\n    path: string,\n    body: unknown,\n    idempotencyKey?: string,\n    extraHeaders?: Record<string, string>\n  ): Promise<T> {\n    const url = this.buildUrl(path);\n    const controller = new AbortController();\n    this.abortControllers.set(path, controller);\n\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n      Accept: 'application/json',\n      ...this.config.headers,\n      ...extraHeaders,\n    };\n\n    const requestIdempotencyKey = (idempotencyKey && idempotencyKey.trim()) || this.createIdempotencyKey(path);\n    headers['Idempotency-Key'] = requestIdempotencyKey;\n\n    try {\n      const response = await this.fetchWithTimeout(url, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body),\n        signal: controller.signal,\n      }, path);\n\n      return this.handleResponse<T>(response);\n    } finally {\n      this.abortControllers.delete(path);\n    }\n  }\n\n  private buildUrl(\n    path: string,\n    params: Record<string, string | number | boolean | undefined> = {}\n  ): string {\n    const base = this.config.basePath.replace(/\\/$/, '');\n    const url = new URL(`${base}${path}`, window.location.origin);\n\n    for (const [key, value] of Object.entries(params)) {\n      if (value !== undefined && value !== null && value !== '') {\n        url.searchParams.set(key, String(value));\n      }\n    }\n\n    return url.toString();\n  }\n\n  private async fetchWithTimeout(\n    url: string,\n    options: RequestInit,\n    requestKey: string\n  ): Promise<Response> {\n    const timeoutId = setTimeout(() => {\n      const controller = this.abortControllers.get(requestKey);\n      controller?.abort();\n    }, this.config.timeout);\n\n    try {\n      return await fetch(url, options);\n    } finally {\n      clearTimeout(timeoutId);\n    }\n  }\n\n  private createIdempotencyKey(path: string): string {\n    const normalizedPath = path\n      .replace(/[^a-zA-Z0-9]+/g, '_')\n      .replace(/^_+|_+$/g, '')\n      .slice(0, 48) || 'request';\n\n    const runtimeCrypto = typeof globalThis !== 'undefined' ? globalThis.crypto : undefined;\n    if (runtimeCrypto && typeof runtimeCrypto.randomUUID === 'function') {\n      return `services_${normalizedPath}_${runtimeCrypto.randomUUID()}`;\n    }\n\n    return `services_${normalizedPath}_${Date.now()}_${Math.random().toString(36).slice(2, 10)}`;\n  }\n\n  private async handleResponse<T>(response: Response): Promise<T> {\n    if (!response.ok) {\n      let payload: ServiceErrorResponse;\n      try {\n        payload = await response.json();\n      } catch {\n        payload = { error: response.statusText };\n      }\n\n      const error = ServicesAPIError.fromResponse(response.status, payload);\n      this.config.onError?.(error);\n      throw error;\n    }\n\n    return response.json();\n  }\n\n  private buildListParams(\n    filter: Record<string, string | number | boolean | string[] | undefined>\n  ): Record<string, string | number | boolean | undefined> {\n    const params: Record<string, string | number | boolean | undefined> = {};\n\n    for (const [key, value] of Object.entries(filter)) {\n      if (value === undefined || value === null || value === '') {\n        continue;\n      }\n      if (Array.isArray(value)) {\n        if (value.length > 0) {\n          params[key] = value.join(',');\n        }\n      } else {\n        params[key] = value;\n      }\n    }\n\n    return params;\n  }\n\n  private buildActivityParams(filter: ActivityListFilter): Record<string, string | number | boolean | undefined> {\n    const params = this.buildListParams(filter as Record<string, string | number | boolean | string[] | undefined>);\n\n    // Convert page/per_page to limit/offset for activity endpoint\n    if (filter.page !== undefined && filter.per_page !== undefined) {\n      params['offset'] = (filter.page - 1) * filter.per_page;\n      params['limit'] = filter.per_page;\n      delete params['page'];\n      delete params['per_page'];\n    } else if (filter.per_page !== undefined) {\n      params['limit'] = filter.per_page;\n      delete params['per_page'];\n    }\n\n    return params;\n  }\n}\n\n// =============================================================================\n// Default Instance\n// =============================================================================\n\nlet defaultClient: ServicesAPIClient | null = null;\n\n/**\n * Get the default services API client instance\n */\nexport function getServicesClient(): ServicesAPIClient {\n  if (!defaultClient) {\n    defaultClient = new ServicesAPIClient();\n  }\n  return defaultClient;\n}\n\n/**\n * Set the default services API client instance\n */\nexport function setServicesClient(client: ServicesAPIClient): void {\n  defaultClient = client;\n}\n\n/**\n * Create a new services API client with custom configuration\n */\nexport function createServicesClient(config: ServicesAPIClientConfig = {}): ServicesAPIClient {\n  return new ServicesAPIClient(config);\n}\n","/**\n * Services Query State Manager\n * URL-synced filters, pagination, search, and reset behavior for list pages\n */\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface QueryStateConfig {\n  /** Default page number (default: 1) */\n  defaultPage?: number;\n  /** Default items per page (default: 25) */\n  defaultPerPage?: number;\n  /** Search debounce delay in ms (default: 300) */\n  searchDelay?: number;\n  /** Use replaceState instead of pushState (default: false) */\n  useReplaceState?: boolean;\n  /** Callback when state changes */\n  onChange?: (state: QueryState) => void;\n}\n\nexport interface QueryState<F = Record<string, string>> {\n  page: number;\n  per_page: number;\n  search: string;\n  filters: F;\n  sort_field?: string;\n  sort_order?: 'asc' | 'desc';\n}\n\nexport interface QueryStateManagerOptions<F = Record<string, string>> {\n  /** Configuration options */\n  config?: QueryStateConfig;\n  /** Filter field definitions with default values */\n  filterFields?: (keyof F)[];\n  /** Date fields that need RFC3339 conversion */\n  dateFields?: (keyof F)[];\n  /** Storage key for localStorage persistence (optional) */\n  storageKey?: string;\n}\n\nconst DEFAULT_CONFIG: Required<Omit<QueryStateConfig, 'onChange'>> = {\n  defaultPage: 1,\n  defaultPerPage: 25,\n  searchDelay: 300,\n  useReplaceState: false,\n};\n\n// =============================================================================\n// Query State Manager\n// =============================================================================\n\nexport class QueryStateManager<F extends Record<string, string> = Record<string, string>> {\n  private config: Required<Omit<QueryStateConfig, 'onChange'>> & Pick<QueryStateConfig, 'onChange'>;\n  private filterFields: Set<keyof F>;\n  private dateFields: Set<keyof F>;\n  private storageKey: string | null;\n  private state: QueryState<F>;\n  private searchTimeout: ReturnType<typeof setTimeout> | null = null;\n  private initialized = false;\n\n  constructor(options: QueryStateManagerOptions<F> = {}) {\n    this.config = {\n      ...DEFAULT_CONFIG,\n      ...options.config,\n    };\n    this.filterFields = new Set(options.filterFields || []);\n    this.dateFields = new Set(options.dateFields || []);\n    this.storageKey = options.storageKey || null;\n\n    // Initialize state with defaults\n    this.state = {\n      page: this.config.defaultPage,\n      per_page: this.config.defaultPerPage,\n      search: '',\n      filters: {} as F,\n    };\n  }\n\n  /**\n   * Initialize the query state manager\n   * Restores state from URL and/or localStorage\n   */\n  init(): QueryState<F> {\n    if (this.initialized) {\n      return this.state;\n    }\n\n    // First try to restore from URL (highest priority)\n    this.restoreFromURL();\n\n    // Then try localStorage for preferences like per_page\n    this.restoreFromStorage();\n\n    this.initialized = true;\n    return this.state;\n  }\n\n  /**\n   * Get the current state\n   */\n  getState(): QueryState<F> {\n    return { ...this.state, filters: { ...this.state.filters } };\n  }\n\n  /**\n   * Get state as API query parameters\n   */\n  getQueryParams(): Record<string, string | number> {\n    const params: Record<string, string | number> = {};\n\n    // Pagination\n    params.page = this.state.page;\n    params.per_page = this.state.per_page;\n\n    // Search\n    if (this.state.search) {\n      params.q = this.state.search;\n    }\n\n    // Sort\n    if (this.state.sort_field) {\n      params.sort_field = this.state.sort_field;\n      if (this.state.sort_order) {\n        params.sort_order = this.state.sort_order;\n      }\n    }\n\n    // Filters\n    for (const [key, value] of Object.entries(this.state.filters)) {\n      if (value !== undefined && value !== null && value !== '') {\n        // Convert date fields to RFC3339\n        if (this.dateFields.has(key as keyof F)) {\n          const rfc3339 = this.toRFC3339(value);\n          if (rfc3339) {\n            params[key] = rfc3339;\n          }\n        } else {\n          params[key] = value;\n        }\n      }\n    }\n\n    return params;\n  }\n\n  /**\n   * Set the current page\n   */\n  setPage(page: number): void {\n    const newPage = Math.max(1, page);\n    if (this.state.page !== newPage) {\n      this.state.page = newPage;\n      this.syncToURL();\n      this.notifyChange();\n    }\n  }\n\n  /**\n   * Set items per page\n   */\n  setPerPage(perPage: number): void {\n    const newPerPage = Math.max(1, perPage);\n    if (this.state.per_page !== newPerPage) {\n      this.state.per_page = newPerPage;\n      this.state.page = 1; // Reset to first page\n      this.syncToURL();\n      this.saveToStorage();\n      this.notifyChange();\n    }\n  }\n\n  /**\n   * Set search term with debouncing\n   */\n  setSearch(search: string): void {\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n    }\n\n    this.searchTimeout = setTimeout(() => {\n      if (this.state.search !== search) {\n        this.state.search = search;\n        this.state.page = 1; // Reset to first page\n        this.syncToURL();\n        this.notifyChange();\n      }\n    }, this.config.searchDelay);\n  }\n\n  /**\n   * Set search term immediately (no debouncing)\n   */\n  setSearchImmediate(search: string): void {\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n    }\n\n    if (this.state.search !== search) {\n      this.state.search = search;\n      this.state.page = 1;\n      this.syncToURL();\n      this.notifyChange();\n    }\n  }\n\n  /**\n   * Set a single filter value\n   */\n  setFilter<K extends keyof F>(key: K, value: F[K] | undefined): void {\n    const currentValue = this.state.filters[key];\n    if (currentValue !== value) {\n      if (value === undefined || value === null || value === '') {\n        delete this.state.filters[key];\n      } else {\n        this.state.filters[key] = value;\n      }\n      this.state.page = 1; // Reset to first page\n      this.syncToURL();\n      this.notifyChange();\n    }\n  }\n\n  /**\n   * Set multiple filters at once\n   */\n  setFilters(filters: Partial<F>): void {\n    let changed = false;\n\n    for (const [key, value] of Object.entries(filters)) {\n      const currentValue = this.state.filters[key as keyof F];\n      if (currentValue !== value) {\n        if (value === undefined || value === null || value === '') {\n          delete this.state.filters[key as keyof F];\n        } else {\n          this.state.filters[key as keyof F] = value as F[keyof F];\n        }\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      this.state.page = 1;\n      this.syncToURL();\n      this.notifyChange();\n    }\n  }\n\n  /**\n   * Set sort field and order\n   */\n  setSort(field: string | undefined, order: 'asc' | 'desc' = 'asc'): void {\n    if (this.state.sort_field !== field || this.state.sort_order !== order) {\n      this.state.sort_field = field;\n      this.state.sort_order = field ? order : undefined;\n      this.state.page = 1;\n      this.syncToURL();\n      this.notifyChange();\n    }\n  }\n\n  /**\n   * Reset all state to defaults\n   */\n  reset(): void {\n    this.state = {\n      page: this.config.defaultPage,\n      per_page: this.state.per_page, // Keep per_page preference\n      search: '',\n      filters: {} as F,\n    };\n    this.syncToURL();\n    this.notifyChange();\n  }\n\n  /**\n   * Reset filters only\n   */\n  resetFilters(): void {\n    if (Object.keys(this.state.filters).length > 0) {\n      this.state.filters = {} as F;\n      this.state.page = 1;\n      this.syncToURL();\n      this.notifyChange();\n    }\n  }\n\n  /**\n   * Check if any filters are active\n   */\n  hasActiveFilters(): boolean {\n    return Object.values(this.state.filters).some(\n      (v) => v !== undefined && v !== null && v !== ''\n    );\n  }\n\n  /**\n   * Get the count of active filters\n   */\n  getActiveFilterCount(): number {\n    return Object.values(this.state.filters).filter(\n      (v) => v !== undefined && v !== null && v !== ''\n    ).length;\n  }\n\n  /**\n   * Navigate to next page\n   */\n  nextPage(): void {\n    this.setPage(this.state.page + 1);\n  }\n\n  /**\n   * Navigate to previous page\n   */\n  prevPage(): void {\n    this.setPage(this.state.page - 1);\n  }\n\n  /**\n   * Update pagination info based on API response\n   */\n  updateFromResponse(total: number, hasNext?: boolean): void {\n    // Check if current page exceeds total pages\n    const totalPages = Math.ceil(total / this.state.per_page);\n    if (this.state.page > totalPages && totalPages > 0) {\n      this.setPage(totalPages);\n    }\n  }\n\n  /**\n   * Destroy the manager and clean up\n   */\n  destroy(): void {\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Methods\n  // ---------------------------------------------------------------------------\n\n  private restoreFromURL(): void {\n    const params = new URLSearchParams(window.location.search);\n\n    // Restore page\n    const page = params.get('page');\n    if (page) {\n      const parsed = parseInt(page, 10);\n      if (!Number.isNaN(parsed) && parsed > 0) {\n        this.state.page = parsed;\n      }\n    }\n\n    // Restore per_page\n    const perPage = params.get('per_page');\n    if (perPage) {\n      const parsed = parseInt(perPage, 10);\n      if (!Number.isNaN(parsed) && parsed > 0) {\n        this.state.per_page = parsed;\n      }\n    }\n\n    // Restore search\n    const search = params.get('q') || params.get('search');\n    if (search) {\n      this.state.search = search;\n    }\n\n    // Restore sort\n    const sortField = params.get('sort_field');\n    const sortOrder = params.get('sort_order');\n    if (sortField) {\n      this.state.sort_field = sortField;\n      this.state.sort_order = sortOrder === 'desc' ? 'desc' : 'asc';\n    }\n\n    // Restore filters\n    for (const key of this.filterFields) {\n      const value = params.get(String(key));\n      if (value !== null) {\n        // Handle date fields - convert from RFC3339 to local input format\n        if (this.dateFields.has(key)) {\n          this.state.filters[key] = this.toLocalInput(value) as F[typeof key];\n        } else {\n          this.state.filters[key] = value as F[typeof key];\n        }\n      }\n    }\n  }\n\n  private restoreFromStorage(): void {\n    if (!this.storageKey) return;\n\n    try {\n      const stored = localStorage.getItem(this.storageKey);\n      if (stored) {\n        const data = JSON.parse(stored);\n        // Only restore per_page preference from storage\n        if (typeof data.per_page === 'number' && data.per_page > 0) {\n          // URL takes precedence\n          const params = new URLSearchParams(window.location.search);\n          if (!params.has('per_page')) {\n            this.state.per_page = data.per_page;\n          }\n        }\n      }\n    } catch (e) {\n      console.warn('[QueryStateManager] Failed to restore from localStorage:', e);\n    }\n  }\n\n  private saveToStorage(): void {\n    if (!this.storageKey) return;\n\n    try {\n      localStorage.setItem(\n        this.storageKey,\n        JSON.stringify({ per_page: this.state.per_page })\n      );\n    } catch (e) {\n      console.warn('[QueryStateManager] Failed to save to localStorage:', e);\n    }\n  }\n\n  private syncToURL(): void {\n    const params = new URLSearchParams();\n\n    // Add page (only if not page 1)\n    if (this.state.page > 1) {\n      params.set('page', String(this.state.page));\n    }\n\n    // Add per_page (only if different from default)\n    if (this.state.per_page !== this.config.defaultPerPage) {\n      params.set('per_page', String(this.state.per_page));\n    }\n\n    // Add search\n    if (this.state.search) {\n      params.set('q', this.state.search);\n    }\n\n    // Add sort\n    if (this.state.sort_field) {\n      params.set('sort_field', this.state.sort_field);\n      if (this.state.sort_order) {\n        params.set('sort_order', this.state.sort_order);\n      }\n    }\n\n    // Add filters\n    for (const [key, value] of Object.entries(this.state.filters)) {\n      if (value !== undefined && value !== null && value !== '') {\n        // Convert date fields to RFC3339 for URL\n        if (this.dateFields.has(key as keyof F)) {\n          const rfc3339 = this.toRFC3339(value);\n          if (rfc3339) {\n            params.set(key, rfc3339);\n          }\n        } else {\n          params.set(key, value);\n        }\n      }\n    }\n\n    // Update URL\n    const newURL = params.toString()\n      ? `${window.location.pathname}?${params.toString()}`\n      : window.location.pathname;\n\n    if (this.config.useReplaceState) {\n      window.history.replaceState({}, '', newURL);\n    } else {\n      window.history.pushState({}, '', newURL);\n    }\n  }\n\n  private notifyChange(): void {\n    this.config.onChange?.(this.getState());\n  }\n\n  private toRFC3339(value: string): string {\n    if (!value) return '';\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) return '';\n    return parsed.toISOString();\n  }\n\n  private toLocalInput(value: string): string {\n    if (!value) return '';\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) return value;\n    const offset = parsed.getTimezoneOffset() * 60000;\n    return new Date(parsed.getTime() - offset).toISOString().slice(0, 16);\n  }\n}\n\n// =============================================================================\n// Helper Hooks\n// =============================================================================\n\n/**\n * Create a debounced function\n */\nexport function debounce<T extends (...args: unknown[]) => void>(\n  fn: T,\n  delay: number\n): { call: T; cancel: () => void } {\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n  const debouncedFn = ((...args: unknown[]) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      fn(...args);\n      timeoutId = null;\n    }, delay);\n  }) as T;\n\n  const cancel = () => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n      timeoutId = null;\n    }\n  };\n\n  return { call: debouncedFn, cancel };\n}\n\n/**\n * Build URLSearchParams from query state\n */\nexport function buildSearchParams<F extends Record<string, string>>(\n  state: QueryState<F>,\n  options?: { includePage?: boolean; includeDefaults?: boolean }\n): URLSearchParams {\n  const params = new URLSearchParams();\n  const { includePage = true, includeDefaults = false } = options || {};\n\n  if (includePage && (state.page > 1 || includeDefaults)) {\n    params.set('page', String(state.page));\n  }\n\n  if (state.per_page !== 25 || includeDefaults) {\n    params.set('per_page', String(state.per_page));\n  }\n\n  if (state.search) {\n    params.set('q', state.search);\n  }\n\n  if (state.sort_field) {\n    params.set('sort_field', state.sort_field);\n    if (state.sort_order) {\n      params.set('sort_order', state.sort_order);\n    }\n  }\n\n  for (const [key, value] of Object.entries(state.filters)) {\n    if (value !== undefined && value !== null && value !== '') {\n      params.set(key, value);\n    }\n  }\n\n  return params;\n}\n\n/**\n * Parse URLSearchParams into query state\n */\nexport function parseSearchParams<F extends Record<string, string>>(\n  params: URLSearchParams,\n  filterFields: (keyof F)[],\n  defaults?: Partial<QueryState<F>>\n): QueryState<F> {\n  const state: QueryState<F> = {\n    page: defaults?.page ?? 1,\n    per_page: defaults?.per_page ?? 25,\n    search: defaults?.search ?? '',\n    filters: {} as F,\n    ...defaults,\n  };\n\n  const page = params.get('page');\n  if (page) {\n    const parsed = parseInt(page, 10);\n    if (!Number.isNaN(parsed)) {\n      state.page = Math.max(1, parsed);\n    }\n  }\n\n  const perPage = params.get('per_page');\n  if (perPage) {\n    const parsed = parseInt(perPage, 10);\n    if (!Number.isNaN(parsed)) {\n      state.per_page = Math.max(1, parsed);\n    }\n  }\n\n  const search = params.get('q') || params.get('search');\n  if (search) {\n    state.search = search;\n  }\n\n  const sortField = params.get('sort_field');\n  if (sortField) {\n    state.sort_field = sortField;\n    state.sort_order = params.get('sort_order') === 'desc' ? 'desc' : 'asc';\n  }\n\n  for (const key of filterFields) {\n    const value = params.get(String(key));\n    if (value !== null) {\n      state.filters[key] = value as F[typeof key];\n    }\n  }\n\n  return state;\n}\n","/**\n * Services Permission Gating Utilities\n * Permission checking, action guards, and UI gating for services module\n */\n\nimport { ServicesPermissions, type ServicesPermission, ServicesAPIError } from './types.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface PermissionState {\n  /** Permissions the current user has */\n  granted: Set<ServicesPermission>;\n  /** Whether permissions have been loaded */\n  loaded: boolean;\n  /** Last error loading permissions */\n  error?: Error;\n}\n\nexport interface PermissionCheckResult {\n  /** Whether permission is granted */\n  allowed: boolean;\n  /** The permission that was checked */\n  permission: ServicesPermission;\n  /** Reason for denial (if not allowed) */\n  reason?: string;\n}\n\nexport interface PermissionGateOptions {\n  /** Permissions required (all must be granted) */\n  requires?: ServicesPermission[];\n  /** Permissions where any one grants access */\n  requiresAny?: ServicesPermission[];\n  /** Callback when access is denied */\n  onDenied?: (missing: ServicesPermission[]) => void;\n  /** Element to show when denied (instead of hiding) */\n  deniedContent?: string | HTMLElement;\n  /** Whether to disable instead of hide when denied */\n  disableOnDenied?: boolean;\n}\n\nexport type PermissionGuard = (record?: unknown) => boolean;\n\n// =============================================================================\n// Permission Manager\n// =============================================================================\n\n/**\n * Services Permission Manager\n * Centralized permission state management and checking\n */\nexport class ServicesPermissionManager {\n  private state: PermissionState = {\n    granted: new Set(),\n    loaded: false,\n  };\n  private loadPromise: Promise<void> | null = null;\n  private listeners: Set<(state: PermissionState) => void> = new Set();\n\n  /**\n   * Initialize the permission manager with granted permissions\n   */\n  init(permissions: ServicesPermission[]): void {\n    this.state = {\n      granted: new Set(permissions),\n      loaded: true,\n    };\n    this.notifyListeners();\n  }\n\n  /**\n   * Load permissions from the server\n   * Typically done by parsing user permissions from page context or API\n   */\n  async load(fetcher: () => Promise<ServicesPermission[]>): Promise<void> {\n    if (this.loadPromise) {\n      return this.loadPromise;\n    }\n\n    this.loadPromise = (async () => {\n      try {\n        const permissions = await fetcher();\n        this.state = {\n          granted: new Set(permissions),\n          loaded: true,\n        };\n      } catch (error) {\n        this.state = {\n          ...this.state,\n          loaded: true,\n          error: error instanceof Error ? error : new Error(String(error)),\n        };\n      } finally {\n        this.loadPromise = null;\n        this.notifyListeners();\n      }\n    })();\n\n    return this.loadPromise;\n  }\n\n  /**\n   * Check if user has a specific permission\n   */\n  has(permission: ServicesPermission): boolean {\n    return this.state.granted.has(permission);\n  }\n\n  /**\n   * Check if user has all specified permissions\n   */\n  hasAll(permissions: ServicesPermission[]): boolean {\n    return permissions.every((p) => this.state.granted.has(p));\n  }\n\n  /**\n   * Check if user has any of the specified permissions\n   */\n  hasAny(permissions: ServicesPermission[]): boolean {\n    return permissions.some((p) => this.state.granted.has(p));\n  }\n\n  /**\n   * Check a single permission and return detailed result\n   */\n  check(permission: ServicesPermission): PermissionCheckResult {\n    const allowed = this.state.granted.has(permission);\n    return {\n      allowed,\n      permission,\n      reason: allowed ? undefined : `Missing permission: ${permission}`,\n    };\n  }\n\n  /**\n   * Get missing permissions from a required set\n   */\n  getMissing(permissions: ServicesPermission[]): ServicesPermission[] {\n    return permissions.filter((p) => !this.state.granted.has(p));\n  }\n\n  /**\n   * Check if permissions have been loaded\n   */\n  isLoaded(): boolean {\n    return this.state.loaded;\n  }\n\n  /**\n   * Get the current state\n   */\n  getState(): Readonly<PermissionState> {\n    return { ...this.state };\n  }\n\n  /**\n   * Subscribe to state changes\n   */\n  subscribe(listener: (state: PermissionState) => void): () => void {\n    this.listeners.add(listener);\n    return () => this.listeners.delete(listener);\n  }\n\n  /**\n   * Reset the manager state\n   */\n  reset(): void {\n    this.state = {\n      granted: new Set(),\n      loaded: false,\n    };\n    this.loadPromise = null;\n    this.notifyListeners();\n  }\n\n  private notifyListeners(): void {\n    const state = this.getState();\n    this.listeners.forEach((listener) => listener(state));\n  }\n}\n\n// =============================================================================\n// Singleton Instance\n// =============================================================================\n\nlet defaultManager: ServicesPermissionManager | null = null;\n\n/**\n * Get the default permission manager\n */\nexport function getPermissionManager(): ServicesPermissionManager {\n  if (!defaultManager) {\n    defaultManager = new ServicesPermissionManager();\n  }\n  return defaultManager;\n}\n\n/**\n * Initialize the default permission manager with permissions\n */\nexport function initPermissions(permissions: ServicesPermission[]): void {\n  getPermissionManager().init(permissions);\n}\n\n// =============================================================================\n// Permission Guards\n// =============================================================================\n\n/**\n * Create a permission guard for action buttons\n */\nexport function createPermissionGuard(\n  permission: ServicesPermission,\n  manager?: ServicesPermissionManager\n): PermissionGuard {\n  const mgr = manager || getPermissionManager();\n  return () => mgr.has(permission);\n}\n\n/**\n * Create a guard requiring all specified permissions\n */\nexport function requireAll(\n  permissions: ServicesPermission[],\n  manager?: ServicesPermissionManager\n): PermissionGuard {\n  const mgr = manager || getPermissionManager();\n  return () => mgr.hasAll(permissions);\n}\n\n/**\n * Create a guard requiring any of the specified permissions\n */\nexport function requireAny(\n  permissions: ServicesPermission[],\n  manager?: ServicesPermissionManager\n): PermissionGuard {\n  const mgr = manager || getPermissionManager();\n  return () => mgr.hasAny(permissions);\n}\n\n/**\n * Combine multiple guards with AND logic\n */\nexport function combineGuards(...guards: PermissionGuard[]): PermissionGuard {\n  return (record?: unknown) => guards.every((guard) => guard(record));\n}\n\n// =============================================================================\n// Pre-built Guards for Services\n// =============================================================================\n\n/**\n * Guard: Can view services (providers, connections, etc.)\n */\nexport function canViewServices(manager?: ServicesPermissionManager): PermissionGuard {\n  return createPermissionGuard(ServicesPermissions.VIEW, manager);\n}\n\n/**\n * Guard: Can connect new services\n */\nexport function canConnect(manager?: ServicesPermissionManager): PermissionGuard {\n  return createPermissionGuard(ServicesPermissions.CONNECT, manager);\n}\n\n/**\n * Guard: Can edit services (refresh, sync, etc.)\n */\nexport function canEdit(manager?: ServicesPermissionManager): PermissionGuard {\n  return createPermissionGuard(ServicesPermissions.EDIT, manager);\n}\n\n/**\n * Guard: Can revoke connections\n */\nexport function canRevoke(manager?: ServicesPermissionManager): PermissionGuard {\n  return createPermissionGuard(ServicesPermissions.REVOKE, manager);\n}\n\n/**\n * Guard: Can re-consent connections\n */\nexport function canReconsent(manager?: ServicesPermissionManager): PermissionGuard {\n  return createPermissionGuard(ServicesPermissions.RECONSENT, manager);\n}\n\n/**\n * Guard: Can view activity\n */\nexport function canViewActivity(manager?: ServicesPermissionManager): PermissionGuard {\n  return createPermissionGuard(ServicesPermissions.ACTIVITY_VIEW, manager);\n}\n\n// =============================================================================\n// Error Handling\n// =============================================================================\n\n/**\n * Check if an error is a forbidden error\n */\nexport function isForbiddenError(error: unknown): error is ServicesAPIError {\n  return error instanceof ServicesAPIError && error.isForbidden;\n}\n\n/**\n * Handle forbidden error with callback\n */\nexport function handleForbidden(\n  error: unknown,\n  handler: (error: ServicesAPIError) => void\n): boolean {\n  if (isForbiddenError(error)) {\n    handler(error);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Wrap an async action with permission check\n */\nexport function withPermission<T>(\n  permission: ServicesPermission,\n  action: () => Promise<T>,\n  onDenied?: () => void,\n  manager?: ServicesPermissionManager\n): () => Promise<T | undefined> {\n  const mgr = manager || getPermissionManager();\n  return async () => {\n    if (!mgr.has(permission)) {\n      onDenied?.();\n      return undefined;\n    }\n    return action();\n  };\n}\n\n// =============================================================================\n// DOM Utilities\n// =============================================================================\n\n/**\n * Apply permission gating to an element\n */\nexport function gateElement(\n  element: HTMLElement,\n  options: PermissionGateOptions,\n  manager?: ServicesPermissionManager\n): void {\n  const mgr = manager || getPermissionManager();\n  const { requires = [], requiresAny = [], onDenied, disableOnDenied } = options;\n\n  // Check permissions\n  let allowed = true;\n  let missing: ServicesPermission[] = [];\n\n  if (requires.length > 0) {\n    missing = mgr.getMissing(requires);\n    allowed = missing.length === 0;\n  } else if (requiresAny.length > 0) {\n    allowed = mgr.hasAny(requiresAny);\n    if (!allowed) {\n      missing = requiresAny;\n    }\n  }\n\n  if (!allowed) {\n    if (disableOnDenied) {\n      // Disable the element\n      if (element instanceof HTMLButtonElement || element instanceof HTMLInputElement) {\n        element.disabled = true;\n      }\n      element.classList.add('permission-denied', 'opacity-50', 'cursor-not-allowed');\n      element.setAttribute('title', `Permission required: ${missing.join(', ')}`);\n    } else {\n      // Hide the element\n      element.style.display = 'none';\n      element.classList.add('permission-hidden');\n    }\n\n    // Replace with denied content if provided\n    if (options.deniedContent) {\n      if (typeof options.deniedContent === 'string') {\n        element.outerHTML = options.deniedContent;\n      } else {\n        element.replaceWith(options.deniedContent);\n      }\n    }\n\n    onDenied?.(missing);\n  }\n}\n\n/**\n * Initialize permission gating for all elements with data attributes\n * Usage: <div data-permission-requires=\"admin.services.edit\">...</div>\n */\nexport function initPermissionGates(\n  container: HTMLElement = document.body,\n  manager?: ServicesPermissionManager\n): void {\n  // Elements requiring all permissions\n  const requiresElements = container.querySelectorAll<HTMLElement>('[data-permission-requires]');\n  requiresElements.forEach((element) => {\n    const permissions = element.dataset.permissionRequires\n      ?.split(',')\n      .map((p) => p.trim()) as ServicesPermission[];\n\n    if (permissions && permissions.length > 0) {\n      gateElement(element, { requires: permissions }, manager);\n    }\n  });\n\n  // Elements requiring any permission\n  const requiresAnyElements = container.querySelectorAll<HTMLElement>('[data-permission-requires-any]');\n  requiresAnyElements.forEach((element) => {\n    const permissions = element.dataset.permissionRequiresAny\n      ?.split(',')\n      .map((p) => p.trim()) as ServicesPermission[];\n\n    if (permissions && permissions.length > 0) {\n      gateElement(element, { requiresAny: permissions }, manager);\n    }\n  });\n\n  // Elements to disable instead of hide\n  const disableElements = container.querySelectorAll<HTMLElement>('[data-permission-disable]');\n  disableElements.forEach((element) => {\n    const permissions = element.dataset.permissionDisable\n      ?.split(',')\n      .map((p) => p.trim()) as ServicesPermission[];\n\n    if (permissions && permissions.length > 0) {\n      gateElement(element, { requires: permissions, disableOnDenied: true }, manager);\n    }\n  });\n}\n\n// =============================================================================\n// Permission Loading Helpers\n// =============================================================================\n\n/**\n * Extract permissions from page context\n * Looks for window.__permissions or data-permissions attribute on body\n */\nexport function loadPermissionsFromContext(): ServicesPermission[] {\n  // Try window global\n  const windowPerms = (window as unknown as { __permissions?: string[] }).__permissions;\n  if (Array.isArray(windowPerms)) {\n    return windowPerms.filter((p) =>\n      Object.values(ServicesPermissions).includes(p as ServicesPermission)\n    ) as ServicesPermission[];\n  }\n\n  // Try body data attribute\n  const bodyPerms = document.body.dataset.permissions;\n  if (bodyPerms) {\n    try {\n      const parsed = JSON.parse(bodyPerms);\n      if (Array.isArray(parsed)) {\n        return parsed.filter((p) =>\n          Object.values(ServicesPermissions).includes(p as ServicesPermission)\n        ) as ServicesPermission[];\n      }\n    } catch {\n      // Ignore parse errors\n    }\n  }\n\n  return [];\n}\n\n/**\n * Initialize permissions from page context\n */\nexport function initPermissionsFromContext(): ServicesPermissionManager {\n  const permissions = loadPermissionsFromContext();\n  const manager = getPermissionManager();\n  manager.init(permissions);\n  return manager;\n}\n\n// =============================================================================\n// Re-exports\n// =============================================================================\n\nexport { ServicesPermissions } from './types.js';\n","/**\n * UI State Components\n * Shared rendering utilities for loading, empty, no-results, error, and forbidden states.\n * Provides consistent UX across all services pages and detail panels.\n */\n\nimport { renderIcon } from '../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface UIStateConfig {\n  /** Icon name from iconoir */\n  icon?: string;\n  /** Icon extra CSS classes */\n  iconClass?: string;\n  /** Title text */\n  title?: string;\n  /** Description/message text */\n  message?: string;\n  /** Additional CSS classes for the container */\n  containerClass?: string;\n  /** Whether to show a retry button */\n  showRetry?: boolean;\n  /** Retry button text */\n  retryText?: string;\n  /** Retry callback */\n  onRetry?: () => void;\n  /** Additional action button */\n  action?: {\n    text: string;\n    onClick: () => void;\n    variant?: 'primary' | 'secondary' | 'danger';\n  };\n}\n\nexport interface LoadingStateConfig extends UIStateConfig {\n  /** Loading text (default: \"Loading...\") */\n  text?: string;\n  /** Size variant */\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport interface EmptyStateConfig extends UIStateConfig {\n  /** Type of empty state for appropriate defaults */\n  type?: 'providers' | 'connections' | 'installations' | 'subscriptions' | 'sync' | 'activity' | 'generic';\n}\n\nexport interface NoResultsStateConfig extends UIStateConfig {\n  /** Search/filter query that returned no results */\n  query?: string;\n  /** Active filter count */\n  filterCount?: number;\n  /** Reset filters callback */\n  onReset?: () => void;\n}\n\nexport interface ErrorStateConfig extends UIStateConfig {\n  /** Error object */\n  error?: Error | null;\n  /** Error code for specific handling */\n  errorCode?: string;\n  /** Compact mode for inline errors */\n  compact?: boolean;\n}\n\nexport interface ForbiddenStateConfig extends UIStateConfig {\n  /** Resource type user tried to access */\n  resource?: string;\n  /** Required permission */\n  permission?: string;\n}\n\n// =============================================================================\n// Default Configurations\n// =============================================================================\n\nconst EMPTY_STATE_DEFAULTS: Record<string, { icon: string; title: string; message: string }> = {\n  providers: {\n    icon: 'iconoir:plug',\n    title: 'No providers available',\n    message: 'No service providers are currently configured.',\n  },\n  connections: {\n    icon: 'iconoir:link',\n    title: 'No connections found',\n    message: 'Connect a service to get started.',\n  },\n  installations: {\n    icon: 'iconoir:download',\n    title: 'No installations found',\n    message: 'Install a service to get started.',\n  },\n  subscriptions: {\n    icon: 'iconoir:bell-off',\n    title: 'No subscriptions found',\n    message: 'Subscriptions will appear here when created.',\n  },\n  sync: {\n    icon: 'iconoir:sync',\n    title: 'No sync jobs found',\n    message: 'Sync jobs will appear here when syncs are triggered.',\n  },\n  activity: {\n    icon: 'iconoir:activity',\n    title: 'No activity found',\n    message: 'Activity entries will appear here as actions occur.',\n  },\n  generic: {\n    icon: 'iconoir:folder-empty',\n    title: 'No data',\n    message: 'Nothing to display.',\n  },\n};\n\n// =============================================================================\n// Render Functions\n// =============================================================================\n\n/**\n * Render a loading state\n */\nexport function renderLoadingState(config: LoadingStateConfig = {}): string {\n  const { text = 'Loading...', size = 'md', containerClass = '' } = config;\n\n  const sizeClasses = {\n    sm: { spinner: 'h-4 w-4', text: 'text-xs', py: 'py-4' },\n    md: { spinner: 'h-5 w-5', text: 'text-sm', py: 'py-8' },\n    lg: { spinner: 'h-8 w-8', text: 'text-base', py: 'py-16' },\n  };\n\n  const sizes = sizeClasses[size];\n\n  return `\n    <div class=\"ui-state ui-state-loading flex items-center justify-center ${sizes.py} ${containerClass}\" aria-busy=\"true\" aria-label=\"Loading\">\n      <div class=\"flex flex-col items-center gap-3 text-gray-500\">\n        <svg class=\"animate-spin ${sizes.spinner}\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n          <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n        </svg>\n        <span class=\"${sizes.text}\">${escapeHtml(text)}</span>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render an empty state (no data at all)\n */\nexport function renderEmptyState(config: EmptyStateConfig = {}): string {\n  const defaults = EMPTY_STATE_DEFAULTS[config.type || 'generic'];\n  const {\n    icon = defaults.icon,\n    iconClass = 'text-gray-400',\n    title = defaults.title,\n    message = defaults.message,\n    containerClass = '',\n    action,\n  } = config;\n\n  return `\n    <div class=\"ui-state ui-state-empty flex items-center justify-center py-12 ${containerClass}\" role=\"status\" aria-label=\"Empty\">\n      <div class=\"flex flex-col items-center gap-4 text-center max-w-sm\">\n        <div class=\"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center\" aria-hidden=\"true\">\n          ${renderIcon(icon, { size: '24px', extraClass: iconClass })}\n        </div>\n        <div>\n          <h3 class=\"text-lg font-medium text-gray-900\">${escapeHtml(title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">${escapeHtml(message)}</p>\n        </div>\n        ${action ? renderActionButton(action) : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render a no-results state (filters/search returned nothing)\n */\nexport function renderNoResultsState(config: NoResultsStateConfig = {}): string {\n  const {\n    icon = 'iconoir:search',\n    iconClass = 'text-gray-400',\n    title = 'No results found',\n    query,\n    filterCount = 0,\n    containerClass = '',\n    onReset,\n  } = config;\n\n  let message = config.message;\n  if (!message) {\n    if (query && filterCount > 0) {\n      message = `No items match \"${query}\" with ${filterCount} filter${filterCount > 1 ? 's' : ''} applied.`;\n    } else if (query) {\n      message = `No items match \"${query}\".`;\n    } else if (filterCount > 0) {\n      message = `No items match the ${filterCount} filter${filterCount > 1 ? 's' : ''} applied.`;\n    } else {\n      message = 'Try adjusting your search or filters.';\n    }\n  }\n\n  return `\n    <div class=\"ui-state ui-state-no-results flex items-center justify-center py-12 ${containerClass}\" role=\"status\" aria-label=\"No results\">\n      <div class=\"flex flex-col items-center gap-4 text-center max-w-sm\">\n        <div class=\"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center\" aria-hidden=\"true\">\n          ${renderIcon(icon, { size: '24px', extraClass: iconClass })}\n        </div>\n        <div>\n          <h3 class=\"text-lg font-medium text-gray-900\">${escapeHtml(title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">${escapeHtml(message)}</p>\n        </div>\n        ${onReset ? `\n          <button type=\"button\" class=\"ui-state-reset-btn px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-colors\">\n            Clear filters\n          </button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render an error state\n */\nexport function renderErrorState(config: ErrorStateConfig = {}): string {\n  const {\n    icon = 'iconoir:warning-triangle',\n    iconClass = 'text-red-500',\n    title = 'Something went wrong',\n    error,\n    compact = false,\n    containerClass = '',\n    showRetry = true,\n    retryText = 'Try again',\n  } = config;\n\n  const message = config.message || error?.message || 'An unexpected error occurred. Please try again.';\n\n  if (compact) {\n    return `\n      <div class=\"ui-state ui-state-error ui-state-error-compact p-4 ${containerClass}\" role=\"alert\">\n        <div class=\"flex items-start gap-3\">\n          <div class=\"flex-shrink-0 text-red-500\" aria-hidden=\"true\">\n            ${renderIcon(icon, { size: '20px', extraClass: iconClass })}\n          </div>\n          <div class=\"flex-1 min-w-0\">\n            <p class=\"text-sm font-medium text-red-800\">${escapeHtml(title)}</p>\n            <p class=\"text-sm text-red-700 mt-1\">${escapeHtml(message)}</p>\n          </div>\n          ${showRetry ? `\n            <button type=\"button\" class=\"ui-state-retry-btn flex-shrink-0 text-sm text-red-600 hover:text-red-700 font-medium\">\n              ${escapeHtml(retryText)}\n            </button>\n          ` : ''}\n        </div>\n      </div>\n    `;\n  }\n\n  return `\n    <div class=\"ui-state ui-state-error flex items-center justify-center py-16 ${containerClass}\" role=\"alert\">\n      <div class=\"flex flex-col items-center gap-4 text-center max-w-md\">\n        <div class=\"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center\" aria-hidden=\"true\">\n          ${renderIcon(icon, { size: '24px', extraClass: iconClass })}\n        </div>\n        <div>\n          <h3 class=\"text-lg font-medium text-gray-900\">${escapeHtml(title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">${escapeHtml(message)}</p>\n        </div>\n        ${showRetry ? `\n          <button type=\"button\" class=\"ui-state-retry-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors\">\n            ${escapeHtml(retryText)}\n          </button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render a forbidden/access denied state\n */\nexport function renderForbiddenState(config: ForbiddenStateConfig = {}): string {\n  const {\n    icon = 'iconoir:lock',\n    iconClass = 'text-amber-500',\n    title = 'Access Denied',\n    resource,\n    permission,\n    containerClass = '',\n    action,\n  } = config;\n\n  let message = config.message;\n  if (!message) {\n    if (resource && permission) {\n      message = `You need the \"${permission}\" permission to view ${resource}.`;\n    } else if (resource) {\n      message = `You don't have permission to view ${resource}.`;\n    } else {\n      message = \"You don't have permission to access this resource.\";\n    }\n  }\n\n  return `\n    <div class=\"ui-state ui-state-forbidden flex items-center justify-center py-16 ${containerClass}\" role=\"alert\" aria-label=\"Access denied\">\n      <div class=\"flex flex-col items-center gap-4 text-center max-w-md\">\n        <div class=\"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center\" aria-hidden=\"true\">\n          ${renderIcon(icon, { size: '24px', extraClass: iconClass })}\n        </div>\n        <div>\n          <h3 class=\"text-lg font-medium text-gray-900\">${escapeHtml(title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">${escapeHtml(message)}</p>\n        </div>\n        ${action ? renderActionButton(action) : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render a table loading state (for use inside tbody)\n */\nexport function renderTableLoadingState(colspan: number, config: LoadingStateConfig = {}): string {\n  const { text = 'Loading...', containerClass = '' } = config;\n\n  return `\n    <tr class=\"ui-state ui-state-table-loading ${containerClass}\">\n      <td colspan=\"${colspan}\" class=\"px-4 py-12 text-center\">\n        <div class=\"inline-flex items-center gap-2 text-gray-500\" aria-busy=\"true\">\n          <svg class=\"animate-spin h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          <span class=\"text-sm\">${escapeHtml(text)}</span>\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n/**\n * Render a table error state (for use inside tbody)\n */\nexport function renderTableErrorState(\n  colspan: number,\n  config: ErrorStateConfig = {}\n): string {\n  const {\n    icon = 'iconoir:warning-triangle',\n    iconClass = 'text-red-500',\n    title = 'Failed to load data',\n    error,\n    containerClass = '',\n    showRetry = true,\n    retryText = 'Try again',\n  } = config;\n\n  const message = config.message || error?.message || 'An error occurred while loading.';\n\n  return `\n    <tr class=\"ui-state ui-state-table-error ${containerClass}\">\n      <td colspan=\"${colspan}\" class=\"px-4 py-12 text-center\">\n        <div class=\"text-red-500 mb-2\" aria-hidden=\"true\">\n          ${renderIcon(icon, { size: '24px', extraClass: iconClass })}\n        </div>\n        <p class=\"text-sm font-medium text-gray-900\">${escapeHtml(title)}</p>\n        <p class=\"text-sm text-gray-500 mt-1\">${escapeHtml(message)}</p>\n        ${showRetry ? `\n          <button type=\"button\" class=\"ui-state-retry-btn mt-2 text-sm text-blue-600 hover:text-blue-700 font-medium\">\n            ${escapeHtml(retryText)}\n          </button>\n        ` : ''}\n      </td>\n    </tr>\n  `;\n}\n\n/**\n * Render a table empty state (for use inside tbody)\n */\nexport function renderTableEmptyState(\n  colspan: number,\n  config: EmptyStateConfig = {}\n): string {\n  const defaults = EMPTY_STATE_DEFAULTS[config.type || 'generic'];\n  const {\n    icon = defaults.icon,\n    iconClass = 'text-gray-400',\n    title = defaults.title,\n    message = defaults.message,\n    containerClass = '',\n  } = config;\n\n  return `\n    <tr class=\"ui-state ui-state-table-empty ${containerClass}\">\n      <td colspan=\"${colspan}\" class=\"px-4 py-12 text-center\">\n        <div class=\"inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 mb-4\" aria-hidden=\"true\">\n          ${renderIcon(icon, { size: '24px', extraClass: iconClass })}\n        </div>\n        <h3 class=\"text-lg font-medium text-gray-900\">${escapeHtml(title)}</h3>\n        <p class=\"text-sm text-gray-500 mt-1\">${escapeHtml(message)}</p>\n      </td>\n    </tr>\n  `;\n}\n\n/**\n * Render a table no-results state (for use inside tbody)\n */\nexport function renderTableNoResultsState(\n  colspan: number,\n  config: NoResultsStateConfig = {}\n): string {\n  const {\n    icon = 'iconoir:search',\n    iconClass = 'text-gray-400',\n    title = 'No results found',\n    query,\n    filterCount = 0,\n    containerClass = '',\n    onReset,\n  } = config;\n\n  let message = config.message;\n  if (!message) {\n    if (query && filterCount > 0) {\n      message = `No items match \"${query}\" with ${filterCount} filter${filterCount > 1 ? 's' : ''} applied.`;\n    } else if (query) {\n      message = `No items match \"${query}\".`;\n    } else if (filterCount > 0) {\n      message = `No items match the ${filterCount} filter${filterCount > 1 ? 's' : ''} applied.`;\n    } else {\n      message = 'Try adjusting your search or filters.';\n    }\n  }\n\n  return `\n    <tr class=\"ui-state ui-state-table-no-results ${containerClass}\">\n      <td colspan=\"${colspan}\" class=\"px-4 py-12 text-center\">\n        <div class=\"inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 mb-4\" aria-hidden=\"true\">\n          ${renderIcon(icon, { size: '24px', extraClass: iconClass })}\n        </div>\n        <h3 class=\"text-lg font-medium text-gray-900\">${escapeHtml(title)}</h3>\n        <p class=\"text-sm text-gray-500 mt-1\">${escapeHtml(message)}</p>\n        ${onReset ? `\n          <button type=\"button\" class=\"ui-state-reset-btn mt-3 text-sm text-blue-600 hover:text-blue-700 font-medium\">\n            Clear filters\n          </button>\n        ` : ''}\n      </td>\n    </tr>\n  `;\n}\n\n// =============================================================================\n// State Manager Class\n// =============================================================================\n\nexport type UIStateType = 'loading' | 'empty' | 'no-results' | 'error' | 'forbidden' | 'content';\n\nexport interface UIStateManagerConfig {\n  container: HTMLElement;\n  /** Callback when retry is clicked */\n  onRetry?: () => void;\n  /** Callback when reset filters is clicked */\n  onReset?: () => void;\n}\n\n/**\n * Manages UI state transitions for a container element.\n * Handles loading, empty, no-results, error, and forbidden states with proper event binding.\n */\nexport class UIStateManager {\n  private container: HTMLElement;\n  private config: UIStateManagerConfig;\n  private currentState: UIStateType = 'loading';\n\n  constructor(config: UIStateManagerConfig) {\n    this.container = config.container;\n    this.config = config;\n  }\n\n  /**\n   * Show loading state\n   */\n  showLoading(loadingConfig?: LoadingStateConfig): void {\n    this.currentState = 'loading';\n    this.container.innerHTML = renderLoadingState(loadingConfig);\n  }\n\n  /**\n   * Show empty state (no data)\n   */\n  showEmpty(emptyConfig?: EmptyStateConfig): void {\n    this.currentState = 'empty';\n    this.container.innerHTML = renderEmptyState(emptyConfig);\n  }\n\n  /**\n   * Show no-results state (filters returned nothing)\n   */\n  showNoResults(noResultsConfig?: NoResultsStateConfig): void {\n    this.currentState = 'no-results';\n    const config = { ...noResultsConfig, onReset: noResultsConfig?.onReset || this.config.onReset };\n    this.container.innerHTML = renderNoResultsState(config);\n    this.bindResetHandler();\n  }\n\n  /**\n   * Show error state\n   */\n  showError(errorConfig?: ErrorStateConfig): void {\n    this.currentState = 'error';\n    const config = { ...errorConfig, onRetry: errorConfig?.onRetry || this.config.onRetry };\n    this.container.innerHTML = renderErrorState(config);\n    this.bindRetryHandler();\n  }\n\n  /**\n   * Show forbidden state\n   */\n  showForbidden(forbiddenConfig?: ForbiddenStateConfig): void {\n    this.currentState = 'forbidden';\n    this.container.innerHTML = renderForbiddenState(forbiddenConfig);\n  }\n\n  /**\n   * Show content (clears any state and allows content rendering)\n   */\n  showContent(): void {\n    this.currentState = 'content';\n    // Content rendering is handled externally\n  }\n\n  /**\n   * Get current state\n   */\n  getState(): UIStateType {\n    return this.currentState;\n  }\n\n  /**\n   * Check if currently showing loading\n   */\n  isLoading(): boolean {\n    return this.currentState === 'loading';\n  }\n\n  /**\n   * Check if showing error\n   */\n  hasError(): boolean {\n    return this.currentState === 'error';\n  }\n\n  private bindRetryHandler(): void {\n    const retryBtn = this.container.querySelector('.ui-state-retry-btn');\n    retryBtn?.addEventListener('click', () => {\n      this.config.onRetry?.();\n    });\n  }\n\n  private bindResetHandler(): void {\n    const resetBtn = this.container.querySelector('.ui-state-reset-btn');\n    resetBtn?.addEventListener('click', () => {\n      this.config.onReset?.();\n    });\n  }\n}\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\nfunction renderActionButton(action: { text: string; onClick: () => void; variant?: 'primary' | 'secondary' | 'danger' }): string {\n  const variantClasses = {\n    primary: 'text-white bg-blue-600 hover:bg-blue-700 focus:ring-blue-500',\n    secondary: 'text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 focus:ring-gray-500',\n    danger: 'text-white bg-red-600 hover:bg-red-700 focus:ring-red-500',\n  };\n\n  const classes = variantClasses[action.variant || 'primary'];\n\n  return `\n    <button type=\"button\" class=\"ui-state-action-btn px-4 py-2 text-sm font-medium rounded-lg focus:ring-2 focus:ring-offset-2 transition-colors ${classes}\">\n      ${escapeHtml(action.text)}\n    </button>\n  `;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n","/**\n * Mutation Feedback Module\n * Provides confirmation UX and feedback patterns for destructive and asynchronous actions.\n *\n * Includes:\n * - Button state management during async operations (loading, success, error states)\n * - Toast notification wrappers for mutation results\n * - Inline retry utilities for failed mutations\n * - Confirmation dialog helpers for destructive actions\n */\n\nimport type { ToastNotifier, ConfirmOptions } from '../toast/types.js';\nimport { ConfirmModal } from '../shared/modal.js';\nimport { renderIcon } from '../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/** Button state during mutation lifecycle */\nexport type MutationButtonState = 'idle' | 'loading' | 'success' | 'error';\n\n/** Configuration for mutation button state management */\nexport interface MutationButtonConfig {\n  /** Button element to manage */\n  button: HTMLButtonElement;\n  /** Text to show when loading */\n  loadingText?: string;\n  /** Text to show on success (briefly) */\n  successText?: string;\n  /** Text to show on error */\n  errorText?: string;\n  /** Duration to show success/error state before returning to idle (ms) */\n  feedbackDuration?: number;\n  /** Whether to disable the button during loading */\n  disableOnLoading?: boolean;\n  /** Whether to show spinner during loading */\n  showSpinner?: boolean;\n}\n\n/** Configuration for mutation execution with feedback */\nexport interface MutationFeedbackConfig<T> {\n  /** Async function to execute */\n  mutation: () => Promise<T>;\n  /** Toast notifier for showing messages */\n  notifier?: ToastNotifier;\n  /** Success message or function to generate it from result */\n  successMessage?: string | ((result: T) => string);\n  /** Error message prefix (actual error will be appended) */\n  errorMessagePrefix?: string;\n  /** Button config for loading state management */\n  buttonConfig?: MutationButtonConfig;\n  /** Called after successful mutation */\n  onSuccess?: (result: T) => void | Promise<void>;\n  /** Called after failed mutation */\n  onError?: (error: Error) => void;\n  /** Show inline retry on error */\n  showInlineRetry?: boolean;\n  /** Container for inline retry UI */\n  retryContainer?: HTMLElement;\n}\n\n/** Configuration for confirmation before mutation */\nexport interface ConfirmMutationConfig<T> extends MutationFeedbackConfig<T> {\n  /** Confirmation message */\n  confirmMessage: string;\n  /** Confirmation dialog options */\n  confirmOptions?: ConfirmOptions & { variant?: 'primary' | 'danger' };\n}\n\n/** Configuration for retryable inline action */\nexport interface RetryableActionConfig {\n  /** Container element for retry UI */\n  container: HTMLElement;\n  /** Action to retry */\n  action: () => Promise<void>;\n  /** Error message to display */\n  errorMessage: string;\n  /** Retry button text */\n  retryText?: string;\n  /** Dismiss button text */\n  dismissText?: string;\n  /** Callback when dismissed */\n  onDismiss?: () => void;\n}\n\n// =============================================================================\n// Mutation Button State Manager\n// =============================================================================\n\n/**\n * Manages button state during async operations.\n * Provides visual feedback for loading, success, and error states.\n */\nexport class MutationButtonManager {\n  private button: HTMLButtonElement;\n  private config: Required<Omit<MutationButtonConfig, 'button'>>;\n  private originalHTML: string;\n  private originalDisabled: boolean;\n  private state: MutationButtonState = 'idle';\n  private feedbackTimeout: ReturnType<typeof setTimeout> | null = null;\n\n  constructor(config: MutationButtonConfig) {\n    this.button = config.button;\n    this.originalHTML = this.button.innerHTML;\n    this.originalDisabled = this.button.disabled;\n\n    this.config = {\n      loadingText: config.loadingText ?? 'Processing...',\n      successText: config.successText ?? 'Done',\n      errorText: config.errorText ?? 'Failed',\n      feedbackDuration: config.feedbackDuration ?? 2000,\n      disableOnLoading: config.disableOnLoading ?? true,\n      showSpinner: config.showSpinner ?? true,\n    };\n  }\n\n  /** Get current state */\n  getState(): MutationButtonState {\n    return this.state;\n  }\n\n  /** Set button to loading state */\n  setLoading(): void {\n    this.clearFeedbackTimeout();\n    this.state = 'loading';\n\n    if (this.config.disableOnLoading) {\n      this.button.disabled = true;\n    }\n\n    this.button.classList.add('mutation-loading');\n    this.button.classList.remove('mutation-success', 'mutation-error');\n\n    const spinnerHTML = this.config.showSpinner\n      ? `<svg class=\"animate-spin -ml-1 mr-2 h-4 w-4 inline-block\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n           <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n           <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n         </svg>`\n      : '';\n\n    this.button.innerHTML = `${spinnerHTML}<span>${escapeHtml(this.config.loadingText)}</span>`;\n  }\n\n  /** Set button to success state (briefly shows success, then returns to idle) */\n  setSuccess(): void {\n    this.clearFeedbackTimeout();\n    this.state = 'success';\n\n    this.button.disabled = this.originalDisabled;\n    this.button.classList.remove('mutation-loading', 'mutation-error');\n    this.button.classList.add('mutation-success');\n\n    this.button.innerHTML = `\n      <svg class=\"-ml-1 mr-2 h-4 w-4 inline-block text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\n      </svg>\n      <span>${escapeHtml(this.config.successText)}</span>\n    `;\n\n    this.feedbackTimeout = setTimeout(() => {\n      this.reset();\n    }, this.config.feedbackDuration);\n  }\n\n  /** Set button to error state */\n  setError(): void {\n    this.clearFeedbackTimeout();\n    this.state = 'error';\n\n    this.button.disabled = this.originalDisabled;\n    this.button.classList.remove('mutation-loading', 'mutation-success');\n    this.button.classList.add('mutation-error');\n\n    this.button.innerHTML = `\n      <svg class=\"-ml-1 mr-2 h-4 w-4 inline-block text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n      </svg>\n      <span>${escapeHtml(this.config.errorText)}</span>\n    `;\n\n    this.feedbackTimeout = setTimeout(() => {\n      this.reset();\n    }, this.config.feedbackDuration);\n  }\n\n  /** Reset button to original state */\n  reset(): void {\n    this.clearFeedbackTimeout();\n    this.state = 'idle';\n\n    this.button.disabled = this.originalDisabled;\n    this.button.classList.remove('mutation-loading', 'mutation-success', 'mutation-error');\n    this.button.innerHTML = this.originalHTML;\n  }\n\n  /** Destroy and cleanup */\n  destroy(): void {\n    this.clearFeedbackTimeout();\n    this.reset();\n  }\n\n  private clearFeedbackTimeout(): void {\n    if (this.feedbackTimeout) {\n      clearTimeout(this.feedbackTimeout);\n      this.feedbackTimeout = null;\n    }\n  }\n}\n\n// =============================================================================\n// Mutation Execution with Feedback\n// =============================================================================\n\n/**\n * Execute a mutation with toast feedback and optional button state management.\n * Handles loading states, success/error toasts, and inline retry.\n */\nexport async function withMutationFeedback<T>(\n  config: MutationFeedbackConfig<T>\n): Promise<{ success: boolean; result?: T; error?: Error }> {\n  const {\n    mutation,\n    notifier,\n    successMessage,\n    errorMessagePrefix = 'Operation failed',\n    buttonConfig,\n    onSuccess,\n    onError,\n    showInlineRetry = false,\n    retryContainer,\n  } = config;\n\n  // Set up button manager if provided\n  const buttonManager = buttonConfig ? new MutationButtonManager(buttonConfig) : null;\n\n  try {\n    // Show loading state\n    buttonManager?.setLoading();\n\n    // Execute mutation\n    const result = await mutation();\n\n    // Show success state\n    buttonManager?.setSuccess();\n\n    // Show success toast\n    if (notifier && successMessage) {\n      const message = typeof successMessage === 'function'\n        ? successMessage(result)\n        : successMessage;\n      notifier.success(message);\n    }\n\n    // Clear any retry UI\n    if (retryContainer) {\n      clearRetryUI(retryContainer);\n    }\n\n    // Call success callback\n    await onSuccess?.(result);\n\n    return { success: true, result };\n  } catch (err) {\n    const error = err instanceof Error ? err : new Error(String(err));\n\n    // Show error state\n    buttonManager?.setError();\n\n    // Show error toast\n    if (notifier) {\n      notifier.error(`${errorMessagePrefix}: ${error.message}`);\n    }\n\n    // Show inline retry if requested\n    if (showInlineRetry && retryContainer) {\n      renderRetryUI({\n        container: retryContainer,\n        action: () => withMutationFeedback(config).then(() => {}),\n        errorMessage: `${errorMessagePrefix}: ${error.message}`,\n        onDismiss: () => clearRetryUI(retryContainer),\n      });\n    }\n\n    // Call error callback\n    onError?.(error);\n\n    return { success: false, error };\n  }\n}\n\n/**\n * Execute a mutation with confirmation dialog.\n * Shows a confirmation modal before executing the mutation.\n */\nexport async function withConfirmation<T>(\n  config: ConfirmMutationConfig<T>\n): Promise<{ success: boolean; result?: T; error?: Error; cancelled: boolean }> {\n  const { confirmMessage, confirmOptions, ...mutationConfig } = config;\n\n  // Show confirmation dialog\n  const confirmed = await ConfirmModal.confirm(confirmMessage, {\n    title: confirmOptions?.title ?? 'Confirm Action',\n    confirmText: confirmOptions?.confirmText ?? 'Confirm',\n    cancelText: confirmOptions?.cancelText ?? 'Cancel',\n    confirmVariant: confirmOptions?.variant ?? 'primary',\n  });\n\n  if (!confirmed) {\n    return { success: false, cancelled: true };\n  }\n\n  // Execute mutation with feedback\n  const result = await withMutationFeedback(mutationConfig);\n  return { ...result, cancelled: false };\n}\n\n// =============================================================================\n// Inline Retry UI\n// =============================================================================\n\n/**\n * Render inline retry UI in a container.\n * Shows error message with retry and dismiss buttons.\n */\nexport function renderRetryUI(config: RetryableActionConfig): void {\n  const {\n    container,\n    action,\n    errorMessage,\n    retryText = 'Retry',\n    dismissText = 'Dismiss',\n    onDismiss,\n  } = config;\n\n  container.innerHTML = `\n    <div class=\"mutation-retry-ui flex items-start gap-3 p-3 bg-red-50 border border-red-200 rounded-lg\" role=\"alert\">\n      <div class=\"flex-shrink-0 text-red-500\" aria-hidden=\"true\">\n        ${renderIcon('iconoir:warning-triangle', { size: '20px' })}\n      </div>\n      <div class=\"flex-1 min-w-0\">\n        <p class=\"text-sm text-red-700\">${escapeHtml(errorMessage)}</p>\n        <div class=\"flex items-center gap-2 mt-2\">\n          <button type=\"button\"\n                  class=\"mutation-retry-btn px-3 py-1 text-xs font-medium text-red-700 bg-red-100 hover:bg-red-200 rounded transition-colors\">\n            ${escapeHtml(retryText)}\n          </button>\n          <button type=\"button\"\n                  class=\"mutation-dismiss-btn px-3 py-1 text-xs font-medium text-gray-600 hover:text-gray-800 transition-colors\">\n            ${escapeHtml(dismissText)}\n          </button>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Bind events\n  const retryBtn = container.querySelector('.mutation-retry-btn');\n  const dismissBtn = container.querySelector('.mutation-dismiss-btn');\n\n  retryBtn?.addEventListener('click', async () => {\n    // Show loading state on retry button\n    const btn = retryBtn as HTMLButtonElement;\n    const originalText = btn.textContent;\n    btn.disabled = true;\n    btn.innerHTML = `\n      <svg class=\"animate-spin h-3 w-3 inline-block mr-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n        <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n        <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n      </svg>\n      Retrying...\n    `;\n\n    try {\n      await action();\n    } finally {\n      btn.disabled = false;\n      btn.textContent = originalText;\n    }\n  });\n\n  dismissBtn?.addEventListener('click', () => {\n    clearRetryUI(container);\n    onDismiss?.();\n  });\n}\n\n/**\n * Clear retry UI from a container.\n */\nexport function clearRetryUI(container: HTMLElement): void {\n  const retryUI = container.querySelector('.mutation-retry-ui');\n  retryUI?.remove();\n}\n\n// =============================================================================\n// Confirmation Dialog Utilities\n// =============================================================================\n\n/** Configuration for service-specific confirmation dialogs */\nexport interface ServiceConfirmConfig {\n  /** Action being confirmed (e.g., \"revoke\", \"disconnect\", \"uninstall\") */\n  action: 'revoke' | 'disconnect' | 'uninstall' | 'cancel' | 'delete' | 'refresh';\n  /** Resource type being affected */\n  resourceType: 'connection' | 'installation' | 'subscription' | 'sync';\n  /** Resource identifier for display */\n  resourceName?: string;\n  /** Additional context message */\n  additionalContext?: string;\n}\n\n/**\n * Get standard confirmation message and options for service actions.\n */\nexport function getServiceConfirmConfig(config: ServiceConfirmConfig): {\n  message: string;\n  options: ConfirmOptions & { variant: 'primary' | 'danger' };\n} {\n  const { action, resourceType, resourceName, additionalContext } = config;\n\n  const actionLabels: Record<string, { verb: string; noun: string; variant: 'primary' | 'danger' }> = {\n    revoke: { verb: 'revoke', noun: 'Revoke', variant: 'danger' },\n    disconnect: { verb: 'disconnect', noun: 'Disconnect', variant: 'danger' },\n    uninstall: { verb: 'uninstall', noun: 'Uninstall', variant: 'danger' },\n    cancel: { verb: 'cancel', noun: 'Cancel', variant: 'danger' },\n    delete: { verb: 'delete', noun: 'Delete', variant: 'danger' },\n    refresh: { verb: 'refresh', noun: 'Refresh', variant: 'primary' },\n  };\n\n  const resourceLabels: Record<string, string> = {\n    connection: 'connection',\n    installation: 'installation',\n    subscription: 'subscription',\n    sync: 'sync job',\n  };\n\n  const actionConfig = actionLabels[action] || { verb: action, noun: action, variant: 'primary' as const };\n  const resourceLabel = resourceLabels[resourceType] || resourceType;\n\n  let message = `Are you sure you want to ${actionConfig.verb} this ${resourceLabel}`;\n  if (resourceName) {\n    message += ` (${resourceName})`;\n  }\n  message += '?';\n\n  if (additionalContext) {\n    message += ` ${additionalContext}`;\n  }\n\n  // Add warning for destructive actions\n  if (actionConfig.variant === 'danger') {\n    message += ' This action cannot be undone.';\n  }\n\n  return {\n    message,\n    options: {\n      title: `${actionConfig.noun} ${resourceLabel.charAt(0).toUpperCase() + resourceLabel.slice(1)}`,\n      confirmText: actionConfig.noun,\n      cancelText: 'Cancel',\n      variant: actionConfig.variant,\n    },\n  };\n}\n\n/**\n * Show a service-specific confirmation dialog.\n */\nexport async function confirmServiceAction(config: ServiceConfirmConfig): Promise<boolean> {\n  const { message, options } = getServiceConfirmConfig(config);\n  return ConfirmModal.confirm(message, options);\n}\n\n// =============================================================================\n// Action Queue (for preventing duplicate submissions)\n// =============================================================================\n\n/**\n * Simple action queue to prevent duplicate submissions.\n * Tracks in-flight actions by key and prevents concurrent execution.\n */\nexport class ActionQueue {\n  private inFlight = new Set<string>();\n\n  /**\n   * Check if an action is currently in flight.\n   */\n  isInFlight(key: string): boolean {\n    return this.inFlight.has(key);\n  }\n\n  /**\n   * Execute an action with duplicate prevention.\n   * Returns undefined if action is already in flight.\n   */\n  async execute<T>(key: string, action: () => Promise<T>): Promise<T | undefined> {\n    if (this.inFlight.has(key)) {\n      return undefined;\n    }\n\n    this.inFlight.add(key);\n    try {\n      return await action();\n    } finally {\n      this.inFlight.delete(key);\n    }\n  }\n\n  /**\n   * Clear all in-flight actions.\n   */\n  clear(): void {\n    this.inFlight.clear();\n  }\n}\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n","/**\n * Activity Action Labels Module\n * Provides action label resolution with backend-provided overrides and safe fallbacks.\n *\n * Usage:\n *   // Initialize from backend config during app bootstrap\n *   initActivityLabels({ labels: configFromBackend.activity_labels });\n *\n *   // Use in activity page\n *   createActivityPage({ getActionLabel: getActionLabel });\n */\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface ActionLabelConfig {\n  /** Backend-provided action label overrides */\n  labels?: Record<string, string>;\n  /** Fallback for unknown actions (default: formats snake_case to Title Case) */\n  fallbackFormatter?: (action: string) => string;\n}\n\nexport interface ActionLabelEntry {\n  /** The action key (e.g., \"connected\", \"sync_started\") */\n  action: string;\n  /** Human-readable label */\n  label: string;\n  /** Optional description for tooltips */\n  description?: string;\n  /** Optional category for grouping */\n  category?: string;\n}\n\n// =============================================================================\n// Default Action Labels\n// =============================================================================\n\n/**\n * Default action labels with safe, user-friendly text.\n * These serve as fallbacks when backend doesn't provide custom labels.\n */\nconst DEFAULT_ACTION_LABELS: Record<string, ActionLabelEntry> = {\n  // Connection lifecycle\n  connected: {\n    action: 'connected',\n    label: 'Connected',\n    description: 'Service connection established',\n    category: 'connections',\n  },\n  disconnected: {\n    action: 'disconnected',\n    label: 'Disconnected',\n    description: 'Service connection terminated',\n    category: 'connections',\n  },\n  refreshed: {\n    action: 'refreshed',\n    label: 'Credentials Refreshed',\n    description: 'Connection credentials were refreshed',\n    category: 'credentials',\n  },\n  revoked: {\n    action: 'revoked',\n    label: 'Connection Revoked',\n    description: 'Connection access was revoked',\n    category: 'connections',\n  },\n  reconsent_started: {\n    action: 'reconsent_started',\n    label: 'Re-consent Started',\n    description: 'User initiated re-authorization',\n    category: 'connections',\n  },\n  reconsent_completed: {\n    action: 'reconsent_completed',\n    label: 'Re-consent Completed',\n    description: 'User completed re-authorization',\n    category: 'connections',\n  },\n  reconsent_failed: {\n    action: 'reconsent_failed',\n    label: 'Re-consent Failed',\n    description: 'Re-authorization could not be completed',\n    category: 'connections',\n  },\n\n  // Sync operations\n  sync_started: {\n    action: 'sync_started',\n    label: 'Sync Started',\n    description: 'Data synchronization began',\n    category: 'sync',\n  },\n  sync_completed: {\n    action: 'sync_completed',\n    label: 'Sync Completed',\n    description: 'Data synchronization finished successfully',\n    category: 'sync',\n  },\n  sync_failed: {\n    action: 'sync_failed',\n    label: 'Sync Failed',\n    description: 'Data synchronization encountered an error',\n    category: 'sync',\n  },\n  sync_progress: {\n    action: 'sync_progress',\n    label: 'Sync Progress',\n    description: 'Data synchronization progress update',\n    category: 'sync',\n  },\n\n  // Webhook events\n  webhook_received: {\n    action: 'webhook_received',\n    label: 'Webhook Received',\n    description: 'Inbound webhook notification received',\n    category: 'webhooks',\n  },\n  webhook_processed: {\n    action: 'webhook_processed',\n    label: 'Webhook Processed',\n    description: 'Webhook notification was processed',\n    category: 'webhooks',\n  },\n  webhook_failed: {\n    action: 'webhook_failed',\n    label: 'Webhook Failed',\n    description: 'Webhook processing failed',\n    category: 'webhooks',\n  },\n  webhook_retried: {\n    action: 'webhook_retried',\n    label: 'Webhook Retried',\n    description: 'Webhook processing was retried',\n    category: 'webhooks',\n  },\n\n  // Subscription events\n  subscription_created: {\n    action: 'subscription_created',\n    label: 'Subscription Created',\n    description: 'Event subscription was established',\n    category: 'subscriptions',\n  },\n  subscription_renewed: {\n    action: 'subscription_renewed',\n    label: 'Subscription Renewed',\n    description: 'Event subscription was renewed',\n    category: 'subscriptions',\n  },\n  subscription_expired: {\n    action: 'subscription_expired',\n    label: 'Subscription Expired',\n    description: 'Event subscription has expired',\n    category: 'subscriptions',\n  },\n  subscription_cancelled: {\n    action: 'subscription_cancelled',\n    label: 'Subscription Cancelled',\n    description: 'Event subscription was cancelled',\n    category: 'subscriptions',\n  },\n\n  // Installation events\n  installed: {\n    action: 'installed',\n    label: 'Installed',\n    description: 'Service was installed',\n    category: 'installations',\n  },\n  uninstalled: {\n    action: 'uninstalled',\n    label: 'Uninstalled',\n    description: 'Service was uninstalled',\n    category: 'installations',\n  },\n  reinstalled: {\n    action: 'reinstalled',\n    label: 'Reinstalled',\n    description: 'Service was reinstalled',\n    category: 'installations',\n  },\n\n  // Grant/permission events\n  grants_updated: {\n    action: 'grants_updated',\n    label: 'Permissions Updated',\n    description: 'Connection permissions were modified',\n    category: 'grants',\n  },\n  grants_captured: {\n    action: 'grants_captured',\n    label: 'Permissions Captured',\n    description: 'Connection permissions were recorded',\n    category: 'grants',\n  },\n\n  // Token events\n  token_refreshed: {\n    action: 'token_refreshed',\n    label: 'Token Refreshed',\n    description: 'Access token was refreshed',\n    category: 'credentials',\n  },\n  token_expired: {\n    action: 'token_expired',\n    label: 'Token Expired',\n    description: 'Access token has expired',\n    category: 'credentials',\n  },\n  token_revoked: {\n    action: 'token_revoked',\n    label: 'Token Revoked',\n    description: 'Access token was revoked',\n    category: 'credentials',\n  },\n\n  // Error events\n  error_occurred: {\n    action: 'error_occurred',\n    label: 'Error Occurred',\n    description: 'An error was recorded',\n    category: 'errors',\n  },\n  error_resolved: {\n    action: 'error_resolved',\n    label: 'Error Resolved',\n    description: 'A previous error was resolved',\n    category: 'errors',\n  },\n\n  // Rate limit events\n  rate_limited: {\n    action: 'rate_limited',\n    label: 'Rate Limited',\n    description: 'API request was rate limited',\n    category: 'errors',\n  },\n  quota_exceeded: {\n    action: 'quota_exceeded',\n    label: 'Quota Exceeded',\n    description: 'API quota was exceeded',\n    category: 'errors',\n  },\n};\n\n// =============================================================================\n// Label Registry\n// =============================================================================\n\n/**\n * Action label registry singleton.\n * Manages backend-provided overrides and default labels.\n */\nclass ActionLabelRegistry {\n  private backendLabels: Record<string, string> = {};\n  private fallbackFormatter: (action: string) => string;\n  private initialized = false;\n\n  constructor() {\n    this.fallbackFormatter = defaultFallbackFormatter;\n  }\n\n  /**\n   * Initialize the registry with backend-provided labels.\n   */\n  init(config: ActionLabelConfig = {}): void {\n    if (config.labels) {\n      this.backendLabels = { ...config.labels };\n    }\n    if (config.fallbackFormatter) {\n      this.fallbackFormatter = config.fallbackFormatter;\n    }\n    this.initialized = true;\n  }\n\n  /**\n   * Check if registry has been initialized.\n   */\n  isInitialized(): boolean {\n    return this.initialized;\n  }\n\n  /**\n   * Get the label for an action.\n   * Priority: backend override > default label > fallback formatter\n   */\n  getLabel(action: string): string {\n    // Check backend overrides first\n    if (this.backendLabels[action]) {\n      return this.backendLabels[action];\n    }\n\n    // Check default labels\n    const defaultEntry = DEFAULT_ACTION_LABELS[action];\n    if (defaultEntry) {\n      return defaultEntry.label;\n    }\n\n    // Use fallback formatter\n    return this.fallbackFormatter(action);\n  }\n\n  /**\n   * Get full entry information for an action (includes description, category).\n   */\n  getEntry(action: string): ActionLabelEntry | null {\n    const defaultEntry = DEFAULT_ACTION_LABELS[action];\n    if (!defaultEntry) {\n      return null;\n    }\n\n    // Apply backend override to label if present\n    return {\n      ...defaultEntry,\n      label: this.backendLabels[action] || defaultEntry.label,\n    };\n  }\n\n  /**\n   * Get all known actions with their labels.\n   */\n  getAllLabels(): Record<string, string> {\n    const labels: Record<string, string> = {};\n\n    // Add default labels\n    for (const [action, entry] of Object.entries(DEFAULT_ACTION_LABELS)) {\n      labels[action] = entry.label;\n    }\n\n    // Override with backend labels\n    for (const [action, label] of Object.entries(this.backendLabels)) {\n      labels[action] = label;\n    }\n\n    return labels;\n  }\n\n  /**\n   * Get actions by category.\n   */\n  getActionsByCategory(): Record<string, ActionLabelEntry[]> {\n    const categories: Record<string, ActionLabelEntry[]> = {};\n\n    for (const entry of Object.values(DEFAULT_ACTION_LABELS)) {\n      const category = entry.category || 'other';\n      if (!categories[category]) {\n        categories[category] = [];\n      }\n      categories[category].push({\n        ...entry,\n        label: this.backendLabels[entry.action] || entry.label,\n      });\n    }\n\n    return categories;\n  }\n\n  /**\n   * Add or update backend labels.\n   */\n  setLabels(labels: Record<string, string>): void {\n    this.backendLabels = { ...this.backendLabels, ...labels };\n  }\n\n  /**\n   * Clear backend labels (keeps defaults).\n   */\n  clearBackendLabels(): void {\n    this.backendLabels = {};\n  }\n\n  /**\n   * Reset to initial state.\n   */\n  reset(): void {\n    this.backendLabels = {};\n    this.fallbackFormatter = defaultFallbackFormatter;\n    this.initialized = false;\n  }\n}\n\n// =============================================================================\n// Module Singleton\n// =============================================================================\n\nconst registry = new ActionLabelRegistry();\n\n/**\n * Initialize activity labels from backend config.\n * Call this during app bootstrap before rendering activity pages.\n */\nexport function initActivityLabels(config: ActionLabelConfig = {}): void {\n  registry.init(config);\n}\n\n/**\n * Get the label for an action.\n * This is the primary function to use for rendering action labels.\n */\nexport function getActionLabel(action: string): string {\n  return registry.getLabel(action);\n}\n\n/**\n * Get full entry information for an action.\n */\nexport function getActionEntry(action: string): ActionLabelEntry | null {\n  return registry.getEntry(action);\n}\n\n/**\n * Get all known action labels as a flat map.\n */\nexport function getAllActionLabels(): Record<string, string> {\n  return registry.getAllLabels();\n}\n\n/**\n * Get actions grouped by category.\n */\nexport function getActionsByCategory(): Record<string, ActionLabelEntry[]> {\n  return registry.getActionsByCategory();\n}\n\n/**\n * Update backend labels at runtime (e.g., after fetching config).\n */\nexport function setActionLabels(labels: Record<string, string>): void {\n  registry.setLabels(labels);\n}\n\n/**\n * Check if the registry is initialized.\n */\nexport function isActivityLabelsInitialized(): boolean {\n  return registry.isInitialized();\n}\n\n/**\n * Reset the registry to default state.\n */\nexport function resetActivityLabels(): void {\n  registry.reset();\n}\n\n/**\n * Create a getActionLabel function bound to specific overrides.\n * Useful for component-specific label customization.\n */\nexport function createActionLabelResolver(overrides: Record<string, string> = {}): (action: string) => string {\n  return (action: string) => {\n    if (overrides[action]) {\n      return overrides[action];\n    }\n    return registry.getLabel(action);\n  };\n}\n\n// =============================================================================\n// Helpers\n// =============================================================================\n\n/**\n * Default fallback formatter: converts snake_case to Title Case.\n */\nfunction defaultFallbackFormatter(action: string): string {\n  return action\n    .replace(/_/g, ' ')\n    .replace(/-/g, ' ')\n    .replace(/\\b\\w/g, (c) => c.toUpperCase());\n}\n\n// =============================================================================\n// Export Constants\n// =============================================================================\n\nexport { DEFAULT_ACTION_LABELS };\n","/**\n * Deep Links Module\n * Handles navigation to service entities with filter context preservation.\n *\n * Features:\n * - Generate links to connections, installations, subscriptions, sync jobs\n * - Preserve and restore filter context across navigation\n * - Support for back navigation with filter restoration\n */\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/** Service entity types that can be linked to */\nexport type ServiceEntityType =\n  | 'connection'\n  | 'installation'\n  | 'subscription'\n  | 'sync'\n  | 'provider'\n  | 'activity';\n\n/** Configuration for deep link generation */\nexport interface DeepLinkConfig {\n  /** Base path for services routes (default: '/admin/services') */\n  basePath?: string;\n  /** Custom path mapping for entity types */\n  pathMap?: Partial<Record<ServiceEntityType, string>>;\n}\n\n/** Context to preserve during navigation */\nexport interface NavigationContext {\n  /** Page user came from */\n  fromPage?: string;\n  /** Filters that were active */\n  filters?: Record<string, string>;\n  /** Search query that was active */\n  search?: string;\n  /** Current page number */\n  page?: number;\n  /** View mode (timeline/table for activity) */\n  viewMode?: string;\n}\n\n/** Parsed deep link information */\nexport interface ParsedDeepLink {\n  entityType: ServiceEntityType;\n  entityId: string;\n  context?: NavigationContext;\n}\n\n// =============================================================================\n// Default Configuration\n// =============================================================================\n\nconst DEFAULT_BASE_PATH = '/admin/services';\n\nconst DEFAULT_PATH_MAP: Record<ServiceEntityType, string> = {\n  connection: 'connections',\n  installation: 'installations',\n  subscription: 'subscriptions',\n  sync: 'sync',\n  provider: 'providers',\n  activity: 'activity',\n};\n\n// =============================================================================\n// Deep Link Manager\n// =============================================================================\n\n/**\n * Manages deep linking with context preservation.\n */\nclass DeepLinkManager {\n  private basePath: string;\n  private pathMap: Record<ServiceEntityType, string>;\n  private contextStorageKey = 'services-nav-context';\n\n  constructor(config: DeepLinkConfig = {}) {\n    this.basePath = config.basePath || DEFAULT_BASE_PATH;\n    this.pathMap = { ...DEFAULT_PATH_MAP, ...config.pathMap };\n  }\n\n  /**\n   * Configure the manager.\n   */\n  configure(config: DeepLinkConfig): void {\n    if (config.basePath) {\n      this.basePath = config.basePath;\n    }\n    if (config.pathMap) {\n      this.pathMap = { ...this.pathMap, ...config.pathMap };\n    }\n  }\n\n  /**\n   * Generate a deep link URL for an entity.\n   */\n  generateLink(\n    entityType: ServiceEntityType,\n    entityId: string,\n    context?: NavigationContext\n  ): string {\n    const path = this.pathMap[entityType] || entityType;\n    let url = `${this.basePath}/${path}/${encodeURIComponent(entityId)}`;\n\n    // Encode context in URL if provided\n    if (context) {\n      const contextParam = this.encodeContext(context);\n      if (contextParam) {\n        url += `?ctx=${contextParam}`;\n      }\n    }\n\n    return url;\n  }\n\n  /**\n   * Generate a link to an entity list page with optional filters.\n   */\n  generateListLink(\n    entityType: ServiceEntityType,\n    filters?: Record<string, string>\n  ): string {\n    const path = this.pathMap[entityType] || entityType;\n    let url = `${this.basePath}/${path}`;\n\n    if (filters && Object.keys(filters).length > 0) {\n      const params = new URLSearchParams();\n      for (const [key, value] of Object.entries(filters)) {\n        if (value) {\n          params.set(key, value);\n        }\n      }\n      url += `?${params.toString()}`;\n    }\n\n    return url;\n  }\n\n  /**\n   * Navigate to an entity, preserving context for back navigation.\n   */\n  navigateTo(\n    entityType: ServiceEntityType,\n    entityId: string,\n    context?: NavigationContext,\n    options: { replace?: boolean } = {}\n  ): void {\n    // Save context for back navigation\n    if (context) {\n      this.saveContext(context);\n    }\n\n    const url = this.generateLink(entityType, entityId, context);\n\n    if (options.replace) {\n      window.history.replaceState({ entityType, entityId, context }, '', url);\n    } else {\n      window.history.pushState({ entityType, entityId, context }, '', url);\n    }\n\n    // Dispatch navigation event for app-level routing\n    window.dispatchEvent(\n      new CustomEvent('services:navigate', {\n        detail: { entityType, entityId, context, url },\n      })\n    );\n  }\n\n  /**\n   * Navigate back with context restoration.\n   */\n  navigateBack(): NavigationContext | null {\n    const context = this.restoreContext();\n\n    if (context?.fromPage) {\n      // Build return URL with filters\n      const params = new URLSearchParams();\n\n      if (context.filters) {\n        for (const [key, value] of Object.entries(context.filters)) {\n          if (value) params.set(key, value);\n        }\n      }\n      if (context.search) {\n        params.set('q', context.search);\n      }\n      if (context.page && context.page > 1) {\n        params.set('page', String(context.page));\n      }\n      if (context.viewMode) {\n        params.set('view', context.viewMode);\n      }\n\n      const queryString = params.toString();\n      const url = queryString ? `${context.fromPage}?${queryString}` : context.fromPage;\n\n      window.history.pushState({ restored: true }, '', url);\n\n      // Dispatch back navigation event\n      window.dispatchEvent(\n        new CustomEvent('services:navigate-back', {\n          detail: { context, url },\n        })\n      );\n\n      return context;\n    }\n\n    // Fallback to browser back\n    window.history.back();\n    return null;\n  }\n\n  /**\n   * Parse entity info from current URL.\n   */\n  parseCurrentUrl(): ParsedDeepLink | null {\n    return this.parseUrl(window.location.pathname + window.location.search);\n  }\n\n  /**\n   * Parse entity info from a URL.\n   */\n  parseUrl(url: string): ParsedDeepLink | null {\n    const [pathname, search] = url.split('?');\n\n    // Extract path after base\n    const relativePath = pathname.startsWith(this.basePath)\n      ? pathname.slice(this.basePath.length)\n      : pathname;\n\n    const segments = relativePath.split('/').filter(Boolean);\n    if (segments.length < 2) {\n      return null;\n    }\n\n    // Find entity type from path\n    const entityPath = segments[0];\n    const entityId = decodeURIComponent(segments[1]);\n\n    let entityType: ServiceEntityType | null = null;\n    for (const [type, path] of Object.entries(this.pathMap)) {\n      if (path === entityPath) {\n        entityType = type as ServiceEntityType;\n        break;\n      }\n    }\n\n    if (!entityType) {\n      return null;\n    }\n\n    // Parse context from query string\n    let context: NavigationContext | undefined;\n    if (search) {\n      const params = new URLSearchParams(search);\n      const ctxParam = params.get('ctx');\n      if (ctxParam) {\n        context = this.decodeContext(ctxParam);\n      }\n    }\n\n    return { entityType, entityId, context };\n  }\n\n  /**\n   * Map object_type values from activity entries to entity types.\n   */\n  mapObjectTypeToEntity(objectType: string): ServiceEntityType | null {\n    const mapping: Record<string, ServiceEntityType> = {\n      connection: 'connection',\n      connections: 'connection',\n      installation: 'installation',\n      installations: 'installation',\n      subscription: 'subscription',\n      subscriptions: 'subscription',\n      sync: 'sync',\n      sync_job: 'sync',\n      sync_jobs: 'sync',\n      provider: 'provider',\n      providers: 'provider',\n    };\n\n    return mapping[objectType.toLowerCase()] || null;\n  }\n\n  /**\n   * Create navigation context from current query state.\n   */\n  createContextFromQueryState(\n    queryState: {\n      filters: Record<string, string | undefined>;\n      search?: string;\n      page: number;\n    },\n    viewMode?: string\n  ): NavigationContext {\n    const filters: Record<string, string> = {};\n    for (const [key, value] of Object.entries(queryState.filters)) {\n      if (value) {\n        filters[key] = value;\n      }\n    }\n\n    return {\n      fromPage: window.location.pathname,\n      filters: Object.keys(filters).length > 0 ? filters : undefined,\n      search: queryState.search || undefined,\n      page: queryState.page > 1 ? queryState.page : undefined,\n      viewMode,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Context Storage\n  // ---------------------------------------------------------------------------\n\n  private saveContext(context: NavigationContext): void {\n    try {\n      sessionStorage.setItem(this.contextStorageKey, JSON.stringify(context));\n    } catch (e) {\n      // Ignore storage errors\n    }\n  }\n\n  private restoreContext(): NavigationContext | null {\n    try {\n      const stored = sessionStorage.getItem(this.contextStorageKey);\n      if (stored) {\n        sessionStorage.removeItem(this.contextStorageKey);\n        return JSON.parse(stored);\n      }\n    } catch (e) {\n      // Ignore storage errors\n    }\n    return null;\n  }\n\n  private encodeContext(context: NavigationContext): string {\n    try {\n      return btoa(JSON.stringify(context));\n    } catch (e) {\n      return '';\n    }\n  }\n\n  private decodeContext(encoded: string): NavigationContext | undefined {\n    try {\n      return JSON.parse(atob(encoded));\n    } catch (e) {\n      return undefined;\n    }\n  }\n}\n\n// =============================================================================\n// Singleton Instance\n// =============================================================================\n\nconst manager = new DeepLinkManager();\n\n/**\n * Configure deep link manager.\n */\nexport function configureDeepLinks(config: DeepLinkConfig): void {\n  manager.configure(config);\n}\n\n/**\n * Generate a deep link URL for an entity.\n */\nexport function generateDeepLink(\n  entityType: ServiceEntityType,\n  entityId: string,\n  context?: NavigationContext\n): string {\n  return manager.generateLink(entityType, entityId, context);\n}\n\n/**\n * Generate a link to an entity list page.\n */\nexport function generateListLink(\n  entityType: ServiceEntityType,\n  filters?: Record<string, string>\n): string {\n  return manager.generateListLink(entityType, filters);\n}\n\n/**\n * Navigate to an entity with context preservation.\n */\nexport function navigateToEntity(\n  entityType: ServiceEntityType,\n  entityId: string,\n  context?: NavigationContext,\n  options?: { replace?: boolean }\n): void {\n  manager.navigateTo(entityType, entityId, context, options);\n}\n\n/**\n * Navigate back with context restoration.\n */\nexport function navigateBack(): NavigationContext | null {\n  return manager.navigateBack();\n}\n\n/**\n * Parse entity info from current URL.\n */\nexport function parseCurrentDeepLink(): ParsedDeepLink | null {\n  return manager.parseCurrentUrl();\n}\n\n/**\n * Parse entity info from a URL.\n */\nexport function parseDeepLink(url: string): ParsedDeepLink | null {\n  return manager.parseUrl(url);\n}\n\n/**\n * Map object_type to entity type.\n */\nexport function mapObjectTypeToEntity(objectType: string): ServiceEntityType | null {\n  return manager.mapObjectTypeToEntity(objectType);\n}\n\n/**\n * Create navigation context from current query state.\n */\nexport function createNavigationContext(\n  queryState: {\n    filters: Record<string, string | undefined>;\n    search?: string;\n    page: number;\n  },\n  viewMode?: string\n): NavigationContext {\n  return manager.createContextFromQueryState(queryState, viewMode);\n}\n\n// =============================================================================\n// Integration Helper for Activity Page\n// =============================================================================\n\n/**\n * Create an onNavigate handler for the activity page that uses deep links.\n * This wraps navigation with context preservation.\n */\nexport function createActivityNavigateHandler(\n  getQueryState: () => {\n    filters: Record<string, string | undefined>;\n    search?: string;\n    page: number;\n  },\n  getViewMode?: () => string\n): (objectType: string, objectId: string) => void {\n  return (objectType: string, objectId: string) => {\n    const entityType = mapObjectTypeToEntity(objectType);\n    if (!entityType) {\n      console.warn(`[DeepLinks] Unknown object type: ${objectType}`);\n      return;\n    }\n\n    const context = createNavigationContext(\n      getQueryState(),\n      getViewMode?.()\n    );\n\n    navigateToEntity(entityType, objectId, context);\n  };\n}\n\n// =============================================================================\n// Exports\n// =============================================================================\n\nexport {\n  DeepLinkManager,\n  manager as deepLinkManager,\n};\n","/**\n * Accessibility Utilities Module\n * Provides keyboard navigation, focus management, and screen-reader support\n * for the services module UI components.\n *\n * Usage:\n *   import { setupKeyboardNavigation, announceToScreenReader } from './accessibility.js';\n *\n *   // Enable keyboard navigation on a list\n *   setupKeyboardNavigation({\n *     container: tableElement,\n *     selector: 'tr[data-row-id]',\n *     onSelect: (element) => handleRowSelect(element),\n *   });\n *\n *   // Announce state changes to screen readers\n *   announceToScreenReader('Connection refreshed successfully');\n */\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/** Configuration for keyboard navigation on lists/tables */\nexport interface KeyboardNavigationConfig {\n  /** Container element for the navigable items */\n  container: HTMLElement;\n  /** Selector for navigable items within the container */\n  selector: string;\n  /** Called when an item is selected via Enter/Space */\n  onSelect?: (element: HTMLElement, index: number) => void;\n  /** Called when an item receives focus */\n  onFocus?: (element: HTMLElement, index: number) => void;\n  /** Called when Escape is pressed */\n  onEscape?: () => void;\n  /** Whether navigation wraps from last to first item (default: true) */\n  wrap?: boolean;\n  /** Whether to auto-focus first item on init (default: false) */\n  autoFocus?: boolean;\n  /** Custom key handlers */\n  keyHandlers?: Record<string, (event: KeyboardEvent, element: HTMLElement, index: number) => void>;\n}\n\n/** Configuration for focus trap (e.g., in modals) */\nexport interface FocusTrapConfig {\n  /** Container element to trap focus within */\n  container: HTMLElement;\n  /** Initial element to focus (default: first focusable) */\n  initialFocus?: HTMLElement | string;\n  /** Element to return focus to on close */\n  returnFocus?: HTMLElement;\n  /** Called when Escape is pressed */\n  onEscape?: () => void;\n}\n\n/** Options for screen reader announcements */\nexport interface AnnounceOptions {\n  /** Announcement priority: 'polite' or 'assertive' (default: 'polite') */\n  priority?: 'polite' | 'assertive';\n  /** Clear previous announcement before new one (default: true) */\n  clear?: boolean;\n}\n\n// =============================================================================\n// Keyboard Navigation\n// =============================================================================\n\n/**\n * Set up keyboard navigation for a list/table of items.\n * Supports Arrow keys for navigation, Enter/Space for selection, Home/End for jump.\n */\nexport function setupKeyboardNavigation(config: KeyboardNavigationConfig): () => void {\n  const {\n    container,\n    selector,\n    onSelect,\n    onFocus,\n    onEscape,\n    wrap = true,\n    autoFocus = false,\n    keyHandlers = {},\n  } = config;\n\n  let currentIndex = -1;\n\n  function getItems(): HTMLElement[] {\n    return Array.from(container.querySelectorAll<HTMLElement>(selector));\n  }\n\n  function focusItem(index: number): void {\n    const items = getItems();\n    if (items.length === 0) return;\n\n    // Clamp or wrap index\n    let targetIndex = index;\n    if (wrap) {\n      targetIndex = ((index % items.length) + items.length) % items.length;\n    } else {\n      targetIndex = Math.max(0, Math.min(index, items.length - 1));\n    }\n\n    // Update tabindex on all items\n    items.forEach((item, i) => {\n      item.setAttribute('tabindex', i === targetIndex ? '0' : '-1');\n    });\n\n    // Focus the target item\n    const targetItem = items[targetIndex];\n    targetItem.focus();\n    currentIndex = targetIndex;\n\n    onFocus?.(targetItem, targetIndex);\n  }\n\n  function handleKeyDown(event: KeyboardEvent): void {\n    const items = getItems();\n    if (items.length === 0) return;\n\n    const target = event.target as HTMLElement;\n    const itemIndex = items.indexOf(target);\n\n    // Only handle if focus is on a navigable item\n    if (itemIndex === -1) return;\n\n    // Custom key handlers first\n    if (keyHandlers[event.key]) {\n      keyHandlers[event.key](event, target, itemIndex);\n      return;\n    }\n\n    switch (event.key) {\n      case 'ArrowDown':\n      case 'ArrowRight':\n        event.preventDefault();\n        focusItem(itemIndex + 1);\n        break;\n\n      case 'ArrowUp':\n      case 'ArrowLeft':\n        event.preventDefault();\n        focusItem(itemIndex - 1);\n        break;\n\n      case 'Home':\n        event.preventDefault();\n        focusItem(0);\n        break;\n\n      case 'End':\n        event.preventDefault();\n        focusItem(items.length - 1);\n        break;\n\n      case 'Enter':\n      case ' ':\n        event.preventDefault();\n        onSelect?.(target, itemIndex);\n        break;\n\n      case 'Escape':\n        event.preventDefault();\n        onEscape?.();\n        break;\n    }\n  }\n\n  // Initialize tabindex on items\n  const items = getItems();\n  items.forEach((item, i) => {\n    item.setAttribute('tabindex', i === 0 ? '0' : '-1');\n    // Ensure items have appropriate role\n    if (!item.hasAttribute('role')) {\n      item.setAttribute('role', 'option');\n    }\n  });\n\n  // Set container role if not already set\n  if (!container.hasAttribute('role')) {\n    container.setAttribute('role', 'listbox');\n  }\n\n  // Add event listener\n  container.addEventListener('keydown', handleKeyDown);\n\n  // Auto-focus first item if requested\n  if (autoFocus && items.length > 0) {\n    focusItem(0);\n  }\n\n  // Return cleanup function\n  return () => {\n    container.removeEventListener('keydown', handleKeyDown);\n  };\n}\n\n/**\n * Set up roving tabindex for a toolbar or button group.\n */\nexport function setupRovingTabindex(\n  container: HTMLElement,\n  selector: string\n): () => void {\n  return setupKeyboardNavigation({\n    container,\n    selector,\n    wrap: true,\n    onSelect: (element) => {\n      element.click();\n    },\n  });\n}\n\n// =============================================================================\n// Focus Trap\n// =============================================================================\n\nconst FOCUSABLE_SELECTOR = [\n  'a[href]',\n  'button:not([disabled])',\n  'input:not([disabled])',\n  'select:not([disabled])',\n  'textarea:not([disabled])',\n  '[tabindex]:not([tabindex=\"-1\"])',\n].join(', ');\n\n/**\n * Create a focus trap that keeps focus within a container (e.g., modal).\n * Returns a cleanup function to release the trap.\n */\nexport function createFocusTrap(config: FocusTrapConfig): () => void {\n  const { container, initialFocus, returnFocus, onEscape } = config;\n\n  const previouslyFocused = document.activeElement as HTMLElement;\n\n  function getFocusableElements(): HTMLElement[] {\n    return Array.from(container.querySelectorAll<HTMLElement>(FOCUSABLE_SELECTOR));\n  }\n\n  function handleKeyDown(event: KeyboardEvent): void {\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      onEscape?.();\n      return;\n    }\n\n    if (event.key !== 'Tab') return;\n\n    const focusables = getFocusableElements();\n    if (focusables.length === 0) return;\n\n    const firstFocusable = focusables[0];\n    const lastFocusable = focusables[focusables.length - 1];\n\n    if (event.shiftKey) {\n      // Shift+Tab: going backward\n      if (document.activeElement === firstFocusable) {\n        event.preventDefault();\n        lastFocusable.focus();\n      }\n    } else {\n      // Tab: going forward\n      if (document.activeElement === lastFocusable) {\n        event.preventDefault();\n        firstFocusable.focus();\n      }\n    }\n  }\n\n  // Focus initial element\n  requestAnimationFrame(() => {\n    if (initialFocus) {\n      const target = typeof initialFocus === 'string'\n        ? container.querySelector<HTMLElement>(initialFocus)\n        : initialFocus;\n      target?.focus();\n    } else {\n      const focusables = getFocusableElements();\n      focusables[0]?.focus();\n    }\n  });\n\n  // Add trap handler\n  container.addEventListener('keydown', handleKeyDown);\n\n  // Mark container as a dialog for accessibility\n  if (!container.hasAttribute('role')) {\n    container.setAttribute('role', 'dialog');\n  }\n  container.setAttribute('aria-modal', 'true');\n\n  // Return cleanup function\n  return () => {\n    container.removeEventListener('keydown', handleKeyDown);\n    container.removeAttribute('aria-modal');\n\n    // Return focus to previous element\n    const focusTarget = returnFocus || previouslyFocused;\n    focusTarget?.focus?.();\n  };\n}\n\n// =============================================================================\n// Screen Reader Announcements\n// =============================================================================\n\nlet liveRegion: HTMLElement | null = null;\n\n/**\n * Get or create the live region for screen reader announcements.\n */\nfunction getLiveRegion(priority: 'polite' | 'assertive'): HTMLElement {\n  const id = `services-live-region-${priority}`;\n  let region = document.getElementById(id);\n\n  if (!region) {\n    region = document.createElement('div');\n    region.id = id;\n    region.setAttribute('aria-live', priority);\n    region.setAttribute('aria-atomic', 'true');\n    region.setAttribute('role', 'status');\n    region.className = 'sr-only';\n    // Visually hidden but accessible\n    Object.assign(region.style, {\n      position: 'absolute',\n      width: '1px',\n      height: '1px',\n      padding: '0',\n      margin: '-1px',\n      overflow: 'hidden',\n      clip: 'rect(0, 0, 0, 0)',\n      whiteSpace: 'nowrap',\n      border: '0',\n    });\n    document.body.appendChild(region);\n  }\n\n  return region;\n}\n\n/**\n * Announce a message to screen readers via ARIA live region.\n */\nexport function announceToScreenReader(\n  message: string,\n  options: AnnounceOptions = {}\n): void {\n  const { priority = 'polite', clear = true } = options;\n\n  const region = getLiveRegion(priority);\n\n  if (clear) {\n    region.textContent = '';\n  }\n\n  // Use setTimeout to ensure the browser picks up the change\n  setTimeout(() => {\n    region.textContent = message;\n  }, 100);\n}\n\n/**\n * Announce loading state to screen readers.\n */\nexport function announceLoading(resource: string): void {\n  announceToScreenReader(`Loading ${resource}...`, { priority: 'polite' });\n}\n\n/**\n * Announce successful action to screen readers.\n */\nexport function announceSuccess(message: string): void {\n  announceToScreenReader(message, { priority: 'polite' });\n}\n\n/**\n * Announce error to screen readers.\n */\nexport function announceError(message: string): void {\n  announceToScreenReader(`Error: ${message}`, { priority: 'assertive' });\n}\n\n/**\n * Announce navigation/page change to screen readers.\n */\nexport function announceNavigation(destination: string): void {\n  announceToScreenReader(`Navigating to ${destination}`, { priority: 'polite' });\n}\n\n// =============================================================================\n// ARIA Attribute Helpers\n// =============================================================================\n\n/**\n * Add ARIA attributes for a button that controls expanded/collapsed content.\n */\nexport function setExpandedState(\n  trigger: HTMLElement,\n  target: HTMLElement | string,\n  expanded: boolean\n): void {\n  trigger.setAttribute('aria-expanded', String(expanded));\n\n  const targetId = typeof target === 'string' ? target : target.id;\n  if (targetId) {\n    trigger.setAttribute('aria-controls', targetId);\n  }\n}\n\n/**\n * Add ARIA attributes for a loading state.\n */\nexport function setLoadingState(element: HTMLElement, loading: boolean): void {\n  element.setAttribute('aria-busy', String(loading));\n  if (loading) {\n    element.setAttribute('aria-describedby', 'loading-indicator');\n  } else {\n    element.removeAttribute('aria-describedby');\n  }\n}\n\n/**\n * Add ARIA label for status badges/indicators.\n */\nexport function setStatusLabel(\n  element: HTMLElement,\n  status: string,\n  statusLabel: string\n): void {\n  element.setAttribute('role', 'status');\n  element.setAttribute('aria-label', `Status: ${statusLabel}`);\n}\n\n/**\n * Add ARIA attributes for sortable table headers.\n */\nexport function setSortableHeader(\n  header: HTMLElement,\n  sorted: 'ascending' | 'descending' | 'none'\n): void {\n  header.setAttribute('aria-sort', sorted);\n  header.setAttribute('role', 'columnheader');\n}\n\n/**\n * Add ARIA attributes for a progress indicator.\n */\nexport function setProgress(\n  element: HTMLElement,\n  value: number,\n  max: number = 100,\n  label?: string\n): void {\n  element.setAttribute('role', 'progressbar');\n  element.setAttribute('aria-valuenow', String(value));\n  element.setAttribute('aria-valuemin', '0');\n  element.setAttribute('aria-valuemax', String(max));\n  if (label) {\n    element.setAttribute('aria-label', label);\n  }\n}\n\n// =============================================================================\n// Skip Links\n// =============================================================================\n\n/**\n * Create a skip link for keyboard users to bypass navigation.\n */\nexport function createSkipLink(targetId: string, label: string = 'Skip to main content'): HTMLAnchorElement {\n  const link = document.createElement('a');\n  link.href = `#${targetId}`;\n  link.className = 'sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:bg-white focus:px-4 focus:py-2 focus:rounded focus:shadow-lg';\n  link.textContent = label;\n  return link;\n}\n\n// =============================================================================\n// Focus Management for Dialogs\n// =============================================================================\n\n/**\n * Set up focus management for a modal dialog.\n * Returns a cleanup function.\n */\nexport function setupDialogFocus(\n  dialog: HTMLElement,\n  options: {\n    title?: string;\n    describedBy?: string;\n    onClose?: () => void;\n  } = {}\n): () => void {\n  const { title, describedBy, onClose } = options;\n\n  // Set dialog attributes\n  dialog.setAttribute('role', 'dialog');\n  dialog.setAttribute('aria-modal', 'true');\n\n  if (title) {\n    const titleId = `dialog-title-${Date.now()}`;\n    const titleEl = dialog.querySelector('h1, h2, h3, [role=\"heading\"]');\n    if (titleEl) {\n      titleEl.id = titleId;\n      dialog.setAttribute('aria-labelledby', titleId);\n    }\n  }\n\n  if (describedBy) {\n    dialog.setAttribute('aria-describedby', describedBy);\n  }\n\n  // Create focus trap\n  const releaseTrap = createFocusTrap({\n    container: dialog,\n    onEscape: onClose,\n  });\n\n  return () => {\n    releaseTrap();\n    dialog.removeAttribute('aria-modal');\n    dialog.removeAttribute('aria-labelledby');\n    dialog.removeAttribute('aria-describedby');\n  };\n}\n\n// =============================================================================\n// Reduced Motion Support\n// =============================================================================\n\n/**\n * Check if user prefers reduced motion.\n */\nexport function prefersReducedMotion(): boolean {\n  return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n}\n\n/**\n * Get appropriate animation duration based on user preference.\n */\nexport function getAnimationDuration(normalDuration: number): number {\n  return prefersReducedMotion() ? 0 : normalDuration;\n}\n\n// =============================================================================\n// Exports\n// =============================================================================\n\nexport { FOCUSABLE_SELECTOR };\n","/**\n * Extension Diagnostics Module\n * UI panels for viewing downstream package registration state, provider pack status,\n * hooks enabled, config health, and latest extension errors.\n *\n * This module renders diagnostic information for operators to understand\n * the current state of go-services extensions and registered packages.\n */\n\nimport { renderIcon } from '../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/** Status of an extension pack */\nexport type ExtensionStatus = 'active' | 'degraded' | 'errored' | 'disabled';\n\n/** Information about a registered provider pack */\nexport interface ProviderPackInfo {\n  /** Pack identifier (e.g., \"google-drive\", \"slack\") */\n  id: string;\n  /** Human-readable name */\n  name: string;\n  /** Pack version */\n  version: string;\n  /** Current status */\n  status: ExtensionStatus;\n  /** Provider IDs registered by this pack */\n  providers: string[];\n  /** Capabilities registered */\n  capabilities: string[];\n  /** Hooks registered by this pack */\n  hooks: string[];\n  /** Last error message if status is errored */\n  lastError?: string;\n  /** When the pack was registered */\n  registeredAt: string;\n  /** When the status last changed */\n  lastStatusChange?: string;\n}\n\n/** Information about a registered hook */\nexport interface HookInfo {\n  /** Hook name/type */\n  name: string;\n  /** Source pack that registered this hook */\n  sourcePack: string;\n  /** Whether the hook is currently enabled */\n  enabled: boolean;\n  /** Last execution time */\n  lastExecutionAt?: string;\n  /** Last execution result */\n  lastResult?: 'success' | 'failure';\n  /** Execution count */\n  executionCount: number;\n  /** Failure count */\n  failureCount: number;\n}\n\n/** Configuration health status */\nexport interface ConfigHealth {\n  /** Overall health status */\n  status: 'healthy' | 'warning' | 'error';\n  /** List of configuration issues */\n  issues: Array<{\n    severity: 'warning' | 'error';\n    message: string;\n    field?: string;\n  }>;\n  /** Last validation time */\n  lastValidatedAt: string;\n}\n\n/** Recent extension error */\nexport interface ExtensionError {\n  /** Error ID */\n  id: string;\n  /** Source pack */\n  packId: string;\n  /** Error type/code */\n  type: string;\n  /** Error message */\n  message: string;\n  /** Stack trace if available */\n  stack?: string;\n  /** When the error occurred */\n  occurredAt: string;\n  /** Related entity if applicable */\n  relatedEntity?: {\n    type: string;\n    id: string;\n  };\n}\n\n/** Full extension diagnostics state */\nexport interface ExtensionDiagnosticsState {\n  /** Registered provider packs */\n  packs: ProviderPackInfo[];\n  /** Registered hooks */\n  hooks: HookInfo[];\n  /** Configuration health */\n  configHealth: ConfigHealth;\n  /** Recent errors */\n  recentErrors: ExtensionError[];\n  /** go-services runtime version */\n  runtimeVersion: string;\n  /** Worker status */\n  workerStatus: 'running' | 'stopped' | 'degraded';\n  /** Last data refresh */\n  lastRefreshedAt: string;\n}\n\n/** Configuration for the diagnostics panel */\nexport interface ExtensionDiagnosticsPanelConfig {\n  /** Container element or selector */\n  container: string | HTMLElement;\n  /** Initial state (or will show loading) */\n  state?: ExtensionDiagnosticsState;\n  /** Callback to refresh diagnostics */\n  onRefresh?: () => Promise<ExtensionDiagnosticsState>;\n  /** Callback when pack is selected */\n  onPackSelect?: (packId: string) => void;\n  /** Callback when error is selected */\n  onErrorSelect?: (error: ExtensionError) => void;\n}\n\n// =============================================================================\n// Status Configuration\n// =============================================================================\n\nconst STATUS_CONFIG: Record<ExtensionStatus, { label: string; bg: string; text: string; icon: string }> = {\n  active: { label: 'Active', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  degraded: { label: 'Degraded', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'iconoir:warning-triangle' },\n  errored: { label: 'Error', bg: 'bg-red-100', text: 'text-red-700', icon: 'iconoir:warning-circle' },\n  disabled: { label: 'Disabled', bg: 'bg-gray-100', text: 'text-gray-500', icon: 'iconoir:cancel' },\n};\n\nconst HEALTH_CONFIG: Record<ConfigHealth['status'], { label: string; bg: string; text: string; icon: string }> = {\n  healthy: { label: 'Healthy', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  warning: { label: 'Warnings', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'iconoir:warning-triangle' },\n  error: { label: 'Errors', bg: 'bg-red-100', text: 'text-red-700', icon: 'iconoir:warning-circle' },\n};\n\n// =============================================================================\n// Extension Diagnostics Panel\n// =============================================================================\n\n/**\n * Renders extension diagnostics panel.\n */\nexport class ExtensionDiagnosticsPanel {\n  private config: ExtensionDiagnosticsPanelConfig;\n  private container: HTMLElement | null = null;\n  private state: ExtensionDiagnosticsState | null = null;\n  private loading = false;\n\n  constructor(config: ExtensionDiagnosticsPanelConfig) {\n    this.config = config;\n    this.state = config.state || null;\n  }\n\n  /**\n   * Initialize the panel.\n   */\n  init(): void {\n    this.container = typeof this.config.container === 'string'\n      ? document.querySelector<HTMLElement>(this.config.container)\n      : this.config.container;\n\n    if (!this.container) {\n      console.error('[ExtensionDiagnostics] Container not found');\n      return;\n    }\n\n    this.render();\n    this.bindEvents();\n  }\n\n  /**\n   * Update state and re-render.\n   */\n  setState(state: ExtensionDiagnosticsState): void {\n    this.state = state;\n    this.render();\n    this.bindEvents();\n  }\n\n  /**\n   * Refresh diagnostics data.\n   */\n  async refresh(): Promise<void> {\n    if (!this.config.onRefresh || this.loading) return;\n\n    this.loading = true;\n    this.updateRefreshButton();\n\n    try {\n      const newState = await this.config.onRefresh();\n      this.setState(newState);\n    } finally {\n      this.loading = false;\n      this.updateRefreshButton();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rendering\n  // ---------------------------------------------------------------------------\n\n  private render(): void {\n    if (!this.container) return;\n\n    if (!this.state) {\n      this.container.innerHTML = this.renderLoading();\n      return;\n    }\n\n    this.container.innerHTML = `\n      <div class=\"extension-diagnostics space-y-6\">\n        <!-- Header -->\n        <div class=\"flex items-center justify-between\">\n          <div>\n            <h2 class=\"text-lg font-semibold text-gray-900\">Extension Diagnostics</h2>\n            <p class=\"text-sm text-gray-500 mt-0.5\">\n              Runtime v${escapeHtml(this.state.runtimeVersion)} &middot;\n              Worker ${this.state.workerStatus}\n            </p>\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <span class=\"text-xs text-gray-400\">\n              Last updated: ${this.formatTime(this.state.lastRefreshedAt)}\n            </span>\n            <button type=\"button\"\n                    class=\"diagnostics-refresh px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-1.5\">\n              ${renderIcon('iconoir:refresh', { size: '16px' })}\n              Refresh\n            </button>\n          </div>\n        </div>\n\n        <!-- Summary Cards -->\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          ${this.renderSummaryCard('Packs', this.state.packs.length, this.countByStatus(this.state.packs))}\n          ${this.renderSummaryCard('Hooks', this.state.hooks.length, this.countHookStatus(this.state.hooks))}\n          ${this.renderConfigHealthCard()}\n          ${this.renderErrorsCard()}\n        </div>\n\n        <!-- Provider Packs -->\n        <div class=\"bg-white rounded-lg border border-gray-200\">\n          <div class=\"px-4 py-3 border-b border-gray-200\">\n            <h3 class=\"text-base font-medium text-gray-900\">Provider Packs</h3>\n          </div>\n          <div class=\"divide-y divide-gray-100\">\n            ${this.state.packs.length === 0\n              ? this.renderEmptyState('No provider packs registered')\n              : this.state.packs.map(pack => this.renderPackRow(pack)).join('')\n            }\n          </div>\n        </div>\n\n        <!-- Hooks -->\n        <div class=\"bg-white rounded-lg border border-gray-200\">\n          <div class=\"px-4 py-3 border-b border-gray-200\">\n            <h3 class=\"text-base font-medium text-gray-900\">Registered Hooks</h3>\n          </div>\n          <div class=\"divide-y divide-gray-100\">\n            ${this.state.hooks.length === 0\n              ? this.renderEmptyState('No hooks registered')\n              : this.state.hooks.map(hook => this.renderHookRow(hook)).join('')\n            }\n          </div>\n        </div>\n\n        <!-- Recent Errors -->\n        ${this.state.recentErrors.length > 0 ? `\n          <div class=\"bg-white rounded-lg border border-red-200\">\n            <div class=\"px-4 py-3 border-b border-red-200 bg-red-50\">\n              <h3 class=\"text-base font-medium text-red-900 flex items-center gap-2\">\n                ${renderIcon('iconoir:warning-circle', { size: '18px' })}\n                Recent Errors (${this.state.recentErrors.length})\n              </h3>\n            </div>\n            <div class=\"divide-y divide-gray-100 max-h-96 overflow-y-auto\">\n              ${this.state.recentErrors.map(error => this.renderErrorRow(error)).join('')}\n            </div>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  private renderLoading(): string {\n    return `\n      <div class=\"flex items-center justify-center py-12\">\n        <div class=\"animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full\"></div>\n        <span class=\"ml-3 text-gray-600\">Loading diagnostics...</span>\n      </div>\n    `;\n  }\n\n  private renderSummaryCard(title: string, total: number, statusCounts: Record<string, number>): string {\n    const hasIssues = (statusCounts.errored || 0) > 0 || (statusCounts.degraded || 0) > 0;\n    const borderClass = hasIssues ? 'border-amber-200' : 'border-gray-200';\n\n    return `\n      <div class=\"bg-white rounded-lg border ${borderClass} p-4\">\n        <div class=\"flex items-center justify-between\">\n          <span class=\"text-sm font-medium text-gray-500\">${title}</span>\n          <span class=\"text-2xl font-semibold text-gray-900\">${total}</span>\n        </div>\n        <div class=\"flex items-center gap-2 mt-2\">\n          ${Object.entries(statusCounts).map(([status, count]) => {\n            const config = STATUS_CONFIG[status as ExtensionStatus];\n            return count > 0 ? `\n              <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs ${config.bg} ${config.text}\">\n                ${count} ${config.label.toLowerCase()}\n              </span>\n            ` : '';\n          }).join('')}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderConfigHealthCard(): string {\n    if (!this.state) return '';\n\n    const health = this.state.configHealth;\n    const config = HEALTH_CONFIG[health.status];\n\n    return `\n      <div class=\"bg-white rounded-lg border ${health.status === 'healthy' ? 'border-gray-200' : 'border-amber-200'} p-4\">\n        <div class=\"flex items-center justify-between\">\n          <span class=\"text-sm font-medium text-gray-500\">Config Health</span>\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs ${config.bg} ${config.text}\">\n            ${renderIcon(config.icon, { size: '12px' })}\n            ${config.label}\n          </span>\n        </div>\n        ${health.issues.length > 0 ? `\n          <div class=\"mt-2\">\n            <span class=\"text-sm text-gray-600\">${health.issues.length} issue${health.issues.length > 1 ? 's' : ''}</span>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  private renderErrorsCard(): string {\n    if (!this.state) return '';\n\n    const errorCount = this.state.recentErrors.length;\n    const hasErrors = errorCount > 0;\n\n    return `\n      <div class=\"bg-white rounded-lg border ${hasErrors ? 'border-red-200' : 'border-gray-200'} p-4\">\n        <div class=\"flex items-center justify-between\">\n          <span class=\"text-sm font-medium text-gray-500\">Recent Errors</span>\n          <span class=\"text-2xl font-semibold ${hasErrors ? 'text-red-600' : 'text-gray-900'}\">${errorCount}</span>\n        </div>\n        ${hasErrors ? `\n          <div class=\"mt-2\">\n            <span class=\"text-sm text-red-600\">Requires attention</span>\n          </div>\n        ` : `\n          <div class=\"mt-2\">\n            <span class=\"text-sm text-green-600\">No recent errors</span>\n          </div>\n        `}\n      </div>\n    `;\n  }\n\n  private renderPackRow(pack: ProviderPackInfo): string {\n    const status = STATUS_CONFIG[pack.status];\n\n    return `\n      <div class=\"pack-row px-4 py-3 hover:bg-gray-50 cursor-pointer\" data-pack-id=\"${escapeHtml(pack.id)}\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"text-sm font-medium text-gray-900\">${escapeHtml(pack.name)}</span>\n              <span class=\"text-xs text-gray-400\">v${escapeHtml(pack.version)}</span>\n              <span class=\"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs ${status.bg} ${status.text}\">\n                ${renderIcon(status.icon, { size: '10px' })}\n                ${status.label}\n              </span>\n            </div>\n            <div class=\"flex items-center gap-4 mt-1 text-xs text-gray-500\">\n              <span>${pack.providers.length} provider${pack.providers.length !== 1 ? 's' : ''}</span>\n              <span>${pack.capabilities.length} capabilit${pack.capabilities.length !== 1 ? 'ies' : 'y'}</span>\n              <span>${pack.hooks.length} hook${pack.hooks.length !== 1 ? 's' : ''}</span>\n            </div>\n          </div>\n          <div class=\"flex items-center gap-2\">\n            ${pack.lastError ? `\n              <span class=\"text-xs text-red-600 truncate max-w-48\" title=\"${escapeHtml(pack.lastError)}\">\n                ${escapeHtml(pack.lastError.slice(0, 50))}${pack.lastError.length > 50 ? '...' : ''}\n              </span>\n            ` : ''}\n            ${renderIcon('iconoir:nav-arrow-right', { size: '16px', extraClass: 'text-gray-400' })}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderHookRow(hook: HookInfo): string {\n    const successRate = hook.executionCount > 0\n      ? Math.round(((hook.executionCount - hook.failureCount) / hook.executionCount) * 100)\n      : 100;\n\n    return `\n      <div class=\"px-4 py-3\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"text-sm font-medium text-gray-900\">${escapeHtml(hook.name)}</span>\n              <span class=\"text-xs text-gray-400\">from ${escapeHtml(hook.sourcePack)}</span>\n              ${hook.enabled\n                ? '<span class=\"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-green-100 text-green-700\">Enabled</span>'\n                : '<span class=\"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-gray-100 text-gray-500\">Disabled</span>'\n              }\n            </div>\n            <div class=\"flex items-center gap-4 mt-1 text-xs text-gray-500\">\n              <span>${hook.executionCount} executions</span>\n              <span class=\"${successRate < 90 ? 'text-amber-600' : ''}\">${successRate}% success rate</span>\n              ${hook.lastExecutionAt ? `<span>Last: ${this.formatTime(hook.lastExecutionAt)}</span>` : ''}\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderErrorRow(error: ExtensionError): string {\n    return `\n      <div class=\"error-row px-4 py-3 hover:bg-red-50 cursor-pointer\" data-error-id=\"${escapeHtml(error.id)}\">\n        <div class=\"flex items-start gap-3\">\n          <div class=\"flex-shrink-0 mt-0.5\">\n            ${renderIcon('iconoir:warning-circle', { size: '16px', extraClass: 'text-red-500' })}\n          </div>\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"text-sm font-medium text-red-800\">${escapeHtml(error.type)}</span>\n              <span class=\"text-xs text-gray-400\">from ${escapeHtml(error.packId)}</span>\n            </div>\n            <p class=\"text-sm text-gray-700 mt-0.5\">${escapeHtml(error.message)}</p>\n            <div class=\"flex items-center gap-3 mt-1 text-xs text-gray-500\">\n              <span>${this.formatTime(error.occurredAt)}</span>\n              ${error.relatedEntity ? `\n                <span>${escapeHtml(error.relatedEntity.type)}:${escapeHtml(error.relatedEntity.id)}</span>\n              ` : ''}\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderEmptyState(message: string): string {\n    return `\n      <div class=\"px-4 py-8 text-center\">\n        <p class=\"text-sm text-gray-500\">${escapeHtml(message)}</p>\n      </div>\n    `;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Event Binding\n  // ---------------------------------------------------------------------------\n\n  private bindEvents(): void {\n    if (!this.container) return;\n\n    // Refresh button\n    const refreshBtn = this.container.querySelector('.diagnostics-refresh');\n    refreshBtn?.addEventListener('click', () => this.refresh());\n\n    // Pack rows\n    this.container.querySelectorAll<HTMLElement>('.pack-row').forEach(row => {\n      row.addEventListener('click', () => {\n        const packId = row.dataset.packId;\n        if (packId && this.config.onPackSelect) {\n          this.config.onPackSelect(packId);\n        }\n      });\n    });\n\n    // Error rows\n    this.container.querySelectorAll<HTMLElement>('.error-row').forEach(row => {\n      row.addEventListener('click', () => {\n        const errorId = row.dataset.errorId;\n        const error = this.state?.recentErrors.find(e => e.id === errorId);\n        if (error && this.config.onErrorSelect) {\n          this.config.onErrorSelect(error);\n        }\n      });\n    });\n  }\n\n  private updateRefreshButton(): void {\n    const btn = this.container?.querySelector<HTMLButtonElement>('.diagnostics-refresh');\n    if (btn) {\n      btn.disabled = this.loading;\n      const icon = btn.querySelector('svg');\n      if (icon) {\n        icon.classList.toggle('animate-spin', this.loading);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private countByStatus(packs: ProviderPackInfo[]): Record<string, number> {\n    const counts: Record<string, number> = {};\n    for (const pack of packs) {\n      counts[pack.status] = (counts[pack.status] || 0) + 1;\n    }\n    return counts;\n  }\n\n  private countHookStatus(hooks: HookInfo[]): Record<string, number> {\n    let enabled = 0;\n    let disabled = 0;\n    for (const hook of hooks) {\n      if (hook.enabled) enabled++;\n      else disabled++;\n    }\n    return { active: enabled, disabled };\n  }\n\n  private formatTime(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n\n    if (diffMins < 1) return 'just now';\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n\n    return date.toLocaleDateString();\n  }\n}\n\n// =============================================================================\n// State Source Indicators (Task 7.9)\n// =============================================================================\n\n/** Source of state data */\nexport type StateSource = 'go-services' | 'downstream' | 'mixed';\n\n/** Configuration for state source indicator */\nexport interface StateSourceIndicatorConfig {\n  /** The source of the state */\n  source: StateSource;\n  /** Optional pack name for downstream state */\n  packName?: string;\n  /** Whether to show as inline badge or tooltip */\n  mode?: 'badge' | 'tooltip';\n  /** Additional context */\n  context?: string;\n}\n\n/**\n * Render a state source indicator to help operators distinguish\n * between go-services primitive state and downstream domain-package state.\n */\nexport function renderStateSourceIndicator(config: StateSourceIndicatorConfig): string {\n  const { source, packName, mode = 'badge', context } = config;\n\n  const sourceConfig: Record<StateSource, { label: string; bg: string; text: string; icon: string; description: string }> = {\n    'go-services': {\n      label: 'Core',\n      bg: 'bg-blue-50',\n      text: 'text-blue-700',\n      icon: 'iconoir:box-3d-center',\n      description: 'Managed by go-services core',\n    },\n    'downstream': {\n      label: packName || 'Extension',\n      bg: 'bg-purple-50',\n      text: 'text-purple-700',\n      icon: 'iconoir:plug',\n      description: `Managed by ${packName || 'downstream extension'}`,\n    },\n    'mixed': {\n      label: 'Mixed',\n      bg: 'bg-gray-50',\n      text: 'text-gray-700',\n      icon: 'iconoir:layers',\n      description: 'Combination of core and extension data',\n    },\n  };\n\n  const cfg = sourceConfig[source];\n\n  if (mode === 'tooltip') {\n    return `\n      <span class=\"state-source-indicator inline-flex items-center\"\n            title=\"${escapeHtml(cfg.description)}${context ? ` - ${context}` : ''}\"\n            aria-label=\"${escapeHtml(cfg.description)}\">\n        ${renderIcon(cfg.icon, { size: '14px', extraClass: cfg.text })}\n      </span>\n    `;\n  }\n\n  return `\n    <span class=\"state-source-indicator inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${cfg.bg} ${cfg.text}\"\n          title=\"${escapeHtml(cfg.description)}${context ? ` - ${context}` : ''}\"\n          role=\"note\"\n          aria-label=\"State source: ${escapeHtml(cfg.description)}\">\n      ${renderIcon(cfg.icon, { size: '12px' })}\n      <span>${escapeHtml(cfg.label)}</span>\n    </span>\n  `;\n}\n\n/**\n * Add state source indicator to a field/section.\n */\nexport function addStateSourceIndicator(\n  container: HTMLElement,\n  config: StateSourceIndicatorConfig\n): void {\n  const indicator = document.createElement('span');\n  indicator.innerHTML = renderStateSourceIndicator(config);\n  container.appendChild(indicator.firstElementChild as HTMLElement);\n}\n\n/**\n * Create a legend for state source indicators (for documentation/help).\n */\nexport function renderStateSourceLegend(): string {\n  return `\n    <div class=\"state-source-legend p-4 bg-gray-50 rounded-lg border border-gray-200\">\n      <h4 class=\"text-sm font-medium text-gray-900 mb-3\">State Source Legend</h4>\n      <div class=\"space-y-2\">\n        <div class=\"flex items-center gap-3\">\n          ${renderStateSourceIndicator({ source: 'go-services' })}\n          <span class=\"text-sm text-gray-600\">Data managed by go-services core runtime</span>\n        </div>\n        <div class=\"flex items-center gap-3\">\n          ${renderStateSourceIndicator({ source: 'downstream', packName: 'Extension' })}\n          <span class=\"text-sm text-gray-600\">Data managed by an installed extension package</span>\n        </div>\n        <div class=\"flex items-center gap-3\">\n          ${renderStateSourceIndicator({ source: 'mixed' })}\n          <span class=\"text-sm text-gray-600\">Combination of core and extension-managed data</span>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n// =============================================================================\n// Helpers\n// =============================================================================\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n","/**\n * Providers Catalog Page\n * Displays available service providers with capability summaries and connect actions\n */\n\nimport type { Provider, ProviderCapability, ScopeType } from '../types.js';\nimport { getServicesClient } from '../api-client.js';\nimport { getPermissionManager, canConnect, canViewServices } from '../permissions.js';\nimport {\n  renderForbiddenState,\n  renderLoadingState,\n  renderErrorState,\n  renderEmptyState,\n} from '../ui-states.js';\nimport type { ToastNotifier } from '../../toast/types.js';\nimport { renderIcon } from '../../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface ProvidersPageConfig {\n  /** Container element or selector */\n  container: string | HTMLElement;\n  /** API base path (default: /admin/api/services) */\n  apiBasePath?: string;\n  /** Toast notifier for messages */\n  notifier?: ToastNotifier;\n  /** Callback when connect is initiated */\n  onConnect?: (provider: Provider, scope: ScopeType) => void;\n  /** Callback when provider is selected for details */\n  onSelect?: (provider: Provider) => void;\n  /** Custom provider icon resolver */\n  getProviderIcon?: (providerId: string) => string;\n  /** Custom provider display name resolver */\n  getProviderName?: (providerId: string) => string;\n}\n\nexport interface ProviderCardData {\n  provider: Provider;\n  displayName: string;\n  icon: string;\n  description: string;\n  capabilityCount: number;\n  canConnect: boolean;\n}\n\n// =============================================================================\n// Default Icon Mapping\n// =============================================================================\n\nconst PROVIDER_ICONS: Record<string, string> = {\n  github: 'iconoir:github',\n  google: 'iconoir:google',\n  gmail: 'iconoir:mail',\n  drive: 'iconoir:folder',\n  docs: 'iconoir:page',\n  calendar: 'iconoir:calendar',\n  slack: 'iconoir:chat-bubble',\n  dropbox: 'iconoir:cloud',\n  microsoft: 'iconoir:microsoft',\n  outlook: 'iconoir:mail',\n  teams: 'iconoir:group',\n  onedrive: 'iconoir:cloud',\n  default: 'iconoir:plugin',\n};\n\nconst PROVIDER_NAMES: Record<string, string> = {\n  github: 'GitHub',\n  google: 'Google',\n  gmail: 'Gmail',\n  drive: 'Google Drive',\n  docs: 'Google Docs',\n  calendar: 'Google Calendar',\n  slack: 'Slack',\n  dropbox: 'Dropbox',\n  microsoft: 'Microsoft',\n  outlook: 'Outlook',\n  teams: 'Microsoft Teams',\n  onedrive: 'OneDrive',\n};\n\n// =============================================================================\n// Providers Catalog Manager\n// =============================================================================\n\nexport class ProvidersCatalogManager {\n  private config: ProvidersPageConfig;\n  private container: HTMLElement | null = null;\n  private providers: Provider[] = [];\n  private loading = false;\n  private error: Error | null = null;\n\n  constructor(config: ProvidersPageConfig) {\n    this.config = config;\n  }\n\n  /**\n   * Initialize the providers catalog\n   */\n  async init(): Promise<void> {\n    // Resolve container\n    this.container =\n      typeof this.config.container === 'string'\n        ? document.querySelector<HTMLElement>(this.config.container)\n        : this.config.container;\n\n    if (!this.container) {\n      console.error('[ProvidersCatalog] Container not found:', this.config.container);\n      return;\n    }\n\n    // Check view permission\n    if (!canViewServices()()) {\n      this.renderForbidden();\n      return;\n    }\n\n    // Load providers\n    await this.loadProviders();\n  }\n\n  /**\n   * Refresh the providers list\n   */\n  async refresh(): Promise<void> {\n    await this.loadProviders();\n  }\n\n  /**\n   * Get the loaded providers\n   */\n  getProviders(): Provider[] {\n    return [...this.providers];\n  }\n\n  /**\n   * Get a provider by ID\n   */\n  getProvider(id: string): Provider | undefined {\n    return this.providers.find((p) => p.id === id);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Methods\n  // ---------------------------------------------------------------------------\n\n  private async loadProviders(): Promise<void> {\n    if (!this.container) return;\n\n    this.loading = true;\n    this.error = null;\n    this.renderLoading();\n\n    try {\n      const client = getServicesClient();\n      const response = await client.listProviders();\n      this.providers = response.providers || [];\n      this.renderProviders();\n    } catch (err) {\n      this.error = err instanceof Error ? err : new Error(String(err));\n      this.renderError();\n\n      if (this.config.notifier) {\n        this.config.notifier.error(`Failed to load providers: ${this.error.message}`);\n      }\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  private renderLoading(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderLoadingState({\n      text: 'Loading providers...',\n      size: 'lg',\n    });\n  }\n\n  private renderError(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderErrorState({\n      title: 'Failed to load providers',\n      error: this.error,\n      showRetry: true,\n    });\n\n    // Bind retry button\n    const retryBtn = this.container.querySelector('.ui-state-retry-btn');\n    retryBtn?.addEventListener('click', () => this.loadProviders());\n  }\n\n  private renderForbidden(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderForbiddenState({\n      resource: 'service providers',\n    });\n  }\n\n  private renderProviders(): void {\n    if (!this.container) return;\n\n    if (this.providers.length === 0) {\n      this.renderEmpty();\n      return;\n    }\n\n    const cards = this.providers.map((provider) => this.buildProviderCard(provider));\n\n    this.container.innerHTML = `\n      <div class=\"providers-catalog-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n        ${cards.join('')}\n      </div>\n    `;\n\n    // Bind card events\n    this.bindCardEvents();\n  }\n\n  private renderEmpty(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderEmptyState({\n      type: 'providers',\n    });\n  }\n\n  private buildProviderCard(provider: Provider): string {\n    const data = this.getProviderCardData(provider);\n    const userCanConnect = canConnect()() && provider.supported_scope_types.includes('user');\n    const orgCanConnect = canConnect()() && provider.supported_scope_types.includes('org');\n\n    const capabilitySummary = this.buildCapabilitySummary(provider.capabilities);\n    const scopeBadges = this.buildScopeBadges(provider.supported_scope_types);\n\n    return `\n      <div class=\"provider-card bg-white rounded-lg border border-gray-200 hover:border-gray-300 hover:shadow-sm transition-all cursor-pointer\"\n           data-provider-id=\"${this.escapeHtml(provider.id)}\">\n        <div class=\"p-4\">\n          <!-- Header -->\n          <div class=\"flex items-start justify-between gap-3\">\n            <div class=\"flex items-center gap-3\">\n              <div class=\"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center flex-shrink-0\">\n                ${renderIcon(data.icon, { size: '20px', extraClass: 'text-gray-600' })}\n              </div>\n              <div>\n                <h3 class=\"text-sm font-semibold text-gray-900\">${this.escapeHtml(data.displayName)}</h3>\n                <span class=\"text-xs text-gray-500\">${this.escapeHtml(provider.auth_kind)}</span>\n              </div>\n            </div>\n            ${scopeBadges}\n          </div>\n\n          <!-- Capabilities -->\n          <div class=\"mt-3\">\n            <div class=\"text-xs text-gray-500 mb-1.5\">Capabilities (${data.capabilityCount})</div>\n            ${capabilitySummary}\n          </div>\n        </div>\n\n        <!-- Actions -->\n        <div class=\"px-4 py-3 bg-gray-50 border-t border-gray-100 rounded-b-lg\">\n          <div class=\"flex items-center gap-2\">\n            ${userCanConnect ? `\n              <button type=\"button\"\n                      class=\"provider-connect-btn flex-1 px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors\"\n                      data-provider-id=\"${this.escapeHtml(provider.id)}\"\n                      data-scope-type=\"user\">\n                Connect as User\n              </button>\n            ` : ''}\n            ${orgCanConnect ? `\n              <button type=\"button\"\n                      class=\"provider-connect-btn flex-1 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors\"\n                      data-provider-id=\"${this.escapeHtml(provider.id)}\"\n                      data-scope-type=\"org\">\n                Connect Org\n              </button>\n            ` : ''}\n            ${!userCanConnect && !orgCanConnect ? `\n              <span class=\"text-xs text-gray-400 italic\">Connect permission required</span>\n            ` : ''}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private buildCapabilitySummary(capabilities: ProviderCapability[]): string {\n    if (capabilities.length === 0) {\n      return '<span class=\"text-xs text-gray-400\">No capabilities defined</span>';\n    }\n\n    const maxVisible = 4;\n    const visible = capabilities.slice(0, maxVisible);\n    const hidden = capabilities.length - maxVisible;\n\n    let html = '<div class=\"flex flex-wrap gap-1\">';\n\n    for (const cap of visible) {\n      const [category, action] = cap.name.split('.');\n      html += `\n        <span class=\"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600\"\n              title=\"${this.escapeHtml(cap.name)}\">\n          ${this.escapeHtml(action || cap.name)}\n        </span>\n      `;\n    }\n\n    if (hidden > 0) {\n      html += `<span class=\"text-xs text-gray-400\">+${hidden} more</span>`;\n    }\n\n    html += '</div>';\n    return html;\n  }\n\n  private buildScopeBadges(scopes: ScopeType[]): string {\n    return `\n      <div class=\"flex gap-1\">\n        ${scopes.map((scope) => `\n          <span class=\"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${\n            scope === 'user' ? 'bg-blue-50 text-blue-600' : 'bg-purple-50 text-purple-600'\n          }\">\n            ${scope}\n          </span>\n        `).join('')}\n      </div>\n    `;\n  }\n\n  private getProviderCardData(provider: Provider): ProviderCardData {\n    const displayName = this.config.getProviderName\n      ? this.config.getProviderName(provider.id)\n      : PROVIDER_NAMES[provider.id.toLowerCase()] || this.formatProviderId(provider.id);\n\n    const icon = this.config.getProviderIcon\n      ? this.config.getProviderIcon(provider.id)\n      : PROVIDER_ICONS[provider.id.toLowerCase()] || PROVIDER_ICONS.default;\n\n    return {\n      provider,\n      displayName,\n      icon,\n      description: `${provider.auth_kind} authentication`,\n      capabilityCount: provider.capabilities.length,\n      canConnect: canConnect()(),\n    };\n  }\n\n  private formatProviderId(id: string): string {\n    return id\n      .split(/[-_]/)\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  }\n\n  private bindCardEvents(): void {\n    if (!this.container) return;\n\n    // Card click for details\n    const cards = this.container.querySelectorAll<HTMLElement>('.provider-card');\n    cards.forEach((card) => {\n      card.addEventListener('click', (e) => {\n        // Ignore if clicking a button\n        if ((e.target as HTMLElement).closest('button')) return;\n\n        const providerId = card.dataset.providerId;\n        if (providerId) {\n          const provider = this.getProvider(providerId);\n          if (provider && this.config.onSelect) {\n            this.config.onSelect(provider);\n          }\n        }\n      });\n    });\n\n    // Connect buttons\n    const connectBtns = this.container.querySelectorAll<HTMLButtonElement>('.provider-connect-btn');\n    connectBtns.forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        e.stopPropagation();\n\n        const providerId = btn.dataset.providerId;\n        const scopeType = btn.dataset.scopeType as ScopeType;\n\n        if (providerId && scopeType) {\n          const provider = this.getProvider(providerId);\n          if (provider && this.config.onConnect) {\n            this.config.onConnect(provider, scopeType);\n          }\n        }\n      });\n    });\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create and initialize a providers catalog\n */\nexport async function createProvidersCatalog(\n  config: ProvidersPageConfig\n): Promise<ProvidersCatalogManager> {\n  const manager = new ProvidersCatalogManager(config);\n  await manager.init();\n  return manager;\n}\n","/**\n * Connections List Page\n * Displays service connections with filters, pagination, and management actions\n */\n\nimport type {\n  Connection,\n  ConnectionStatus,\n  ConnectionsListFilter,\n  Provider,\n  ScopeType,\n} from '../types.js';\nimport { getServicesClient, type ServicesAPIClient } from '../api-client.js';\nimport { QueryStateManager, type QueryState } from '../query-state.js';\nimport {\n  getPermissionManager,\n  canViewServices,\n  canConnect,\n  canEdit,\n  canRevoke,\n  canReconsent,\n} from '../permissions.js';\nimport {\n  renderForbiddenState,\n  renderTableLoadingState,\n  renderTableErrorState,\n  renderTableEmptyState,\n  renderTableNoResultsState,\n} from '../ui-states.js';\nimport {\n  withMutationFeedback,\n  confirmServiceAction,\n  ActionQueue,\n  MutationButtonManager,\n} from '../mutation-feedback.js';\nimport type { ToastNotifier } from '../../toast/types.js';\nimport { renderIcon } from '../../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface ConnectionsListConfig {\n  /** Container element or selector */\n  container: string | HTMLElement;\n  /** API client (optional, uses default) */\n  apiClient?: ServicesAPIClient;\n  /** Toast notifier for messages */\n  notifier?: ToastNotifier;\n  /** Items per page (default: 25) */\n  perPage?: number;\n  /** Enable URL state sync (default: true) */\n  syncUrl?: boolean;\n  /** Callback when connection is selected */\n  onSelect?: (connection: Connection) => void;\n  /** Callback when connect action is triggered */\n  onConnect?: (providerId: string, scopeType: ScopeType) => void;\n  /** Custom provider name resolver */\n  getProviderName?: (providerId: string) => string;\n}\n\ninterface ConnectionsListState {\n  connections: Connection[];\n  providers: Provider[];\n  total: number;\n  loading: boolean;\n  error: Error | null;\n}\n\ntype ConnectionsFilter = {\n  provider_id: string;\n  scope_type: string;\n  scope_id: string;\n  status: string;\n};\n\n// =============================================================================\n// Status Configuration\n// =============================================================================\n\nconst STATUS_CONFIG: Record<ConnectionStatus, { label: string; bg: string; text: string; icon: string }> = {\n  active: { label: 'Active', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  disconnected: { label: 'Disconnected', bg: 'bg-gray-100', text: 'text-gray-600', icon: 'iconoir:cancel' },\n  errored: { label: 'Error', bg: 'bg-red-100', text: 'text-red-700', icon: 'iconoir:warning-circle' },\n  pending_reauth: { label: 'Pending Reauth', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'iconoir:clock' },\n  needs_reconsent: { label: 'Needs Reconsent', bg: 'bg-orange-100', text: 'text-orange-700', icon: 'iconoir:refresh' },\n};\n\n// =============================================================================\n// Connections List Manager\n// =============================================================================\n\nexport class ConnectionsListManager {\n  private config: ConnectionsListConfig;\n  private container: HTMLElement | null = null;\n  private client: ServicesAPIClient;\n  private queryState: QueryStateManager<ConnectionsFilter>;\n  private state: ConnectionsListState = {\n    connections: [],\n    providers: [],\n    total: 0,\n    loading: false,\n    error: null,\n  };\n  private abortController: AbortController | null = null;\n  private actionQueue = new ActionQueue();\n\n  constructor(config: ConnectionsListConfig) {\n    this.config = {\n      perPage: 25,\n      syncUrl: true,\n      ...config,\n    };\n    this.client = config.apiClient || getServicesClient();\n\n    this.queryState = new QueryStateManager<ConnectionsFilter>({\n      config: {\n        defaultPerPage: this.config.perPage,\n        onChange: () => this.loadConnections(),\n      },\n      filterFields: ['provider_id', 'scope_type', 'scope_id', 'status'],\n      storageKey: 'services-connections-list',\n    });\n  }\n\n  /**\n   * Initialize the connections list\n   */\n  async init(): Promise<void> {\n    // Resolve container\n    this.container =\n      typeof this.config.container === 'string'\n        ? document.querySelector<HTMLElement>(this.config.container)\n        : this.config.container;\n\n    if (!this.container) {\n      console.error('[ConnectionsList] Container not found:', this.config.container);\n      return;\n    }\n\n    // Check view permission\n    if (!canViewServices()()) {\n      this.renderForbidden();\n      return;\n    }\n\n    // Initialize query state from URL\n    this.queryState.init();\n\n    // Render initial structure\n    this.renderStructure();\n    await this.loadProviders();\n    this.bindEvents();\n\n    // Load connections\n    await this.loadConnections();\n  }\n\n  /**\n   * Refresh the connections list\n   */\n  async refresh(): Promise<void> {\n    await this.loadConnections();\n  }\n\n  /**\n   * Get the current connections\n   */\n  getConnections(): Connection[] {\n    return [...this.state.connections];\n  }\n\n  /**\n   * Get a connection by ID\n   */\n  getConnection(id: string): Connection | undefined {\n    return this.state.connections.find((c) => c.id === id);\n  }\n\n  /**\n   * Destroy the manager\n   */\n  destroy(): void {\n    this.abortController?.abort();\n    this.queryState.destroy();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Data Loading\n  // ---------------------------------------------------------------------------\n\n  private async loadConnections(): Promise<void> {\n    if (!this.container) return;\n\n    // Cancel previous request\n    this.abortController?.abort();\n    this.abortController = new AbortController();\n\n    this.state.loading = true;\n    this.state.error = null;\n    this.updateLoadingState();\n\n    try {\n      const params = this.queryState.getQueryParams();\n      const filter: ConnectionsListFilter = {\n        provider_id: params.provider_id as string | undefined,\n        scope_type: params.scope_type as ScopeType | undefined,\n        scope_id: params.scope_id as string | undefined,\n        status: params.status as ConnectionStatus | undefined,\n        q: params.q as string | undefined,\n        page: params.page as number,\n        per_page: params.per_page as number,\n      };\n\n      const response = await this.client.listConnections(filter, this.abortController.signal);\n\n      this.state.connections = response.connections;\n      this.state.total = response.total;\n      this.queryState.updateFromResponse(response.total, response.has_next);\n\n      this.renderConnections();\n      this.updatePagination();\n    } catch (err) {\n      if ((err as Error).name === 'AbortError') return;\n\n      this.state.error = err instanceof Error ? err : new Error(String(err));\n      this.renderError();\n\n      if (this.config.notifier) {\n        this.config.notifier.error(`Failed to load connections: ${this.state.error.message}`);\n      }\n    } finally {\n      this.state.loading = false;\n      this.updateLoadingState();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rendering\n  // ---------------------------------------------------------------------------\n\n  private renderStructure(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = `\n      <div class=\"connections-list\">\n        <!-- Filters -->\n        <div class=\"connections-filters flex flex-wrap items-center gap-3 mb-4\">\n          <div class=\"flex-1 min-w-[200px]\">\n            <input type=\"text\"\n                   class=\"connections-search w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                   placeholder=\"Search connections...\"\n                   data-filter=\"search\">\n          </div>\n\n          <select class=\"connections-filter-provider px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  data-filter=\"provider_id\">\n            <option value=\"\">All Providers</option>\n          </select>\n\n          <select class=\"connections-filter-scope px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  data-filter=\"scope_type\">\n            <option value=\"\">All Scopes</option>\n            <option value=\"user\">User</option>\n            <option value=\"org\">Organization</option>\n          </select>\n\n          <select class=\"connections-filter-status px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  data-filter=\"status\">\n            <option value=\"\">All Statuses</option>\n            <option value=\"active\">Active</option>\n            <option value=\"disconnected\">Disconnected</option>\n            <option value=\"errored\">Error</option>\n            <option value=\"pending_reauth\">Pending Reauth</option>\n            <option value=\"needs_reconsent\">Needs Reconsent</option>\n          </select>\n\n          <button type=\"button\"\n                  class=\"connections-reset px-3 py-2 text-sm text-gray-600 hover:text-gray-800\"\n                  title=\"Reset filters\">\n            ${renderIcon('iconoir:refresh', { size: '16px' })}\n          </button>\n          ${canConnect()() && this.config.onConnect ? `\n            <button type=\"button\"\n                    class=\"connections-connect-user px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700\">\n              Connect User\n            </button>\n            <button type=\"button\"\n                    class=\"connections-connect-org px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50\">\n              Connect Org\n            </button>\n          ` : ''}\n        </div>\n\n        <!-- Table -->\n        <div class=\"connections-table-wrapper overflow-x-auto bg-white rounded-lg border border-gray-200\">\n          <table class=\"connections-table w-full text-sm\">\n            <thead class=\"bg-gray-50 border-b border-gray-200\">\n              <tr>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Provider</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Scope</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">External Account</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Status</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Updated</th>\n                <th class=\"px-4 py-3 text-right font-medium text-gray-600\">Actions</th>\n              </tr>\n            </thead>\n            <tbody class=\"connections-tbody divide-y divide-gray-100\">\n              <!-- Connections will be rendered here -->\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Empty State -->\n        <div class=\"connections-empty hidden py-12 text-center\">\n          <div class=\"inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 mb-4\">\n            ${renderIcon('iconoir:link', { size: '24px', extraClass: 'text-gray-400' })}\n          </div>\n          <h3 class=\"text-lg font-medium text-gray-900\">No connections found</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">Connect a service to get started.</p>\n        </div>\n\n        <!-- Pagination -->\n        <div class=\"connections-pagination flex items-center justify-between mt-4\">\n          <div class=\"connections-info text-sm text-gray-500\">\n            <!-- Info will be rendered here -->\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <button type=\"button\"\n                    class=\"connections-prev px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Previous\n            </button>\n            <button type=\"button\"\n                    class=\"connections-next px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Next\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Restore filter values from state\n    this.restoreFilterValues();\n  }\n\n  private restoreFilterValues(): void {\n    const state = this.queryState.getState();\n\n    const searchInput = this.container?.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    if (searchInput) {\n      searchInput.value = state.search || '';\n    }\n\n    const filterSelects = this.container?.querySelectorAll<HTMLSelectElement>('select[data-filter]');\n    filterSelects?.forEach((select) => {\n      const filterKey = select.dataset.filter as keyof ConnectionsFilter;\n      select.value = state.filters[filterKey] || '';\n    });\n  }\n\n  private bindEvents(): void {\n    if (!this.container) return;\n\n    // Search input\n    const searchInput = this.container.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    searchInput?.addEventListener('input', (e) => {\n      this.queryState.setSearch((e.target as HTMLInputElement).value);\n    });\n\n    // Filter selects\n    const filterSelects = this.container.querySelectorAll<HTMLSelectElement>('select[data-filter]');\n    filterSelects.forEach((select) => {\n      select.addEventListener('change', () => {\n        const filterKey = select.dataset.filter as keyof ConnectionsFilter;\n        this.queryState.setFilter(filterKey, select.value || undefined);\n      });\n    });\n\n    // Reset button\n    const resetBtn = this.container.querySelector('.connections-reset');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n\n    const connectUserBtn = this.container.querySelector<HTMLButtonElement>('.connections-connect-user');\n    const connectOrgBtn = this.container.querySelector<HTMLButtonElement>('.connections-connect-org');\n    connectUserBtn?.addEventListener('click', () => this.handleConnect('user'));\n    connectOrgBtn?.addEventListener('click', () => this.handleConnect('org'));\n\n    // Pagination buttons\n    const prevBtn = this.container.querySelector('.connections-prev');\n    const nextBtn = this.container.querySelector('.connections-next');\n\n    prevBtn?.addEventListener('click', () => this.queryState.prevPage());\n    nextBtn?.addEventListener('click', () => this.queryState.nextPage());\n  }\n\n  private renderConnections(): void {\n    const tbody = this.container?.querySelector('.connections-tbody');\n    const emptyState = this.container?.querySelector('.connections-empty');\n    const tableWrapper = this.container?.querySelector('.connections-table-wrapper');\n\n    if (!tbody) return;\n\n    if (this.state.connections.length === 0) {\n      // Determine if this is \"empty\" (no data) or \"no results\" (filters applied)\n      const hasFilters = this.queryState.getActiveFilterCount() > 0 || !!this.queryState.getState().search;\n\n      if (hasFilters) {\n        // Show no-results state in the table\n        tableWrapper?.classList.remove('hidden');\n        emptyState?.classList.add('hidden');\n        tbody.innerHTML = renderTableNoResultsState(6, {\n          query: this.queryState.getState().search,\n          filterCount: this.queryState.getActiveFilterCount(),\n          onReset: () => {\n            this.queryState.reset();\n            this.restoreFilterValues();\n          },\n        });\n        this.bindNoResultsActions(tbody);\n      } else {\n        // Show empty state\n        tbody.innerHTML = '';\n        tableWrapper?.classList.add('hidden');\n        emptyState?.classList.remove('hidden');\n      }\n      return;\n    }\n\n    tableWrapper?.classList.remove('hidden');\n    emptyState?.classList.add('hidden');\n\n    tbody.innerHTML = this.state.connections.map((conn) => this.renderConnectionRow(conn)).join('');\n\n    // Bind row actions\n    this.bindRowActions();\n  }\n\n  private async loadProviders(): Promise<void> {\n    try {\n      const response = await this.client.listProviders();\n      this.state.providers = response.providers || [];\n      this.populateProviderFilterOptions();\n    } catch (err) {\n      this.state.providers = [];\n      this.config.notifier?.error(`Failed to load providers: ${(err as Error).message}`);\n    }\n  }\n\n  private populateProviderFilterOptions(): void {\n    const providerSelect = this.container?.querySelector<HTMLSelectElement>('[data-filter=\"provider_id\"]');\n    if (!providerSelect) return;\n\n    const selectedProviderId = this.queryState.getState().filters.provider_id || '';\n    const options = this.state.providers\n      .map((provider) => {\n        const displayName = this.config.getProviderName\n          ? this.config.getProviderName(provider.id)\n          : this.formatProviderId(provider.id);\n        return `<option value=\"${this.escapeHtml(provider.id)}\">${this.escapeHtml(displayName)}</option>`;\n      })\n      .join('');\n\n    providerSelect.innerHTML = `<option value=\"\">All Providers</option>${options}`;\n    providerSelect.value = selectedProviderId;\n  }\n\n  private handleConnect(scopeType: ScopeType): void {\n    if (!this.config.onConnect || !canConnect()()) return;\n\n    const providerSelect = this.container?.querySelector<HTMLSelectElement>('[data-filter=\"provider_id\"]');\n    const selectedProviderId = providerSelect?.value || '';\n    if (!selectedProviderId) {\n      this.config.notifier?.error('Select a provider before starting a connection.');\n      return;\n    }\n\n    const provider = this.state.providers.find((item) => item.id === selectedProviderId);\n    if (!provider) {\n      this.config.notifier?.error('Selected provider is no longer available.');\n      return;\n    }\n\n    if (!provider.supported_scope_types.includes(scopeType)) {\n      this.config.notifier?.error(`${this.formatProviderId(provider.id)} does not support ${scopeType} scope.`);\n      return;\n    }\n\n    this.config.onConnect(provider.id, scopeType);\n  }\n\n  private bindNoResultsActions(container: Element): void {\n    const resetBtn = container.querySelector('.ui-state-reset-btn');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n  }\n\n  private renderConnectionRow(connection: Connection): string {\n    const status = STATUS_CONFIG[connection.status] || STATUS_CONFIG.disconnected;\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(connection.provider_id)\n      : this.formatProviderId(connection.provider_id);\n\n    const updatedAt = this.formatDate(connection.updated_at);\n    const actions = this.buildRowActions(connection);\n\n    return `\n      <tr class=\"connection-row hover:bg-gray-50 cursor-pointer\" data-connection-id=\"${this.escapeHtml(connection.id)}\">\n        <td class=\"px-4 py-3\">\n          <span class=\"font-medium text-gray-900\">${this.escapeHtml(providerName)}</span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${\n            connection.scope_type === 'user' ? 'bg-blue-50 text-blue-600' : 'bg-purple-50 text-purple-600'\n          }\">\n            ${this.escapeHtml(connection.scope_type)}\n          </span>\n          <span class=\"text-gray-500 text-xs ml-1\" title=\"${this.escapeHtml(connection.scope_id)}\">\n            ${this.escapeHtml(this.truncateId(connection.scope_id))}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"text-gray-600\" title=\"${this.escapeHtml(connection.external_account_id)}\">\n            ${this.escapeHtml(this.truncateId(connection.external_account_id, 20))}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${status.bg} ${status.text}\">\n            ${renderIcon(status.icon, { size: '12px' })}\n            ${status.label}\n          </span>\n          ${connection.last_error ? `\n            <div class=\"text-xs text-red-500 mt-0.5 truncate max-w-[200px]\" title=\"${this.escapeHtml(connection.last_error)}\">\n              ${this.escapeHtml(connection.last_error)}\n            </div>\n          ` : ''}\n        </td>\n        <td class=\"px-4 py-3 text-gray-500 text-xs\">\n          ${updatedAt}\n        </td>\n        <td class=\"px-4 py-3 text-right\">\n          ${actions}\n        </td>\n      </tr>\n    `;\n  }\n\n  private buildRowActions(connection: Connection): string {\n    const actions: string[] = [];\n\n    if (connection.status === 'active' && canEdit()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"connection-action-refresh p-1 text-gray-400 hover:text-blue-600\"\n                data-action=\"refresh\"\n                title=\"Refresh credentials\">\n          ${renderIcon('iconoir:refresh', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (connection.status === 'needs_reconsent' && canReconsent()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"connection-action-reconsent p-1 text-gray-400 hover:text-orange-600\"\n                data-action=\"reconsent\"\n                title=\"Re-consent\">\n          ${renderIcon('iconoir:redo', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (connection.status !== 'disconnected' && canRevoke()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"connection-action-revoke p-1 text-gray-400 hover:text-red-600\"\n                data-action=\"revoke\"\n                title=\"Revoke connection\">\n          ${renderIcon('iconoir:cancel', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (actions.length === 0) {\n      return '<span class=\"text-gray-300 text-xs\"></span>';\n    }\n\n    return `<div class=\"flex items-center justify-end gap-1\">${actions.join('')}</div>`;\n  }\n\n  private bindRowActions(): void {\n    const rows = this.container?.querySelectorAll<HTMLTableRowElement>('.connection-row');\n\n    rows?.forEach((row) => {\n      const connectionId = row.dataset.connectionId;\n      if (!connectionId) return;\n\n      // Row click for selection\n      row.addEventListener('click', (e) => {\n        if ((e.target as HTMLElement).closest('button')) return;\n\n        const connection = this.getConnection(connectionId);\n        if (connection && this.config.onSelect) {\n          this.config.onSelect(connection);\n        }\n      });\n\n      // Action buttons\n      row.querySelectorAll<HTMLButtonElement>('button[data-action]').forEach((btn) => {\n        btn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          const action = btn.dataset.action;\n\n          switch (action) {\n            case 'refresh':\n              await this.handleRefresh(connectionId, btn);\n              break;\n            case 'reconsent':\n              await this.handleReconsent(connectionId, btn);\n              break;\n            case 'revoke':\n              await this.handleRevoke(connectionId, btn);\n              break;\n          }\n        });\n      });\n    });\n  }\n\n  private async handleRefresh(connectionId: string, button?: HTMLButtonElement): Promise<void> {\n    const connection = this.getConnection(connectionId);\n    if (!connection) return;\n\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight(`refresh-${connectionId}`)) return;\n\n    await this.actionQueue.execute(`refresh-${connectionId}`, async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.refreshConnection(connectionId, {\n          provider_id: connection.provider_id,\n        }),\n        notifier: this.config.notifier,\n        successMessage: 'Connection refresh initiated',\n        errorMessagePrefix: 'Failed to refresh',\n        buttonConfig: button ? {\n          button,\n          loadingText: 'Refreshing...',\n          successText: 'Refreshed',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.loadConnections(),\n      });\n    });\n  }\n\n  private async handleReconsent(connectionId: string, button?: HTMLButtonElement): Promise<void> {\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight(`reconsent-${connectionId}`)) return;\n\n    await this.actionQueue.execute(`reconsent-${connectionId}`, async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.beginReconsent(connectionId),\n        notifier: this.config.notifier,\n        errorMessagePrefix: 'Failed to start re-consent',\n        buttonConfig: button ? {\n          button,\n          loadingText: 'Starting...',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: (response) => {\n          if (response.begin?.authorize_url) {\n            window.location.href = response.begin.authorize_url;\n          }\n        },\n      });\n    });\n  }\n\n  private async handleRevoke(connectionId: string, button?: HTMLButtonElement): Promise<void> {\n    const connection = this.getConnection(connectionId);\n    const providerName = connection\n      ? (this.config.getProviderName\n          ? this.config.getProviderName(connection.provider_id)\n          : this.formatProviderId(connection.provider_id))\n      : undefined;\n\n    // Show confirmation dialog\n    const confirmed = await confirmServiceAction({\n      action: 'revoke',\n      resourceType: 'connection',\n      resourceName: providerName,\n    });\n    if (!confirmed) return;\n\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight(`revoke-${connectionId}`)) return;\n\n    await this.actionQueue.execute(`revoke-${connectionId}`, async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.revokeConnection(connectionId),\n        notifier: this.config.notifier,\n        successMessage: 'Connection revoked',\n        errorMessagePrefix: 'Failed to revoke',\n        buttonConfig: button ? {\n          button,\n          loadingText: 'Revoking...',\n          successText: 'Revoked',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.loadConnections(),\n      });\n    });\n  }\n\n  private renderError(): void {\n    const tbody = this.container?.querySelector('.connections-tbody');\n    const tableWrapper = this.container?.querySelector('.connections-table-wrapper');\n    const emptyState = this.container?.querySelector('.connections-empty');\n\n    if (!tbody) return;\n\n    tableWrapper?.classList.remove('hidden');\n    emptyState?.classList.add('hidden');\n\n    tbody.innerHTML = renderTableErrorState(6, {\n      title: 'Failed to load connections',\n      error: this.state.error,\n      showRetry: true,\n    });\n\n    const retryBtn = tbody.querySelector('.ui-state-retry-btn');\n    retryBtn?.addEventListener('click', () => this.loadConnections());\n  }\n\n  private renderForbidden(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderForbiddenState({\n      resource: 'connections',\n    });\n  }\n\n  private updateLoadingState(): void {\n    const tbody = this.container?.querySelector('.connections-tbody');\n    const tableWrapper = this.container?.querySelector('.connections-table-wrapper');\n    const emptyState = this.container?.querySelector('.connections-empty');\n\n    if (this.state.loading && tbody && this.state.connections.length === 0) {\n      tableWrapper?.classList.remove('hidden');\n      emptyState?.classList.add('hidden');\n      tbody.innerHTML = renderTableLoadingState(6, { text: 'Loading connections...' });\n    }\n  }\n\n  private updatePagination(): void {\n    const state = this.queryState.getState();\n    const { page, per_page } = state;\n    const { total } = this.state;\n\n    const start = total > 0 ? (page - 1) * per_page + 1 : 0;\n    const end = Math.min(page * per_page, total);\n    const hasNext = end < total;\n    const hasPrev = page > 1;\n\n    const infoEl = this.container?.querySelector('.connections-info');\n    const prevBtn = this.container?.querySelector<HTMLButtonElement>('.connections-prev');\n    const nextBtn = this.container?.querySelector<HTMLButtonElement>('.connections-next');\n\n    if (infoEl) {\n      infoEl.textContent = total > 0 ? `Showing ${start}-${end} of ${total}` : 'No connections';\n    }\n\n    if (prevBtn) {\n      prevBtn.disabled = !hasPrev;\n    }\n\n    if (nextBtn) {\n      nextBtn.disabled = !hasNext;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private formatProviderId(id: string): string {\n    return id\n      .split(/[-_]/)\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  }\n\n  private truncateId(id: string, maxLen = 12): string {\n    if (id.length <= maxLen) return id;\n    return `${id.slice(0, maxLen - 3)}...`;\n  }\n\n  private formatDate(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return 'Just now';\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n    if (diffDays < 7) return `${diffDays}d ago`;\n\n    return date.toLocaleDateString();\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create and initialize a connections list\n */\nexport async function createConnectionsList(\n  config: ConnectionsListConfig\n): Promise<ConnectionsListManager> {\n  const manager = new ConnectionsListManager(config);\n  await manager.init();\n  return manager;\n}\n","/**\n * Installations List Page\n * Displays service installations with filters, pagination, and management actions\n */\n\nimport type {\n  Installation,\n  InstallationStatus,\n  InstallType,\n  InstallationsListFilter,\n  Provider,\n  ScopeType,\n} from '../types.js';\nimport { getServicesClient, type ServicesAPIClient } from '../api-client.js';\nimport { QueryStateManager, type QueryState } from '../query-state.js';\nimport {\n  getPermissionManager,\n  canViewServices,\n  canConnect,\n  canRevoke,\n} from '../permissions.js';\nimport {\n  renderForbiddenState,\n  renderTableLoadingState,\n  renderTableErrorState,\n  renderTableNoResultsState,\n} from '../ui-states.js';\nimport {\n  withMutationFeedback,\n  confirmServiceAction,\n  ActionQueue,\n} from '../mutation-feedback.js';\nimport type { ToastNotifier } from '../../toast/types.js';\nimport { renderIcon } from '../../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface InstallationsListConfig {\n  /** Container element or selector */\n  container: string | HTMLElement;\n  /** API client (optional, uses default) */\n  apiClient?: ServicesAPIClient;\n  /** Toast notifier for messages */\n  notifier?: ToastNotifier;\n  /** Items per page (default: 25) */\n  perPage?: number;\n  /** Enable URL state sync (default: true) */\n  syncUrl?: boolean;\n  /** Callback when installation is selected */\n  onSelect?: (installation: Installation) => void;\n  /** Callback when begin action is triggered */\n  onBegin?: (providerId: string, scopeType: ScopeType) => void;\n  /** Custom provider name resolver */\n  getProviderName?: (providerId: string) => string;\n}\n\ninterface InstallationsListState {\n  installations: Installation[];\n  providers: Provider[];\n  total: number;\n  loading: boolean;\n  error: Error | null;\n}\n\ntype InstallationsFilter = {\n  provider_id: string;\n  scope_type: string;\n  scope_id: string;\n  install_type: string;\n  status: string;\n};\n\n// =============================================================================\n// Status Configuration\n// =============================================================================\n\nconst STATUS_CONFIG: Record<InstallationStatus, { label: string; bg: string; text: string; icon: string }> = {\n  active: { label: 'Active', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  suspended: { label: 'Suspended', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'iconoir:pause' },\n  uninstalled: { label: 'Uninstalled', bg: 'bg-gray-100', text: 'text-gray-600', icon: 'iconoir:cancel' },\n  needs_reconsent: { label: 'Needs Reconsent', bg: 'bg-orange-100', text: 'text-orange-700', icon: 'iconoir:refresh' },\n};\n\nconst INSTALL_TYPE_CONFIG: Record<InstallType, { label: string; bg: string; text: string }> = {\n  user: { label: 'User', bg: 'bg-blue-50', text: 'text-blue-600' },\n  workspace: { label: 'Workspace', bg: 'bg-indigo-50', text: 'text-indigo-600' },\n  org: { label: 'Organization', bg: 'bg-purple-50', text: 'text-purple-600' },\n  marketplace_app: { label: 'Marketplace', bg: 'bg-pink-50', text: 'text-pink-600' },\n  standard: { label: 'Standard', bg: 'bg-gray-50', text: 'text-gray-600' },\n};\n\n// =============================================================================\n// Installations List Manager\n// =============================================================================\n\nexport class InstallationsListManager {\n  private config: InstallationsListConfig;\n  private container: HTMLElement | null = null;\n  private client: ServicesAPIClient;\n  private queryState: QueryStateManager<InstallationsFilter>;\n  private state: InstallationsListState = {\n    installations: [],\n    providers: [],\n    total: 0,\n    loading: false,\n    error: null,\n  };\n  private abortController: AbortController | null = null;\n  private actionQueue = new ActionQueue();\n\n  constructor(config: InstallationsListConfig) {\n    this.config = {\n      perPage: 25,\n      syncUrl: true,\n      ...config,\n    };\n    this.client = config.apiClient || getServicesClient();\n\n    this.queryState = new QueryStateManager<InstallationsFilter>({\n      config: {\n        defaultPerPage: this.config.perPage,\n        onChange: () => this.loadInstallations(),\n      },\n      filterFields: ['provider_id', 'scope_type', 'scope_id', 'install_type', 'status'],\n      storageKey: 'services-installations-list',\n    });\n  }\n\n  /**\n   * Initialize the installations list\n   */\n  async init(): Promise<void> {\n    this.container =\n      typeof this.config.container === 'string'\n        ? document.querySelector<HTMLElement>(this.config.container)\n        : this.config.container;\n\n    if (!this.container) {\n      console.error('[InstallationsList] Container not found:', this.config.container);\n      return;\n    }\n\n    if (!canViewServices()()) {\n      this.renderForbidden();\n      return;\n    }\n\n    this.queryState.init();\n    this.renderStructure();\n    await this.loadProviders();\n    this.bindEvents();\n    await this.loadInstallations();\n  }\n\n  /**\n   * Refresh the installations list\n   */\n  async refresh(): Promise<void> {\n    await this.loadInstallations();\n  }\n\n  /**\n   * Get the current installations\n   */\n  getInstallations(): Installation[] {\n    return [...this.state.installations];\n  }\n\n  /**\n   * Get an installation by ID\n   */\n  getInstallation(id: string): Installation | undefined {\n    return this.state.installations.find((i) => i.id === id);\n  }\n\n  /**\n   * Destroy the manager\n   */\n  destroy(): void {\n    this.abortController?.abort();\n    this.queryState.destroy();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Data Loading\n  // ---------------------------------------------------------------------------\n\n  private async loadInstallations(): Promise<void> {\n    if (!this.container) return;\n\n    this.abortController?.abort();\n    this.abortController = new AbortController();\n\n    this.state.loading = true;\n    this.state.error = null;\n    this.updateLoadingState();\n\n    try {\n      const params = this.queryState.getQueryParams();\n      const filter: InstallationsListFilter = {\n        provider_id: params.provider_id as string | undefined,\n        scope_type: params.scope_type as ScopeType | undefined,\n        scope_id: params.scope_id as string | undefined,\n        install_type: params.install_type as InstallType | undefined,\n        status: params.status as InstallationStatus | undefined,\n        q: params.q as string | undefined,\n        page: params.page as number,\n        per_page: params.per_page as number,\n      };\n\n      const response = await this.client.listInstallations(filter, this.abortController.signal);\n\n      this.state.installations = response.installations;\n      this.state.total = response.total;\n      this.queryState.updateFromResponse(response.total, response.has_next);\n\n      this.renderInstallations();\n      this.updatePagination();\n    } catch (err) {\n      if ((err as Error).name === 'AbortError') return;\n\n      this.state.error = err instanceof Error ? err : new Error(String(err));\n      this.renderError();\n\n      if (this.config.notifier) {\n        this.config.notifier.error(`Failed to load installations: ${this.state.error.message}`);\n      }\n    } finally {\n      this.state.loading = false;\n      this.updateLoadingState();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rendering\n  // ---------------------------------------------------------------------------\n\n  private renderStructure(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = `\n      <div class=\"installations-list\">\n        <!-- Filters -->\n        <div class=\"installations-filters flex flex-wrap items-center gap-3 mb-4\">\n          <div class=\"flex-1 min-w-[200px]\">\n            <input type=\"text\"\n                   class=\"installations-search w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                   placeholder=\"Search installations...\"\n                   data-filter=\"search\">\n          </div>\n\n          <select class=\"installations-filter-provider px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  data-filter=\"provider_id\">\n            <option value=\"\">All Providers</option>\n          </select>\n\n          <select class=\"installations-filter-scope px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  data-filter=\"scope_type\">\n            <option value=\"\">All Scopes</option>\n            <option value=\"user\">User</option>\n            <option value=\"org\">Organization</option>\n          </select>\n\n          <select class=\"installations-filter-status px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  data-filter=\"status\">\n            <option value=\"\">All Statuses</option>\n            <option value=\"active\">Active</option>\n            <option value=\"suspended\">Suspended</option>\n            <option value=\"uninstalled\">Uninstalled</option>\n            <option value=\"needs_reconsent\">Needs Reconsent</option>\n          </select>\n\n          <select class=\"installations-filter-type px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  data-filter=\"install_type\">\n            <option value=\"\">All Install Types</option>\n            <option value=\"user\">User</option>\n            <option value=\"workspace\">Workspace</option>\n            <option value=\"org\">Organization</option>\n            <option value=\"marketplace_app\">Marketplace</option>\n            <option value=\"standard\">Standard</option>\n          </select>\n\n          <button type=\"button\"\n                  class=\"installations-reset px-3 py-2 text-sm text-gray-600 hover:text-gray-800\"\n                  title=\"Reset filters\">\n            ${renderIcon('iconoir:refresh', { size: '16px' })}\n          </button>\n        </div>\n\n        <!-- Table -->\n        <div class=\"installations-table-wrapper overflow-x-auto bg-white rounded-lg border border-gray-200\">\n          <table class=\"installations-table w-full text-sm\">\n            <thead class=\"bg-gray-50 border-b border-gray-200\">\n              <tr>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Provider</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Install Type</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Scope</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Status</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Granted</th>\n                <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Revoked</th>\n                <th class=\"px-4 py-3 text-right font-medium text-gray-600\">Actions</th>\n              </tr>\n            </thead>\n            <tbody class=\"installations-tbody divide-y divide-gray-100\">\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Empty State -->\n        <div class=\"installations-empty hidden py-12 text-center\">\n          <div class=\"inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 mb-4\">\n            ${renderIcon('iconoir:download', { size: '24px', extraClass: 'text-gray-400' })}\n          </div>\n          <h3 class=\"text-lg font-medium text-gray-900\">No installations found</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">Install a service to get started.</p>\n        </div>\n\n        <!-- Pagination -->\n        <div class=\"installations-pagination flex items-center justify-between mt-4\">\n          <div class=\"installations-info text-sm text-gray-500\"></div>\n          <div class=\"flex items-center gap-2\">\n            <button type=\"button\"\n                    class=\"installations-prev px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Previous\n            </button>\n            <button type=\"button\"\n                    class=\"installations-next px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Next\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    this.restoreFilterValues();\n  }\n\n  private restoreFilterValues(): void {\n    const state = this.queryState.getState();\n\n    const searchInput = this.container?.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    if (searchInput) {\n      searchInput.value = state.search || '';\n    }\n\n    const filterSelects = this.container?.querySelectorAll<HTMLSelectElement>('select[data-filter]');\n    filterSelects?.forEach((select) => {\n      const filterKey = select.dataset.filter as keyof InstallationsFilter;\n      select.value = state.filters[filterKey] || '';\n    });\n  }\n\n  private bindEvents(): void {\n    if (!this.container) return;\n\n    const searchInput = this.container.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    searchInput?.addEventListener('input', (e) => {\n      this.queryState.setSearch((e.target as HTMLInputElement).value);\n    });\n\n    const filterSelects = this.container.querySelectorAll<HTMLSelectElement>('select[data-filter]');\n    filterSelects.forEach((select) => {\n      select.addEventListener('change', () => {\n        const filterKey = select.dataset.filter as keyof InstallationsFilter;\n        this.queryState.setFilter(filterKey, select.value || undefined);\n      });\n    });\n\n    const resetBtn = this.container.querySelector('.installations-reset');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n\n    const prevBtn = this.container.querySelector('.installations-prev');\n    const nextBtn = this.container.querySelector('.installations-next');\n\n    prevBtn?.addEventListener('click', () => this.queryState.prevPage());\n    nextBtn?.addEventListener('click', () => this.queryState.nextPage());\n  }\n\n  private renderInstallations(): void {\n    const tbody = this.container?.querySelector('.installations-tbody');\n    const emptyState = this.container?.querySelector('.installations-empty');\n    const tableWrapper = this.container?.querySelector('.installations-table-wrapper');\n\n    if (!tbody) return;\n\n    if (this.state.installations.length === 0) {\n      // Determine if this is \"empty\" (no data) or \"no results\" (filters applied)\n      const hasFilters = this.queryState.getActiveFilterCount() > 0 || !!this.queryState.getState().search;\n\n      if (hasFilters) {\n        // Show no-results state in the table\n        tableWrapper?.classList.remove('hidden');\n        emptyState?.classList.add('hidden');\n        tbody.innerHTML = renderTableNoResultsState(7, {\n          query: this.queryState.getState().search,\n          filterCount: this.queryState.getActiveFilterCount(),\n        });\n        this.bindNoResultsActions(tbody);\n      } else {\n        // Show empty state\n        tbody.innerHTML = '';\n        tableWrapper?.classList.add('hidden');\n        emptyState?.classList.remove('hidden');\n      }\n      return;\n    }\n\n    tableWrapper?.classList.remove('hidden');\n    emptyState?.classList.add('hidden');\n\n    tbody.innerHTML = this.state.installations.map((inst) => this.renderInstallationRow(inst)).join('');\n    this.bindRowActions();\n  }\n\n  private bindNoResultsActions(container: Element): void {\n    const resetBtn = container.querySelector('.ui-state-reset-btn');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n  }\n\n  private renderInstallationRow(installation: Installation): string {\n    const status = STATUS_CONFIG[installation.status] || STATUS_CONFIG.uninstalled;\n    const installType = INSTALL_TYPE_CONFIG[installation.install_type] || INSTALL_TYPE_CONFIG.standard;\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(installation.provider_id)\n      : this.formatProviderId(installation.provider_id);\n\n    const grantedAt = installation.granted_at ? this.formatDate(installation.granted_at) : '';\n    const revokedAt = installation.revoked_at ? this.formatDate(installation.revoked_at) : '';\n    const actions = this.buildRowActions(installation);\n\n    return `\n      <tr class=\"installation-row hover:bg-gray-50 cursor-pointer\" data-installation-id=\"${this.escapeHtml(installation.id)}\">\n        <td class=\"px-4 py-3\">\n          <span class=\"font-medium text-gray-900\">${this.escapeHtml(providerName)}</span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${installType.bg} ${installType.text}\">\n            ${installType.label}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${\n            installation.scope_type === 'user' ? 'bg-blue-50 text-blue-600' : 'bg-purple-50 text-purple-600'\n          }\">\n            ${this.escapeHtml(installation.scope_type)}\n          </span>\n          <span class=\"text-gray-500 text-xs ml-1\" title=\"${this.escapeHtml(installation.scope_id)}\">\n            ${this.escapeHtml(this.truncateId(installation.scope_id))}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${status.bg} ${status.text}\">\n            ${renderIcon(status.icon, { size: '12px' })}\n            ${status.label}\n          </span>\n        </td>\n        <td class=\"px-4 py-3 text-gray-500 text-xs\">\n          ${grantedAt}\n        </td>\n        <td class=\"px-4 py-3 text-gray-500 text-xs\">\n          ${revokedAt}\n        </td>\n        <td class=\"px-4 py-3 text-right\">\n          ${actions}\n        </td>\n      </tr>\n    `;\n  }\n\n  private buildRowActions(installation: Installation): string {\n    const actions: string[] = [];\n\n    if (installation.status === 'active' && canRevoke()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"installation-action-uninstall p-1 text-gray-400 hover:text-red-600\"\n                data-action=\"uninstall\"\n                title=\"Uninstall\">\n          ${renderIcon('iconoir:trash', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (installation.status === 'uninstalled' && canConnect()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"installation-action-reinstall p-1 text-gray-400 hover:text-green-600\"\n                data-action=\"reinstall\"\n                title=\"Reinstall\">\n          ${renderIcon('iconoir:redo', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (actions.length === 0) {\n      return '<span class=\"text-gray-300 text-xs\"></span>';\n    }\n\n    return `<div class=\"flex items-center justify-end gap-1\">${actions.join('')}</div>`;\n  }\n\n  private bindRowActions(): void {\n    const rows = this.container?.querySelectorAll<HTMLTableRowElement>('.installation-row');\n\n    rows?.forEach((row) => {\n      const installationId = row.dataset.installationId;\n      if (!installationId) return;\n\n      row.addEventListener('click', (e) => {\n        if ((e.target as HTMLElement).closest('button')) return;\n\n        const installation = this.getInstallation(installationId);\n        if (installation && this.config.onSelect) {\n          this.config.onSelect(installation);\n        }\n      });\n\n      row.querySelectorAll<HTMLButtonElement>('button[data-action]').forEach((btn) => {\n        btn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          const action = btn.dataset.action;\n\n          switch (action) {\n            case 'uninstall':\n              await this.handleUninstall(installationId, btn);\n              break;\n            case 'reinstall':\n              await this.handleReinstall(installationId);\n              break;\n          }\n        });\n      });\n    });\n  }\n\n  private async handleUninstall(installationId: string, button?: HTMLButtonElement): Promise<void> {\n    const installation = this.getInstallation(installationId);\n    const providerName = installation\n      ? (this.config.getProviderName\n          ? this.config.getProviderName(installation.provider_id)\n          : this.formatProviderId(installation.provider_id))\n      : undefined;\n\n    // Show confirmation dialog\n    const confirmed = await confirmServiceAction({\n      action: 'uninstall',\n      resourceType: 'installation',\n      resourceName: providerName,\n    });\n    if (!confirmed) return;\n\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight(`uninstall-${installationId}`)) return;\n\n    await this.actionQueue.execute(`uninstall-${installationId}`, async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.uninstallInstallation(installationId),\n        notifier: this.config.notifier,\n        successMessage: 'Service uninstalled',\n        errorMessagePrefix: 'Failed to uninstall',\n        buttonConfig: button ? {\n          button,\n          loadingText: 'Uninstalling...',\n          successText: 'Uninstalled',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.loadInstallations(),\n      });\n    });\n  }\n\n  private async handleReinstall(installationId: string): Promise<void> {\n    const installation = this.getInstallation(installationId);\n    if (!installation) return;\n\n    if (this.config.onBegin) {\n      this.config.onBegin(installation.provider_id, installation.scope_type);\n    }\n  }\n\n  private renderError(): void {\n    const tbody = this.container?.querySelector('.installations-tbody');\n    const tableWrapper = this.container?.querySelector('.installations-table-wrapper');\n    const emptyState = this.container?.querySelector('.installations-empty');\n\n    if (!tbody) return;\n\n    tableWrapper?.classList.remove('hidden');\n    emptyState?.classList.add('hidden');\n\n    tbody.innerHTML = renderTableErrorState(7, {\n      title: 'Failed to load installations',\n      error: this.state.error,\n      showRetry: true,\n    });\n\n    const retryBtn = tbody.querySelector('.ui-state-retry-btn');\n    retryBtn?.addEventListener('click', () => this.loadInstallations());\n  }\n\n  private renderForbidden(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderForbiddenState({\n      resource: 'installations',\n    });\n  }\n\n  private updateLoadingState(): void {\n    const tbody = this.container?.querySelector('.installations-tbody');\n    const tableWrapper = this.container?.querySelector('.installations-table-wrapper');\n    const emptyState = this.container?.querySelector('.installations-empty');\n\n    if (this.state.loading && tbody && this.state.installations.length === 0) {\n      tableWrapper?.classList.remove('hidden');\n      emptyState?.classList.add('hidden');\n      tbody.innerHTML = renderTableLoadingState(7, { text: 'Loading installations...' });\n    }\n  }\n\n  private async loadProviders(): Promise<void> {\n    try {\n      const response = await this.client.listProviders();\n      this.state.providers = response.providers || [];\n      this.populateProviderFilterOptions();\n    } catch (err) {\n      this.state.providers = [];\n      this.config.notifier?.error(`Failed to load providers: ${(err as Error).message}`);\n    }\n  }\n\n  private populateProviderFilterOptions(): void {\n    const providerSelect = this.container?.querySelector<HTMLSelectElement>('[data-filter=\"provider_id\"]');\n    if (!providerSelect) return;\n\n    const selectedProviderId = this.queryState.getState().filters.provider_id || '';\n    const options = this.state.providers\n      .map((provider) => {\n        const displayName = this.config.getProviderName\n          ? this.config.getProviderName(provider.id)\n          : this.formatProviderId(provider.id);\n        return `<option value=\"${this.escapeHtml(provider.id)}\">${this.escapeHtml(displayName)}</option>`;\n      })\n      .join('');\n\n    providerSelect.innerHTML = `<option value=\"\">All Providers</option>${options}`;\n    providerSelect.value = selectedProviderId;\n  }\n\n  private updatePagination(): void {\n    const state = this.queryState.getState();\n    const { page, per_page } = state;\n    const { total } = this.state;\n\n    const start = total > 0 ? (page - 1) * per_page + 1 : 0;\n    const end = Math.min(page * per_page, total);\n    const hasNext = end < total;\n    const hasPrev = page > 1;\n\n    const infoEl = this.container?.querySelector('.installations-info');\n    const prevBtn = this.container?.querySelector<HTMLButtonElement>('.installations-prev');\n    const nextBtn = this.container?.querySelector<HTMLButtonElement>('.installations-next');\n\n    if (infoEl) {\n      infoEl.textContent = total > 0 ? `Showing ${start}-${end} of ${total}` : 'No installations';\n    }\n\n    if (prevBtn) prevBtn.disabled = !hasPrev;\n    if (nextBtn) nextBtn.disabled = !hasNext;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private formatProviderId(id: string): string {\n    return id\n      .split(/[-_]/)\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  }\n\n  private truncateId(id: string, maxLen = 12): string {\n    if (id.length <= maxLen) return id;\n    return `${id.slice(0, maxLen - 3)}...`;\n  }\n\n  private formatDate(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return 'Just now';\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n    if (diffDays < 7) return `${diffDays}d ago`;\n\n    return date.toLocaleDateString();\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create and initialize an installations list\n */\nexport async function createInstallationsList(\n  config: InstallationsListConfig\n): Promise<InstallationsListManager> {\n  const manager = new InstallationsListManager(config);\n  await manager.init();\n  return manager;\n}\n","/**\n * Services Activity Page\n * Displays service activity with timeline and table views, filters, and pagination\n */\n\nimport type {\n  ServiceActivityEntry,\n  ServiceActivityStatus,\n  ActivityListFilter,\n  ScopeType,\n} from '../types.js';\nimport { getServicesClient, type ServicesAPIClient } from '../api-client.js';\nimport { QueryStateManager, type QueryState } from '../query-state.js';\nimport { getPermissionManager, canViewActivity } from '../permissions.js';\nimport {\n  renderForbiddenState,\n  renderLoadingState,\n  renderErrorState,\n  renderEmptyState,\n  renderNoResultsState,\n  renderTableLoadingState,\n  renderTableErrorState,\n  renderTableNoResultsState,\n} from '../ui-states.js';\nimport {\n  getActionLabel as defaultGetActionLabel,\n  getActionsByCategory,\n} from '../activity-labels.js';\nimport {\n  createActivityNavigateHandler,\n  generateDeepLink,\n  mapObjectTypeToEntity,\n  type ServiceEntityType,\n} from '../deep-links.js';\nimport type { ToastNotifier } from '../../toast/types.js';\nimport { renderIcon } from '../../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport type ActivityViewMode = 'timeline' | 'table';\n\nexport interface ActivityPageConfig {\n  /** Container element or selector */\n  container: string | HTMLElement;\n  /** API client (optional, uses default) */\n  apiClient?: ServicesAPIClient;\n  /** Toast notifier for messages */\n  notifier?: ToastNotifier;\n  /** Items per page (default: 25) */\n  perPage?: number;\n  /** Enable URL state sync (default: true) */\n  syncUrl?: boolean;\n  /** Initial view mode (default: 'timeline') */\n  viewMode?: ActivityViewMode;\n  /** Enable deep links for object navigation with context preservation (default: true) */\n  useDeepLinks?: boolean;\n  /** Callback when activity entry is selected */\n  onSelect?: (entry: ServiceActivityEntry) => void;\n  /** Callback for navigating to related entity (overrides deep links if provided) */\n  onNavigate?: (objectType: string, objectId: string) => void;\n  /** Custom provider name resolver */\n  getProviderName?: (providerId: string) => string;\n  /** Custom action label resolver (from backend config) */\n  getActionLabel?: (action: string) => string;\n  /** Available providers for filter dropdown */\n  providers?: Array<{ id: string; name: string }>;\n  /** Available channels for filter dropdown */\n  channels?: string[];\n  /** Available actions for filter dropdown */\n  actions?: string[];\n}\n\ninterface ActivityPageState {\n  entries: ServiceActivityEntry[];\n  total: number;\n  loading: boolean;\n  error: Error | null;\n  viewMode: ActivityViewMode;\n}\n\ntype ActivityFilter = {\n  provider_id: string;\n  scope_type: string;\n  scope_id: string;\n  channel: string;\n  action: string;\n  status: string;\n  object_type: string;\n  object_id: string;\n  from: string;\n  to: string;\n};\n\n// =============================================================================\n// Status Configuration\n// =============================================================================\n\nconst STATUS_CONFIG: Record<ServiceActivityStatus, { label: string; bg: string; text: string; icon: string }> = {\n  success: { label: 'Success', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  failure: { label: 'Failed', bg: 'bg-red-100', text: 'text-red-700', icon: 'iconoir:warning-circle' },\n  pending: { label: 'Pending', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'iconoir:clock' },\n};\n\n// =============================================================================\n// Activity Page Manager\n// =============================================================================\n\nexport class ActivityPageManager {\n  private config: ActivityPageConfig;\n  private container: HTMLElement | null = null;\n  private client: ServicesAPIClient;\n  private queryState: QueryStateManager<ActivityFilter>;\n  private state: ActivityPageState = {\n    entries: [],\n    total: 0,\n    loading: false,\n    error: null,\n    viewMode: 'timeline',\n  };\n  private abortController: AbortController | null = null;\n\n  constructor(config: ActivityPageConfig) {\n    this.config = {\n      perPage: 25,\n      syncUrl: true,\n      viewMode: 'timeline',\n      useDeepLinks: true,\n      ...config,\n    };\n    this.state.viewMode = this.config.viewMode || 'timeline';\n    this.client = config.apiClient || getServicesClient();\n\n    this.queryState = new QueryStateManager<ActivityFilter>({\n      config: {\n        defaultPerPage: this.config.perPage,\n        onChange: () => this.loadActivity(),\n      },\n      filterFields: [\n        'provider_id',\n        'scope_type',\n        'scope_id',\n        'channel',\n        'action',\n        'status',\n        'object_type',\n        'object_id',\n        'from',\n        'to',\n      ],\n      dateFields: ['from', 'to'],\n      storageKey: 'services-activity',\n    });\n  }\n\n  /**\n   * Initialize the activity page\n   */\n  async init(): Promise<void> {\n    // Resolve container\n    this.container =\n      typeof this.config.container === 'string'\n        ? document.querySelector<HTMLElement>(this.config.container)\n        : this.config.container;\n\n    if (!this.container) {\n      console.error('[ActivityPage] Container not found:', this.config.container);\n      return;\n    }\n\n    // Check view permission\n    if (!canViewActivity()()) {\n      this.renderForbidden();\n      return;\n    }\n\n    // Restore view mode from URL or localStorage\n    this.restoreViewMode();\n\n    // Initialize query state from URL\n    this.queryState.init();\n\n    // Render initial structure\n    this.renderStructure();\n    this.bindEvents();\n\n    // Load activity\n    await this.loadActivity();\n  }\n\n  /**\n   * Refresh the activity list\n   */\n  async refresh(): Promise<void> {\n    await this.loadActivity();\n  }\n\n  /**\n   * Get the current entries\n   */\n  getEntries(): ServiceActivityEntry[] {\n    return [...this.state.entries];\n  }\n\n  /**\n   * Get an entry by ID\n   */\n  getEntry(id: string): ServiceActivityEntry | undefined {\n    return this.state.entries.find((e) => e.id === id);\n  }\n\n  /**\n   * Set view mode\n   */\n  setViewMode(mode: ActivityViewMode): void {\n    if (this.state.viewMode !== mode) {\n      this.state.viewMode = mode;\n      this.saveViewMode();\n      this.updateViewModeUI();\n      this.renderEntries();\n    }\n  }\n\n  /**\n   * Get current view mode\n   */\n  getViewMode(): ActivityViewMode {\n    return this.state.viewMode;\n  }\n\n  /**\n   * Destroy the manager\n   */\n  destroy(): void {\n    this.abortController?.abort();\n    this.queryState.destroy();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Data Loading\n  // ---------------------------------------------------------------------------\n\n  private async loadActivity(): Promise<void> {\n    if (!this.container) return;\n\n    // Cancel previous request\n    this.abortController?.abort();\n    this.abortController = new AbortController();\n\n    this.state.loading = true;\n    this.state.error = null;\n    this.updateLoadingState();\n\n    try {\n      const params = this.queryState.getQueryParams();\n      const filter: ActivityListFilter = {\n        provider_id: params.provider_id as string | undefined,\n        scope_type: params.scope_type as ScopeType | undefined,\n        scope_id: params.scope_id as string | undefined,\n        action: params.action as string | undefined,\n        status: params.status as ServiceActivityStatus | undefined,\n        from: params.from as string | undefined,\n        to: params.to as string | undefined,\n        page: params.page as number,\n        per_page: params.per_page as number,\n      };\n\n      const response = await this.client.listActivity(filter, this.abortController.signal);\n\n      this.state.entries = response.entries;\n      this.state.total = response.total;\n      this.queryState.updateFromResponse(response.total, response.has_more);\n\n      this.renderEntries();\n      this.updatePagination();\n    } catch (err) {\n      if ((err as Error).name === 'AbortError') return;\n\n      this.state.error = err instanceof Error ? err : new Error(String(err));\n      this.renderError();\n\n      if (this.config.notifier) {\n        this.config.notifier.error(`Failed to load activity: ${this.state.error.message}`);\n      }\n    } finally {\n      this.state.loading = false;\n      this.updateLoadingState();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rendering\n  // ---------------------------------------------------------------------------\n\n  private renderStructure(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = `\n      <div class=\"activity-page\">\n        <!-- Header with view toggle -->\n        <div class=\"activity-header flex items-center justify-between mb-4\">\n          <div class=\"activity-filter-summary text-sm text-gray-500\">\n            <!-- Filter summary will be rendered here -->\n          </div>\n          <div class=\"activity-view-toggle flex items-center gap-1 p-1 bg-gray-100 rounded-lg\">\n            <button type=\"button\"\n                    class=\"activity-view-timeline px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${this.state.viewMode === 'timeline' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}\"\n                    title=\"Timeline view\">\n              ${renderIcon('iconoir:timeline', { size: '16px' })}\n              <span class=\"ml-1.5\">Timeline</span>\n            </button>\n            <button type=\"button\"\n                    class=\"activity-view-table px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${this.state.viewMode === 'table' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}\"\n                    title=\"Table view\">\n              ${renderIcon('iconoir:table-rows', { size: '16px' })}\n              <span class=\"ml-1.5\">Table</span>\n            </button>\n          </div>\n        </div>\n\n        <!-- Filters -->\n        <div class=\"activity-filters bg-white rounded-lg border border-gray-200 p-4 mb-4\">\n          <div class=\"flex flex-wrap items-end gap-3\">\n            <!-- Search -->\n            <div class=\"flex-1 min-w-[200px]\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Search</label>\n              <input type=\"text\"\n                     class=\"activity-search w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                     placeholder=\"Search activity...\"\n                     data-filter=\"search\">\n            </div>\n\n            <!-- Provider -->\n            <div class=\"w-40\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Provider</label>\n              <select class=\"activity-filter-provider w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                      data-filter=\"provider_id\">\n                <option value=\"\">All Providers</option>\n                ${this.renderProviderOptions()}\n              </select>\n            </div>\n\n            <!-- Channel -->\n            <div class=\"w-36\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Channel</label>\n              <select class=\"activity-filter-channel w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                      data-filter=\"channel\">\n                <option value=\"\">All Channels</option>\n                ${this.renderChannelOptions()}\n              </select>\n            </div>\n\n            <!-- Action -->\n            <div class=\"w-40\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Action</label>\n              <select class=\"activity-filter-action w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                      data-filter=\"action\">\n                <option value=\"\">All Actions</option>\n                ${this.renderActionOptions()}\n              </select>\n            </div>\n\n            <!-- Scope -->\n            <div class=\"w-32\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Scope</label>\n              <select class=\"activity-filter-scope w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                      data-filter=\"scope_type\">\n                <option value=\"\">All Scopes</option>\n                <option value=\"user\">User</option>\n                <option value=\"org\">Organization</option>\n              </select>\n            </div>\n\n            <!-- Status -->\n            <div class=\"w-32\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Status</label>\n              <select class=\"activity-filter-status w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                      data-filter=\"status\">\n                <option value=\"\">All Statuses</option>\n                <option value=\"success\">Success</option>\n                <option value=\"failure\">Failed</option>\n                <option value=\"pending\">Pending</option>\n              </select>\n            </div>\n          </div>\n\n          <!-- Date range and reset row -->\n          <div class=\"flex flex-wrap items-end gap-3 mt-3 pt-3 border-t border-gray-100\">\n            <!-- Object filter -->\n            <div class=\"w-40\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Object Type</label>\n              <input type=\"text\"\n                     class=\"activity-filter-object-type w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                     placeholder=\"e.g. connection\"\n                     data-filter=\"object_type\">\n            </div>\n\n            <div class=\"w-48\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">Object ID</label>\n              <input type=\"text\"\n                     class=\"activity-filter-object-id w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                     placeholder=\"Object ID\"\n                     data-filter=\"object_id\">\n            </div>\n\n            <!-- Date From -->\n            <div class=\"w-44\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">From</label>\n              <input type=\"datetime-local\"\n                     class=\"activity-filter-from w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                     data-filter=\"from\">\n            </div>\n\n            <!-- Date To -->\n            <div class=\"w-44\">\n              <label class=\"block text-xs font-medium text-gray-500 mb-1\">To</label>\n              <input type=\"datetime-local\"\n                     class=\"activity-filter-to w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                     data-filter=\"to\">\n            </div>\n\n            <!-- Spacer -->\n            <div class=\"flex-1\"></div>\n\n            <!-- Reset Button -->\n            <button type=\"button\"\n                    class=\"activity-reset flex items-center gap-1.5 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50\"\n                    title=\"Reset filters\">\n              ${renderIcon('iconoir:refresh', { size: '16px' })}\n              <span>Reset</span>\n            </button>\n          </div>\n        </div>\n\n        <!-- Content Area -->\n        <div class=\"activity-content\">\n          <!-- Timeline View -->\n          <div class=\"activity-timeline-container ${this.state.viewMode === 'timeline' ? '' : 'hidden'}\">\n            <div class=\"activity-timeline space-y-4\">\n              <!-- Timeline entries will be rendered here -->\n            </div>\n          </div>\n\n          <!-- Table View -->\n          <div class=\"activity-table-container ${this.state.viewMode === 'table' ? '' : 'hidden'}\">\n            <div class=\"overflow-x-auto bg-white rounded-lg border border-gray-200\">\n              <table class=\"activity-table w-full text-sm\">\n                <thead class=\"bg-gray-50 border-b border-gray-200\">\n                  <tr>\n                    <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Time</th>\n                    <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Provider</th>\n                    <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Action</th>\n                    <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Object</th>\n                    <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Scope</th>\n                    <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Status</th>\n                    <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Channel</th>\n                  </tr>\n                </thead>\n                <tbody class=\"activity-tbody divide-y divide-gray-100\">\n                  <!-- Table rows will be rendered here -->\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          <!-- Empty State -->\n          <div class=\"activity-empty hidden py-12 text-center bg-white rounded-lg border border-gray-200\">\n            <div class=\"inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 mb-4\">\n              ${renderIcon('iconoir:activity', { size: '24px', extraClass: 'text-gray-400' })}\n            </div>\n            <h3 class=\"text-lg font-medium text-gray-900\">No activity found</h3>\n            <p class=\"text-sm text-gray-500 mt-1\">Activity entries will appear here as actions occur.</p>\n          </div>\n        </div>\n\n        <!-- Pagination -->\n        <div class=\"activity-pagination flex items-center justify-between mt-4\">\n          <div class=\"activity-info text-sm text-gray-500\">\n            <!-- Info will be rendered here -->\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <button type=\"button\"\n                    class=\"activity-prev px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Previous\n            </button>\n            <button type=\"button\"\n                    class=\"activity-next px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Next\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Restore filter values from state\n    this.restoreFilterValues();\n  }\n\n  private renderProviderOptions(): string {\n    if (!this.config.providers || this.config.providers.length === 0) {\n      return '';\n    }\n    return this.config.providers\n      .map((p) => `<option value=\"${this.escapeHtml(p.id)}\">${this.escapeHtml(p.name)}</option>`)\n      .join('');\n  }\n\n  private renderChannelOptions(): string {\n    const channels = this.config.channels || ['connections', 'credentials', 'grants', 'webhooks', 'sync', 'lifecycle'];\n    return channels\n      .map((c) => `<option value=\"${this.escapeHtml(c)}\">${this.escapeHtml(this.formatLabel(c))}</option>`)\n      .join('');\n  }\n\n  private renderActionOptions(): string {\n    // If actions are explicitly provided, use them\n    if (this.config.actions && this.config.actions.length > 0) {\n      return this.config.actions\n        .map((a) => {\n          const label = this.resolveActionLabel(a);\n          return `<option value=\"${this.escapeHtml(a)}\">${this.escapeHtml(label)}</option>`;\n        })\n        .join('');\n    }\n\n    // Otherwise, render grouped options from the centralized registry\n    const categories = getActionsByCategory();\n    const categoryLabels: Record<string, string> = {\n      connections: 'Connections',\n      credentials: 'Credentials',\n      sync: 'Sync',\n      webhooks: 'Webhooks',\n      subscriptions: 'Subscriptions',\n      installations: 'Installations',\n      grants: 'Permissions',\n      errors: 'Errors',\n      other: 'Other',\n    };\n\n    const optgroups: string[] = [];\n    for (const [category, entries] of Object.entries(categories)) {\n      const categoryLabel = categoryLabels[category] || this.formatLabel(category);\n      const options = entries\n        .map((entry) => {\n          const label = this.resolveActionLabel(entry.action);\n          return `<option value=\"${this.escapeHtml(entry.action)}\">${this.escapeHtml(label)}</option>`;\n        })\n        .join('');\n      optgroups.push(`<optgroup label=\"${this.escapeHtml(categoryLabel)}\">${options}</optgroup>`);\n    }\n\n    return optgroups.join('');\n  }\n\n  /**\n   * Resolve action label using config override or centralized registry.\n   */\n  private resolveActionLabel(action: string): string {\n    // Config override takes priority\n    if (this.config.getActionLabel) {\n      return this.config.getActionLabel(action);\n    }\n    // Fall back to centralized registry (with built-in fallback formatter)\n    return defaultGetActionLabel(action);\n  }\n\n  private restoreFilterValues(): void {\n    const state = this.queryState.getState();\n\n    const searchInput = this.container?.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    if (searchInput && state.search) {\n      searchInput.value = state.search;\n    }\n\n    for (const [key, value] of Object.entries(state.filters)) {\n      const input = this.container?.querySelector<HTMLInputElement | HTMLSelectElement>(`[data-filter=\"${key}\"]`);\n      if (input && value) {\n        input.value = value;\n      }\n    }\n  }\n\n  private bindEvents(): void {\n    if (!this.container) return;\n\n    // View mode toggles\n    const timelineBtn = this.container.querySelector('.activity-view-timeline');\n    const tableBtn = this.container.querySelector('.activity-view-table');\n\n    timelineBtn?.addEventListener('click', () => this.setViewMode('timeline'));\n    tableBtn?.addEventListener('click', () => this.setViewMode('table'));\n\n    // Search input\n    const searchInput = this.container.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    searchInput?.addEventListener('input', (e) => {\n      this.queryState.setSearch((e.target as HTMLInputElement).value);\n    });\n\n    // Filter selects\n    const filterSelects = this.container.querySelectorAll<HTMLSelectElement>('select[data-filter]');\n    filterSelects.forEach((select) => {\n      select.addEventListener('change', () => {\n        const filterKey = select.dataset.filter as keyof ActivityFilter;\n        this.queryState.setFilter(filterKey, select.value || undefined);\n      });\n    });\n\n    // Filter inputs (text and datetime)\n    const filterInputs = this.container.querySelectorAll<HTMLInputElement>('input[data-filter]:not([type=\"text\"])');\n    filterInputs.forEach((input) => {\n      input.addEventListener('change', () => {\n        const filterKey = input.dataset.filter as keyof ActivityFilter;\n        this.queryState.setFilter(filterKey, input.value || undefined);\n      });\n    });\n\n    // Object type/id text inputs\n    const objectTypeInput = this.container.querySelector<HTMLInputElement>('[data-filter=\"object_type\"]');\n    const objectIdInput = this.container.querySelector<HTMLInputElement>('[data-filter=\"object_id\"]');\n    objectTypeInput?.addEventListener('change', () => {\n      this.queryState.setFilter('object_type', objectTypeInput.value || undefined);\n    });\n    objectIdInput?.addEventListener('change', () => {\n      this.queryState.setFilter('object_id', objectIdInput.value || undefined);\n    });\n\n    // Reset button\n    const resetBtn = this.container.querySelector('.activity-reset');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n\n    // Pagination buttons\n    const prevBtn = this.container.querySelector('.activity-prev');\n    const nextBtn = this.container.querySelector('.activity-next');\n\n    prevBtn?.addEventListener('click', () => this.queryState.prevPage());\n    nextBtn?.addEventListener('click', () => this.queryState.nextPage());\n  }\n\n  private renderEntries(): void {\n    const timelineContainer = this.container?.querySelector('.activity-timeline');\n    const tbody = this.container?.querySelector('.activity-tbody');\n    const emptyState = this.container?.querySelector('.activity-empty');\n    const timelineWrapper = this.container?.querySelector('.activity-timeline-container');\n    const tableWrapper = this.container?.querySelector('.activity-table-container');\n\n    if (this.state.entries.length === 0) {\n      // Determine if this is \"empty\" (no data) or \"no results\" (filters applied)\n      const hasFilters = this.queryState.getActiveFilterCount() > 0 || !!this.queryState.getState().search;\n\n      if (hasFilters) {\n        // Show no-results state\n        emptyState?.classList.add('hidden');\n\n        if (this.state.viewMode === 'timeline') {\n          timelineWrapper?.classList.remove('hidden');\n          tableWrapper?.classList.add('hidden');\n          if (timelineContainer) {\n            timelineContainer.innerHTML = renderNoResultsState({\n              query: this.queryState.getState().search,\n              filterCount: this.queryState.getActiveFilterCount(),\n              containerClass: 'bg-white rounded-lg border border-gray-200',\n            });\n            this.bindNoResultsActions(timelineContainer);\n          }\n        } else {\n          tableWrapper?.classList.remove('hidden');\n          timelineWrapper?.classList.add('hidden');\n          if (tbody) {\n            tbody.innerHTML = renderTableNoResultsState(7, {\n              query: this.queryState.getState().search,\n              filterCount: this.queryState.getActiveFilterCount(),\n            });\n            this.bindNoResultsActions(tbody);\n          }\n        }\n      } else {\n        // Show empty state\n        timelineWrapper?.classList.add('hidden');\n        tableWrapper?.classList.add('hidden');\n        emptyState?.classList.remove('hidden');\n      }\n      this.updateFilterSummary();\n      return;\n    }\n\n    emptyState?.classList.add('hidden');\n\n    if (this.state.viewMode === 'timeline') {\n      timelineWrapper?.classList.remove('hidden');\n      tableWrapper?.classList.add('hidden');\n      if (timelineContainer) {\n        timelineContainer.innerHTML = this.state.entries\n          .map((entry) => this.renderTimelineEntry(entry))\n          .join('');\n        this.bindEntryActions();\n      }\n    } else {\n      tableWrapper?.classList.remove('hidden');\n      timelineWrapper?.classList.add('hidden');\n      if (tbody) {\n        tbody.innerHTML = this.state.entries.map((entry) => this.renderTableRow(entry)).join('');\n        this.bindEntryActions();\n      }\n    }\n\n    this.updateFilterSummary();\n  }\n\n  private bindNoResultsActions(container: Element): void {\n    const resetBtn = container.querySelector('.ui-state-reset-btn');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n  }\n\n  private renderTimelineEntry(entry: ServiceActivityEntry): string {\n    const status = STATUS_CONFIG[entry.status] || STATUS_CONFIG.pending;\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(entry.provider_id)\n      : this.formatProviderId(entry.provider_id);\n    const actionLabel = this.resolveActionLabel(entry.action);\n    const time = this.formatTime(entry.created_at);\n    const relativeTime = this.formatRelativeTime(entry.created_at);\n\n    return `\n      <div class=\"activity-entry flex gap-4 bg-white rounded-lg border border-gray-200 p-4 hover:border-gray-300 transition-colors cursor-pointer\"\n           data-entry-id=\"${this.escapeHtml(entry.id)}\">\n        <!-- Status indicator -->\n        <div class=\"flex-shrink-0\">\n          <div class=\"w-10 h-10 rounded-full ${status.bg} flex items-center justify-center\">\n            ${renderIcon(status.icon, { size: '20px', extraClass: status.text })}\n          </div>\n        </div>\n\n        <!-- Content -->\n        <div class=\"flex-1 min-w-0\">\n          <div class=\"flex items-start justify-between gap-4\">\n            <div>\n              <p class=\"text-sm font-medium text-gray-900\">\n                ${this.escapeHtml(actionLabel)}\n              </p>\n              <div class=\"flex items-center gap-2 mt-1\">\n                <span class=\"text-xs text-gray-500\">${this.escapeHtml(providerName)}</span>\n                ${entry.channel ? `\n                  <span class=\"text-gray-300\">&middot;</span>\n                  <span class=\"text-xs text-gray-500\">${this.escapeHtml(entry.channel)}</span>\n                ` : ''}\n                ${entry.object_type && entry.object_id ? `\n                  <span class=\"text-gray-300\">&middot;</span>\n                  <a href=\"${this.buildObjectLinkUrl(entry.object_type, entry.object_id)}\"\n                     class=\"activity-object-link text-xs text-blue-600 hover:text-blue-700\"\n                     data-object-type=\"${this.escapeHtml(entry.object_type)}\"\n                     data-object-id=\"${this.escapeHtml(entry.object_id)}\">\n                    ${this.escapeHtml(entry.object_type)}:${this.escapeHtml(this.truncateId(entry.object_id))}\n                  </a>\n                ` : ''}\n              </div>\n            </div>\n            <div class=\"text-right flex-shrink-0\">\n              <p class=\"text-xs text-gray-500\" title=\"${this.escapeHtml(time)}\">${relativeTime}</p>\n              <div class=\"flex items-center gap-1 mt-1\">\n                <span class=\"inline-flex items-center px-1.5 py-0.5 rounded text-xs ${\n                  entry.scope_type === 'user' ? 'bg-blue-50 text-blue-600' : 'bg-purple-50 text-purple-600'\n                }\">\n                  ${this.escapeHtml(entry.scope_type)}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <!-- Metadata preview -->\n          ${Object.keys(entry.metadata || {}).length > 0 ? `\n            <div class=\"mt-2 pt-2 border-t border-gray-100\">\n              <div class=\"text-xs text-gray-500 font-mono truncate\">\n                ${this.escapeHtml(this.formatMetadataPreview(entry.metadata))}\n              </div>\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- Status badge -->\n        <div class=\"flex-shrink-0\">\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${status.bg} ${status.text}\">\n            ${status.label}\n          </span>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTableRow(entry: ServiceActivityEntry): string {\n    const status = STATUS_CONFIG[entry.status] || STATUS_CONFIG.pending;\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(entry.provider_id)\n      : this.formatProviderId(entry.provider_id);\n    const actionLabel = this.resolveActionLabel(entry.action);\n    const time = this.formatTime(entry.created_at);\n    const relativeTime = this.formatRelativeTime(entry.created_at);\n\n    return `\n      <tr class=\"activity-row hover:bg-gray-50 cursor-pointer\" data-entry-id=\"${this.escapeHtml(entry.id)}\">\n        <td class=\"px-4 py-3 whitespace-nowrap\">\n          <span class=\"text-sm text-gray-900\" title=\"${this.escapeHtml(time)}\">${relativeTime}</span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"text-sm font-medium text-gray-900\">${this.escapeHtml(providerName)}</span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"text-sm text-gray-700\">${this.escapeHtml(actionLabel)}</span>\n        </td>\n        <td class=\"px-4 py-3\">\n          ${entry.object_type && entry.object_id ? `\n            <a href=\"${this.buildObjectLinkUrl(entry.object_type, entry.object_id)}\"\n               class=\"activity-object-link text-sm text-blue-600 hover:text-blue-700\"\n               data-object-type=\"${this.escapeHtml(entry.object_type)}\"\n               data-object-id=\"${this.escapeHtml(entry.object_id)}\">\n              ${this.escapeHtml(entry.object_type)}:${this.escapeHtml(this.truncateId(entry.object_id))}\n            </a>\n          ` : '<span class=\"text-gray-400\"></span>'}\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${\n            entry.scope_type === 'user' ? 'bg-blue-50 text-blue-600' : 'bg-purple-50 text-purple-600'\n          }\">\n            ${this.escapeHtml(entry.scope_type)}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${status.bg} ${status.text}\">\n            ${renderIcon(status.icon, { size: '12px' })}\n            ${status.label}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"text-sm text-gray-500\">${this.escapeHtml(entry.channel || '')}</span>\n        </td>\n      </tr>\n    `;\n  }\n\n  private bindEntryActions(): void {\n    // Entry clicks for selection\n    const entries = this.container?.querySelectorAll<HTMLElement>('[data-entry-id]');\n    entries?.forEach((el) => {\n      const entryId = el.dataset.entryId;\n      if (!entryId) return;\n\n      el.addEventListener('click', (e) => {\n        // Skip if clicking a link\n        if ((e.target as HTMLElement).closest('a')) return;\n\n        const entry = this.getEntry(entryId);\n        if (entry && this.config.onSelect) {\n          this.config.onSelect(entry);\n        }\n      });\n    });\n\n    // Object links\n    const objectLinks = this.container?.querySelectorAll<HTMLAnchorElement>('.activity-object-link');\n    objectLinks?.forEach((link) => {\n      link.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const objectType = link.dataset.objectType;\n        const objectId = link.dataset.objectId;\n\n        if (!objectType || !objectId) return;\n\n        // Use custom onNavigate if provided\n        if (this.config.onNavigate) {\n          this.config.onNavigate(objectType, objectId);\n          return;\n        }\n\n        // Use deep links if enabled\n        if (this.config.useDeepLinks) {\n          const handler = this.createDeepLinkNavigateHandler();\n          handler(objectType, objectId);\n        }\n      });\n    });\n  }\n\n  /**\n   * Create a navigate handler that uses deep links with context preservation.\n   */\n  private createDeepLinkNavigateHandler(): (objectType: string, objectId: string) => void {\n    return createActivityNavigateHandler(\n      () => {\n        const state = this.queryState.getState();\n        return {\n          filters: state.filters as Record<string, string | undefined>,\n          search: state.search,\n          page: state.page,\n        };\n      },\n      () => this.state.viewMode\n    );\n  }\n\n  /**\n   * Build object link URL for an activity entry.\n   * Returns a deep link URL if deep links are enabled, otherwise '#'.\n   */\n  private buildObjectLinkUrl(objectType: string, objectId: string): string {\n    if (!this.config.useDeepLinks) {\n      return '#';\n    }\n\n    const entityType = mapObjectTypeToEntity(objectType);\n    if (!entityType) {\n      return '#';\n    }\n\n    // Build context for back navigation\n    const state = this.queryState.getState();\n    const context = {\n      fromPage: window.location.pathname,\n      filters: Object.fromEntries(\n        Object.entries(state.filters).filter(([, v]) => v)\n      ) as Record<string, string>,\n      search: state.search || undefined,\n      page: state.page > 1 ? state.page : undefined,\n      viewMode: this.state.viewMode,\n    };\n\n    return generateDeepLink(entityType, objectId, context);\n  }\n\n  private updateViewModeUI(): void {\n    const timelineBtn = this.container?.querySelector('.activity-view-timeline');\n    const tableBtn = this.container?.querySelector('.activity-view-table');\n\n    if (this.state.viewMode === 'timeline') {\n      timelineBtn?.classList.add('bg-white', 'text-gray-900', 'shadow-sm');\n      timelineBtn?.classList.remove('text-gray-600');\n      tableBtn?.classList.remove('bg-white', 'text-gray-900', 'shadow-sm');\n      tableBtn?.classList.add('text-gray-600');\n    } else {\n      tableBtn?.classList.add('bg-white', 'text-gray-900', 'shadow-sm');\n      tableBtn?.classList.remove('text-gray-600');\n      timelineBtn?.classList.remove('bg-white', 'text-gray-900', 'shadow-sm');\n      timelineBtn?.classList.add('text-gray-600');\n    }\n  }\n\n  private updateFilterSummary(): void {\n    const summaryEl = this.container?.querySelector('.activity-filter-summary');\n    if (!summaryEl) return;\n\n    const filterCount = this.queryState.getActiveFilterCount();\n    const state = this.queryState.getState();\n\n    if (filterCount === 0 && !state.search) {\n      summaryEl.textContent = `${this.state.total} entries`;\n    } else {\n      const parts: string[] = [];\n      if (state.search) parts.push(`\"${state.search}\"`);\n      if (filterCount > 0) parts.push(`${filterCount} filter${filterCount > 1 ? 's' : ''}`);\n      summaryEl.textContent = `${this.state.total} entries matching ${parts.join(' and ')}`;\n    }\n  }\n\n  private renderError(): void {\n    const timelineContainer = this.container?.querySelector('.activity-timeline');\n    const tbody = this.container?.querySelector('.activity-tbody');\n    const timelineWrapper = this.container?.querySelector('.activity-timeline-container');\n    const tableWrapper = this.container?.querySelector('.activity-table-container');\n    const emptyState = this.container?.querySelector('.activity-empty');\n\n    emptyState?.classList.add('hidden');\n\n    if (this.state.viewMode === 'timeline') {\n      timelineWrapper?.classList.remove('hidden');\n      tableWrapper?.classList.add('hidden');\n      if (timelineContainer) {\n        timelineContainer.innerHTML = renderErrorState({\n          title: 'Failed to load activity',\n          error: this.state.error,\n          containerClass: 'bg-white rounded-lg border border-gray-200',\n          showRetry: true,\n        });\n        const retryBtn = timelineContainer.querySelector('.ui-state-retry-btn');\n        retryBtn?.addEventListener('click', () => this.loadActivity());\n      }\n    } else {\n      tableWrapper?.classList.remove('hidden');\n      timelineWrapper?.classList.add('hidden');\n      if (tbody) {\n        tbody.innerHTML = renderTableErrorState(7, {\n          title: 'Failed to load activity',\n          error: this.state.error,\n          showRetry: true,\n        });\n        const retryBtn = tbody.querySelector('.ui-state-retry-btn');\n        retryBtn?.addEventListener('click', () => this.loadActivity());\n      }\n    }\n  }\n\n  private renderForbidden(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderForbiddenState({\n      resource: 'activity',\n    });\n  }\n\n  private updateLoadingState(): void {\n    const timelineContainer = this.container?.querySelector('.activity-timeline');\n    const tbody = this.container?.querySelector('.activity-tbody');\n    const timelineWrapper = this.container?.querySelector('.activity-timeline-container');\n    const tableWrapper = this.container?.querySelector('.activity-table-container');\n    const emptyState = this.container?.querySelector('.activity-empty');\n\n    if (!this.state.loading) return;\n\n    // Only show loading when there's no data yet\n    if (this.state.entries.length > 0) return;\n\n    emptyState?.classList.add('hidden');\n\n    if (this.state.viewMode === 'timeline') {\n      timelineWrapper?.classList.remove('hidden');\n      tableWrapper?.classList.add('hidden');\n      if (timelineContainer) {\n        timelineContainer.innerHTML = renderLoadingState({ text: 'Loading activity...' });\n      }\n    } else {\n      tableWrapper?.classList.remove('hidden');\n      timelineWrapper?.classList.add('hidden');\n      if (tbody) {\n        tbody.innerHTML = renderTableLoadingState(7, { text: 'Loading activity...' });\n      }\n    }\n  }\n\n  private updatePagination(): void {\n    const state = this.queryState.getState();\n    const { page, per_page } = state;\n    const { total } = this.state;\n\n    const start = total > 0 ? (page - 1) * per_page + 1 : 0;\n    const end = Math.min(page * per_page, total);\n    const hasNext = end < total;\n    const hasPrev = page > 1;\n\n    const infoEl = this.container?.querySelector('.activity-info');\n    const prevBtn = this.container?.querySelector<HTMLButtonElement>('.activity-prev');\n    const nextBtn = this.container?.querySelector<HTMLButtonElement>('.activity-next');\n\n    if (infoEl) {\n      infoEl.textContent = total > 0 ? `Showing ${start}-${end} of ${total}` : 'No activity';\n    }\n\n    if (prevBtn) {\n      prevBtn.disabled = !hasPrev;\n    }\n\n    if (nextBtn) {\n      nextBtn.disabled = !hasNext;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // View Mode Persistence\n  // ---------------------------------------------------------------------------\n\n  private restoreViewMode(): void {\n    // Check URL first\n    const params = new URLSearchParams(window.location.search);\n    const urlMode = params.get('view');\n    if (urlMode === 'timeline' || urlMode === 'table') {\n      this.state.viewMode = urlMode;\n      return;\n    }\n\n    // Check localStorage\n    try {\n      const stored = localStorage.getItem('services-activity-view');\n      if (stored === 'timeline' || stored === 'table') {\n        this.state.viewMode = stored;\n      }\n    } catch (e) {\n      // Ignore\n    }\n  }\n\n  private saveViewMode(): void {\n    try {\n      localStorage.setItem('services-activity-view', this.state.viewMode);\n    } catch (e) {\n      // Ignore\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private formatProviderId(id: string): string {\n    return id\n      .split(/[-_]/)\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  }\n\n  private formatLabel(str: string): string {\n    return str\n      .replace(/_/g, ' ')\n      .replace(/-/g, ' ')\n      .replace(/\\b\\w/g, (c) => c.toUpperCase());\n  }\n\n  private truncateId(id: string, maxLen = 12): string {\n    if (id.length <= maxLen) return id;\n    return `${id.slice(0, maxLen - 3)}...`;\n  }\n\n  private formatTime(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n    return date.toLocaleString();\n  }\n\n  private formatRelativeTime(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return 'Just now';\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n    if (diffDays < 7) return `${diffDays}d ago`;\n\n    return date.toLocaleDateString();\n  }\n\n  private formatMetadataPreview(metadata: Record<string, unknown>): string {\n    const entries = Object.entries(metadata).slice(0, 3);\n    return entries.map(([k, v]) => `${k}: ${JSON.stringify(v)}`).join(', ');\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create and initialize an activity page\n */\nexport async function createActivityPage(config: ActivityPageConfig): Promise<ActivityPageManager> {\n  const manager = new ActivityPageManager(config);\n  await manager.init();\n  return manager;\n}\n","/**\n * Subscriptions and Sync Page\n * Displays subscription channels and sync job status with management actions\n */\n\nimport type {\n  Connection,\n  ConnectionSyncSummary,\n  Provider,\n  Subscription,\n  SubscriptionStatus,\n  SubscriptionsListFilter,\n  SyncJob,\n  SyncJobStatus,\n  SyncJobMode,\n} from '../types.js';\nimport { ServicesAPIError } from '../types.js';\nimport { getServicesClient, type ServicesAPIClient } from '../api-client.js';\nimport { QueryStateManager, type QueryState } from '../query-state.js';\nimport { getPermissionManager, canViewServices, canEdit } from '../permissions.js';\nimport {\n  renderForbiddenState,\n  renderTableLoadingState,\n  renderTableErrorState,\n  renderTableNoResultsState,\n} from '../ui-states.js';\nimport {\n  withMutationFeedback,\n  confirmServiceAction,\n  ActionQueue,\n} from '../mutation-feedback.js';\nimport type { ToastNotifier } from '../../toast/types.js';\nimport { renderIcon } from '../../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport type SubscriptionsSyncTab = 'subscriptions' | 'sync';\n\nexport interface SubscriptionsSyncPageConfig {\n  /** Container element or selector */\n  container: string | HTMLElement;\n  /** API client (optional, uses default) */\n  apiClient?: ServicesAPIClient;\n  /** Toast notifier for messages */\n  notifier?: ToastNotifier;\n  /** Items per page (default: 25) */\n  perPage?: number;\n  /** Enable URL state sync (default: true) */\n  syncUrl?: boolean;\n  /** Initial tab (default: 'subscriptions') */\n  activeTab?: SubscriptionsSyncTab;\n  /** Callback when subscription is selected */\n  onSubscriptionSelect?: (subscription: Subscription) => void;\n  /** Callback when sync job is selected */\n  onSyncJobSelect?: (job: SyncJob) => void;\n  /** Custom provider name resolver */\n  getProviderName?: (providerId: string) => string;\n}\n\ninterface SubscriptionsSyncState {\n  providers: Provider[];\n  subscriptions: Subscription[];\n  subscriptionsTotal: number;\n  syncJobs: SyncJob[];\n  syncJobsTotal: number;\n  loading: boolean;\n  error: Error | null;\n  activeTab: SubscriptionsSyncTab;\n}\n\ntype SubscriptionsFilter = {\n  provider_id: string;\n  connection_id: string;\n  status: string;\n};\n\n// =============================================================================\n// Status Configurations\n// =============================================================================\n\nconst SUBSCRIPTION_STATUS_CONFIG: Record<\n  SubscriptionStatus,\n  { label: string; bg: string; text: string; icon: string }\n> = {\n  active: { label: 'Active', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  expired: { label: 'Expired', bg: 'bg-gray-100', text: 'text-gray-600', icon: 'iconoir:clock' },\n  cancelled: { label: 'Cancelled', bg: 'bg-gray-100', text: 'text-gray-500', icon: 'iconoir:cancel' },\n  errored: { label: 'Error', bg: 'bg-red-100', text: 'text-red-700', icon: 'iconoir:warning-circle' },\n};\n\nconst SYNC_STATUS_CONFIG: Record<SyncJobStatus, { label: string; bg: string; text: string; icon: string }> = {\n  queued: { label: 'Queued', bg: 'bg-gray-100', text: 'text-gray-600', icon: 'iconoir:clock' },\n  running: { label: 'Running', bg: 'bg-blue-100', text: 'text-blue-700', icon: 'iconoir:play' },\n  succeeded: { label: 'Succeeded', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  failed: { label: 'Failed', bg: 'bg-red-100', text: 'text-red-700', icon: 'iconoir:warning-circle' },\n};\n\nconst SYNC_MODE_CONFIG: Record<SyncJobMode, { label: string; description: string }> = {\n  bootstrap: { label: 'Bootstrap', description: 'Full initial sync' },\n  incremental: { label: 'Incremental', description: 'Delta changes only' },\n  backfill: { label: 'Backfill', description: 'Historical data recovery' },\n};\n\n// =============================================================================\n// Subscriptions Sync Page Manager\n// =============================================================================\n\nexport class SubscriptionsSyncPageManager {\n  private config: SubscriptionsSyncPageConfig;\n  private container: HTMLElement | null = null;\n  private client: ServicesAPIClient;\n  private queryState: QueryStateManager<SubscriptionsFilter>;\n  private state: SubscriptionsSyncState = {\n    providers: [],\n    subscriptions: [],\n    subscriptionsTotal: 0,\n    syncJobs: [],\n    syncJobsTotal: 0,\n    loading: false,\n    error: null,\n    activeTab: 'subscriptions',\n  };\n  private abortController: AbortController | null = null;\n  private actionQueue = new ActionQueue();\n\n  constructor(config: SubscriptionsSyncPageConfig) {\n    this.config = {\n      perPage: 25,\n      syncUrl: true,\n      activeTab: 'subscriptions',\n      ...config,\n    };\n    this.state.activeTab = this.config.activeTab || 'subscriptions';\n    this.client = config.apiClient || getServicesClient();\n\n    this.queryState = new QueryStateManager<SubscriptionsFilter>({\n      config: {\n        defaultPerPage: this.config.perPage,\n        onChange: () => this.loadData(),\n      },\n      filterFields: ['provider_id', 'connection_id', 'status'],\n      storageKey: 'services-subscriptions-sync',\n    });\n  }\n\n  /**\n   * Initialize the page\n   */\n  async init(): Promise<void> {\n    // Resolve container\n    this.container =\n      typeof this.config.container === 'string'\n        ? document.querySelector<HTMLElement>(this.config.container)\n        : this.config.container;\n\n    if (!this.container) {\n      console.error('[SubscriptionsSyncPage] Container not found:', this.config.container);\n      return;\n    }\n\n    // Check view permission\n    if (!canViewServices()()) {\n      this.renderForbidden();\n      return;\n    }\n\n    // Restore tab from URL\n    this.restoreTab();\n\n    // Initialize query state from URL\n    this.queryState.init();\n\n    // Render initial structure\n    this.renderStructure();\n    await this.loadProviders();\n    this.bindEvents();\n\n    // Load data\n    await this.loadData();\n  }\n\n  /**\n   * Refresh the data\n   */\n  async refresh(): Promise<void> {\n    await this.loadData();\n  }\n\n  /**\n   * Set active tab\n   */\n  setTab(tab: SubscriptionsSyncTab): void {\n    if (this.state.activeTab !== tab) {\n      this.state.activeTab = tab;\n      this.saveTab();\n      this.updateTabUI();\n      this.loadData();\n    }\n  }\n\n  /**\n   * Get active tab\n   */\n  getTab(): SubscriptionsSyncTab {\n    return this.state.activeTab;\n  }\n\n  /**\n   * Get subscriptions\n   */\n  getSubscriptions(): Subscription[] {\n    return [...this.state.subscriptions];\n  }\n\n  /**\n   * Get sync jobs\n   */\n  getSyncJobs(): SyncJob[] {\n    return [...this.state.syncJobs];\n  }\n\n  /**\n   * Destroy the manager\n   */\n  destroy(): void {\n    this.abortController?.abort();\n    this.queryState.destroy();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Data Loading\n  // ---------------------------------------------------------------------------\n\n  private async loadData(): Promise<void> {\n    if (!this.container) return;\n\n    // Cancel previous request\n    this.abortController?.abort();\n    this.abortController = new AbortController();\n\n    this.state.loading = true;\n    this.state.error = null;\n    this.updateLoadingState();\n\n    try {\n      const params = this.queryState.getQueryParams();\n\n      if (this.state.activeTab === 'subscriptions') {\n        await this.loadSubscriptions(params);\n      } else {\n        await this.loadSyncJobs(params);\n      }\n    } catch (err) {\n      if ((err as Error).name === 'AbortError') return;\n\n      this.state.error = err instanceof Error ? err : new Error(String(err));\n      this.renderError();\n\n      if (this.config.notifier) {\n        this.config.notifier.error(`Failed to load data: ${this.state.error.message}`);\n      }\n    } finally {\n      this.state.loading = false;\n      this.updateLoadingState();\n    }\n  }\n\n  private async loadSubscriptions(params: Record<string, string | number>): Promise<void> {\n    const filter: SubscriptionsListFilter = {\n      provider_id: params.provider_id as string | undefined,\n      connection_id: params.connection_id as string | undefined,\n      status: params.status as SubscriptionStatus | undefined,\n      q: params.q as string | undefined,\n      page: params.page as number,\n      per_page: params.per_page as number,\n    };\n\n    const response = await this.client.listSubscriptions(filter, this.abortController!.signal);\n\n    this.state.subscriptions = response.subscriptions;\n    this.state.subscriptionsTotal = response.total;\n    this.queryState.updateFromResponse(response.total, response.has_next);\n\n    this.renderSubscriptions();\n    this.updatePagination();\n  }\n\n  private async loadSyncJobs(params: Record<string, string | number>): Promise<void> {\n    const providerId = params.provider_id as string | undefined;\n    const connectionId = params.connection_id as string | undefined;\n    const statusFilter = params.status as SyncJobStatus | undefined;\n    const search = String(params.q || '').trim().toLowerCase();\n    const page = (params.page as number) || 1;\n    const perPage = (params.per_page as number) || this.config.perPage || 25;\n\n    const connections = await this.loadSyncConnections({\n      providerId,\n      connectionId,\n      signal: this.abortController?.signal,\n    });\n\n    const summaries = await Promise.all(\n      connections.map(async (connection) => {\n        try {\n          const response = await this.client.getSyncStatus(connection.id, this.abortController?.signal);\n          return { connection, summary: response.sync_summary };\n        } catch (err) {\n          if ((err as Error).name === 'AbortError') {\n            throw err;\n          }\n          return null;\n        }\n      })\n    );\n\n    const jobs = summaries\n      .filter((item): item is { connection: Connection; summary: ConnectionSyncSummary } => item !== null)\n      .map((item) => this.toSyncJob(item.connection, item.summary))\n      .filter((job): job is SyncJob => job !== null);\n\n    const filtered = jobs.filter((job) => {\n      if (statusFilter && job.status !== statusFilter) {\n        return false;\n      }\n      if (!search) {\n        return true;\n      }\n      return this.matchesSyncSearch(job, search);\n    });\n\n    const total = filtered.length;\n    const offset = (page - 1) * perPage;\n    const paged = filtered.slice(offset, offset + perPage);\n\n    this.state.syncJobs = paged;\n    this.state.syncJobsTotal = total;\n\n    this.renderSyncJobs();\n    this.updatePagination();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rendering\n  // ---------------------------------------------------------------------------\n\n  private renderStructure(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = `\n      <div class=\"subscriptions-sync-page\">\n        <!-- Tabs -->\n        <div class=\"tabs-header flex items-center gap-4 mb-4 border-b border-gray-200\">\n          <button type=\"button\"\n                  class=\"tab-subscriptions px-4 py-3 text-sm font-medium border-b-2 -mb-px transition-colors ${\n                    this.state.activeTab === 'subscriptions'\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }\">\n            ${renderIcon('iconoir:bell', { size: '16px' })}\n            <span class=\"ml-1.5\">Subscriptions</span>\n          </button>\n          <button type=\"button\"\n                  class=\"tab-sync px-4 py-3 text-sm font-medium border-b-2 -mb-px transition-colors ${\n                    this.state.activeTab === 'sync'\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }\">\n            ${renderIcon('iconoir:sync', { size: '16px' })}\n            <span class=\"ml-1.5\">Sync Jobs</span>\n          </button>\n        </div>\n\n        <!-- Filters -->\n        <div class=\"filters bg-white rounded-lg border border-gray-200 p-4 mb-4\">\n          <div class=\"flex flex-wrap items-center gap-3\">\n            <div class=\"flex-1 min-w-[200px]\">\n              <input type=\"text\"\n                     class=\"search-input w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                     placeholder=\"Search...\"\n                     data-filter=\"search\">\n            </div>\n\n            <select class=\"filter-provider px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                    data-filter=\"provider_id\">\n              <option value=\"\">All Providers</option>\n            </select>\n\n            <select class=\"filter-status px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                    data-filter=\"status\">\n              <option value=\"\">All Statuses</option>\n              ${this.state.activeTab === 'subscriptions' ? this.renderSubscriptionStatusOptions() : this.renderSyncStatusOptions()}\n            </select>\n\n            <button type=\"button\"\n                    class=\"reset-btn px-3 py-2 text-sm text-gray-600 hover:text-gray-800\"\n                    title=\"Reset filters\">\n              ${renderIcon('iconoir:refresh', { size: '16px' })}\n            </button>\n          </div>\n        </div>\n\n        <!-- Subscriptions Tab Content -->\n        <div class=\"subscriptions-content ${this.state.activeTab === 'subscriptions' ? '' : 'hidden'}\">\n          <div class=\"overflow-x-auto bg-white rounded-lg border border-gray-200\">\n            <table class=\"subscriptions-table w-full text-sm\">\n              <thead class=\"bg-gray-50 border-b border-gray-200\">\n                <tr>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Provider</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Resource</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Channel ID</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Status</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Expires</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Updated</th>\n                  <th class=\"px-4 py-3 text-right font-medium text-gray-600\">Actions</th>\n                </tr>\n              </thead>\n              <tbody class=\"subscriptions-tbody divide-y divide-gray-100\">\n                <!-- Subscriptions will be rendered here -->\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <!-- Sync Tab Content -->\n        <div class=\"sync-content ${this.state.activeTab === 'sync' ? '' : 'hidden'}\">\n          <div class=\"overflow-x-auto bg-white rounded-lg border border-gray-200\">\n            <table class=\"sync-table w-full text-sm\">\n              <thead class=\"bg-gray-50 border-b border-gray-200\">\n                <tr>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Provider</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Mode</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Status</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Cursor</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Last Run</th>\n                  <th class=\"px-4 py-3 text-left font-medium text-gray-600\">Error</th>\n                  <th class=\"px-4 py-3 text-right font-medium text-gray-600\">Actions</th>\n                </tr>\n              </thead>\n              <tbody class=\"sync-tbody divide-y divide-gray-100\">\n                <!-- Sync jobs will be rendered here -->\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <!-- Empty State -->\n        <div class=\"empty-state hidden py-12 text-center bg-white rounded-lg border border-gray-200\">\n          <div class=\"inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 mb-4\">\n            ${renderIcon('iconoir:bell-off', { size: '24px', extraClass: 'text-gray-400' })}\n          </div>\n          <h3 class=\"text-lg font-medium text-gray-900 empty-title\">No subscriptions found</h3>\n          <p class=\"text-sm text-gray-500 mt-1 empty-message\">Subscriptions will appear here when created.</p>\n        </div>\n\n        <!-- Pagination -->\n        <div class=\"pagination flex items-center justify-between mt-4\">\n          <div class=\"info text-sm text-gray-500\">\n            <!-- Info will be rendered here -->\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <button type=\"button\"\n                    class=\"prev-btn px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Previous\n            </button>\n            <button type=\"button\"\n                    class=\"next-btn px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    disabled>\n              Next\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Restore filter values from state\n    this.restoreFilterValues();\n  }\n\n  private renderSubscriptionStatusOptions(): string {\n    return Object.entries(SUBSCRIPTION_STATUS_CONFIG)\n      .map(([value, config]) => `<option value=\"${value}\">${config.label}</option>`)\n      .join('');\n  }\n\n  private renderSyncStatusOptions(): string {\n    return Object.entries(SYNC_STATUS_CONFIG)\n      .map(([value, config]) => `<option value=\"${value}\">${config.label}</option>`)\n      .join('');\n  }\n\n  private async loadProviders(): Promise<void> {\n    try {\n      const response = await this.client.listProviders();\n      this.state.providers = response.providers || [];\n      this.populateProviderFilterOptions();\n    } catch (err) {\n      this.state.providers = [];\n      this.config.notifier?.error(`Failed to load providers: ${(err as Error).message}`);\n    }\n  }\n\n  private populateProviderFilterOptions(): void {\n    const providerSelect = this.container?.querySelector<HTMLSelectElement>('[data-filter=\"provider_id\"]');\n    if (!providerSelect) return;\n\n    const selectedProviderId = this.queryState.getState().filters.provider_id || '';\n    const options = this.state.providers\n      .map((provider) => {\n        const displayName = this.config.getProviderName\n          ? this.config.getProviderName(provider.id)\n          : this.formatProviderId(provider.id);\n        return `<option value=\"${this.escapeHtml(provider.id)}\">${this.escapeHtml(displayName)}</option>`;\n      })\n      .join('');\n\n    providerSelect.innerHTML = `<option value=\"\">All Providers</option>${options}`;\n    providerSelect.value = selectedProviderId;\n  }\n\n  private restoreFilterValues(): void {\n    const state = this.queryState.getState();\n\n    const searchInput = this.container?.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    if (searchInput) {\n      searchInput.value = state.search || '';\n    }\n\n    const filterInputs = this.container?.querySelectorAll<HTMLInputElement | HTMLSelectElement>('[data-filter]');\n    filterInputs?.forEach((input) => {\n      const filterKey = input.dataset.filter as keyof SubscriptionsFilter | 'search';\n      if (filterKey === 'search') {\n        return;\n      }\n      input.value = state.filters[filterKey as keyof SubscriptionsFilter] || '';\n    });\n  }\n\n  private bindEvents(): void {\n    if (!this.container) return;\n\n    // Tab buttons\n    const subscriptionsTab = this.container.querySelector('.tab-subscriptions');\n    const syncTab = this.container.querySelector('.tab-sync');\n\n    subscriptionsTab?.addEventListener('click', () => this.setTab('subscriptions'));\n    syncTab?.addEventListener('click', () => this.setTab('sync'));\n\n    // Search input\n    const searchInput = this.container.querySelector<HTMLInputElement>('[data-filter=\"search\"]');\n    searchInput?.addEventListener('input', (e) => {\n      this.queryState.setSearch((e.target as HTMLInputElement).value);\n    });\n\n    // Filter selects\n    const filterSelects = this.container.querySelectorAll<HTMLSelectElement>('select[data-filter]');\n    filterSelects.forEach((select) => {\n      select.addEventListener('change', () => {\n        const filterKey = select.dataset.filter as keyof SubscriptionsFilter;\n        this.queryState.setFilter(filterKey, select.value || undefined);\n      });\n    });\n\n    // Reset button\n    const resetBtn = this.container.querySelector('.reset-btn');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n\n    // Pagination buttons\n    const prevBtn = this.container.querySelector('.prev-btn');\n    const nextBtn = this.container.querySelector('.next-btn');\n\n    prevBtn?.addEventListener('click', () => this.queryState.prevPage());\n    nextBtn?.addEventListener('click', () => this.queryState.nextPage());\n  }\n\n  private renderSubscriptions(): void {\n    const tbody = this.container?.querySelector('.subscriptions-tbody');\n    const emptyState = this.container?.querySelector('.empty-state');\n    const content = this.container?.querySelector('.subscriptions-content');\n\n    if (!tbody) return;\n\n    if (this.state.subscriptions.length === 0) {\n      // Determine if this is \"empty\" (no data) or \"no results\" (filters applied)\n      const hasFilters = this.queryState.getActiveFilterCount() > 0 || !!this.queryState.getState().search;\n\n      if (hasFilters) {\n        // Show no-results state in the table\n        content?.classList.remove('hidden');\n        emptyState?.classList.add('hidden');\n        tbody.innerHTML = renderTableNoResultsState(7, {\n          query: this.queryState.getState().search,\n          filterCount: this.queryState.getActiveFilterCount(),\n        });\n        this.bindNoResultsActions(tbody);\n      } else {\n        // Show empty state\n        tbody.innerHTML = '';\n        content?.classList.add('hidden');\n        emptyState?.classList.remove('hidden');\n        this.updateEmptyState('subscriptions');\n      }\n      return;\n    }\n\n    content?.classList.remove('hidden');\n    emptyState?.classList.add('hidden');\n\n    tbody.innerHTML = this.state.subscriptions.map((sub) => this.renderSubscriptionRow(sub)).join('');\n    this.bindSubscriptionActions();\n  }\n\n  private bindNoResultsActions(container: Element): void {\n    const resetBtn = container.querySelector('.ui-state-reset-btn');\n    resetBtn?.addEventListener('click', () => {\n      this.queryState.reset();\n      this.restoreFilterValues();\n    });\n  }\n\n  private renderSubscriptionRow(subscription: Subscription): string {\n    const status = SUBSCRIPTION_STATUS_CONFIG[subscription.status] || SUBSCRIPTION_STATUS_CONFIG.errored;\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(subscription.provider_id)\n      : this.formatProviderId(subscription.provider_id);\n\n    const expiresAt = subscription.expires_at ? this.formatRelativeTime(subscription.expires_at) : '';\n    const expiresTitle = subscription.expires_at ? this.formatTime(subscription.expires_at) : '';\n    const updatedAt = this.formatRelativeTime(subscription.updated_at);\n    const isExpiringSoon = subscription.expires_at && this.isExpiringSoon(subscription.expires_at);\n\n    return `\n      <tr class=\"subscription-row hover:bg-gray-50 cursor-pointer\" data-subscription-id=\"${this.escapeHtml(subscription.id)}\">\n        <td class=\"px-4 py-3\">\n          <span class=\"font-medium text-gray-900\">${this.escapeHtml(providerName)}</span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <div class=\"text-sm text-gray-700\">${this.escapeHtml(subscription.resource_type)}</div>\n          <div class=\"text-xs text-gray-500\" title=\"${this.escapeHtml(subscription.resource_id)}\">\n            ${this.escapeHtml(this.truncateId(subscription.resource_id))}\n          </div>\n        </td>\n        <td class=\"px-4 py-3\">\n          <code class=\"text-xs bg-gray-100 px-1.5 py-0.5 rounded\">${this.escapeHtml(this.truncateId(subscription.channel_id, 16))}</code>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${status.bg} ${status.text}\">\n            ${renderIcon(status.icon, { size: '12px' })}\n            ${status.label}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"${isExpiringSoon ? 'text-amber-600 font-medium' : 'text-gray-500'}\" title=\"${expiresTitle}\">\n            ${expiresAt}\n          </span>\n          ${isExpiringSoon ? renderIcon('iconoir:warning-triangle', { size: '12px', extraClass: 'inline ml-1 text-amber-500' }) : ''}\n        </td>\n        <td class=\"px-4 py-3 text-gray-500 text-xs\">\n          ${updatedAt}\n        </td>\n        <td class=\"px-4 py-3 text-right\">\n          ${this.buildSubscriptionActions(subscription)}\n        </td>\n      </tr>\n    `;\n  }\n\n  private buildSubscriptionActions(subscription: Subscription): string {\n    const actions: string[] = [];\n\n    if (subscription.status === 'active' && canEdit()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"action-renew p-1 text-gray-400 hover:text-blue-600\"\n                data-action=\"renew\"\n                title=\"Renew subscription\">\n          ${renderIcon('iconoir:refresh', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (subscription.status !== 'cancelled' && canEdit()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"action-cancel p-1 text-gray-400 hover:text-red-600\"\n                data-action=\"cancel\"\n                title=\"Cancel subscription\">\n          ${renderIcon('iconoir:cancel', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (actions.length === 0) {\n      return '<span class=\"text-gray-300 text-xs\"></span>';\n    }\n\n    return `<div class=\"flex items-center justify-end gap-1\">${actions.join('')}</div>`;\n  }\n\n  private bindSubscriptionActions(): void {\n    const rows = this.container?.querySelectorAll<HTMLTableRowElement>('.subscription-row');\n\n    rows?.forEach((row) => {\n      const subscriptionId = row.dataset.subscriptionId;\n      if (!subscriptionId) return;\n\n      // Row click for selection\n      row.addEventListener('click', (e) => {\n        if ((e.target as HTMLElement).closest('button')) return;\n\n        const subscription = this.state.subscriptions.find((s) => s.id === subscriptionId);\n        if (subscription && this.config.onSubscriptionSelect) {\n          this.config.onSubscriptionSelect(subscription);\n        }\n      });\n\n      // Action buttons\n      row.querySelectorAll<HTMLButtonElement>('button[data-action]').forEach((btn) => {\n        btn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          const action = btn.dataset.action;\n\n          switch (action) {\n            case 'renew':\n              await this.handleRenew(subscriptionId, btn);\n              break;\n            case 'cancel':\n              await this.handleCancel(subscriptionId, btn);\n              break;\n          }\n        });\n      });\n    });\n  }\n\n  private renderSyncJobs(): void {\n    const tbody = this.container?.querySelector('.sync-tbody');\n    const emptyState = this.container?.querySelector('.empty-state');\n    const content = this.container?.querySelector('.sync-content');\n\n    if (!tbody) return;\n\n    if (this.state.syncJobs.length === 0) {\n      // Determine if this is \"empty\" (no data) or \"no results\" (filters applied)\n      const hasFilters = this.queryState.getActiveFilterCount() > 0 || !!this.queryState.getState().search;\n\n      if (hasFilters) {\n        // Show no-results state in the table\n        content?.classList.remove('hidden');\n        emptyState?.classList.add('hidden');\n        tbody.innerHTML = renderTableNoResultsState(7, {\n          query: this.queryState.getState().search,\n          filterCount: this.queryState.getActiveFilterCount(),\n        });\n        this.bindNoResultsActions(tbody);\n      } else {\n        // Show empty state\n        tbody.innerHTML = '';\n        content?.classList.add('hidden');\n        emptyState?.classList.remove('hidden');\n        this.updateEmptyState('sync');\n      }\n      return;\n    }\n\n    content?.classList.remove('hidden');\n    emptyState?.classList.add('hidden');\n\n    tbody.innerHTML = this.state.syncJobs.map((job) => this.renderSyncJobRow(job)).join('');\n    this.bindSyncJobActions();\n  }\n\n  private renderSyncJobRow(job: SyncJob): string {\n    const status = SYNC_STATUS_CONFIG[job.status] || SYNC_STATUS_CONFIG.failed;\n    const mode = SYNC_MODE_CONFIG[job.mode] || SYNC_MODE_CONFIG.incremental;\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(job.provider_id)\n      : this.formatProviderId(job.provider_id);\n\n    const metadata = job.metadata as Record<string, unknown>;\n    const lastRunRaw = typeof metadata.last_synced_at === 'string' ? metadata.last_synced_at : '';\n    const lastRun = lastRunRaw ? this.formatRelativeTime(lastRunRaw) : this.formatRelativeTime(job.updated_at);\n    const errorText = typeof metadata.last_sync_error === 'string' ? metadata.last_sync_error : '';\n    const cursor = job.checkpoint || '';\n\n    return `\n      <tr class=\"sync-row hover:bg-gray-50 cursor-pointer\" data-job-id=\"${this.escapeHtml(job.id)}\">\n        <td class=\"px-4 py-3\">\n          <span class=\"font-medium text-gray-900\">${this.escapeHtml(providerName)}</span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-700\" title=\"${mode.description}\">\n            ${mode.label}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${status.bg} ${status.text}\">\n            ${renderIcon(status.icon, { size: '12px' })}\n            ${status.label}\n          </span>\n        </td>\n        <td class=\"px-4 py-3\">\n          ${cursor ? `\n            <code class=\"text-xs bg-gray-100 px-1.5 py-0.5 rounded\" title=\"${this.escapeHtml(cursor)}\">\n              ${this.escapeHtml(this.truncateId(cursor, 16))}\n            </code>\n          ` : '<span class=\"text-gray-400\"></span>'}\n        </td>\n        <td class=\"px-4 py-3 text-gray-500 text-sm\">\n          ${lastRun}\n        </td>\n        <td class=\"px-4 py-3 text-xs\">\n          ${errorText\n            ? `<span class=\"text-red-600\" title=\"${this.escapeHtml(errorText)}\">${this.escapeHtml(this.truncateId(errorText, 48))}</span>`\n            : '<span class=\"text-gray-400\"></span>'}\n        </td>\n        <td class=\"px-4 py-3 text-right\">\n          ${this.buildSyncJobActions(job)}\n        </td>\n      </tr>\n    `;\n  }\n\n  private buildSyncJobActions(job: SyncJob): string {\n    const actions: string[] = [];\n\n    if (job.status !== 'running' && canEdit()()) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"action-run p-1 text-gray-400 hover:text-green-600\"\n                data-action=\"run\"\n                title=\"Run sync now\">\n          ${renderIcon('iconoir:play', { size: '16px' })}\n        </button>\n      `);\n    }\n\n    if (actions.length === 0) {\n      return '<span class=\"text-gray-300 text-xs\"></span>';\n    }\n\n    return `<div class=\"flex items-center justify-end gap-1\">${actions.join('')}</div>`;\n  }\n\n  private bindSyncJobActions(): void {\n    const rows = this.container?.querySelectorAll<HTMLTableRowElement>('.sync-row');\n\n    rows?.forEach((row) => {\n      const jobId = row.dataset.jobId;\n      if (!jobId) return;\n\n      // Row click for selection\n      row.addEventListener('click', (e) => {\n        if ((e.target as HTMLElement).closest('button')) return;\n\n        const job = this.state.syncJobs.find((j) => j.id === jobId);\n        if (job && this.config.onSyncJobSelect) {\n          this.config.onSyncJobSelect(job);\n        }\n      });\n\n      // Action buttons\n      row.querySelectorAll<HTMLButtonElement>('button[data-action]').forEach((btn) => {\n        btn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          const action = btn.dataset.action;\n\n          if (action === 'run') {\n            await this.handleRunSync(jobId, btn);\n          }\n        });\n      });\n    });\n  }\n\n  private async handleRenew(subscriptionId: string, button?: HTMLButtonElement): Promise<void> {\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight(`renew-${subscriptionId}`)) return;\n\n    await this.actionQueue.execute(`renew-${subscriptionId}`, async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.renewSubscription(subscriptionId),\n        notifier: this.config.notifier,\n        successMessage: 'Subscription renewal initiated',\n        errorMessagePrefix: 'Failed to renew',\n        buttonConfig: button ? {\n          button,\n          loadingText: 'Renewing...',\n          successText: 'Renewed',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.loadData(),\n      });\n    });\n  }\n\n  private async handleCancel(subscriptionId: string, button?: HTMLButtonElement): Promise<void> {\n    // Show confirmation dialog\n    const confirmed = await confirmServiceAction({\n      action: 'cancel',\n      resourceType: 'subscription',\n    });\n    if (!confirmed) return;\n\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight(`cancel-${subscriptionId}`)) return;\n\n    await this.actionQueue.execute(`cancel-${subscriptionId}`, async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.cancelSubscription(subscriptionId),\n        notifier: this.config.notifier,\n        successMessage: 'Subscription cancelled',\n        errorMessagePrefix: 'Failed to cancel',\n        buttonConfig: button ? {\n          button,\n          loadingText: 'Cancelling...',\n          successText: 'Cancelled',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.loadData(),\n      });\n    });\n  }\n\n  private async handleRunSync(jobId: string, button?: HTMLButtonElement): Promise<void> {\n    const job = this.state.syncJobs.find((j) => j.id === jobId);\n    if (!job) return;\n\n    const metadata = job.metadata as Record<string, unknown>;\n    const resourceType = typeof metadata.run_resource_type === 'string' && metadata.run_resource_type\n      ? metadata.run_resource_type\n      : 'default';\n    const resourceId = typeof metadata.run_resource_id === 'string' && metadata.run_resource_id\n      ? metadata.run_resource_id\n      : 'default';\n\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight(`sync-${jobId}`)) return;\n\n    await this.actionQueue.execute(`sync-${jobId}`, async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.runSync(job.connection_id, {\n          provider_id: job.provider_id,\n          resource_type: resourceType,\n          resource_id: resourceId,\n        }),\n        notifier: this.config.notifier,\n        successMessage: 'Sync job started',\n        errorMessagePrefix: 'Failed to start sync',\n        buttonConfig: button ? {\n          button,\n          loadingText: 'Starting...',\n          successText: 'Started',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.loadData(),\n      });\n    });\n  }\n\n  private updateTabUI(): void {\n    const subscriptionsTab = this.container?.querySelector('.tab-subscriptions');\n    const syncTab = this.container?.querySelector('.tab-sync');\n    const subscriptionsContent = this.container?.querySelector('.subscriptions-content');\n    const syncContent = this.container?.querySelector('.sync-content');\n    const statusFilter = this.container?.querySelector<HTMLSelectElement>('[data-filter=\"status\"]');\n\n    if (this.state.activeTab === 'subscriptions') {\n      subscriptionsTab?.classList.add('border-blue-500', 'text-blue-600');\n      subscriptionsTab?.classList.remove('border-transparent', 'text-gray-500');\n      syncTab?.classList.remove('border-blue-500', 'text-blue-600');\n      syncTab?.classList.add('border-transparent', 'text-gray-500');\n      subscriptionsContent?.classList.remove('hidden');\n      syncContent?.classList.add('hidden');\n      if (statusFilter) {\n        statusFilter.innerHTML = `<option value=\"\">All Statuses</option>${this.renderSubscriptionStatusOptions()}`;\n        statusFilter.value = this.queryState.getState().filters.status || '';\n      }\n    } else {\n      syncTab?.classList.add('border-blue-500', 'text-blue-600');\n      syncTab?.classList.remove('border-transparent', 'text-gray-500');\n      subscriptionsTab?.classList.remove('border-blue-500', 'text-blue-600');\n      subscriptionsTab?.classList.add('border-transparent', 'text-gray-500');\n      syncContent?.classList.remove('hidden');\n      subscriptionsContent?.classList.add('hidden');\n      if (statusFilter) {\n        statusFilter.innerHTML = `<option value=\"\">All Statuses</option>${this.renderSyncStatusOptions()}`;\n        statusFilter.value = this.queryState.getState().filters.status || '';\n      }\n    }\n\n    this.restoreFilterValues();\n  }\n\n  private updateEmptyState(type: 'subscriptions' | 'sync'): void {\n    const title = this.container?.querySelector('.empty-title');\n    const message = this.container?.querySelector('.empty-message');\n\n    if (type === 'subscriptions') {\n      if (title) title.textContent = 'No subscriptions found';\n      if (message) message.textContent = 'Subscriptions will appear here when created.';\n    } else {\n      if (title) title.textContent = 'No sync jobs found';\n      if (message) message.textContent = 'Sync jobs will appear here when syncs are triggered.';\n    }\n  }\n\n  private renderError(): void {\n    const activeContent = this.state.activeTab === 'subscriptions' ? '.subscriptions-content' : '.sync-content';\n    const content = this.container?.querySelector(activeContent);\n    const emptyState = this.container?.querySelector('.empty-state');\n    const tbody =\n      this.state.activeTab === 'subscriptions'\n        ? this.container?.querySelector('.subscriptions-tbody')\n        : this.container?.querySelector('.sync-tbody');\n\n    if (!tbody) return;\n\n    const colspan = 7;\n    tbody.innerHTML = renderTableErrorState(colspan, {\n      title: `Failed to load ${this.state.activeTab === 'subscriptions' ? 'subscriptions' : 'sync jobs'}`,\n      error: this.state.error,\n      showRetry: true,\n    });\n\n    content?.classList.remove('hidden');\n    emptyState?.classList.add('hidden');\n\n    const retryBtn = tbody.querySelector('.ui-state-retry-btn');\n    retryBtn?.addEventListener('click', () => this.loadData());\n  }\n\n  private renderForbidden(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderForbiddenState({\n      resource: 'subscriptions and sync',\n    });\n  }\n\n  private updateLoadingState(): void {\n    const content =\n      this.state.activeTab === 'subscriptions'\n        ? this.container?.querySelector('.subscriptions-content')\n        : this.container?.querySelector('.sync-content');\n    const tbody =\n      this.state.activeTab === 'subscriptions'\n        ? this.container?.querySelector('.subscriptions-tbody')\n        : this.container?.querySelector('.sync-tbody');\n    const emptyState = this.container?.querySelector('.empty-state');\n\n    if (!this.state.loading || !tbody) return;\n\n    const items = this.state.activeTab === 'subscriptions' ? this.state.subscriptions : this.state.syncJobs;\n\n    if (items.length === 0) {\n      const colspan = 7;\n      const text = this.state.activeTab === 'subscriptions' ? 'Loading subscriptions...' : 'Loading sync jobs...';\n      content?.classList.remove('hidden');\n      emptyState?.classList.add('hidden');\n      tbody.innerHTML = renderTableLoadingState(colspan, { text });\n    }\n  }\n\n  private async loadSyncConnections(options: {\n    providerId?: string;\n    connectionId?: string;\n    signal?: AbortSignal;\n  }): Promise<Connection[]> {\n    const { providerId, connectionId, signal } = options;\n\n    if (connectionId) {\n      try {\n        const detail = await this.client.getConnectionDetail(connectionId, signal);\n        if (providerId && detail.connection.provider_id !== providerId) {\n          return [];\n        }\n        return [detail.connection];\n      } catch (err) {\n        if ((err as Error).name === 'AbortError') {\n          throw err;\n        }\n        if (err instanceof ServicesAPIError && err.isNotFound) {\n          return [];\n        }\n        throw err;\n      }\n    }\n\n    const response = await this.client.listConnections({\n      provider_id: providerId,\n      page: 1,\n      per_page: 200,\n    }, signal);\n    return response.connections;\n  }\n\n  private toSyncJob(connection: Connection, summary: ConnectionSyncSummary): SyncJob | null {\n    const firstCursor = summary.cursors[0];\n    const runResourceType = firstCursor?.resource_type || 'default';\n    const runResourceId = firstCursor?.resource_id || 'default';\n    const baseMetadata: Record<string, unknown> = {\n      ...(summary.last_job?.metadata || {}),\n      last_synced_at: summary.last_synced_at || null,\n      last_sync_error: summary.last_sync_error || '',\n      run_resource_type: runResourceType,\n      run_resource_id: runResourceId,\n    };\n\n    if (summary.last_job) {\n      return {\n        ...summary.last_job,\n        checkpoint: summary.last_cursor || summary.last_job.checkpoint,\n        metadata: baseMetadata,\n      };\n    }\n\n    if (!summary.last_cursor && !summary.last_synced_at && !summary.last_sync_error) {\n      return null;\n    }\n\n    return {\n      id: `synthetic-sync-${connection.id}`,\n      connection_id: connection.id,\n      provider_id: connection.provider_id,\n      mode: 'incremental',\n      checkpoint: summary.last_cursor || '',\n      status: summary.last_sync_error ? 'failed' : 'succeeded',\n      attempts: 0,\n      metadata: baseMetadata,\n      created_at: connection.created_at,\n      updated_at: summary.last_synced_at || connection.updated_at,\n    };\n  }\n\n  private matchesSyncSearch(job: SyncJob, query: string): boolean {\n    const metadata = job.metadata as Record<string, unknown>;\n    const haystack = [\n      job.id,\n      job.connection_id,\n      job.provider_id,\n      job.mode,\n      job.status,\n      job.checkpoint || '',\n      typeof metadata.last_sync_error === 'string' ? metadata.last_sync_error : '',\n    ]\n      .join(' ')\n      .toLowerCase();\n\n    return haystack.includes(query);\n  }\n\n  private updatePagination(): void {\n    const state = this.queryState.getState();\n    const { page, per_page } = state;\n    const total = this.state.activeTab === 'subscriptions' ? this.state.subscriptionsTotal : this.state.syncJobsTotal;\n\n    const start = total > 0 ? (page - 1) * per_page + 1 : 0;\n    const end = Math.min(page * per_page, total);\n    const hasNext = end < total;\n    const hasPrev = page > 1;\n\n    const infoEl = this.container?.querySelector('.info');\n    const prevBtn = this.container?.querySelector<HTMLButtonElement>('.prev-btn');\n    const nextBtn = this.container?.querySelector<HTMLButtonElement>('.next-btn');\n\n    const itemType = this.state.activeTab === 'subscriptions' ? 'subscriptions' : 'sync jobs';\n\n    if (infoEl) {\n      infoEl.textContent = total > 0 ? `Showing ${start}-${end} of ${total} ${itemType}` : `No ${itemType}`;\n    }\n\n    if (prevBtn) {\n      prevBtn.disabled = !hasPrev;\n    }\n\n    if (nextBtn) {\n      nextBtn.disabled = !hasNext;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Tab Persistence\n  // ---------------------------------------------------------------------------\n\n  private restoreTab(): void {\n    const params = new URLSearchParams(window.location.search);\n    const urlTab = params.get('tab');\n    if (urlTab === 'subscriptions' || urlTab === 'sync') {\n      this.state.activeTab = urlTab;\n    }\n  }\n\n  private saveTab(): void {\n    const params = new URLSearchParams(window.location.search);\n    params.set('tab', this.state.activeTab);\n    const newURL = `${window.location.pathname}?${params.toString()}`;\n    window.history.replaceState({}, '', newURL);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private formatProviderId(id: string): string {\n    return id\n      .split(/[-_]/)\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  }\n\n  private truncateId(id: string, maxLen = 12): string {\n    if (id.length <= maxLen) return id;\n    return `${id.slice(0, maxLen - 3)}...`;\n  }\n\n  private formatTime(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n    return date.toLocaleString();\n  }\n\n  private formatRelativeTime(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n\n    const now = new Date();\n    const diffMs = date.getTime() - now.getTime();\n    const isFuture = diffMs > 0;\n    const absDiffMs = Math.abs(diffMs);\n\n    const diffMins = Math.floor(absDiffMs / 60000);\n    const diffHours = Math.floor(absDiffMs / 3600000);\n    const diffDays = Math.floor(absDiffMs / 86400000);\n\n    if (diffMins < 1) return isFuture ? 'Soon' : 'Just now';\n    if (diffMins < 60) return isFuture ? `in ${diffMins}m` : `${diffMins}m ago`;\n    if (diffHours < 24) return isFuture ? `in ${diffHours}h` : `${diffHours}h ago`;\n    if (diffDays < 7) return isFuture ? `in ${diffDays}d` : `${diffDays}d ago`;\n\n    return date.toLocaleDateString();\n  }\n\n  private isExpiringSoon(dateStr: string): boolean {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return false;\n\n    const now = new Date();\n    const diffMs = date.getTime() - now.getTime();\n    // Expires within 24 hours\n    return diffMs > 0 && diffMs < 86400000;\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create and initialize a subscriptions/sync page\n */\nexport async function createSubscriptionsSyncPage(\n  config: SubscriptionsSyncPageConfig\n): Promise<SubscriptionsSyncPageManager> {\n  const manager = new SubscriptionsSyncPageManager(config);\n  await manager.init();\n  return manager;\n}\n","/**\n * Connection Detail Panel\n * Displays connection information with grant matrix and re-consent workflow\n */\n\nimport type {\n  Connection,\n  ConnectionStatus,\n  GrantSnapshot,\n  ProviderCapability,\n  Provider,\n  ScopeType,\n  ConnectionCredentialHealth,\n  ConnectionRateLimitSummary,\n} from '../types.js';\nimport { getServicesClient, type ServicesAPIClient } from '../api-client.js';\nimport {\n  getPermissionManager,\n  canViewServices,\n  canEdit,\n  canReconsent,\n  canRevoke,\n} from '../permissions.js';\nimport {\n  renderForbiddenState,\n  renderLoadingState,\n  renderErrorState,\n} from '../ui-states.js';\nimport {\n  withMutationFeedback,\n  confirmServiceAction,\n  ActionQueue,\n  MutationButtonManager,\n} from '../mutation-feedback.js';\nimport type { ToastNotifier } from '../../toast/types.js';\nimport { renderIcon } from '../../shared/icon-renderer.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface ConnectionDetailConfig {\n  /** Container element or selector */\n  container: string | HTMLElement;\n  /** Connection ID to display */\n  connectionId: string;\n  /** API client (optional, uses default) */\n  apiClient?: ServicesAPIClient;\n  /** Toast notifier for messages */\n  notifier?: ToastNotifier;\n  /** Custom provider name resolver */\n  getProviderName?: (providerId: string) => string;\n  /** Callback when re-consent is completed */\n  onReconsentComplete?: (connectionId: string) => void;\n  /** Callback when connection is revoked */\n  onRevoke?: (connectionId: string) => void;\n  /** Callback to navigate back to list */\n  onBack?: () => void;\n}\n\ninterface ConnectionDetailState {\n  connection: Connection | null;\n  grantSnapshot: GrantSnapshot | null;\n  provider: Provider | null;\n  credentialHealth: ConnectionCredentialHealth | null;\n  rateLimitSummary: ConnectionRateLimitSummary | null;\n  loading: boolean;\n  error: Error | null;\n  reconsentInProgress: boolean;\n}\n\ntype GrantStatus = 'granted' | 'requested' | 'missing' | 'capability_required';\n\ninterface GrantInfo {\n  grant: string;\n  status: GrantStatus;\n  isRequired: boolean;\n  isCapabilityRequired: boolean;\n  capabilities: string[];\n}\n\n// =============================================================================\n// Status Configuration\n// =============================================================================\n\nconst STATUS_CONFIG: Record<ConnectionStatus, { label: string; bg: string; text: string; icon: string }> = {\n  active: { label: 'Active', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check-circle' },\n  disconnected: { label: 'Disconnected', bg: 'bg-gray-100', text: 'text-gray-600', icon: 'iconoir:cancel' },\n  errored: { label: 'Error', bg: 'bg-red-100', text: 'text-red-700', icon: 'iconoir:warning-circle' },\n  pending_reauth: { label: 'Pending Reauth', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'iconoir:clock' },\n  needs_reconsent: { label: 'Needs Reconsent', bg: 'bg-orange-100', text: 'text-orange-700', icon: 'iconoir:refresh' },\n};\n\nconst GRANT_STATUS_CONFIG: Record<GrantStatus, { label: string; bg: string; text: string; icon: string }> = {\n  granted: { label: 'Granted', bg: 'bg-green-100', text: 'text-green-700', icon: 'iconoir:check' },\n  requested: { label: 'Requested', bg: 'bg-blue-100', text: 'text-blue-700', icon: 'iconoir:clock' },\n  missing: { label: 'Missing', bg: 'bg-gray-100', text: 'text-gray-500', icon: 'iconoir:minus' },\n  capability_required: { label: 'Required', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'iconoir:warning-triangle' },\n};\n\n// =============================================================================\n// Connection Detail Manager\n// =============================================================================\n\nexport class ConnectionDetailManager {\n  private config: ConnectionDetailConfig;\n  private container: HTMLElement | null = null;\n  private client: ServicesAPIClient;\n  private state: ConnectionDetailState = {\n    connection: null,\n    grantSnapshot: null,\n    provider: null,\n    credentialHealth: null,\n    rateLimitSummary: null,\n    loading: false,\n    error: null,\n    reconsentInProgress: false,\n  };\n  private abortController: AbortController | null = null;\n  private actionQueue = new ActionQueue();\n\n  constructor(config: ConnectionDetailConfig) {\n    this.config = config;\n    this.client = config.apiClient || getServicesClient();\n  }\n\n  /**\n   * Initialize the detail panel\n   */\n  async init(): Promise<void> {\n    // Resolve container\n    this.container =\n      typeof this.config.container === 'string'\n        ? document.querySelector<HTMLElement>(this.config.container)\n        : this.config.container;\n\n    if (!this.container) {\n      console.error('[ConnectionDetail] Container not found:', this.config.container);\n      return;\n    }\n\n    // Check view permission\n    if (!canViewServices()()) {\n      this.renderForbidden();\n      return;\n    }\n\n    // Load connection data\n    await this.loadConnection();\n  }\n\n  /**\n   * Refresh the connection data\n   */\n  async refresh(): Promise<void> {\n    await this.loadConnection();\n  }\n\n  /**\n   * Get the current connection\n   */\n  getConnection(): Connection | null {\n    return this.state.connection;\n  }\n\n  /**\n   * Get the grant snapshot\n   */\n  getGrantSnapshot(): GrantSnapshot | null {\n    return this.state.grantSnapshot;\n  }\n\n  /**\n   * Set the connection ID and reload\n   */\n  async setConnectionId(connectionId: string): Promise<void> {\n    this.config.connectionId = connectionId;\n    await this.loadConnection();\n  }\n\n  /**\n   * Destroy the manager\n   */\n  destroy(): void {\n    this.abortController?.abort();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Data Loading\n  // ---------------------------------------------------------------------------\n\n  private async loadConnection(): Promise<void> {\n    if (!this.container) return;\n\n    // Cancel previous request\n    this.abortController?.abort();\n    this.abortController = new AbortController();\n\n    this.state.loading = true;\n    this.state.error = null;\n    this.renderLoading();\n\n    try {\n      // Load connection, grants, and provider in parallel\n      const [detailResponse, grantsResponse, providersResponse] = await Promise.all([\n        this.client.getConnectionDetail(this.config.connectionId, this.abortController.signal),\n        this.client.getConnectionGrants(this.config.connectionId, this.abortController.signal),\n        this.client.listProviders(this.abortController.signal),\n      ]);\n\n      const connection = detailResponse.connection;\n\n      this.state.connection = connection;\n      this.state.grantSnapshot = grantsResponse.snapshot;\n      this.state.provider = providersResponse.providers.find((p) => p.id === connection.provider_id) || null;\n      this.state.credentialHealth = detailResponse.credential_health || null;\n      this.state.rateLimitSummary = detailResponse.rate_limit_summary || null;\n\n      this.render();\n    } catch (err) {\n      if ((err as Error).name === 'AbortError') return;\n\n      this.state.error = err instanceof Error ? err : new Error(String(err));\n      this.renderError();\n\n      if (this.config.notifier) {\n        this.config.notifier.error(`Failed to load connection: ${this.state.error.message}`);\n      }\n    } finally {\n      this.state.loading = false;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rendering\n  // ---------------------------------------------------------------------------\n\n  private render(): void {\n    if (!this.container || !this.state.connection) return;\n\n    const connection = this.state.connection;\n    const status = STATUS_CONFIG[connection.status] || STATUS_CONFIG.disconnected;\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(connection.provider_id)\n      : this.formatProviderId(connection.provider_id);\n\n    const grantInfoList = this.buildGrantInfoList();\n    const hasMissingRequired = grantInfoList.some((g) => g.status === 'capability_required');\n    const needsReconsent = connection.status === 'needs_reconsent' || hasMissingRequired;\n\n    this.container.innerHTML = `\n      <div class=\"connection-detail\">\n        <!-- Header -->\n        <div class=\"detail-header flex items-center justify-between mb-6\">\n          <div class=\"flex items-center gap-4\">\n            ${this.config.onBack ? `\n              <button type=\"button\" class=\"back-btn p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100\">\n                ${renderIcon('iconoir:arrow-left', { size: '20px' })}\n              </button>\n            ` : ''}\n            <div>\n              <h2 class=\"text-xl font-semibold text-gray-900\">${this.escapeHtml(providerName)}</h2>\n              <p class=\"text-sm text-gray-500 mt-0.5\">Connection Details</p>\n            </div>\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <span class=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${status.bg} ${status.text}\">\n              ${renderIcon(status.icon, { size: '16px' })}\n              ${status.label}\n            </span>\n          </div>\n        </div>\n\n        <!-- Info Cards -->\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n          <div class=\"info-card bg-white rounded-lg border border-gray-200 p-4\">\n            <dt class=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Scope</dt>\n            <dd class=\"mt-1 flex items-center gap-2\">\n              <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${\n                connection.scope_type === 'user' ? 'bg-blue-50 text-blue-600' : 'bg-purple-50 text-purple-600'\n              }\">\n                ${this.escapeHtml(connection.scope_type)}\n              </span>\n              <span class=\"text-sm text-gray-700\" title=\"${this.escapeHtml(connection.scope_id)}\">\n                ${this.escapeHtml(this.truncateId(connection.scope_id, 16))}\n              </span>\n            </dd>\n          </div>\n\n          <div class=\"info-card bg-white rounded-lg border border-gray-200 p-4\">\n            <dt class=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">External Account</dt>\n            <dd class=\"mt-1 text-sm text-gray-700\" title=\"${this.escapeHtml(connection.external_account_id)}\">\n              ${this.escapeHtml(this.truncateId(connection.external_account_id, 20))}\n            </dd>\n          </div>\n\n          <div class=\"info-card bg-white rounded-lg border border-gray-200 p-4\">\n            <dt class=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Created</dt>\n            <dd class=\"mt-1 text-sm text-gray-700\">\n              ${this.formatTime(connection.created_at)}\n            </dd>\n          </div>\n\n          <div class=\"info-card bg-white rounded-lg border border-gray-200 p-4\">\n            <dt class=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Last Updated</dt>\n            <dd class=\"mt-1 text-sm text-gray-700\">\n              ${this.formatTime(connection.updated_at)}\n            </dd>\n          </div>\n        </div>\n\n        ${connection.last_error ? `\n          <div class=\"error-banner flex items-start gap-3 p-4 mb-6 bg-red-50 border border-red-200 rounded-lg\">\n            <div class=\"flex-shrink-0 text-red-500\">\n              ${renderIcon('iconoir:warning-circle', { size: '20px' })}\n            </div>\n            <div>\n              <h4 class=\"text-sm font-medium text-red-800\">Last Error</h4>\n              <p class=\"text-sm text-red-700 mt-1\">${this.escapeHtml(connection.last_error)}</p>\n            </div>\n          </div>\n        ` : ''}\n\n        ${needsReconsent ? `\n          <div class=\"reconsent-banner flex items-center justify-between p-4 mb-6 bg-amber-50 border border-amber-200 rounded-lg\">\n            <div class=\"flex items-start gap-3\">\n              <div class=\"flex-shrink-0 text-amber-500\">\n                ${renderIcon('iconoir:warning-triangle', { size: '20px' })}\n              </div>\n              <div>\n                <h4 class=\"text-sm font-medium text-amber-800\">Re-consent Required</h4>\n                <p class=\"text-sm text-amber-700 mt-1\">\n                  ${hasMissingRequired\n                    ? 'Some required permissions are missing. Re-consent to restore full functionality.'\n                    : 'This connection needs re-authorization to continue working.'}\n                </p>\n              </div>\n            </div>\n            ${canReconsent()() ? `\n              <button type=\"button\"\n                      class=\"reconsent-btn flex-shrink-0 px-4 py-2 text-sm font-medium text-white bg-amber-600 rounded-lg hover:bg-amber-700 focus:ring-2 focus:ring-amber-500 focus:ring-offset-2\">\n                Re-consent Now\n              </button>\n            ` : ''}\n          </div>\n        ` : ''}\n\n        <!-- Grant Matrix -->\n        <div class=\"grant-matrix bg-white rounded-lg border border-gray-200\">\n          <div class=\"px-4 py-3 border-b border-gray-200\">\n            <div class=\"flex items-center justify-between\">\n              <h3 class=\"text-lg font-medium text-gray-900\">Permissions</h3>\n              ${this.state.grantSnapshot ? `\n                <span class=\"text-xs text-gray-500\">\n                  Version ${this.state.grantSnapshot.version}  Captured ${this.formatRelativeTime(this.state.grantSnapshot.captured_at)}\n                </span>\n              ` : ''}\n            </div>\n          </div>\n\n          <div class=\"divide-y divide-gray-100\">\n            ${this.renderGrantMatrix(grantInfoList)}\n          </div>\n\n          ${grantInfoList.length === 0 ? `\n            <div class=\"px-4 py-8 text-center\">\n              <p class=\"text-sm text-gray-500\">No permissions configured for this connection.</p>\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- Capabilities Section -->\n        ${this.state.provider && this.state.provider.capabilities.length > 0 ? `\n          <div class=\"capabilities-section mt-6 bg-white rounded-lg border border-gray-200\">\n            <div class=\"px-4 py-3 border-b border-gray-200\">\n              <h3 class=\"text-lg font-medium text-gray-900\">Capabilities</h3>\n            </div>\n            <div class=\"p-4\">\n              <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                ${this.renderCapabilities()}\n              </div>\n            </div>\n          </div>\n        ` : ''}\n\n        <!-- Operational Status Panels -->\n        <div class=\"operational-panels grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\">\n          <!-- Credential Health Panel -->\n          ${this.renderCredentialHealthPanel()}\n\n          <!-- Rate Limit / Quota Panel -->\n          ${this.renderRateLimitPanel()}\n        </div>\n\n        <!-- Actions -->\n        <div class=\"actions flex items-center justify-end gap-3 mt-6 pt-6 border-t border-gray-200\">\n          ${canEdit()() && connection.status === 'active' ? `\n            <button type=\"button\"\n                    class=\"refresh-btn px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\">\n              ${renderIcon('iconoir:refresh', { size: '16px', extraClass: 'mr-1.5' })}\n              Refresh Credentials\n            </button>\n          ` : ''}\n          ${canRevoke()() && connection.status !== 'disconnected' ? `\n            <button type=\"button\"\n                    class=\"revoke-btn px-4 py-2 text-sm font-medium text-red-600 bg-white border border-red-300 rounded-lg hover:bg-red-50 focus:ring-2 focus:ring-red-500 focus:ring-offset-2\">\n              ${renderIcon('iconoir:cancel', { size: '16px', extraClass: 'mr-1.5' })}\n              Revoke Connection\n            </button>\n          ` : ''}\n        </div>\n      </div>\n    `;\n\n    this.bindEvents();\n  }\n\n  private renderGrantMatrix(grantInfoList: GrantInfo[]): string {\n    if (grantInfoList.length === 0) {\n      return '';\n    }\n\n    return grantInfoList\n      .map((grantInfo) => {\n        const statusConfig = GRANT_STATUS_CONFIG[grantInfo.status];\n        const capabilitiesList = grantInfo.capabilities.length > 0\n          ? grantInfo.capabilities.map((c) => this.formatLabel(c)).join(', ')\n          : null;\n\n        return `\n          <div class=\"grant-row flex items-center justify-between px-4 py-3 hover:bg-gray-50\">\n            <div class=\"flex-1 min-w-0\">\n              <div class=\"flex items-center gap-2\">\n                <code class=\"text-sm font-mono text-gray-700\">${this.escapeHtml(grantInfo.grant)}</code>\n                ${grantInfo.isCapabilityRequired ? `\n                  <span class=\"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-purple-50 text-purple-600\" title=\"Required by capabilities\">\n                    ${renderIcon('iconoir:puzzle', { size: '10px', extraClass: 'mr-0.5' })}\n                    Required\n                  </span>\n                ` : ''}\n              </div>\n              ${capabilitiesList ? `\n                <p class=\"text-xs text-gray-500 mt-0.5\">\n                  Used by: ${this.escapeHtml(capabilitiesList)}\n                </p>\n              ` : ''}\n            </div>\n            <div class=\"flex-shrink-0\">\n              <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${statusConfig.bg} ${statusConfig.text}\">\n                ${renderIcon(statusConfig.icon, { size: '12px' })}\n                ${statusConfig.label}\n              </span>\n            </div>\n          </div>\n        `;\n      })\n      .join('');\n  }\n\n  private renderCapabilities(): string {\n    if (!this.state.provider || !this.state.grantSnapshot) {\n      return '';\n    }\n\n    return this.state.provider.capabilities\n      .map((capability) => {\n        const grantedGrants = new Set(this.state.grantSnapshot!.granted_grants);\n        const hasAllRequired = capability.required_grants.every((g) => grantedGrants.has(g));\n        const hasAllOptional = capability.optional_grants.every((g) => grantedGrants.has(g));\n\n        const isFullyEnabled = hasAllRequired && hasAllOptional;\n        const isPartiallyEnabled = hasAllRequired && !hasAllOptional;\n        const isBlocked = !hasAllRequired;\n\n        let statusLabel: string;\n        let statusClass: string;\n        let statusIcon: string;\n\n        if (isFullyEnabled) {\n          statusLabel = 'Fully Enabled';\n          statusClass = 'bg-green-100 text-green-700';\n          statusIcon = 'iconoir:check-circle';\n        } else if (isPartiallyEnabled) {\n          statusLabel = 'Partially Enabled';\n          statusClass = 'bg-blue-100 text-blue-700';\n          statusIcon = 'iconoir:half-moon';\n        } else {\n          statusLabel = capability.denied_behavior === 'block' ? 'Blocked' : 'Degraded';\n          statusClass = capability.denied_behavior === 'block' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700';\n          statusIcon = capability.denied_behavior === 'block' ? 'iconoir:lock' : 'iconoir:warning-triangle';\n        }\n\n        return `\n          <div class=\"capability-card border border-gray-200 rounded-lg p-3\">\n            <div class=\"flex items-start justify-between\">\n              <div>\n                <h4 class=\"text-sm font-medium text-gray-900\">${this.escapeHtml(this.formatLabel(capability.name))}</h4>\n                <p class=\"text-xs text-gray-500 mt-0.5\">\n                  ${capability.required_grants.length} required, ${capability.optional_grants.length} optional\n                </p>\n              </div>\n              <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${statusClass}\">\n                ${renderIcon(statusIcon, { size: '12px' })}\n                ${statusLabel}\n              </span>\n            </div>\n            ${isBlocked && capability.denied_behavior === 'block' ? `\n              <p class=\"text-xs text-red-600 mt-2\">\n                Missing required: ${capability.required_grants.filter((g) => !grantedGrants.has(g)).join(', ')}\n              </p>\n            ` : ''}\n          </div>\n        `;\n      })\n      .join('');\n  }\n\n  private renderCredentialHealthPanel(): string {\n    const health = this.state.credentialHealth;\n    if (!health) {\n      return '';\n    }\n\n    // Determine overall health status\n    let healthStatus: 'healthy' | 'warning' | 'error' = 'healthy';\n    let healthLabel = 'Healthy';\n    let healthClass = 'bg-green-100 text-green-700 border-green-200';\n    let healthIcon = 'iconoir:shield-check';\n\n    if (!health.has_active_credential) {\n      healthStatus = 'error';\n      healthLabel = 'No Active Credential';\n      healthClass = 'bg-red-100 text-red-700 border-red-200';\n      healthIcon = 'iconoir:warning-circle';\n    } else if (health.last_error) {\n      healthStatus = 'error';\n      healthLabel = 'Credential Error';\n      healthClass = 'bg-red-100 text-red-700 border-red-200';\n      healthIcon = 'iconoir:warning-circle';\n    } else if (health.expires_at) {\n      const expiresAt = new Date(health.expires_at);\n      const now = new Date();\n      const hoursUntilExpiry = (expiresAt.getTime() - now.getTime()) / (1000 * 60 * 60);\n      if (hoursUntilExpiry < 0) {\n        healthStatus = 'error';\n        healthLabel = 'Expired';\n        healthClass = 'bg-red-100 text-red-700 border-red-200';\n        healthIcon = 'iconoir:clock';\n      } else if (hoursUntilExpiry < 24) {\n        healthStatus = 'warning';\n        healthLabel = 'Expiring Soon';\n        healthClass = 'bg-amber-100 text-amber-700 border-amber-200';\n        healthIcon = 'iconoir:clock';\n      }\n    }\n\n    return `\n      <div class=\"credential-health-panel bg-white rounded-lg border ${healthStatus === 'healthy' ? 'border-gray-200' : healthStatus === 'warning' ? 'border-amber-200' : 'border-red-200'}\">\n        <div class=\"px-4 py-3 border-b border-gray-200 flex items-center justify-between\">\n          <h3 class=\"text-lg font-medium text-gray-900 flex items-center gap-2\">\n            ${renderIcon('iconoir:key', { size: '20px' })}\n            Credential Health\n          </h3>\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${healthClass}\">\n            ${renderIcon(healthIcon, { size: '12px' })}\n            ${healthLabel}\n          </span>\n        </div>\n        <div class=\"p-4 space-y-3\">\n          <!-- Status Row -->\n          <div class=\"flex items-center justify-between py-2 border-b border-gray-100\">\n            <span class=\"text-sm text-gray-600\">Active Credential</span>\n            <span class=\"text-sm font-medium ${health.has_active_credential ? 'text-green-600' : 'text-red-600'}\">\n              ${health.has_active_credential ? 'Yes' : 'No'}\n            </span>\n          </div>\n          <div class=\"flex items-center justify-between py-2 border-b border-gray-100\">\n            <span class=\"text-sm text-gray-600\">Refreshable</span>\n            <span class=\"text-sm font-medium ${health.refreshable ? 'text-green-600' : 'text-gray-500'}\">\n              ${health.refreshable ? 'Yes' : 'No'}\n            </span>\n          </div>\n          ${health.expires_at ? `\n            <div class=\"flex items-center justify-between py-2 border-b border-gray-100\">\n              <span class=\"text-sm text-gray-600\">Expires At</span>\n              <span class=\"text-sm font-medium text-gray-900\" title=\"${this.escapeHtml(health.expires_at)}\">\n                ${this.formatRelativeTime(health.expires_at)}\n              </span>\n            </div>\n          ` : ''}\n          ${health.last_refresh_at ? `\n            <div class=\"flex items-center justify-between py-2 border-b border-gray-100\">\n              <span class=\"text-sm text-gray-600\">Last Refresh</span>\n              <span class=\"text-sm font-medium text-gray-900\" title=\"${this.escapeHtml(health.last_refresh_at)}\">\n                ${this.formatRelativeTime(health.last_refresh_at)}\n              </span>\n            </div>\n          ` : ''}\n          ${health.next_refresh_attempt_at ? `\n            <div class=\"flex items-center justify-between py-2 border-b border-gray-100\">\n              <span class=\"text-sm text-gray-600\">Next Refresh</span>\n              <span class=\"text-sm font-medium text-gray-900\" title=\"${this.escapeHtml(health.next_refresh_attempt_at)}\">\n                ${this.formatRelativeTime(health.next_refresh_attempt_at)}\n              </span>\n            </div>\n          ` : ''}\n          ${health.last_error ? `\n            <div class=\"mt-3 p-3 bg-red-50 border border-red-100 rounded-lg\">\n              <div class=\"flex items-start gap-2\">\n                ${renderIcon('iconoir:warning-circle', { size: '16px', extraClass: 'text-red-500 mt-0.5 flex-shrink-0' })}\n                <p class=\"text-sm text-red-700\">${this.escapeHtml(health.last_error)}</p>\n              </div>\n            </div>\n          ` : ''}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderRateLimitPanel(): string {\n    const rateLimit = this.state.rateLimitSummary;\n    if (!rateLimit) {\n      return '';\n    }\n\n    // Determine rate limit status\n    let limitStatus: 'healthy' | 'warning' | 'exhausted' = 'healthy';\n    let limitLabel = 'Normal';\n    let limitClass = 'bg-green-100 text-green-700';\n    let limitIcon = 'iconoir:check-circle';\n\n    if (rateLimit.exhausted_buckets > 0) {\n      const exhaustedRatio = rateLimit.exhausted_buckets / Math.max(rateLimit.total_buckets, 1);\n      if (exhaustedRatio >= 1) {\n        limitStatus = 'exhausted';\n        limitLabel = 'All Limits Exhausted';\n        limitClass = 'bg-red-100 text-red-700';\n        limitIcon = 'iconoir:warning-circle';\n      } else if (exhaustedRatio >= 0.5) {\n        limitStatus = 'warning';\n        limitLabel = 'High Usage';\n        limitClass = 'bg-amber-100 text-amber-700';\n        limitIcon = 'iconoir:warning-triangle';\n      } else {\n        limitStatus = 'warning';\n        limitLabel = 'Some Limits Hit';\n        limitClass = 'bg-amber-100 text-amber-700';\n        limitIcon = 'iconoir:clock';\n      }\n    }\n\n    // Calculate usage percentage\n    const usagePercent = rateLimit.total_buckets > 0\n      ? Math.round((rateLimit.exhausted_buckets / rateLimit.total_buckets) * 100)\n      : 0;\n\n    return `\n      <div class=\"rate-limit-panel bg-white rounded-lg border ${limitStatus === 'healthy' ? 'border-gray-200' : limitStatus === 'warning' ? 'border-amber-200' : 'border-red-200'}\">\n        <div class=\"px-4 py-3 border-b border-gray-200 flex items-center justify-between\">\n          <h3 class=\"text-lg font-medium text-gray-900 flex items-center gap-2\">\n            ${renderIcon('iconoir:graph-up', { size: '20px' })}\n            Rate Limits\n          </h3>\n          <span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${limitClass}\">\n            ${renderIcon(limitIcon, { size: '12px' })}\n            ${limitLabel}\n          </span>\n        </div>\n        <div class=\"p-4 space-y-3\">\n          <!-- Usage Bar -->\n          <div>\n            <div class=\"flex items-center justify-between mb-1\">\n              <span class=\"text-sm text-gray-600\">Bucket Usage</span>\n              <span class=\"text-sm font-medium text-gray-900\">\n                ${rateLimit.exhausted_buckets} / ${rateLimit.total_buckets} exhausted\n              </span>\n            </div>\n            <div class=\"w-full h-2 bg-gray-200 rounded-full overflow-hidden\">\n              <div class=\"h-full transition-all duration-300 ${\n                limitStatus === 'healthy' ? 'bg-green-500' :\n                limitStatus === 'warning' ? 'bg-amber-500' : 'bg-red-500'\n              }\" style=\"width: ${usagePercent}%\"></div>\n            </div>\n          </div>\n\n          ${rateLimit.next_reset_at ? `\n            <div class=\"flex items-center justify-between py-2 border-b border-gray-100\">\n              <span class=\"text-sm text-gray-600\">Next Reset</span>\n              <span class=\"text-sm font-medium text-gray-900\" title=\"${this.escapeHtml(rateLimit.next_reset_at)}\">\n                ${this.formatRelativeTime(rateLimit.next_reset_at)}\n              </span>\n            </div>\n          ` : ''}\n\n          ${rateLimit.max_retry_after_seconds > 0 ? `\n            <div class=\"flex items-center justify-between py-2 border-b border-gray-100\">\n              <span class=\"text-sm text-gray-600\">Max Retry After</span>\n              <span class=\"text-sm font-medium text-gray-900\">\n                ${this.formatDuration(rateLimit.max_retry_after_seconds)}\n              </span>\n            </div>\n          ` : ''}\n\n          ${limitStatus === 'exhausted' ? `\n            <div class=\"mt-3 p-3 bg-red-50 border border-red-100 rounded-lg\">\n              <div class=\"flex items-start gap-2\">\n                ${renderIcon('iconoir:warning-circle', { size: '16px', extraClass: 'text-red-500 mt-0.5 flex-shrink-0' })}\n                <p class=\"text-sm text-red-700\">\n                  All rate limit buckets are exhausted. API requests may be throttled until limits reset.\n                </p>\n              </div>\n            </div>\n          ` : ''}\n        </div>\n      </div>\n    `;\n  }\n\n  private formatDuration(seconds: number): string {\n    if (seconds < 60) {\n      return `${seconds}s`;\n    }\n    if (seconds < 3600) {\n      const mins = Math.floor(seconds / 60);\n      return `${mins}m`;\n    }\n    const hours = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n  }\n\n  private formatRelativeTime(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n\n    const now = new Date();\n    const diffMs = date.getTime() - now.getTime();\n    const isFuture = diffMs > 0;\n    const absDiffMs = Math.abs(diffMs);\n    const absDiffMins = Math.floor(absDiffMs / 60000);\n    const absDiffHours = Math.floor(absDiffMs / 3600000);\n    const absDiffDays = Math.floor(absDiffMs / 86400000);\n\n    if (absDiffMins < 1) return isFuture ? 'in a moment' : 'just now';\n    if (absDiffMins < 60) return isFuture ? `in ${absDiffMins}m` : `${absDiffMins}m ago`;\n    if (absDiffHours < 24) return isFuture ? `in ${absDiffHours}h` : `${absDiffHours}h ago`;\n    if (absDiffDays < 7) return isFuture ? `in ${absDiffDays}d` : `${absDiffDays}d ago`;\n\n    return date.toLocaleDateString();\n  }\n\n  private bindEvents(): void {\n    if (!this.container) return;\n\n    // Back button\n    const backBtn = this.container.querySelector('.back-btn');\n    backBtn?.addEventListener('click', () => {\n      this.config.onBack?.();\n    });\n\n    // Re-consent button\n    const reconsentBtn = this.container.querySelector('.reconsent-btn');\n    reconsentBtn?.addEventListener('click', () => this.handleReconsent());\n\n    // Refresh button\n    const refreshBtn = this.container.querySelector('.refresh-btn');\n    refreshBtn?.addEventListener('click', () => this.handleRefresh());\n\n    // Revoke button\n    const revokeBtn = this.container.querySelector('.revoke-btn');\n    revokeBtn?.addEventListener('click', () => this.handleRevoke());\n  }\n\n  private async handleReconsent(): Promise<void> {\n    if (!this.state.connection || this.state.reconsentInProgress) return;\n\n    this.state.reconsentInProgress = true;\n    this.updateReconsentButtonState();\n\n    try {\n      // Calculate additional grants needed\n      const grantInfoList = this.buildGrantInfoList();\n      const missingRequired = grantInfoList\n        .filter((g) => g.status === 'capability_required')\n        .map((g) => g.grant);\n\n      const response = await this.client.beginReconsent(this.config.connectionId, {\n        requested_grants: missingRequired.length > 0 ? missingRequired : undefined,\n      });\n\n      if (response.begin?.authorize_url) {\n        this.config.onReconsentComplete?.(this.config.connectionId);\n        window.location.href = response.begin.authorize_url;\n      }\n    } catch (err) {\n      this.config.notifier?.error(`Failed to start re-consent: ${(err as Error).message}`);\n      this.state.reconsentInProgress = false;\n      this.updateReconsentButtonState();\n    }\n  }\n\n  private async handleRefresh(): Promise<void> {\n    if (!this.state.connection) return;\n\n    const refreshBtn = this.container?.querySelector<HTMLButtonElement>('.refresh-btn');\n\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight('refresh')) return;\n\n    await this.actionQueue.execute('refresh', async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.refreshConnection(this.config.connectionId, {\n          provider_id: this.state.connection!.provider_id,\n        }),\n        notifier: this.config.notifier,\n        successMessage: 'Connection refresh initiated',\n        errorMessagePrefix: 'Failed to refresh',\n        buttonConfig: refreshBtn ? {\n          button: refreshBtn,\n          loadingText: 'Refreshing...',\n          successText: 'Refreshed',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.loadConnection(),\n      });\n    });\n  }\n\n  private async handleRevoke(): Promise<void> {\n    if (!this.state.connection) return;\n\n    const providerName = this.config.getProviderName\n      ? this.config.getProviderName(this.state.connection.provider_id)\n      : this.formatProviderId(this.state.connection.provider_id);\n\n    // Show confirmation dialog\n    const confirmed = await confirmServiceAction({\n      action: 'revoke',\n      resourceType: 'connection',\n      resourceName: providerName,\n    });\n    if (!confirmed) return;\n\n    const revokeBtn = this.container?.querySelector<HTMLButtonElement>('.revoke-btn');\n\n    // Prevent duplicate submissions\n    if (this.actionQueue.isInFlight('revoke')) return;\n\n    await this.actionQueue.execute('revoke', async () => {\n      await withMutationFeedback({\n        mutation: () => this.client.revokeConnection(this.config.connectionId),\n        notifier: this.config.notifier,\n        successMessage: 'Connection revoked',\n        errorMessagePrefix: 'Failed to revoke',\n        buttonConfig: revokeBtn ? {\n          button: revokeBtn,\n          loadingText: 'Revoking...',\n          successText: 'Revoked',\n          errorText: 'Failed',\n        } : undefined,\n        onSuccess: () => this.config.onRevoke?.(this.config.connectionId),\n      });\n    });\n  }\n\n  private updateReconsentButtonState(): void {\n    const btn = this.container?.querySelector<HTMLButtonElement>('.reconsent-btn');\n    if (!btn) return;\n\n    if (this.state.reconsentInProgress) {\n      btn.disabled = true;\n      btn.innerHTML = `\n        <svg class=\"animate-spin h-4 w-4 mr-1.5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n          <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n          <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n        </svg>\n        Redirecting...\n      `;\n    } else {\n      btn.disabled = false;\n      btn.textContent = 'Re-consent Now';\n    }\n  }\n\n  private renderLoading(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderLoadingState({\n      text: 'Loading connection details...',\n      size: 'lg',\n    });\n  }\n\n  private renderError(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderErrorState({\n      title: 'Failed to Load Connection',\n      error: this.state.error,\n      showRetry: true,\n    });\n\n    const retryBtn = this.container.querySelector('.ui-state-retry-btn');\n    retryBtn?.addEventListener('click', () => this.loadConnection());\n  }\n\n  private renderForbidden(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = renderForbiddenState({\n      resource: 'connection details',\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private buildGrantInfoList(): GrantInfo[] {\n    const snapshot = this.state.grantSnapshot;\n    const provider = this.state.provider;\n\n    if (!snapshot) {\n      return [];\n    }\n\n    const requestedSet = new Set(snapshot.requested_grants);\n    const grantedSet = new Set(snapshot.granted_grants);\n\n    // Build a map of grant -> capabilities\n    const grantToCapabilities = new Map<string, string[]>();\n    const capabilityRequiredGrants = new Set<string>();\n\n    if (provider) {\n      for (const capability of provider.capabilities) {\n        for (const grant of capability.required_grants) {\n          capabilityRequiredGrants.add(grant);\n          const caps = grantToCapabilities.get(grant) || [];\n          caps.push(capability.name);\n          grantToCapabilities.set(grant, caps);\n        }\n        for (const grant of capability.optional_grants) {\n          const caps = grantToCapabilities.get(grant) || [];\n          caps.push(capability.name);\n          grantToCapabilities.set(grant, caps);\n        }\n      }\n    }\n\n    // Collect all unique grants\n    const allGrants = new Set([\n      ...snapshot.requested_grants,\n      ...snapshot.granted_grants,\n      ...capabilityRequiredGrants,\n    ]);\n\n    // Build the info list\n    const grantInfoList: GrantInfo[] = [];\n\n    for (const grant of allGrants) {\n      const isGranted = grantedSet.has(grant);\n      const isRequested = requestedSet.has(grant);\n      const isCapabilityRequired = capabilityRequiredGrants.has(grant);\n\n      let status: GrantStatus;\n      if (isGranted) {\n        status = 'granted';\n      } else if (isRequested) {\n        status = 'requested';\n      } else if (isCapabilityRequired) {\n        status = 'capability_required';\n      } else {\n        status = 'missing';\n      }\n\n      grantInfoList.push({\n        grant,\n        status,\n        isRequired: isRequested || isCapabilityRequired,\n        isCapabilityRequired,\n        capabilities: grantToCapabilities.get(grant) || [],\n      });\n    }\n\n    // Sort: capability_required first, then granted, then requested, then missing\n    const statusOrder: Record<GrantStatus, number> = {\n      capability_required: 0,\n      granted: 1,\n      requested: 2,\n      missing: 3,\n    };\n\n    grantInfoList.sort((a, b) => statusOrder[a.status] - statusOrder[b.status]);\n\n    return grantInfoList;\n  }\n\n  private formatProviderId(id: string): string {\n    return id\n      .split(/[-_]/)\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  }\n\n  private formatLabel(str: string): string {\n    return str\n      .replace(/_/g, ' ')\n      .replace(/-/g, ' ')\n      .replace(/\\b\\w/g, (c) => c.toUpperCase());\n  }\n\n  private truncateId(id: string, maxLen = 12): string {\n    if (id.length <= maxLen) return id;\n    return `${id.slice(0, maxLen - 3)}...`;\n  }\n\n  private formatTime(dateStr: string): string {\n    const date = new Date(dateStr);\n    if (Number.isNaN(date.getTime())) return dateStr;\n    return date.toLocaleString();\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create and initialize a connection detail panel\n */\nexport async function createConnectionDetail(\n  config: ConnectionDetailConfig\n): Promise<ConnectionDetailManager> {\n  const manager = new ConnectionDetailManager(config);\n  await manager.init();\n  return manager;\n}\n"],"names":["ServicesAPIError","message","code","statusCode","details","payload","ServicesPermissions","DEFAULT_CONFIG","ServicesAPIClient","config","signal","filter","params","connectionRef","providerRef","request","idempotencyKey","installationRef","subscriptionId","connectionId","providerId","capability","body","headers","surface","controller","key","path","url","onAbort","response","extraHeaders","requestIdempotencyKey","base","value","options","requestKey","timeoutId","normalizedPath","runtimeCrypto","error","defaultClient","getServicesClient","setServicesClient","client","createServicesClient","QueryStateManager","rfc3339","page","newPage","perPage","newPerPage","search","filters","changed","field","order","v","total","hasNext","totalPages","parsed","sortField","sortOrder","stored","data","e","newURL","offset","debounce","fn","delay","args","buildSearchParams","state","includePage","includeDefaults","parseSearchParams","filterFields","defaults","ServicesPermissionManager","permissions","fetcher","permission","p","allowed","listener","defaultManager","getPermissionManager","initPermissions","createPermissionGuard","manager","mgr","requireAll","requireAny","combineGuards","guards","record","guard","canViewServices","canConnect","canEdit","canRevoke","canReconsent","canViewActivity","isForbiddenError","handleForbidden","handler","withPermission","action","onDenied","gateElement","element","requires","requiresAny","disableOnDenied","missing","initPermissionGates","container","loadPermissionsFromContext","windowPerms","bodyPerms","initPermissionsFromContext","EMPTY_STATE_DEFAULTS","renderLoadingState","text","size","containerClass","sizes","escapeHtml","renderEmptyState","icon","iconClass","title","renderIcon","renderActionButton","renderNoResultsState","query","filterCount","onReset","renderErrorState","compact","showRetry","retryText","renderForbiddenState","resource","renderTableLoadingState","colspan","renderTableErrorState","renderTableEmptyState","renderTableNoResultsState","UIStateManager","loadingConfig","emptyConfig","noResultsConfig","errorConfig","forbiddenConfig","div","MutationButtonManager","spinnerHTML","withMutationFeedback","mutation","notifier","successMessage","errorMessagePrefix","buttonConfig","onSuccess","onError","showInlineRetry","retryContainer","buttonManager","result","clearRetryUI","err","renderRetryUI","withConfirmation","confirmMessage","confirmOptions","mutationConfig","ConfirmModal","errorMessage","dismissText","onDismiss","retryBtn","dismissBtn","btn","originalText","getServiceConfirmConfig","resourceType","resourceName","additionalContext","actionLabels","resourceLabels","actionConfig","resourceLabel","confirmServiceAction","ActionQueue","DEFAULT_ACTION_LABELS","ActionLabelRegistry","defaultFallbackFormatter","defaultEntry","labels","entry","label","categories","category","registry","initActivityLabels","getActionLabel","getActionEntry","getAllActionLabels","getActionsByCategory","setActionLabels","isActivityLabelsInitialized","resetActivityLabels","createActionLabelResolver","overrides","c","DEFAULT_BASE_PATH","DEFAULT_PATH_MAP","DeepLinkManager","entityType","entityId","context","contextParam","queryString","pathname","segments","entityPath","type","ctxParam","objectType","queryState","viewMode","encoded","configureDeepLinks","generateDeepLink","generateListLink","navigateToEntity","navigateBack","parseCurrentDeepLink","parseDeepLink","mapObjectTypeToEntity","createNavigationContext","createActivityNavigateHandler","getQueryState","getViewMode","objectId","setupKeyboardNavigation","selector","onSelect","onFocus","onEscape","wrap","autoFocus","keyHandlers","getItems","focusItem","index","items","targetIndex","item","i","targetItem","handleKeyDown","event","target","itemIndex","setupRovingTabindex","FOCUSABLE_SELECTOR","createFocusTrap","initialFocus","returnFocus","previouslyFocused","getFocusableElements","focusables","firstFocusable","lastFocusable","getLiveRegion","priority","id","region","announceToScreenReader","clear","announceLoading","announceSuccess","announceError","announceNavigation","destination","setExpandedState","trigger","expanded","targetId","setLoadingState","loading","setStatusLabel","status","statusLabel","setSortableHeader","header","sorted","setProgress","max","createSkipLink","link","setupDialogFocus","dialog","describedBy","onClose","titleId","titleEl","releaseTrap","prefersReducedMotion","getAnimationDuration","normalDuration","STATUS_CONFIG","HEALTH_CONFIG","ExtensionDiagnosticsPanel","newState","pack","hook","statusCounts","count","health","errorCount","hasErrors","successRate","row","packId","errorId","packs","counts","hooks","enabled","disabled","dateStr","date","diffMs","diffMins","diffHours","renderStateSourceIndicator","source","packName","mode","cfg","addStateSourceIndicator","indicator","renderStateSourceLegend","PROVIDER_ICONS","PROVIDER_NAMES","ProvidersCatalogManager","cards","provider","userCanConnect","orgCanConnect","capabilitySummary","scopeBadges","capabilities","maxVisible","visible","hidden","html","cap","scopes","scope","displayName","word","card","scopeType","createProvidersCatalog","ConnectionsListManager","searchInput","select","filterKey","connectUserBtn","connectOrgBtn","prevBtn","nextBtn","tbody","emptyState","tableWrapper","conn","providerSelect","selectedProviderId","connection","providerName","updatedAt","actions","button","per_page","start","end","hasPrev","infoEl","maxLen","diffDays","createConnectionsList","INSTALL_TYPE_CONFIG","InstallationsListManager","inst","installation","installType","grantedAt","revokedAt","installationId","createInstallationsList","ActivityPageManager","a","categoryLabels","optgroups","entries","categoryLabel","defaultGetActionLabel","input","timelineBtn","tableBtn","objectTypeInput","objectIdInput","timelineContainer","timelineWrapper","actionLabel","time","relativeTime","el","entryId","summaryEl","parts","urlMode","str","metadata","k","createActivityPage","SUBSCRIPTION_STATUS_CONFIG","SYNC_STATUS_CONFIG","SYNC_MODE_CONFIG","SubscriptionsSyncPageManager","tab","statusFilter","connections","filtered","job","paged","subscriptionsTab","syncTab","content","sub","subscription","expiresAt","expiresTitle","isExpiringSoon","s","lastRunRaw","lastRun","errorText","cursor","jobId","j","resourceId","subscriptionsContent","syncContent","activeContent","detail","summary","firstCursor","runResourceType","runResourceId","baseMetadata","itemType","urlTab","now","isFuture","absDiffMs","createSubscriptionsSyncPage","GRANT_STATUS_CONFIG","ConnectionDetailManager","detailResponse","grantsResponse","providersResponse","grantInfoList","hasMissingRequired","g","needsReconsent","grantInfo","statusConfig","capabilitiesList","grantedGrants","hasAllRequired","hasAllOptional","isFullyEnabled","isPartiallyEnabled","isBlocked","statusClass","statusIcon","healthStatus","healthLabel","healthClass","healthIcon","hoursUntilExpiry","rateLimit","limitStatus","limitLabel","limitClass","limitIcon","exhaustedRatio","usagePercent","seconds","hours","mins","absDiffMins","absDiffHours","absDiffDays","missingRequired","refreshBtn","revokeBtn","snapshot","requestedSet","grantedSet","grantToCapabilities","capabilityRequiredGrants","grant","caps","allGrants","isGranted","isRequested","isCapabilityRequired","statusOrder","b","createConnectionDetail"],"mappings":"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"}