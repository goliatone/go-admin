{"version":3,"file":"index.js","sources":["../../src/translation-exchange/translation-exchange-manager.ts"],"sourcesContent":["/**\n * Translation Exchange Manager\n * Handles export, import validation, and apply workflows for translation exchange\n */\n\nimport type {\n  TranslationExchangeConfig,\n  TranslationExchangeSelectors,\n  ExportRequest,\n  ExportResponse,\n  ExportRow,\n  ImportOptions,\n  ToastNotifier,\n} from './types.js';\nimport {\n  parseImportResult,\n  groupRowResultsByStatus,\n  generateExchangeReport,\n  type ExchangeImportResult,\n  type ExchangeRowResult,\n} from '../toast/error-helpers.js';\n\n/** Internal import state tracking */\ninterface ImportState {\n  file: File | null;\n  validated: boolean;\n  validationResult: ExchangeImportResult | null;\n}\n\nconst DEFAULT_SELECTORS: TranslationExchangeSelectors = {\n  // Tabs\n  tabExport: '#tab-export',\n  tabImport: '#tab-import',\n  panelExport: '#panel-export',\n  panelImport: '#panel-import',\n  // Export\n  exportForm: '#export-form',\n  sourceLocale: '#source-locale',\n  exportStatus: '#export-status',\n  // Import\n  importFile: '#import-file',\n  importOptions: '#import-options',\n  fileName: '#file-name',\n  validateBtn: '#validate-btn',\n  applyBtn: '#apply-btn',\n  // Import options\n  allowCreateMissing: '#allow-create-missing',\n  allowHashOverride: '#allow-hash-override',\n  continueOnError: '#continue-on-error',\n  dryRun: '#dry-run',\n  // Results\n  validationResults: '#validation-results',\n  downloadReport: '#download-report',\n  resultsSummary: '#results-summary',\n  resultsTable: '#results-table',\n  resultsEmpty: '#results-empty',\n  summaryProcessed: '#summary-processed',\n  summarySucceeded: '#summary-succeeded',\n  summaryFailed: '#summary-failed',\n  summaryConflicts: '#summary-conflicts',\n};\n\nconst STATUS_BADGES: Record<string, { class: string; label: string }> = {\n  success: { class: 'bg-green-100 text-green-800', label: 'Success' },\n  error: { class: 'bg-red-100 text-red-800', label: 'Error' },\n  conflict: { class: 'bg-yellow-100 text-yellow-800', label: 'Conflict' },\n  skipped: { class: 'bg-gray-100 text-gray-800', label: 'Skipped' },\n};\n\nexport class TranslationExchangeManager {\n  private config: TranslationExchangeConfig;\n  private selectors: TranslationExchangeSelectors;\n  private toast: ToastNotifier | null;\n\n  // Cached DOM elements\n  private tabExport: HTMLButtonElement | null = null;\n  private tabImport: HTMLButtonElement | null = null;\n  private panelExport: HTMLElement | null = null;\n  private panelImport: HTMLElement | null = null;\n  private exportForm: HTMLFormElement | null = null;\n  private exportStatus: HTMLElement | null = null;\n  private importFile: HTMLInputElement | null = null;\n  private importOptions: HTMLElement | null = null;\n  private fileNameEl: HTMLElement | null = null;\n  private validateBtn: HTMLButtonElement | null = null;\n  private applyBtn: HTMLButtonElement | null = null;\n  private validationResults: HTMLElement | null = null;\n  private downloadReportBtn: HTMLButtonElement | null = null;\n  private resultsTable: HTMLTableSectionElement | null = null;\n  private resultsEmpty: HTMLElement | null = null;\n\n  // State\n  private importState: ImportState = {\n    file: null,\n    validated: false,\n    validationResult: null,\n  };\n\n  constructor(\n    config: TranslationExchangeConfig,\n    selectors: Partial<TranslationExchangeSelectors> = {},\n    toast?: ToastNotifier\n  ) {\n    this.config = config;\n    this.selectors = { ...DEFAULT_SELECTORS, ...selectors };\n    this.toast = toast || (window as any).toastManager || null;\n  }\n\n  /**\n   * Initialize the translation exchange manager\n   */\n  init(): void {\n    this.cacheElements();\n    this.bindEvents();\n  }\n\n  /**\n   * Destroy the manager and clean up\n   */\n  destroy(): void {\n    // Clean up event listeners if needed\n  }\n\n  private cacheElements(): void {\n    this.tabExport = document.querySelector<HTMLButtonElement>(this.selectors.tabExport);\n    this.tabImport = document.querySelector<HTMLButtonElement>(this.selectors.tabImport);\n    this.panelExport = document.querySelector<HTMLElement>(this.selectors.panelExport);\n    this.panelImport = document.querySelector<HTMLElement>(this.selectors.panelImport);\n    this.exportForm = document.querySelector<HTMLFormElement>(this.selectors.exportForm);\n    this.exportStatus = document.querySelector<HTMLElement>(this.selectors.exportStatus);\n    this.importFile = document.querySelector<HTMLInputElement>(this.selectors.importFile);\n    this.importOptions = document.querySelector<HTMLElement>(this.selectors.importOptions);\n    this.fileNameEl = document.querySelector<HTMLElement>(this.selectors.fileName);\n    this.validateBtn = document.querySelector<HTMLButtonElement>(this.selectors.validateBtn);\n    this.applyBtn = document.querySelector<HTMLButtonElement>(this.selectors.applyBtn);\n    this.validationResults = document.querySelector<HTMLElement>(this.selectors.validationResults);\n    this.downloadReportBtn = document.querySelector<HTMLButtonElement>(this.selectors.downloadReport);\n    this.resultsTable = document.querySelector<HTMLTableSectionElement>(this.selectors.resultsTable);\n    this.resultsEmpty = document.querySelector<HTMLElement>(this.selectors.resultsEmpty);\n  }\n\n  private bindEvents(): void {\n    // Tab switching\n    this.tabExport?.addEventListener('click', () => this.switchTab('export'));\n    this.tabImport?.addEventListener('click', () => this.switchTab('import'));\n\n    // Export form\n    this.exportForm?.addEventListener('submit', (e) => this.handleExport(e));\n\n    // File upload\n    this.importFile?.addEventListener('change', (e) => this.handleFileSelect(e));\n\n    // Drag and drop\n    const dropZone = this.importFile?.closest('.border-dashed');\n    if (dropZone) {\n      dropZone.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        dropZone.classList.add('border-admin-primary', 'bg-admin-primary/5');\n      });\n      dropZone.addEventListener('dragleave', () => {\n        dropZone.classList.remove('border-admin-primary', 'bg-admin-primary/5');\n      });\n      dropZone.addEventListener('drop', (e) => {\n        e.preventDefault();\n        dropZone.classList.remove('border-admin-primary', 'bg-admin-primary/5');\n        const files = (e as DragEvent).dataTransfer?.files;\n        if (files && files.length > 0) {\n          this.handleFile(files[0]);\n        }\n      });\n    }\n\n    // Validate and Apply buttons\n    this.validateBtn?.addEventListener('click', () => this.handleValidate());\n    this.applyBtn?.addEventListener('click', () => this.handleApply());\n\n    // Download report\n    this.downloadReportBtn?.addEventListener('click', () => this.handleDownloadReport());\n  }\n\n  private switchTab(tab: 'export' | 'import'): void {\n    const allTabs = document.querySelectorAll('.tab-btn');\n    const allPanels = document.querySelectorAll('.tab-panel');\n\n    allTabs.forEach((t) => {\n      t.classList.remove('border-admin-primary', 'text-admin-primary');\n      t.classList.add('border-transparent', 'text-gray-500');\n    });\n    allPanels.forEach((p) => p.classList.add('hidden'));\n\n    if (tab === 'export') {\n      this.tabExport?.classList.remove('border-transparent', 'text-gray-500');\n      this.tabExport?.classList.add('border-admin-primary', 'text-admin-primary');\n      this.panelExport?.classList.remove('hidden');\n    } else {\n      this.tabImport?.classList.remove('border-transparent', 'text-gray-500');\n      this.tabImport?.classList.add('border-admin-primary', 'text-admin-primary');\n      this.panelImport?.classList.remove('hidden');\n    }\n  }\n\n  private async handleExport(e: Event): Promise<void> {\n    e.preventDefault();\n    if (!this.exportForm) return;\n\n    const formData = new FormData(this.exportForm);\n    const resources = formData.getAll('resources') as string[];\n    const sourceLocale = formData.get('source_locale') as string;\n    const targetLocales = formData.getAll('target_locales') as string[];\n    const includeSourceHash = formData.has('include_source_hash');\n\n    if (resources.length === 0) {\n      this.showError('Please select at least one resource to export.');\n      return;\n    }\n    if (targetLocales.length === 0) {\n      this.showError('Please select at least one target locale.');\n      return;\n    }\n\n    this.setExportStatus('Exporting...');\n\n    try {\n      const request: ExportRequest = {\n        filter: {\n          resources,\n          source_locale: sourceLocale,\n          target_locales: targetLocales,\n          include_source_hash: includeSourceHash,\n        },\n      };\n\n      const response = await fetch(`${this.config.apiPath}/export`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(request),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        const message = error?.error?.message || error?.message || 'Export failed';\n        throw new Error(message);\n      }\n\n      const result: ExportResponse = await response.json();\n      this.downloadExportResult(result, sourceLocale, targetLocales);\n      this.setExportStatus(`Exported ${result.row_count} rows`);\n      this.toast?.success(`Exported ${result.row_count} translation rows`);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Export failed';\n      this.setExportStatus('');\n      this.showError(message);\n    }\n  }\n\n  private downloadExportResult(result: ExportResponse, source: string, targets: string[]): void {\n    const csv = this.convertToCSV(result.rows);\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    const timestamp = new Date().toISOString().split('T')[0];\n    link.href = url;\n    link.download = `translations_${source}_to_${targets.join('-')}_${timestamp}.csv`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n  }\n\n  private convertToCSV(rows: ExportRow[]): string {\n    if (rows.length === 0) return '';\n\n    const headers = [\n      'resource',\n      'entity_id',\n      'translation_group_id',\n      'source_locale',\n      'target_locale',\n      'field_path',\n      'source_text',\n      'translated_text',\n      'source_hash',\n      'path',\n      'title',\n      'status',\n      'notes',\n    ] as const;\n\n    const csvRows = [headers.join(',')];\n    for (const row of rows) {\n      const values = headers.map((h) => {\n        const val = (row as unknown as Record<string, unknown>)[h] ?? '';\n        const str = String(val);\n        // Escape quotes and wrap in quotes if contains comma/quote/newline\n        if (str.includes(',') || str.includes('\"') || str.includes('\\n')) {\n          return `\"${str.replace(/\"/g, '\"\"')}\"`;\n        }\n        return str;\n      });\n      csvRows.push(values.join(','));\n    }\n    return csvRows.join('\\n');\n  }\n\n  private handleFileSelect(e: Event): void {\n    const input = e.target as HTMLInputElement;\n    if (input.files && input.files.length > 0) {\n      this.handleFile(input.files[0]);\n    }\n  }\n\n  private handleFile(file: File): void {\n    const ext = file.name.split('.').pop()?.toLowerCase();\n    if (ext !== 'csv' && ext !== 'json') {\n      this.showError('Please upload a CSV or JSON file.');\n      return;\n    }\n\n    this.importState.file = file;\n    this.importState.validated = false;\n    this.importState.validationResult = null;\n\n    // Show file name\n    if (this.fileNameEl) {\n      this.fileNameEl.textContent = `Selected: ${file.name}`;\n      this.fileNameEl.classList.remove('hidden');\n    }\n\n    // Show import options\n    this.importOptions?.classList.remove('hidden');\n\n    // Reset apply button\n    if (this.applyBtn) {\n      this.applyBtn.disabled = true;\n    }\n\n    // Hide previous results\n    this.validationResults?.classList.add('hidden');\n  }\n\n  private async handleValidate(): Promise<void> {\n    if (!this.importState.file) {\n      this.showError('Please select a file first.');\n      return;\n    }\n\n    this.setButtonLoading(this.validateBtn, true);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', this.importState.file);\n\n      const response = await fetch(`${this.config.apiPath}/import/validate`, {\n        method: 'POST',\n        body: formData,\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        const message = data?.error?.message || data?.message || 'Validation failed';\n        throw new Error(message);\n      }\n\n      const result = parseImportResult(data);\n      this.importState.validated = true;\n      this.importState.validationResult = result;\n\n      this.displayExchangeResults(result);\n\n      // Enable apply button if validation passed (some succeeded)\n      if (this.applyBtn && result.summary.succeeded > 0) {\n        this.applyBtn.disabled = false;\n      }\n\n      this.toast?.info(`Validation complete: ${result.summary.succeeded}/${result.summary.processed} rows valid`);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Validation failed';\n      this.showError(message);\n    } finally {\n      this.setButtonLoading(this.validateBtn, false);\n    }\n  }\n\n  private async handleApply(): Promise<void> {\n    if (!this.importState.file) {\n      this.showError('Please select a file first.');\n      return;\n    }\n\n    const dryRunCheckbox = document.querySelector<HTMLInputElement>(this.selectors.dryRun);\n    if (dryRunCheckbox?.checked) {\n      this.toast?.info('Dry run mode - no changes will be applied');\n    }\n\n    this.setButtonLoading(this.applyBtn, true);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', this.importState.file);\n\n      // Add options\n      const options = this.getImportOptions();\n      for (const [key, value] of Object.entries(options)) {\n        formData.append(key, String(value));\n      }\n\n      const response = await fetch(`${this.config.apiPath}/import/apply`, {\n        method: 'POST',\n        body: formData,\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        const message = data?.error?.message || data?.message || 'Apply failed';\n        throw new Error(message);\n      }\n\n      const result = parseImportResult(data);\n      this.importState.validationResult = result;\n\n      this.displayExchangeResults(result);\n\n      if (result.summary.succeeded > 0) {\n        this.toast?.success(`Applied ${result.summary.succeeded} translations successfully`);\n      }\n      if (result.summary.failed > 0) {\n        this.toast?.warning(`${result.summary.failed} rows failed to apply`);\n      }\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Apply failed';\n      this.showError(message);\n    } finally {\n      this.setButtonLoading(this.applyBtn, false);\n    }\n  }\n\n  private getImportOptions(): ImportOptions {\n    return {\n      allow_create_missing:\n        document.querySelector<HTMLInputElement>(this.selectors.allowCreateMissing)?.checked ?? false,\n      allow_source_hash_override:\n        document.querySelector<HTMLInputElement>(this.selectors.allowHashOverride)?.checked ?? false,\n      continue_on_error:\n        document.querySelector<HTMLInputElement>(this.selectors.continueOnError)?.checked ?? true,\n      dry_run: document.querySelector<HTMLInputElement>(this.selectors.dryRun)?.checked ?? false,\n    };\n  }\n\n  private displayExchangeResults(result: ExchangeImportResult): void {\n    // Show results section\n    this.validationResults?.classList.remove('hidden');\n\n    // Update summary\n    const processed = document.querySelector(this.selectors.summaryProcessed);\n    const succeeded = document.querySelector(this.selectors.summarySucceeded);\n    const failed = document.querySelector(this.selectors.summaryFailed);\n    const conflicts = document.querySelector(this.selectors.summaryConflicts);\n\n    if (processed) processed.textContent = String(result.summary.processed);\n    if (succeeded) succeeded.textContent = String(result.summary.succeeded);\n    if (failed) failed.textContent = String(result.summary.failed);\n\n    // Count conflicts from results\n    const grouped = groupRowResultsByStatus(result.results);\n    if (conflicts) conflicts.textContent = String(grouped.conflict.length);\n\n    // Render results table\n    this.renderResultsTable(result.results);\n  }\n\n  private renderResultsTable(results: ExchangeRowResult[]): void {\n    if (!this.resultsTable) return;\n\n    if (results.length === 0) {\n      this.resultsTable.innerHTML = '';\n      this.resultsEmpty?.classList.remove('hidden');\n      return;\n    }\n\n    this.resultsEmpty?.classList.add('hidden');\n\n    const rows = results.map((row) => {\n      const badge = STATUS_BADGES[row.status] || STATUS_BADGES.error;\n      const errorDetail = row.error || row.conflict?.type || '';\n\n      return `\n        <tr>\n          <td class=\"px-4 py-3 text-gray-500\">${row.index + 1}</td>\n          <td class=\"px-4 py-3\">${this.escapeHtml(row.resource)}</td>\n          <td class=\"px-4 py-3 font-mono text-xs\">${this.escapeHtml(row.entityId)}</td>\n          <td class=\"px-4 py-3\">${this.escapeHtml(row.fieldPath)}</td>\n          <td class=\"px-4 py-3\">${this.escapeHtml(row.targetLocale)}</td>\n          <td class=\"px-4 py-3\">\n            <span class=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${badge.class}\">\n              ${badge.label}\n            </span>\n          </td>\n          <td class=\"px-4 py-3 text-xs text-gray-500\">${this.escapeHtml(errorDetail)}</td>\n        </tr>\n      `;\n    });\n\n    this.resultsTable.innerHTML = rows.join('');\n  }\n\n  private handleDownloadReport(): void {\n    if (!this.importState.validationResult) {\n      this.showError('No results to download.');\n      return;\n    }\n\n    const blob = generateExchangeReport(this.importState.validationResult, 'csv');\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    const timestamp = new Date().toISOString().split('T')[0];\n    link.href = url;\n    link.download = `translation_import_report_${timestamp}.csv`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    this.toast?.info('Report downloaded');\n  }\n\n  private setExportStatus(text: string): void {\n    if (this.exportStatus) {\n      this.exportStatus.textContent = text;\n    }\n  }\n\n  private setButtonLoading(button: HTMLButtonElement | null, loading: boolean): void {\n    if (!button) return;\n\n    if (loading) {\n      button.disabled = true;\n      button.dataset.originalText = button.textContent || '';\n      button.textContent = 'Processing...';\n    } else {\n      button.disabled = false;\n      button.textContent = button.dataset.originalText || button.textContent;\n    }\n  }\n\n  private showError(message: string): void {\n    if (this.toast) {\n      this.toast.error(message);\n    } else {\n      console.error(message);\n      alert(message);\n    }\n  }\n\n  private escapeHtml(str: string): string {\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  }\n}\n"],"names":["DEFAULT_SELECTORS","STATUS_BADGES","TranslationExchangeManager","config","selectors","toast","dropZone","files","tab","allTabs","allPanels","t","p","e","formData","resources","sourceLocale","targetLocales","includeSourceHash","request","response","error","message","result","source","targets","csv","blob","url","link","timestamp","rows","headers","csvRows","row","values","h","val","str","input","file","ext","data","parseImportResult","options","key","value","processed","succeeded","failed","conflicts","grouped","groupRowResultsByStatus","results","badge","errorDetail","generateExchangeReport","text","button","loading","div"],"mappings":"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"}