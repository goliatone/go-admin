{"version":3,"file":"index.js","sources":["../../src/activity/formatters.ts","../../src/activity/activity-manager.ts"],"sourcesContent":["/**\n * Activity Feed Formatters\n * Handles action categorization, sentence formatting, and metadata display\n */\n\nimport type { ActivityEntry, ActionCategory, ParsedObject } from './types.js';\n\n/**\n * Mapping of verbs to action categories\n */\nconst ACTION_CATEGORY_MAP: Record<string, ActionCategory> = {\n  // Created\n  created: 'created',\n  added: 'created',\n  inserted: 'created',\n  registered: 'created',\n  signed_up: 'created',\n  imported: 'created',\n\n  // Updated\n  updated: 'updated',\n  modified: 'updated',\n  changed: 'updated',\n  edited: 'updated',\n  saved: 'updated',\n  enabled: 'updated',\n  disabled: 'updated',\n  activated: 'updated',\n  deactivated: 'updated',\n\n  // Deleted\n  deleted: 'deleted',\n  removed: 'deleted',\n  destroyed: 'deleted',\n  purged: 'deleted',\n  archived: 'deleted',\n\n  // Auth\n  login: 'auth',\n  logout: 'auth',\n  logged_in: 'auth',\n  logged_out: 'auth',\n  authenticated: 'auth',\n  password_reset: 'auth',\n  password_changed: 'auth',\n  token_refreshed: 'auth',\n  session_expired: 'auth',\n\n  // Viewed\n  viewed: 'viewed',\n  accessed: 'viewed',\n  read: 'viewed',\n  downloaded: 'viewed',\n  exported: 'viewed',\n};\n\n/**\n * Icons for each action category (using iconoir icon names)\n */\nexport const ACTION_ICONS: Record<ActionCategory, string> = {\n  created: 'plus',\n  updated: 'edit-pencil',\n  deleted: 'trash',\n  auth: 'key',\n  viewed: 'eye',\n  system: 'settings',\n};\n\n/**\n * Icons for action namespaces (first segment of dotted action strings)\n */\nexport const NAMESPACE_ICONS: Record<string, string> = {\n  debug: 'terminal',\n  user: 'user',\n  users: 'group',\n  auth: 'key',\n  admin: 'settings',\n  system: 'cpu',\n  api: 'cloud',\n  db: 'database',\n  cache: 'archive',\n  file: 'folder',\n  email: 'mail',\n  notification: 'bell',\n  webhook: 'link',\n  job: 'clock',\n  queue: 'list',\n  export: 'download',\n  import: 'upload',\n  report: 'page',\n  log: 'clipboard',\n  config: 'adjustments',\n  settings: 'settings',\n  security: 'shield',\n  tenant: 'building',\n  org: 'community',\n  media: 'media-image',\n  content: 'page-edit',\n  repl: 'terminal',\n};\n\n/**\n * Parse a dotted action string like \"debug.repl.close\" into namespace and action\n */\nexport interface ParsedAction {\n  namespace: string;\n  action: string;\n  icon: string;\n  category: ActionCategory;\n}\n\nexport function resolveActionLabel(\n  actionStr: string,\n  labels?: Record<string, string>\n): string {\n  if (!actionStr) return '';\n  if (!labels) return actionStr;\n  const trimmed = actionStr.trim();\n  if (!trimmed) return actionStr;\n  const label = labels[trimmed];\n  if (typeof label === 'string' && label.trim() !== '') {\n    return label;\n  }\n  return actionStr;\n}\n\nexport function parseActionString(\n  actionStr: string,\n  labels?: Record<string, string>\n): ParsedAction {\n  if (!actionStr) {\n    return { namespace: '', action: '', icon: 'activity', category: 'system' };\n  }\n\n  const actionLabel = resolveActionLabel(actionStr, labels);\n\n  // Check if it's a dotted notation action\n  if (actionStr.includes('.')) {\n    const parts = actionStr.split('.');\n    const namespace = parts[0].toLowerCase();\n    const action = parts.slice(1).join('.');\n    const icon = NAMESPACE_ICONS[namespace] || 'activity';\n\n    // Determine category from the last part (the verb)\n    const verb = parts[parts.length - 1];\n    const category = getActionCategory(verb);\n\n    const displayAction = actionLabel !== actionStr ? actionLabel : action;\n    return { namespace, action: displayAction, icon, category };\n  }\n\n  // Standard single-word action\n  const category = getActionCategory(actionStr);\n  const displayAction = actionLabel !== actionStr ? actionLabel : actionStr;\n  return {\n    namespace: '',\n    action: displayAction,\n    icon: ACTION_ICONS[category],\n    category,\n  };\n}\n\n/**\n * Get the action category for a verb\n */\nexport function getActionCategory(verb: string): ActionCategory {\n  if (!verb) return 'system';\n  const normalized = verb.toLowerCase().trim().replace(/-/g, '_');\n  return ACTION_CATEGORY_MAP[normalized] || 'system';\n}\n\n/**\n * Parse an object string (format: \"type:id\") into its components\n */\nexport function parseObject(object: string): ParsedObject {\n  if (!object) return { type: '', id: '' };\n\n  if (!object.includes(':')) {\n    return { type: object, id: '' };\n  }\n\n  const colonIndex = object.indexOf(':');\n  return {\n    type: object.substring(0, colonIndex),\n    id: object.substring(colonIndex + 1),\n  };\n}\n\n/**\n * Capitalize the first letter of a string\n */\nfunction capitalize(str: string): string {\n  if (!str) return '';\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Format object type for display (e.g., \"user_profile\" -> \"User Profile\")\n */\nfunction formatObjectType(type: string): string {\n  if (!type) return '';\n  return type\n    .split(/[_-]/)\n    .map(capitalize)\n    .join(' ');\n}\n\n/**\n * Escape HTML to prevent XSS\n */\nexport function escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Shorten a UUID or long string to first N characters (like git short hash)\n */\nexport function shortenId(id: string, length: number = 7): string {\n  if (!id) return '';\n  // Remove dashes for UUID detection\n  const clean = id.replace(/-/g, '');\n  // If it looks like a UUID (32 hex chars without dashes), shorten it\n  if (/^[0-9a-f]{32}$/i.test(clean)) {\n    return id.substring(0, length);\n  }\n  // For other long strings, also shorten\n  if (id.length > length + 3) {\n    return id.substring(0, length);\n  }\n  return id;\n}\n\n/**\n * Check if a string looks like a UUID\n */\nfunction isUuidLike(str: string): boolean {\n  if (!str) return false;\n  const clean = str.replace(/-/g, '');\n  return /^[0-9a-f]{32}$/i.test(clean);\n}\n\n/**\n * Format an ID for display with optional tooltip for full value\n * Returns HTML with shortened ID and title attribute for full ID\n */\nfunction formatIdWithTooltip(id: string, length: number = 8): string {\n  if (!id) return '';\n  const shortened = shortenId(id, length);\n  if (shortened === id) {\n    return escapeHtml(id);\n  }\n  // Return span with tooltip showing full ID\n  return `<span class=\"activity-id-short\" title=\"${escapeHtml(id)}\" style=\"cursor: help; border-bottom: 1px dotted #9ca3af;\">${escapeHtml(shortened)}</span>`;\n}\n\n/**\n * Format an activity entry into a human-readable sentence\n */\nexport function formatActivitySentence(\n  entry: ActivityEntry,\n  labels?: Record<string, string>\n): string {\n  const actor = entry.actor || 'Unknown';\n  const rawVerb = entry.action || 'performed action on';\n  const verb = resolveActionLabel(rawVerb, labels);\n  const { type, id } = parseObject(entry.object);\n\n  // Format actor - shorten if UUID\n  const actorDisplay = isUuidLike(actor)\n    ? formatIdWithTooltip(actor, 8)\n    : `<strong>${escapeHtml(actor)}</strong>`;\n\n  // Build object reference with shortened ID\n  let objectRef = '';\n  if (type && id) {\n    const shortId = formatIdWithTooltip(id, 8);\n    objectRef = `${formatObjectType(type)} #${shortId}`;\n  } else if (type) {\n    objectRef = formatObjectType(type);\n  } else if (id) {\n    objectRef = `#${formatIdWithTooltip(id, 8)}`;\n  }\n\n  // Build sentence based on action category\n  const category = getActionCategory(rawVerb);\n\n  // Special handling for auth events\n  if (category === 'auth') {\n    const ip = entry.metadata?.ip || entry.metadata?.IP;\n    if (ip) {\n      return `${actorDisplay} ${escapeHtml(verb)} from ${escapeHtml(String(ip))}`;\n    }\n    return `${actorDisplay} ${escapeHtml(verb)}`;\n  }\n\n  // Standard sentence\n  if (objectRef) {\n    return `${actorDisplay} ${escapeHtml(verb)} <strong>${objectRef}</strong>`;\n  }\n\n  return `${actorDisplay} ${escapeHtml(verb)}`;\n}\n\n/**\n * Format a timestamp for display\n */\nexport function formatTimestamp(value: string): string {\n  if (!value) return '-';\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return value;\n  }\n  return date.toLocaleString();\n}\n\n/**\n * Format relative time (e.g., \"2 hours ago\")\n */\nexport function formatRelativeTime(value: string): string {\n  if (!value) return '';\n\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return value;\n\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffSecs = Math.floor(diffMs / 1000);\n  const diffMins = Math.floor(diffSecs / 60);\n  const diffHours = Math.floor(diffMins / 60);\n  const diffDays = Math.floor(diffHours / 24);\n\n  if (diffSecs < 60) return 'just now';\n  if (diffMins < 60) return `${diffMins}m ago`;\n  if (diffHours < 24) return `${diffHours}h ago`;\n  if (diffDays < 7) return `${diffDays}d ago`;\n\n  return date.toLocaleDateString();\n}\n\n/**\n * Count the number of fields in metadata\n */\nexport function countMetadataFields(metadata: Record<string, unknown> | undefined): number {\n  if (!metadata || typeof metadata !== 'object') return 0;\n  return Object.keys(metadata).length;\n}\n\n/**\n * Get a summary of metadata changes\n */\nexport function getMetadataSummary(metadata: Record<string, unknown> | undefined): string {\n  const count = countMetadataFields(metadata);\n  if (count === 0) return '';\n  if (count === 1) return '1 field';\n  return `${count} fields`;\n}\n\n/**\n * Format metadata for expanded display (grid-friendly items)\n */\nexport function formatMetadataExpanded(metadata: Record<string, unknown> | undefined): string {\n  if (!metadata || typeof metadata !== 'object') return '';\n\n  const entries = Object.entries(metadata);\n  if (entries.length === 0) return '';\n\n  const items = entries.map(([key, value]) => {\n    const formattedKey = escapeHtml(key);\n    let formattedValue: string;\n\n    // Check for change diff pattern (old_value -> new_value)\n    if (key.endsWith('_old') || key.endsWith('_new')) {\n      formattedValue = escapeHtml(formatValue(value));\n    } else if (typeof value === 'object' && value !== null) {\n      // Truncate JSON strings\n      const jsonStr = JSON.stringify(value);\n      const truncated = jsonStr.length > 100 ? jsonStr.substring(0, 100) + '...' : jsonStr;\n      formattedValue = `<code style=\"font-size: 11px; background: #e5e7eb; padding: 2px 6px; border-radius: 4px; word-break: break-all;\">${escapeHtml(truncated)}</code>`;\n    } else {\n      formattedValue = escapeHtml(formatValue(value));\n    }\n\n    return `\n      <div style=\"display: flex; flex-direction: column; gap: 2px; padding: 8px 12px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;\">\n        <span style=\"color: #6b7280; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;\">${formattedKey}</span>\n        <span style=\"color: #111827; font-size: 12px; font-weight: 500; word-break: break-word;\">${formattedValue}</span>\n      </div>\n    `;\n  });\n\n  return items.join('');\n}\n\n/**\n * Format a value for display\n */\nfunction formatValue(value: unknown): string {\n  if (value === null || value === undefined) return '-';\n  if (typeof value === 'boolean') return value ? 'Yes' : 'No';\n  if (typeof value === 'number') return String(value);\n  if (typeof value === 'string') {\n    // Truncate long strings\n    if (value.length > 100) {\n      return value.substring(0, 100) + '...';\n    }\n    return value;\n  }\n  return JSON.stringify(value);\n}\n\n/**\n * Format channel for display (shorten UUIDs)\n */\nexport function formatChannel(channel: string | undefined): string {\n  if (!channel) return '';\n  return shortenId(channel, 7);\n}\n\n/**\n * Get CSS class for action category\n */\nexport function getActionClass(category: ActionCategory): string {\n  return `activity-action--${category}`;\n}\n\n/**\n * Get icon HTML for action category\n */\nexport function getActionIconHtml(category: ActionCategory): string {\n  const icon = ACTION_ICONS[category];\n  return `<i class=\"iconoir-${icon} activity-action-icon\"></i>`;\n}\n","/**\n * Activity Manager\n * Manages activity feed display with enhanced formatting\n */\n\nimport type {\n  ActivityEntry,\n  ActivityPayload,\n  ActivityConfig,\n  ActivitySelectors,\n  ActivityState,\n  ToastNotifier,\n} from './types.js';\n\nimport {\n  parseActionString,\n  formatActivitySentence,\n  formatTimestamp,\n  formatRelativeTime,\n  getMetadataSummary,\n  formatMetadataExpanded,\n  escapeHtml,\n  formatChannel,\n} from './formatters.js';\n\nconst DEFAULT_SELECTORS: ActivitySelectors = {\n  form: '#activity-filters',\n  tableBody: '#activity-table-body',\n  emptyState: '#activity-empty',\n  disabledState: '#activity-disabled',\n  errorState: '#activity-error',\n  countEl: '#activity-count',\n  prevBtn: '#activity-prev',\n  nextBtn: '#activity-next',\n  refreshBtn: '#activity-refresh',\n  clearBtn: '#activity-clear',\n  limitInput: '#filter-limit',\n};\n\nconst FIELD_IDS = ['q', 'verb', 'channels', 'object_type', 'object_id'];\nconst DATE_FIELDS = ['since', 'until'];\nconst PASSTHROUGH_FIELDS = ['user_id', 'actor_id'];\n\nexport class ActivityManager {\n  private config: ActivityConfig;\n  private selectors: ActivitySelectors;\n  private toast: ToastNotifier | null;\n\n  private form: HTMLFormElement | null = null;\n  private tableBody: HTMLTableSectionElement | null = null;\n  private emptyState: HTMLElement | null = null;\n  private disabledState: HTMLElement | null = null;\n  private errorState: HTMLElement | null = null;\n  private countEl: HTMLElement | null = null;\n  private prevBtn: HTMLButtonElement | null = null;\n  private nextBtn: HTMLButtonElement | null = null;\n  private refreshBtn: HTMLButtonElement | null = null;\n  private clearBtn: HTMLButtonElement | null = null;\n  private limitInput: HTMLSelectElement | null = null;\n\n  private state: ActivityState = {\n    limit: 50,\n    offset: 0,\n    total: 0,\n    nextOffset: 0,\n    hasMore: false,\n    extraParams: {},\n  };\n\n  constructor(\n    config: ActivityConfig,\n    selectors: Partial<ActivitySelectors> = {},\n    toast?: ToastNotifier\n  ) {\n    this.config = config;\n    this.selectors = { ...DEFAULT_SELECTORS, ...selectors };\n    this.toast = toast || (window as any).toastManager || null;\n  }\n\n  /**\n   * Initialize the activity manager\n   */\n  init(): void {\n    this.cacheElements();\n    this.bindEvents();\n    this.syncFromQuery();\n    this.loadActivity();\n  }\n\n  private cacheElements(): void {\n    this.form = document.querySelector<HTMLFormElement>(this.selectors.form);\n    this.tableBody = document.querySelector<HTMLTableSectionElement>(this.selectors.tableBody);\n    this.emptyState = document.querySelector<HTMLElement>(this.selectors.emptyState);\n    this.disabledState = document.querySelector<HTMLElement>(this.selectors.disabledState);\n    this.errorState = document.querySelector<HTMLElement>(this.selectors.errorState);\n    this.countEl = document.querySelector<HTMLElement>(this.selectors.countEl);\n    this.prevBtn = document.querySelector<HTMLButtonElement>(this.selectors.prevBtn);\n    this.nextBtn = document.querySelector<HTMLButtonElement>(this.selectors.nextBtn);\n    this.refreshBtn = document.querySelector<HTMLButtonElement>(this.selectors.refreshBtn);\n    this.clearBtn = document.querySelector<HTMLButtonElement>(this.selectors.clearBtn);\n    this.limitInput = document.querySelector<HTMLSelectElement>(this.selectors.limitInput);\n  }\n\n  private bindEvents(): void {\n    this.form?.addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.state.limit = parseInt(this.limitInput?.value || '50', 10) || 50;\n      this.state.offset = 0;\n      this.loadActivity();\n    });\n\n    this.clearBtn?.addEventListener('click', () => {\n      FIELD_IDS.forEach((name) => this.setInputValue(name, ''));\n      DATE_FIELDS.forEach((name) => this.setInputValue(name, ''));\n      this.state.offset = 0;\n      this.loadActivity();\n    });\n\n    this.prevBtn?.addEventListener('click', () => {\n      this.state.offset = Math.max(0, this.state.offset - this.state.limit);\n      this.loadActivity();\n    });\n\n    this.nextBtn?.addEventListener('click', () => {\n      if (!this.state.hasMore) return;\n      this.state.offset = this.state.nextOffset;\n      this.loadActivity();\n    });\n\n    this.refreshBtn?.addEventListener('click', () => {\n      this.loadActivity();\n    });\n  }\n\n  private getInputValue(name: string): string {\n    const input = document.getElementById(`filter-${name.replace(/_/g, '-')}`);\n    if (!input) return '';\n    return String((input as HTMLInputElement).value || '').trim();\n  }\n\n  private setInputValue(name: string, value: string): void {\n    const input = document.getElementById(`filter-${name.replace(/_/g, '-')}`);\n    if (!input) return;\n    (input as HTMLInputElement).value = value || '';\n  }\n\n  private toLocalInput(value: string): string {\n    if (!value) return '';\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) return value;\n    const offset = parsed.getTimezoneOffset() * 60000;\n    return new Date(parsed.getTime() - offset).toISOString().slice(0, 16);\n  }\n\n  private toRFC3339(value: string): string {\n    if (!value) return '';\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) return '';\n    return parsed.toISOString();\n  }\n\n  private syncFromQuery(): void {\n    const params = new URLSearchParams(window.location.search);\n    const limit = parseInt(params.get('limit') || '', 10);\n    const offset = parseInt(params.get('offset') || '', 10);\n\n    if (!Number.isNaN(limit) && limit > 0) {\n      this.state.limit = limit;\n    }\n    if (!Number.isNaN(offset) && offset >= 0) {\n      this.state.offset = offset;\n    }\n\n    if (this.limitInput) {\n      this.limitInput.value = String(this.state.limit);\n    }\n\n    FIELD_IDS.forEach((name) => this.setInputValue(name, params.get(name) || ''));\n    DATE_FIELDS.forEach((name) => this.setInputValue(name, this.toLocalInput(params.get(name) || '')));\n    PASSTHROUGH_FIELDS.forEach((name) => {\n      const val = params.get(name);\n      if (val) {\n        this.state.extraParams[name] = val;\n      }\n    });\n  }\n\n  private buildParams(): URLSearchParams {\n    const params = new URLSearchParams();\n    params.set('limit', String(this.state.limit));\n    params.set('offset', String(this.state.offset));\n\n    FIELD_IDS.forEach((name) => {\n      const value = this.getInputValue(name);\n      if (value) params.set(name, value);\n    });\n\n    DATE_FIELDS.forEach((name) => {\n      const value = this.toRFC3339(this.getInputValue(name));\n      if (value) params.set(name, value);\n    });\n\n    Object.entries(this.state.extraParams).forEach(([key, value]) => {\n      if (value) params.set(key, value);\n    });\n\n    return params;\n  }\n\n  private syncUrl(params: URLSearchParams): void {\n    const query = params.toString();\n    const next = query ? `${window.location.pathname}?${query}` : window.location.pathname;\n    window.history.replaceState({}, '', next);\n  }\n\n  private resetStates(): void {\n    this.disabledState?.classList.add('hidden');\n    this.errorState?.classList.add('hidden');\n  }\n\n  private showError(message: string): void {\n    if (this.errorState) {\n      this.errorState.textContent = message;\n      this.errorState.classList.remove('hidden');\n    }\n  }\n\n  private showDisabled(message: string): void {\n    if (this.disabledState) {\n      this.disabledState.textContent = message;\n      this.disabledState.classList.remove('hidden');\n    }\n  }\n\n  async loadActivity(): Promise<void> {\n    this.resetStates();\n    const params = this.buildParams();\n    this.syncUrl(params);\n\n    const url = `${this.config.apiPath}?${params.toString()}`;\n\n    try {\n      const response = await fetch(url, { headers: { Accept: 'application/json' } });\n\n      if (!response.ok) {\n        let payload = null;\n        try {\n          payload = await response.json();\n        } catch {\n          payload = null;\n        }\n\n        if (response.status === 404 && payload?.text_code === 'FEATURE_DISABLED') {\n          this.showDisabled(payload.message || 'Activity feature disabled.');\n          this.renderRows([]);\n          this.updatePagination(0);\n          return;\n        }\n\n        this.showError(payload?.message || `Failed to load activity (${response.status})`);\n        return;\n      }\n\n      const payload: ActivityPayload = await response.json();\n      const entries = Array.isArray(payload.entries) ? payload.entries : [];\n\n      this.state.total = typeof payload.total === 'number' ? payload.total : entries.length;\n      this.state.hasMore = Boolean(payload.has_more);\n      this.state.nextOffset =\n        typeof payload.next_offset === 'number'\n          ? payload.next_offset\n          : this.state.offset + entries.length;\n\n      this.renderRows(entries);\n      this.updatePagination(entries.length);\n    } catch (err) {\n      this.showError('Failed to load activity.');\n    }\n  }\n\n  private renderRows(entries: ActivityEntry[]): void {\n    if (!this.tableBody) return;\n\n    this.tableBody.innerHTML = '';\n\n    if (!entries || entries.length === 0) {\n      this.emptyState?.classList.remove('hidden');\n      return;\n    }\n\n    this.emptyState?.classList.add('hidden');\n\n    entries.forEach((entry) => {\n      const { mainRow, detailsRow } = this.createRowPair(entry);\n      this.tableBody!.appendChild(mainRow);\n      if (detailsRow) {\n        this.tableBody!.appendChild(detailsRow);\n      }\n    });\n\n    // Wire up metadata toggles\n    this.wireMetadataToggles();\n  }\n\n  private createRowPair(entry: ActivityEntry): { mainRow: HTMLTableRowElement; detailsRow: HTMLTableRowElement | null } {\n    const actionLabels = this.config.actionLabels || {};\n    const parsedAction = parseActionString(entry.action, actionLabels);\n    const sentence = formatActivitySentence(entry, actionLabels);\n    const timestamp = formatTimestamp(entry.created_at);\n    const relativeTime = formatRelativeTime(entry.created_at);\n    const metadataSummary = getMetadataSummary(entry.metadata);\n    const metadataContent = formatMetadataExpanded(entry.metadata);\n    const shortChannel = formatChannel(entry.channel);\n\n    // Color scheme for action categories\n    const categoryColors: Record<string, { bg: string; color: string; border: string }> = {\n      created: { bg: '#ecfdf5', color: '#10b981', border: '#a7f3d0' },\n      updated: { bg: '#eff6ff', color: '#3b82f6', border: '#bfdbfe' },\n      deleted: { bg: '#fef2f2', color: '#ef4444', border: '#fecaca' },\n      auth: { bg: '#fffbeb', color: '#f59e0b', border: '#fde68a' },\n      viewed: { bg: '#f5f3ff', color: '#8b5cf6', border: '#ddd6fe' },\n      system: { bg: '#f9fafb', color: '#6b7280', border: '#e5e7eb' },\n    };\n    const colors = categoryColors[parsedAction.category] || categoryColors.system;\n\n    const mainRow = document.createElement('tr');\n    mainRow.className = `activity-row activity-row--${parsedAction.category}`;\n\n    // Build action cell with namespace icon and action badge\n    let actionCellHtml = '';\n    if (parsedAction.namespace) {\n      // Dotted action like \"debug.repl.close\" - show namespace icon + action badge\n      actionCellHtml = `\n        <div style=\"display: flex; align-items: center; gap: 8px;\">\n          <span style=\"display: flex; align-items: center; justify-content: center; width: 28px; height: 28px; background: #f3f4f6; border-radius: 6px; color: #6b7280;\" title=\"${escapeHtml(parsedAction.namespace)}\">\n            <i class=\"iconoir-${parsedAction.icon}\" style=\"font-size: 14px;\"></i>\n          </span>\n          <span style=\"display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; background-color: ${colors.bg}; color: ${colors.color}; border: 1px solid ${colors.border};\">\n            ${escapeHtml(parsedAction.action)}\n          </span>\n        </div>\n      `;\n    } else {\n      // Simple action - show as colored badge with icon\n      actionCellHtml = `\n        <span style=\"display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; background-color: ${colors.bg}; color: ${colors.color}; border: 1px solid ${colors.border};\">\n          <i class=\"iconoir-${parsedAction.icon}\" style=\"font-size: 14px;\"></i>\n          <span>${escapeHtml(parsedAction.action || '-')}</span>\n        </span>\n      `;\n    }\n\n    // Build channel cell with shortened ID and copy tooltip\n    let channelHtml = '';\n    if (entry.channel) {\n      channelHtml = `\n        <span style=\"display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; font-size: 11px; font-weight: 500; font-family: ui-monospace, monospace; color: #6b7280; background: #f3f4f6; border-radius: 4px; cursor: default;\" title=\"${escapeHtml(entry.channel)}\">\n          ${escapeHtml(shortChannel)}\n        </span>\n      `;\n    } else {\n      channelHtml = '<span style=\"color: #9ca3af; font-size: 12px;\">-</span>';\n    }\n\n    // Build metadata toggle button (if there's metadata)\n    let metadataCellHtml = '';\n    if (metadataSummary) {\n      metadataCellHtml = `\n        <button type=\"button\"\n                class=\"activity-metadata-toggle\"\n                style=\"display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; font-size: 12px; color: #6b7280; background: #f3f4f6; border: none; border-radius: 6px; cursor: pointer;\"\n                aria-expanded=\"false\"\n                data-metadata-toggle=\"${entry.id}\">\n          <span>${metadataSummary}</span>\n          <svg class=\"activity-metadata-chevron\" style=\"width: 12px; height: 12px; transition: transform 0.15s ease;\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n          </svg>\n        </button>\n      `;\n    } else {\n      metadataCellHtml = '<span style=\"color: #9ca3af; font-size: 12px;\">-</span>';\n    }\n\n    mainRow.innerHTML = `\n      <td style=\"padding: 12px 16px; vertical-align: middle; border-left: 3px solid ${colors.color};\">\n        <div style=\"font-size: 13px; color: #374151; white-space: nowrap;\">${timestamp}</div>\n        <div style=\"font-size: 11px; color: #9ca3af; margin-top: 2px;\">${relativeTime}</div>\n      </td>\n      <td style=\"padding: 12px 16px; vertical-align: middle;\">${actionCellHtml}</td>\n      <td style=\"padding: 12px 16px; vertical-align: middle;\">\n        <div style=\"font-size: 13px; line-height: 1.5; color: #374151;\">${sentence}</div>\n      </td>\n      <td style=\"padding: 12px 16px; vertical-align: middle; text-align: center;\">${channelHtml}</td>\n      <td style=\"padding: 12px 16px; vertical-align: middle;\">${metadataCellHtml}</td>\n    `;\n\n    // Create details row (hidden by default) if there's metadata\n    let detailsRow: HTMLTableRowElement | null = null;\n    if (metadataSummary) {\n      detailsRow = document.createElement('tr');\n      detailsRow.className = 'activity-details-row';\n      detailsRow.style.display = 'none';\n      detailsRow.dataset.metadataContent = entry.id;\n      detailsRow.innerHTML = `\n        <td colspan=\"5\" style=\"padding: 0; background: #f9fafb; border-left: 3px solid ${colors.color};\">\n          <div style=\"padding: 16px 24px; border-top: 1px solid #e5e7eb;\">\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px 24px;\">\n              ${metadataContent}\n            </div>\n          </div>\n        </td>\n      `;\n    }\n\n    return { mainRow, detailsRow };\n  }\n\n  private wireMetadataToggles(): void {\n    const toggles = document.querySelectorAll<HTMLButtonElement>('[data-metadata-toggle]');\n\n    toggles.forEach((toggle) => {\n      toggle.addEventListener('click', () => {\n        const entryId = toggle.dataset.metadataToggle;\n        // Find the details row (separate tr element)\n        const detailsRow = document.querySelector<HTMLTableRowElement>(`tr[data-metadata-content=\"${entryId}\"]`);\n\n        if (!detailsRow) return;\n\n        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';\n        const newExpanded = !isExpanded;\n\n        // Toggle the details row visibility\n        detailsRow.style.display = newExpanded ? 'table-row' : 'none';\n        toggle.setAttribute('aria-expanded', newExpanded ? 'true' : 'false');\n\n        // Update toggle button appearance\n        toggle.style.background = newExpanded ? '#e5e7eb' : '#f3f4f6';\n\n        // Rotate chevron\n        const chevron = toggle.querySelector<SVGElement>('.activity-metadata-chevron');\n        if (chevron) {\n          chevron.style.transform = newExpanded ? 'rotate(180deg)' : 'rotate(0deg)';\n        }\n      });\n    });\n  }\n\n  private updatePagination(count: number): void {\n    const total = Number.isFinite(this.state.total) ? this.state.total : 0;\n    const start = count > 0 ? this.state.offset + 1 : 0;\n    const end = this.state.offset + count;\n\n    if (this.countEl) {\n      if (total > 0) {\n        this.countEl.textContent = `Showing ${start}-${end} of ${total}`;\n      } else if (count > 0) {\n        this.countEl.textContent = `Showing ${start}-${end}`;\n      } else {\n        this.countEl.textContent = 'No activity entries';\n      }\n    }\n\n    if (this.prevBtn) {\n      this.prevBtn.disabled = this.state.offset <= 0;\n    }\n\n    if (this.nextBtn) {\n      this.nextBtn.disabled = !this.state.hasMore;\n    }\n  }\n}\n"],"names":["ACTION_CATEGORY_MAP","ACTION_ICONS","NAMESPACE_ICONS","resolveActionLabel","actionStr","labels","trimmed","label","parseActionString","actionLabel","parts","namespace","action","icon","verb","category","getActionCategory","normalized","parseObject","object","colonIndex","capitalize","str","formatObjectType","type","escapeHtml","text","div","shortenId","id","length","clean","isUuidLike","formatIdWithTooltip","shortened","formatActivitySentence","entry","actor","rawVerb","actorDisplay","objectRef","shortId","ip","formatTimestamp","value","date","formatRelativeTime","diffMs","diffSecs","diffMins","diffHours","diffDays","countMetadataFields","metadata","getMetadataSummary","count","formatMetadataExpanded","entries","key","formattedKey","formattedValue","formatValue","jsonStr","truncated","formatChannel","channel","getActionClass","getActionIconHtml","DEFAULT_SELECTORS","FIELD_IDS","DATE_FIELDS","PASSTHROUGH_FIELDS","ActivityManager","config","selectors","toast","e","name","input","parsed","offset","params","limit","val","query","next","message","url","response","payload","mainRow","detailsRow","actionLabels","parsedAction","sentence","timestamp","relativeTime","metadataSummary","metadataContent","shortChannel","categoryColors","colors","actionCellHtml","channelHtml","metadataCellHtml","toggle","entryId","newExpanded","chevron","total","start","end"],"mappings":"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"}