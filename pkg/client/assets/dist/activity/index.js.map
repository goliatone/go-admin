{"version":3,"file":"index.js","sources":["../../src/activity/formatters.ts","../../src/activity/activity-view-switcher.ts","../../src/activity/activity-timeline.ts","../../src/activity/activity-manager.ts"],"sourcesContent":["/**\n * Activity Feed Formatters\n * Handles action categorization, sentence formatting, and metadata display\n */\n\nimport type { ActivityEntry, ActionCategory, ParsedObject, ActorType } from './types.js';\nimport { renderIcon } from '../shared/icon-renderer.js';\n\n/**\n * Mapping of verbs to action categories\n */\nconst ACTION_CATEGORY_MAP: Record<string, ActionCategory> = {\n  // Created\n  created: 'created',\n  added: 'created',\n  inserted: 'created',\n  registered: 'created',\n  signed_up: 'created',\n  imported: 'created',\n\n  // Updated\n  updated: 'updated',\n  modified: 'updated',\n  changed: 'updated',\n  edited: 'updated',\n  saved: 'updated',\n  enabled: 'updated',\n  disabled: 'updated',\n  activated: 'updated',\n  deactivated: 'updated',\n\n  // Deleted\n  deleted: 'deleted',\n  removed: 'deleted',\n  destroyed: 'deleted',\n  purged: 'deleted',\n  archived: 'deleted',\n\n  // Auth\n  login: 'auth',\n  logout: 'auth',\n  logged_in: 'auth',\n  logged_out: 'auth',\n  authenticated: 'auth',\n  password_reset: 'auth',\n  password_changed: 'auth',\n  token_refreshed: 'auth',\n  session_expired: 'auth',\n\n  // Viewed\n  viewed: 'viewed',\n  accessed: 'viewed',\n  read: 'viewed',\n  downloaded: 'viewed',\n  exported: 'viewed',\n};\n\nconst METADATA_KEY_ACTOR_DISPLAY = 'actor_display';\nconst METADATA_KEY_OBJECT_DISPLAY = 'object_display';\nconst METADATA_KEY_OBJECT_DELETED = 'object_deleted';\nconst METADATA_KEY_ACTOR_TYPE = 'actor_type';\nconst METADATA_KEY_ACTOR_EMAIL = 'actor_email';\nconst METADATA_KEY_SESSION_ID = 'session_id';\nconst METADATA_KEY_ENRICHED_AT = 'enriched_at';\nconst METADATA_KEY_ENRICHER_VERSION = 'enricher_version';\n\n/**\n * Icons for actor types (using iconoir icon names)\n */\nexport const ACTOR_TYPE_ICONS: Record<ActorType, string> = {\n  user: 'user',\n  system: 'settings',\n  job: 'clock',\n  api: 'cloud',\n  unknown: 'help-circle',\n};\n\n/**\n * Labels for actor types\n */\nexport const ACTOR_TYPE_LABELS: Record<ActorType, string> = {\n  user: 'User',\n  system: 'System',\n  job: 'Job',\n  api: 'API',\n  unknown: 'Unknown',\n};\n\n/**\n * Check if a value looks like it's been masked (hashed or partially hidden)\n */\nexport function isMaskedValue(value: unknown): boolean {\n  if (typeof value !== 'string') return false;\n  if (!value) return false;\n\n  // Check for common masking patterns:\n  // - All asterisks: ****\n  // - Partial masking: abc***xyz\n  // - Hash-like strings (long hex strings that aren't UUIDs)\n  // - [REDACTED], [HIDDEN], [MASKED] placeholders\n\n  const trimmed = value.trim();\n\n  // Check for placeholder patterns\n  if (/^\\[(REDACTED|HIDDEN|MASKED|REMOVED)\\]$/i.test(trimmed)) {\n    return true;\n  }\n\n  // Check for all asterisks\n  if (/^\\*+$/.test(trimmed)) {\n    return true;\n  }\n\n  // Check for partial masking with asterisks in the middle\n  if (/^[^*]+\\*{3,}[^*]+$/.test(trimmed)) {\n    return true;\n  }\n\n  // Check for hash-like strings (64+ hex chars, not a UUID)\n  const clean = trimmed.replace(/-/g, '');\n  if (/^[0-9a-f]{64,}$/i.test(clean)) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Check if metadata is empty or hidden (support role scenario)\n */\nexport function isMetadataHidden(metadata: Record<string, unknown> | undefined): boolean {\n  if (!metadata) return true;\n  if (typeof metadata !== 'object') return true;\n\n  const keys = Object.keys(metadata);\n  if (keys.length === 0) return true;\n\n  // Check if all values are null, undefined, or empty strings\n  return keys.every(key => {\n    const value = metadata[key];\n    return value === null || value === undefined || value === '';\n  });\n}\n\n/**\n * Icons for each action category (using iconoir icon names)\n */\nexport const ACTION_ICONS: Record<ActionCategory, string> = {\n  created: 'plus',\n  updated: 'edit-pencil',\n  deleted: 'trash',\n  auth: 'key',\n  viewed: 'eye',\n  system: 'settings',\n};\n\n/**\n * Icons for action namespaces (first segment of dotted action strings)\n */\nexport const NAMESPACE_ICONS: Record<string, string> = {\n  debug: 'terminal',\n  user: 'user',\n  users: 'group',\n  auth: 'key',\n  admin: 'settings',\n  system: 'cpu',\n  api: 'cloud',\n  db: 'database',\n  cache: 'archive',\n  file: 'folder',\n  email: 'mail',\n  notification: 'bell',\n  webhook: 'link',\n  job: 'clock',\n  queue: 'list',\n  export: 'download',\n  import: 'upload',\n  report: 'page',\n  log: 'clipboard',\n  config: 'adjustments',\n  settings: 'settings',\n  security: 'shield',\n  tenant: 'building',\n  org: 'community',\n  media: 'media-image',\n  content: 'page-edit',\n  repl: 'terminal',\n};\n\n/**\n * Parse a dotted action string like \"debug.repl.close\" into namespace and action\n */\nexport interface ParsedAction {\n  namespace: string;\n  action: string;\n  icon: string;\n  category: ActionCategory;\n}\n\nexport function resolveActionLabel(\n  actionStr: string,\n  labels?: Record<string, string>\n): string {\n  if (!actionStr) return '';\n  if (!labels) return actionStr;\n  const trimmed = actionStr.trim();\n  if (!trimmed) return actionStr;\n  const label = labels[trimmed];\n  if (typeof label === 'string' && label.trim() !== '') {\n    return label;\n  }\n  return actionStr;\n}\n\nexport function parseActionString(\n  actionStr: string,\n  labels?: Record<string, string>\n): ParsedAction {\n  if (!actionStr) {\n    return { namespace: '', action: '', icon: 'activity', category: 'system' };\n  }\n\n  const actionLabel = resolveActionLabel(actionStr, labels);\n\n  // Check if it's a dotted notation action\n  if (actionStr.includes('.')) {\n    const parts = actionStr.split('.');\n    const namespace = parts[0].toLowerCase();\n    const action = parts.slice(1).join('.');\n    const icon = NAMESPACE_ICONS[namespace] || 'activity';\n\n    // Determine category from the last part (the verb)\n    const verb = parts[parts.length - 1];\n    const category = getActionCategory(verb);\n\n    const displayAction = actionLabel !== actionStr ? actionLabel : action;\n    return { namespace, action: displayAction, icon, category };\n  }\n\n  // Standard single-word action\n  const category = getActionCategory(actionStr);\n  const displayAction = actionLabel !== actionStr ? actionLabel : actionStr;\n  return {\n    namespace: '',\n    action: displayAction,\n    icon: ACTION_ICONS[category],\n    category,\n  };\n}\n\n/**\n * Get the action category for a verb\n */\nexport function getActionCategory(verb: string): ActionCategory {\n  if (!verb) return 'system';\n  const normalized = verb.toLowerCase().trim().replace(/-/g, '_');\n  return ACTION_CATEGORY_MAP[normalized] || 'system';\n}\n\n/**\n * Parse an object string (format: \"type:id\") into its components\n */\nexport function parseObject(object: string): ParsedObject {\n  if (!object) return { type: '', id: '' };\n\n  if (!object.includes(':')) {\n    return { type: object, id: '' };\n  }\n\n  const colonIndex = object.indexOf(':');\n  return {\n    type: object.substring(0, colonIndex),\n    id: object.substring(colonIndex + 1),\n  };\n}\n\nfunction getMetadataString(\n  metadata: Record<string, unknown> | undefined,\n  key: string\n): string {\n  if (!metadata || typeof metadata !== 'object') return '';\n  const value = metadata[key];\n  if (value === null || value === undefined) return '';\n  if (typeof value === 'string') return value.trim();\n  if (typeof value === 'number' || typeof value === 'boolean') return String(value);\n  return '';\n}\n\nfunction firstNonEmpty(...values: string[]): string {\n  for (const value of values) {\n    if (!value) continue;\n    const trimmed = value.trim();\n    if (trimmed) return trimmed;\n  }\n  return '';\n}\n\nexport function resolveActorLabel(entry: ActivityEntry): string {\n  return firstNonEmpty(getMetadataString(entry.metadata, METADATA_KEY_ACTOR_DISPLAY), entry.actor);\n}\n\nexport function resolveObjectDisplay(entry: ActivityEntry): string {\n  return getMetadataString(entry.metadata, METADATA_KEY_OBJECT_DISPLAY);\n}\n\n/**\n * Check if the object has been deleted\n */\nexport function isObjectDeleted(entry: ActivityEntry): boolean {\n  if (!entry.metadata || typeof entry.metadata !== 'object') return false;\n  return entry.metadata[METADATA_KEY_OBJECT_DELETED] === true;\n}\n\n/**\n * Get the actor type from metadata\n */\nexport function getActorType(entry: ActivityEntry): ActorType {\n  if (!entry.metadata || typeof entry.metadata !== 'object') return 'unknown';\n  const value = entry.metadata[METADATA_KEY_ACTOR_TYPE];\n  if (typeof value === 'string') {\n    const normalized = value.toLowerCase() as ActorType;\n    if (normalized in ACTOR_TYPE_ICONS) {\n      return normalized;\n    }\n  }\n  return 'unknown';\n}\n\n/**\n * Get the actor email from metadata (may be masked)\n */\nexport function getActorEmail(entry: ActivityEntry): string {\n  return getMetadataString(entry.metadata, METADATA_KEY_ACTOR_EMAIL);\n}\n\n/**\n * Get the session ID from metadata\n */\nexport function getSessionId(entry: ActivityEntry): string {\n  return getMetadataString(entry.metadata, METADATA_KEY_SESSION_ID);\n}\n\n/**\n * Get enrichment info (enriched_at and enricher_version)\n */\nexport function getEnrichmentInfo(entry: ActivityEntry): { enrichedAt: string; enricherVersion: string } | null {\n  const enrichedAt = getMetadataString(entry.metadata, METADATA_KEY_ENRICHED_AT);\n  const enricherVersion = getMetadataString(entry.metadata, METADATA_KEY_ENRICHER_VERSION);\n\n  if (!enrichedAt && !enricherVersion) return null;\n\n  return { enrichedAt, enricherVersion };\n}\n\n/**\n * Capitalize the first letter of a string\n */\nfunction capitalize(str: string): string {\n  if (!str) return '';\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Format object type for display (e.g., \"user_profile\" -> \"User Profile\")\n */\nfunction formatObjectType(type: string): string {\n  if (!type) return '';\n  return type\n    .split(/[_-]/)\n    .map(capitalize)\n    .join(' ');\n}\n\n/**\n * Escape HTML to prevent XSS\n */\nexport function escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Shorten a UUID or long string to first N characters (like git short hash)\n */\nexport function shortenId(id: string, length: number = 7): string {\n  if (!id) return '';\n  // Remove dashes for UUID detection\n  const clean = id.replace(/-/g, '');\n  // If it looks like a UUID (32 hex chars without dashes), shorten it\n  if (/^[0-9a-f]{32}$/i.test(clean)) {\n    return id.substring(0, length);\n  }\n  // For other long strings, also shorten\n  if (id.length > length + 3) {\n    return id.substring(0, length);\n  }\n  return id;\n}\n\n/**\n * Check if a string looks like a UUID\n */\nfunction isUuidLike(str: string): boolean {\n  if (!str) return false;\n  const clean = str.replace(/-/g, '');\n  return /^[0-9a-f]{32}$/i.test(clean);\n}\n\n/**\n * Format an ID for display with optional tooltip for full value\n * Returns HTML with shortened ID and title attribute for full ID\n */\nfunction formatIdWithTooltip(id: string, length: number = 8): string {\n  if (!id) return '';\n  const shortened = shortenId(id, length);\n  if (shortened === id) {\n    return escapeHtml(id);\n  }\n  // Return span with tooltip showing full ID\n  return `<span class=\"activity-id-short\" title=\"${escapeHtml(id)}\" style=\"cursor: help; border-bottom: 1px dotted #9ca3af;\">${escapeHtml(shortened)}</span>`;\n}\n\n/**\n * Options for formatting activity sentences\n */\nexport interface FormatActivitySentenceOptions {\n  /** Include actor type badge before the actor name (for table view) */\n  showActorTypeBadge?: boolean;\n}\n\n/**\n * Format an activity entry into a human-readable sentence\n */\nexport function formatActivitySentence(\n  entry: ActivityEntry,\n  labels?: Record<string, string>,\n  options?: FormatActivitySentenceOptions\n): string {\n  const { showActorTypeBadge = false } = options || {};\n  const actor = resolveActorLabel(entry) || 'Unknown';\n  const rawVerb = entry.action || 'performed action on';\n  const verb = resolveActionLabel(rawVerb, labels);\n\n  // Get actor type badge if requested (only for non-user types)\n  let actorTypeBadge = '';\n  if (showActorTypeBadge) {\n    const actorType = getActorType(entry);\n    if (actorType !== 'user' && actorType !== 'unknown') {\n      actorTypeBadge = getActorTypeIconHtml(actorType, { badge: true, size: 'sm' }) + ' ';\n    }\n  }\n\n  // Format actor - shorten if UUID\n  const actorDisplay = isUuidLike(actor)\n    ? `${actorTypeBadge}${formatIdWithTooltip(actor, 8)}`\n    : `${actorTypeBadge}<strong>${escapeHtml(actor)}</strong>`;\n\n  // Check if object has been deleted\n  const objectDeleted = isObjectDeleted(entry);\n  const deletedMarker = objectDeleted\n    ? ' <span class=\"activity-deleted-marker\" title=\"This object has been deleted\">(deleted)</span>'\n    : '';\n\n  // Build object reference with shortened ID\n  let objectRef = '';\n  const objectDisplay = resolveObjectDisplay(entry);\n  if (objectDisplay) {\n    objectRef = escapeHtml(objectDisplay) + deletedMarker;\n  } else {\n    const { type, id } = parseObject(entry.object);\n    if (type && id) {\n      const shortId = formatIdWithTooltip(id, 8);\n      objectRef = `${escapeHtml(formatObjectType(type))} #${shortId}${deletedMarker}`;\n    } else if (type) {\n      objectRef = escapeHtml(formatObjectType(type)) + deletedMarker;\n    } else if (id) {\n      objectRef = `#${formatIdWithTooltip(id, 8)}${deletedMarker}`;\n    }\n  }\n\n  // Build sentence based on action category\n  const category = getActionCategory(rawVerb);\n\n  // Special handling for auth events\n  if (category === 'auth') {\n    const ip = entry.metadata?.ip || entry.metadata?.IP;\n    if (ip) {\n      return `${actorDisplay} ${escapeHtml(verb)} from ${escapeHtml(String(ip))}`;\n    }\n    return `${actorDisplay} ${escapeHtml(verb)}`;\n  }\n\n  // Standard sentence\n  if (objectRef) {\n    return `${actorDisplay} ${escapeHtml(verb)} <strong>${objectRef}</strong>`;\n  }\n\n  return `${actorDisplay} ${escapeHtml(verb)}`;\n}\n\n/**\n * Format a timestamp for display\n */\nexport function formatTimestamp(value: string): string {\n  if (!value) return '-';\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return value;\n  }\n  return date.toLocaleString();\n}\n\n/**\n * Format relative time in short format (e.g., \"2h ago\")\n */\nexport function formatRelativeTime(value: string): string {\n  if (!value) return '';\n\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return value;\n\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffSecs = Math.floor(diffMs / 1000);\n  const diffMins = Math.floor(diffSecs / 60);\n  const diffHours = Math.floor(diffMins / 60);\n  const diffDays = Math.floor(diffHours / 24);\n\n  if (diffSecs < 60) return 'just now';\n  if (diffMins < 60) return `${diffMins}m ago`;\n  if (diffHours < 24) return `${diffHours}h ago`;\n  if (diffDays < 7) return `${diffDays}d ago`;\n\n  return date.toLocaleDateString();\n}\n\n/**\n * Format relative time using Intl.RelativeTimeFormat for natural language output\n * (e.g., \"2 hours ago\", \"yesterday\", \"3 days ago\")\n */\nexport function formatRelativeTimeIntl(value: string): string {\n  if (!value) return '';\n\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return value;\n\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffSecs = Math.floor(diffMs / 1000);\n  const diffMins = Math.floor(diffSecs / 60);\n  const diffHours = Math.floor(diffMins / 60);\n  const diffDays = Math.floor(diffHours / 24);\n\n  const rtf = new Intl.RelativeTimeFormat('en', { numeric: 'auto' });\n\n  if (diffSecs < 60) return 'just now';\n  if (diffMins < 60) return rtf.format(-diffMins, 'minute');\n  if (diffHours < 24) return rtf.format(-diffHours, 'hour');\n  if (diffDays < 7) return rtf.format(-diffDays, 'day');\n  if (diffDays < 30) {\n    const weeks = Math.floor(diffDays / 7);\n    return rtf.format(-weeks, 'week');\n  }\n\n  return date.toLocaleDateString();\n}\n\n/**\n * Get date label for timeline grouping (\"Today\", \"Yesterday\", or formatted date)\n */\nexport function getDateGroupLabel(date: Date): string {\n  const now = new Date();\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n  const targetDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n\n  if (targetDate.getTime() === today.getTime()) {\n    return 'Today';\n  }\n  if (targetDate.getTime() === yesterday.getTime()) {\n    return 'Yesterday';\n  }\n\n  // Use Intl.DateTimeFormat for consistent formatting\n  return new Intl.DateTimeFormat('en', {\n    weekday: 'long',\n    month: 'short',\n    day: 'numeric',\n    year: targetDate.getFullYear() !== now.getFullYear() ? 'numeric' : undefined,\n  }).format(date);\n}\n\n/**\n * Get the start of day for a given date (midnight in local timezone)\n */\nexport function getStartOfDay(date: Date): Date {\n  return new Date(date.getFullYear(), date.getMonth(), date.getDate());\n}\n\n/**\n * Get a stable date key for grouping (YYYY-MM-DD format)\n */\nexport function getDateKey(date: Date): string {\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * Count the number of fields in metadata\n */\nexport function countMetadataFields(metadata: Record<string, unknown> | undefined): number {\n  if (!metadata || typeof metadata !== 'object') return 0;\n  return Object.keys(metadata).length;\n}\n\n/**\n * Get a summary of metadata changes\n * Returns a summary string, or 'hidden' for support role scenario, or empty for no metadata\n */\nexport function getMetadataSummary(metadata: Record<string, unknown> | undefined | null): string {\n  // Handle null/undefined metadata as hidden (support role scenario where backend omits metadata)\n  if (metadata === null) return 'hidden';\n  if (metadata === undefined) return '';\n  if (typeof metadata !== 'object') return '';\n\n  const count = countMetadataFields(metadata);\n\n  // Empty object {} is treated as hidden (support role scenario)\n  if (count === 0) return 'hidden';\n\n  // Check if metadata has keys but all values are empty/null (another hidden scenario)\n  if (isMetadataHidden(metadata)) {\n    return 'hidden';\n  }\n\n  if (count === 1) return '1 field';\n  return `${count} fields`;\n}\n\n/**\n * Format metadata for expanded display (grid-friendly items)\n */\nexport function formatMetadataExpanded(metadata: Record<string, unknown> | undefined | null): string {\n  // Handle null metadata as hidden (support role scenario)\n  if (metadata === null) {\n    return `\n      <div class=\"activity-metadata-hidden\" style=\"padding: 12px; background: #f9fafb; border-radius: 6px; border: 1px dashed #d1d5db; text-align: center;\">\n        <span style=\"color: #9ca3af; font-size: 12px; font-style: italic;\">Metadata hidden</span>\n      </div>\n    `;\n  }\n\n  if (metadata === undefined || typeof metadata !== 'object') return '';\n\n  const entries = Object.entries(metadata);\n\n  // Empty object {} or all-null values = hidden\n  if (entries.length === 0 || isMetadataHidden(metadata)) {\n    return `\n      <div class=\"activity-metadata-hidden\" style=\"padding: 12px; background: #f9fafb; border-radius: 6px; border: 1px dashed #d1d5db; text-align: center;\">\n        <span style=\"color: #9ca3af; font-size: 12px; font-style: italic;\">Metadata hidden</span>\n      </div>\n    `;\n  }\n\n  const items = entries.map(([key, value]) => {\n    const formattedKey = escapeHtml(key);\n    let formattedValue: string;\n    let isMasked = false;\n\n    // Check if this value is masked\n    if (isMaskedValue(value)) {\n      isMasked = true;\n      formattedValue = `<span class=\"activity-masked-value\" title=\"This value is masked\">${escapeHtml(String(value))}</span>`;\n    } else if (key.endsWith('_old') || key.endsWith('_new')) {\n      // Check for change diff pattern (old_value -> new_value)\n      formattedValue = escapeHtml(formatValue(value));\n    } else if (typeof value === 'object' && value !== null) {\n      // Truncate JSON strings\n      const jsonStr = JSON.stringify(value);\n      const truncated = jsonStr.length > 100 ? jsonStr.substring(0, 100) + '...' : jsonStr;\n      formattedValue = `<code style=\"font-size: 11px; background: #e5e7eb; padding: 2px 6px; border-radius: 4px; word-break: break-all;\">${escapeHtml(truncated)}</code>`;\n    } else {\n      formattedValue = escapeHtml(formatValue(value));\n    }\n\n    const maskedClass = isMasked ? ' activity-metadata-item--masked' : '';\n\n    return `\n      <div class=\"activity-metadata-item${maskedClass}\" style=\"display: flex; flex-direction: column; gap: 2px; padding: 8px 12px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;\">\n        <span style=\"color: #6b7280; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;\">${formattedKey}</span>\n        <span style=\"color: #111827; font-size: 12px; font-weight: 500; word-break: break-word;\">${formattedValue}</span>\n      </div>\n    `;\n  });\n\n  return items.join('');\n}\n\n/**\n * Format enrichment debug info for display (collapsible diagnostics panel)\n */\nexport function formatEnrichmentDebugInfo(entry: ActivityEntry): string {\n  const info = getEnrichmentInfo(entry);\n  if (!info) return '';\n\n  const items: string[] = [];\n\n  if (info.enrichedAt) {\n    const date = new Date(info.enrichedAt);\n    const formatted = Number.isNaN(date.getTime()) ? info.enrichedAt : date.toLocaleString();\n    items.push(`\n      <div style=\"display: flex; justify-content: space-between; gap: 8px;\">\n        <span style=\"color: #9ca3af; font-size: 11px;\">Enriched at:</span>\n        <span style=\"color: #6b7280; font-size: 11px; font-family: ui-monospace, monospace;\">${escapeHtml(formatted)}</span>\n      </div>\n    `);\n  }\n\n  if (info.enricherVersion) {\n    items.push(`\n      <div style=\"display: flex; justify-content: space-between; gap: 8px;\">\n        <span style=\"color: #9ca3af; font-size: 11px;\">Enricher version:</span>\n        <span style=\"color: #6b7280; font-size: 11px; font-family: ui-monospace, monospace;\">${escapeHtml(info.enricherVersion)}</span>\n      </div>\n    `);\n  }\n\n  if (items.length === 0) return '';\n\n  return `\n    <div class=\"activity-enrichment-debug\" style=\"margin-top: 8px; padding: 8px; background: #f9fafb; border-radius: 4px; border: 1px dashed #e5e7eb;\">\n      <div style=\"display: flex; align-items: center; gap: 4px; margin-bottom: 6px;\">\n        <i class=\"iconoir-info-circle\" style=\"font-size: 12px; color: #9ca3af;\"></i>\n        <span style=\"color: #9ca3af; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;\">Debug Info</span>\n      </div>\n      ${items.join('')}\n    </div>\n  `;\n}\n\n/**\n * Format a value for display\n */\nfunction formatValue(value: unknown): string {\n  if (value === null || value === undefined) return '-';\n  if (typeof value === 'boolean') return value ? 'Yes' : 'No';\n  if (typeof value === 'number') return String(value);\n  if (typeof value === 'string') {\n    // Truncate long strings\n    if (value.length > 100) {\n      return value.substring(0, 100) + '...';\n    }\n    return value;\n  }\n  return JSON.stringify(value);\n}\n\n/**\n * Format channel for display (shorten UUIDs)\n */\nexport function formatChannel(channel: string | undefined): string {\n  if (!channel) return '';\n  return shortenId(channel, 7);\n}\n\n/**\n * Get CSS class for action category\n */\nexport function getActionClass(category: ActionCategory): string {\n  return `activity-action--${category}`;\n}\n\n/**\n * Get icon HTML for action category\n */\nexport function getActionIconHtml(category: ActionCategory): string {\n  const icon = ACTION_ICONS[category];\n  return renderIcon(`iconoir:${icon}`, { extraClass: 'activity-action-icon' });\n}\n\n/**\n * Get actor type icon HTML with optional badge styling\n */\nexport function getActorTypeIconHtml(actorType: ActorType, options?: { badge?: boolean; size?: 'sm' | 'md' | 'lg' }): string {\n  const { badge = false, size = 'md' } = options || {};\n  const icon = ACTOR_TYPE_ICONS[actorType];\n  const label = ACTOR_TYPE_LABELS[actorType];\n\n  const sizeMap: Record<string, string> = {\n    sm: '12px',\n    md: '14px',\n    lg: '16px',\n  };\n\n  if (badge) {\n    const iconHtml = renderIcon(`iconoir:${icon}`, { size: sizeMap[size] });\n    return `\n      <span class=\"activity-actor-type-badge activity-actor-type-badge--${actorType}\" title=\"${escapeHtml(label)}\">\n        ${iconHtml}\n      </span>\n    `;\n  }\n\n  return renderIcon(`iconoir:${icon}`, {\n    size: sizeMap[size],\n    extraClass: `activity-actor-type-icon activity-actor-type-icon--${actorType}`,\n  });\n}\n\n/**\n * Format actor display with type icon\n */\nexport function formatActorWithType(entry: ActivityEntry): string {\n  const actor = resolveActorLabel(entry) || 'Unknown';\n  const actorType = getActorType(entry);\n\n  // Format actor - shorten if UUID\n  const actorDisplay = isUuidLike(actor)\n    ? formatIdWithTooltip(actor, 8)\n    : escapeHtml(actor);\n\n  // Only show icon for non-user types (user is the default/expected)\n  const typeIcon = actorType !== 'user' && actorType !== 'unknown'\n    ? getActorTypeIconHtml(actorType, { badge: true, size: 'sm' }) + ' '\n    : '';\n\n  return `${typeIcon}<strong>${actorDisplay}</strong>`;\n}\n\n/**\n * Shorten a session ID for display\n */\nexport function formatSessionId(sessionId: string, length: number = 10): string {\n  if (!sessionId) return '';\n  return shortenId(sessionId, length);\n}\n\n/**\n * Get session group label for timeline display\n */\nexport function getSessionGroupLabel(sessionId: string): string {\n  if (!sessionId) return 'No session';\n  if (isMaskedValue(sessionId)) return 'Session (masked)';\n  return `Session ${formatSessionId(sessionId, 8)}`;\n}\n","/**\n * Activity View Switcher\n * Manages switching between table and timeline views with state persistence\n */\n\nimport type { ActivityViewMode, ViewSwitcherSelectors } from './types.js';\n\nconst DEFAULT_SELECTORS: ViewSwitcherSelectors = {\n  container: '#activity-view-switcher',\n  tableTab: '[data-view-tab=\"table\"]',\n  timelineTab: '[data-view-tab=\"timeline\"]',\n  tableView: '#activity-table-container',\n  timelineView: '#activity-timeline-container',\n  paginationContainer: '#activity-pagination',\n};\n\nconst STORAGE_KEY = 'activity-view-preference';\nconst URL_PARAM = 'view';\n\nexport class ActivityViewSwitcher {\n  private selectors: ViewSwitcherSelectors;\n  private currentView: ActivityViewMode = 'table';\n  private onViewChange?: (view: ActivityViewMode) => void;\n\n  private container: HTMLElement | null = null;\n  private tableTab: HTMLElement | null = null;\n  private timelineTab: HTMLElement | null = null;\n  private tableView: HTMLElement | null = null;\n  private timelineView: HTMLElement | null = null;\n  private paginationContainer: HTMLElement | null = null;\n\n  constructor(\n    selectors: Partial<ViewSwitcherSelectors> = {},\n    onViewChange?: (view: ActivityViewMode) => void\n  ) {\n    this.selectors = { ...DEFAULT_SELECTORS, ...selectors };\n    this.onViewChange = onViewChange;\n  }\n\n  /**\n   * Initialize the view switcher\n   */\n  init(): void {\n    this.cacheElements();\n    this.bindEvents();\n    this.restoreView();\n  }\n\n  /**\n   * Get the current view mode\n   */\n  getView(): ActivityViewMode {\n    return this.currentView;\n  }\n\n  /**\n   * Set the view mode programmatically\n   */\n  setView(view: ActivityViewMode, options: { persist?: boolean; updateUrl?: boolean } = {}): void {\n    const { persist = true, updateUrl = true } = options;\n\n    if (view !== 'table' && view !== 'timeline') {\n      view = 'table';\n    }\n\n    this.currentView = view;\n    this.updateUI();\n\n    if (persist) {\n      this.persistView();\n    }\n\n    if (updateUrl) {\n      this.updateUrlParam();\n    }\n\n    // Emit view change event\n    this.emitViewChange();\n  }\n\n  /**\n   * Destroy the view switcher and clean up event listeners\n   */\n  destroy(): void {\n    this.tableTab?.removeEventListener('click', this.handleTableClick);\n    this.timelineTab?.removeEventListener('click', this.handleTimelineClick);\n  }\n\n  private cacheElements(): void {\n    this.container = document.querySelector<HTMLElement>(this.selectors.container);\n    this.tableTab = document.querySelector<HTMLElement>(this.selectors.tableTab);\n    this.timelineTab = document.querySelector<HTMLElement>(this.selectors.timelineTab);\n    this.tableView = document.querySelector<HTMLElement>(this.selectors.tableView);\n    this.timelineView = document.querySelector<HTMLElement>(this.selectors.timelineView);\n    this.paginationContainer = document.querySelector<HTMLElement>(this.selectors.paginationContainer);\n  }\n\n  private handleTableClick = (): void => {\n    this.setView('table');\n  };\n\n  private handleTimelineClick = (): void => {\n    this.setView('timeline');\n  };\n\n  private bindEvents(): void {\n    this.tableTab?.addEventListener('click', this.handleTableClick);\n    this.timelineTab?.addEventListener('click', this.handleTimelineClick);\n  }\n\n  /**\n   * Restore view from URL param or localStorage\n   */\n  private restoreView(): void {\n    // URL param takes precedence\n    const params = new URLSearchParams(window.location.search);\n    const urlView = params.get(URL_PARAM) as ActivityViewMode | null;\n\n    if (urlView === 'table' || urlView === 'timeline') {\n      this.setView(urlView, { persist: true, updateUrl: false });\n      return;\n    }\n\n    // Fall back to localStorage\n    const storedView = localStorage.getItem(STORAGE_KEY) as ActivityViewMode | null;\n    if (storedView === 'table' || storedView === 'timeline') {\n      this.setView(storedView, { persist: false, updateUrl: true });\n      return;\n    }\n\n    // Default to table view\n    this.setView('table', { persist: false, updateUrl: false });\n  }\n\n  /**\n   * Update UI elements to reflect current view\n   */\n  private updateUI(): void {\n    const isTable = this.currentView === 'table';\n\n    // Update tab states\n    if (this.tableTab) {\n      this.tableTab.setAttribute('aria-selected', isTable ? 'true' : 'false');\n      this.tableTab.classList.toggle('active', isTable);\n    }\n    if (this.timelineTab) {\n      this.timelineTab.setAttribute('aria-selected', !isTable ? 'true' : 'false');\n      this.timelineTab.classList.toggle('active', !isTable);\n    }\n\n    // Show/hide views\n    if (this.tableView) {\n      this.tableView.classList.toggle('hidden', !isTable);\n    }\n    if (this.timelineView) {\n      this.timelineView.classList.toggle('hidden', isTable);\n    }\n\n    // Show/hide pagination (only visible in table view)\n    if (this.paginationContainer) {\n      this.paginationContainer.classList.toggle('hidden', !isTable);\n    }\n  }\n\n  /**\n   * Persist view preference to localStorage\n   */\n  private persistView(): void {\n    try {\n      localStorage.setItem(STORAGE_KEY, this.currentView);\n    } catch {\n      // localStorage not available, ignore\n    }\n  }\n\n  /**\n   * Update URL parameter without page reload\n   */\n  private updateUrlParam(): void {\n    const params = new URLSearchParams(window.location.search);\n\n    if (this.currentView === 'table') {\n      // Remove view param when table (default)\n      params.delete(URL_PARAM);\n    } else {\n      params.set(URL_PARAM, this.currentView);\n    }\n\n    const query = params.toString();\n    const newUrl = query ? `${window.location.pathname}?${query}` : window.location.pathname;\n    window.history.replaceState({}, '', newUrl);\n  }\n\n  /**\n   * Emit view change event\n   */\n  private emitViewChange(): void {\n    if (this.onViewChange) {\n      this.onViewChange(this.currentView);\n    }\n\n    // Also dispatch custom event for other components\n    const event = new CustomEvent('activity:viewchange', {\n      bubbles: true,\n      detail: { view: this.currentView },\n    });\n    document.dispatchEvent(event);\n  }\n\n  /**\n   * Get view param for inclusion in API requests\n   */\n  static getViewFromUrl(): ActivityViewMode {\n    const params = new URLSearchParams(window.location.search);\n    const view = params.get(URL_PARAM);\n    return view === 'timeline' ? 'timeline' : 'table';\n  }\n\n  /**\n   * Add view param to existing URLSearchParams (for query sync)\n   */\n  static addViewToParams(params: URLSearchParams, view: ActivityViewMode): void {\n    if (view === 'timeline') {\n      params.set(URL_PARAM, view);\n    } else {\n      params.delete(URL_PARAM);\n    }\n  }\n}\n","/**\n * Activity Timeline Renderer\n * Renders activity entries in a vertical timeline format with date grouping\n */\n\nimport type { ActivityEntry, TimelineDateGroup, TimelineSessionGroup, ActionCategory } from './types.js';\nimport {\n  parseActionString,\n  formatActivitySentence,\n  formatRelativeTimeIntl,\n  getMetadataSummary,\n  formatMetadataExpanded,\n  formatEnrichmentDebugInfo,\n  escapeHtml,\n  getDateGroupLabel,\n  getStartOfDay,\n  getDateKey,\n  getSessionId,\n  getSessionGroupLabel,\n  getActorType,\n  getActorTypeIconHtml,\n} from './formatters.js';\nimport { renderIcon } from '../shared/icon-renderer.js';\n\n/**\n * Color configuration for action categories\n */\nconst CATEGORY_COLORS: Record<ActionCategory, { bg: string; color: string; border: string }> = {\n  created: { bg: '#ecfdf5', color: '#10b981', border: '#a7f3d0' },\n  updated: { bg: '#eff6ff', color: '#3b82f6', border: '#bfdbfe' },\n  deleted: { bg: '#fef2f2', color: '#ef4444', border: '#fecaca' },\n  auth: { bg: '#fffbeb', color: '#f59e0b', border: '#fde68a' },\n  viewed: { bg: '#f5f3ff', color: '#8b5cf6', border: '#ddd6fe' },\n  system: { bg: '#f9fafb', color: '#6b7280', border: '#e5e7eb' },\n};\n\n/**\n * Group activity entries by date\n */\nexport function groupEntriesByDate(entries: ActivityEntry[]): TimelineDateGroup[] {\n  if (!entries || entries.length === 0) {\n    return [];\n  }\n\n  const groupMap = new Map<string, TimelineDateGroup>();\n\n  entries.forEach((entry) => {\n    const date = new Date(entry.created_at);\n    if (Number.isNaN(date.getTime())) return;\n\n    const dateKey = getDateKey(date);\n    const startOfDay = getStartOfDay(date);\n\n    if (!groupMap.has(dateKey)) {\n      groupMap.set(dateKey, {\n        date: startOfDay,\n        label: getDateGroupLabel(date),\n        entries: [],\n        collapsed: false,\n      });\n    }\n\n    groupMap.get(dateKey)!.entries.push(entry);\n  });\n\n  // Sort groups by date (newest first)\n  return Array.from(groupMap.values()).sort(\n    (a, b) => b.date.getTime() - a.date.getTime()\n  );\n}\n\n/**\n * Group entries by session ID within a date group\n */\nexport function groupEntriesBySession(entries: ActivityEntry[]): TimelineSessionGroup[] {\n  if (!entries || entries.length === 0) {\n    return [];\n  }\n\n  const groupMap = new Map<string, TimelineSessionGroup>();\n\n  entries.forEach((entry) => {\n    const sessionId = getSessionId(entry) || '';\n    const groupKey = sessionId || '__no_session__';\n\n    if (!groupMap.has(groupKey)) {\n      groupMap.set(groupKey, {\n        sessionId,\n        label: getSessionGroupLabel(sessionId),\n        entries: [],\n        collapsed: false,\n      });\n    }\n\n    groupMap.get(groupKey)!.entries.push(entry);\n  });\n\n  // Sort groups: sessions with IDs first (newest entry first), then \"No session\" at the end\n  const groups = Array.from(groupMap.values());\n\n  // Sort entries within each group by time (newest first)\n  groups.forEach((group) => {\n    group.entries.sort(\n      (a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n    );\n  });\n\n  // Sort groups: \"No session\" last, others by their first entry time\n  return groups.sort((a, b) => {\n    if (!a.sessionId && b.sessionId) return 1;\n    if (a.sessionId && !b.sessionId) return -1;\n    // Sort by first entry time (newest first)\n    const aTime = a.entries[0] ? new Date(a.entries[0].created_at).getTime() : 0;\n    const bTime = b.entries[0] ? new Date(b.entries[0].created_at).getTime() : 0;\n    return bTime - aTime;\n  });\n}\n\n/**\n * Merge new entries into existing date groups (for infinite scroll)\n */\nexport function mergeEntriesIntoGroups(\n  existingGroups: TimelineDateGroup[],\n  newEntries: ActivityEntry[]\n): TimelineDateGroup[] {\n  if (!newEntries || newEntries.length === 0) {\n    return existingGroups;\n  }\n\n  // Create a map of existing groups\n  const groupMap = new Map<string, TimelineDateGroup>();\n  existingGroups.forEach((group) => {\n    groupMap.set(getDateKey(group.date), { ...group, entries: [...group.entries] });\n  });\n\n  // Add new entries to appropriate groups\n  newEntries.forEach((entry) => {\n    const date = new Date(entry.created_at);\n    if (Number.isNaN(date.getTime())) return;\n\n    const dateKey = getDateKey(date);\n    const startOfDay = getStartOfDay(date);\n\n    if (!groupMap.has(dateKey)) {\n      groupMap.set(dateKey, {\n        date: startOfDay,\n        label: getDateGroupLabel(date),\n        entries: [],\n        collapsed: false,\n      });\n    }\n\n    // Check if entry already exists (by ID)\n    const group = groupMap.get(dateKey)!;\n    if (!group.entries.some((e) => e.id === entry.id)) {\n      group.entries.push(entry);\n    }\n  });\n\n  // Sort groups by date (newest first) and entries within each group (newest first)\n  const result = Array.from(groupMap.values()).sort(\n    (a, b) => b.date.getTime() - a.date.getTime()\n  );\n\n  result.forEach((group) => {\n    group.entries.sort(\n      (a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n    );\n  });\n\n  return result;\n}\n\n/**\n * Get actor initials for avatar display\n */\nfunction getActorInitials(actor: string): string {\n  if (!actor) return '?';\n\n  // If it looks like a UUID, use first 2 chars\n  const clean = actor.replace(/-/g, '');\n  if (/^[0-9a-f]{32}$/i.test(clean)) {\n    return actor.substring(0, 2).toUpperCase();\n  }\n\n  // Get initials from name/username\n  const parts = actor.split(/[\\s._-]+/).filter(Boolean);\n  if (parts.length >= 2) {\n    return (parts[0][0] + parts[1][0]).toUpperCase();\n  }\n  return actor.substring(0, 2).toUpperCase();\n}\n\n/**\n * Render a single timeline entry\n */\nexport function renderTimelineEntry(\n  entry: ActivityEntry,\n  actionLabels?: Record<string, string>,\n  options?: { showDebugInfo?: boolean }\n): HTMLElement {\n  const { showDebugInfo = false } = options || {};\n  const parsedAction = parseActionString(entry.action, actionLabels);\n  const sentence = formatActivitySentence(entry, actionLabels);\n  const relativeTime = formatRelativeTimeIntl(entry.created_at);\n  const metadataSummary = getMetadataSummary(entry.metadata);\n  const metadataContent = formatMetadataExpanded(entry.metadata);\n  const enrichmentDebug = showDebugInfo ? formatEnrichmentDebugInfo(entry) : '';\n  const colors = CATEGORY_COLORS[parsedAction.category] || CATEGORY_COLORS.system;\n  const initials = getActorInitials(entry.actor);\n\n  // Get actor type for icon display\n  const actorType = getActorType(entry);\n  const actorTypeIcon = actorType !== 'user' && actorType !== 'unknown'\n    ? getActorTypeIconHtml(actorType, { badge: true, size: 'sm' })\n    : '';\n\n  const entryEl = document.createElement('div');\n  entryEl.className = `timeline-entry timeline-entry--${parsedAction.category}`;\n  entryEl.dataset.entryId = entry.id;\n\n  // Build metadata section if present\n  let metadataHtml = '';\n  if (metadataSummary === 'hidden') {\n    // Hidden metadata (support role scenario)\n    metadataHtml = `\n      <div class=\"timeline-entry-metadata\">\n        <button type=\"button\"\n                class=\"timeline-metadata-toggle timeline-metadata-toggle--hidden\"\n                aria-expanded=\"false\"\n                data-timeline-metadata=\"${entry.id}\">\n          <i class=\"iconoir-eye-off\" style=\"font-size: 12px;\"></i>\n          <span>Hidden</span>\n          <svg class=\"timeline-metadata-chevron\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n          </svg>\n        </button>\n        <div class=\"timeline-metadata-content\" data-timeline-metadata-content=\"${entry.id}\">\n          <div class=\"timeline-metadata-grid\">\n            ${metadataContent}\n          </div>\n          ${enrichmentDebug}\n        </div>\n      </div>\n    `;\n  } else if (metadataSummary) {\n    metadataHtml = `\n      <div class=\"timeline-entry-metadata\">\n        <button type=\"button\"\n                class=\"timeline-metadata-toggle\"\n                aria-expanded=\"false\"\n                data-timeline-metadata=\"${entry.id}\">\n          <span>${metadataSummary}</span>\n          <svg class=\"timeline-metadata-chevron\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n          </svg>\n        </button>\n        <div class=\"timeline-metadata-content\" data-timeline-metadata-content=\"${entry.id}\">\n          <div class=\"timeline-metadata-grid\">\n            ${metadataContent}\n          </div>\n          ${enrichmentDebug}\n        </div>\n      </div>\n    `;\n  } else if (enrichmentDebug) {\n    // Show debug info even without other metadata\n    metadataHtml = `\n      <div class=\"timeline-entry-metadata\">\n        <button type=\"button\"\n                class=\"timeline-metadata-toggle timeline-metadata-toggle--debug\"\n                aria-expanded=\"false\"\n                data-timeline-metadata=\"${entry.id}\">\n          <i class=\"iconoir-info-circle\" style=\"font-size: 12px;\"></i>\n          <span>Debug</span>\n          <svg class=\"timeline-metadata-chevron\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n          </svg>\n        </button>\n        <div class=\"timeline-metadata-content\" data-timeline-metadata-content=\"${entry.id}\">\n          ${enrichmentDebug}\n        </div>\n      </div>\n    `;\n  }\n\n  // Build actor type indicator if not a regular user\n  const actorTypeIndicator = actorTypeIcon\n    ? `<div class=\"timeline-entry-actor-type\">${actorTypeIcon}</div>`\n    : '';\n\n  entryEl.innerHTML = `\n    <div class=\"timeline-entry-connector\">\n      <div class=\"timeline-entry-dot\" style=\"background-color: ${colors.color}; border-color: ${colors.border};\"></div>\n    </div>\n    <div class=\"timeline-entry-card\">\n      <div class=\"timeline-entry-header\">\n        <div class=\"timeline-entry-avatar\" style=\"background-color: ${colors.bg}; color: ${colors.color};\">\n          ${escapeHtml(initials)}\n          ${actorTypeIndicator}\n        </div>\n        <div class=\"timeline-entry-content\">\n          <div class=\"timeline-entry-action\">\n            <span class=\"timeline-action-badge\" style=\"background-color: ${colors.bg}; color: ${colors.color}; border-color: ${colors.border};\">\n              ${renderIcon(`iconoir:${parsedAction.icon}`)}\n              <span>${escapeHtml(parsedAction.action || entry.action)}</span>\n            </span>\n          </div>\n          <div class=\"timeline-entry-sentence\">${sentence}</div>\n          <div class=\"timeline-entry-time\">${escapeHtml(relativeTime)}</div>\n        </div>\n      </div>\n      ${metadataHtml}\n    </div>\n  `;\n\n  return entryEl;\n}\n\n/**\n * Render a session group header (within a date group)\n */\nexport function renderSessionGroupHeader(\n  sessionGroup: TimelineSessionGroup,\n  dateKey: string,\n  onToggle?: (sessionKey: string, collapsed: boolean) => void\n): HTMLElement {\n  const sessionKey = `${dateKey}__${sessionGroup.sessionId || 'no-session'}`;\n\n  const headerEl = document.createElement('div');\n  headerEl.className = 'timeline-session-header';\n  headerEl.dataset.sessionGroup = sessionKey;\n\n  const entryCount = sessionGroup.entries.length;\n  const countText = entryCount === 1 ? '1 entry' : `${entryCount} entries`;\n\n  headerEl.innerHTML = `\n    <button type=\"button\" class=\"timeline-session-toggle\" aria-expanded=\"${!sessionGroup.collapsed}\">\n      <i class=\"iconoir-link\" style=\"font-size: 12px; color: #9ca3af;\"></i>\n      <span class=\"timeline-session-label\">${escapeHtml(sessionGroup.label)}</span>\n      <span class=\"timeline-session-count\">${countText}</span>\n      <svg class=\"timeline-session-chevron\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n      </svg>\n    </button>\n  `;\n\n  const toggleBtn = headerEl.querySelector('.timeline-session-toggle');\n  if (toggleBtn && onToggle) {\n    toggleBtn.addEventListener('click', () => {\n      const newCollapsed = !sessionGroup.collapsed;\n      sessionGroup.collapsed = newCollapsed;\n      toggleBtn.setAttribute('aria-expanded', (!newCollapsed).toString());\n      onToggle(sessionKey, newCollapsed);\n    });\n  }\n\n  return headerEl;\n}\n\n/**\n * Render a date group header\n */\nexport function renderDateGroupHeader(\n  group: TimelineDateGroup,\n  onToggle?: (dateKey: string, collapsed: boolean) => void\n): HTMLElement {\n  const dateKey = getDateKey(group.date);\n\n  const headerEl = document.createElement('div');\n  headerEl.className = 'timeline-date-header';\n  headerEl.dataset.dateGroup = dateKey;\n\n  headerEl.innerHTML = `\n    <button type=\"button\" class=\"timeline-date-toggle\" aria-expanded=\"${!group.collapsed}\">\n      <span class=\"timeline-date-label\">${escapeHtml(group.label)}</span>\n      <span class=\"timeline-date-count\">${group.entries.length} ${group.entries.length === 1 ? 'entry' : 'entries'}</span>\n      <svg class=\"timeline-date-chevron\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n      </svg>\n    </button>\n  `;\n\n  const toggleBtn = headerEl.querySelector('.timeline-date-toggle');\n  if (toggleBtn && onToggle) {\n    toggleBtn.addEventListener('click', () => {\n      const newCollapsed = !group.collapsed;\n      group.collapsed = newCollapsed;\n      toggleBtn.setAttribute('aria-expanded', (!newCollapsed).toString());\n      onToggle(dateKey, newCollapsed);\n    });\n  }\n\n  return headerEl;\n}\n\n/**\n * Render a date group with its entries (optionally grouped by session)\n */\nexport function renderDateGroup(\n  group: TimelineDateGroup,\n  actionLabels?: Record<string, string>,\n  onToggle?: (dateKey: string, collapsed: boolean) => void,\n  options?: {\n    groupBySession?: boolean;\n    showDebugInfo?: boolean;\n    onSessionToggle?: (sessionKey: string, collapsed: boolean) => void;\n    collapsedSessions?: Set<string>;\n  }\n): HTMLElement {\n  const {\n    groupBySession = true,\n    showDebugInfo = false,\n    onSessionToggle,\n    collapsedSessions = new Set(),\n  } = options || {};\n\n  const dateKey = getDateKey(group.date);\n  const groupEl = document.createElement('div');\n  groupEl.className = 'timeline-group';\n  groupEl.dataset.dateGroup = dateKey;\n\n  // Render header\n  const headerEl = renderDateGroupHeader(group, onToggle);\n  groupEl.appendChild(headerEl);\n\n  // Render entries container\n  const entriesEl = document.createElement('div');\n  entriesEl.className = 'timeline-entries';\n  if (group.collapsed) {\n    entriesEl.classList.add('collapsed');\n  }\n\n  if (groupBySession) {\n    // Group entries by session\n    const sessionGroups = groupEntriesBySession(group.entries);\n\n    // Only show session headers if there are multiple sessions or a non-empty session\n    const showSessionHeaders = sessionGroups.length > 1 ||\n      (sessionGroups.length === 1 && sessionGroups[0].sessionId);\n\n    sessionGroups.forEach((sessionGroup) => {\n      const sessionKey = `${dateKey}__${sessionGroup.sessionId || 'no-session'}`;\n\n      // Restore collapsed state\n      sessionGroup.collapsed = collapsedSessions.has(sessionKey);\n\n      if (showSessionHeaders) {\n        // Render session header\n        const sessionHeaderEl = renderSessionGroupHeader(sessionGroup, dateKey, onSessionToggle);\n        entriesEl.appendChild(sessionHeaderEl);\n\n        // Render session entries container\n        const sessionEntriesEl = document.createElement('div');\n        sessionEntriesEl.className = 'timeline-session-entries';\n        sessionEntriesEl.dataset.sessionEntries = sessionKey;\n        if (sessionGroup.collapsed) {\n          sessionEntriesEl.classList.add('collapsed');\n        }\n\n        sessionGroup.entries.forEach((entry) => {\n          const entryEl = renderTimelineEntry(entry, actionLabels, { showDebugInfo });\n          sessionEntriesEl.appendChild(entryEl);\n        });\n\n        entriesEl.appendChild(sessionEntriesEl);\n      } else {\n        // No session headers - render entries directly\n        sessionGroup.entries.forEach((entry) => {\n          const entryEl = renderTimelineEntry(entry, actionLabels, { showDebugInfo });\n          entriesEl.appendChild(entryEl);\n        });\n      }\n    });\n  } else {\n    // No session grouping - render entries directly\n    group.entries.forEach((entry) => {\n      const entryEl = renderTimelineEntry(entry, actionLabels, { showDebugInfo });\n      entriesEl.appendChild(entryEl);\n    });\n  }\n\n  groupEl.appendChild(entriesEl);\n\n  return groupEl;\n}\n\n/**\n * Timeline renderer options\n */\nexport interface TimelineRendererOptions {\n  /** Whether to group entries by session within date groups */\n  groupBySession?: boolean;\n  /** Whether to show enrichment debug info */\n  showDebugInfo?: boolean;\n}\n\n/**\n * Timeline renderer class\n */\nexport class TimelineRenderer {\n  private container: HTMLElement;\n  private actionLabels?: Record<string, string>;\n  private collapsedGroups: Set<string> = new Set();\n  private collapsedSessions: Set<string> = new Set();\n  private groups: TimelineDateGroup[] = [];\n  private options: TimelineRendererOptions;\n\n  constructor(\n    container: HTMLElement,\n    actionLabels?: Record<string, string>,\n    options?: TimelineRendererOptions\n  ) {\n    this.container = container;\n    this.actionLabels = actionLabels;\n    this.options = {\n      groupBySession: true,\n      showDebugInfo: false,\n      ...options,\n    };\n  }\n\n  /**\n   * Update renderer options\n   */\n  setOptions(options: Partial<TimelineRendererOptions>): void {\n    this.options = { ...this.options, ...options };\n  }\n\n  /**\n   * Render the full timeline\n   */\n  render(entries: ActivityEntry[]): void {\n    this.groups = groupEntriesByDate(entries);\n    this.container.innerHTML = '';\n\n    if (this.groups.length === 0) {\n      this.renderEmptyState();\n      return;\n    }\n\n    // Create timeline container\n    const timelineEl = document.createElement('div');\n    timelineEl.className = 'timeline';\n\n    this.groups.forEach((group) => {\n      // Restore collapsed state\n      const dateKey = getDateKey(group.date);\n      group.collapsed = this.collapsedGroups.has(dateKey);\n\n      const groupEl = renderDateGroup(\n        group,\n        this.actionLabels,\n        (key, collapsed) => {\n          this.handleGroupToggle(key, collapsed);\n        },\n        {\n          groupBySession: this.options.groupBySession,\n          showDebugInfo: this.options.showDebugInfo,\n          onSessionToggle: (sessionKey, collapsed) => {\n            this.handleSessionToggle(sessionKey, collapsed);\n          },\n          collapsedSessions: this.collapsedSessions,\n        }\n      );\n      timelineEl.appendChild(groupEl);\n    });\n\n    this.container.appendChild(timelineEl);\n    this.wireMetadataToggles();\n  }\n\n  /**\n   * Append more entries (for infinite scroll)\n   */\n  appendEntries(newEntries: ActivityEntry[]): void {\n    this.groups = mergeEntriesIntoGroups(this.groups, newEntries);\n\n    // Re-render (could be optimized to only update affected groups)\n    const entries = this.groups.flatMap((g) => g.entries);\n    this.render(entries);\n  }\n\n  /**\n   * Clear the timeline\n   */\n  clear(): void {\n    this.container.innerHTML = '';\n    this.groups = [];\n  }\n\n  /**\n   * Get current groups\n   */\n  getGroups(): TimelineDateGroup[] {\n    return this.groups;\n  }\n\n  private renderEmptyState(): void {\n    const emptyEl = document.createElement('div');\n    emptyEl.className = 'timeline-empty';\n    emptyEl.innerHTML = `\n      <div class=\"timeline-empty-icon\">\n        <i class=\"iconoir-clipboard-check\"></i>\n      </div>\n      <p class=\"timeline-empty-title\">No activity found</p>\n      <p class=\"timeline-empty-subtitle\">Activity entries will appear here when actions are logged.</p>\n    `;\n    this.container.appendChild(emptyEl);\n  }\n\n  private handleGroupToggle(dateKey: string, collapsed: boolean): void {\n    if (collapsed) {\n      this.collapsedGroups.add(dateKey);\n    } else {\n      this.collapsedGroups.delete(dateKey);\n    }\n\n    // Toggle entries visibility\n    const groupEl = this.container.querySelector(`[data-date-group=\"${dateKey}\"]`);\n    const entriesEl = groupEl?.querySelector('.timeline-entries');\n    if (entriesEl) {\n      entriesEl.classList.toggle('collapsed', collapsed);\n    }\n  }\n\n  private handleSessionToggle(sessionKey: string, collapsed: boolean): void {\n    if (collapsed) {\n      this.collapsedSessions.add(sessionKey);\n    } else {\n      this.collapsedSessions.delete(sessionKey);\n    }\n\n    // Toggle session entries visibility\n    const sessionEntriesEl = this.container.querySelector<HTMLElement>(\n      `[data-session-entries=\"${sessionKey}\"]`\n    );\n    if (sessionEntriesEl) {\n      sessionEntriesEl.classList.toggle('collapsed', collapsed);\n    }\n  }\n\n  private wireMetadataToggles(): void {\n    const toggles = this.container.querySelectorAll<HTMLButtonElement>('[data-timeline-metadata]');\n\n    toggles.forEach((toggle) => {\n      toggle.addEventListener('click', () => {\n        const entryId = toggle.dataset.timelineMetadata;\n        const contentEl = this.container.querySelector<HTMLElement>(\n          `[data-timeline-metadata-content=\"${entryId}\"]`\n        );\n\n        if (!contentEl) return;\n\n        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';\n        const newExpanded = !isExpanded;\n\n        toggle.setAttribute('aria-expanded', newExpanded.toString());\n        contentEl.classList.toggle('expanded', newExpanded);\n\n        // Rotate chevron\n        const chevron = toggle.querySelector<SVGElement>('.timeline-metadata-chevron');\n        if (chevron) {\n          chevron.style.transform = newExpanded ? 'rotate(180deg)' : 'rotate(0deg)';\n        }\n      });\n    });\n  }\n}\n\n/**\n * Create loading indicator for infinite scroll\n */\nexport function createLoadingIndicator(): HTMLElement {\n  const el = document.createElement('div');\n  el.className = 'timeline-loading';\n  el.innerHTML = `\n    <div class=\"timeline-loading-spinner\"></div>\n    <span>Loading more entries...</span>\n  `;\n  return el;\n}\n\n/**\n * Create end-of-timeline indicator\n */\nexport function createEndIndicator(): HTMLElement {\n  const el = document.createElement('div');\n  el.className = 'timeline-end';\n  el.innerHTML = `\n    <span>No more entries</span>\n  `;\n  return el;\n}\n\n/**\n * Create infinite scroll sentinel element\n */\nexport function createScrollSentinel(): HTMLElement {\n  const el = document.createElement('div');\n  el.className = 'timeline-sentinel';\n  el.setAttribute('aria-hidden', 'true');\n  return el;\n}\n","/**\n * Activity Manager\n * Manages activity feed display with enhanced formatting and view switching\n */\n\nimport type {\n  ActivityEntry,\n  ActivityPayload,\n  ActivityConfig,\n  ActivitySelectors,\n  ActivityState,\n  ActivityViewMode,\n  ToastNotifier,\n} from './types.js';\n\nimport {\n  parseActionString,\n  formatActivitySentence,\n  formatTimestamp,\n  formatRelativeTime,\n  getMetadataSummary,\n  formatMetadataExpanded,\n  formatEnrichmentDebugInfo,\n  escapeHtml,\n  formatChannel,\n  shortenId,\n  getSessionId,\n} from './formatters.js';\nimport { renderIcon } from '../shared/icon-renderer.js';\n\nimport { ActivityViewSwitcher } from './activity-view-switcher.js';\nimport { TimelineRenderer, createLoadingIndicator, createEndIndicator, createScrollSentinel } from './activity-timeline.js';\n\nconst DEFAULT_SELECTORS: ActivitySelectors = {\n  form: '#activity-filters',\n  tableBody: '#activity-table-body',\n  emptyState: '#activity-empty',\n  disabledState: '#activity-disabled',\n  errorState: '#activity-error',\n  countEl: '#activity-count',\n  prevBtn: '#activity-prev',\n  nextBtn: '#activity-next',\n  refreshBtn: '#activity-refresh',\n  clearBtn: '#activity-clear',\n  limitInput: '#filter-limit',\n};\n\nconst TIMELINE_SELECTORS = {\n  container: '#activity-timeline',\n  sentinel: '#activity-timeline-sentinel',\n};\n\nconst FIELD_IDS = ['q', 'verb', 'channels', 'object_type', 'object_id'];\nconst DATE_FIELDS = ['since', 'until'];\nconst PASSTHROUGH_FIELDS = ['user_id', 'actor_id'];\n\ntype ActivityAPIError = {\n  textCode: string;\n  message: string;\n};\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return value !== null && typeof value === 'object' && !Array.isArray(value);\n}\n\nfunction parseActivityAPIError(payload: unknown): ActivityAPIError {\n  if (!isRecord(payload)) {\n    return { textCode: '', message: '' };\n  }\n\n  const envelope = isRecord(payload.error) ? payload.error : payload;\n  const textCode = typeof envelope.text_code === 'string' ? envelope.text_code.trim() : '';\n  const message = typeof envelope.message === 'string' ? envelope.message.trim() : '';\n\n  return { textCode, message };\n}\n\nexport class ActivityManager {\n  private config: ActivityConfig;\n  private selectors: ActivitySelectors;\n  private toast: ToastNotifier | null;\n\n  private form: HTMLFormElement | null = null;\n  private tableBody: HTMLTableSectionElement | null = null;\n  private emptyState: HTMLElement | null = null;\n  private disabledState: HTMLElement | null = null;\n  private errorState: HTMLElement | null = null;\n  private countEl: HTMLElement | null = null;\n  private prevBtn: HTMLButtonElement | null = null;\n  private nextBtn: HTMLButtonElement | null = null;\n  private refreshBtn: HTMLButtonElement | null = null;\n  private clearBtn: HTMLButtonElement | null = null;\n  private limitInput: HTMLSelectElement | null = null;\n\n  // Timeline-related properties\n  private viewSwitcher: ActivityViewSwitcher | null = null;\n  private timelineRenderer: TimelineRenderer | null = null;\n  private timelineContainer: HTMLElement | null = null;\n  private timelineSentinel: HTMLElement | null = null;\n  private infiniteScrollObserver: IntersectionObserver | null = null;\n  private isLoadingMore: boolean = false;\n  private allEntriesLoaded: boolean = false;\n\n  // Cache entries for view switching\n  private cachedEntries: ActivityEntry[] = [];\n\n  private state: ActivityState = {\n    limit: 50,\n    offset: 0,\n    total: 0,\n    nextOffset: 0,\n    hasMore: false,\n    extraParams: {},\n  };\n\n  constructor(\n    config: ActivityConfig,\n    selectors: Partial<ActivitySelectors> = {},\n    toast?: ToastNotifier\n  ) {\n    this.config = config;\n    this.selectors = { ...DEFAULT_SELECTORS, ...selectors };\n    this.toast = toast || (window as any).toastManager || null;\n  }\n\n  /**\n   * Initialize the activity manager\n   */\n  init(): void {\n    this.cacheElements();\n    this.initViewSwitcher();\n    this.initTimeline();\n    this.bindEvents();\n    this.syncFromQuery();\n    this.loadActivity();\n  }\n\n  /**\n   * Initialize the view switcher\n   */\n  private initViewSwitcher(): void {\n    this.viewSwitcher = new ActivityViewSwitcher(\n      {\n        container: '#activity-view-switcher',\n        tableTab: '[data-view-tab=\"table\"]',\n        timelineTab: '[data-view-tab=\"timeline\"]',\n        tableView: '#activity-table-container',\n        timelineView: '#activity-timeline-container',\n        paginationContainer: '#activity-pagination',\n      },\n      (view) => this.handleViewChange(view)\n    );\n    this.viewSwitcher.init();\n  }\n\n  /**\n   * Initialize the timeline renderer\n   */\n  private initTimeline(): void {\n    this.timelineContainer = document.querySelector<HTMLElement>(TIMELINE_SELECTORS.container);\n    this.timelineSentinel = document.querySelector<HTMLElement>(TIMELINE_SELECTORS.sentinel);\n\n    if (this.timelineContainer) {\n      this.timelineRenderer = new TimelineRenderer(\n        this.timelineContainer,\n        this.config.actionLabels\n      );\n    }\n\n    // Set up infinite scroll observer\n    this.setupInfiniteScroll();\n  }\n\n  /**\n   * Handle view change from switcher\n   */\n  private handleViewChange(view: ActivityViewMode): void {\n    if (view === 'timeline') {\n      // Reset infinite scroll state when switching to timeline\n      this.allEntriesLoaded = false;\n      this.isLoadingMore = false;\n\n      // Reset offset to load fresh data from the beginning\n      this.state.offset = 0;\n\n      // Fetch fresh data when switching to timeline\n      this.loadActivity();\n\n      // Enable infinite scroll observer\n      this.enableInfiniteScroll();\n    } else {\n      // Disable infinite scroll when switching to table view\n      this.disableInfiniteScroll();\n\n      // Reset offset and fetch fresh data when switching to table view\n      this.state.offset = 0;\n      this.loadActivity();\n    }\n  }\n\n  /**\n   * Set up infinite scroll for timeline view\n   */\n  private setupInfiniteScroll(): void {\n    if (!this.timelineSentinel) return;\n\n    this.infiniteScrollObserver = new IntersectionObserver(\n      (entries) => {\n        const sentinel = entries[0];\n        if (sentinel.isIntersecting && !this.isLoadingMore && !this.allEntriesLoaded) {\n          this.loadMoreEntries();\n        }\n      },\n      {\n        root: null,\n        rootMargin: '200px',\n        threshold: 0,\n      }\n    );\n  }\n\n  /**\n   * Enable infinite scroll observation\n   */\n  private enableInfiniteScroll(): void {\n    if (this.infiniteScrollObserver && this.timelineSentinel) {\n      this.infiniteScrollObserver.observe(this.timelineSentinel);\n    }\n  }\n\n  /**\n   * Disable infinite scroll observation\n   */\n  private disableInfiniteScroll(): void {\n    if (this.infiniteScrollObserver && this.timelineSentinel) {\n      this.infiniteScrollObserver.unobserve(this.timelineSentinel);\n    }\n  }\n\n  /**\n   * Load more entries for infinite scroll\n   */\n  private async loadMoreEntries(): Promise<void> {\n    if (this.isLoadingMore || this.allEntriesLoaded || !this.state.hasMore) {\n      return;\n    }\n\n    this.isLoadingMore = true;\n\n    // Show loading indicator\n    const loadingIndicator = createLoadingIndicator();\n    this.timelineSentinel?.parentElement?.insertBefore(loadingIndicator, this.timelineSentinel);\n\n    try {\n      // Update offset for next page\n      this.state.offset = this.state.nextOffset;\n      const params = this.buildParams();\n\n      const url = `${this.config.apiPath}?${params.toString()}`;\n      const response = await fetch(url, { headers: { Accept: 'application/json' } });\n\n      if (!response.ok) {\n        throw new Error(`Failed to load more entries (${response.status})`);\n      }\n\n      const payload: ActivityPayload = await response.json();\n      const entries = Array.isArray(payload.entries) ? payload.entries : [];\n\n      // Update state\n      this.state.hasMore = Boolean(payload.has_more);\n      this.state.nextOffset =\n        typeof payload.next_offset === 'number'\n          ? payload.next_offset\n          : this.state.offset + entries.length;\n\n      if (entries.length === 0) {\n        this.allEntriesLoaded = true;\n      } else {\n        // Add to cached entries\n        this.cachedEntries = [...this.cachedEntries, ...entries];\n\n        // Append to timeline\n        if (this.timelineRenderer) {\n          this.timelineRenderer.appendEntries(entries);\n        }\n      }\n\n      // Check if all entries loaded\n      if (!this.state.hasMore) {\n        this.allEntriesLoaded = true;\n        const endIndicator = createEndIndicator();\n        this.timelineSentinel?.parentElement?.insertBefore(endIndicator, this.timelineSentinel);\n      }\n    } catch (err) {\n      console.error('Failed to load more entries:', err);\n    } finally {\n      // Remove loading indicator\n      loadingIndicator.remove();\n      this.isLoadingMore = false;\n    }\n  }\n\n  private cacheElements(): void {\n    this.form = document.querySelector<HTMLFormElement>(this.selectors.form);\n    this.tableBody = document.querySelector<HTMLTableSectionElement>(this.selectors.tableBody);\n    this.emptyState = document.querySelector<HTMLElement>(this.selectors.emptyState);\n    this.disabledState = document.querySelector<HTMLElement>(this.selectors.disabledState);\n    this.errorState = document.querySelector<HTMLElement>(this.selectors.errorState);\n    this.countEl = document.querySelector<HTMLElement>(this.selectors.countEl);\n    this.prevBtn = document.querySelector<HTMLButtonElement>(this.selectors.prevBtn);\n    this.nextBtn = document.querySelector<HTMLButtonElement>(this.selectors.nextBtn);\n    this.refreshBtn = document.querySelector<HTMLButtonElement>(this.selectors.refreshBtn);\n    this.clearBtn = document.querySelector<HTMLButtonElement>(this.selectors.clearBtn);\n    this.limitInput = document.querySelector<HTMLSelectElement>(this.selectors.limitInput);\n  }\n\n  private bindEvents(): void {\n    this.form?.addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.state.limit = parseInt(this.limitInput?.value || '50', 10) || 50;\n      this.state.offset = 0;\n      this.loadActivity();\n    });\n\n    this.clearBtn?.addEventListener('click', () => {\n      FIELD_IDS.forEach((name) => this.setInputValue(name, ''));\n      DATE_FIELDS.forEach((name) => this.setInputValue(name, ''));\n      this.state.offset = 0;\n      this.loadActivity();\n    });\n\n    this.prevBtn?.addEventListener('click', () => {\n      this.state.offset = Math.max(0, this.state.offset - this.state.limit);\n      this.loadActivity();\n    });\n\n    this.nextBtn?.addEventListener('click', () => {\n      if (!this.state.hasMore) return;\n      this.state.offset = this.state.nextOffset;\n      this.loadActivity();\n    });\n\n    this.refreshBtn?.addEventListener('click', () => {\n      this.loadActivity();\n    });\n  }\n\n  private getInputValue(name: string): string {\n    const input = document.getElementById(`filter-${name.replace(/_/g, '-')}`);\n    if (!input) return '';\n    return String((input as HTMLInputElement).value || '').trim();\n  }\n\n  private setInputValue(name: string, value: string): void {\n    const input = document.getElementById(`filter-${name.replace(/_/g, '-')}`);\n    if (!input) return;\n    (input as HTMLInputElement).value = value || '';\n  }\n\n  private toLocalInput(value: string): string {\n    if (!value) return '';\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) return value;\n    const offset = parsed.getTimezoneOffset() * 60000;\n    return new Date(parsed.getTime() - offset).toISOString().slice(0, 16);\n  }\n\n  private toRFC3339(value: string): string {\n    if (!value) return '';\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) return '';\n    return parsed.toISOString();\n  }\n\n  private syncFromQuery(): void {\n    const params = new URLSearchParams(window.location.search);\n    const limit = parseInt(params.get('limit') || '', 10);\n    const offset = parseInt(params.get('offset') || '', 10);\n\n    if (!Number.isNaN(limit) && limit > 0) {\n      this.state.limit = limit;\n    }\n    if (!Number.isNaN(offset) && offset >= 0) {\n      this.state.offset = offset;\n    }\n\n    if (this.limitInput) {\n      this.limitInput.value = String(this.state.limit);\n    }\n\n    FIELD_IDS.forEach((name) => this.setInputValue(name, params.get(name) || ''));\n    DATE_FIELDS.forEach((name) => this.setInputValue(name, this.toLocalInput(params.get(name) || '')));\n    PASSTHROUGH_FIELDS.forEach((name) => {\n      const val = params.get(name);\n      if (val) {\n        this.state.extraParams[name] = val;\n      }\n    });\n\n    // View param is handled by ActivityViewSwitcher\n  }\n\n  private buildParams(): URLSearchParams {\n    const params = new URLSearchParams();\n    params.set('limit', String(this.state.limit));\n    params.set('offset', String(this.state.offset));\n\n    FIELD_IDS.forEach((name) => {\n      const value = this.getInputValue(name);\n      if (value) params.set(name, value);\n    });\n\n    DATE_FIELDS.forEach((name) => {\n      const value = this.toRFC3339(this.getInputValue(name));\n      if (value) params.set(name, value);\n    });\n\n    Object.entries(this.state.extraParams).forEach(([key, value]) => {\n      if (value) params.set(key, value);\n    });\n\n    return params;\n  }\n\n  private syncUrl(params: URLSearchParams): void {\n    // Preserve view param\n    if (this.viewSwitcher) {\n      ActivityViewSwitcher.addViewToParams(params, this.viewSwitcher.getView());\n    }\n\n    const query = params.toString();\n    const next = query ? `${window.location.pathname}?${query}` : window.location.pathname;\n    window.history.replaceState({}, '', next);\n  }\n\n  private resetStates(): void {\n    this.disabledState?.classList.add('hidden');\n    this.errorState?.classList.add('hidden');\n  }\n\n  private showError(message: string): void {\n    if (this.errorState) {\n      this.errorState.textContent = message;\n      this.errorState.classList.remove('hidden');\n    }\n  }\n\n  private showDisabled(message: string): void {\n    if (this.disabledState) {\n      this.disabledState.textContent = message;\n      this.disabledState.classList.remove('hidden');\n    }\n  }\n\n  async loadActivity(): Promise<void> {\n    this.resetStates();\n    const params = this.buildParams();\n    this.syncUrl(params);\n\n    const url = `${this.config.apiPath}?${params.toString()}`;\n\n    try {\n      const response = await fetch(url, { headers: { Accept: 'application/json' } });\n\n      if (!response.ok) {\n        let payload: unknown = null;\n        try {\n          payload = await response.json();\n        } catch {\n          payload = null;\n        }\n        const apiError = parseActivityAPIError(payload);\n\n        if (response.status === 404 && apiError.textCode === 'FEATURE_DISABLED') {\n          this.showDisabled(apiError.message || 'Activity feature disabled.');\n          this.renderRows([]);\n          this.updatePagination(0);\n          return;\n        }\n\n        this.showError(apiError.message || `Failed to load activity (${response.status})`);\n        return;\n      }\n\n      const payload: ActivityPayload = await response.json();\n      const entries = Array.isArray(payload.entries) ? payload.entries : [];\n\n      this.state.total = typeof payload.total === 'number' ? payload.total : entries.length;\n      this.state.hasMore = Boolean(payload.has_more);\n      this.state.nextOffset =\n        typeof payload.next_offset === 'number'\n          ? payload.next_offset\n          : this.state.offset + entries.length;\n\n      // Cache entries for view switching\n      this.cachedEntries = entries;\n\n      // Reset infinite scroll state\n      this.allEntriesLoaded = !this.state.hasMore;\n      this.isLoadingMore = false;\n\n      // Render based on current view\n      const currentView = this.viewSwitcher?.getView() || 'table';\n      if (currentView === 'timeline') {\n        this.renderTimeline(entries);\n      } else {\n        this.renderRows(entries);\n      }\n      this.updatePagination(entries.length);\n    } catch (err) {\n      this.showError('Failed to load activity.');\n    }\n  }\n\n  /**\n   * Render entries in timeline view\n   */\n  private renderTimeline(entries: ActivityEntry[]): void {\n    if (!this.timelineRenderer) return;\n\n    // Clear any existing end indicators\n    const existingEnd = this.timelineContainer?.parentElement?.querySelector('.timeline-end');\n    existingEnd?.remove();\n\n    this.timelineRenderer.render(entries);\n\n    // Enable infinite scroll\n    this.enableInfiniteScroll();\n  }\n\n  private renderRows(entries: ActivityEntry[]): void {\n    if (!this.tableBody) return;\n\n    this.tableBody.innerHTML = '';\n\n    if (!entries || entries.length === 0) {\n      this.emptyState?.classList.remove('hidden');\n      return;\n    }\n\n    this.emptyState?.classList.add('hidden');\n\n    let lastSessionId = '';\n    entries.forEach((entry) => {\n      const sessionId = getSessionId(entry);\n      if (sessionId && sessionId !== lastSessionId) {\n        this.tableBody!.appendChild(this.createSessionRow(sessionId));\n        lastSessionId = sessionId;\n      } else if (!sessionId) {\n        lastSessionId = '';\n      }\n      const { mainRow, detailsRow } = this.createRowPair(entry);\n      this.tableBody!.appendChild(mainRow);\n      if (detailsRow) {\n        this.tableBody!.appendChild(detailsRow);\n      }\n    });\n\n    // Wire up metadata toggles\n    this.wireMetadataToggles();\n  }\n\n  private createRowPair(entry: ActivityEntry): { mainRow: HTMLTableRowElement; detailsRow: HTMLTableRowElement | null } {\n    const actionLabels = this.config.actionLabels || {};\n    const parsedAction = parseActionString(entry.action, actionLabels);\n    // Use showActorTypeBadge option to embed actor type badge in sentence\n    const sentence = formatActivitySentence(entry, actionLabels, { showActorTypeBadge: true });\n    const timestamp = formatTimestamp(entry.created_at);\n    const relativeTime = formatRelativeTime(entry.created_at);\n    const metadataSummary = getMetadataSummary(entry.metadata);\n    const metadataContent = formatMetadataExpanded(entry.metadata);\n    const enrichmentDebug = formatEnrichmentDebugInfo(entry);\n    const shortChannel = formatChannel(entry.channel);\n\n    // Determine if we should show a details row:\n    // - metadataSummary is non-empty (includes 'hidden' for hidden metadata)\n    // - OR enrichmentDebug is non-empty\n    const hasMetadata = Boolean(metadataSummary);\n    const hasDebugInfo = Boolean(enrichmentDebug);\n    const showDetailsRow = hasMetadata || hasDebugInfo;\n\n    // Color scheme for action categories\n    const categoryColors: Record<string, { bg: string; color: string; border: string }> = {\n      created: { bg: '#ecfdf5', color: '#10b981', border: '#a7f3d0' },\n      updated: { bg: '#eff6ff', color: '#3b82f6', border: '#bfdbfe' },\n      deleted: { bg: '#fef2f2', color: '#ef4444', border: '#fecaca' },\n      auth: { bg: '#fffbeb', color: '#f59e0b', border: '#fde68a' },\n      viewed: { bg: '#f5f3ff', color: '#8b5cf6', border: '#ddd6fe' },\n      system: { bg: '#f9fafb', color: '#6b7280', border: '#e5e7eb' },\n    };\n    const colors = categoryColors[parsedAction.category] || categoryColors.system;\n\n    const mainRow = document.createElement('tr');\n    mainRow.className = `activity-row activity-row--${parsedAction.category}`;\n\n    // Build action cell with namespace icon and action badge\n    let actionCellHtml = '';\n    if (parsedAction.namespace) {\n      // Dotted action like \"debug.repl.close\" - show namespace icon + action badge\n      actionCellHtml = `\n        <div style=\"display: flex; align-items: center; gap: 8px;\">\n          <span style=\"display: flex; align-items: center; justify-content: center; width: 28px; height: 28px; background: #f3f4f6; border-radius: 6px; color: #6b7280;\" title=\"${escapeHtml(parsedAction.namespace)}\">\n            ${renderIcon(`iconoir:${parsedAction.icon}`, { size: '14px' })}\n          </span>\n          <span style=\"display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; background-color: ${colors.bg}; color: ${colors.color}; border: 1px solid ${colors.border};\">\n            ${escapeHtml(parsedAction.action)}\n          </span>\n        </div>\n      `;\n    } else {\n      // Simple action - show as colored badge with icon\n      actionCellHtml = `\n        <span style=\"display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; background-color: ${colors.bg}; color: ${colors.color}; border: 1px solid ${colors.border};\">\n          ${renderIcon(`iconoir:${parsedAction.icon}`, { size: '14px' })}\n          <span>${escapeHtml(parsedAction.action || '-')}</span>\n        </span>\n      `;\n    }\n\n    // Build channel cell with shortened ID and copy tooltip\n    let channelHtml = '';\n    if (entry.channel) {\n      channelHtml = `\n        <span style=\"display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; font-size: 11px; font-weight: 500; font-family: ui-monospace, monospace; color: #6b7280; background: #f3f4f6; border-radius: 4px; cursor: default;\" title=\"${escapeHtml(entry.channel)}\">\n          ${escapeHtml(shortChannel)}\n        </span>\n      `;\n    } else {\n      channelHtml = '<span style=\"color: #9ca3af; font-size: 12px;\">-</span>';\n    }\n\n    // Build metadata toggle button\n    let metadataCellHtml = '';\n    if (showDetailsRow) {\n      // Determine button label and style\n      let buttonLabel = metadataSummary || '';\n      let buttonClass = 'activity-metadata-toggle';\n      let buttonStyle = 'display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; font-size: 12px; color: #6b7280; background: #f3f4f6; border: none; border-radius: 6px; cursor: pointer;';\n      let buttonIcon = '';\n\n      // Handle hidden metadata case (support role scenario)\n      if (metadataSummary === 'hidden') {\n        buttonLabel = 'Hidden';\n        buttonClass += ' activity-metadata-toggle--hidden';\n        buttonStyle = 'display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; font-size: 12px; color: #9ca3af; background: transparent; border: 1px dashed #d1d5db; border-radius: 6px; cursor: pointer;';\n        buttonIcon = '<i class=\"iconoir-eye-off\" style=\"font-size: 12px;\"></i>';\n      } else if (!hasMetadata && hasDebugInfo) {\n        // Only debug info, no metadata\n        buttonLabel = 'Debug';\n        buttonClass += ' activity-metadata-toggle--debug';\n        buttonStyle = 'display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; font-size: 12px; color: #9ca3af; background: transparent; border: 1px dashed #d1d5db; border-radius: 6px; cursor: pointer;';\n        buttonIcon = '<i class=\"iconoir-info-circle\" style=\"font-size: 12px;\"></i>';\n      }\n\n      metadataCellHtml = `\n        <button type=\"button\"\n                class=\"${buttonClass}\"\n                style=\"${buttonStyle}\"\n                aria-expanded=\"false\"\n                data-metadata-toggle=\"${entry.id}\">\n          ${buttonIcon}\n          <span>${buttonLabel}</span>\n          <svg class=\"activity-metadata-chevron\" style=\"width: 12px; height: 12px; transition: transform 0.15s ease;\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n          </svg>\n        </button>\n      `;\n    } else {\n      metadataCellHtml = '<span style=\"color: #9ca3af; font-size: 12px;\">-</span>';\n    }\n\n    mainRow.innerHTML = `\n      <td style=\"padding: 12px 16px; vertical-align: middle; border-left: 3px solid ${colors.color};\">\n        <div style=\"font-size: 13px; color: #374151; white-space: nowrap;\">${timestamp}</div>\n        <div style=\"font-size: 11px; color: #9ca3af; margin-top: 2px;\">${relativeTime}</div>\n      </td>\n      <td style=\"padding: 12px 16px; vertical-align: middle;\">${actionCellHtml}</td>\n      <td style=\"padding: 12px 16px; vertical-align: middle;\">\n        <div style=\"font-size: 13px; line-height: 1.5; color: #374151;\">${sentence}</div>\n      </td>\n      <td style=\"padding: 12px 16px; vertical-align: middle; text-align: center;\">${channelHtml}</td>\n      <td style=\"padding: 12px 16px; vertical-align: middle;\">${metadataCellHtml}</td>\n    `;\n\n    // Create details row (hidden by default) if there's metadata or debug info\n    let detailsRow: HTMLTableRowElement | null = null;\n    if (showDetailsRow) {\n      detailsRow = document.createElement('tr');\n      detailsRow.className = 'activity-details-row';\n      detailsRow.style.display = 'none';\n      detailsRow.dataset.metadataContent = entry.id;\n\n      // Build content: metadata grid (if any) + debug info (if any)\n      let detailsContent = '';\n      if (hasMetadata) {\n        detailsContent += `\n          <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px 24px;\">\n            ${metadataContent}\n          </div>\n        `;\n      }\n      if (hasDebugInfo) {\n        detailsContent += enrichmentDebug;\n      }\n\n      detailsRow.innerHTML = `\n        <td colspan=\"5\" style=\"padding: 0; background: #f9fafb; border-left: 3px solid ${colors.color};\">\n          <div style=\"padding: 16px 24px; border-top: 1px solid #e5e7eb;\">\n            ${detailsContent}\n          </div>\n        </td>\n      `;\n    }\n\n    return { mainRow, detailsRow };\n  }\n\n  private createSessionRow(sessionId: string): HTMLTableRowElement {\n    const row = document.createElement('tr');\n    row.className = 'activity-session-row';\n\n    const shortSessionId = shortenId(sessionId, 10);\n    row.innerHTML = `\n      <td colspan=\"5\" style=\"padding: 8px 16px; background: #f8fafc; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb;\">\n        <div style=\"display: flex; align-items: center; gap: 8px; font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.06em;\">\n          <span>Session</span>\n          <span style=\"font-family: ui-monospace, monospace; font-weight: 600; color: #374151;\" title=\"${escapeHtml(sessionId)}\">${escapeHtml(shortSessionId)}</span>\n        </div>\n      </td>\n    `;\n\n    return row;\n  }\n\n  private wireMetadataToggles(): void {\n    const toggles = document.querySelectorAll<HTMLButtonElement>('[data-metadata-toggle]');\n\n    toggles.forEach((toggle) => {\n      toggle.addEventListener('click', () => {\n        const entryId = toggle.dataset.metadataToggle;\n        // Find the details row (separate tr element)\n        const detailsRow = document.querySelector<HTMLTableRowElement>(`tr[data-metadata-content=\"${entryId}\"]`);\n\n        if (!detailsRow) return;\n\n        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';\n        const newExpanded = !isExpanded;\n\n        // Toggle the details row visibility\n        detailsRow.style.display = newExpanded ? 'table-row' : 'none';\n        toggle.setAttribute('aria-expanded', newExpanded ? 'true' : 'false');\n\n        // Update toggle button appearance\n        toggle.style.background = newExpanded ? '#e5e7eb' : '#f3f4f6';\n\n        // Rotate chevron\n        const chevron = toggle.querySelector<SVGElement>('.activity-metadata-chevron');\n        if (chevron) {\n          chevron.style.transform = newExpanded ? 'rotate(180deg)' : 'rotate(0deg)';\n        }\n      });\n    });\n  }\n\n  private updatePagination(count: number): void {\n    const total = Number.isFinite(this.state.total) ? this.state.total : 0;\n    const start = count > 0 ? this.state.offset + 1 : 0;\n    const end = this.state.offset + count;\n\n    if (this.countEl) {\n      if (total > 0) {\n        this.countEl.textContent = `Showing ${start}-${end} of ${total}`;\n      } else if (count > 0) {\n        this.countEl.textContent = `Showing ${start}-${end}`;\n      } else {\n        this.countEl.textContent = 'No activity entries';\n      }\n    }\n\n    if (this.prevBtn) {\n      this.prevBtn.disabled = this.state.offset <= 0;\n    }\n\n    if (this.nextBtn) {\n      this.nextBtn.disabled = !this.state.hasMore;\n    }\n  }\n}\n"],"names":["ACTION_CATEGORY_MAP","METADATA_KEY_ACTOR_DISPLAY","METADATA_KEY_OBJECT_DISPLAY","METADATA_KEY_OBJECT_DELETED","METADATA_KEY_ACTOR_TYPE","METADATA_KEY_ACTOR_EMAIL","METADATA_KEY_SESSION_ID","METADATA_KEY_ENRICHED_AT","METADATA_KEY_ENRICHER_VERSION","ACTOR_TYPE_ICONS","ACTOR_TYPE_LABELS","isMaskedValue","value","trimmed","clean","isMetadataHidden","metadata","keys","key","ACTION_ICONS","NAMESPACE_ICONS","resolveActionLabel","actionStr","labels","label","parseActionString","actionLabel","parts","namespace","action","icon","verb","category","getActionCategory","normalized","parseObject","object","colonIndex","getMetadataString","firstNonEmpty","values","resolveActorLabel","entry","resolveObjectDisplay","isObjectDeleted","getActorType","getActorEmail","getSessionId","getEnrichmentInfo","enrichedAt","enricherVersion","capitalize","str","formatObjectType","type","escapeHtml","text","div","shortenId","id","length","isUuidLike","formatIdWithTooltip","shortened","formatActivitySentence","options","showActorTypeBadge","actor","rawVerb","actorTypeBadge","actorType","getActorTypeIconHtml","actorDisplay","deletedMarker","objectRef","objectDisplay","shortId","ip","formatTimestamp","date","formatRelativeTime","diffMs","diffSecs","diffMins","diffHours","diffDays","formatRelativeTimeIntl","rtf","weeks","getDateGroupLabel","now","today","yesterday","targetDate","getStartOfDay","getDateKey","year","month","day","countMetadataFields","getMetadataSummary","count","formatMetadataExpanded","entries","formattedKey","formattedValue","isMasked","formatValue","jsonStr","truncated","formatEnrichmentDebugInfo","info","items","formatted","formatChannel","channel","getActionClass","getActionIconHtml","renderIcon","badge","size","sizeMap","iconHtml","formatActorWithType","formatSessionId","sessionId","getSessionGroupLabel","DEFAULT_SELECTORS","STORAGE_KEY","URL_PARAM","ActivityViewSwitcher","selectors","onViewChange","view","persist","updateUrl","urlView","storedView","isTable","params","query","newUrl","event","CATEGORY_COLORS","groupEntriesByDate","groupMap","dateKey","startOfDay","a","b","groupEntriesBySession","groupKey","groups","group","aTime","mergeEntriesIntoGroups","existingGroups","newEntries","e","result","getActorInitials","renderTimelineEntry","actionLabels","showDebugInfo","parsedAction","sentence","relativeTime","metadataSummary","metadataContent","enrichmentDebug","colors","initials","actorTypeIcon","entryEl","metadataHtml","actorTypeIndicator","renderSessionGroupHeader","sessionGroup","onToggle","sessionKey","headerEl","entryCount","countText","toggleBtn","newCollapsed","renderDateGroupHeader","renderDateGroup","groupBySession","onSessionToggle","collapsedSessions","groupEl","entriesEl","sessionGroups","showSessionHeaders","sessionHeaderEl","sessionEntriesEl","TimelineRenderer","container","timelineEl","collapsed","g","emptyEl","toggle","entryId","contentEl","newExpanded","chevron","createLoadingIndicator","el","createEndIndicator","createScrollSentinel","TIMELINE_SELECTORS","FIELD_IDS","DATE_FIELDS","PASSTHROUGH_FIELDS","isRecord","parseActivityAPIError","payload","envelope","textCode","message","ActivityManager","config","toast","loadingIndicator","url","response","endIndicator","err","name","input","parsed","offset","limit","val","next","apiError","lastSessionId","mainRow","detailsRow","timestamp","shortChannel","hasMetadata","hasDebugInfo","showDetailsRow","categoryColors","actionCellHtml","channelHtml","metadataCellHtml","buttonLabel","buttonClass","buttonStyle","buttonIcon","detailsContent","row","shortSessionId","total","start","end"],"mappings":"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"}