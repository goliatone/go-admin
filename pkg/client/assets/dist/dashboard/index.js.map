{"version":3,"file":"index.js","sources":["../../src/dashboard/behaviors/drag-drop.ts","../../src/dashboard/behaviors/resize.ts","../../src/dashboard/behaviors/visibility.ts","../../src/dashboard/behaviors/persistence.ts","../../src/dashboard/widget-grid.ts"],"sourcesContent":["/**\n * Default drag and drop behavior for widgets\n */\n\nimport type { DragDropBehavior } from '../types.js';\n\nexport class DefaultDragDropBehavior implements DragDropBehavior {\n  private draggedElement: HTMLElement | null = null;\n  private cleanupFunctions: (() => void)[] = [];\n\n  enable(container: HTMLElement, onDrop: () => void): void {\n    const widgets = container.querySelectorAll<HTMLElement>('[data-widget]');\n\n    widgets.forEach(widget => {\n      widget.draggable = true;\n\n      const dragStartHandler = () => {\n        this.draggedElement = widget;\n        widget.classList.add('dragging');\n      };\n\n      const dragEndHandler = () => {\n        widget.classList.remove('dragging');\n        this.draggedElement = null;\n      };\n\n      widget.addEventListener('dragstart', dragStartHandler);\n      widget.addEventListener('dragend', dragEndHandler);\n\n      this.cleanupFunctions.push(() => {\n        widget.removeEventListener('dragstart', dragStartHandler);\n        widget.removeEventListener('dragend', dragEndHandler);\n      });\n    });\n\n    const areas = container.querySelectorAll<HTMLElement>('[data-widgets-grid]');\n\n    areas.forEach(area => {\n      const dragOverHandler = (event: DragEvent) => {\n        event.preventDefault();\n\n        if (!this.draggedElement) return;\n\n        const afterElement = this.getDragAfterElement(area, event.clientY);\n\n        if (afterElement == null) {\n          area.appendChild(this.draggedElement);\n        } else if (afterElement !== this.draggedElement) {\n          area.insertBefore(this.draggedElement, afterElement);\n        }\n      };\n\n      const dropHandler = (event: DragEvent) => {\n        event.preventDefault();\n        onDrop();\n      };\n\n      area.addEventListener('dragover', dragOverHandler);\n      area.addEventListener('drop', dropHandler);\n\n      this.cleanupFunctions.push(() => {\n        area.removeEventListener('dragover', dragOverHandler);\n        area.removeEventListener('drop', dropHandler);\n      });\n    });\n  }\n\n  disable(): void {\n    this.cleanupFunctions.forEach(cleanup => cleanup());\n    this.cleanupFunctions = [];\n    this.draggedElement = null;\n  }\n\n  private getDragAfterElement(container: HTMLElement, y: number): HTMLElement | null {\n    const draggableElements = Array.from(\n      container.querySelectorAll<HTMLElement>('[data-widget]:not(.dragging)')\n    );\n\n    return draggableElements.reduce<{ offset: number; element: HTMLElement | null }>(\n      (closest, child) => {\n        const box = child.getBoundingClientRect();\n        const offset = y - box.top - box.height / 2;\n\n        if (offset < 0 && offset > closest.offset) {\n          return { offset, element: child };\n        } else {\n          return closest;\n        }\n      },\n      { offset: Number.NEGATIVE_INFINITY, element: null }\n    ).element;\n  }\n}\n","/**\n * Default resize behavior for widgets\n */\n\nimport type { ResizeBehavior } from '../types.js';\n\nexport class DefaultResizeBehavior implements ResizeBehavior {\n  toggleWidth(widget: HTMLElement, currentSpan: number, maxColumns: number): number {\n    // Toggle between half-width and full-width\n    const newSpan = currentSpan === maxColumns ? maxColumns / 2 : maxColumns;\n    this.applyWidth(widget, newSpan);\n    return newSpan;\n  }\n\n  applyWidth(widget: HTMLElement, span: number): void {\n    widget.dataset.span = span.toString();\n    widget.style.setProperty('--span', span.toString());\n  }\n}\n","/**\n * Default visibility behavior for widgets\n */\n\nimport type { VisibilityBehavior } from '../types.js';\n\nexport class DefaultVisibilityBehavior implements VisibilityBehavior {\n  toggle(widget: HTMLElement): boolean {\n    const isHidden = widget.dataset.hidden === 'true';\n    const newState = !isHidden;\n    this.applyVisibility(widget, newState);\n    return newState;\n  }\n\n  applyVisibility(widget: HTMLElement, hidden: boolean): void {\n    if (hidden) {\n      widget.dataset.hidden = 'true';\n      widget.classList.add('is-hidden');\n    } else {\n      delete widget.dataset.hidden;\n      widget.classList.remove('is-hidden');\n    }\n  }\n}\n","/**\n * Default persistence behavior using fetch API\n */\n\nimport type { PersistenceBehavior, LayoutPreferences } from '../types.js';\n\nexport class DefaultPersistenceBehavior implements PersistenceBehavior {\n  async save(endpoint: string, layout: LayoutPreferences): Promise<void> {\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(layout),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to save layout: ${response.statusText}`);\n    }\n  }\n\n  async load(endpoint: string): Promise<LayoutPreferences | null> {\n    try {\n      const response = await fetch(endpoint);\n      if (!response.ok) {\n        return null;\n      }\n      return await response.json();\n    } catch (error) {\n      console.warn('Failed to load layout preferences:', error);\n      return null;\n    }\n  }\n}\n","/**\n * WidgetGrid - Main component for dashboard widget management\n * Supports drag & drop, resize, visibility toggle, and layout persistence\n */\n\nimport type {\n  WidgetGridConfig,\n  LayoutPreferences,\n  Widget,\n  WidgetLayoutRow,\n  WidgetGridBehaviors,\n} from './types.js';\n\nimport { DefaultDragDropBehavior } from './behaviors/drag-drop.js';\nimport { DefaultResizeBehavior } from './behaviors/resize.js';\nimport { DefaultVisibilityBehavior } from './behaviors/visibility.js';\nimport { DefaultPersistenceBehavior } from './behaviors/persistence.js';\n\nexport class WidgetGrid {\n  private config: Required<WidgetGridConfig>;\n  private behaviors: Required<WidgetGridBehaviors>;\n  private container: HTMLElement | null = null;\n  private saveTimer: number | null = null;\n  private statusElement: HTMLElement | null = null;\n  private panelSchema: Record<string, any> | null = null;\n  private panelTabs: any[] = [];\n\n  constructor(config: WidgetGridConfig) {\n    this.config = {\n      apiEndpoint: config.apiEndpoint,\n      preferencesEndpoint: config.preferencesEndpoint || `${config.apiEndpoint}/preferences`,\n      areas: config.areas || [],\n      defaultSpan: config.defaultSpan ?? 12,\n      maxColumns: config.maxColumns ?? 12,\n      saveDelay: config.saveDelay ?? 200,\n      selectors: {\n        areas: '[data-widgets-grid]',\n        widgets: '[data-widget]',\n        toolbar: '[data-widget-toolbar]',\n        hideBtn: '[data-action=\"toggle-hide\"]',\n        resizeBtn: '[data-action=\"toggle-width\"]',\n        ...config.selectors,\n      },\n      behaviors: config.behaviors || {},\n      onSave: config.onSave || (() => {}),\n      onError: config.onError || ((error) => console.error('WidgetGrid error:', error)),\n    };\n\n    this.behaviors = {\n      dragDrop: config.behaviors?.dragDrop || new DefaultDragDropBehavior(),\n      resize: config.behaviors?.resize || new DefaultResizeBehavior(),\n      visibility: config.behaviors?.visibility || new DefaultVisibilityBehavior(),\n      persistence: config.behaviors?.persistence || new DefaultPersistenceBehavior(),\n    };\n  }\n\n  async init(serverState?: any): Promise<void> {\n    this.container = document.querySelector('[data-widget-grid]');\n    this.statusElement = document.getElementById('save-status');\n\n    if (!this.container) {\n      throw new Error('Widget grid container not found');\n    }\n\n    const resolvedState = this.normalizePanelDetailState(serverState);\n    if (resolvedState.schema) {\n      this.panelSchema = resolvedState.schema;\n      this.panelTabs = resolvedState.schema.tabs || [];\n    }\n\n    // Hydration mode: widgets already rendered by server\n    // Just attach behaviors to existing DOM elements\n    this.attachEventListeners();\n    this.initializeDragDrop();\n\n    // If server state provided, validate it matches DOM (optional)\n    if (resolvedState.data) {\n      this.validateHydration(resolvedState.data);\n    }\n  }\n\n  private validateHydration(serverState: any): void {\n    // Optional: Verify server-rendered state matches expected layout\n    // This helps detect hydration mismatches during development\n    if (serverState.areas) {\n      const renderedAreas = this.container?.querySelectorAll('[data-area-code]');\n      if (renderedAreas && renderedAreas.length !== serverState.areas.length) {\n        console.warn('Hydration mismatch: area count does not match', {\n          server: serverState.areas.length,\n          dom: renderedAreas.length,\n        });\n      }\n    }\n  }\n\n  getSchema(): Record<string, any> | null {\n    return this.panelSchema;\n  }\n\n  getTabs(): any[] {\n    return this.panelTabs;\n  }\n\n  private normalizePanelDetailState(payload: any): { data?: any; schema?: Record<string, any> } {\n    if (!payload) {\n      return {};\n    }\n    if (payload && typeof payload === 'object' && 'data' in payload) {\n      const detail = payload as { data?: any; schema?: Record<string, any> };\n      return {\n        data: detail.data,\n        schema: detail.schema,\n      };\n    }\n    return { data: payload };\n  }\n\n  private initializeDragDrop(): void {\n    if (!this.container) return;\n\n    this.behaviors.dragDrop.enable(this.container, () => {\n      this.saveLayout();\n    });\n  }\n\n  private attachEventListeners(): void {\n    if (!this.container) return;\n\n    // Hide/show toggle buttons\n    this.container.addEventListener('click', (event: Event) => {\n      const target = event.target as HTMLElement;\n      const hideBtn = target.closest<HTMLElement>(this.config.selectors.hideBtn!);\n\n      if (hideBtn) {\n        const widget = hideBtn.closest<HTMLElement>('[data-widget]');\n        if (widget) {\n          this.behaviors.visibility.toggle(widget);\n          this.saveLayout();\n        }\n      }\n    });\n\n    // Resize toggle buttons\n    this.container.addEventListener('click', (event: Event) => {\n      const target = event.target as HTMLElement;\n      const resizeBtn = target.closest<HTMLElement>(this.config.selectors.resizeBtn!);\n\n      if (resizeBtn) {\n        const widget = resizeBtn.closest<HTMLElement>('[data-widget]');\n        if (widget) {\n          const currentSpan = parseInt(widget.dataset.span || `${this.config.defaultSpan}`, 10);\n          const newSpan = this.behaviors.resize.toggleWidth(widget, currentSpan, this.config.maxColumns);\n\n          // Update button text\n          const btnText = newSpan === this.config.maxColumns ? 'Half Width' : 'Full Width';\n          const textNode = Array.from(resizeBtn.childNodes).find(node => node.nodeType === Node.TEXT_NODE);\n          if (textNode) {\n            textNode.textContent = btnText;\n          }\n\n          this.saveLayout();\n        }\n      }\n    });\n\n    // Initialize resize button labels\n    this.container.querySelectorAll<HTMLElement>(this.config.selectors.resizeBtn!).forEach(btn => {\n      const widget = btn.closest<HTMLElement>('[data-widget]');\n      if (widget) {\n        const span = parseInt(widget.dataset.span || `${this.config.defaultSpan}`, 10);\n        const btnText = span === this.config.maxColumns ? 'Half Width' : 'Full Width';\n        const textNode = Array.from(btn.childNodes).find(node => node.nodeType === Node.TEXT_NODE);\n        if (textNode) {\n          textNode.textContent = btnText;\n        }\n      }\n    });\n  }\n\n  private saveLayout(): void {\n    if (this.saveTimer !== null) {\n      clearTimeout(this.saveTimer);\n    }\n\n    this.updateStatus('Saving layoutâ€¦');\n\n    this.saveTimer = window.setTimeout(async () => {\n      try {\n        const layout = this.serializeLayout();\n        await this.behaviors.persistence.save(this.config.preferencesEndpoint, layout);\n        this.updateStatus('Layout saved');\n        this.config.onSave(layout);\n      } catch (error) {\n        this.updateStatus('Save failed');\n        this.config.onError(error as Error);\n      }\n    }, this.config.saveDelay);\n  }\n\n  private serializeLayout(): LayoutPreferences {\n    const layout: LayoutPreferences = {\n      area_order: {},\n      hidden_widget_ids: [],\n      layout_rows: {},\n    };\n\n    if (!this.container) return layout;\n\n    // Collect widget order and layout for each area\n    const areas = this.container.querySelectorAll<HTMLElement>(this.config.selectors.areas!);\n\n    areas.forEach(area => {\n      const areaCode = area.dataset.areaGrid || area.dataset.areaCode;\n      if (!areaCode) return;\n\n      const visibleWidgets = Array.from(\n        area.querySelectorAll<HTMLElement>('[data-widget]:not([data-hidden=\"true\"])')\n      );\n\n      layout.area_order[areaCode] = visibleWidgets.map(w => w.dataset.widget!);\n      layout.layout_rows[areaCode] = this.serializeRows(visibleWidgets);\n    });\n\n    // Collect hidden widgets\n    const hiddenWidgets = this.container.querySelectorAll<HTMLElement>('[data-widget][data-hidden=\"true\"]');\n    layout.hidden_widget_ids = Array.from(hiddenWidgets).map(w => w.dataset.widget!);\n\n    return layout;\n  }\n\n  private serializeRows(widgets: HTMLElement[]): WidgetLayoutRow[] {\n    const rows: WidgetLayoutRow[] = [];\n    let currentRow: { id: string; width: number }[] = [];\n    let currentRowWidth = 0;\n\n    widgets.forEach(widget => {\n      const widgetId = widget.dataset.widget!;\n      const span = parseInt(widget.dataset.span || `${this.config.defaultSpan}`, 10);\n\n      if (currentRowWidth + span > this.config.maxColumns && currentRowWidth > 0) {\n        rows.push({ widgets: currentRow });\n        currentRow = [];\n        currentRowWidth = 0;\n      }\n\n      currentRow.push({ id: widgetId, width: span });\n      currentRowWidth += span;\n\n      if (currentRowWidth >= this.config.maxColumns) {\n        rows.push({ widgets: currentRow });\n        currentRow = [];\n        currentRowWidth = 0;\n      }\n    });\n\n    if (currentRow.length > 0) {\n      rows.push({ widgets: currentRow });\n    }\n\n    return rows;\n  }\n\n  private updateStatus(message: string): void {\n    if (this.statusElement) {\n      this.statusElement.textContent = message;\n    }\n  }\n\n  destroy(): void {\n    if (this.saveTimer !== null) {\n      clearTimeout(this.saveTimer);\n    }\n    this.behaviors.dragDrop.disable();\n  }\n}\n"],"names":["DefaultDragDropBehavior","container","onDrop","widget","dragStartHandler","dragEndHandler","area","dragOverHandler","event","afterElement","dropHandler","cleanup","y","closest","child","box","offset","DefaultResizeBehavior","currentSpan","maxColumns","newSpan","span","DefaultVisibilityBehavior","newState","hidden","DefaultPersistenceBehavior","endpoint","layout","response","error","WidgetGrid","config","serverState","resolvedState","renderedAreas","payload","detail","hideBtn","resizeBtn","btnText","textNode","node","btn","areaCode","visibleWidgets","w","hiddenWidgets","widgets","rows","currentRow","currentRowWidth","widgetId","message"],"mappings":"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"}