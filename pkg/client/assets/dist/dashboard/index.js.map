{"version":3,"file":"index.js","sources":["../../src/dashboard/behaviors/drag-drop.ts","../../src/dashboard/behaviors/resize.ts","../../src/dashboard/behaviors/visibility.ts","../../src/dashboard/behaviors/persistence.ts","../../src/dashboard/widget-grid.ts","../../src/dashboard/widget-renderer.ts","../../src/dashboard/admin-dashboard.ts"],"sourcesContent":["/**\n * Default drag and drop behavior for widgets\n */\n\nimport type { DragDropBehavior } from '../types.js';\n\nexport class DefaultDragDropBehavior implements DragDropBehavior {\n  private draggedElement: HTMLElement | null = null;\n  private cleanupFunctions: (() => void)[] = [];\n\n  enable(container: HTMLElement, onDrop: () => void): void {\n    const widgets = container.querySelectorAll<HTMLElement>('[data-widget]');\n\n    widgets.forEach(widget => {\n      widget.draggable = true;\n\n      const dragStartHandler = () => {\n        this.draggedElement = widget;\n        widget.classList.add('dragging');\n      };\n\n      const dragEndHandler = () => {\n        widget.classList.remove('dragging');\n        this.draggedElement = null;\n      };\n\n      widget.addEventListener('dragstart', dragStartHandler);\n      widget.addEventListener('dragend', dragEndHandler);\n\n      this.cleanupFunctions.push(() => {\n        widget.removeEventListener('dragstart', dragStartHandler);\n        widget.removeEventListener('dragend', dragEndHandler);\n      });\n    });\n\n    const areas = container.querySelectorAll<HTMLElement>('[data-widgets-grid]');\n\n    areas.forEach(area => {\n      const dragOverHandler = (event: DragEvent) => {\n        event.preventDefault();\n\n        if (!this.draggedElement) return;\n\n        const afterElement = this.getDragAfterElement(area, event.clientY);\n\n        if (afterElement == null) {\n          area.appendChild(this.draggedElement);\n        } else if (afterElement !== this.draggedElement) {\n          area.insertBefore(this.draggedElement, afterElement);\n        }\n      };\n\n      const dropHandler = (event: DragEvent) => {\n        event.preventDefault();\n        onDrop();\n      };\n\n      area.addEventListener('dragover', dragOverHandler);\n      area.addEventListener('drop', dropHandler);\n\n      this.cleanupFunctions.push(() => {\n        area.removeEventListener('dragover', dragOverHandler);\n        area.removeEventListener('drop', dropHandler);\n      });\n    });\n  }\n\n  disable(): void {\n    this.cleanupFunctions.forEach(cleanup => cleanup());\n    this.cleanupFunctions = [];\n    this.draggedElement = null;\n  }\n\n  private getDragAfterElement(container: HTMLElement, y: number): HTMLElement | null {\n    const draggableElements = Array.from(\n      container.querySelectorAll<HTMLElement>('[data-widget]:not(.dragging)')\n    );\n\n    return draggableElements.reduce<{ offset: number; element: HTMLElement | null }>(\n      (closest, child) => {\n        const box = child.getBoundingClientRect();\n        const offset = y - box.top - box.height / 2;\n\n        if (offset < 0 && offset > closest.offset) {\n          return { offset, element: child };\n        } else {\n          return closest;\n        }\n      },\n      { offset: Number.NEGATIVE_INFINITY, element: null }\n    ).element;\n  }\n}\n","/**\n * Default resize behavior for widgets\n */\n\nimport type { ResizeBehavior } from '../types.js';\n\nexport class DefaultResizeBehavior implements ResizeBehavior {\n  toggleWidth(widget: HTMLElement, currentSpan: number, maxColumns: number): number {\n    // Toggle between half-width and full-width\n    const newSpan = currentSpan === maxColumns ? maxColumns / 2 : maxColumns;\n    this.applyWidth(widget, newSpan);\n    return newSpan;\n  }\n\n  applyWidth(widget: HTMLElement, span: number): void {\n    widget.dataset.span = span.toString();\n    widget.style.setProperty('--span', span.toString());\n  }\n}\n","/**\n * Default visibility behavior for widgets\n */\n\nimport type { VisibilityBehavior } from '../types.js';\n\nexport class DefaultVisibilityBehavior implements VisibilityBehavior {\n  toggle(widget: HTMLElement): boolean {\n    const isHidden = widget.dataset.hidden === 'true';\n    const newState = !isHidden;\n    this.applyVisibility(widget, newState);\n    return newState;\n  }\n\n  applyVisibility(widget: HTMLElement, hidden: boolean): void {\n    if (hidden) {\n      widget.dataset.hidden = 'true';\n      widget.classList.add('is-hidden');\n    } else {\n      delete widget.dataset.hidden;\n      widget.classList.remove('is-hidden');\n    }\n  }\n}\n","/**\n * Default persistence behavior using fetch API\n */\n\nimport type { PersistenceBehavior, LayoutPreferences } from '../types.js';\n\nexport class DefaultPersistenceBehavior implements PersistenceBehavior {\n  async save(endpoint: string, layout: LayoutPreferences): Promise<void> {\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(layout),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to save layout: ${response.statusText}`);\n    }\n  }\n\n  async load(endpoint: string): Promise<LayoutPreferences | null> {\n    try {\n      const response = await fetch(endpoint);\n      if (!response.ok) {\n        return null;\n      }\n      return await response.json();\n    } catch (error) {\n      console.warn('Failed to load layout preferences:', error);\n      return null;\n    }\n  }\n}\n","/**\n * WidgetGrid - Main component for dashboard widget management\n * Supports drag & drop, resize, visibility toggle, and layout persistence\n */\n\nimport type {\n  WidgetGridConfig,\n  LayoutPreferences,\n  Widget,\n  WidgetLayoutRow,\n  WidgetGridBehaviors,\n} from './types.js';\n\nimport { DefaultDragDropBehavior } from './behaviors/drag-drop.js';\nimport { DefaultResizeBehavior } from './behaviors/resize.js';\nimport { DefaultVisibilityBehavior } from './behaviors/visibility.js';\nimport { DefaultPersistenceBehavior } from './behaviors/persistence.js';\n\nexport class WidgetGrid {\n  private config: Required<WidgetGridConfig>;\n  private behaviors: Required<WidgetGridBehaviors>;\n  private container: HTMLElement | null = null;\n  private saveTimer: number | null = null;\n  private statusElement: HTMLElement | null = null;\n  private panelSchema: Record<string, any> | null = null;\n  private panelTabs: any[] = [];\n\n  constructor(config: WidgetGridConfig) {\n    this.config = {\n      apiEndpoint: config.apiEndpoint,\n      preferencesEndpoint: config.preferencesEndpoint || `${config.apiEndpoint}/preferences`,\n      areas: config.areas || [],\n      defaultSpan: config.defaultSpan ?? 12,\n      maxColumns: config.maxColumns ?? 12,\n      saveDelay: config.saveDelay ?? 200,\n      selectors: {\n        areas: '[data-widgets-grid]',\n        widgets: '[data-widget]',\n        toolbar: '[data-widget-toolbar]',\n        hideBtn: '[data-action=\"toggle-hide\"]',\n        resizeBtn: '[data-action=\"toggle-width\"]',\n        ...config.selectors,\n      },\n      behaviors: config.behaviors || {},\n      onSave: config.onSave || (() => {}),\n      onError: config.onError || ((error) => console.error('WidgetGrid error:', error)),\n    };\n\n    this.behaviors = {\n      dragDrop: config.behaviors?.dragDrop || new DefaultDragDropBehavior(),\n      resize: config.behaviors?.resize || new DefaultResizeBehavior(),\n      visibility: config.behaviors?.visibility || new DefaultVisibilityBehavior(),\n      persistence: config.behaviors?.persistence || new DefaultPersistenceBehavior(),\n    };\n  }\n\n  async init(serverState?: any): Promise<void> {\n    this.container = document.querySelector('[data-widget-grid]');\n    this.statusElement = document.getElementById('save-status');\n\n    if (!this.container) {\n      throw new Error('Widget grid container not found');\n    }\n\n    const resolvedState = this.normalizePanelDetailState(serverState);\n    if (resolvedState.schema) {\n      this.panelSchema = resolvedState.schema;\n      this.panelTabs = resolvedState.schema.tabs || [];\n    }\n\n    // Hydration mode: widgets already rendered by server\n    // Just attach behaviors to existing DOM elements\n    this.normalizeRenderedWidgetSpans();\n    this.attachEventListeners();\n    this.initializeDragDrop();\n\n    // If server state provided, validate it matches DOM (optional)\n    if (resolvedState.data) {\n      this.validateHydration(resolvedState.data);\n    }\n  }\n\n  private validateHydration(serverState: any): void {\n    if (!Array.isArray(serverState?.areas) || !this.container) {\n      return;\n    }\n\n    // Compare area grid containers only; widgets may also carry area metadata.\n    const renderedAreaCodes = Array.from(\n      this.container.querySelectorAll<HTMLElement>('[data-widgets-grid][data-area-grid]')\n    )\n      .map((node) => node.dataset.areaGrid || node.dataset.areaCode || '')\n      .filter((code): code is string => Boolean(code));\n\n    if (renderedAreaCodes.length === 0) {\n      return;\n    }\n\n    const serverAreaCodes = new Set(\n      serverState.areas\n        .map((area: any) => area?.code || area?.area_code || area?.id || '')\n        .filter((code: unknown): code is string => typeof code === 'string' && code.length > 0)\n    );\n\n    const missingFromServer = renderedAreaCodes.filter((code) => !serverAreaCodes.has(code));\n    if (missingFromServer.length > 0) {\n      console.warn('Hydration mismatch: rendered area(s) missing from server state', {\n        missing: missingFromServer,\n        server: Array.from(serverAreaCodes),\n        dom: renderedAreaCodes,\n      });\n    }\n  }\n\n  getSchema(): Record<string, any> | null {\n    return this.panelSchema;\n  }\n\n  getTabs(): any[] {\n    return this.panelTabs;\n  }\n\n  private normalizePanelDetailState(payload: any): { data?: any; schema?: Record<string, any> } {\n    if (!payload) {\n      return {};\n    }\n    if (payload && typeof payload === 'object' && 'data' in payload) {\n      const detail = payload as { data?: any; schema?: Record<string, any> };\n      return {\n        data: detail.data,\n        schema: detail.schema,\n      };\n    }\n    return { data: payload };\n  }\n\n  private initializeDragDrop(): void {\n    if (!this.container) return;\n\n    this.behaviors.dragDrop.enable(this.container, () => {\n      this.saveLayout();\n    });\n  }\n\n  private normalizeRenderedWidgetSpans(): void {\n    if (!this.container) return;\n\n    this.container.querySelectorAll<HTMLElement>('[data-widget]').forEach((widget) => {\n      const span = this.normalizeSpan(widget.dataset.span);\n      widget.dataset.span = span.toString();\n      widget.style.setProperty('--span', span.toString());\n    });\n  }\n\n  private normalizeSpan(value: unknown): number {\n    const parsed = Number.parseInt(String(value ?? ''), 10);\n    const fallback = Math.min(Math.max(this.config.defaultSpan, 1), this.config.maxColumns);\n    if (!Number.isFinite(parsed) || parsed < 1 || parsed > this.config.maxColumns) {\n      return fallback;\n    }\n    return parsed;\n  }\n\n  private attachEventListeners(): void {\n    if (!this.container) return;\n\n    // Hide/show toggle buttons\n    this.container.addEventListener('click', (event: Event) => {\n      const target = event.target as HTMLElement;\n      const hideBtn = target.closest<HTMLElement>(this.config.selectors.hideBtn!);\n\n      if (hideBtn) {\n        const widget = hideBtn.closest<HTMLElement>('[data-widget]');\n        if (widget) {\n          this.behaviors.visibility.toggle(widget);\n          this.saveLayout();\n        }\n      }\n    });\n\n    // Resize toggle buttons\n    this.container.addEventListener('click', (event: Event) => {\n      const target = event.target as HTMLElement;\n      const resizeBtn = target.closest<HTMLElement>(this.config.selectors.resizeBtn!);\n\n      if (resizeBtn) {\n        const widget = resizeBtn.closest<HTMLElement>('[data-widget]');\n        if (widget) {\n          const currentSpan = this.normalizeSpan(widget.dataset.span);\n          const newSpan = this.behaviors.resize.toggleWidth(widget, currentSpan, this.config.maxColumns);\n\n          // Update button text\n          const btnText = newSpan === this.config.maxColumns ? 'Half Width' : 'Full Width';\n          const textNode = Array.from(resizeBtn.childNodes).find(node => node.nodeType === Node.TEXT_NODE);\n          if (textNode) {\n            textNode.textContent = btnText;\n          }\n\n          this.saveLayout();\n        }\n      }\n    });\n\n    // Initialize resize button labels\n    this.container.querySelectorAll<HTMLElement>(this.config.selectors.resizeBtn!).forEach(btn => {\n      const widget = btn.closest<HTMLElement>('[data-widget]');\n      if (widget) {\n        const span = this.normalizeSpan(widget.dataset.span);\n        const btnText = span === this.config.maxColumns ? 'Half Width' : 'Full Width';\n        const textNode = Array.from(btn.childNodes).find(node => node.nodeType === Node.TEXT_NODE);\n        if (textNode) {\n          textNode.textContent = btnText;\n        }\n      }\n    });\n  }\n\n  private saveLayout(): void {\n    if (this.saveTimer !== null) {\n      clearTimeout(this.saveTimer);\n    }\n\n    this.updateStatus('Saving layout…');\n\n    this.saveTimer = window.setTimeout(async () => {\n      try {\n        const layout = this.serializeLayout();\n        await this.behaviors.persistence.save(this.config.preferencesEndpoint, layout);\n        this.updateStatus('Layout saved');\n        this.config.onSave(layout);\n      } catch (error) {\n        this.updateStatus('Save failed');\n        this.config.onError(error as Error);\n      }\n    }, this.config.saveDelay);\n  }\n\n  private serializeLayout(): LayoutPreferences {\n    const layout: LayoutPreferences = {\n      area_order: {},\n      hidden_widget_ids: [],\n      layout_rows: {},\n    };\n\n    if (!this.container) return layout;\n\n    // Collect widget order and layout for each area\n    const areas = this.container.querySelectorAll<HTMLElement>(this.config.selectors.areas!);\n\n    areas.forEach(area => {\n      const areaCode = area.dataset.areaGrid || area.dataset.areaCode;\n      if (!areaCode) return;\n\n      const visibleWidgets = Array.from(\n        area.querySelectorAll<HTMLElement>('[data-widget]:not([data-hidden=\"true\"])')\n      );\n\n      layout.area_order[areaCode] = visibleWidgets.map(w => w.dataset.widget!);\n      layout.layout_rows[areaCode] = this.serializeRows(visibleWidgets);\n    });\n\n    // Collect hidden widgets\n    const hiddenWidgets = this.container.querySelectorAll<HTMLElement>('[data-widget][data-hidden=\"true\"]');\n    layout.hidden_widget_ids = Array.from(hiddenWidgets).map(w => w.dataset.widget!);\n\n    return layout;\n  }\n\n  private serializeRows(widgets: HTMLElement[]): WidgetLayoutRow[] {\n    const rows: WidgetLayoutRow[] = [];\n    let currentRow: { id: string; width: number }[] = [];\n    let currentRowWidth = 0;\n\n    widgets.forEach(widget => {\n      const widgetId = widget.dataset.widget!;\n      const span = this.normalizeSpan(widget.dataset.span);\n\n      if (currentRowWidth + span > this.config.maxColumns && currentRowWidth > 0) {\n        rows.push({ widgets: currentRow });\n        currentRow = [];\n        currentRowWidth = 0;\n      }\n\n      currentRow.push({ id: widgetId, width: span });\n      currentRowWidth += span;\n\n      if (currentRowWidth >= this.config.maxColumns) {\n        rows.push({ widgets: currentRow });\n        currentRow = [];\n        currentRowWidth = 0;\n      }\n    });\n\n    if (currentRow.length > 0) {\n      rows.push({ widgets: currentRow });\n    }\n\n    return rows;\n  }\n\n  private updateStatus(message: string): void {\n    if (this.statusElement) {\n      this.statusElement.textContent = message;\n    }\n  }\n\n  destroy(): void {\n    if (this.saveTimer !== null) {\n      clearTimeout(this.saveTimer);\n    }\n    this.behaviors.dragDrop.disable();\n  }\n}\n","/**\n * Widget Renderer - Client-side widget rendering for admin dashboard\n */\n\nimport type { Widget, AdminDashboardConfig, WidgetTitleMap } from './types.js';\n\n/** Default widget titles by definition */\nconst WIDGET_TITLES: WidgetTitleMap = {\n  'admin.widget.user_stats': 'User Statistics',\n  'admin.widget.activity_feed': 'Recent Activity',\n  'admin.widget.quick_actions': 'Quick Actions',\n  'admin.widget.notifications': 'Notifications',\n  'admin.widget.settings_overview': 'Settings Overview',\n  'admin.widget.translation_progress': 'Translation Progress',\n  'admin.widget.content_stats': 'Content Stats',\n  'admin.widget.storage_stats': 'Storage Stats',\n  'admin.widget.system_health': 'System Health',\n  'admin.widget.bar_chart': 'Bar Chart',\n  'admin.widget.line_chart': 'Line Chart',\n  'admin.widget.pie_chart': 'Pie Chart',\n  'admin.widget.gauge_chart': 'Gauge',\n  'admin.widget.scatter_chart': 'Scatter Chart',\n};\n\nconst CHART_WIDGET_DEFINITIONS = new Set([\n  'admin.widget.bar_chart',\n  'admin.widget.line_chart',\n  'admin.widget.pie_chart',\n  'admin.widget.gauge_chart',\n  'admin.widget.scatter_chart',\n]);\n\n/**\n * Renders dashboard widgets to HTML strings\n */\nexport class WidgetRenderer {\n  private activityActionLabels: Record<string, string>;\n\n  constructor(config: AdminDashboardConfig) {\n    this.activityActionLabels = config.activityActionLabels || {};\n  }\n\n  /**\n   * Render a complete widget with wrapper and toolbar\n   */\n  render(widget: Widget, areaCode: string): string {\n    const areaResizable = areaCode === 'admin.dashboard.main' || areaCode === 'admin.dashboard.footer';\n    const span = this.normalizeSpan(widget.metadata?.layout?.width ?? widget.span);\n    const hidden = widget.hidden || false;\n    const title = widget.data?.title || widget.config?.title || this.getTitle(widget.definition);\n    const widgetId = widget.id || widget.definition || `widget-${Math.random().toString(36).substr(2, 9)}`;\n    const widgetContent = this.renderContent(widget);\n\n    // Build toolbar HTML\n    let toolbarHTML = '<div class=\"widget__toolbar\">';\n    toolbarHTML += '<button type=\"button\" class=\"hide-widget\">Toggle Hide</button>';\n\n    if (areaResizable) {\n      toolbarHTML += '<button type=\"button\" class=\"resize-widget\">Half Width</button>';\n    } else {\n      toolbarHTML += '<button type=\"button\" class=\"resize-widget\" disabled title=\"Resize only available in Main or Operations\">Half Width</button>';\n    }\n\n    toolbarHTML += '</div>';\n\n    return `\n      <article class=\"widget\"\n               data-widget=\"${widgetId}\"\n               data-span=\"${span}\"\n               data-area-code=\"${areaCode}\"\n               data-resizable=\"${areaResizable}\"\n               ${hidden ? 'data-hidden=\"true\"' : ''}\n               style=\"--span: ${span}\">\n        ${toolbarHTML}\n        <div class=\"widget__header mb-4\">\n          <h3 class=\"text-lg font-semibold text-gray-900\">${title}</h3>\n        </div>\n        <div class=\"widget__content\">\n          ${widgetContent}\n        </div>\n      </article>\n    `;\n  }\n\n  /**\n   * Render widget content based on definition type\n   */\n  renderContent(widget: Widget): string {\n    const def = widget.definition || '';\n    const data = widget.data || {};\n    const config = widget.config || {};\n\n    // User stats widget\n    if (def === 'admin.widget.user_stats') {\n      const values: Record<string, unknown> = {\n        Total: data.total ?? 0,\n        Active: data.active ?? 0,\n        'New Today': data.new_today ?? 0,\n      };\n      if (data.trend) {\n        values.Trend = data.trend;\n      }\n      return `\n        <div class=\"metrics\">\n          ${Object.entries(values).map(([key, value]) => `\n            <div class=\"metric\">\n              <small>${key}</small>\n              <span>${this.formatNumber(value)}</span>\n            </div>\n          `).join('')}\n        </div>\n      `;\n    }\n\n    // User profile overview widget\n    if (def === 'admin.widget.user_profile_overview') {\n      const values = data.values || {};\n      const entries = Object.entries(values);\n      if (entries.length === 0) {\n        return '<p class=\"text-gray-500\">No profile data to display</p>';\n      }\n      return `\n        <dl class=\"space-y-2\">\n          ${entries.map(([key, val]) => `\n            <div class=\"flex items-start justify-between gap-4\">\n              <dt class=\"text-sm text-gray-600\">${key}</dt>\n              <dd class=\"text-sm font-semibold text-gray-900\">${val ?? '—'}</dd>\n            </div>\n          `).join('')}\n        </dl>\n      `;\n    }\n\n    // Settings overview widget\n    if (def === 'admin.widget.settings_overview') {\n      const values = data.values || {};\n      const entries = Object.entries(values);\n      if (entries.length === 0) {\n        return '<p class=\"text-gray-500\">No settings to display</p>';\n      }\n      return `\n        <dl class=\"space-y-2\">\n          ${entries.map(([key, val]) => {\n            const value = typeof val === 'object' && val !== null ? (val as Record<string, unknown>).value ?? val : val;\n            return `\n              <div class=\"flex items-start justify-between gap-4\">\n                <dt class=\"text-sm text-gray-600\">${key}</dt>\n                <dd class=\"text-sm font-semibold text-gray-900\">${value ?? '—'}</dd>\n              </div>\n            `;\n          }).join('')}\n        </dl>\n      `;\n    }\n\n    // Activity feed widget\n    if (def === 'admin.widget.activity_feed') {\n      const entries = data.entries || [];\n      if (entries.length === 0) {\n        return '<p class=\"text-gray-500\">No recent activity</p>';\n      }\n      return `\n        <ul class=\"space-y-3\">\n          ${entries.map((entry: { actor: string; action: string; object: string }) => `\n            <li class=\"py-3 border-b border-gray-100 last:border-b-0\">\n              <div class=\"font-semibold text-gray-900 text-sm\">${entry.actor}</div>\n              <div class=\"text-gray-600 text-sm mt-1\">${this.activityActionLabels?.[entry.action] || entry.action} ${entry.object}</div>\n            </li>\n          `).join('')}\n        </ul>\n      `;\n    }\n\n    // Quick actions widget\n    if (def === 'admin.widget.quick_actions') {\n      const actions = data.actions || [];\n      if (actions.length === 0) {\n        return '<p class=\"text-gray-500\">No quick actions configured</p>';\n      }\n      return `\n        <div class=\"space-y-2\">\n          ${actions.map((action: { url?: string; label?: string; method?: string; description?: string }) => `\n            <a class=\"block p-3 border border-gray-200 rounded-lg hover:border-blue-200 hover:bg-blue-50/50 transition\" href=\"${action.url || '#'}\" target=\"_blank\" rel=\"noreferrer\">\n              <div class=\"flex items-center justify-between gap-2\">\n                <div class=\"font-semibold text-gray-900 text-sm\">${action.label || 'Action'}</div>\n                ${action.method ? `<span class=\"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded\">${action.method}</span>` : ''}\n              </div>\n              ${action.description ? `<div class=\"text-gray-600 text-sm mt-1\">${action.description}</div>` : ''}\n            </a>\n          `).join('')}\n        </div>\n      `;\n    }\n\n    // Legacy chart_sample widget - show disabled message\n    if (def === 'admin.widget.chart_sample') {\n      if (data.disabled) {\n        return '<p class=\"text-gray-500 text-sm italic\">This legacy chart widget has been disabled.</p>';\n      }\n    }\n\n    // System health widget\n    if (def === 'admin.widget.system_health') {\n      return `\n        <div class=\"space-y-2 text-sm\">\n          <div class=\"flex justify-between\">\n            <span class=\"text-gray-600\">Status:</span>\n            <span class=\"font-semibold text-green-600\">${data.status || 'unknown'}</span>\n          </div>\n          <div class=\"flex justify-between\">\n            <span class=\"text-gray-600\">Uptime:</span>\n            <span class=\"font-semibold\">${data.uptime || 'N/A'}</span>\n          </div>\n          <div class=\"flex justify-between\">\n            <span class=\"text-gray-600\">API Latency:</span>\n            <span class=\"font-semibold\">${data.api_latency || 'N/A'}</span>\n          </div>\n          <div class=\"flex justify-between\">\n            <span class=\"text-gray-600\">Database:</span>\n            <span class=\"font-semibold ${data.db_status === 'connected' ? 'text-green-600' : 'text-red-600'}\">${data.db_status || 'unknown'}</span>\n          </div>\n        </div>\n      `;\n    }\n\n    // Content stats widget\n    if (def === 'admin.widget.content_stats') {\n      return `\n        <div class=\"metrics\">\n          <div class=\"metric\">\n            <small>Published</small>\n            <span>${this.formatNumber(data.published || 0)}</span>\n          </div>\n          <div class=\"metric\">\n            <small>Draft</small>\n            <span>${this.formatNumber(data.draft || 0)}</span>\n          </div>\n          <div class=\"metric\">\n            <small>Scheduled</small>\n            <span>${this.formatNumber(data.scheduled || 0)}</span>\n          </div>\n        </div>\n      `;\n    }\n\n    // Storage stats widget\n    if (def === 'admin.widget.storage_stats') {\n      return `\n        <div class=\"metrics\">\n          <div class=\"metric\">\n            <small>Used</small>\n            <span>${data.used || '0 GB'}</span>\n          </div>\n          <div class=\"metric\">\n            <small>Total</small>\n            <span>${data.total || '0 GB'}</span>\n          </div>\n          <div class=\"metric\">\n            <small>Usage</small>\n            <span>${data.percentage || '0%'}</span>\n          </div>\n        </div>\n      `;\n    }\n\n    // Notifications widget\n    if (def === 'admin.widget.notifications') {\n      const notifications = data.notifications || [];\n      if (notifications.length === 0) {\n        return '<p class=\"text-gray-500\">No notifications</p>';\n      }\n      return `\n        <ul class=\"space-y-3\">\n          ${notifications.slice(0, 5).map((notif: { title: string; message: string; read: boolean }) => `\n            <li class=\"py-3 border-b border-gray-100 last:border-b-0\">\n              <div class=\"flex items-start justify-between gap-3\">\n                <div>\n                  <div class=\"font-semibold text-gray-900 text-sm\">${notif.title}</div>\n                  <div class=\"text-gray-600 text-sm mt-1\">${notif.message}</div>\n                </div>\n                <span class=\"px-2 py-1 text-xs font-semibold ${notif.read ? 'text-gray-600 bg-gray-100' : 'text-white bg-blue-500'} rounded-full whitespace-nowrap\">\n                  ${notif.read ? 'Read' : 'New'}\n                </span>\n              </div>\n            </li>\n          `).join('')}\n        </ul>\n      `;\n    }\n\n    // Translation progress widget\n    if (def === 'admin.widget.translation_progress') {\n      const summary = data.summary || {};\n      const statusCounts: Record<string, unknown> = data.status_counts || {};\n      const localeCounts: Record<string, unknown> = data.locale_counts || {};\n      const links = Array.isArray(data.links) ? data.links : [];\n      const overdueCount = Number(summary.overdue || 0);\n      const updatedAt = data.updated_at ? String(data.updated_at) : '';\n\n      const statusBadge = (statusRaw: string, count: unknown): string => {\n        const status = String(statusRaw || '').trim().toLowerCase();\n        let toneClass = 'bg-gray-100 text-gray-800';\n        let dotClass = 'bg-gray-500';\n        if (status === 'pending') {\n          toneClass = 'bg-yellow-100 text-yellow-800';\n          dotClass = 'bg-yellow-500';\n        } else if (status === 'in_progress') {\n          toneClass = 'bg-blue-100 text-blue-800';\n          dotClass = 'bg-blue-500';\n        } else if (status === 'review') {\n          toneClass = 'bg-purple-100 text-purple-800';\n          dotClass = 'bg-purple-500';\n        } else if (status === 'approved' || status === 'completed') {\n          toneClass = 'bg-green-100 text-green-800';\n          dotClass = 'bg-green-500';\n        } else if (status === 'rejected') {\n          toneClass = 'bg-red-100 text-red-800';\n          dotClass = 'bg-red-500';\n        }\n        const label = this.formatStatusLabel(statusRaw);\n        return `\n          <span class=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${toneClass}\">\n            <span class=\"w-1.5 h-1.5 rounded-full ${dotClass}\"></span>\n            ${label}: ${this.formatNumber(count)}\n          </span>\n        `;\n      };\n\n      return `\n        <div class=\"grid grid-cols-3 gap-3 mb-4\">\n          <div class=\"bg-gray-50 rounded-lg p-3 text-center\">\n            <div class=\"text-2xl font-bold text-gray-900\">${this.formatNumber(summary.total || 0)}</div>\n            <div class=\"text-xs text-gray-500 uppercase tracking-wide\">Total</div>\n          </div>\n          <div class=\"bg-blue-50 rounded-lg p-3 text-center\">\n            <div class=\"text-2xl font-bold text-blue-700\">${this.formatNumber(summary.active || 0)}</div>\n            <div class=\"text-xs text-blue-600 uppercase tracking-wide\">Active</div>\n          </div>\n          <div class=\"bg-purple-50 rounded-lg p-3 text-center\">\n            <div class=\"text-2xl font-bold text-purple-700\">${this.formatNumber(summary.review || 0)}</div>\n            <div class=\"text-xs text-purple-600 uppercase tracking-wide\">Review</div>\n          </div>\n        </div>\n\n        <div class=\"grid grid-cols-2 gap-3 mb-4\">\n          <div class=\"${overdueCount > 0 ? 'bg-red-50' : 'bg-gray-50'} rounded-lg p-2 text-center\">\n            <div class=\"text-lg font-bold ${overdueCount > 0 ? 'text-red-700' : 'text-gray-600'}\">\n              ${this.formatNumber(overdueCount)}\n            </div>\n            <div class=\"text-xs ${overdueCount > 0 ? 'text-red-600' : 'text-gray-500'} uppercase tracking-wide\">Overdue</div>\n          </div>\n          <div class=\"bg-green-50 rounded-lg p-2 text-center\">\n            <div class=\"text-lg font-bold text-green-700\">${this.formatNumber(summary.approved || 0)}</div>\n            <div class=\"text-xs text-green-600 uppercase tracking-wide\">Approved</div>\n          </div>\n        </div>\n\n        ${Object.keys(statusCounts).length > 0 ? `\n          <div class=\"mb-4 pt-3 border-t border-gray-100\">\n            <div class=\"text-xs text-gray-500 uppercase tracking-wide mb-2\">By Status</div>\n            <div class=\"flex flex-wrap gap-2\">\n              ${Object.entries(statusCounts).map(([status, count]) => statusBadge(status, count)).join('')}\n            </div>\n          </div>\n        ` : ''}\n\n        ${Object.keys(localeCounts).length > 0 ? `\n          <div class=\"mb-4 pt-3 border-t border-gray-100\">\n            <div class=\"text-xs text-gray-500 uppercase tracking-wide mb-2\">By Language</div>\n            <div class=\"flex flex-wrap gap-2\">\n              ${Object.entries(localeCounts).map(([locale, count]) => `\n                <span class=\"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-indigo-50 text-indigo-700\">\n                  <span class=\"uppercase font-semibold\">${locale}</span>\n                  <span class=\"text-indigo-500\">${this.formatNumber(count)}</span>\n                </span>\n              `).join('')}\n            </div>\n          </div>\n        ` : ''}\n\n        ${links.length > 0 ? `\n          <div class=\"pt-3 border-t border-gray-100\">\n            <div class=\"text-xs text-gray-500 uppercase tracking-wide mb-2\">Quick Access</div>\n            <div class=\"flex flex-wrap gap-2\">\n              ${links.map((link: { url?: string; label?: string }) => `\n                <a href=\"${link.url || '#'}\"\n                   class=\"inline-flex items-center gap-1 px-2.5 py-1.5 rounded-md text-xs font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition-colors\">\n                  ${link.label || 'Open'}\n                  <svg class=\"w-3 h-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/>\n                  </svg>\n                </a>\n              `).join('')}\n            </div>\n          </div>\n        ` : ''}\n\n        ${updatedAt ? `\n          <div class=\"mt-4 pt-2 border-t border-gray-100 text-xs text-gray-400 text-center\">\n            Updated <time data-relative-time=\"${updatedAt}\">${updatedAt}</time>\n          </div>\n        ` : ''}\n      `;\n    }\n\n    // Chart widgets (bar, line, pie, gauge, scatter) use canonical chart_options payload.\n    if (CHART_WIDGET_DEFINITIONS.has(def)) {\n      const subtitle = data.subtitle || config.subtitle || '';\n      const chartTheme = String(data.theme || 'westeros');\n      const assetsHost = String(data.chart_assets_host || '/dashboard/assets/echarts/');\n      const chartOptions = data.chart_options ? JSON.stringify(data.chart_options) : '';\n      const chartId = `chart-${widget.id || widget.definition || Math.random().toString(36).slice(2, 10)}`;\n      return `\n        <div>\n          ${subtitle ? `<p class=\"text-sm text-gray-500 mb-3\">${subtitle}</p>` : ''}\n          ${chartOptions ? `\n            <div class=\"chart-container\" data-echart-widget data-chart-id=\"${chartId}\" data-chart-theme=\"${chartTheme}\" data-chart-assets-host=\"${assetsHost}\">\n              <div id=\"${chartId}\" class=\"w-full\" style=\"height: 360px;\"></div>\n              <script type=\"application/json\" data-chart-options>${chartOptions}</script>\n            </div>\n          ` : `<p class=\"text-sm text-gray-500 italic\">Chart configuration unavailable.</p>`}\n          ${data.footer_note ? `<p class=\"text-xs text-gray-500 mt-2\">${data.footer_note}</p>` : ''}\n        </div>\n      `;\n    }\n\n    // Default: show raw data\n    return `<pre class=\"text-xs text-gray-600 overflow-auto\">${JSON.stringify(data, null, 2)}</pre>`;\n  }\n\n  /**\n   * Get display title for widget definition\n   */\n  private getTitle(definition: string): string {\n    return WIDGET_TITLES[definition] || definition;\n  }\n\n  /**\n   * Format number with locale\n   */\n  private formatNumber(value: unknown): string {\n    if (typeof value === 'number') {\n      return value.toLocaleString();\n    }\n    return String(value);\n  }\n\n  private formatStatusLabel(status: unknown): string {\n    const value = String(status || '').trim();\n    if (!value) {\n      return 'Unknown';\n    }\n    return value\n      .split('_')\n      .map((word) => (word ? word.charAt(0).toUpperCase() + word.slice(1) : word))\n      .join(' ');\n  }\n\n  private normalizeSpan(value: unknown): number {\n    const parsed = Number.parseInt(String(value ?? ''), 10);\n    if (!Number.isFinite(parsed) || parsed < 1 || parsed > 12) {\n      return 12;\n    }\n    return parsed;\n  }\n}\n","/**\n * Admin Dashboard - Client-side initialization and rendering\n */\n\nimport { WidgetGrid } from './widget-grid.js';\nimport { WidgetRenderer } from './widget-renderer.js';\nimport type { Widget, AdminDashboardConfig, DashboardResponse } from './types.js';\n\nconst chartScriptCache = new Map<string, Promise<void>>();\nconst chartResizeObservers = new WeakMap<HTMLElement, ResizeObserver>();\n\n/**\n * Initialize the admin dashboard\n */\nexport async function initAdminDashboard(config: AdminDashboardConfig): Promise<void> {\n  const renderer = new WidgetRenderer(config);\n  const dashboardApi = config.apiBasePath\n    ? `${config.apiBasePath}/dashboard`\n    : `${config.basePath}/api/dashboard`;\n\n  // Setup export button\n  const exportBtn = document.getElementById('dashboard-export');\n  if (exportBtn) {\n    exportBtn.addEventListener('click', () => window.open(dashboardApi));\n  }\n\n  // Fetch dashboard data\n  const response = await fetch(dashboardApi);\n  const data: DashboardResponse = await response.json();\n\n  // Group widgets by area\n  const widgetsByArea = groupWidgetsByArea(data.widgets || []);\n\n  // Render widgets in each area\n  for (const [areaCode, widgets] of Object.entries(widgetsByArea)) {\n    const container = document.querySelector(`[data-area-grid=\"${areaCode}\"]`);\n    if (container) {\n      container.innerHTML = widgets.map(w => renderer.render(w, areaCode)).join('');\n    }\n  }\n\n  await hydrateCharts();\n\n  // Initialize widget grid with drag & drop\n  const grid = new WidgetGrid({\n    apiEndpoint: dashboardApi,\n    preferencesEndpoint: `${dashboardApi}/preferences`,\n    areas: ['admin.dashboard.main', 'admin.dashboard.sidebar', 'admin.dashboard.footer'],\n    selectors: {\n      hideBtn: '.hide-widget',\n      resizeBtn: '.resize-widget',\n    },\n    onSave: (layout) => {\n      console.log('Layout saved:', layout);\n    },\n    onError: (error) => {\n      console.error('Widget grid error:', error);\n      const statusEl = document.getElementById('save-status');\n      if (statusEl) {\n        statusEl.textContent = 'Failed to save layout';\n      }\n    },\n  });\n\n  await grid.init();\n  await hydrateCharts();\n}\n\n/**\n * Group widgets by their area code\n */\nfunction groupWidgetsByArea(widgets: Widget[]): Record<string, Widget[]> {\n  return widgets.reduce((acc, widget) => {\n    const area = widget.area || 'admin.dashboard.main';\n    if (!acc[area]) {\n      acc[area] = [];\n    }\n    acc[area].push(widget);\n    return acc;\n  }, {} as Record<string, Widget[]>);\n}\n\nfunction normalizeChartAssetsHost(rawHost: string): string {\n  const trimmed = (rawHost || '').trim();\n  if (!trimmed) {\n    return '/dashboard/assets/echarts/';\n  }\n  return trimmed.endsWith('/') ? trimmed : `${trimmed}/`;\n}\n\nfunction ensureScript(src: string): Promise<void> {\n  if (!src) {\n    return Promise.resolve();\n  }\n  if (chartScriptCache.has(src)) {\n    return chartScriptCache.get(src)!;\n  }\n  const existing = document.querySelector(`script[src=\"${src}\"]`) as HTMLScriptElement | null;\n  if (existing) {\n    const done = Promise.resolve();\n    chartScriptCache.set(src, done);\n    return done;\n  }\n  const pending = new Promise<void>((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src = src;\n    script.async = true;\n    script.onload = () => resolve();\n    script.onerror = () => reject(new Error(`Failed to load chart asset: ${src}`));\n    document.head.appendChild(script);\n  });\n  chartScriptCache.set(src, pending);\n  return pending;\n}\n\nasync function ensureEChartsAssets(theme: string, assetsHost: string): Promise<void> {\n  const host = normalizeChartAssetsHost(assetsHost);\n  await ensureScript(`${host}echarts.min.js`);\n  if (theme && theme !== 'default') {\n    await ensureScript(`${host}themes/${theme}.js`);\n  }\n}\n\nfunction parseChartOptions(container: HTMLElement): Record<string, any> | null {\n  const payloadEl = container.querySelector('script[data-chart-options]');\n  if (!payloadEl?.textContent) {\n    return null;\n  }\n  try {\n    return JSON.parse(payloadEl.textContent);\n  } catch (error) {\n    console.error('[admin-dashboard] Failed to parse chart options', error);\n    return null;\n  }\n}\n\nfunction mountChart(container: HTMLElement): void {\n  const targetId = (container.dataset.chartId || '').trim();\n  const theme = (container.dataset.chartTheme || 'westeros').trim();\n  const options = parseChartOptions(container);\n  const target = targetId ? document.getElementById(targetId) : null;\n  const echarts = (window as any).echarts;\n  if (!target || !options || !echarts) {\n    return;\n  }\n\n  const chart = echarts.getInstanceByDom(target) || echarts.init(target, theme, { renderer: 'canvas' });\n  chart.setOption(options, true);\n\n  if (!chartResizeObservers.has(container) && window.ResizeObserver) {\n    const observer = new ResizeObserver(() => {\n      try {\n        chart.resize();\n      } catch (resizeError) {\n        console.warn('[admin-dashboard] Chart resize failed', resizeError);\n      }\n    });\n    observer.observe(target);\n    chartResizeObservers.set(container, observer);\n  }\n}\n\nasync function hydrateCharts(): Promise<void> {\n  const containers = Array.from(document.querySelectorAll<HTMLElement>('[data-echart-widget]'));\n  for (const container of containers) {\n    const theme = (container.dataset.chartTheme || 'westeros').trim();\n    const assetsHost = container.dataset.chartAssetsHost || '';\n    try {\n      await ensureEChartsAssets(theme, assetsHost);\n      mountChart(container);\n    } catch (error) {\n      console.error('[admin-dashboard] Failed to hydrate chart widget', error);\n    }\n  }\n}\n\n/**\n * Bootstrap dashboard from JSON config embedded in page\n */\nexport function bootstrapAdminDashboard(): void {\n  const configEl = document.getElementById('admin-dashboard-config');\n  if (!configEl?.textContent) {\n    console.error('[admin-dashboard] Missing #admin-dashboard-config element');\n    return;\n  }\n\n  try {\n    const config: AdminDashboardConfig = JSON.parse(configEl.textContent);\n    initAdminDashboard(config).catch(err => {\n      console.error('[admin-dashboard] Failed to initialize:', err);\n    });\n  } catch (err) {\n    console.error('[admin-dashboard] Invalid config JSON:', err);\n  }\n}\n"],"names":["DefaultDragDropBehavior","container","onDrop","widget","dragStartHandler","dragEndHandler","area","dragOverHandler","event","afterElement","dropHandler","cleanup","y","closest","child","box","offset","DefaultResizeBehavior","currentSpan","maxColumns","newSpan","span","DefaultVisibilityBehavior","newState","hidden","DefaultPersistenceBehavior","endpoint","layout","response","error","WidgetGrid","config","serverState","resolvedState","renderedAreaCodes","node","code","serverAreaCodes","missingFromServer","payload","detail","value","parsed","fallback","hideBtn","resizeBtn","btnText","textNode","btn","areaCode","visibleWidgets","w","hiddenWidgets","widgets","rows","currentRow","currentRowWidth","widgetId","message","WIDGET_TITLES","CHART_WIDGET_DEFINITIONS","WidgetRenderer","areaResizable","title","widgetContent","toolbarHTML","def","data","values","key","entries","val","entry","actions","action","notifications","notif","summary","statusCounts","localeCounts","links","overdueCount","updatedAt","statusBadge","statusRaw","count","status","toneClass","dotClass","label","locale","link","subtitle","chartTheme","assetsHost","chartOptions","chartId","definition","word","chartScriptCache","chartResizeObservers","initAdminDashboard","renderer","dashboardApi","exportBtn","widgetsByArea","groupWidgetsByArea","hydrateCharts","statusEl","acc","normalizeChartAssetsHost","rawHost","trimmed","ensureScript","src","done","pending","resolve","reject","script","ensureEChartsAssets","theme","host","parseChartOptions","payloadEl","mountChart","targetId","options","target","echarts","chart","observer","resizeError","containers","bootstrapAdminDashboard","configEl","err"],"mappings":"AAMO,MAAMA,EAAoD;AAAA,EAA1D,cAAA;AACL,SAAQ,iBAAqC,MAC7C,KAAQ,mBAAmC,CAAA;AAAA,EAAC;AAAA,EAE5C,OAAOC,GAAwBC,GAA0B;AAGvD,IAFgBD,EAAU,iBAA8B,eAAe,EAE/D,QAAQ,CAAAE,MAAU;AACxB,MAAAA,EAAO,YAAY;AAEnB,YAAMC,IAAmB,MAAM;AAC7B,aAAK,iBAAiBD,GACtBA,EAAO,UAAU,IAAI,UAAU;AAAA,MACjC,GAEME,IAAiB,MAAM;AAC3B,QAAAF,EAAO,UAAU,OAAO,UAAU,GAClC,KAAK,iBAAiB;AAAA,MACxB;AAEA,MAAAA,EAAO,iBAAiB,aAAaC,CAAgB,GACrDD,EAAO,iBAAiB,WAAWE,CAAc,GAEjD,KAAK,iBAAiB,KAAK,MAAM;AAC/B,QAAAF,EAAO,oBAAoB,aAAaC,CAAgB,GACxDD,EAAO,oBAAoB,WAAWE,CAAc;AAAA,MACtD,CAAC;AAAA,IACH,CAAC,GAEaJ,EAAU,iBAA8B,qBAAqB,EAErE,QAAQ,CAAAK,MAAQ;AACpB,YAAMC,IAAkB,CAACC,MAAqB;AAG5C,YAFAA,EAAM,eAAA,GAEF,CAAC,KAAK,eAAgB;AAE1B,cAAMC,IAAe,KAAK,oBAAoBH,GAAME,EAAM,OAAO;AAEjE,QAAIC,KAAgB,OAClBH,EAAK,YAAY,KAAK,cAAc,IAC3BG,MAAiB,KAAK,kBAC/BH,EAAK,aAAa,KAAK,gBAAgBG,CAAY;AAAA,MAEvD,GAEMC,IAAc,CAACF,MAAqB;AACxC,QAAAA,EAAM,eAAA,GACNN,EAAA;AAAA,MACF;AAEA,MAAAI,EAAK,iBAAiB,YAAYC,CAAe,GACjDD,EAAK,iBAAiB,QAAQI,CAAW,GAEzC,KAAK,iBAAiB,KAAK,MAAM;AAC/B,QAAAJ,EAAK,oBAAoB,YAAYC,CAAe,GACpDD,EAAK,oBAAoB,QAAQI,CAAW;AAAA,MAC9C,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA,EAEA,UAAgB;AACd,SAAK,iBAAiB,QAAQ,CAAAC,MAAWA,EAAA,CAAS,GAClD,KAAK,mBAAmB,CAAA,GACxB,KAAK,iBAAiB;AAAA,EACxB;AAAA,EAEQ,oBAAoBV,GAAwBW,GAA+B;AAKjF,WAJ0B,MAAM;AAAA,MAC9BX,EAAU,iBAA8B,8BAA8B;AAAA,IAAA,EAG/C;AAAA,MACvB,CAACY,GAASC,MAAU;AAClB,cAAMC,IAAMD,EAAM,sBAAA,GACZE,IAASJ,IAAIG,EAAI,MAAMA,EAAI,SAAS;AAE1C,eAAIC,IAAS,KAAKA,IAASH,EAAQ,SAC1B,EAAE,QAAAG,GAAQ,SAASF,EAAA,IAEnBD;AAAA,MAEX;AAAA,MACA,EAAE,QAAQ,OAAO,mBAAmB,SAAS,KAAA;AAAA,IAAK,EAClD;AAAA,EACJ;AACF;ACtFO,MAAMI,EAAgD;AAAA,EAC3D,YAAYd,GAAqBe,GAAqBC,GAA4B;AAEhF,UAAMC,IAAUF,MAAgBC,IAAaA,IAAa,IAAIA;AAC9D,gBAAK,WAAWhB,GAAQiB,CAAO,GACxBA;AAAA,EACT;AAAA,EAEA,WAAWjB,GAAqBkB,GAAoB;AAClD,IAAAlB,EAAO,QAAQ,OAAOkB,EAAK,SAAA,GAC3BlB,EAAO,MAAM,YAAY,UAAUkB,EAAK,UAAU;AAAA,EACpD;AACF;ACZO,MAAMC,EAAwD;AAAA,EACnE,OAAOnB,GAA8B;AAEnC,UAAMoB,IAAW,EADApB,EAAO,QAAQ,WAAW;AAE3C,gBAAK,gBAAgBA,GAAQoB,CAAQ,GAC9BA;AAAA,EACT;AAAA,EAEA,gBAAgBpB,GAAqBqB,GAAuB;AAC1D,IAAIA,KACFrB,EAAO,QAAQ,SAAS,QACxBA,EAAO,UAAU,IAAI,WAAW,MAEhC,OAAOA,EAAO,QAAQ,QACtBA,EAAO,UAAU,OAAO,WAAW;AAAA,EAEvC;AACF;ACjBO,MAAMsB,EAA0D;AAAA,EACrE,MAAM,KAAKC,GAAkBC,GAA0C;AACrE,UAAMC,IAAW,MAAM,MAAMF,GAAU;AAAA,MACrC,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,MAAA;AAAA,MAElB,MAAM,KAAK,UAAUC,CAAM;AAAA,IAAA,CAC5B;AAED,QAAI,CAACC,EAAS;AACZ,YAAM,IAAI,MAAM,0BAA0BA,EAAS,UAAU,EAAE;AAAA,EAEnE;AAAA,EAEA,MAAM,KAAKF,GAAqD;AAC9D,QAAI;AACF,YAAME,IAAW,MAAM,MAAMF,CAAQ;AACrC,aAAKE,EAAS,KAGP,MAAMA,EAAS,KAAA,IAFb;AAAA,IAGX,SAASC,GAAO;AACd,qBAAQ,KAAK,sCAAsCA,CAAK,GACjD;AAAA,IACT;AAAA,EACF;AACF;ACfO,MAAMC,EAAW;AAAA,EAStB,YAAYC,GAA0B;AANtC,SAAQ,YAAgC,MACxC,KAAQ,YAA2B,MACnC,KAAQ,gBAAoC,MAC5C,KAAQ,cAA0C,MAClD,KAAQ,YAAmB,CAAA,GAGzB,KAAK,SAAS;AAAA,MACZ,aAAaA,EAAO;AAAA,MACpB,qBAAqBA,EAAO,uBAAuB,GAAGA,EAAO,WAAW;AAAA,MACxE,OAAOA,EAAO,SAAS,CAAA;AAAA,MACvB,aAAaA,EAAO,eAAe;AAAA,MACnC,YAAYA,EAAO,cAAc;AAAA,MACjC,WAAWA,EAAO,aAAa;AAAA,MAC/B,WAAW;AAAA,QACT,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS;AAAA,QACT,SAAS;AAAA,QACT,WAAW;AAAA,QACX,GAAGA,EAAO;AAAA,MAAA;AAAA,MAEZ,WAAWA,EAAO,aAAa,CAAA;AAAA,MAC/B,QAAQA,EAAO,WAAW,MAAM;AAAA,MAAC;AAAA,MACjC,SAASA,EAAO,YAAY,CAACF,MAAU,QAAQ,MAAM,qBAAqBA,CAAK;AAAA,IAAA,GAGjF,KAAK,YAAY;AAAA,MACf,UAAUE,EAAO,WAAW,YAAY,IAAI/B,EAAA;AAAA,MAC5C,QAAQ+B,EAAO,WAAW,UAAU,IAAId,EAAA;AAAA,MACxC,YAAYc,EAAO,WAAW,cAAc,IAAIT,EAAA;AAAA,MAChD,aAAaS,EAAO,WAAW,eAAe,IAAIN,EAAA;AAAA,IAA2B;AAAA,EAEjF;AAAA,EAEA,MAAM,KAAKO,GAAkC;AAI3C,QAHA,KAAK,YAAY,SAAS,cAAc,oBAAoB,GAC5D,KAAK,gBAAgB,SAAS,eAAe,aAAa,GAEtD,CAAC,KAAK;AACR,YAAM,IAAI,MAAM,iCAAiC;AAGnD,UAAMC,IAAgB,KAAK,0BAA0BD,CAAW;AAChE,IAAIC,EAAc,WAChB,KAAK,cAAcA,EAAc,QACjC,KAAK,YAAYA,EAAc,OAAO,QAAQ,CAAA,IAKhD,KAAK,6BAAA,GACL,KAAK,qBAAA,GACL,KAAK,mBAAA,GAGDA,EAAc,QAChB,KAAK,kBAAkBA,EAAc,IAAI;AAAA,EAE7C;AAAA,EAEQ,kBAAkBD,GAAwB;AAChD,QAAI,CAAC,MAAM,QAAQA,GAAa,KAAK,KAAK,CAAC,KAAK;AAC9C;AAIF,UAAME,IAAoB,MAAM;AAAA,MAC9B,KAAK,UAAU,iBAA8B,qCAAqC;AAAA,IAAA,EAEjF,IAAI,CAACC,MAASA,EAAK,QAAQ,YAAYA,EAAK,QAAQ,YAAY,EAAE,EAClE,OAAO,CAACC,MAAyB,EAAQA,CAAK;AAEjD,QAAIF,EAAkB,WAAW;AAC/B;AAGF,UAAMG,IAAkB,IAAI;AAAA,MAC1BL,EAAY,MACT,IAAI,CAAC1B,MAAcA,GAAM,QAAQA,GAAM,aAAaA,GAAM,MAAM,EAAE,EAClE,OAAO,CAAC8B,MAAkC,OAAOA,KAAS,YAAYA,EAAK,SAAS,CAAC;AAAA,IAAA,GAGpFE,IAAoBJ,EAAkB,OAAO,CAACE,MAAS,CAACC,EAAgB,IAAID,CAAI,CAAC;AACvF,IAAIE,EAAkB,SAAS,KAC7B,QAAQ,KAAK,kEAAkE;AAAA,MAC7E,SAASA;AAAA,MACT,QAAQ,MAAM,KAAKD,CAAe;AAAA,MAClC,KAAKH;AAAA,IAAA,CACN;AAAA,EAEL;AAAA,EAEA,YAAwC;AACtC,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,UAAiB;AACf,WAAO,KAAK;AAAA,EACd;AAAA,EAEQ,0BAA0BK,GAA4D;AAC5F,QAAI,CAACA;AACH,aAAO,CAAA;AAET,QAAIA,KAAW,OAAOA,KAAY,YAAY,UAAUA,GAAS;AAC/D,YAAMC,IAASD;AACf,aAAO;AAAA,QACL,MAAMC,EAAO;AAAA,QACb,QAAQA,EAAO;AAAA,MAAA;AAAA,IAEnB;AACA,WAAO,EAAE,MAAMD,EAAA;AAAA,EACjB;AAAA,EAEQ,qBAA2B;AACjC,IAAK,KAAK,aAEV,KAAK,UAAU,SAAS,OAAO,KAAK,WAAW,MAAM;AACnD,WAAK,WAAA;AAAA,IACP,CAAC;AAAA,EACH;AAAA,EAEQ,+BAAqC;AAC3C,IAAK,KAAK,aAEV,KAAK,UAAU,iBAA8B,eAAe,EAAE,QAAQ,CAACpC,MAAW;AAChF,YAAMkB,IAAO,KAAK,cAAclB,EAAO,QAAQ,IAAI;AACnD,MAAAA,EAAO,QAAQ,OAAOkB,EAAK,SAAA,GAC3BlB,EAAO,MAAM,YAAY,UAAUkB,EAAK,UAAU;AAAA,IACpD,CAAC;AAAA,EACH;AAAA,EAEQ,cAAcoB,GAAwB;AAC5C,UAAMC,IAAS,OAAO,SAAS,OAAOD,KAAS,EAAE,GAAG,EAAE,GAChDE,IAAW,KAAK,IAAI,KAAK,IAAI,KAAK,OAAO,aAAa,CAAC,GAAG,KAAK,OAAO,UAAU;AACtF,WAAI,CAAC,OAAO,SAASD,CAAM,KAAKA,IAAS,KAAKA,IAAS,KAAK,OAAO,aAC1DC,IAEFD;AAAA,EACT;AAAA,EAEQ,uBAA6B;AACnC,IAAK,KAAK,cAGV,KAAK,UAAU,iBAAiB,SAAS,CAAClC,MAAiB;AAEzD,YAAMoC,IADSpC,EAAM,OACE,QAAqB,KAAK,OAAO,UAAU,OAAQ;AAE1E,UAAIoC,GAAS;AACX,cAAMzC,IAASyC,EAAQ,QAAqB,eAAe;AAC3D,QAAIzC,MACF,KAAK,UAAU,WAAW,OAAOA,CAAM,GACvC,KAAK,WAAA;AAAA,MAET;AAAA,IACF,CAAC,GAGD,KAAK,UAAU,iBAAiB,SAAS,CAACK,MAAiB;AAEzD,YAAMqC,IADSrC,EAAM,OACI,QAAqB,KAAK,OAAO,UAAU,SAAU;AAE9E,UAAIqC,GAAW;AACb,cAAM1C,IAAS0C,EAAU,QAAqB,eAAe;AAC7D,YAAI1C,GAAQ;AACV,gBAAMe,IAAc,KAAK,cAAcf,EAAO,QAAQ,IAAI,GAIpD2C,IAHU,KAAK,UAAU,OAAO,YAAY3C,GAAQe,GAAa,KAAK,OAAO,UAAU,MAGjE,KAAK,OAAO,aAAa,eAAe,cAC9D6B,IAAW,MAAM,KAAKF,EAAU,UAAU,EAAE,KAAK,CAAAV,MAAQA,EAAK,aAAa,KAAK,SAAS;AAC/F,UAAIY,MACFA,EAAS,cAAcD,IAGzB,KAAK,WAAA;AAAA,QACP;AAAA,MACF;AAAA,IACF,CAAC,GAGD,KAAK,UAAU,iBAA8B,KAAK,OAAO,UAAU,SAAU,EAAE,QAAQ,CAAAE,MAAO;AAC5F,YAAM7C,IAAS6C,EAAI,QAAqB,eAAe;AACvD,UAAI7C,GAAQ;AAEV,cAAM2C,IADO,KAAK,cAAc3C,EAAO,QAAQ,IAAI,MAC1B,KAAK,OAAO,aAAa,eAAe,cAC3D4C,IAAW,MAAM,KAAKC,EAAI,UAAU,EAAE,KAAK,CAAAb,MAAQA,EAAK,aAAa,KAAK,SAAS;AACzF,QAAIY,MACFA,EAAS,cAAcD;AAAA,MAE3B;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEQ,aAAmB;AACzB,IAAI,KAAK,cAAc,QACrB,aAAa,KAAK,SAAS,GAG7B,KAAK,aAAa,gBAAgB,GAElC,KAAK,YAAY,OAAO,WAAW,YAAY;AAC7C,UAAI;AACF,cAAMnB,IAAS,KAAK,gBAAA;AACpB,cAAM,KAAK,UAAU,YAAY,KAAK,KAAK,OAAO,qBAAqBA,CAAM,GAC7E,KAAK,aAAa,cAAc,GAChC,KAAK,OAAO,OAAOA,CAAM;AAAA,MAC3B,SAASE,GAAO;AACd,aAAK,aAAa,aAAa,GAC/B,KAAK,OAAO,QAAQA,CAAc;AAAA,MACpC;AAAA,IACF,GAAG,KAAK,OAAO,SAAS;AAAA,EAC1B;AAAA,EAEQ,kBAAqC;AAC3C,UAAMF,IAA4B;AAAA,MAChC,YAAY,CAAA;AAAA,MACZ,mBAAmB,CAAA;AAAA,MACnB,aAAa,CAAA;AAAA,IAAC;AAGhB,QAAI,CAAC,KAAK,UAAW,QAAOA;AAK5B,IAFc,KAAK,UAAU,iBAA8B,KAAK,OAAO,UAAU,KAAM,EAEjF,QAAQ,CAAArB,MAAQ;AACpB,YAAM2C,IAAW3C,EAAK,QAAQ,YAAYA,EAAK,QAAQ;AACvD,UAAI,CAAC2C,EAAU;AAEf,YAAMC,IAAiB,MAAM;AAAA,QAC3B5C,EAAK,iBAA8B,yCAAyC;AAAA,MAAA;AAG9E,MAAAqB,EAAO,WAAWsB,CAAQ,IAAIC,EAAe,IAAI,CAAAC,MAAKA,EAAE,QAAQ,MAAO,GACvExB,EAAO,YAAYsB,CAAQ,IAAI,KAAK,cAAcC,CAAc;AAAA,IAClE,CAAC;AAGD,UAAME,IAAgB,KAAK,UAAU,iBAA8B,mCAAmC;AACtG,WAAAzB,EAAO,oBAAoB,MAAM,KAAKyB,CAAa,EAAE,IAAI,CAAAD,MAAKA,EAAE,QAAQ,MAAO,GAExExB;AAAA,EACT;AAAA,EAEQ,cAAc0B,GAA2C;AAC/D,UAAMC,IAA0B,CAAA;AAChC,QAAIC,IAA8C,CAAA,GAC9CC,IAAkB;AAEtB,WAAAH,EAAQ,QAAQ,CAAAlD,MAAU;AACxB,YAAMsD,IAAWtD,EAAO,QAAQ,QAC1BkB,IAAO,KAAK,cAAclB,EAAO,QAAQ,IAAI;AAEnD,MAAIqD,IAAkBnC,IAAO,KAAK,OAAO,cAAcmC,IAAkB,MACvEF,EAAK,KAAK,EAAE,SAASC,EAAA,CAAY,GACjCA,IAAa,CAAA,GACbC,IAAkB,IAGpBD,EAAW,KAAK,EAAE,IAAIE,GAAU,OAAOpC,GAAM,GAC7CmC,KAAmBnC,GAEfmC,KAAmB,KAAK,OAAO,eACjCF,EAAK,KAAK,EAAE,SAASC,EAAA,CAAY,GACjCA,IAAa,CAAA,GACbC,IAAkB;AAAA,IAEtB,CAAC,GAEGD,EAAW,SAAS,KACtBD,EAAK,KAAK,EAAE,SAASC,EAAA,CAAY,GAG5BD;AAAA,EACT;AAAA,EAEQ,aAAaI,GAAuB;AAC1C,IAAI,KAAK,kBACP,KAAK,cAAc,cAAcA;AAAA,EAErC;AAAA,EAEA,UAAgB;AACd,IAAI,KAAK,cAAc,QACrB,aAAa,KAAK,SAAS,GAE7B,KAAK,UAAU,SAAS,QAAA;AAAA,EAC1B;AACF;ACjTA,MAAMC,IAAgC;AAAA,EACpC,2BAA2B;AAAA,EAC3B,8BAA8B;AAAA,EAC9B,8BAA8B;AAAA,EAC9B,8BAA8B;AAAA,EAC9B,kCAAkC;AAAA,EAClC,qCAAqC;AAAA,EACrC,8BAA8B;AAAA,EAC9B,8BAA8B;AAAA,EAC9B,8BAA8B;AAAA,EAC9B,0BAA0B;AAAA,EAC1B,2BAA2B;AAAA,EAC3B,0BAA0B;AAAA,EAC1B,4BAA4B;AAAA,EAC5B,8BAA8B;AAChC,GAEMC,wBAA+B,IAAI;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,CAAC;AAKM,MAAMC,EAAe;AAAA,EAG1B,YAAY9B,GAA8B;AACxC,SAAK,uBAAuBA,EAAO,wBAAwB,CAAA;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO5B,GAAgB8C,GAA0B;AAC/C,UAAMa,IAAgBb,MAAa,0BAA0BA,MAAa,0BACpE5B,IAAO,KAAK,cAAclB,EAAO,UAAU,QAAQ,SAASA,EAAO,IAAI,GACvEqB,IAASrB,EAAO,UAAU,IAC1B4D,IAAQ5D,EAAO,MAAM,SAASA,EAAO,QAAQ,SAAS,KAAK,SAASA,EAAO,UAAU,GACrFsD,IAAWtD,EAAO,MAAMA,EAAO,cAAc,UAAU,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC,IAC9F6D,IAAgB,KAAK,cAAc7D,CAAM;AAG/C,QAAI8D,IAAc;AAClB,WAAAA,KAAe,kEAEXH,IACFG,KAAe,oEAEfA,KAAe,gIAGjBA,KAAe,UAER;AAAA;AAAA,8BAEmBR,CAAQ;AAAA,4BACVpC,CAAI;AAAA,iCACC4B,CAAQ;AAAA,iCACRa,CAAa;AAAA,iBAC7BtC,IAAS,uBAAuB,EAAE;AAAA,gCACnBH,CAAI;AAAA,UAC1B4C,CAAW;AAAA;AAAA,4DAEuCF,CAAK;AAAA;AAAA;AAAA,YAGrDC,CAAa;AAAA;AAAA;AAAA;AAAA,EAIvB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc7D,GAAwB;AACpC,UAAM+D,IAAM/D,EAAO,cAAc,IAC3BgE,IAAOhE,EAAO,QAAQ,CAAA,GACtB4B,IAAS5B,EAAO,UAAU,CAAA;AAGhC,QAAI+D,MAAQ,2BAA2B;AACrC,YAAME,IAAkC;AAAA,QACtC,OAAOD,EAAK,SAAS;AAAA,QACrB,QAAQA,EAAK,UAAU;AAAA,QACvB,aAAaA,EAAK,aAAa;AAAA,MAAA;AAEjC,aAAIA,EAAK,UACPC,EAAO,QAAQD,EAAK,QAEf;AAAA;AAAA,YAED,OAAO,QAAQC,CAAM,EAAE,IAAI,CAAC,CAACC,GAAK5B,CAAK,MAAM;AAAA;AAAA,uBAElC4B,CAAG;AAAA,sBACJ,KAAK,aAAa5B,CAAK,CAAC;AAAA;AAAA,WAEnC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,IAGjB;AAGA,QAAIyB,MAAQ,sCAAsC;AAChD,YAAME,IAASD,EAAK,UAAU,CAAA,GACxBG,IAAU,OAAO,QAAQF,CAAM;AACrC,aAAIE,EAAQ,WAAW,IACd,4DAEF;AAAA;AAAA,YAEDA,EAAQ,IAAI,CAAC,CAACD,GAAKE,CAAG,MAAM;AAAA;AAAA,kDAEUF,CAAG;AAAA,gEACWE,KAAO,GAAG;AAAA;AAAA,WAE/D,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,IAGjB;AAGA,QAAIL,MAAQ,kCAAkC;AAC5C,YAAME,IAASD,EAAK,UAAU,CAAA,GACxBG,IAAU,OAAO,QAAQF,CAAM;AACrC,aAAIE,EAAQ,WAAW,IACd,wDAEF;AAAA;AAAA,YAEDA,EAAQ,IAAI,CAAC,CAACD,GAAKE,CAAG,MAAM;AAC5B,cAAM9B,IAAQ,OAAO8B,KAAQ,YAAYA,MAAQ,OAAQA,EAAgC,SAASA,IAAMA;AACxG,eAAO;AAAA;AAAA,oDAEiCF,CAAG;AAAA,kEACW5B,KAAS,GAAG;AAAA;AAAA;AAAA,MAGpE,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,IAGjB;AAGA,QAAIyB,MAAQ,8BAA8B;AACxC,YAAMI,IAAUH,EAAK,WAAW,CAAA;AAChC,aAAIG,EAAQ,WAAW,IACd,oDAEF;AAAA;AAAA,YAEDA,EAAQ,IAAI,CAACE,MAA6D;AAAA;AAAA,iEAErBA,EAAM,KAAK;AAAA,wDACpB,KAAK,uBAAuBA,EAAM,MAAM,KAAKA,EAAM,MAAM,IAAIA,EAAM,MAAM;AAAA;AAAA,WAEtH,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,IAGjB;AAGA,QAAIN,MAAQ,8BAA8B;AACxC,YAAMO,IAAUN,EAAK,WAAW,CAAA;AAChC,aAAIM,EAAQ,WAAW,IACd,6DAEF;AAAA;AAAA,YAEDA,EAAQ,IAAI,CAACC,MAAoF;AAAA,gIACmBA,EAAO,OAAO,GAAG;AAAA;AAAA,mEAE9EA,EAAO,SAAS,QAAQ;AAAA,kBACzEA,EAAO,SAAS,qEAAqEA,EAAO,MAAM,YAAY,EAAE;AAAA;AAAA,gBAElHA,EAAO,cAAc,2CAA2CA,EAAO,WAAW,WAAW,EAAE;AAAA;AAAA,WAEpG,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,IAGjB;AAGA,QAAIR,MAAQ,+BACNC,EAAK;AACP,aAAO;AAKX,QAAID,MAAQ;AACV,aAAO;AAAA;AAAA;AAAA;AAAA,yDAI4CC,EAAK,UAAU,SAAS;AAAA;AAAA;AAAA;AAAA,0CAIvCA,EAAK,UAAU,KAAK;AAAA;AAAA;AAAA;AAAA,0CAIpBA,EAAK,eAAe,KAAK;AAAA;AAAA;AAAA;AAAA,yCAI1BA,EAAK,cAAc,cAAc,mBAAmB,cAAc,KAAKA,EAAK,aAAa,SAAS;AAAA;AAAA;AAAA;AAOvI,QAAID,MAAQ;AACV,aAAO;AAAA;AAAA;AAAA;AAAA,oBAIO,KAAK,aAAaC,EAAK,aAAa,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,oBAItC,KAAK,aAAaA,EAAK,SAAS,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,oBAIlC,KAAK,aAAaA,EAAK,aAAa,CAAC,CAAC;AAAA;AAAA;AAAA;AAOtD,QAAID,MAAQ;AACV,aAAO;AAAA;AAAA;AAAA;AAAA,oBAIOC,EAAK,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA,oBAInBA,EAAK,SAAS,MAAM;AAAA;AAAA;AAAA;AAAA,oBAIpBA,EAAK,cAAc,IAAI;AAAA;AAAA;AAAA;AAOvC,QAAID,MAAQ,8BAA8B;AACxC,YAAMS,IAAgBR,EAAK,iBAAiB,CAAA;AAC5C,aAAIQ,EAAc,WAAW,IACpB,kDAEF;AAAA;AAAA,YAEDA,EAAc,MAAM,GAAG,CAAC,EAAE,IAAI,CAACC,MAA6D;AAAA;AAAA;AAAA;AAAA,qEAInCA,EAAM,KAAK;AAAA,4DACpBA,EAAM,OAAO;AAAA;AAAA,+DAEVA,EAAM,OAAO,8BAA8B,wBAAwB;AAAA,oBAC9GA,EAAM,OAAO,SAAS,KAAK;AAAA;AAAA;AAAA;AAAA,WAIpC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,IAGjB;AAGA,QAAIV,MAAQ,qCAAqC;AAC/C,YAAMW,IAAUV,EAAK,WAAW,CAAA,GAC1BW,IAAwCX,EAAK,iBAAiB,CAAA,GAC9DY,IAAwCZ,EAAK,iBAAiB,CAAA,GAC9Da,IAAQ,MAAM,QAAQb,EAAK,KAAK,IAAIA,EAAK,QAAQ,CAAA,GACjDc,IAAe,OAAOJ,EAAQ,WAAW,CAAC,GAC1CK,IAAYf,EAAK,aAAa,OAAOA,EAAK,UAAU,IAAI,IAExDgB,IAAc,CAACC,GAAmBC,MAA2B;AACjE,cAAMC,IAAS,OAAOF,KAAa,EAAE,EAAE,KAAA,EAAO,YAAA;AAC9C,YAAIG,IAAY,6BACZC,IAAW;AACf,QAAIF,MAAW,aACbC,IAAY,iCACZC,IAAW,mBACFF,MAAW,iBACpBC,IAAY,6BACZC,IAAW,iBACFF,MAAW,YACpBC,IAAY,iCACZC,IAAW,mBACFF,MAAW,cAAcA,MAAW,eAC7CC,IAAY,+BACZC,IAAW,kBACFF,MAAW,eACpBC,IAAY,2BACZC,IAAW;AAEb,cAAMC,IAAQ,KAAK,kBAAkBL,CAAS;AAC9C,eAAO;AAAA,uGACwFG,CAAS;AAAA,oDAC5DC,CAAQ;AAAA,cAC9CC,CAAK,KAAK,KAAK,aAAaJ,CAAK,CAAC;AAAA;AAAA;AAAA,MAG1C;AAEA,aAAO;AAAA;AAAA;AAAA,4DAG+C,KAAK,aAAaR,EAAQ,SAAS,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,4DAIrC,KAAK,aAAaA,EAAQ,UAAU,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,8DAIpC,KAAK,aAAaA,EAAQ,UAAU,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAM5EI,IAAe,IAAI,cAAc,YAAY;AAAA,4CACzBA,IAAe,IAAI,iBAAiB,eAAe;AAAA,gBAC/E,KAAK,aAAaA,CAAY,CAAC;AAAA;AAAA,kCAEbA,IAAe,IAAI,iBAAiB,eAAe;AAAA;AAAA;AAAA,4DAGzB,KAAK,aAAaJ,EAAQ,YAAY,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,UAK1F,OAAO,KAAKC,CAAY,EAAE,SAAS,IAAI;AAAA;AAAA;AAAA;AAAA,gBAIjC,OAAO,QAAQA,CAAY,EAAE,IAAI,CAAC,CAACQ,GAAQD,CAAK,MAAMF,EAAYG,GAAQD,CAAK,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,YAG9F,EAAE;AAAA;AAAA,UAEJ,OAAO,KAAKN,CAAY,EAAE,SAAS,IAAI;AAAA;AAAA;AAAA;AAAA,gBAIjC,OAAO,QAAQA,CAAY,EAAE,IAAI,CAAC,CAACW,GAAQL,CAAK,MAAM;AAAA;AAAA,0DAEZK,CAAM;AAAA,kDACd,KAAK,aAAaL,CAAK,CAAC;AAAA;AAAA,eAE3D,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,YAGb,EAAE;AAAA;AAAA,UAEJL,EAAM,SAAS,IAAI;AAAA;AAAA;AAAA;AAAA,gBAIbA,EAAM,IAAI,CAACW,MAA2C;AAAA,2BAC3CA,EAAK,OAAO,GAAG;AAAA;AAAA,oBAEtBA,EAAK,SAAS,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,eAKzB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,YAGb,EAAE;AAAA;AAAA,UAEJT,IAAY;AAAA;AAAA,gDAE0BA,CAAS,KAAKA,CAAS;AAAA;AAAA,YAE3D,EAAE;AAAA;AAAA,IAEV;AAGA,QAAItB,EAAyB,IAAIM,CAAG,GAAG;AACrC,YAAM0B,IAAWzB,EAAK,YAAYpC,EAAO,YAAY,IAC/C8D,IAAa,OAAO1B,EAAK,SAAS,UAAU,GAC5C2B,IAAa,OAAO3B,EAAK,qBAAqB,4BAA4B,GAC1E4B,IAAe5B,EAAK,gBAAgB,KAAK,UAAUA,EAAK,aAAa,IAAI,IACzE6B,IAAU,SAAS7F,EAAO,MAAMA,EAAO,cAAc,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,GAAG,EAAE,CAAC;AAClG,aAAO;AAAA;AAAA,YAEDyF,IAAW,yCAAyCA,CAAQ,SAAS,EAAE;AAAA,YACvEG,IAAe;AAAA,6EACkDC,CAAO,uBAAuBH,CAAU,6BAA6BC,CAAU;AAAA,yBACnIE,CAAO;AAAA,mEACmCD,CAAY;AAAA;AAAA,cAEjE,8EAA8E;AAAA,YAChF5B,EAAK,cAAc,yCAAyCA,EAAK,WAAW,SAAS,EAAE;AAAA;AAAA;AAAA,IAG/F;AAGA,WAAO,oDAAoD,KAAK,UAAUA,GAAM,MAAM,CAAC,CAAC;AAAA,EAC1F;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAS8B,GAA4B;AAC3C,WAAOtC,EAAcsC,CAAU,KAAKA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAaxD,GAAwB;AAC3C,WAAI,OAAOA,KAAU,WACZA,EAAM,eAAA,IAER,OAAOA,CAAK;AAAA,EACrB;AAAA,EAEQ,kBAAkB6C,GAAyB;AACjD,UAAM7C,IAAQ,OAAO6C,KAAU,EAAE,EAAE,KAAA;AACnC,WAAK7C,IAGEA,EACJ,MAAM,GAAG,EACT,IAAI,CAACyD,MAAUA,KAAOA,EAAK,OAAO,CAAC,EAAE,YAAA,IAAgBA,EAAK,MAAM,CAAC,CAAS,EAC1E,KAAK,GAAG,IALF;AAAA,EAMX;AAAA,EAEQ,cAAczD,GAAwB;AAC5C,UAAMC,IAAS,OAAO,SAAS,OAAOD,KAAS,EAAE,GAAG,EAAE;AACtD,WAAI,CAAC,OAAO,SAASC,CAAM,KAAKA,IAAS,KAAKA,IAAS,KAC9C,KAEFA;AAAA,EACT;AACF;ACzcA,MAAMyD,wBAAuB,IAAA,GACvBC,wBAA2B,QAAA;AAKjC,eAAsBC,EAAmBtE,GAA6C;AACpF,QAAMuE,IAAW,IAAIzC,EAAe9B,CAAM,GACpCwE,IAAexE,EAAO,cACxB,GAAGA,EAAO,WAAW,eACrB,GAAGA,EAAO,QAAQ,kBAGhByE,IAAY,SAAS,eAAe,kBAAkB;AAC5D,EAAIA,KACFA,EAAU,iBAAiB,SAAS,MAAM,OAAO,KAAKD,CAAY,CAAC;AAKrE,QAAMpC,IAA0B,OADf,MAAM,MAAMoC,CAAY,GACM,KAAA,GAGzCE,IAAgBC,EAAmBvC,EAAK,WAAW,CAAA,CAAE;AAG3D,aAAW,CAAClB,GAAUI,CAAO,KAAK,OAAO,QAAQoD,CAAa,GAAG;AAC/D,UAAMxG,IAAY,SAAS,cAAc,oBAAoBgD,CAAQ,IAAI;AACzE,IAAIhD,MACFA,EAAU,YAAYoD,EAAQ,IAAI,CAAAF,MAAKmD,EAAS,OAAOnD,GAAGF,CAAQ,CAAC,EAAE,KAAK,EAAE;AAAA,EAEhF;AAEA,QAAM0D,EAAA,GAuBN,MApBa,IAAI7E,EAAW;AAAA,IAC1B,aAAayE;AAAA,IACb,qBAAqB,GAAGA,CAAY;AAAA,IACpC,OAAO,CAAC,wBAAwB,2BAA2B,wBAAwB;AAAA,IACnF,WAAW;AAAA,MACT,SAAS;AAAA,MACT,WAAW;AAAA,IAAA;AAAA,IAEb,QAAQ,CAAC5E,MAAW;AAClB,cAAQ,IAAI,iBAAiBA,CAAM;AAAA,IACrC;AAAA,IACA,SAAS,CAACE,MAAU;AAClB,cAAQ,MAAM,sBAAsBA,CAAK;AACzC,YAAM+E,IAAW,SAAS,eAAe,aAAa;AACtD,MAAIA,MACFA,EAAS,cAAc;AAAA,IAE3B;AAAA,EAAA,CACD,EAEU,KAAA,GACX,MAAMD,EAAA;AACR;AAKA,SAASD,EAAmBrD,GAA6C;AACvE,SAAOA,EAAQ,OAAO,CAACwD,GAAK1G,MAAW;AACrC,UAAMG,IAAOH,EAAO,QAAQ;AAC5B,WAAK0G,EAAIvG,CAAI,MACXuG,EAAIvG,CAAI,IAAI,CAAA,IAEduG,EAAIvG,CAAI,EAAE,KAAKH,CAAM,GACd0G;AAAA,EACT,GAAG,CAAA,CAA8B;AACnC;AAEA,SAASC,EAAyBC,GAAyB;AACzD,QAAMC,KAAWD,KAAW,IAAI,KAAA;AAChC,SAAKC,IAGEA,EAAQ,SAAS,GAAG,IAAIA,IAAU,GAAGA,CAAO,MAF1C;AAGX;AAEA,SAASC,EAAaC,GAA4B;AAChD,MAAI,CAACA;AACH,WAAO,QAAQ,QAAA;AAEjB,MAAIf,EAAiB,IAAIe,CAAG;AAC1B,WAAOf,EAAiB,IAAIe,CAAG;AAGjC,MADiB,SAAS,cAAc,eAAeA,CAAG,IAAI,GAChD;AACZ,UAAMC,IAAO,QAAQ,QAAA;AACrB,WAAAhB,EAAiB,IAAIe,GAAKC,CAAI,GACvBA;AAAA,EACT;AACA,QAAMC,IAAU,IAAI,QAAc,CAACC,GAASC,MAAW;AACrD,UAAMC,IAAS,SAAS,cAAc,QAAQ;AAC9C,IAAAA,EAAO,MAAML,GACbK,EAAO,QAAQ,IACfA,EAAO,SAAS,MAAMF,EAAA,GACtBE,EAAO,UAAU,MAAMD,EAAO,IAAI,MAAM,+BAA+BJ,CAAG,EAAE,CAAC,GAC7E,SAAS,KAAK,YAAYK,CAAM;AAAA,EAClC,CAAC;AACD,SAAApB,EAAiB,IAAIe,GAAKE,CAAO,GAC1BA;AACT;AAEA,eAAeI,EAAoBC,GAAe3B,GAAmC;AACnF,QAAM4B,IAAOZ,EAAyBhB,CAAU;AAChD,QAAMmB,EAAa,GAAGS,CAAI,gBAAgB,GACtCD,KAASA,MAAU,aACrB,MAAMR,EAAa,GAAGS,CAAI,UAAUD,CAAK,KAAK;AAElD;AAEA,SAASE,EAAkB1H,GAAoD;AAC7E,QAAM2H,IAAY3H,EAAU,cAAc,4BAA4B;AACtE,MAAI,CAAC2H,GAAW;AACd,WAAO;AAET,MAAI;AACF,WAAO,KAAK,MAAMA,EAAU,WAAW;AAAA,EACzC,SAAS/F,GAAO;AACd,mBAAQ,MAAM,mDAAmDA,CAAK,GAC/D;AAAA,EACT;AACF;AAEA,SAASgG,EAAW5H,GAA8B;AAChD,QAAM6H,KAAY7H,EAAU,QAAQ,WAAW,IAAI,KAAA,GAC7CwH,KAASxH,EAAU,QAAQ,cAAc,YAAY,KAAA,GACrD8H,IAAUJ,EAAkB1H,CAAS,GACrC+H,IAASF,IAAW,SAAS,eAAeA,CAAQ,IAAI,MACxDG,IAAW,OAAe;AAChC,MAAI,CAACD,KAAU,CAACD,KAAW,CAACE;AAC1B;AAGF,QAAMC,IAAQD,EAAQ,iBAAiBD,CAAM,KAAKC,EAAQ,KAAKD,GAAQP,GAAO,EAAE,UAAU,SAAA,CAAU;AAGpG,MAFAS,EAAM,UAAUH,GAAS,EAAI,GAEzB,CAAC3B,EAAqB,IAAInG,CAAS,KAAK,OAAO,gBAAgB;AACjE,UAAMkI,IAAW,IAAI,eAAe,MAAM;AACxC,UAAI;AACF,QAAAD,EAAM,OAAA;AAAA,MACR,SAASE,GAAa;AACpB,gBAAQ,KAAK,yCAAyCA,CAAW;AAAA,MACnE;AAAA,IACF,CAAC;AACD,IAAAD,EAAS,QAAQH,CAAM,GACvB5B,EAAqB,IAAInG,GAAWkI,CAAQ;AAAA,EAC9C;AACF;AAEA,eAAexB,IAA+B;AAC5C,QAAM0B,IAAa,MAAM,KAAK,SAAS,iBAA8B,sBAAsB,CAAC;AAC5F,aAAWpI,KAAaoI,GAAY;AAClC,UAAMZ,KAASxH,EAAU,QAAQ,cAAc,YAAY,KAAA,GACrD6F,IAAa7F,EAAU,QAAQ,mBAAmB;AACxD,QAAI;AACF,YAAMuH,EAAoBC,GAAO3B,CAAU,GAC3C+B,EAAW5H,CAAS;AAAA,IACtB,SAAS4B,GAAO;AACd,cAAQ,MAAM,oDAAoDA,CAAK;AAAA,IACzE;AAAA,EACF;AACF;AAKO,SAASyG,IAAgC;AAC9C,QAAMC,IAAW,SAAS,eAAe,wBAAwB;AACjE,MAAI,CAACA,GAAU,aAAa;AAC1B,YAAQ,MAAM,2DAA2D;AACzE;AAAA,EACF;AAEA,MAAI;AACF,UAAMxG,IAA+B,KAAK,MAAMwG,EAAS,WAAW;AACpE,IAAAlC,EAAmBtE,CAAM,EAAE,MAAM,CAAAyG,MAAO;AACtC,cAAQ,MAAM,2CAA2CA,CAAG;AAAA,IAC9D,CAAC;AAAA,EACH,SAASA,GAAK;AACZ,YAAQ,MAAM,0CAA0CA,CAAG;AAAA,EAC7D;AACF;"}