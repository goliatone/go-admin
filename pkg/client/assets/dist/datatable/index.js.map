{"version":3,"file":"index.js","sources":["../../src/datatable/actions.ts","../../src/datatable/translation-status-vocabulary.ts","../../src/datatable/translation-context.ts","../../src/datatable/renderers.ts","../../src/datatable/state-store.ts","../../src/datatable/grouped-mode.ts","../../src/datatable/core-constants.ts","../../src/shared/query-state/url-state.ts","../../src/datatable/core-state.ts","../../src/shared/transport/http-client.ts","../../src/datatable/core-fetch-query.ts","../../src/datatable/core-grouped.ts","../../src/datatable/core-rendering.ts","../../src/datatable/column-manager.ts","../../src/shared/events/delegation.ts","../../src/datatable/core-lifecycle.ts","../../src/datatable/core-columns.ts","../../src/datatable/core.ts","../../src/datatable/advanced-search.ts","../../src/datatable/filter-builder.ts","../../src/datatable/go-crud/search.ts","../../src/datatable/go-crud/filter.ts","../../src/datatable/go-crud/pagination.ts","../../src/datatable/go-crud/sort.ts","../../src/datatable/go-crud/export.ts","../../src/datatable/go-crud/bulk.ts","../../src/datatable/go-crud/column-visibility.ts","../../src/datatable/payload-modal-lazy.ts","../../src/datatable/schema-actions.ts","../../src/datatable/translation-blocker-modal.ts","../../src/datatable/status-legend.ts","../../src/datatable/quick-filters.ts","../../src/datatable/translation-bulk-actions.ts","../../src/datatable/locale-action.ts","../../src/datatable/fallback-banner.ts","../../src/datatable/inline-locale-chips.ts","../../src/datatable/keyboard-shortcuts.ts","../../src/datatable/autosave-indicator.ts","../../src/datatable/field-helpers.ts","../../src/datatable/capability-gate.ts","../../src/datatable/translator-dashboard.ts","../../src/datatable/exchange-import.ts","../../src/datatable/async-progress.ts","../../src/datatable/side-by-side-editor.ts"],"sourcesContent":["/**\n * Action System for DataGrid\n * Provides extensible row and bulk action capabilities\n */\n\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\nimport { extractErrorMessage } from '../toast/error-helpers.js';\nimport { Modal, escapeHtml as escapeModalHtml } from '../shared/modal.js';\n\nexport type ActionVariant = 'primary' | 'secondary' | 'danger' | 'success' | 'warning';\nexport type ActionRenderMode = 'inline' | 'dropdown';\n\nexport interface ActionButton {\n  id?: string;\n  label: string;\n  icon?: string;\n  action: (record: any) => void | Promise<void>;\n  condition?: (record: any) => boolean;\n  disabled?: boolean;\n  disabledReason?: string;\n  variant?: ActionVariant;\n  className?: string;\n}\n\nexport interface BulkActionConfig {\n  id: string;\n  label: string;\n  icon?: string;\n  endpoint: string;\n  method?: 'POST' | 'PUT' | 'DELETE';\n  confirm?: string;\n  guard?: (selectedIds: string[]) => boolean;\n  onSuccess?: (response: any) => void;\n  onError?: (error: Error) => void;\n  payload?: Record<string, unknown>;\n  payloadRequired?: string[];\n  payloadSchema?: Record<string, unknown>;\n}\n\ninterface PayloadSchemaProperty {\n  type?: string;\n  title?: string;\n  description?: string;\n  default?: unknown;\n  enum?: unknown[];\n  oneOf?: PayloadSchemaOption[];\n}\n\ninterface PayloadSchemaOption {\n  const?: unknown;\n  title?: string;\n}\n\ninterface PayloadSchema {\n  type?: string;\n  required?: unknown;\n  properties?: Record<string, PayloadSchemaProperty>;\n}\n\ninterface PayloadModalFieldOption {\n  value: string;\n  label: string;\n}\n\ninterface PayloadModalField {\n  name: string;\n  label: string;\n  description?: string;\n  value: string;\n  type: string;\n  options?: PayloadModalFieldOption[];\n}\n\ninterface PayloadModalConfig {\n  title: string;\n  fields: PayloadModalField[];\n  confirmLabel?: string;\n  cancelLabel?: string;\n}\n\nclass PayloadInputModal extends Modal {\n  private readonly config: PayloadModalConfig;\n  private readonly onConfirm: (values: Record<string, string>) => void;\n  private readonly onCancel: () => void;\n  private resolved = false;\n\n  constructor(\n    config: PayloadModalConfig,\n    onConfirm: (values: Record<string, string>) => void,\n    onCancel: () => void\n  ) {\n    super({ size: 'md', initialFocus: '[data-payload-field]', lockBodyScroll: false });\n    this.config = config;\n    this.onConfirm = onConfirm;\n    this.onCancel = onCancel;\n  }\n\n  static prompt(config: PayloadModalConfig): Promise<Record<string, string> | null> {\n    return new Promise<Record<string, string> | null>((resolve) => {\n      const modal = new PayloadInputModal(\n        config,\n        (values) => resolve(values),\n        () => resolve(null)\n      );\n      modal.show();\n    });\n  }\n\n  protected renderContent(): string {\n    const fields = this.config.fields.map((field) => this.renderField(field)).join('');\n    return `\n      <form class=\"flex flex-col\" data-payload-form>\n        <div class=\"px-6 py-4 border-b border-gray-200\">\n          <h3 class=\"text-lg font-semibold text-gray-900\">${escapeModalHtml(this.config.title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">Complete required fields to continue.</p>\n        </div>\n        <div class=\"px-6 py-4 space-y-4 max-h-[60vh] overflow-y-auto\">\n          ${fields}\n        </div>\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200\">\n          <button type=\"button\"\n                  data-payload-cancel\n                  class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer\">\n            ${escapeModalHtml(this.config.cancelLabel ?? 'Cancel')}\n          </button>\n          <button type=\"submit\"\n                  data-payload-confirm\n                  class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 cursor-pointer\">\n            ${escapeModalHtml(this.config.confirmLabel ?? 'Continue')}\n          </button>\n        </div>\n      </form>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-payload-form]');\n    const cancelBtn = this.container?.querySelector<HTMLButtonElement>('[data-payload-cancel]');\n    const submit = (): void => {\n      this.clearErrors();\n      const values: Record<string, string> = {};\n      let firstInvalid: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null = null;\n\n      for (const field of this.config.fields) {\n        const input = this.container?.querySelector<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>(\n          `[data-payload-field=\"${field.name}\"]`\n        );\n        if (!input) {\n          continue;\n        }\n        const value = input.value.trim();\n        values[field.name] = value;\n        if (!value) {\n          if (!firstInvalid) {\n            firstInvalid = input;\n          }\n          this.showFieldError(field.name, 'This field is required.');\n        }\n      }\n\n      if (firstInvalid) {\n        firstInvalid.focus();\n        return;\n      }\n\n      this.resolved = true;\n      this.onConfirm(values);\n      this.hide();\n    };\n\n    form?.addEventListener('submit', (event) => {\n      event.preventDefault();\n      submit();\n    });\n    cancelBtn?.addEventListener('click', () => {\n      this.hide();\n    });\n  }\n\n  protected onBeforeHide(): boolean {\n    if (!this.resolved) {\n      this.resolved = true;\n      this.onCancel();\n    }\n    return true;\n  }\n\n  private renderField(field: PayloadModalField): string {\n    const description = field.description\n      ? `<p class=\"text-xs text-gray-500 mt-1\">${escapeModalHtml(field.description)}</p>`\n      : '';\n    const control = field.options && field.options.length > 0\n      ? this.renderSelect(field)\n      : this.renderInput(field);\n    return `\n      <div>\n        <label class=\"block text-sm font-medium text-gray-800 mb-1.5\" for=\"payload-field-${field.name}\">\n          ${escapeModalHtml(field.label)}\n        </label>\n        ${control}\n        ${description}\n        <p class=\"hidden text-xs text-red-600 mt-1\" data-payload-error=\"${field.name}\"></p>\n      </div>\n    `;\n  }\n\n  private renderSelect(field: PayloadModalField): string {\n    const selected = field.value;\n    const options = field.options || [];\n    const optionHtml = options\n      .map((option) => {\n        const isSelected = option.value === selected ? ' selected' : '';\n        return `<option value=\"${escapeModalHtml(option.value)}\"${isSelected}>${escapeModalHtml(option.label)}</option>`;\n      })\n      .join('');\n    return `\n      <select id=\"payload-field-${field.name}\"\n              data-payload-field=\"${field.name}\"\n              class=\"w-full border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300\">\n        <option value=\"\">Select an option</option>\n        ${optionHtml}\n      </select>\n    `;\n  }\n\n  private renderInput(field: PayloadModalField): string {\n    const cls = 'w-full border rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300';\n    if (field.type === 'array' || field.type === 'object') {\n      return `\n        <textarea id=\"payload-field-${field.name}\"\n                  data-payload-field=\"${field.name}\"\n                  rows=\"4\"\n                  class=\"${cls}\"\n                  placeholder=\"${field.type === 'array' ? '[...]' : '{...}'}\">${escapeModalHtml(field.value)}</textarea>\n      `;\n    }\n    const inputType = field.type === 'integer' || field.type === 'number' ? 'number' : 'text';\n    return `\n      <input id=\"payload-field-${field.name}\"\n             type=\"${inputType}\"\n             data-payload-field=\"${field.name}\"\n             value=\"${escapeModalHtml(field.value)}\"\n             class=\"${cls}\" />\n    `;\n  }\n\n  private clearErrors(): void {\n    const errors = this.container?.querySelectorAll<HTMLElement>('[data-payload-error]');\n    errors?.forEach((el) => {\n      el.textContent = '';\n      el.classList.add('hidden');\n    });\n  }\n\n  private showFieldError(name: string, message: string): void {\n    const errorEl = this.container?.querySelector<HTMLElement>(`[data-payload-error=\"${name}\"]`);\n    if (!errorEl) {\n      return;\n    }\n    errorEl.textContent = message;\n    errorEl.classList.remove('hidden');\n  }\n}\n\nexport interface ActionRendererConfig {\n  mode?: ActionRenderMode;\n  actionBasePath?: string;\n  notifier?: ToastNotifier;\n}\n\nexport class ActionRenderer {\n  private actionBasePath: string;\n  private mode: ActionRenderMode;\n  private notifier: ToastNotifier;\n  private actionKeys: WeakMap<ActionButton, string>;\n  private actionKeySeq: number;\n\n  constructor(config: ActionRendererConfig = {}) {\n    this.actionBasePath = config.actionBasePath || '';\n    this.mode = config.mode || 'dropdown';  // Default to dropdown\n    this.notifier = config.notifier || new FallbackNotifier();\n    this.actionKeys = new WeakMap<ActionButton, string>();\n    this.actionKeySeq = 0;\n  }\n\n  /**\n   * Render row actions as HTML\n   */\n  renderRowActions(record: any, actions: ActionButton[]): string {\n    if (this.mode === 'dropdown') {\n      return this.renderRowActionsDropdown(record, actions);\n    }\n\n    // Inline mode (existing behavior)\n    const visibleActions = actions.filter(action =>\n      !action.condition || action.condition(record)\n    );\n\n    if (visibleActions.length === 0) {\n      return '<div class=\"flex justify-end gap-2\"></div>';\n    }\n\n    const actionButtons = visibleActions.map(action => {\n      const variantClass = this.getVariantClass(action.variant || 'secondary');\n      const icon = action.icon ? this.renderIcon(action.icon) : '';\n      const customClass = action.className || '';\n      const disabled = action.disabled === true;\n      const actionKey = this.getActionKey(action);\n      const disabledClass = disabled ? 'opacity-50 cursor-not-allowed' : '';\n      // Use aria-disabled instead of disabled to keep element focusable for accessibility\n      const ariaDisabledAttr = disabled ? 'aria-disabled=\"true\"' : '';\n      const titleAttr = action.disabledReason\n        ? `title=\"${this.escapeHtml(action.disabledReason)}\"`\n        : '';\n\n      return `\n        <button\n          type=\"button\"\n          class=\"btn btn-sm ${variantClass} ${customClass} ${disabledClass}\"\n          data-action-id=\"${this.sanitize(action.label)}\"\n          data-action-key=\"${actionKey}\"\n          data-record-id=\"${record.id}\"\n          data-disabled=\"${disabled}\"\n          ${ariaDisabledAttr}\n          ${titleAttr}\n        >\n          ${icon}\n          ${this.sanitize(action.label)}\n        </button>\n      `;\n    }).join('');\n\n    return `<div class=\"flex justify-end gap-2\">${actionButtons}</div>`;\n  }\n\n  /**\n   * Render row actions as dropdown menu\n   */\n  private renderRowActionsDropdown(record: any, actions: ActionButton[]): string {\n    const visibleActions = actions.filter(action =>\n      !action.condition || action.condition(record)\n    );\n\n    if (visibleActions.length === 0) {\n      return '<div class=\"text-sm text-gray-400\">No actions</div>';\n    }\n\n    const menuId = `actions-menu-${record.id}`;\n    const actionItems = this.buildDropdownItems(record, visibleActions);\n\n    return `\n      <div class=\"relative actions-dropdown\" data-dropdown>\n        <button type=\"button\"\n                class=\"actions-menu-trigger p-2 hover:bg-gray-100 rounded-md transition-colors\"\n                data-dropdown-trigger\n                aria-label=\"Actions menu\"\n                aria-haspopup=\"true\"\n                aria-expanded=\"false\">\n          ${this.renderDotsIcon()}\n        </button>\n\n        <div id=\"${menuId}\"\n             class=\"actions-menu hidden absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-10 py-1\"\n             role=\"menu\"\n             aria-orientation=\"vertical\">\n          ${actionItems}\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Build dropdown menu items HTML\n   */\n  private buildDropdownItems(record: any, actions: ActionButton[]): string {\n    return actions.map((action, index) => {\n      const isDestructive = action.variant === 'danger';\n      const disabled = action.disabled === true;\n      const actionKey = this.getActionKey(action);\n      const icon = action.icon ? this.renderIcon(action.icon) : '';\n      const needsDivider = this.shouldShowDivider(action, index, actions);\n\n      const divider = needsDivider\n        ? '<div class=\"action-divider border-t border-gray-200 my-1\"></div>'\n        : '';\n\n      const itemClass = disabled\n        ? 'action-item text-gray-400 cursor-not-allowed'\n        : isDestructive\n        ? 'action-item text-red-600 hover:bg-red-50'\n        : 'action-item text-gray-700 hover:bg-gray-50';\n      // Use aria-disabled instead of disabled to keep element focusable for accessibility\n      const ariaDisabledAttr = disabled ? 'aria-disabled=\"true\"' : '';\n      const titleAttr = action.disabledReason\n        ? `title=\"${this.escapeHtml(action.disabledReason)}\"`\n        : '';\n\n      return `\n        ${divider}\n        <button type=\"button\"\n                class=\"${itemClass} flex items-center gap-3 w-full px-4 py-2.5 transition-colors\"\n                data-action-id=\"${this.sanitize(action.label)}\"\n                data-action-key=\"${actionKey}\"\n                data-record-id=\"${record.id}\"\n                data-disabled=\"${disabled}\"\n                role=\"menuitem\"\n                ${ariaDisabledAttr}\n                ${titleAttr}>\n          <span class=\"flex-shrink-0 w-5 h-5\">${icon}</span>\n          <span class=\"text-sm font-medium\">${this.escapeHtml(action.label)}</span>\n        </button>\n      `;\n    }).join('');\n  }\n\n  /**\n   * Determine if divider should be shown before action\n   */\n  private shouldShowDivider(action: ActionButton, index: number, actions: ActionButton[]): boolean {\n    if (index === 0) return false;\n\n    // Show divider before destructive actions\n    if (action.variant === 'danger') return true;\n\n    // Show divider before certain action labels\n    const dividerBefore = ['download', 'archive', 'delete', 'remove'];\n    return dividerBefore.some(label =>\n      action.label.toLowerCase().includes(label)\n    );\n  }\n\n  /**\n   * Render three-dot vertical icon\n   */\n  private renderDotsIcon(): string {\n    return `\n      <svg class=\"w-5 h-5 text-gray-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path d=\"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Render default actions (view, edit, delete)\n   * NOTE: This method is deprecated - default actions are now handled in core.ts\n   * Kept for backward compatibility\n   */\n  renderDefaultActions(record: any, basePath: string): string {\n    // Deprecated: Default actions are now created and bound in core.ts\n    // This method is kept for backward compatibility but should not be used\n    return '<div class=\"text-sm text-gray-400\">Use core.ts for default actions</div>';\n  }\n\n  /**\n   * Attach event listeners for row actions\n   */\n  attachRowActionListeners(\n    container: HTMLElement,\n    actions: ActionButton[],\n    records: Record<string, any>\n  ): void {\n    actions.forEach(action => {\n      const actionKey = this.getActionKey(action);\n      const buttons = container.querySelectorAll(\n        `[data-action-key=\"${actionKey}\"]`\n      );\n\n      buttons.forEach((button) => {\n        const btn = button as HTMLElement;\n        const recordId = btn.dataset.recordId;\n        const record = records[recordId!];\n\n        if (record) {\n          btn.addEventListener('click', async (e) => {\n            e.preventDefault();\n            // Click guard: prevent action execution when aria-disabled\n            if (btn.getAttribute('aria-disabled') === 'true' || btn.dataset.disabled === 'true') {\n              return;\n            }\n            try {\n              await action.action(record);\n            } catch (error) {\n              console.error(`Action \"${action.label}\" failed:`, error);\n              const errorMsg = error instanceof Error ? error.message : `Action \"${action.label}\" failed`;\n              this.notifier.error(errorMsg);\n            }\n          });\n        }\n      });\n    });\n  }\n\n  /**\n   * Render bulk actions toolbar\n   */\n  renderBulkActionsToolbar(bulkActions: BulkActionConfig[]): HTMLElement {\n    const toolbar = document.createElement('div');\n    toolbar.id = 'bulk-actions-bar';  // Match core selector\n    toolbar.className = 'hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 flex items-center gap-4';\n\n    const info = document.createElement('span');\n    info.className = 'text-sm font-medium text-blue-900';\n    info.id = 'selected-count';  // Match core selector\n    info.textContent = '0 items selected';\n    toolbar.appendChild(info);\n\n    const actionsContainer = document.createElement('div');\n    actionsContainer.className = 'flex gap-2 flex-1';\n\n    bulkActions.forEach(config => {\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.className = 'btn btn-sm btn-primary';\n      button.dataset.bulkAction = config.id;\n\n      if (config.icon) {\n        button.innerHTML = `${this.renderIcon(config.icon)} ${config.label}`;\n      } else {\n        button.textContent = config.label;\n      }\n\n      actionsContainer.appendChild(button);\n    });\n\n    toolbar.appendChild(actionsContainer);\n\n    const clearButton = document.createElement('button');\n    clearButton.type = 'button';\n    clearButton.className = 'btn btn-sm btn-secondary';\n    clearButton.id = 'clear-selection-btn';\n    clearButton.textContent = 'Clear Selection';\n    toolbar.appendChild(clearButton);\n\n    return toolbar;\n  }\n\n  /**\n   * Execute bulk action\n   */\n  async executeBulkAction(\n    config: BulkActionConfig,\n    selectedIds: string[]\n  ): Promise<void> {\n    // Check guard condition\n    if (config.guard && !config.guard(selectedIds)) {\n      console.warn(`Bulk action \"${config.id}\" guard failed`);\n      return;\n    }\n\n    // Confirm if needed - use notifier's async confirm\n    if (config.confirm) {\n      const message = config.confirm.replace('{count}', selectedIds.length.toString());\n      const confirmed = await this.notifier.confirm(message);\n      if (!confirmed) {\n        return;\n      }\n    }\n\n    const requestPayload = await this.resolveBulkActionPayload(config, selectedIds);\n    if (requestPayload === null) {\n      return;\n    }\n\n    try {\n      const response = await fetch(config.endpoint, {\n        method: config.method || 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        const errorMsg = await extractErrorMessage(response);\n        this.notifier.error(errorMsg);\n        throw new Error(errorMsg);\n      }\n\n      const data = await response.json();\n      this.notifier.success(this.buildBulkSuccessMessage(config, data, selectedIds.length));\n\n      if (config.onSuccess) {\n        config.onSuccess(data);\n      }\n    } catch (error) {\n      console.error(`Bulk action \"${config.id}\" failed:`, error);\n\n      // Show error toast if onError callback didn't handle it\n      if (!config.onError) {\n        const errorMsg = error instanceof Error ? error.message : 'Bulk action failed';\n        this.notifier.error(errorMsg);\n      }\n\n      if (config.onError) {\n        config.onError(error as Error);\n      }\n      throw error;\n    }\n  }\n\n  private async resolveBulkActionPayload(\n    config: BulkActionConfig,\n    selectedIds: string[]\n  ): Promise<Record<string, unknown> | null> {\n    const payload: Record<string, unknown> = {\n      ...(config.payload || {}),\n      ids: selectedIds,\n    };\n\n    const schema = this.normalizePayloadSchema(config.payloadSchema);\n    if (schema?.properties) {\n      Object.entries(schema.properties).forEach(([field, definition]) => {\n        if (payload[field] === undefined && definition && definition.default !== undefined) {\n          payload[field] = definition.default;\n        }\n      });\n    }\n\n    const required = this.collectRequiredFields(config.payloadRequired, schema);\n    const missingRequired = required.filter((field) => field !== 'ids' && this.isEmptyPayloadValue(payload[field]));\n    if (missingRequired.length === 0) {\n      return payload;\n    }\n\n    const rawValues = await this.requestRequiredFields(config, missingRequired, schema, payload);\n    if (rawValues === null) {\n      return null;\n    }\n\n    for (const field of missingRequired) {\n      const definition = schema?.properties?.[field];\n      const rawValue = rawValues[field] ?? '';\n      const parsed = this.coercePromptValue(rawValue, field, definition);\n      if (parsed.error) {\n        this.notifier.error(parsed.error);\n        return null;\n      }\n      payload[field] = parsed.value;\n    }\n\n    return payload;\n  }\n\n  private collectRequiredFields(required: string[] | undefined, schema: PayloadSchema | null): string[] {\n    const ordered: string[] = [];\n    const seen = new Set<string>();\n    const append = (field: string): void => {\n      const value = field.trim();\n      if (!value || seen.has(value)) {\n        return;\n      }\n      seen.add(value);\n      ordered.push(value);\n    };\n\n    if (Array.isArray(required)) {\n      required.forEach((field) => append(String(field)));\n    }\n    if (Array.isArray(schema?.required)) {\n      schema.required.forEach((field) => append(String(field)));\n    }\n    return ordered;\n  }\n\n  private normalizePayloadSchema(schema: Record<string, unknown> | undefined): PayloadSchema | null {\n    if (!schema || typeof schema !== 'object') {\n      return null;\n    }\n    const propertiesRaw = schema.properties;\n    let properties: Record<string, PayloadSchemaProperty> | undefined;\n    if (propertiesRaw && typeof propertiesRaw === 'object') {\n      properties = {};\n      Object.entries(propertiesRaw as Record<string, unknown>).forEach(([key, value]) => {\n        if (value && typeof value === 'object') {\n          properties![key] = value as PayloadSchemaProperty;\n        }\n      });\n    }\n    return {\n      type: typeof schema.type === 'string' ? schema.type : undefined,\n      required: schema.required,\n      properties,\n    };\n  }\n\n  private async requestRequiredFields(\n    config: BulkActionConfig,\n    requiredFields: string[],\n    schema: PayloadSchema | null,\n    payload: Record<string, unknown>\n  ): Promise<Record<string, string> | null> {\n    const modalFields = requiredFields.map((field) => {\n      const definition = schema?.properties?.[field];\n      const rawType = typeof definition?.type === 'string' ? definition.type.toLowerCase() : 'string';\n      return {\n        name: field,\n        label: (definition?.title || field).trim(),\n        description: (definition?.description || '').trim() || undefined,\n        value: this.stringifyPromptDefault(payload[field] !== undefined ? payload[field] : definition?.default),\n        type: rawType,\n        options: this.buildSchemaOptions(definition),\n      };\n    });\n    return PayloadInputModal.prompt({\n      title: `Complete ${config.label || config.id}`,\n      fields: modalFields,\n    });\n  }\n\n  private buildSchemaOptions(definition: PayloadSchemaProperty | undefined): PayloadModalFieldOption[] | undefined {\n    if (!definition) {\n      return undefined;\n    }\n\n    if (Array.isArray(definition.oneOf) && definition.oneOf.length > 0) {\n      const options = definition.oneOf\n        .filter((option) => option && Object.prototype.hasOwnProperty.call(option, 'const'))\n        .map((option) => {\n          const value = this.stringifyPromptDefault(option.const);\n          const label = typeof option.title === 'string' && option.title.trim() ? option.title.trim() : value;\n          return { value, label };\n        });\n      return options.length > 0 ? options : undefined;\n    }\n\n    if (Array.isArray(definition.enum) && definition.enum.length > 0) {\n      const options = definition.enum.map((item) => {\n        const value = this.stringifyPromptDefault(item);\n        return { value, label: value };\n      });\n      return options.length > 0 ? options : undefined;\n    }\n\n    if (typeof definition.type === 'string' && definition.type.toLowerCase() === 'boolean') {\n      return [\n        { value: 'true', label: 'True' },\n        { value: 'false', label: 'False' },\n      ];\n    }\n\n    return undefined;\n  }\n\n  private stringifyPromptDefault(value: unknown): string {\n    if (value === undefined || value === null) {\n      return '';\n    }\n    if (typeof value === 'string') {\n      return value;\n    }\n    if (typeof value === 'number' || typeof value === 'boolean') {\n      return String(value);\n    }\n    try {\n      return JSON.stringify(value);\n    } catch {\n      return '';\n    }\n  }\n\n  private coercePromptValue(\n    rawValue: string,\n    field: string,\n    definition: PayloadSchemaProperty | undefined\n  ): { value: unknown; error?: string } {\n    if (Array.isArray(definition?.oneOf) && definition.oneOf.length > 0) {\n      const match = definition.oneOf.find(\n        (item) => item && Object.prototype.hasOwnProperty.call(item, 'const') && this.stringifyPromptDefault(item.const) === rawValue\n      );\n      if (!match || !Object.prototype.hasOwnProperty.call(match, 'const')) {\n        const allowed = definition.oneOf\n          .map((item) => (typeof item?.title === 'string' && item.title.trim() ? item.title.trim() : this.stringifyPromptDefault(item.const)))\n          .filter((value) => value !== '')\n          .join(', ');\n        return { value: rawValue, error: `${field} must be one of: ${allowed}` };\n      }\n      return { value: match.const };\n    }\n\n    const type = (definition?.type || 'string').toLowerCase();\n    if (rawValue === '') {\n      return { value: '' };\n    }\n\n    let value: unknown = rawValue;\n    switch (type) {\n      case 'integer': {\n        const parsed = Number.parseInt(rawValue, 10);\n        if (Number.isNaN(parsed)) {\n          return { value: rawValue, error: `${field} must be an integer.` };\n        }\n        value = parsed;\n        break;\n      }\n      case 'number': {\n        const parsed = Number.parseFloat(rawValue);\n        if (Number.isNaN(parsed)) {\n          return { value: rawValue, error: `${field} must be a number.` };\n        }\n        value = parsed;\n        break;\n      }\n      case 'boolean': {\n        const normalized = rawValue.toLowerCase();\n        if (['true', '1', 'yes', 'y', 'on'].includes(normalized)) {\n          value = true;\n          break;\n        }\n        if (['false', '0', 'no', 'n', 'off'].includes(normalized)) {\n          value = false;\n          break;\n        }\n        return { value: rawValue, error: `${field} must be true/false.` };\n      }\n      case 'array':\n      case 'object': {\n        try {\n          const parsed = JSON.parse(rawValue) as unknown;\n          if (type === 'array' && !Array.isArray(parsed)) {\n            return { value: rawValue, error: `${field} must be a JSON array.` };\n          }\n          if (type === 'object' && (parsed === null || Array.isArray(parsed) || typeof parsed !== 'object')) {\n            return { value: rawValue, error: `${field} must be a JSON object.` };\n          }\n          value = parsed;\n        } catch {\n          return { value: rawValue, error: `${field} must be valid JSON.` };\n        }\n        break;\n      }\n      default:\n        value = rawValue;\n    }\n\n    if (Array.isArray(definition?.enum) && definition!.enum!.length > 0) {\n      const matches = definition!.enum!.some((item) => item === value || String(item) === String(value));\n      if (!matches) {\n        return { value, error: `${field} must be one of: ${definition!.enum!.map((item) => String(item)).join(', ')}` };\n      }\n    }\n\n    return { value };\n  }\n\n  private isEmptyPayloadValue(value: unknown): boolean {\n    if (value === undefined || value === null) {\n      return true;\n    }\n    if (typeof value === 'string') {\n      return value.trim() === '';\n    }\n    if (Array.isArray(value)) {\n      return value.length === 0;\n    }\n    if (typeof value === 'object') {\n      return Object.keys(value as Record<string, unknown>).length === 0;\n    }\n    return false;\n  }\n\n  private buildBulkSuccessMessage(\n    config: BulkActionConfig,\n    data: any,\n    fallbackCount: number\n  ): string {\n    const actionLabel = config.label || config.id || 'Bulk action';\n    const summary = data && typeof data === 'object' ? data.summary : null;\n    const succeeded = summary && typeof summary.succeeded === 'number'\n      ? summary.succeeded\n      : (typeof data?.processed === 'number' ? data.processed : fallbackCount);\n    const failed = summary && typeof summary.failed === 'number' ? summary.failed : 0;\n    if (failed > 0) {\n      return `${actionLabel} completed: ${succeeded} succeeded, ${failed} failed.`;\n    }\n    return `${actionLabel} completed for ${succeeded} item${succeeded === 1 ? '' : 's'}.`;\n  }\n\n  private getVariantClass(variant: ActionVariant): string {\n    const variants: Record<ActionVariant, string> = {\n      primary: 'btn-primary',\n      secondary: 'btn-secondary',\n      danger: 'btn-danger',\n      success: 'btn-success',\n      warning: 'btn-warning',\n    };\n    return variants[variant] || 'btn-secondary';\n  }\n\n  private renderIcon(icon: string): string {\n    // Simple icon mapping - extend as needed\n    const icons: Record<string, string> = {\n      'eye': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"/></svg>',\n      'edit': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/></svg>',\n      'trash': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/></svg>',\n      'check-circle': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'pause': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'pause-circle': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'x-circle': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'key': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"/></svg>',\n      'archive': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4\"/></svg>',\n      'download': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"/></svg>',\n      'copy': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/></svg>',\n      'user-badge': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/></svg>',\n    };\n    return icons[icon] || '';\n  }\n\n  private getActionKey(action: ActionButton): string {\n    const existing = this.actionKeys.get(action);\n    if (existing) {\n      return existing;\n    }\n\n    const configuredID = typeof action.id === 'string' ? action.id.trim() : '';\n    const key = configuredID ? `id-${this.sanitize(configuredID)}` : `auto-${++this.actionKeySeq}`;\n    this.actionKeys.set(action, key);\n    return key;\n  }\n\n  private sanitize(str: string): string {\n    return str.toLowerCase().replace(/[^a-z0-9]/g, '-');\n  }\n\n  private escapeHtml(str: string): string {\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  }\n}\n","/**\n * Translation Status Vocabulary (Phase 5 - TX-052)\n *\n * Provides a unified translation status vocabulary map and disabled-reason presenter\n * used by all translation surfaces. Implements the shared contracts from backend\n * translation_contracts.go and action_state_reason_codes.go.\n *\n * Status Domains:\n * - Core: readiness_state (ready, missing_locales, missing_fields, missing_locales_and_fields)\n * - Queue: queue_state (pending, assigned, in_progress, review, rejected, approved, published, archived)\n *          content_state (draft, review, ready, archived)\n *          due_state (overdue, due_soon, on_track, none)\n * - Exchange: row_status (success, error, conflict, skipped)\n *             job_status (running, completed, failed)\n *\n * Disabled Reason Codes:\n * - TRANSLATION_MISSING, INVALID_STATUS, PERMISSION_DENIED, MISSING_CONTEXT, FEATURE_DISABLED\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Status domain categories matching backend structure\n */\nexport type StatusDomain = 'core' | 'queue' | 'exchange';\n\n/**\n * Core readiness states\n */\nexport type CoreReadinessState = 'ready' | 'missing_locales' | 'missing_fields' | 'missing_locales_and_fields';\n\n/**\n * Queue assignment states\n */\nexport type QueueState = 'pending' | 'assigned' | 'in_progress' | 'review' | 'rejected' | 'approved' | 'published' | 'archived';\n\n/**\n * Queue content states\n */\nexport type QueueContentState = 'draft' | 'review' | 'ready' | 'archived';\n\n/**\n * Queue due states\n */\nexport type QueueDueState = 'overdue' | 'due_soon' | 'on_track' | 'none';\n\n/**\n * Exchange row statuses\n */\nexport type ExchangeRowStatus = 'success' | 'error' | 'conflict' | 'skipped';\n\n/**\n * Exchange job statuses\n */\nexport type ExchangeJobStatus = 'running' | 'completed' | 'failed';\n\n/**\n * All possible translation status values\n */\nexport type TranslationStatus =\n  | CoreReadinessState\n  | QueueState\n  | QueueContentState\n  | QueueDueState\n  | ExchangeRowStatus\n  | ExchangeJobStatus;\n\n/**\n * Canonical disabled reason codes from backend\n */\nexport type DisabledReasonCode =\n  | 'TRANSLATION_MISSING'\n  | 'INVALID_STATUS'\n  | 'PERMISSION_DENIED'\n  | 'MISSING_CONTEXT'\n  | 'FEATURE_DISABLED';\n\n/**\n * Status display configuration\n */\nexport interface StatusDisplayConfig {\n  /** Human-readable label */\n  label: string;\n  /** Short label for compact displays */\n  shortLabel?: string;\n  /** CSS color class (bg + text) */\n  colorClass: string;\n  /** Background color class */\n  bgClass: string;\n  /** Text color class */\n  textClass: string;\n  /** Border color class */\n  borderClass?: string;\n  /** Icon character or SVG path */\n  icon: string;\n  /** Icon type: 'char' for character, 'svg' for SVG path */\n  iconType: 'char' | 'svg';\n  /** Severity level for sorting/priority */\n  severity: 'success' | 'warning' | 'error' | 'info' | 'neutral';\n  /** Tooltip/description text */\n  description?: string;\n}\n\n/**\n * Disabled reason display configuration\n */\nexport interface DisabledReasonDisplayConfig {\n  /** Human-readable message */\n  message: string;\n  /** Short message for compact displays */\n  shortMessage: string;\n  /** CSS color class */\n  colorClass: string;\n  /** Background color class */\n  bgClass: string;\n  /** Text color class */\n  textClass: string;\n  /** Icon SVG path */\n  icon: string;\n  /** Severity level */\n  severity: 'warning' | 'error' | 'info';\n  /** Whether the reason can be resolved by user action */\n  actionable: boolean;\n  /** Suggested action label if actionable */\n  actionLabel?: string;\n}\n\n/**\n * Status vocabulary payload from backend contracts\n */\nexport interface StatusVocabularyPayload {\n  schema_version: number;\n  status_enums: {\n    core: {\n      readiness_state: string[];\n    };\n    queue: {\n      queue_state: string[];\n      content_state: string[];\n      due_state: string[];\n    };\n    exchange: {\n      row_status: string[];\n      job_status: string[];\n    };\n    all: string[];\n  };\n  disabled_reason_codes: string[];\n}\n\n// ============================================================================\n// Status Display Configurations\n// ============================================================================\n\n/**\n * SVG icon paths for status icons\n */\nconst ICONS = {\n  check: 'M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z',\n  warning: 'M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z',\n  error: 'M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z',\n  info: 'M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z',\n  clock: 'M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z',\n  document: 'M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z',\n  archive: 'M4 3a2 2 0 100 4h12a2 2 0 100-4H4zm0 6a1 1 0 00-1 1v7a1 1 0 001 1h12a1 1 0 001-1v-7a1 1 0 00-1-1H4zm4 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z',\n  user: 'M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z',\n  play: 'M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z',\n  lock: 'M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z',\n  ban: 'M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z',\n};\n\n/**\n * Core readiness state display configurations\n */\nexport const CORE_READINESS_DISPLAY: Record<CoreReadinessState, StatusDisplayConfig> = {\n  ready: {\n    label: 'Ready',\n    shortLabel: 'Ready',\n    colorClass: 'bg-green-100 text-green-700',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    borderClass: 'border-green-300',\n    icon: '●',\n    iconType: 'char',\n    severity: 'success',\n    description: 'All required translations are complete',\n  },\n  missing_locales: {\n    label: 'Missing Locales',\n    shortLabel: 'Missing',\n    colorClass: 'bg-amber-100 text-amber-700',\n    bgClass: 'bg-amber-100',\n    textClass: 'text-amber-700',\n    borderClass: 'border-amber-300',\n    icon: '○',\n    iconType: 'char',\n    severity: 'warning',\n    description: 'Required locale translations are missing',\n  },\n  missing_fields: {\n    label: 'Incomplete Fields',\n    shortLabel: 'Incomplete',\n    colorClass: 'bg-yellow-100 text-yellow-700',\n    bgClass: 'bg-yellow-100',\n    textClass: 'text-yellow-700',\n    borderClass: 'border-yellow-300',\n    icon: '◐',\n    iconType: 'char',\n    severity: 'warning',\n    description: 'Some translations have missing required fields',\n  },\n  missing_locales_and_fields: {\n    label: 'Not Ready',\n    shortLabel: 'Not Ready',\n    colorClass: 'bg-red-100 text-red-700',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    borderClass: 'border-red-300',\n    icon: '○',\n    iconType: 'char',\n    severity: 'error',\n    description: 'Missing translations and incomplete fields',\n  },\n};\n\n/**\n * Queue state display configurations\n */\nexport const QUEUE_STATE_DISPLAY: Record<QueueState, StatusDisplayConfig> = {\n  pending: {\n    label: 'Pending',\n    colorClass: 'bg-gray-100 text-gray-700',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-700',\n    icon: ICONS.clock,\n    iconType: 'svg',\n    severity: 'neutral',\n    description: 'Waiting to be assigned',\n  },\n  assigned: {\n    label: 'Assigned',\n    colorClass: 'bg-blue-100 text-blue-700',\n    bgClass: 'bg-blue-100',\n    textClass: 'text-blue-700',\n    icon: ICONS.user,\n    iconType: 'svg',\n    severity: 'info',\n    description: 'Assigned to a translator',\n  },\n  in_progress: {\n    label: 'In Progress',\n    colorClass: 'bg-blue-100 text-blue-700',\n    bgClass: 'bg-blue-100',\n    textClass: 'text-blue-700',\n    icon: ICONS.play,\n    iconType: 'svg',\n    severity: 'info',\n    description: 'Translation in progress',\n  },\n  review: {\n    label: 'In Review',\n    colorClass: 'bg-purple-100 text-purple-700',\n    bgClass: 'bg-purple-100',\n    textClass: 'text-purple-700',\n    icon: ICONS.document,\n    iconType: 'svg',\n    severity: 'info',\n    description: 'Pending review',\n  },\n  rejected: {\n    label: 'Rejected',\n    colorClass: 'bg-red-100 text-red-700',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    icon: ICONS.error,\n    iconType: 'svg',\n    severity: 'error',\n    description: 'Translation rejected',\n  },\n  approved: {\n    label: 'Approved',\n    colorClass: 'bg-green-100 text-green-700',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    icon: ICONS.check,\n    iconType: 'svg',\n    severity: 'success',\n    description: 'Translation approved',\n  },\n  published: {\n    label: 'Published',\n    colorClass: 'bg-green-100 text-green-700',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    icon: ICONS.check,\n    iconType: 'svg',\n    severity: 'success',\n    description: 'Translation published',\n  },\n  archived: {\n    label: 'Archived',\n    colorClass: 'bg-gray-100 text-gray-500',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-500',\n    icon: ICONS.archive,\n    iconType: 'svg',\n    severity: 'neutral',\n    description: 'Translation archived',\n  },\n};\n\n/**\n * Queue content state display configurations\n */\nexport const QUEUE_CONTENT_STATE_DISPLAY: Record<QueueContentState, StatusDisplayConfig> = {\n  draft: {\n    label: 'Draft',\n    colorClass: 'bg-gray-100 text-gray-700',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-700',\n    icon: ICONS.document,\n    iconType: 'svg',\n    severity: 'neutral',\n    description: 'Draft content',\n  },\n  review: {\n    label: 'Review',\n    colorClass: 'bg-purple-100 text-purple-700',\n    bgClass: 'bg-purple-100',\n    textClass: 'text-purple-700',\n    icon: ICONS.document,\n    iconType: 'svg',\n    severity: 'info',\n    description: 'Content under review',\n  },\n  ready: {\n    label: 'Ready',\n    colorClass: 'bg-green-100 text-green-700',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    icon: ICONS.check,\n    iconType: 'svg',\n    severity: 'success',\n    description: 'Content ready',\n  },\n  archived: {\n    label: 'Archived',\n    colorClass: 'bg-gray-100 text-gray-500',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-500',\n    icon: ICONS.archive,\n    iconType: 'svg',\n    severity: 'neutral',\n    description: 'Content archived',\n  },\n};\n\n/**\n * Queue due state display configurations\n */\nexport const QUEUE_DUE_STATE_DISPLAY: Record<QueueDueState, StatusDisplayConfig> = {\n  overdue: {\n    label: 'Overdue',\n    colorClass: 'bg-red-100 text-red-700',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    icon: ICONS.warning,\n    iconType: 'svg',\n    severity: 'error',\n    description: 'Past due date',\n  },\n  due_soon: {\n    label: 'Due Soon',\n    colorClass: 'bg-amber-100 text-amber-700',\n    bgClass: 'bg-amber-100',\n    textClass: 'text-amber-700',\n    icon: ICONS.clock,\n    iconType: 'svg',\n    severity: 'warning',\n    description: 'Due within 24 hours',\n  },\n  on_track: {\n    label: 'On Track',\n    colorClass: 'bg-green-100 text-green-700',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    icon: ICONS.check,\n    iconType: 'svg',\n    severity: 'success',\n    description: 'On schedule',\n  },\n  none: {\n    label: 'No Due Date',\n    colorClass: 'bg-gray-100 text-gray-500',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-500',\n    icon: ICONS.clock,\n    iconType: 'svg',\n    severity: 'neutral',\n    description: 'No due date set',\n  },\n};\n\n/**\n * Exchange row status display configurations\n */\nexport const EXCHANGE_ROW_STATUS_DISPLAY: Record<ExchangeRowStatus, StatusDisplayConfig> = {\n  success: {\n    label: 'Success',\n    colorClass: 'bg-green-100 text-green-700',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    icon: ICONS.check,\n    iconType: 'svg',\n    severity: 'success',\n    description: 'Import/export succeeded',\n  },\n  error: {\n    label: 'Error',\n    colorClass: 'bg-red-100 text-red-700',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    icon: ICONS.error,\n    iconType: 'svg',\n    severity: 'error',\n    description: 'Import/export failed',\n  },\n  conflict: {\n    label: 'Conflict',\n    colorClass: 'bg-amber-100 text-amber-700',\n    bgClass: 'bg-amber-100',\n    textClass: 'text-amber-700',\n    icon: ICONS.warning,\n    iconType: 'svg',\n    severity: 'warning',\n    description: 'Conflicting changes detected',\n  },\n  skipped: {\n    label: 'Skipped',\n    colorClass: 'bg-gray-100 text-gray-500',\n    bgClass: 'bg-gray-100',\n    textClass: 'text-gray-500',\n    icon: ICONS.ban,\n    iconType: 'svg',\n    severity: 'neutral',\n    description: 'Row skipped',\n  },\n};\n\n/**\n * Exchange job status display configurations\n */\nexport const EXCHANGE_JOB_STATUS_DISPLAY: Record<ExchangeJobStatus, StatusDisplayConfig> = {\n  running: {\n    label: 'Running',\n    colorClass: 'bg-blue-100 text-blue-700',\n    bgClass: 'bg-blue-100',\n    textClass: 'text-blue-700',\n    icon: ICONS.play,\n    iconType: 'svg',\n    severity: 'info',\n    description: 'Job in progress',\n  },\n  completed: {\n    label: 'Completed',\n    colorClass: 'bg-green-100 text-green-700',\n    bgClass: 'bg-green-100',\n    textClass: 'text-green-700',\n    icon: ICONS.check,\n    iconType: 'svg',\n    severity: 'success',\n    description: 'Job completed successfully',\n  },\n  failed: {\n    label: 'Failed',\n    colorClass: 'bg-red-100 text-red-700',\n    bgClass: 'bg-red-100',\n    textClass: 'text-red-700',\n    icon: ICONS.error,\n    iconType: 'svg',\n    severity: 'error',\n    description: 'Job failed',\n  },\n};\n\n/**\n * Disabled reason code display configurations\n */\nexport const DISABLED_REASON_DISPLAY: Record<DisabledReasonCode, DisabledReasonDisplayConfig> = {\n  TRANSLATION_MISSING: {\n    message: 'Required translation is missing',\n    shortMessage: 'Translation missing',\n    colorClass: 'bg-amber-100 text-amber-700',\n    bgClass: 'bg-amber-50',\n    textClass: 'text-amber-700',\n    icon: ICONS.warning,\n    severity: 'warning',\n    actionable: true,\n    actionLabel: 'Create translation',\n  },\n  INVALID_STATUS: {\n    message: 'Action not available in current status',\n    shortMessage: 'Invalid status',\n    colorClass: 'bg-gray-100 text-gray-600',\n    bgClass: 'bg-gray-50',\n    textClass: 'text-gray-600',\n    icon: ICONS.ban,\n    severity: 'info',\n    actionable: false,\n  },\n  PERMISSION_DENIED: {\n    message: 'You do not have permission for this action',\n    shortMessage: 'No permission',\n    colorClass: 'bg-red-100 text-red-700',\n    bgClass: 'bg-red-50',\n    textClass: 'text-red-700',\n    icon: ICONS.lock,\n    severity: 'error',\n    actionable: false,\n  },\n  MISSING_CONTEXT: {\n    message: 'Required context is missing',\n    shortMessage: 'Missing context',\n    colorClass: 'bg-gray-100 text-gray-600',\n    bgClass: 'bg-gray-50',\n    textClass: 'text-gray-600',\n    icon: ICONS.info,\n    severity: 'info',\n    actionable: false,\n  },\n  FEATURE_DISABLED: {\n    message: 'This feature is currently disabled',\n    shortMessage: 'Feature disabled',\n    colorClass: 'bg-gray-100 text-gray-500',\n    bgClass: 'bg-gray-50',\n    textClass: 'text-gray-500',\n    icon: ICONS.ban,\n    severity: 'info',\n    actionable: false,\n  },\n};\n\n// ============================================================================\n// Status Vocabulary Functions\n// ============================================================================\n\n/**\n * Get display configuration for a status value\n */\nexport function getStatusDisplay(status: string, domain?: StatusDomain): StatusDisplayConfig | null {\n  const normalized = status.toLowerCase();\n\n  // Try core readiness states\n  if (!domain || domain === 'core') {\n    if (normalized in CORE_READINESS_DISPLAY) {\n      return CORE_READINESS_DISPLAY[normalized as CoreReadinessState];\n    }\n  }\n\n  // Try queue states\n  if (!domain || domain === 'queue') {\n    if (normalized in QUEUE_STATE_DISPLAY) {\n      return QUEUE_STATE_DISPLAY[normalized as QueueState];\n    }\n    if (normalized in QUEUE_CONTENT_STATE_DISPLAY) {\n      return QUEUE_CONTENT_STATE_DISPLAY[normalized as QueueContentState];\n    }\n    if (normalized in QUEUE_DUE_STATE_DISPLAY) {\n      return QUEUE_DUE_STATE_DISPLAY[normalized as QueueDueState];\n    }\n  }\n\n  // Try exchange states\n  if (!domain || domain === 'exchange') {\n    if (normalized in EXCHANGE_ROW_STATUS_DISPLAY) {\n      return EXCHANGE_ROW_STATUS_DISPLAY[normalized as ExchangeRowStatus];\n    }\n    if (normalized in EXCHANGE_JOB_STATUS_DISPLAY) {\n      return EXCHANGE_JOB_STATUS_DISPLAY[normalized as ExchangeJobStatus];\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get display configuration for a disabled reason code\n */\nexport function getDisabledReasonDisplay(code: string): DisabledReasonDisplayConfig | null {\n  const normalized = code.toUpperCase();\n  if (normalized in DISABLED_REASON_DISPLAY) {\n    return DISABLED_REASON_DISPLAY[normalized as DisabledReasonCode];\n  }\n  return null;\n}\n\n/**\n * Check if a status value is valid\n */\nexport function isValidStatus(status: string, domain?: StatusDomain): boolean {\n  return getStatusDisplay(status, domain) !== null;\n}\n\n/**\n * Check if a reason code is valid\n */\nexport function isValidReasonCode(code: string): boolean {\n  return getDisabledReasonDisplay(code) !== null;\n}\n\n/**\n * Get all status values for a domain\n */\nexport function getStatusesForDomain(domain: StatusDomain): string[] {\n  switch (domain) {\n    case 'core':\n      return Object.keys(CORE_READINESS_DISPLAY);\n    case 'queue':\n      return [\n        ...Object.keys(QUEUE_STATE_DISPLAY),\n        ...Object.keys(QUEUE_CONTENT_STATE_DISPLAY),\n        ...Object.keys(QUEUE_DUE_STATE_DISPLAY),\n      ];\n    case 'exchange':\n      return [\n        ...Object.keys(EXCHANGE_ROW_STATUS_DISPLAY),\n        ...Object.keys(EXCHANGE_JOB_STATUS_DISPLAY),\n      ];\n    default:\n      return [];\n  }\n}\n\n/**\n * Get all disabled reason codes\n */\nexport function getAllReasonCodes(): string[] {\n  return Object.keys(DISABLED_REASON_DISPLAY);\n}\n\n/**\n * Get a CSS class name for a status value.\n * Returns 'status-{status}' for valid statuses, empty string otherwise.\n * This replaces local getStatusClass() functions in consuming surfaces.\n */\nexport function getStatusCssClass(status: string, domain?: StatusDomain): string {\n  const display = getStatusDisplay(status, domain);\n  if (!display) {\n    return '';\n  }\n  return `status-${status.toLowerCase()}`;\n}\n\n/**\n * Get a CSS class name based on severity level.\n * Maps status to its severity CSS class for consistent theming.\n */\nexport function getSeverityCssClass(status: string, domain?: StatusDomain): string {\n  const display = getStatusDisplay(status, domain);\n  if (!display) {\n    return '';\n  }\n  return `severity-${display.severity}`;\n}\n\n// ============================================================================\n// Rendering Functions\n// ============================================================================\n\n/**\n * Render a status badge HTML string\n */\nexport function renderVocabularyStatusBadge(\n  status: string,\n  options: {\n    domain?: StatusDomain;\n    size?: 'xs' | 'sm' | 'default';\n    showIcon?: boolean;\n    showLabel?: boolean;\n    extraClass?: string;\n  } = {}\n): string {\n  const display = getStatusDisplay(status, options.domain);\n  if (!display) {\n    return `<span class=\"inline-flex items-center px-2 py-1 text-xs rounded bg-gray-100 text-gray-500\">${escapeHtml(status)}</span>`;\n  }\n\n  const { size = 'default', showIcon = true, showLabel = true, extraClass = '' } = options;\n\n  const sizeClasses = {\n    xs: 'px-1.5 py-0.5 text-[10px]',\n    sm: 'px-2 py-0.5 text-xs',\n    default: 'px-2.5 py-1 text-xs',\n  };\n\n  const iconHtml = showIcon ? renderVocabularyStatusIcon(display, size) : '';\n  const labelHtml = showLabel ? `<span>${escapeHtml(display.label)}</span>` : '';\n  const gap = showIcon && showLabel ? 'gap-1' : '';\n\n  return `<span class=\"inline-flex items-center ${gap} rounded font-medium ${sizeClasses[size]} ${display.colorClass} ${extraClass}\"\n                title=\"${escapeHtml(display.description || display.label)}\"\n                aria-label=\"${escapeHtml(display.label)}\"\n                data-status=\"${escapeHtml(status)}\">\n    ${iconHtml}${labelHtml}\n  </span>`;\n}\n\n/**\n * Render a status icon\n */\nexport function renderVocabularyStatusIcon(display: StatusDisplayConfig, size: 'xs' | 'sm' | 'default' = 'default'): string {\n  const sizeClasses = {\n    xs: 'w-3 h-3',\n    sm: 'w-3.5 h-3.5',\n    default: 'w-4 h-4',\n  };\n\n  if (display.iconType === 'char') {\n    return `<span class=\"${sizeClasses[size]} inline-flex items-center justify-center\" aria-hidden=\"true\">${display.icon}</span>`;\n  }\n\n  return `<svg class=\"${sizeClasses[size]}\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n    <path fill-rule=\"evenodd\" d=\"${display.icon}\" clip-rule=\"evenodd\"/>\n  </svg>`;\n}\n\n/**\n * Render a disabled reason badge HTML string\n */\nexport function renderReasonCodeBadge(\n  code: string,\n  options: {\n    size?: 'sm' | 'default';\n    showIcon?: boolean;\n    showFullMessage?: boolean;\n    extraClass?: string;\n  } = {}\n): string {\n  const display = getDisabledReasonDisplay(code);\n  if (!display) {\n    return `<span class=\"text-gray-500 text-xs\">${escapeHtml(code)}</span>`;\n  }\n\n  const { size = 'default', showIcon = true, showFullMessage = false, extraClass = '' } = options;\n\n  const sizeClasses = {\n    sm: 'px-2 py-0.5 text-xs',\n    default: 'px-2.5 py-1 text-sm',\n  };\n\n  const iconSize = size === 'sm' ? 'w-3.5 h-3.5' : 'w-4 h-4';\n  const iconHtml = showIcon\n    ? `<svg class=\"${iconSize}\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n        <path fill-rule=\"evenodd\" d=\"${display.icon}\" clip-rule=\"evenodd\"/>\n      </svg>`\n    : '';\n\n  const message = showFullMessage ? display.message : display.shortMessage;\n\n  return `<span class=\"inline-flex items-center gap-1.5 rounded ${sizeClasses[size]} ${display.colorClass} ${extraClass}\"\n                role=\"status\"\n                aria-label=\"${escapeHtml(display.message)}\"\n                data-reason-code=\"${escapeHtml(code)}\">\n    ${iconHtml}\n    <span>${escapeHtml(message)}</span>\n  </span>`;\n}\n\n/**\n * Render an inline disabled reason indicator (compact, icon-only)\n */\nexport function renderReasonCodeIndicator(code: string, tooltip?: string): string {\n  const display = getDisabledReasonDisplay(code);\n  if (!display) {\n    return '';\n  }\n\n  const title = tooltip || display.message;\n\n  return `<span class=\"inline-flex items-center justify-center w-5 h-5 rounded-full ${display.bgClass} ${display.textClass}\"\n                title=\"${escapeHtml(title)}\"\n                aria-label=\"${escapeHtml(display.shortMessage)}\"\n                data-reason-code=\"${escapeHtml(code)}\">\n    <svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n      <path fill-rule=\"evenodd\" d=\"${display.icon}\" clip-rule=\"evenodd\"/>\n    </svg>\n  </span>`;\n}\n\n// ============================================================================\n// Cell Renderer Factories\n// ============================================================================\n\n/**\n * Create a status cell renderer for DataGrid\n */\nexport function createStatusCellRenderer(\n  options: {\n    domain?: StatusDomain;\n    size?: 'xs' | 'sm' | 'default';\n    showIcon?: boolean;\n  } = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (value: unknown): string => {\n    if (typeof value !== 'string' || !value) {\n      return '<span class=\"text-gray-400\">-</span>';\n    }\n    return renderVocabularyStatusBadge(value, options);\n  };\n}\n\n/**\n * Create a disabled reason cell renderer for DataGrid\n */\nexport function createReasonCodeCellRenderer(\n  options: {\n    size?: 'sm' | 'default';\n    showIcon?: boolean;\n  } = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (value: unknown): string => {\n    if (typeof value !== 'string' || !value) {\n      return '';\n    }\n    return renderReasonCodeBadge(value, options);\n  };\n}\n\n// ============================================================================\n// Vocabulary Initialization\n// ============================================================================\n\n/**\n * Initialize vocabulary from backend payload (for dynamic vocabulary updates)\n */\nexport function initializeVocabularyFromPayload(_payload: StatusVocabularyPayload): void {\n  // Currently vocabulary is static; this hook allows future dynamic updates\n  // Validate payload matches expected structure\n  if (_payload.schema_version !== 1) {\n    console.warn('[TranslationStatusVocabulary] Unknown schema version:', _payload.schema_version);\n  }\n}\n\n// ============================================================================\n// CSS Styles\n// ============================================================================\n\n/**\n * Get CSS styles for status vocabulary components\n */\nexport function getStatusVocabularyStyles(): string {\n  return `\n    /* Status Vocabulary Styles */\n    [data-status],\n    [data-reason-code] {\n      transition: opacity 0.15s ease;\n    }\n\n    [data-status]:hover,\n    [data-reason-code]:hover {\n      opacity: 0.9;\n    }\n\n    /* Severity-based animations */\n    [data-status=\"overdue\"],\n    [data-status=\"rejected\"],\n    [data-status=\"error\"],\n    [data-status=\"failed\"] {\n      animation: pulse-subtle 2s ease-in-out infinite;\n    }\n\n    @keyframes pulse-subtle {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.85; }\n    }\n  `;\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n","/**\n * Translation Context Helpers\n *\n * Normalizes translation metadata from API responses (flat or nested) and provides\n * UI rendering utilities for locale badges, fallback warnings, and edit guards.\n *\n * Translation context fields (per CONTENT_TRANSLATION_TDD.md):\n * - requested_locale: The locale requested by the user\n * - resolved_locale: The locale actually returned (may differ if fallback used)\n * - available_locales: Array of locales that exist for this translation group\n * - missing_requested_locale: Boolean indicating requested locale doesn't exist\n * - fallback_used: Boolean indicating content is from a fallback locale\n * - translation_group_id: The group ID linking all locale variants\n */\n\nimport { badge } from '../shared/badge.js';\nimport {\n  getStatusDisplay,\n  renderVocabularyStatusBadge,\n  renderVocabularyStatusIcon,\n} from './translation-status-vocabulary.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Normalized translation context extracted from record payloads.\n * Used for UI rendering decisions (badges, warnings, edit guards).\n */\nexport interface TranslationContext {\n  /** The locale that was requested (from query params) */\n  requestedLocale: string | null;\n  /** The locale that was actually resolved/returned */\n  resolvedLocale: string | null;\n  /** Array of available locales for this translation group */\n  availableLocales: string[];\n  /** True if the requested locale doesn't exist */\n  missingRequestedLocale: boolean;\n  /** True if content is from a fallback locale (not the requested one) */\n  fallbackUsed: boolean;\n  /** Translation group ID linking all locale variants */\n  translationGroupId: string | null;\n  /** Workflow status of the current locale variant */\n  status: string | null;\n  /** Entity type (pages, posts, etc.) */\n  entityType: string | null;\n  /** Record ID */\n  recordId: string | null;\n}\n\n/**\n * Translation readiness state from canonical backend `translation_readiness` fields.\n * Used for grid-level visibility without requiring publish-failure round trips.\n */\nexport interface TranslationReadiness {\n  /** Translation group ID linking all locale variants */\n  translationGroupId: string | null;\n  /** Required locales per policy for this entity/transition/environment */\n  requiredLocales: string[];\n  /** Available locales that exist for this translation group */\n  availableLocales: string[];\n  /** Locales that are required but missing */\n  missingRequiredLocales: string[];\n  /** Missing required fields by locale (only includes locales in availableLocales) */\n  missingRequiredFieldsByLocale: Record<string, string[]>;\n  /** Computed readiness state */\n  readinessState: ReadinessState | null;\n  /** Transition readiness map (e.g., { publish: true }) */\n  readyForTransition: Record<string, boolean>;\n  /** Environment used for policy evaluation */\n  evaluatedEnvironment: string | null;\n  /** Whether readiness metadata is present (for legacy compat) */\n  hasReadinessMetadata: boolean;\n}\n\n/** Possible readiness states from backend */\nexport type ReadinessState = 'ready' | 'missing_locales' | 'missing_fields' | 'missing_locales_and_fields';\n\n/**\n * Readiness badge rendering options\n */\nexport interface ReadinessBadgeOptions {\n  /** Size variant for the badge */\n  size?: 'sm' | 'default';\n  /** Show detailed tooltip with missing info */\n  showDetailedTooltip?: boolean;\n  /** Additional CSS classes */\n  extraClass?: string;\n}\n\n/**\n * Badge rendering options\n */\nexport interface LocaleBadgeOptions {\n  /** Show fallback indicator when in fallback mode */\n  showFallbackIndicator?: boolean;\n  /** Size variant for the badge */\n  size?: 'sm' | 'default';\n  /** Additional CSS classes */\n  extraClass?: string;\n}\n\n/**\n * Translation status indicator options\n */\nexport interface TranslationStatusOptions {\n  /** Maximum number of locales to show before truncating */\n  maxLocales?: number;\n  /** Show the resolved locale badge */\n  showResolvedLocale?: boolean;\n  /** Size variant */\n  size?: 'sm' | 'default';\n}\n\n// ============================================================================\n// Translation Context Extraction\n// ============================================================================\n\n/**\n * Extract and normalize translation context from a record payload.\n * Handles both flat fields and nested `translation.meta.*` / `content_translation.meta.*` structures.\n *\n * @param record - The record object from API response\n * @returns Normalized TranslationContext\n */\nexport function extractTranslationContext(record: Record<string, unknown>): TranslationContext {\n  const context: TranslationContext = {\n    requestedLocale: null,\n    resolvedLocale: null,\n    availableLocales: [],\n    missingRequestedLocale: false,\n    fallbackUsed: false,\n    translationGroupId: null,\n    status: null,\n    entityType: null,\n    recordId: null,\n  };\n\n  if (!record || typeof record !== 'object') {\n    return context;\n  }\n\n  // Try flat fields first, then nested structures\n  context.requestedLocale = extractStringField(record, [\n    'requested_locale',\n    'translation.meta.requested_locale',\n    'content_translation.meta.requested_locale',\n  ]);\n\n  context.resolvedLocale = extractStringField(record, [\n    'resolved_locale',\n    'locale',\n    'translation.meta.resolved_locale',\n    'content_translation.meta.resolved_locale',\n  ]);\n\n  context.availableLocales = extractStringArrayField(record, [\n    'available_locales',\n    'translation.meta.available_locales',\n    'content_translation.meta.available_locales',\n  ]);\n\n  context.missingRequestedLocale = extractBooleanField(record, [\n    'missing_requested_locale',\n    'translation.meta.missing_requested_locale',\n    'content_translation.meta.missing_requested_locale',\n  ]);\n\n  context.fallbackUsed = extractBooleanField(record, [\n    'fallback_used',\n    'translation.meta.fallback_used',\n    'content_translation.meta.fallback_used',\n  ]);\n\n  context.translationGroupId = extractStringField(record, [\n    'translation_group_id',\n    'translation.meta.translation_group_id',\n    'content_translation.meta.translation_group_id',\n  ]);\n\n  context.status = extractStringField(record, ['status']);\n  context.entityType = extractStringField(record, ['entity_type', 'type', '_type']);\n  context.recordId = extractStringField(record, ['id']);\n\n  // Infer fallback state from locale mismatch if not explicitly set\n  if (!context.fallbackUsed && context.requestedLocale && context.resolvedLocale) {\n    context.fallbackUsed = context.requestedLocale !== context.resolvedLocale;\n  }\n\n  // Infer missing_requested_locale from fallback state\n  if (!context.missingRequestedLocale && context.fallbackUsed) {\n    context.missingRequestedLocale = true;\n  }\n\n  return context;\n}\n\n/**\n * Check if a record is in fallback mode (requested locale doesn't exist).\n * Use this to determine if edit guards should be applied.\n */\nexport function isInFallbackMode(record: Record<string, unknown>): boolean {\n  const ctx = extractTranslationContext(record);\n  return ctx.fallbackUsed || ctx.missingRequestedLocale;\n}\n\n/**\n * Check if a record has translation context metadata available.\n */\nexport function hasTranslationContext(record: Record<string, unknown>): boolean {\n  const ctx = extractTranslationContext(record);\n  return ctx.translationGroupId !== null || ctx.resolvedLocale !== null || ctx.availableLocales.length > 0;\n}\n\n/**\n * Extract canonical translation readiness fields from a record payload.\n * These fields are exposed by Phase 18.6 productization for grid-level visibility.\n *\n * @param record - The record object from API response\n * @returns Normalized TranslationReadiness\n */\nexport function extractTranslationReadiness(record: Record<string, unknown>): TranslationReadiness {\n  const readiness: TranslationReadiness = {\n    translationGroupId: null,\n    requiredLocales: [],\n    availableLocales: [],\n    missingRequiredLocales: [],\n    missingRequiredFieldsByLocale: {},\n    readinessState: null,\n    readyForTransition: {},\n    evaluatedEnvironment: null,\n    hasReadinessMetadata: false,\n  };\n\n  if (!record || typeof record !== 'object') {\n    return readiness;\n  }\n\n  // Check for nested translation_readiness object (canonical productized format)\n  const readinessObj = record.translation_readiness as Record<string, unknown> | undefined;\n\n  if (readinessObj && typeof readinessObj === 'object') {\n    readiness.hasReadinessMetadata = true;\n\n    readiness.translationGroupId = extractStringField(record, [\n      'translation_readiness.translation_group_id',\n      'translation_group_id',\n      'translation.meta.translation_group_id',\n      'content_translation.meta.translation_group_id',\n      'translation_context.translation_group_id',\n    ]);\n\n    readiness.requiredLocales = Array.isArray(readinessObj.required_locales)\n      ? readinessObj.required_locales.filter((v): v is string => typeof v === 'string')\n      : [];\n\n    readiness.availableLocales = Array.isArray(readinessObj.available_locales)\n      ? readinessObj.available_locales.filter((v): v is string => typeof v === 'string')\n      : [];\n\n    readiness.missingRequiredLocales = Array.isArray(readinessObj.missing_required_locales)\n      ? readinessObj.missing_required_locales.filter((v): v is string => typeof v === 'string')\n      : [];\n\n    // Parse missing_required_fields_by_locale\n    const fieldsByLocale = readinessObj.missing_required_fields_by_locale;\n    if (fieldsByLocale && typeof fieldsByLocale === 'object' && !Array.isArray(fieldsByLocale)) {\n      for (const [locale, fields] of Object.entries(fieldsByLocale)) {\n        if (Array.isArray(fields)) {\n          readiness.missingRequiredFieldsByLocale[locale] = fields.filter(\n            (v): v is string => typeof v === 'string'\n          );\n        }\n      }\n    }\n\n    // Parse readiness_state\n    const state = readinessObj.readiness_state;\n    if (typeof state === 'string' && isValidReadinessState(state)) {\n      readiness.readinessState = state;\n    }\n\n    // Parse ready_for_transition map\n    const readyFor = readinessObj.ready_for_transition;\n    if (readyFor && typeof readyFor === 'object' && !Array.isArray(readyFor)) {\n      for (const [transition, ready] of Object.entries(readyFor)) {\n        if (typeof ready === 'boolean') {\n          readiness.readyForTransition[transition] = ready;\n        }\n      }\n    }\n\n    readiness.evaluatedEnvironment = typeof readinessObj.evaluated_environment === 'string'\n      ? readinessObj.evaluated_environment\n      : null;\n  }\n\n  return readiness;\n}\n\n/**\n * Check if a record has canonical translation readiness metadata.\n * Used to determine whether to use productized rendering vs legacy fallback.\n */\nexport function hasTranslationReadiness(record: Record<string, unknown>): boolean {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.hasReadinessMetadata;\n}\n\n/**\n * Check if a record is ready for a specific transition (e.g., 'publish').\n */\nexport function isReadyForTransition(record: Record<string, unknown>, transition: string): boolean {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.readyForTransition[transition] === true;\n}\n\n/**\n * Type guard for valid readiness states.\n */\nfunction isValidReadinessState(state: string): state is ReadinessState {\n  return ['ready', 'missing_locales', 'missing_fields', 'missing_locales_and_fields'].includes(state);\n}\n\n// ============================================================================\n// Badge Rendering\n// ============================================================================\n\n/**\n * Render a locale badge for display in content rows.\n * Shows the resolved locale with an optional fallback indicator.\n *\n * @param context - Translation context or record to extract from\n * @param options - Rendering options\n * @returns HTML string for the locale badge\n */\nexport function renderLocaleBadge(\n  context: TranslationContext | Record<string, unknown>,\n  options: LocaleBadgeOptions = {}\n): string {\n  const ctx = 'resolvedLocale' in context\n    ? context as TranslationContext\n    : extractTranslationContext(context as Record<string, unknown>);\n\n  const { showFallbackIndicator = true, size = 'default', extraClass = '' } = options;\n\n  if (!ctx.resolvedLocale) {\n    return '';\n  }\n\n  const locale = ctx.resolvedLocale.toUpperCase();\n  const isFallback = ctx.fallbackUsed || ctx.missingRequestedLocale;\n\n  // Build badge classes\n  const sizeClass = size === 'sm' ? 'text-xs px-1.5 py-0.5' : 'text-xs px-2 py-1';\n  const baseClasses = `inline-flex items-center gap-1 rounded font-medium ${sizeClass}`;\n\n  if (isFallback && showFallbackIndicator) {\n    // Fallback mode: amber/warning style with indicator\n    return `<span class=\"${baseClasses} bg-amber-100 text-amber-800 ${extraClass}\"\n                  title=\"Showing ${ctx.resolvedLocale} content (${ctx.requestedLocale || 'requested locale'} not available)\"\n                  aria-label=\"Fallback locale: ${locale}\">\n      <svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n      </svg>\n      ${locale}\n    </span>`;\n  }\n\n  // Normal locale badge\n  return `<span class=\"${baseClasses} bg-blue-100 text-blue-800 ${extraClass}\"\n                title=\"Locale: ${locale}\"\n                aria-label=\"Locale: ${locale}\">\n    ${locale}\n  </span>`;\n}\n\n/**\n * Render available locales as a compact indicator for content rows.\n * Shows which locales exist for this translation group.\n *\n * @param context - Translation context or record\n * @param options - Rendering options\n * @returns HTML string for available locales indicator\n */\nexport function renderAvailableLocalesIndicator(\n  context: TranslationContext | Record<string, unknown>,\n  options: TranslationStatusOptions = {}\n): string {\n  const ctx = 'resolvedLocale' in context\n    ? context as TranslationContext\n    : extractTranslationContext(context as Record<string, unknown>);\n\n  const { maxLocales = 3, size = 'default' } = options;\n\n  if (ctx.availableLocales.length === 0) {\n    return '';\n  }\n\n  const sizeClass = size === 'sm' ? 'text-xs gap-0.5' : 'text-xs gap-1';\n  const pillSize = size === 'sm' ? 'px-1 py-0.5 text-[10px]' : 'px-1.5 py-0.5';\n\n  const visibleLocales = ctx.availableLocales.slice(0, maxLocales);\n  const hiddenCount = ctx.availableLocales.length - maxLocales;\n\n  const pills = visibleLocales.map(locale => {\n    const isResolved = locale === ctx.resolvedLocale;\n    const pillClass = isResolved\n      ? `${pillSize} rounded bg-blue-100 text-blue-700 font-medium`\n      : `${pillSize} rounded bg-gray-100 text-gray-600`;\n    return `<span class=\"${pillClass}\">${locale.toUpperCase()}</span>`;\n  }).join('');\n\n  const overflow = hiddenCount > 0\n    ? `<span class=\"${pillSize} rounded bg-gray-100 text-gray-500\">+${hiddenCount}</span>`\n    : '';\n\n  return `<span class=\"inline-flex items-center ${sizeClass}\"\n                title=\"Available locales: ${ctx.availableLocales.join(', ')}\"\n                aria-label=\"Available locales: ${ctx.availableLocales.join(', ')}\">\n    ${pills}${overflow}\n  </span>`;\n}\n\n/**\n * Render a combined translation status cell for content rows.\n * Combines locale badge + availability indicator.\n *\n * @param context - Translation context or record\n * @param options - Rendering options\n * @returns HTML string for the translation status cell\n */\nexport function renderTranslationStatusCell(\n  context: TranslationContext | Record<string, unknown>,\n  options: TranslationStatusOptions = {}\n): string {\n  const ctx = 'resolvedLocale' in context\n    ? context as TranslationContext\n    : extractTranslationContext(context as Record<string, unknown>);\n\n  const { showResolvedLocale = true, size = 'default' } = options;\n\n  const parts: string[] = [];\n\n  // Add locale badge\n  if (showResolvedLocale && ctx.resolvedLocale) {\n    parts.push(renderLocaleBadge(ctx, { size, showFallbackIndicator: true }));\n  }\n\n  // Add available locales indicator\n  if (ctx.availableLocales.length > 1) {\n    parts.push(renderAvailableLocalesIndicator(ctx, { ...options, size }));\n  }\n\n  if (parts.length === 0) {\n    return '<span class=\"text-gray-400\">-</span>';\n  }\n\n  const gapClass = size === 'sm' ? 'gap-1' : 'gap-2';\n  return `<div class=\"flex items-center flex-wrap ${gapClass}\">${parts.join('')}</div>`;\n}\n\n/**\n * Render a workflow status badge.\n */\nexport function renderStatusBadge(status: string | null, size: 'sm' | 'default' = 'default'): string {\n  if (!status) {\n    return '';\n  }\n\n  const normalizedStatus = status.trim();\n  if (getStatusDisplay(normalizedStatus) !== null) {\n    return renderVocabularyStatusBadge(normalizedStatus, { size: size === 'sm' ? 'sm' : 'default' });\n  }\n  const statusLower = normalizedStatus.toLowerCase();\n  return badge(status, 'status', statusLower, { size: size === 'sm' ? 'sm' : undefined });\n}\n\n// ============================================================================\n// Translation Readiness Rendering (Productized Phase 19)\n// ============================================================================\n\n/**\n * Render a translation readiness indicator for content rows.\n * Shows completeness state based on canonical backend readiness fields.\n *\n * @param record - The record from API response\n * @param options - Rendering options\n * @returns HTML string for the readiness indicator\n */\nexport function renderReadinessIndicator(\n  record: Record<string, unknown>,\n  options: ReadinessBadgeOptions = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  // Legacy mode: no readiness metadata, show nothing or fallback\n  if (!readiness.hasReadinessMetadata) {\n    return '';\n  }\n\n  const { size = 'default', showDetailedTooltip = true, extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-xs px-1.5 py-0.5' : 'text-xs px-2 py-1';\n  const baseClasses = `inline-flex items-center gap-1 rounded font-medium ${sizeClass}`;\n\n  const state = readiness.readinessState || 'ready';\n  const { icon, label, bgClass, textClass, tooltip } = getReadinessStateDisplay(state, readiness, showDetailedTooltip);\n\n  return `<span class=\"${baseClasses} ${bgClass} ${textClass} ${extraClass}\"\n                title=\"${tooltip}\"\n                aria-label=\"${label}\"\n                data-readiness-state=\"${state}\">\n    ${icon}\n    <span>${label}</span>\n  </span>`;\n}\n\n/**\n * Render a compact publish readiness badge (ready/not ready).\n */\nexport function renderPublishReadinessBadge(\n  record: Record<string, unknown>,\n  options: ReadinessBadgeOptions = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  if (!readiness.hasReadinessMetadata) {\n    return '';\n  }\n\n  const isReady = readiness.readyForTransition.publish === true;\n  const { size = 'default', extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-[10px] px-1.5 py-0.5' : 'text-xs px-2 py-1';\n\n  if (isReady) {\n    return `<span class=\"inline-flex items-center gap-1 rounded font-medium ${sizeClass} bg-green-100 text-green-700 ${extraClass}\"\n                  title=\"Ready to publish\"\n                  aria-label=\"Ready to publish\">\n      <svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/>\n      </svg>\n      Ready\n    </span>`;\n  }\n\n  // Not ready - show missing info\n  const missingCount = readiness.missingRequiredLocales.length;\n  const tooltip = missingCount > 0\n    ? `Missing translations: ${readiness.missingRequiredLocales.join(', ')}`\n    : 'Not ready to publish';\n\n  return `<span class=\"inline-flex items-center gap-1 rounded font-medium ${sizeClass} bg-amber-100 text-amber-700 ${extraClass}\"\n                title=\"${tooltip}\"\n                aria-label=\"Not ready to publish\">\n    <svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n      <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n    </svg>\n    ${missingCount > 0 ? `${missingCount} missing` : 'Not ready'}\n  </span>`;\n}\n\n/**\n * Render a locale completeness progress indicator.\n * Shows X/Y locales complete.\n */\nexport function renderLocaleCompleteness(\n  record: Record<string, unknown>,\n  options: { size?: 'sm' | 'default'; extraClass?: string } = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  if (!readiness.hasReadinessMetadata || readiness.requiredLocales.length === 0) {\n    return '';\n  }\n\n  const { size = 'default', extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-xs' : 'text-sm';\n\n  const required = readiness.requiredLocales.length;\n  const available = readiness.availableLocales.filter(\n    loc => readiness.requiredLocales.includes(loc)\n  ).length;\n  const complete = required > 0 && available === required;\n\n  const colorClass = complete\n    ? 'text-green-600'\n    : available > 0\n      ? 'text-amber-600'\n      : 'text-gray-500';\n\n  return `<span class=\"${sizeClass} ${colorClass} font-medium ${extraClass}\"\n                title=\"Locale completeness: ${available} of ${required} required locales available\"\n                aria-label=\"${available} of ${required} locales\">\n    ${available}/${required}\n  </span>`;\n}\n\n/**\n * Render a prominent \"Missing Translations\" badge for list rows.\n * This is a first-class affordance to quickly identify incomplete content.\n *\n * @param record - The record from API response\n * @param options - Rendering options\n * @returns HTML string for the missing translations badge, or empty if complete\n */\nexport function renderMissingTranslationsBadge(\n  record: Record<string, unknown>,\n  options: ReadinessBadgeOptions = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  // No badge needed if ready or no metadata\n  if (!readiness.hasReadinessMetadata || readiness.readinessState === 'ready') {\n    return '';\n  }\n\n  const { size = 'default', extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-xs px-2 py-1' : 'text-sm px-2.5 py-1';\n  const missingCount = readiness.missingRequiredLocales.length;\n\n  // Different severity levels\n  const hasMissingLocales = missingCount > 0;\n  const hasMissingFields = Object.keys(readiness.missingRequiredFieldsByLocale).length > 0;\n\n  let bgClass = 'bg-amber-100';\n  let textClass = 'text-amber-800';\n  let label = '';\n  let tooltip = '';\n\n  if (hasMissingLocales && hasMissingFields) {\n    bgClass = 'bg-red-100';\n    textClass = 'text-red-800';\n    label = `${missingCount} missing`;\n    tooltip = `Missing translations: ${readiness.missingRequiredLocales.join(', ')}. Also has incomplete fields.`;\n  } else if (hasMissingLocales) {\n    bgClass = 'bg-amber-100';\n    textClass = 'text-amber-800';\n    label = `${missingCount} missing`;\n    tooltip = `Missing translations: ${readiness.missingRequiredLocales.join(', ')}`;\n  } else if (hasMissingFields) {\n    bgClass = 'bg-yellow-100';\n    textClass = 'text-yellow-800';\n    label = 'Incomplete';\n    const locales = Object.keys(readiness.missingRequiredFieldsByLocale);\n    tooltip = `Incomplete fields in: ${locales.join(', ')}`;\n  }\n\n  if (!label) {\n    return '';\n  }\n\n  const warningIcon = `<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/></svg>`;\n\n  return `<span class=\"inline-flex items-center gap-1.5 rounded-full font-medium ${sizeClass} ${bgClass} ${textClass} ${extraClass}\"\n                title=\"${tooltip}\"\n                aria-label=\"${tooltip}\"\n                data-missing-translations=\"true\"\n                data-missing-count=\"${missingCount}\">\n    ${warningIcon}\n    <span>${label}</span>\n  </span>`;\n}\n\n/**\n * Check if a record has missing required translations.\n * Used for quick filtering in list views.\n */\nexport function hasMissingTranslations(record: Record<string, unknown>): boolean {\n  const readiness = extractTranslationReadiness(record);\n  if (!readiness.hasReadinessMetadata) {\n    return false;\n  }\n  return readiness.readinessState !== 'ready';\n}\n\n/**\n * Get the missing translations count for a record.\n */\nexport function getMissingTranslationsCount(record: Record<string, unknown>): number {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.missingRequiredLocales.length;\n}\n\n/**\n * Get display properties for a readiness state.\n */\nfunction getReadinessStateDisplay(\n  state: ReadinessState,\n  readiness: TranslationReadiness,\n  showDetailedTooltip: boolean\n): { icon: string; label: string; bgClass: string; textClass: string; tooltip: string } {\n  const sharedDisplay = getStatusDisplay(state, 'core');\n  const sharedIcon = sharedDisplay ? renderVocabularyStatusIcon(sharedDisplay, 'sm') : '';\n  const sharedBgClass = sharedDisplay?.bgClass || 'bg-gray-100';\n  const sharedTextClass = sharedDisplay?.textClass || 'text-gray-600';\n  const sharedLabel = sharedDisplay?.label || 'Unknown';\n  const sharedDescription = sharedDisplay?.description || 'Unknown readiness state';\n\n  switch (state) {\n    case 'ready':\n      return {\n        icon: sharedIcon,\n        label: sharedLabel,\n        bgClass: sharedBgClass,\n        textClass: sharedTextClass,\n        tooltip: sharedDescription,\n      };\n\n    case 'missing_locales': {\n      const missing = readiness.missingRequiredLocales;\n      const tooltip = showDetailedTooltip && missing.length > 0\n        ? `Missing translations: ${missing.join(', ')}`\n        : 'Missing required translations';\n      return {\n        icon: sharedIcon,\n        label: `${missing.length} missing`,\n        bgClass: sharedBgClass,\n        textClass: sharedTextClass,\n        tooltip,\n      };\n    }\n\n    case 'missing_fields': {\n      const localesWithMissingFields = Object.keys(readiness.missingRequiredFieldsByLocale);\n      const tooltip = showDetailedTooltip && localesWithMissingFields.length > 0\n        ? `Incomplete fields in: ${localesWithMissingFields.join(', ')}`\n        : 'Some translations have missing required fields';\n      return {\n        icon: sharedIcon,\n        label: 'Incomplete',\n        bgClass: sharedBgClass,\n        textClass: sharedTextClass,\n        tooltip,\n      };\n    }\n\n    case 'missing_locales_and_fields': {\n      const missingLocales = readiness.missingRequiredLocales;\n      const localesWithMissingFields = Object.keys(readiness.missingRequiredFieldsByLocale);\n      const parts: string[] = [];\n      if (missingLocales.length > 0) {\n        parts.push(`Missing: ${missingLocales.join(', ')}`);\n      }\n      if (localesWithMissingFields.length > 0) {\n        parts.push(`Incomplete: ${localesWithMissingFields.join(', ')}`);\n      }\n      const tooltip = showDetailedTooltip ? parts.join('; ') : 'Missing translations and incomplete fields';\n      return {\n        icon: sharedIcon,\n        label: 'Not ready',\n        bgClass: sharedBgClass,\n        textClass: sharedTextClass,\n        tooltip,\n      };\n    }\n\n    default:\n      return {\n        icon: sharedIcon,\n        label: sharedLabel,\n        bgClass: sharedBgClass,\n        textClass: sharedTextClass,\n        tooltip: sharedDescription,\n      };\n  }\n}\n\n// ============================================================================\n// Translation Matrix Cell (Phase 2)\n// ============================================================================\n\n/**\n * Matrix cell rendering options\n *\n * The matrix cell provides a compact \"matrix summary\" representation where\n * locale status icons (●/◐/○) are rendered inline for each required locale.\n *\n * This is NOT a true locale-column matrix (separate columns per locale).\n * Instead, it shows all locale states within a single cell, enabling\n * quick at-a-glance visibility of translation completeness.\n *\n * Use this renderer when:\n * - DataGrid view mode is 'matrix'\n * - You need compact locale status in list views\n * - Space is limited but locale visibility is important\n */\nexport interface MatrixCellOptions {\n  /** Size variant: 'sm' or 'md' */\n  size?: 'sm' | 'md';\n  /** Maximum number of locales to show before truncating */\n  maxLocales?: number;\n  /** Show locale labels alongside icons */\n  showLabels?: boolean;\n}\n\n/**\n * Render a compact translation matrix cell showing locale status for each required locale.\n * Uses translation_readiness data to show ● ready, ◐ incomplete, ○ missing states.\n *\n * States:\n * - ● (green): Locale translation exists and all required fields are complete\n * - ◐ (amber): Locale translation exists but has missing required fields\n * - ○ (gray/dashed): Locale translation does not exist\n *\n * @param record - The record from API response\n * @param options - Matrix cell rendering options\n * @returns HTML string for the matrix cell\n */\nexport function renderTranslationMatrixCell(\n  record: Record<string, unknown>,\n  options: MatrixCellOptions = {}\n): string {\n  const { size = 'sm', maxLocales = 5, showLabels = false } = options;\n\n  const readiness = extractTranslationReadiness(record);\n  if (!readiness.hasReadinessMetadata) {\n    return '<span class=\"text-gray-400\">-</span>';\n  }\n\n  const { requiredLocales, availableLocales, missingRequiredFieldsByLocale } = readiness;\n  const allLocales = requiredLocales.length > 0 ? requiredLocales : availableLocales;\n\n  if (allLocales.length === 0) {\n    return '<span class=\"text-gray-400\">-</span>';\n  }\n\n  const availableSet = new Set(availableLocales);\n  const incompleteLocales = getIncompleteLocales(missingRequiredFieldsByLocale);\n\n  const chips = allLocales\n    .slice(0, maxLocales)\n    .map((locale) => {\n      const isAvailable = availableSet.has(locale);\n      const isIncomplete = isAvailable && incompleteLocales.has(locale);\n      const isComplete = isAvailable && !isIncomplete;\n      // isMissing implied when !isComplete && !isIncomplete\n\n      // Determine state and styling\n      let stateClass: string;\n      let icon: string;\n      let stateLabel: string;\n\n      if (isComplete) {\n        stateClass = 'bg-green-100 text-green-700 border-green-300';\n        icon = '●';\n        stateLabel = 'Complete';\n      } else if (isIncomplete) {\n        stateClass = 'bg-amber-100 text-amber-700 border-amber-300';\n        icon = '◐';\n        stateLabel = 'Incomplete';\n      } else {\n        // Missing\n        stateClass = 'bg-white text-gray-400 border-gray-300 border-dashed';\n        icon = '○';\n        stateLabel = 'Missing';\n      }\n\n      const sizeClass = size === 'sm'\n        ? 'text-[10px] px-1.5 py-0.5'\n        : 'text-xs px-2 py-1';\n\n      const labelHtml = showLabels\n        ? `<span class=\"font-medium\">${locale.toUpperCase()}</span>`\n        : '';\n\n      return `\n        <span class=\"inline-flex items-center gap-0.5 ${sizeClass} rounded border ${stateClass}\"\n              title=\"${locale.toUpperCase()}: ${stateLabel}\"\n              aria-label=\"${locale.toUpperCase()}: ${stateLabel}\"\n              data-locale=\"${locale}\"\n              data-state=\"${stateLabel.toLowerCase()}\">\n          ${labelHtml}\n          <span aria-hidden=\"true\">${icon}</span>\n        </span>\n      `;\n    })\n    .join('');\n\n  const overflow = allLocales.length > maxLocales\n    ? `<span class=\"text-[10px] text-gray-500\" title=\"${allLocales.length - maxLocales} more locales\">+${allLocales.length - maxLocales}</span>`\n    : '';\n\n  return `<div class=\"flex items-center gap-1 flex-wrap\" data-matrix-cell=\"true\">${chips}${overflow}</div>`;\n}\n\n/**\n * Get set of locales that have missing required fields.\n */\nfunction getIncompleteLocales(fieldsByLocale: Record<string, string[]>): Set<string> {\n  const incomplete = new Set<string>();\n  if (fieldsByLocale && typeof fieldsByLocale === 'object') {\n    for (const [locale, fields] of Object.entries(fieldsByLocale)) {\n      if (Array.isArray(fields) && fields.length > 0) {\n        incomplete.add(locale);\n      }\n    }\n  }\n  return incomplete;\n}\n\n/**\n * Create a cell renderer for translation matrix that can be used with DataGrid.\n * Returns a function compatible with the CellRenderer type.\n *\n * @param options - Matrix cell rendering options\n * @returns CellRenderer function\n */\nexport function createTranslationMatrixRenderer(\n  options: MatrixCellOptions = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderTranslationMatrixCell(record, options);\n  };\n}\n\n// ============================================================================\n// Fallback Warning Rendering\n// ============================================================================\n\n/**\n * Render a fallback warning banner for detail/edit views.\n * Shows when the requested locale doesn't exist and fallback content is displayed.\n *\n * @param context - Translation context\n * @param options - Options for the warning\n * @returns HTML string for the fallback warning banner\n */\nexport function renderFallbackWarning(\n  context: TranslationContext,\n  options: {\n    /** Handler URL for creating the missing translation */\n    createTranslationUrl?: string;\n    /** Panel name for action dispatch */\n    panelName?: string;\n    /** Show create translation button */\n    showCreateButton?: boolean;\n  } = {}\n): string {\n  if (!context.fallbackUsed && !context.missingRequestedLocale) {\n    return '';\n  }\n\n  const { showCreateButton = true, createTranslationUrl, panelName } = options;\n  const requestedLocale = context.requestedLocale || 'requested locale';\n  const resolvedLocale = context.resolvedLocale || 'default';\n\n  const createButtonHtml = showCreateButton ? `\n    <button type=\"button\"\n            class=\"inline-flex items-center gap-1 text-sm font-medium text-amber-800 hover:text-amber-900 underline\"\n            data-action=\"create-translation\"\n            data-locale=\"${context.requestedLocale || ''}\"\n            data-panel=\"${panelName || ''}\"\n            data-record-id=\"${context.recordId || ''}\"\n            ${createTranslationUrl ? `data-url=\"${createTranslationUrl}\"` : ''}>\n      <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n      </svg>\n      Create ${requestedLocale.toUpperCase()} translation\n    </button>\n  ` : '';\n\n  return `\n    <div class=\"fallback-warning bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4\"\n         role=\"alert\"\n         aria-live=\"polite\"\n         data-fallback-mode=\"true\"\n         data-requested-locale=\"${context.requestedLocale || ''}\"\n         data-resolved-locale=\"${context.resolvedLocale || ''}\">\n      <div class=\"flex items-start gap-3\">\n        <div class=\"flex-shrink-0\">\n          <svg class=\"w-5 h-5 text-amber-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n          </svg>\n        </div>\n        <div class=\"flex-1\">\n          <h3 class=\"text-sm font-medium text-amber-800\">\n            Viewing fallback content\n          </h3>\n          <p class=\"mt-1 text-sm text-amber-700\">\n            The <strong>${requestedLocale.toUpperCase()}</strong> translation doesn't exist yet.\n            You're viewing content from <strong>${resolvedLocale.toUpperCase()}</strong>.\n            <span class=\"block mt-1 text-amber-600\">Editing is disabled until you create the missing translation.</span>\n          </p>\n          ${createButtonHtml ? `<div class=\"mt-3\">${createButtonHtml}</div>` : ''}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n// ============================================================================\n// Cell Renderer Factory\n// ============================================================================\n\n/**\n * Create a cell renderer for translation status that can be used with DataGrid.\n * Returns a function compatible with the CellRenderer type.\n *\n * @param options - Rendering options\n * @returns CellRenderer function\n */\nexport function createTranslationStatusRenderer(\n  options: TranslationStatusOptions = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderTranslationStatusCell(record, options);\n  };\n}\n\n/**\n * Create a cell renderer for locale badge only.\n */\nexport function createLocaleBadgeRenderer(\n  options: LocaleBadgeOptions = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderLocaleBadge(record, options);\n  };\n}\n\n// ============================================================================\n// Internal Helpers\n// ============================================================================\n\n/**\n * Extract a string field from a record, trying multiple paths.\n */\nfunction extractStringField(record: Record<string, unknown>, paths: string[]): string | null {\n  for (const path of paths) {\n    const value = getNestedValue(record, path);\n    if (typeof value === 'string' && value.trim()) {\n      return value;\n    }\n  }\n  return null;\n}\n\n/**\n * Extract a string array field from a record, trying multiple paths.\n */\nfunction extractStringArrayField(record: Record<string, unknown>, paths: string[]): string[] {\n  for (const path of paths) {\n    const value = getNestedValue(record, path);\n    if (Array.isArray(value)) {\n      return value.filter((v): v is string => typeof v === 'string');\n    }\n  }\n  return [];\n}\n\n/**\n * Extract a boolean field from a record, trying multiple paths.\n */\nfunction extractBooleanField(record: Record<string, unknown>, paths: string[]): boolean {\n  for (const path of paths) {\n    const value = getNestedValue(record, path);\n    if (typeof value === 'boolean') {\n      return value;\n    }\n    // Also handle string \"true\"/\"false\"\n    if (value === 'true') return true;\n    if (value === 'false') return false;\n  }\n  return false;\n}\n\n/**\n * Get a nested value from an object using dot notation.\n */\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  const parts = path.split('.');\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined || typeof current !== 'object') {\n      return undefined;\n    }\n    current = (current as Record<string, unknown>)[part];\n  }\n\n  return current;\n}\n","/**\n * Cell Renderers for DataGrid\n * Provides extensible cell rendering capabilities\n */\n\nimport { badge, booleanChip as sharedBooleanChip } from '../shared/badge.js';\nimport { renderIcon } from '../shared/icon-renderer.js';\nimport {\n  renderLocaleBadge,\n  renderTranslationStatusCell,\n  createTranslationStatusRenderer,\n  createLocaleBadgeRenderer\n} from './translation-context.js';\n\nconst EMPTY_CELL_HTML = '<span class=\"text-gray-400\">-</span>';\nconst DEFAULT_OBJECT_LABEL_KEYS = [\n  'name',\n  'label',\n  'title',\n  'slug',\n  'id',\n  'code',\n  'key',\n  'value',\n  'type',\n  'blockType',\n  'block_type',\n];\n\nexport interface CellRendererContext {\n  options?: Record<string, any>;\n}\n\nexport type CellRenderer = (value: any, record: any, column: string, context?: CellRendererContext) => string;\n\nfunction escapeHtml(value: string): string {\n  return value\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction compactJSON(value: any): string {\n  try {\n    return JSON.stringify(value);\n  } catch {\n    return String(value);\n  }\n}\n\nfunction normalizeDisplayKeys(options: Record<string, any>): string[] {\n  const keys: string[] = [];\n  const pushKey = (candidate: any) => {\n    if (typeof candidate !== 'string') return;\n    const key = candidate.trim();\n    if (!key || keys.includes(key)) return;\n    keys.push(key);\n  };\n  pushKey(options.display_key);\n  pushKey(options.displayKey);\n  const listCandidate = options.display_keys ?? options.displayKeys;\n  if (Array.isArray(listCandidate)) {\n    listCandidate.forEach(pushKey);\n  }\n  return keys;\n}\n\nfunction objectValueByPath(value: Record<string, any>, key: string): any {\n  if (!key) return undefined;\n  if (Object.prototype.hasOwnProperty.call(value, key)) {\n    return value[key];\n  }\n  if (!key.includes('.')) {\n    return undefined;\n  }\n  const segments = key.split('.');\n  let current: any = value;\n  for (const segment of segments) {\n    if (!current || typeof current !== 'object' || Array.isArray(current)) {\n      return undefined;\n    }\n    if (!Object.prototype.hasOwnProperty.call(current, segment)) {\n      return undefined;\n    }\n    current = current[segment];\n  }\n  return current;\n}\n\nfunction scalarSummary(value: any): string {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  switch (typeof value) {\n    case 'string':\n      return value.trim();\n    case 'number':\n    case 'bigint':\n      return String(value);\n    case 'boolean':\n      return value ? 'true' : 'false';\n    default:\n      return '';\n  }\n}\n\nfunction summarizeObjectValue(value: any, options: Record<string, any>): string {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  if (Array.isArray(value)) {\n    return summarizeArrayValue(value, options);\n  }\n  if (typeof value !== 'object') {\n    return String(value);\n  }\n\n  const displayKeys = normalizeDisplayKeys(options);\n  const keys = [...displayKeys, ...DEFAULT_OBJECT_LABEL_KEYS];\n  const seen = new Set<string>();\n  for (const key of keys) {\n    if (seen.has(key)) continue;\n    seen.add(key);\n    const candidate = objectValueByPath(value as Record<string, any>, key);\n    const summary = scalarSummary(candidate);\n    if (summary) {\n      return summary;\n    }\n  }\n\n  return compactJSON(value);\n}\n\nfunction summarizeArrayValue(value: any[], options: Record<string, any>): string {\n  if (!Array.isArray(value) || value.length === 0) {\n    return '';\n  }\n  const normalized = value\n    .map(item => summarizeObjectValue(item, options).trim())\n    .filter(Boolean);\n  if (normalized.length === 0) {\n    return '';\n  }\n  const rawLimit = Number(options.preview_limit ?? options.previewLimit ?? 3);\n  const limit = Number.isFinite(rawLimit) && rawLimit > 0 ? Math.floor(rawLimit) : 3;\n  const preview = normalized.slice(0, limit);\n  if (normalized.length <= limit) {\n    return preview.join(', ');\n  }\n  return `${preview.join(', ')} +${normalized.length - limit} more`;\n}\n\n// ---------------------------------------------------------------------------\n// blocks_chips helper functions\n// ---------------------------------------------------------------------------\n\n/**\n * Normalizes a number option from renderer_options, checking both snake_case and camelCase keys.\n */\nfunction normalizeNumberOption(\n  options: Record<string, any>,\n  snakeKey: string,\n  camelKey: string,\n  defaultValue: number\n): number {\n  const raw = options[snakeKey] ?? options[camelKey] ?? defaultValue;\n  const parsed = Number(raw);\n  return Number.isFinite(parsed) && parsed > 0 ? Math.floor(parsed) : defaultValue;\n}\n\n/**\n * Normalizes a boolean option from renderer_options, checking both snake_case and camelCase keys.\n */\nfunction normalizeBooleanOption(\n  options: Record<string, any>,\n  snakeKey: string,\n  camelKey: string,\n  defaultValue: boolean\n): boolean {\n  const raw = options[snakeKey] ?? options[camelKey];\n  if (raw === undefined || raw === null) {\n    return defaultValue;\n  }\n  if (typeof raw === 'boolean') {\n    return raw;\n  }\n  if (typeof raw === 'string') {\n    return raw.toLowerCase() === 'true' || raw === '1';\n  }\n  return Boolean(raw);\n}\n\n/**\n * Normalizes a string option from renderer_options, checking both snake_case and camelCase keys.\n */\nfunction normalizeStringOption(\n  options: Record<string, any>,\n  snakeKey: string,\n  camelKey: string,\n  defaultValue: string\n): string {\n  const raw = options[snakeKey] ?? options[camelKey];\n  if (raw === undefined || raw === null) {\n    return defaultValue;\n  }\n  const str = String(raw).trim();\n  return str || defaultValue;\n}\n\n/**\n * Block label resolution order: _type, type, blockType, block_type, then string value fallback.\n */\nfunction resolveBlockLabel(item: any): string {\n  if (item === null || item === undefined) {\n    return '';\n  }\n  // Legacy string array support\n  if (typeof item === 'string') {\n    return item.trim();\n  }\n  if (typeof item !== 'object') {\n    return String(item).trim();\n  }\n  // Embedded objects: check type keys in order\n  const typeKeys = ['_type', 'type', 'blockType', 'block_type'];\n  for (const key of typeKeys) {\n    const val = item[key];\n    if (typeof val === 'string' && val.trim()) {\n      return val.trim();\n    }\n  }\n  return '';\n}\n\n/**\n * Returns Tailwind classes for chip variant styling.\n */\nfunction blocksChipVariantClass(variant: string): string {\n  switch (variant) {\n    case 'muted':\n      return 'bg-gray-100 text-gray-600';\n    case 'outline':\n      return 'bg-white border border-gray-300 text-gray-700';\n    case 'default':\n    default:\n      return 'bg-blue-50 text-blue-700';\n  }\n}\n\nexport class CellRendererRegistry {\n  private renderers: Map<string, CellRenderer> = new Map();\n\n  constructor() {\n    this.registerDefaultRenderers();\n  }\n\n  /**\n   * Register a custom renderer for a column\n   */\n  register(column: string, renderer: CellRenderer): void {\n    this.renderers.set(column, renderer);\n  }\n\n  /**\n   * Get renderer for a column (fallback to default)\n   */\n  get(column: string): CellRenderer {\n    return this.renderers.get(column) || this.defaultRenderer;\n  }\n\n  /**\n   * Check if a custom renderer exists\n   */\n  has(column: string): boolean {\n    return this.renderers.has(column);\n  }\n\n  /**\n   * Default renderer - just returns the value as string\n   */\n  private defaultRenderer: CellRenderer = (value: any): string => {\n    if (value === null || value === undefined) {\n      return EMPTY_CELL_HTML;\n    }\n    if (typeof value === 'boolean') {\n      return value ? 'Yes' : 'No';\n    }\n    if (Array.isArray(value)) {\n      const summary = summarizeArrayValue(value, {});\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    }\n    if (typeof value === 'object') {\n      const summary = summarizeObjectValue(value, {});\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    }\n    return String(value);\n  };\n\n  /**\n   * Register built-in renderers\n   */\n  private registerDefaultRenderers(): void {\n    // Status badge renderer\n    this.renderers.set('_badge', (value: any): string => {\n      const variant = String(value).toLowerCase();\n      return badge(String(value), 'status', variant);\n    });\n\n    // Date/time renderer\n    this.renderers.set('_date', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      try {\n        const date = new Date(value);\n        return date.toLocaleDateString();\n      } catch {\n        return String(value);\n      }\n    });\n\n    // DateTime renderer\n    this.renderers.set('_datetime', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      try {\n        const date = new Date(value);\n        return date.toLocaleString();\n      } catch {\n        return String(value);\n      }\n    });\n\n    // Boolean renderer\n    this.renderers.set('_boolean', (value: any): string => {\n      const isTrue = Boolean(value);\n      const icon = isTrue\n        ? '<svg class=\"w-5 h-5 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/></svg>'\n        : '<svg class=\"w-5 h-5 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clip-rule=\"evenodd\"/></svg>';\n      return `<div class=\"flex justify-center\">${icon}</div>`;\n    });\n\n    // Link renderer\n    this.renderers.set('_link', (value: any, record: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      const href = record.url || record.link || '#';\n      return `<a href=\"${href}\" class=\"text-blue-600 hover:text-blue-800 underline\">${value}</a>`;\n    });\n\n    // Email renderer\n    this.renderers.set('_email', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      return `<a href=\"mailto:${value}\" class=\"text-blue-600 hover:text-blue-800\">${value}</a>`;\n    });\n\n    // URL renderer\n    this.renderers.set('_url', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      return `<a href=\"${value}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1\">\n        ${value}\n        <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n        </svg>\n      </a>`;\n    });\n\n    // Number formatter\n    this.renderers.set('_number', (value: any): string => {\n      if (value === null || value === undefined) return '<span class=\"text-gray-400\">-</span>';\n      return Number(value).toLocaleString();\n    });\n\n    // Currency formatter\n    this.renderers.set('_currency', (value: any): string => {\n      if (value === null || value === undefined) return '<span class=\"text-gray-400\">-</span>';\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD'\n      }).format(Number(value));\n    });\n\n    // Percentage formatter\n    this.renderers.set('_percentage', (value: any): string => {\n      if (value === null || value === undefined) return '<span class=\"text-gray-400\">-</span>';\n      return `${Number(value).toFixed(2)}%`;\n    });\n\n    // File size formatter\n    this.renderers.set('_filesize', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      const bytes = Number(value);\n      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n      if (bytes === 0) return '0 Bytes';\n      const i = Math.floor(Math.log(bytes) / Math.log(1024));\n      return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;\n    });\n\n    // Truncate text renderer\n    this.renderers.set('_truncate', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      const text = String(value);\n      const maxLength = 50;\n      if (text.length <= maxLength) return text;\n      return `<span title=\"${text}\">${text.substring(0, maxLength)}...</span>`;\n    });\n\n    // Array renderer (supports scalar and object arrays)\n    this.renderers.set('_array', (value: any, _record: any, _column: string, context?: CellRendererContext): string => {\n      if (!Array.isArray(value) || value.length === 0) {\n        return EMPTY_CELL_HTML;\n      }\n      const options = context?.options || {};\n      const summary = summarizeArrayValue(value, options);\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    });\n\n    // Object renderer with configurable display-key hints\n    this.renderers.set('_object', (value: any, _record: any, _column: string, context?: CellRendererContext): string => {\n      if (value === null || value === undefined) {\n        return EMPTY_CELL_HTML;\n      }\n      const options = context?.options || {};\n      const summary = summarizeObjectValue(value, options);\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    });\n\n    // Tags/badges renderer\n    this.renderers.set('_tags', (value: any): string => {\n      if (!Array.isArray(value) || value.length === 0) {\n        return '<span class=\"text-gray-400\">-</span>';\n      }\n      return value.map(tag =>\n        `<span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mr-1\">${tag}</span>`\n      ).join('');\n    });\n\n    // Blocks chips renderer - displays block items as styled chips with icons\n    this.renderers.set('blocks_chips', (value: any, _record: any, _column: string, context?: CellRendererContext): string => {\n      if (!Array.isArray(value) || value.length === 0) {\n        return EMPTY_CELL_HTML;\n      }\n      const options = context?.options || {};\n      const maxVisible = normalizeNumberOption(options, 'max_visible', 'maxVisible', 3);\n      const showCount = normalizeBooleanOption(options, 'show_count', 'showCount', true);\n      const chipVariant = normalizeStringOption(options, 'chip_variant', 'chipVariant', 'default');\n      const iconMap: Record<string, string> = options.block_icons_map || options.blockIconsMap || {};\n\n      const chips: string[] = [];\n      const visibleItems = value.slice(0, maxVisible);\n\n      for (const item of visibleItems) {\n        const label = resolveBlockLabel(item);\n        if (!label) continue;\n        const iconRef = iconMap[label] || 'view-grid';\n        const iconHtml = renderIcon(iconRef, { size: '14px', extraClass: 'flex-shrink-0' });\n        const variantClass = blocksChipVariantClass(chipVariant);\n        chips.push(\n          `<span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${variantClass}\">${iconHtml}<span>${escapeHtml(label)}</span></span>`\n        );\n      }\n\n      if (chips.length === 0) {\n        return EMPTY_CELL_HTML;\n      }\n\n      const remaining = value.length - maxVisible;\n      let overflowBadge = '';\n      if (showCount && remaining > 0) {\n        overflowBadge = `<span class=\"px-2 py-0.5 rounded text-xs bg-gray-200 text-gray-600\">+${remaining} more</span>`;\n      }\n\n      return `<div class=\"flex flex-wrap gap-1\">${chips.join('')}${overflowBadge}</div>`;\n    });\n\n    // Image thumbnail renderer\n    this.renderers.set('_image', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      return `<img src=\"${value}\" alt=\"Thumbnail\" class=\"h-10 w-10 rounded object-cover\" />`;\n    });\n\n    // Avatar renderer\n    this.renderers.set('_avatar', (value: any, record: any): string => {\n      const name = record.name || record.username || record.email || 'U';\n      const initial = name.charAt(0).toUpperCase();\n      if (value) {\n        return `<img src=\"${value}\" alt=\"${name}\" class=\"h-8 w-8 rounded-full object-cover\" />`;\n      }\n      return `<div class=\"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium text-sm\">${initial}</div>`;\n    });\n  }\n}\n\n/**\n * Pre-built cell renderers for common use cases\n */\nexport const CommonRenderers = {\n  /**\n   * Status badge renderer with custom colors\n   */\n  statusBadge: (_colorMap?: Record<string, string>): CellRenderer => {\n    return (value: any): string => {\n      const variant = String(value).toLowerCase();\n      return badge(String(value), 'status', variant);\n    };\n  },\n\n  /**\n   * Role badge renderer with color mapping\n   */\n  roleBadge: (_colorMap?: Record<string, string>): CellRenderer => {\n    return (value: any): string => {\n      const role = String(value).toLowerCase();\n      return badge(String(value), 'role', role);\n    };\n  },\n\n  /**\n   * Combined name+email renderer\n   */\n  userInfo: (value: any, record: any): string => {\n    const name = value || record.name || record.username || '-';\n    const email = record.email || '';\n    if (email) {\n      return `<div><div class=\"font-medium text-gray-900\">${name}</div><div class=\"text-sm text-gray-500\">${email}</div></div>`;\n    }\n    return `<div class=\"font-medium text-gray-900\">${name}</div>`;\n  },\n\n  /**\n   * Boolean chip renderer with icon + label (e.g., [✓ Yes] or [✕ No])\n   */\n  booleanChip: (options?: { trueLabel?: string; falseLabel?: string }): CellRenderer => {\n    return (value: any): string => {\n      return sharedBooleanChip(Boolean(value), options);\n    };\n  },\n\n  /**\n   * Relative time renderer (e.g., \"2 hours ago\")\n   */\n  relativeTime: (value: any): string => {\n    if (!value) return '<span class=\"text-gray-400\">-</span>';\n    try {\n      const date = new Date(value);\n      const now = new Date();\n      const diffMs = now.getTime() - date.getTime();\n      const diffMins = Math.floor(diffMs / 60000);\n      const diffHours = Math.floor(diffMs / 3600000);\n      const diffDays = Math.floor(diffMs / 86400000);\n\n      if (diffMins < 1) return 'Just now';\n      if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;\n      if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\n      if (diffDays < 30) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\n      return date.toLocaleDateString();\n    } catch {\n      return String(value);\n    }\n  },\n\n  /**\n   * Locale badge renderer - shows current locale with fallback indicator\n   */\n  localeBadge: createLocaleBadgeRenderer(),\n\n  /**\n   * Translation status renderer - shows locale + available locales\n   */\n  translationStatus: createTranslationStatusRenderer(),\n\n  /**\n   * Compact translation status for smaller cells\n   */\n  translationStatusCompact: createTranslationStatusRenderer({ size: 'sm', maxLocales: 2 }),\n};\n","import type { ColumnFilter, SortColumn } from './behaviors/types.js';\nimport type { ViewMode, GroupExpandMode } from './grouped-mode.js';\n\nexport type DataGridStateStoreMode = 'local' | 'preferences';\n\nexport interface DataGridPersistedState {\n  version: 1;\n  viewMode?: ViewMode;\n  expandMode?: GroupExpandMode;\n  expandedGroups?: string[];\n  hiddenColumns?: string[];\n  columnOrder?: string[];\n  updatedAt?: number;\n}\n\nexport interface DataGridShareState {\n  version: 1;\n  search?: string;\n  page?: number;\n  perPage?: number;\n  filters?: ColumnFilter[];\n  sort?: SortColumn[];\n  persisted?: DataGridPersistedState;\n  updatedAt?: number;\n}\n\nexport interface DataGridStateStore {\n  hydrate?(): Promise<void>;\n  loadPersistedState(): DataGridPersistedState | null;\n  savePersistedState(state: DataGridPersistedState): void;\n  clearPersistedState(): void;\n  createShareState(state: DataGridShareState): string | null;\n  resolveShareState(token: string): DataGridShareState | null;\n}\n\nexport interface DataGridStateStoreConfig {\n  key: string;\n  mode?: DataGridStateStoreMode;\n  preferencesEndpoint?: string;\n  resource?: string;\n  syncDebounceMs?: number;\n  maxShareEntries?: number;\n}\n\nconst PERSISTED_PREFIX = 'datagrid.state.';\nconst SHARE_PREFIX = 'datagrid.share.';\nconst SHARE_INDEX_KEY = 'datagrid.share.index';\nconst DEFAULT_MAX_SHARE_ENTRIES = 20;\n\nfunction toStorageKey(value: string): string {\n  const trimmed = String(value || '').trim();\n  return trimmed || 'default';\n}\n\nfunction normalizeStringArray(value: unknown, options: { allowEmpty?: boolean } = {}): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  const out = value\n    .map((entry) => (typeof entry === 'string' ? entry.trim() : ''))\n    .filter((entry) => entry.length > 0);\n  if (out.length === 0) {\n    return options.allowEmpty === true ? [] : undefined;\n  }\n  return Array.from(new Set(out));\n}\n\nfunction normalizePersistedState(value: unknown): DataGridPersistedState | null {\n  if (!value || typeof value !== 'object' || Array.isArray(value)) {\n    return null;\n  }\n  const record = value as Record<string, unknown>;\n  const out: DataGridPersistedState = { version: 1 };\n\n  if (record.viewMode === 'flat' || record.viewMode === 'grouped' || record.viewMode === 'matrix') {\n    out.viewMode = record.viewMode;\n  }\n  if (record.expandMode === 'all' || record.expandMode === 'none' || record.expandMode === 'explicit') {\n    out.expandMode = record.expandMode;\n  }\n  const expanded = normalizeStringArray(record.expandedGroups, { allowEmpty: true });\n  if (expanded !== undefined) out.expandedGroups = expanded;\n  const hiddenColumns = normalizeStringArray(record.hiddenColumns, { allowEmpty: true });\n  if (hiddenColumns !== undefined) out.hiddenColumns = hiddenColumns;\n  const columnOrder = normalizeStringArray(record.columnOrder);\n  if (columnOrder) out.columnOrder = columnOrder;\n  if (typeof record.updatedAt === 'number' && Number.isFinite(record.updatedAt)) {\n    out.updatedAt = record.updatedAt;\n  }\n  return out;\n}\n\nfunction normalizeShareState(value: unknown): DataGridShareState | null {\n  if (!value || typeof value !== 'object' || Array.isArray(value)) {\n    return null;\n  }\n  const record = value as Record<string, unknown>;\n  const out: DataGridShareState = { version: 1 };\n\n  if (typeof record.search === 'string') {\n    const search = record.search.trim();\n    if (search) out.search = search;\n  }\n  if (typeof record.page === 'number' && Number.isFinite(record.page)) {\n    out.page = Math.max(1, Math.trunc(record.page));\n  }\n  if (typeof record.perPage === 'number' && Number.isFinite(record.perPage)) {\n    out.perPage = Math.max(1, Math.trunc(record.perPage));\n  }\n  if (Array.isArray(record.filters)) {\n    out.filters = record.filters as ColumnFilter[];\n  }\n  if (Array.isArray(record.sort)) {\n    out.sort = record.sort as SortColumn[];\n  }\n  const persisted = normalizePersistedState(record.persisted);\n  if (persisted) {\n    out.persisted = persisted;\n  }\n  if (typeof record.updatedAt === 'number' && Number.isFinite(record.updatedAt)) {\n    out.updatedAt = record.updatedAt;\n  }\n  return out;\n}\n\nfunction normalizePreferencesEndpoint(value?: string): string {\n  const trimmed = String(value || '').trim();\n  if (!trimmed) return '/api/panels/preferences';\n  return trimmed.replace(/\\/+$/, '');\n}\n\nfunction normalizeResource(value?: string): string {\n  return String(value || '').trim().replace(/[^a-zA-Z0-9._-]/g, '');\n}\n\nfunction newShareToken(): string {\n  const time = Date.now().toString(36);\n  const rand = Math.random().toString(36).slice(2, 10);\n  return `${time}${rand}`.slice(0, 16);\n}\n\ninterface ShareIndexEntry {\n  token: string;\n  updatedAt: number;\n}\n\nfunction loadShareIndex(maxEntries: number): ShareIndexEntry[] {\n  try {\n    const raw = localStorage.getItem(SHARE_INDEX_KEY);\n    if (!raw) return [];\n    const parsed = JSON.parse(raw);\n    if (!Array.isArray(parsed)) return [];\n    const normalized = parsed\n      .map((entry): ShareIndexEntry | null => {\n        if (!entry || typeof entry !== 'object' || Array.isArray(entry)) return null;\n        const rec = entry as Record<string, unknown>;\n        const token = typeof rec.token === 'string' ? rec.token.trim() : '';\n        const updatedAt = typeof rec.updatedAt === 'number' ? rec.updatedAt : 0;\n        if (!token || !Number.isFinite(updatedAt)) return null;\n        return { token, updatedAt };\n      })\n      .filter((entry): entry is ShareIndexEntry => entry !== null)\n      .sort((a, b) => b.updatedAt - a.updatedAt);\n    if (normalized.length <= maxEntries) {\n      return normalized;\n    }\n    return normalized.slice(0, maxEntries);\n  } catch {\n    return [];\n  }\n}\n\nfunction saveShareIndex(index: ShareIndexEntry[]): void {\n  try {\n    localStorage.setItem(SHARE_INDEX_KEY, JSON.stringify(index));\n  } catch {\n    // Ignore storage failures.\n  }\n}\n\nexport class LocalDataGridStateStore implements DataGridStateStore {\n  protected readonly key: string;\n  protected readonly persistedStorageKey: string;\n  protected readonly maxShareEntries: number;\n\n  constructor(config: DataGridStateStoreConfig) {\n    const normalizedKey = toStorageKey(config.key);\n    this.key = normalizedKey;\n    this.persistedStorageKey = `${PERSISTED_PREFIX}${normalizedKey}`;\n    this.maxShareEntries = Math.max(1, config.maxShareEntries || DEFAULT_MAX_SHARE_ENTRIES);\n  }\n\n  loadPersistedState(): DataGridPersistedState | null {\n    try {\n      const raw = localStorage.getItem(this.persistedStorageKey);\n      if (!raw) return null;\n      return normalizePersistedState(JSON.parse(raw));\n    } catch {\n      return null;\n    }\n  }\n\n  savePersistedState(state: DataGridPersistedState): void {\n    const normalized = normalizePersistedState(state);\n    if (!normalized) return;\n    if (!normalized.updatedAt) {\n      normalized.updatedAt = Date.now();\n    }\n    try {\n      localStorage.setItem(this.persistedStorageKey, JSON.stringify(normalized));\n    } catch {\n      // Ignore storage failures.\n    }\n  }\n\n  clearPersistedState(): void {\n    try {\n      localStorage.removeItem(this.persistedStorageKey);\n    } catch {\n      // Ignore storage failures.\n    }\n  }\n\n  createShareState(state: DataGridShareState): string | null {\n    const normalized = normalizeShareState(state);\n    if (!normalized) return null;\n    if (!normalized.updatedAt) {\n      normalized.updatedAt = Date.now();\n    }\n    const token = newShareToken();\n    const storageKey = `${SHARE_PREFIX}${token}`;\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(normalized));\n      const nextIndex = loadShareIndex(this.maxShareEntries)\n        .filter((entry) => entry.token !== token);\n      nextIndex.unshift({ token, updatedAt: normalized.updatedAt });\n      while (nextIndex.length > this.maxShareEntries) {\n        const removed = nextIndex.pop();\n        if (removed) {\n          localStorage.removeItem(`${SHARE_PREFIX}${removed.token}`);\n        }\n      }\n      saveShareIndex(nextIndex);\n      return token;\n    } catch {\n      return null;\n    }\n  }\n\n  resolveShareState(token: string): DataGridShareState | null {\n    const normalizedToken = String(token || '').trim();\n    if (!normalizedToken) return null;\n    try {\n      const raw = localStorage.getItem(`${SHARE_PREFIX}${normalizedToken}`);\n      if (!raw) return null;\n      return normalizeShareState(JSON.parse(raw));\n    } catch {\n      return null;\n    }\n  }\n}\n\nexport class PreferencesDataGridStateStore extends LocalDataGridStateStore {\n  private readonly preferencesEndpoint: string;\n  private readonly resource: string;\n  private readonly syncDebounceMs: number;\n  private syncTimeout: ReturnType<typeof setTimeout> | null = null;\n\n  constructor(config: DataGridStateStoreConfig) {\n    super(config);\n    this.preferencesEndpoint = normalizePreferencesEndpoint(config.preferencesEndpoint);\n    this.resource = normalizeResource(config.resource) || this.key;\n    this.syncDebounceMs = Math.max(100, config.syncDebounceMs || 1000);\n  }\n\n  private get serverStateKey(): string {\n    return `ui.datagrid.${this.resource}.state`;\n  }\n\n  async hydrate(): Promise<void> {\n    try {\n      const url = this.buildKeysQueryURL(this.serverStateKey);\n      const response = await fetch(url, {\n        method: 'GET',\n        credentials: 'same-origin',\n        headers: {\n          Accept: 'application/json',\n        },\n      });\n      if (!response.ok) {\n        return;\n      }\n      const payload = await response.json();\n      const record = this.extractFirstRecord(payload);\n      if (!record) return;\n      const effective = this.extractMap(record.effective);\n      const raw = this.extractMap(record.raw);\n      const candidate = effective[this.serverStateKey] ?? raw[this.serverStateKey];\n      const normalized = normalizePersistedState(candidate);\n      if (normalized) {\n        super.savePersistedState(normalized);\n      }\n    } catch {\n      // Ignore hydrate failures and fall back to local cache.\n    }\n  }\n\n  override savePersistedState(state: DataGridPersistedState): void {\n    super.savePersistedState(state);\n    const normalized = normalizePersistedState(state);\n    if (!normalized) return;\n    this.scheduleServerSync(normalized);\n  }\n\n  override clearPersistedState(): void {\n    super.clearPersistedState();\n    this.scheduleServerClear();\n  }\n\n  private scheduleServerSync(state: DataGridPersistedState): void {\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n    }\n    this.syncTimeout = setTimeout(() => {\n      void this.syncToServer(state);\n    }, this.syncDebounceMs);\n  }\n\n  private scheduleServerClear(): void {\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n    }\n    this.syncTimeout = setTimeout(() => {\n      void this.clearServerState();\n    }, this.syncDebounceMs);\n  }\n\n  private async syncToServer(state: DataGridPersistedState): Promise<void> {\n    try {\n      await fetch(this.preferencesEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n        body: JSON.stringify({\n          raw: {\n            [this.serverStateKey]: state,\n          },\n        }),\n      });\n    } catch {\n      // Ignore sync failures and keep local state authoritative.\n    }\n  }\n\n  private async clearServerState(): Promise<void> {\n    try {\n      await fetch(this.preferencesEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n        body: JSON.stringify({\n          clear_raw_keys: [this.serverStateKey],\n        }),\n      });\n    } catch {\n      // Ignore clear failures.\n    }\n  }\n\n  private buildKeysQueryURL(key: string): string {\n    const separator = this.preferencesEndpoint.includes('?') ? '&' : '?';\n    return `${this.preferencesEndpoint}${separator}keys=${encodeURIComponent(key)}`;\n  }\n\n  private extractFirstRecord(payload: unknown): Record<string, unknown> | null {\n    if (!payload || typeof payload !== 'object' || Array.isArray(payload)) {\n      return null;\n    }\n    const root = payload as Record<string, unknown>;\n    const records = Array.isArray(root.records)\n      ? root.records\n      : Array.isArray(root.data)\n        ? root.data\n        : [];\n    if (records.length === 0) return null;\n    const first = records[0];\n    if (!first || typeof first !== 'object' || Array.isArray(first)) {\n      return null;\n    }\n    return first as Record<string, unknown>;\n  }\n\n  private extractMap(value: unknown): Record<string, unknown> {\n    if (!value || typeof value !== 'object' || Array.isArray(value)) {\n      return {};\n    }\n    return value as Record<string, unknown>;\n  }\n}\n\nexport function createDataGridStateStore(config: DataGridStateStoreConfig): DataGridStateStore {\n  const mode = config.mode || 'local';\n  if (mode === 'preferences') {\n    return new PreferencesDataGridStateStore(config);\n  }\n  return new LocalDataGridStateStore(config);\n}\n","/**\n * Grouped Mode Utilities for DataGrid (Phase 2)\n *\n * Provides data transformation, state management, and rendering support\n * for translation-grouped content views.\n *\n * Contract:\n * - Groups records by `translation_group_id`\n * - Preserves backend-provided group summaries when available\n * - Falls back to client-computed summaries when backend omits them\n * - Maintains expand/collapse state with persistence\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * View mode for DataGrid\n *\n * View modes control how translation-enabled content is displayed:\n *\n * - **flat**: Standard list view. Each record is a separate row.\n *   Cell renderers show basic translation status badges.\n *\n * - **grouped**: Records are grouped by `translation_group_id`.\n *   Expandable group headers show aggregate translation state.\n *   Child rows are collapsible under each group.\n *\n * - **matrix**: Grouped layout with compact locale status icons.\n *   Uses `renderTranslationMatrixCell()` to show per-locale status (●/◐/○)\n *   for each required locale in a single cell. This is a \"matrix summary\"\n *   representation where locale status icons are inline, NOT separate columns.\n *\n * Note: A \"true locale-column matrix\" (separate column per locale) is not\n * currently implemented. The current matrix mode provides locale status\n * visibility within the grouped row structure.\n *\n * Both 'grouped' and 'matrix' modes share the same expand/collapse behavior,\n * URL state sync, and pagination handling. The difference is purely visual:\n * the cell renderer switches to compact locale chips in matrix mode.\n */\nexport type ViewMode = 'flat' | 'grouped' | 'matrix';\nexport type GroupExpandMode = 'all' | 'none' | 'explicit';\n\n/**\n * Group summary from backend or computed locally\n */\nexport interface GroupSummary {\n  /** Total items in the group */\n  totalItems: number;\n  /** Number of available/complete locales */\n  availableLocales: string[];\n  /** Number of missing locales */\n  missingLocales: string[];\n  /** Overall readiness state */\n  readinessState: 'ready' | 'missing_locales' | 'missing_fields' | 'missing_locales_and_fields' | null;\n  /** Ready for publish transition */\n  readyForPublish: boolean | null;\n}\n\n/**\n * A group of records sharing the same translation_group_id\n */\nexport interface RecordGroup {\n  /** The translation_group_id */\n  groupId: string;\n  /** Optional display label for group headers */\n  displayLabel?: string;\n  /** Records in this group */\n  records: Record<string, unknown>[];\n  /** Group summary (from backend or computed) */\n  summary: GroupSummary;\n  /** Whether this group is expanded (for UI) */\n  expanded: boolean;\n  /** Whether summary came from backend */\n  summaryFromBackend: boolean;\n}\n\n/**\n * Result of grouping transformation\n */\nexport interface GroupedData {\n  /** Groups of records */\n  groups: RecordGroup[];\n  /** Ungrouped records (no translation_group_id) */\n  ungrouped: Record<string, unknown>[];\n  /** Total group count */\n  totalGroups: number;\n  /** Total record count */\n  totalRecords: number;\n}\n\n/**\n * Options for group transformation\n */\nexport interface GroupTransformOptions {\n  /** Field to group by (default: translation_group_id) */\n  groupByField?: string;\n  /** Default expanded state for groups */\n  defaultExpanded?: boolean;\n  /** Expansion mode */\n  expandMode?: GroupExpandMode;\n  /** Previously expanded group IDs */\n  expandedGroups?: Set<string>;\n}\n\n/**\n * Backend grouped row shape for `group_by=translation_group_id`.\n */\ninterface BackendGroupedRow {\n  translation_group_id?: string;\n  group_by?: string;\n  records?: unknown;\n  children?: unknown;\n  parent?: unknown;\n  translation_group_summary?: unknown;\n  _group?: unknown;\n}\n\n// ============================================================================\n// Group Data Transformation (TX-055)\n// ============================================================================\n\n/**\n * Transform flat records into grouped structure by translation_group_id.\n *\n * @param records - Array of records from API\n * @param options - Grouping options\n * @returns Grouped data structure\n */\nexport function transformToGroups(\n  records: Record<string, unknown>[],\n  options: GroupTransformOptions = {}\n): GroupedData {\n  const {\n    groupByField = 'translation_group_id',\n    defaultExpanded = true,\n    expandMode = 'explicit',\n    expandedGroups = new Set<string>(),\n  } = options;\n\n  const groupMap = new Map<string, Record<string, unknown>[]>();\n  const ungrouped: Record<string, unknown>[] = [];\n\n  // Partition records by group ID\n  for (const record of records) {\n    const groupId = getGroupId(record, groupByField);\n\n    if (groupId) {\n      const existing = groupMap.get(groupId);\n      if (existing) {\n        existing.push(record);\n      } else {\n        groupMap.set(groupId, [record]);\n      }\n    } else {\n      ungrouped.push(record);\n    }\n  }\n\n  // Transform map to RecordGroup array\n  const groups: RecordGroup[] = [];\n  for (const [groupId, groupRecords] of groupMap) {\n    const summary = computeGroupSummary(groupRecords);\n    const expanded = isGroupExpanded(groupId, expandMode, expandedGroups, defaultExpanded);\n\n    groups.push({\n      groupId,\n      records: groupRecords,\n      summary,\n      expanded,\n      summaryFromBackend: false, // We're computing client-side here\n    });\n  }\n\n  // Sort groups by first record's order (preserve API sort)\n  groups.sort((a, b) => {\n    const aIndex = records.indexOf(a.records[0]);\n    const bIndex = records.indexOf(b.records[0]);\n    return aIndex - bIndex;\n  });\n\n  return {\n    groups,\n    ungrouped,\n    totalGroups: groups.length,\n    totalRecords: records.length,\n  };\n}\n\n// ============================================================================\n// Backend Grouped Payload Normalization (TX-058)\n// ============================================================================\n\n/**\n * Check whether list items follow backend grouped-row contract.\n */\nexport function hasBackendGroupedRows(records: Record<string, unknown>[]): boolean {\n  if (records.length === 0) {\n    return false;\n  }\n  let hasContractRows = false;\n  for (const record of records) {\n    if (isBackendGroupedRow(record)) {\n      hasContractRows = true;\n      continue;\n    }\n    if (isBackendUngroupedRow(record)) {\n      hasContractRows = true;\n      continue;\n    }\n    return false;\n  }\n  return hasContractRows;\n}\n\n/**\n * Normalize backend grouped payload (`group_by=translation_group_id`) into GroupedData.\n * Returns `null` when payload does not match grouped-row contract.\n */\nexport function normalizeBackendGroupedRows(\n  records: Record<string, unknown>[],\n  options: GroupTransformOptions = {}\n): GroupedData | null {\n  const {\n    defaultExpanded = true,\n    expandMode = 'explicit',\n    expandedGroups = new Set<string>(),\n  } = options;\n\n  if (!hasBackendGroupedRows(records)) {\n    return null;\n  }\n\n  const groups: RecordGroup[] = [];\n  const ungrouped: Record<string, unknown>[] = [];\n  let totalRecords = 0;\n\n  for (const row of records) {\n    if (isBackendUngroupedRow(row)) {\n      ungrouped.push({ ...row });\n      totalRecords += 1;\n      continue;\n    }\n    const groupId = getBackendGroupID(row);\n    if (!groupId) {\n      return null;\n    }\n\n    const children = getBackendGroupChildren(row);\n    const summary = getBackendGroupSummary(row, children);\n    const expanded = isGroupExpanded(groupId, expandMode, expandedGroups, defaultExpanded);\n\n    groups.push({\n      groupId,\n      displayLabel: getBackendGroupLabel(row, children),\n      records: children,\n      summary,\n      expanded,\n      summaryFromBackend: hasBackendGroupSummary(row),\n    });\n\n    totalRecords += children.length;\n  }\n\n  return {\n    groups,\n    ungrouped,\n    totalGroups: groups.length,\n    totalRecords,\n  };\n}\n\nfunction isGroupExpanded(\n  groupId: string,\n  expandMode: GroupExpandMode,\n  expandedGroups: Set<string>,\n  defaultExpanded: boolean\n): boolean {\n  if (expandMode === 'all') {\n    return !expandedGroups.has(groupId);\n  }\n  if (expandMode === 'none') {\n    return expandedGroups.has(groupId);\n  }\n  if (expandedGroups.size === 0) {\n    return defaultExpanded;\n  }\n  return expandedGroups.has(groupId);\n}\n\nfunction isBackendGroupedRow(record: Record<string, unknown>): record is Record<string, unknown> & BackendGroupedRow {\n  const row = record as BackendGroupedRow;\n  const groupBy = typeof row.group_by === 'string'\n    ? row.group_by.trim().toLowerCase()\n    : '';\n  const rowType = getBackendGroupRowType(record);\n  const hasGroupedMarker = groupBy === 'translation_group_id' || rowType === 'group';\n  if (!hasGroupedMarker) {\n    return false;\n  }\n  const children = getBackendGroupChildren(record);\n  return Array.isArray(children);\n}\n\nfunction isBackendUngroupedRow(record: Record<string, unknown>): boolean {\n  const rowType = getBackendGroupRowType(record);\n  return rowType === 'ungrouped';\n}\n\nfunction getBackendGroupRowType(record: Record<string, unknown>): string {\n  const meta = record._group;\n  if (!meta || typeof meta !== 'object' || Array.isArray(meta)) {\n    return '';\n  }\n  const raw = (meta as Record<string, unknown>).row_type;\n  return typeof raw === 'string' ? raw.trim().toLowerCase() : '';\n}\n\nfunction getBackendGroupID(record: Record<string, unknown>): string | null {\n  const direct = record.translation_group_id;\n  if (typeof direct === 'string' && direct.trim()) {\n    return direct.trim();\n  }\n  const meta = record._group;\n  if (!meta || typeof meta !== 'object' || Array.isArray(meta)) {\n    return null;\n  }\n  const metaID = (meta as Record<string, unknown>).id;\n  return typeof metaID === 'string' && metaID.trim() ? metaID.trim() : null;\n}\n\nfunction getBackendGroupChildren(record: Record<string, unknown>): Record<string, unknown>[] {\n  const grouped = record as BackendGroupedRow;\n  const primary = Array.isArray(grouped.records) ? grouped.records : grouped.children;\n  if (Array.isArray(primary)) {\n    const children = primary\n      .filter((entry): entry is Record<string, unknown> => {\n        return !!entry && typeof entry === 'object' && !Array.isArray(entry);\n      })\n      .map((entry) => ({ ...entry }));\n    if (children.length > 0) {\n      return children;\n    }\n  }\n\n  const parent = grouped.parent;\n  if (parent && typeof parent === 'object' && !Array.isArray(parent)) {\n    return [{ ...(parent as Record<string, unknown>) }];\n  }\n\n  return [];\n}\n\nfunction hasBackendGroupSummary(record: Record<string, unknown>): boolean {\n  const summary = record.translation_group_summary;\n  return !!summary && typeof summary === 'object' && !Array.isArray(summary);\n}\n\nfunction getBackendGroupSummary(record: Record<string, unknown>, children: Record<string, unknown>[]): GroupSummary {\n  const summary = record.translation_group_summary;\n  if (!summary || typeof summary !== 'object' || Array.isArray(summary)) {\n    return computeGroupSummary(children);\n  }\n\n  const raw = summary as Record<string, unknown>;\n  const availableLocales = Array.isArray(raw.available_locales)\n    ? raw.available_locales.filter(isString)\n    : [];\n  const missingLocales = Array.isArray(raw.missing_locales)\n    ? raw.missing_locales.filter(isString)\n    : [];\n  const readinessState = isValidReadinessState(raw.readiness_state)\n    ? raw.readiness_state\n    : null;\n  const fallbackTotal = Math.max(children.length, typeof raw.child_count === 'number' ? Math.max(raw.child_count, 0) : 0);\n\n  return {\n    totalItems: typeof raw.total_items === 'number'\n      ? Math.max(raw.total_items, 0)\n      : fallbackTotal,\n    availableLocales,\n    missingLocales,\n    readinessState,\n    readyForPublish: typeof raw.ready_for_publish === 'boolean' ? raw.ready_for_publish : null,\n  };\n}\n\nfunction getBackendGroupLabel(record: Record<string, unknown>, children: Record<string, unknown>[]): string | undefined {\n  const directLabel = record.translation_group_label;\n  if (typeof directLabel === 'string' && directLabel.trim()) {\n    return directLabel.trim();\n  }\n\n  const summary = record.translation_group_summary;\n  if (summary && typeof summary === 'object' && !Array.isArray(summary)) {\n    const summaryLabel = (summary as Record<string, unknown>).group_label;\n    if (typeof summaryLabel === 'string' && summaryLabel.trim()) {\n      return summaryLabel.trim();\n    }\n  }\n\n  const meta = record._group;\n  if (meta && typeof meta === 'object' && !Array.isArray(meta)) {\n    const metaLabel = (meta as Record<string, unknown>).label;\n    if (typeof metaLabel === 'string' && metaLabel.trim()) {\n      return metaLabel.trim();\n    }\n  }\n\n  const candidates: unknown[] = [];\n  const parent = (record as BackendGroupedRow).parent;\n  if (parent && typeof parent === 'object' && !Array.isArray(parent)) {\n    const parentRecord = parent as Record<string, unknown>;\n    candidates.push(parentRecord.title, parentRecord.name, parentRecord.slug, parentRecord.path);\n  }\n  if (children.length > 0) {\n    candidates.push(children[0].title, children[0].name, children[0].slug, children[0].path);\n  }\n  for (const candidate of candidates) {\n    if (typeof candidate === 'string' && candidate.trim()) {\n      return candidate.trim();\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Extract group ID from a record.\n */\nfunction getGroupId(record: Record<string, unknown>, field: string): string | null {\n  const value = record[field];\n  if (typeof value === 'string' && value.trim()) {\n    return value;\n  }\n\n  // Try nested paths (e.g., translation.meta.translation_group_id)\n  const nestedPaths = [\n    `translation.meta.${field}`,\n    `content_translation.meta.${field}`,\n  ];\n\n  for (const path of nestedPaths) {\n    const nested = getNestedValue(record, path);\n    if (typeof nested === 'string' && nested.trim()) {\n      return nested;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get nested value from object by dot-separated path.\n */\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  const parts = path.split('.');\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined || typeof current !== 'object') {\n      return undefined;\n    }\n    current = (current as Record<string, unknown>)[part];\n  }\n\n  return current;\n}\n\n/**\n * Compute group summary from records (client-side fallback).\n * Backend summary should be preferred when available.\n */\nfunction computeGroupSummary(records: Record<string, unknown>[]): GroupSummary {\n  const allAvailable = new Set<string>();\n  const allMissing = new Set<string>();\n  let hasIncomplete = false;\n  let readyCount = 0;\n\n  for (const record of records) {\n    const readiness = record.translation_readiness as Record<string, unknown> | undefined;\n\n    if (readiness) {\n      const available = readiness.available_locales;\n      const missing = readiness.missing_required_locales;\n      const state = readiness.readiness_state;\n\n      if (Array.isArray(available)) {\n        available.filter(isString).forEach((loc) => allAvailable.add(loc));\n      }\n      if (Array.isArray(missing)) {\n        missing.filter(isString).forEach((loc) => allMissing.add(loc));\n      }\n      if (state === 'missing_fields' || state === 'missing_locales_and_fields') {\n        hasIncomplete = true;\n      }\n      if (state === 'ready') {\n        readyCount++;\n      }\n    }\n\n    // Also check legacy available_locales\n    const legacyAvailable = record.available_locales;\n    if (Array.isArray(legacyAvailable)) {\n      legacyAvailable.filter(isString).forEach((loc) => allAvailable.add(loc));\n    }\n  }\n\n  // Determine overall readiness state\n  let readinessState: GroupSummary['readinessState'] = null;\n  if (records.length > 0) {\n    const allReady = readyCount === records.length;\n    const hasMissing = allMissing.size > 0;\n\n    if (allReady) {\n      readinessState = 'ready';\n    } else if (hasMissing && hasIncomplete) {\n      readinessState = 'missing_locales_and_fields';\n    } else if (hasMissing) {\n      readinessState = 'missing_locales';\n    } else if (hasIncomplete) {\n      readinessState = 'missing_fields';\n    }\n  }\n\n  return {\n    totalItems: records.length,\n    availableLocales: Array.from(allAvailable),\n    missingLocales: Array.from(allMissing),\n    readinessState,\n    readyForPublish: readinessState === 'ready',\n  };\n}\n\nfunction isString(value: unknown): value is string {\n  return typeof value === 'string';\n}\n\n// ============================================================================\n// Backend Summary Merging\n// ============================================================================\n\n/**\n * Merge backend-provided group summaries into grouped data.\n * Backend summaries override client-computed summaries.\n *\n * @param groupedData - Client-computed grouped data\n * @param backendSummaries - Map of groupId to backend summary\n * @returns Grouped data with backend summaries merged\n */\nexport function mergeBackendSummaries(\n  groupedData: GroupedData,\n  backendSummaries: Map<string, Partial<GroupSummary>>\n): GroupedData {\n  const groups = groupedData.groups.map((group) => {\n    const backendSummary = backendSummaries.get(group.groupId);\n    if (backendSummary) {\n      return {\n        ...group,\n        summary: {\n          ...group.summary,\n          ...backendSummary,\n        },\n        summaryFromBackend: true,\n      };\n    }\n    return group;\n  });\n\n  return {\n    ...groupedData,\n    groups,\n  };\n}\n\n/**\n * Extract backend summaries from API response metadata.\n * Looks for `group_summaries` in response.\n */\nexport function extractBackendSummaries(\n  response: Record<string, unknown>\n): Map<string, Partial<GroupSummary>> {\n  const summaries = new Map<string, Partial<GroupSummary>>();\n\n  const groupSummaries = response.group_summaries;\n  if (!groupSummaries || typeof groupSummaries !== 'object' || Array.isArray(groupSummaries)) {\n    return summaries;\n  }\n\n  for (const [groupId, summary] of Object.entries(groupSummaries as Record<string, unknown>)) {\n    if (summary && typeof summary === 'object') {\n      const s = summary as Record<string, unknown>;\n      summaries.set(groupId, {\n        totalItems: typeof s.total_items === 'number' ? s.total_items : undefined,\n        availableLocales: Array.isArray(s.available_locales) ? s.available_locales.filter(isString) : undefined,\n        missingLocales: Array.isArray(s.missing_locales) ? s.missing_locales.filter(isString) : undefined,\n        readinessState: isValidReadinessState(s.readiness_state) ? s.readiness_state : undefined,\n        readyForPublish: typeof s.ready_for_publish === 'boolean' ? s.ready_for_publish : undefined,\n      });\n    }\n  }\n\n  return summaries;\n}\n\nfunction isValidReadinessState(\n  value: unknown\n): value is 'ready' | 'missing_locales' | 'missing_fields' | 'missing_locales_and_fields' {\n  return (\n    value === 'ready' ||\n    value === 'missing_locales' ||\n    value === 'missing_fields' ||\n    value === 'missing_locales_and_fields'\n  );\n}\n\n// ============================================================================\n// Expand/Collapse State Management (TX-057)\n// ============================================================================\n\nconst EXPAND_STATE_KEY_PREFIX = 'datagrid-expand-state-';\n\ninterface PersistedExpandStateV2 {\n  version: 2;\n  mode: GroupExpandMode;\n  ids: string[];\n}\n\nfunction normalizeExpandIDs(values: unknown): string[] {\n  if (!Array.isArray(values)) {\n    return [];\n  }\n  const out: string[] = [];\n  for (const value of values) {\n    const normalized = sanitizeGroupId(value);\n    if (!normalized) continue;\n    if (out.includes(normalized)) continue;\n    if (out.length >= MAX_EXPANDED_GROUPS_TOKEN_ITEMS) break;\n    out.push(normalized);\n  }\n  return out;\n}\n\nfunction parsePersistedExpandState(raw: string | null): PersistedExpandStateV2 | null {\n  if (!raw) {\n    return null;\n  }\n  try {\n    const parsed = JSON.parse(raw);\n    if (Array.isArray(parsed)) {\n      return {\n        version: 2,\n        mode: 'explicit',\n        ids: normalizeExpandIDs(parsed),\n      };\n    }\n    if (!parsed || typeof parsed !== 'object' || Array.isArray(parsed)) {\n      return null;\n    }\n    const mode = normalizeExpandMode((parsed as Record<string, unknown>).mode, 'explicit');\n    const ids = normalizeExpandIDs((parsed as Record<string, unknown>).ids);\n    return { version: 2, mode, ids };\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get persisted expand state for a panel.\n */\nexport function getPersistedExpandState(panelId: string): Set<string> {\n  try {\n    const key = EXPAND_STATE_KEY_PREFIX + panelId;\n    const parsed = parsePersistedExpandState(localStorage.getItem(key));\n    if (parsed) {\n      return new Set(parsed.ids);\n    }\n  } catch {\n    // Ignore storage errors\n  }\n  return new Set<string>();\n}\n\n/**\n * Get persisted expand mode for a panel.\n */\nexport function getPersistedExpandMode(panelId: string): GroupExpandMode {\n  try {\n    const key = EXPAND_STATE_KEY_PREFIX + panelId;\n    const parsed = parsePersistedExpandState(localStorage.getItem(key));\n    if (parsed) {\n      return parsed.mode;\n    }\n  } catch {\n    // Ignore storage errors.\n  }\n  return 'explicit';\n}\n\n/**\n * Whether a panel has persisted expand/collapse preferences.\n * Distinguishes \"no preference stored yet\" from an explicitly collapsed-all state.\n */\nexport function hasPersistedExpandState(panelId: string): boolean {\n  try {\n    const key = EXPAND_STATE_KEY_PREFIX + panelId;\n    return localStorage.getItem(key) !== null;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Persist expand state for a panel.\n */\nexport function persistExpandState(\n  panelId: string,\n  expandedGroups: Set<string>,\n  mode: GroupExpandMode = 'explicit'\n): void {\n  try {\n    const key = EXPAND_STATE_KEY_PREFIX + panelId;\n    const ids = normalizeExpandIDs(Array.from(expandedGroups));\n    const payload: PersistedExpandStateV2 = {\n      version: 2,\n      mode: normalizeExpandMode(mode, 'explicit'),\n      ids,\n    };\n    localStorage.setItem(key, JSON.stringify(payload));\n  } catch {\n    // Ignore storage errors\n  }\n}\n\n/**\n * Toggle expand state for a group.\n */\nexport function toggleGroupExpand(\n  groupedData: GroupedData,\n  groupId: string\n): GroupedData {\n  const groups = groupedData.groups.map((group) => {\n    if (group.groupId === groupId) {\n      return { ...group, expanded: !group.expanded };\n    }\n    return group;\n  });\n\n  return { ...groupedData, groups };\n}\n\n/**\n * Expand all groups.\n *\n * Note: This only affects grouped records (those with translation_group_id).\n * Ungrouped records (in groupedData.ungrouped) are always visible and\n * are not affected by expand/collapse operations.\n */\nexport function expandAllGroups(groupedData: GroupedData): GroupedData {\n  const groups = groupedData.groups.map((group) => ({\n    ...group,\n    expanded: true,\n  }));\n  return { ...groupedData, groups };\n}\n\n/**\n * Collapse all groups.\n *\n * Note: This only affects grouped records (those with translation_group_id).\n * Ungrouped records (in groupedData.ungrouped) are always visible and\n * are not affected by expand/collapse operations. This is the expected\n * behavior for mixed datasets where some records have translation groups\n * and others are standalone.\n */\nexport function collapseAllGroups(groupedData: GroupedData): GroupedData {\n  const groups = groupedData.groups.map((group) => ({\n    ...group,\n    expanded: false,\n  }));\n  return { ...groupedData, groups };\n}\n\n/**\n * Get set of currently expanded group IDs.\n */\nexport function getExpandedGroupIds(groupedData: GroupedData): Set<string> {\n  const expanded = new Set<string>();\n  for (const group of groupedData.groups) {\n    if (group.expanded) {\n      expanded.add(group.groupId);\n    }\n  }\n  return expanded;\n}\n\n// ============================================================================\n// View Mode Persistence (TX-034)\n// ============================================================================\n\nconst VIEW_MODE_KEY_PREFIX = 'datagrid-view-mode-';\nconst MAX_EXPANDED_GROUPS_TOKEN_ITEMS = 200;\nconst MAX_EXPANDED_GROUP_ID_LENGTH = 256;\n\nexport function normalizeExpandMode(value: unknown, fallback: GroupExpandMode = 'explicit'): GroupExpandMode {\n  if (value === 'all' || value === 'none' || value === 'explicit') {\n    return value;\n  }\n  return fallback;\n}\n\n/**\n * Get persisted view mode for a panel.\n */\nexport function getPersistedViewMode(panelId: string): ViewMode | null {\n  try {\n    const key = VIEW_MODE_KEY_PREFIX + panelId;\n    const stored = localStorage.getItem(key);\n    if (stored && isValidViewMode(stored)) {\n      return stored;\n    }\n  } catch {\n    // Ignore storage errors\n  }\n  return null;\n}\n\n/**\n * Persist view mode for a panel.\n */\nexport function persistViewMode(panelId: string, mode: ViewMode): void {\n  try {\n    const key = VIEW_MODE_KEY_PREFIX + panelId;\n    localStorage.setItem(key, mode);\n  } catch {\n    // Ignore storage errors\n  }\n}\n\nfunction isValidViewMode(value: string): value is ViewMode {\n  return value === 'flat' || value === 'grouped' || value === 'matrix';\n}\n\n/**\n * Parse view mode from URL query parameter.\n */\nexport function parseViewMode(value: string | null): ViewMode | null {\n  if (!value) return null;\n  return isValidViewMode(value) ? value : null;\n}\n\n/**\n * Encode expanded group IDs into a compact URL-safe token.\n * Token strategy: URI-encode each group ID, sort deterministically, join with commas.\n */\nexport function encodeExpandedGroupsToken(expandedGroups: Set<string>): string {\n  if (!(expandedGroups instanceof Set) || expandedGroups.size === 0) {\n    return '';\n  }\n\n  const normalized = Array.from(new Set(\n    Array.from(expandedGroups)\n      .map((value) => sanitizeGroupId(value))\n      .filter((value): value is string => value !== null)\n  ))\n    .slice(0, MAX_EXPANDED_GROUPS_TOKEN_ITEMS)\n    .sort();\n\n  if (normalized.length === 0) {\n    return '';\n  }\n\n  return normalized.map((groupId) => encodeURIComponent(groupId)).join(',');\n}\n\n/**\n * Decode expanded group token into a validated Set of group IDs.\n */\nexport function decodeExpandedGroupsToken(token: string | null): Set<string> {\n  const expanded = new Set<string>();\n  if (!token) {\n    return expanded;\n  }\n\n  const segments = token.split(',');\n  for (const segment of segments) {\n    if (expanded.size >= MAX_EXPANDED_GROUPS_TOKEN_ITEMS) {\n      break;\n    }\n\n    if (!segment) {\n      continue;\n    }\n\n    let decoded = '';\n    try {\n      decoded = decodeURIComponent(segment);\n    } catch {\n      continue;\n    }\n\n    const normalized = sanitizeGroupId(decoded);\n    if (normalized) {\n      expanded.add(normalized);\n    }\n  }\n\n  return expanded;\n}\n\nfunction sanitizeGroupId(value: unknown): string | null {\n  if (typeof value !== 'string') {\n    return null;\n  }\n  let trimmed = value.trim();\n  if (!trimmed) {\n    return null;\n  }\n  // Normalize pre-encoded IDs once to avoid repeated %25 growth in URL tokens.\n  if (trimmed.includes('%')) {\n    try {\n      const decoded = decodeURIComponent(trimmed);\n      if (typeof decoded === 'string' && decoded.trim()) {\n        trimmed = decoded.trim();\n      }\n    } catch {\n      // Keep original when decoding fails.\n    }\n  }\n  if (trimmed.length > MAX_EXPANDED_GROUP_ID_LENGTH) {\n    return null;\n  }\n  return trimmed;\n}\n\n// ============================================================================\n// Group Rendering Helpers (TX-056)\n// ============================================================================\n\n/**\n * Render group header summary HTML.\n * Displays locale completeness and readiness state.\n */\nexport function renderGroupHeaderSummary(\n  group: RecordGroup,\n  options: { size?: 'sm' | 'md' } = {}\n): string {\n  const { summary } = group;\n  const { size = 'sm' } = options;\n\n  const textSize = size === 'sm' ? 'text-xs' : 'text-sm';\n  const availableCount = summary.availableLocales.length;\n  const missingCount = summary.missingLocales.length;\n  const totalLocales = availableCount + missingCount;\n\n  // Readiness badge\n  let readinessBadge = '';\n  if (summary.readinessState) {\n    const stateConfig = getReadinessStateConfig(summary.readinessState);\n    readinessBadge = `\n      <span class=\"${textSize} px-1.5 py-0.5 rounded ${stateConfig.bgClass} ${stateConfig.textClass}\"\n            title=\"${stateConfig.description}\">\n        ${stateConfig.icon} ${stateConfig.label}\n      </span>\n    `;\n  }\n\n  // Locale count\n  const localeCount = totalLocales > 0\n    ? `<span class=\"${textSize} text-gray-500\">${availableCount}/${totalLocales} locales</span>`\n    : '';\n\n  // Item count\n  const itemCount = `<span class=\"${textSize} text-gray-500\">${summary.totalItems} item${summary.totalItems !== 1 ? 's' : ''}</span>`;\n\n  return `\n    <div class=\"inline-flex items-center gap-2\">\n      ${readinessBadge}\n      ${localeCount}\n      ${itemCount}\n    </div>\n  `;\n}\n\n/**\n * Get configuration for readiness state display.\n */\nfunction getReadinessStateConfig(state: GroupSummary['readinessState']): {\n  icon: string;\n  label: string;\n  bgClass: string;\n  textClass: string;\n  description: string;\n} {\n  switch (state) {\n    case 'ready':\n      return {\n        icon: '●',\n        label: 'Ready',\n        bgClass: 'bg-green-100',\n        textClass: 'text-green-700',\n        description: 'All translations complete',\n      };\n    case 'missing_locales':\n      return {\n        icon: '○',\n        label: 'Missing',\n        bgClass: 'bg-amber-100',\n        textClass: 'text-amber-700',\n        description: 'Missing required locale translations',\n      };\n    case 'missing_fields':\n      return {\n        icon: '◐',\n        label: 'Incomplete',\n        bgClass: 'bg-yellow-100',\n        textClass: 'text-yellow-700',\n        description: 'Has translations but missing required fields',\n      };\n    case 'missing_locales_and_fields':\n      return {\n        icon: '⚠',\n        label: 'Not Ready',\n        bgClass: 'bg-red-100',\n        textClass: 'text-red-700',\n        description: 'Missing translations and required fields',\n      };\n    default:\n      return {\n        icon: '?',\n        label: 'Unknown',\n        bgClass: 'bg-gray-100',\n        textClass: 'text-gray-700',\n        description: 'Status unknown',\n      };\n  }\n}\n\n/**\n * Derive a meaningful label for a group from its records.\n * Prefers: displayLabel > first record's title/name > fallback label.\n */\nfunction deriveGroupLabel(group: RecordGroup): string {\n  // Priority 1: Explicit displayLabel\n  if (typeof group.displayLabel === 'string' && group.displayLabel.trim()) {\n    return group.displayLabel.trim();\n  }\n\n  // Priority 2: Check if this is an ungrouped pseudo-group\n  if (group.groupId.startsWith('ungrouped:')) {\n    return 'Ungrouped Records';\n  }\n\n  // Priority 3: Derive from first record's title/name field\n  if (group.records.length > 0) {\n    const firstRecord = group.records[0];\n    // Try common title fields\n    for (const field of ['title', 'name', 'label', 'subject']) {\n      const value = firstRecord[field];\n      if (typeof value === 'string' && value.trim()) {\n        // Truncate long titles\n        const trimmed = value.trim();\n        return trimmed.length > 60 ? trimmed.slice(0, 57) + '...' : trimmed;\n      }\n    }\n  }\n\n  // Priority 4: Fallback with group ID hint\n  const shortId = group.groupId.length > 8 ? group.groupId.slice(0, 8) + '...' : group.groupId;\n  return `Translation Group (${shortId})`;\n}\n\n/**\n * Render group header row HTML for the DataGrid.\n *\n * Group header semantics:\n * - Groups show an expandable/collapsible header with a derived label\n * - Label is derived from: displayLabel > first record's title > fallback\n * - Ungrouped records (those without translation_group_id) are rendered\n *   as regular rows without a header, after all grouped content\n * - Collapse All only affects grouped records, not ungrouped rows\n */\nexport function renderGroupHeaderRow(\n  group: RecordGroup,\n  colSpan: number,\n  options: { showExpandIcon?: boolean } = {}\n): string {\n  const { showExpandIcon = true } = options;\n  const expandIcon = showExpandIcon\n    ? `<span class=\"expand-icon mr-2\" aria-hidden=\"true\">${group.expanded ? '▼' : '▶'}</span>`\n    : '';\n\n  const summaryHtml = renderGroupHeaderSummary(group);\n  const groupLabel = escapeHtml(deriveGroupLabel(group));\n  const recordCount = group.records.length;\n  const countBadge = recordCount > 1\n    ? `<span class=\"ml-2 text-xs text-gray-500\">(${recordCount} locales)</span>`\n    : '';\n\n  return `\n    <tr class=\"group-header bg-gray-50 hover:bg-gray-100 cursor-pointer border-b border-gray-200\"\n        data-group-id=\"${escapeAttr(group.groupId)}\"\n        data-expanded=\"${group.expanded}\"\n        role=\"row\"\n        aria-expanded=\"${group.expanded}\"\n        tabindex=\"0\">\n      <td colspan=\"${colSpan + 2}\" class=\"px-4 py-2\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex items-center\">\n            ${expandIcon}\n            <span class=\"font-medium text-gray-700\">${groupLabel}</span>\n            ${countBadge}\n          </div>\n          ${summaryHtml}\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n/**\n * Escape HTML special characters.\n */\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\n/**\n * Escape attribute value.\n */\nfunction escapeAttr(str: string): string {\n  return escapeHtml(str);\n}\n\n// ============================================================================\n// Empty and Loading States (TX-061, TX-062)\n// ============================================================================\n\n/**\n * Render grouped mode empty state.\n */\nexport function renderGroupedEmptyState(colSpan: number): string {\n  return `\n    <tr>\n      <td colspan=\"${colSpan + 2}\" class=\"px-6 py-12 text-center\">\n        <div class=\"text-gray-500\">\n          <svg class=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                  d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n          <h3 class=\"mt-2 text-sm font-medium text-gray-900\">No translation groups</h3>\n          <p class=\"mt-1 text-sm text-gray-500\">No grouped translations found for this content type.</p>\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n/**\n * Render grouped mode loading state.\n */\nexport function renderGroupedLoadingState(colSpan: number): string {\n  return `\n    <tr>\n      <td colspan=\"${colSpan + 2}\" class=\"px-6 py-12 text-center\">\n        <div class=\"flex items-center justify-center\">\n          <svg class=\"animate-spin h-8 w-8 text-blue-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          <span class=\"ml-2 text-gray-500\">Loading groups...</span>\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n// ============================================================================\n// Error Boundary (TX-060)\n// ============================================================================\n\n/**\n * Render grouped mode error state.\n */\nexport function renderGroupedErrorState(\n  colSpan: number,\n  error: string,\n  onRetry?: () => void\n): string {\n  const retryButton = onRetry\n    ? `<button type=\"button\" class=\"mt-2 px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600\" onclick=\"this.dispatchEvent(new CustomEvent('retry', { bubbles: true }))\">Retry</button>`\n    : '';\n\n  return `\n    <tr>\n      <td colspan=\"${colSpan + 2}\" class=\"px-6 py-12 text-center\">\n        <div class=\"text-red-500\">\n          <svg class=\"mx-auto h-12 w-12\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n          <h3 class=\"mt-2 text-sm font-medium text-gray-900\">Error loading groups</h3>\n          <p class=\"mt-1 text-sm text-gray-500\">${escapeHtml(error)}</p>\n          ${retryButton}\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n// ============================================================================\n// Mobile/Responsive Helpers (TX-063)\n// ============================================================================\n\n/**\n * Check if we're in narrow viewport mode.\n */\nexport function isNarrowViewport(breakpoint: number = 768): boolean {\n  if (typeof window === 'undefined') return false;\n  return window.innerWidth < breakpoint;\n}\n\n/**\n * Get recommended view mode for viewport.\n * On narrow viewports, prefer flat mode over grouped.\n */\nexport function getViewModeForViewport(\n  preferredMode: ViewMode,\n  breakpoint: number = 768\n): ViewMode {\n  if (isNarrowViewport(breakpoint) && preferredMode === 'grouped') {\n    return 'flat';\n  }\n  return preferredMode;\n}\n","export const DATAGRID_URL_KEY_SEARCH = 'search';\nexport const DATAGRID_URL_KEY_PAGE = 'page';\nexport const DATAGRID_URL_KEY_PER_PAGE = 'perPage';\nexport const DATAGRID_URL_KEY_FILTERS = 'filters';\nexport const DATAGRID_URL_KEY_SORT = 'sort';\nexport const DATAGRID_URL_KEY_STATE = 'state';\nexport const DATAGRID_URL_KEY_HIDDEN_COLUMNS = 'hiddenColumns';\nexport const DATAGRID_URL_KEY_VIEW_MODE = 'view_mode';\nexport const DATAGRID_URL_KEY_EXPANDED_GROUPS = 'expanded_groups';\n\nexport const DATAGRID_MANAGED_URL_KEYS = [\n  DATAGRID_URL_KEY_SEARCH,\n  DATAGRID_URL_KEY_PAGE,\n  DATAGRID_URL_KEY_PER_PAGE,\n  DATAGRID_URL_KEY_FILTERS,\n  DATAGRID_URL_KEY_SORT,\n  DATAGRID_URL_KEY_STATE,\n  DATAGRID_URL_KEY_HIDDEN_COLUMNS,\n  DATAGRID_URL_KEY_VIEW_MODE,\n  DATAGRID_URL_KEY_EXPANDED_GROUPS,\n];\n\nexport const DATAGRID_DEFAULT_MAX_URL_LENGTH = 1800;\nexport const DATAGRID_DEFAULT_MAX_FILTERS_LENGTH = 600;\n","export function buildURL(pathname: string, params: URLSearchParams): string {\n  const query = params.toString();\n  return query ? `${pathname}?${query}` : pathname;\n}\n\nexport function deleteSearchParams(params: URLSearchParams, keys: string[]): void {\n  for (const key of keys) {\n    params.delete(key);\n  }\n}\n\nexport function setSearchParam(params: URLSearchParams, key: string, value: unknown): void {\n  if (value === null || value === undefined) {\n    return;\n  }\n  const normalized = String(value);\n  if (!normalized.trim()) {\n    return;\n  }\n  params.set(key, normalized);\n}\n\nexport function parseJSONParam<T>(raw: string | null, fallback: T): T {\n  if (!raw) {\n    return fallback;\n  }\n  try {\n    return JSON.parse(raw) as T;\n  } catch {\n    return fallback;\n  }\n}\n","// @ts-nocheck\nimport type {\n  ColumnDefinition,\n  ColumnFilter,\n  SortColumn,\n  DataGridPersistedState,\n  DataGridShareState,\n  DataGridURLStateConfig,\n} from './core-types.js';\nimport {\n  decodeExpandedGroupsToken,\n  getViewModeForViewport,\n  normalizeExpandMode,\n  parseViewMode,\n} from './grouped-mode.js';\nimport {\n  DATAGRID_DEFAULT_MAX_FILTERS_LENGTH,\n  DATAGRID_DEFAULT_MAX_URL_LENGTH,\n  DATAGRID_MANAGED_URL_KEYS,\n  DATAGRID_URL_KEY_EXPANDED_GROUPS,\n  DATAGRID_URL_KEY_FILTERS,\n  DATAGRID_URL_KEY_HIDDEN_COLUMNS,\n  DATAGRID_URL_KEY_PAGE,\n  DATAGRID_URL_KEY_PER_PAGE,\n  DATAGRID_URL_KEY_SEARCH,\n  DATAGRID_URL_KEY_SORT,\n  DATAGRID_URL_KEY_STATE,\n  DATAGRID_URL_KEY_VIEW_MODE,\n} from './core-constants.js';\nimport { buildURL, deleteSearchParams } from '../shared/query-state/url-state.js';\n\nexport function getURLStateConfig(grid: any): Required<DataGridURLStateConfig> {\n  const maxURLLength = Math.max(\n    256,\n    grid.config.urlState?.maxURLLength || DATAGRID_DEFAULT_MAX_URL_LENGTH,\n  );\n  const maxFiltersLength = Math.max(\n    64,\n    grid.config.urlState?.maxFiltersLength || DATAGRID_DEFAULT_MAX_FILTERS_LENGTH,\n  );\n  const enableStateToken = grid.config.urlState?.enableStateToken !== false;\n  return {\n    maxURLLength,\n    maxFiltersLength,\n    enableStateToken,\n  };\n}\n\nexport function parseJSONArray(_grid: any, raw: string, label: string): unknown[] | null {\n  const normalized = String(raw || '').trim();\n  if (!normalized) {\n    return null;\n  }\n  try {\n    const parsed = JSON.parse(normalized) as unknown;\n    if (!Array.isArray(parsed)) {\n      console.warn(`[DataGrid] Invalid ${label} payload in URL (expected array)`);\n      return null;\n    }\n    return parsed;\n  } catch (error) {\n    console.warn(`[DataGrid] Failed to parse ${label} payload from URL:`, error);\n    return null;\n  }\n}\n\nexport function applyPersistedStateSnapshot(\n  grid: any,\n  snapshot: DataGridPersistedState,\n  options: { merge?: boolean } = {},\n): void {\n  const merge = options.merge === true;\n  const validFields = new Set(grid.config.columns.map((col: ColumnDefinition) => col.field));\n\n  const persistedHidden = Array.isArray(snapshot.hiddenColumns)\n    ? new Set(\n      snapshot.hiddenColumns\n        .map((field) => String(field || '').trim())\n        .filter((field) => field.length > 0 && validFields.has(field)),\n    )\n    : null;\n  if (persistedHidden) {\n    grid.state.hiddenColumns = persistedHidden;\n    grid.hasPersistedHiddenColumnState = true;\n  } else if (!merge) {\n    grid.state.hiddenColumns = new Set(\n      grid.config.columns.filter((col: ColumnDefinition) => col.hidden).map((col: ColumnDefinition) => col.field),\n    );\n    grid.hasPersistedHiddenColumnState = false;\n  }\n\n  const persistedOrder = Array.isArray(snapshot.columnOrder)\n    ? snapshot.columnOrder\n      .map((field) => String(field || '').trim())\n      .filter((field) => field.length > 0 && validFields.has(field))\n    : null;\n  if (persistedOrder && persistedOrder.length > 0) {\n    const validOrder = grid.mergeColumnOrder(persistedOrder);\n    grid.state.columnOrder = validOrder;\n    grid.hasPersistedColumnOrderState = true;\n    grid.didRestoreColumnOrder = true;\n    const defaultOrder = grid.defaultColumns.map((col: ColumnDefinition) => col.field);\n    grid.shouldReorderDOMOnRestore = defaultOrder.join('|') !== validOrder.join('|');\n\n    const columnMap = new Map(grid.config.columns.map((c: ColumnDefinition) => [c.field, c]));\n    grid.config.columns = validOrder\n      .map((field) => columnMap.get(field))\n      .filter((c: ColumnDefinition | undefined): c is ColumnDefinition => c !== undefined);\n  } else if (!merge) {\n    grid.state.columnOrder = grid.config.columns.map((col: ColumnDefinition) => col.field);\n    grid.hasPersistedColumnOrderState = false;\n    grid.didRestoreColumnOrder = false;\n    grid.shouldReorderDOMOnRestore = false;\n  }\n\n  if (!grid.config.enableGroupedMode) {\n    return;\n  }\n\n  if (snapshot.viewMode) {\n    const parsed = parseViewMode(snapshot.viewMode);\n    if (parsed) {\n      grid.state.viewMode = getViewModeForViewport(parsed);\n    }\n  }\n\n  grid.state.expandMode = normalizeExpandMode(snapshot.expandMode, grid.state.expandMode);\n\n  if (Array.isArray(snapshot.expandedGroups)) {\n    grid.state.expandedGroups = new Set(\n      snapshot.expandedGroups\n        .map((groupId) => String(groupId || '').trim())\n        .filter(Boolean),\n    );\n    grid.state.hasPersistedExpandState = true;\n  } else if (snapshot.expandMode !== undefined) {\n    grid.state.hasPersistedExpandState = true;\n  }\n}\n\nexport function applyShareStateSnapshot(grid: any, snapshot: DataGridShareState): void {\n  if (snapshot.persisted) {\n    grid.applyPersistedStateSnapshot(snapshot.persisted, { merge: true });\n  }\n  if (typeof snapshot.search === 'string') {\n    grid.state.search = snapshot.search;\n  }\n  if (typeof snapshot.page === 'number' && Number.isFinite(snapshot.page)) {\n    grid.state.currentPage = Math.max(1, Math.trunc(snapshot.page));\n  }\n  if (typeof snapshot.perPage === 'number' && Number.isFinite(snapshot.perPage)) {\n    grid.state.perPage = Math.max(1, Math.trunc(snapshot.perPage));\n  }\n  if (Array.isArray(snapshot.filters)) {\n    grid.state.filters = snapshot.filters as ColumnFilter[];\n  }\n  if (Array.isArray(snapshot.sort)) {\n    grid.state.sort = snapshot.sort as SortColumn[];\n  }\n}\n\nexport function buildPersistedStateSnapshot(grid: any): DataGridPersistedState {\n  const persisted: DataGridPersistedState = {\n    version: 1,\n    hiddenColumns: Array.from(grid.state.hiddenColumns),\n    columnOrder: [...grid.state.columnOrder],\n    updatedAt: Date.now(),\n  };\n  if (grid.config.enableGroupedMode) {\n    persisted.viewMode = grid.state.viewMode;\n    persisted.expandMode = grid.state.expandMode;\n    persisted.expandedGroups = Array.from(grid.state.expandedGroups);\n  }\n  return persisted;\n}\n\nexport function buildShareStateSnapshot(grid: any): DataGridShareState {\n  const shareState: DataGridShareState = {\n    version: 1,\n    search: grid.state.search || undefined,\n    page: grid.state.currentPage > 1 ? grid.state.currentPage : undefined,\n    perPage: grid.state.perPage !== (grid.config.perPage || 10) ? grid.state.perPage : undefined,\n    filters: grid.state.filters.length > 0 ? [...grid.state.filters] : undefined,\n    sort: grid.state.sort.length > 0 ? [...grid.state.sort] : undefined,\n    persisted: grid.buildPersistedStateSnapshot(),\n    updatedAt: Date.now(),\n  };\n  return shareState;\n}\n\nexport function persistStateSnapshot(grid: any): void {\n  grid.stateStore.savePersistedState(grid.buildPersistedStateSnapshot());\n}\n\nexport function restoreStateFromURL(grid: any): void {\n  const params = new URLSearchParams(window.location.search);\n  grid.didRestoreColumnOrder = false;\n  grid.shouldReorderDOMOnRestore = false;\n  grid.hasURLStateOverrides = DATAGRID_MANAGED_URL_KEYS.some((key) => params.has(key));\n\n  const stateToken = params.get(DATAGRID_URL_KEY_STATE);\n  if (stateToken) {\n    const shared = grid.stateStore.resolveShareState(stateToken);\n    if (shared) {\n      grid.applyShareStateSnapshot(shared);\n    }\n  }\n\n  const search = params.get(DATAGRID_URL_KEY_SEARCH);\n  if (search) {\n    grid.state.search = search;\n    const searchInput = document.querySelector<HTMLInputElement>(grid.selectors.searchInput);\n    if (searchInput) {\n      searchInput.value = search;\n    }\n  }\n\n  const page = params.get(DATAGRID_URL_KEY_PAGE);\n  if (page) {\n    const parsedPage = parseInt(page, 10);\n    grid.state.currentPage = Number.isNaN(parsedPage) ? 1 : Math.max(1, parsedPage);\n  }\n\n  const perPage = params.get(DATAGRID_URL_KEY_PER_PAGE);\n  if (perPage) {\n    const parsedPerPage = parseInt(perPage, 10);\n    const fallbackPerPage = grid.config.perPage || 10;\n    grid.state.perPage = Number.isNaN(parsedPerPage)\n      ? fallbackPerPage\n      : Math.max(1, parsedPerPage);\n    const perPageSelect = document.querySelector<HTMLSelectElement>(grid.selectors.perPageSelect);\n    if (perPageSelect) {\n      perPageSelect.value = String(grid.state.perPage);\n    }\n  }\n\n  const filtersParam = params.get(DATAGRID_URL_KEY_FILTERS);\n  if (filtersParam) {\n    const parsed = grid.parseJSONArray(filtersParam, 'filters');\n    if (parsed) {\n      grid.state.filters = parsed as ColumnFilter[];\n    }\n  }\n\n  const sortParam = params.get(DATAGRID_URL_KEY_SORT);\n  if (sortParam) {\n    const parsed = grid.parseJSONArray(sortParam, 'sort');\n    if (parsed) {\n      grid.state.sort = parsed as SortColumn[];\n    }\n  }\n\n  if (grid.config.enableGroupedMode) {\n    const urlViewMode = parseViewMode(params.get(DATAGRID_URL_KEY_VIEW_MODE));\n    if (urlViewMode) {\n      grid.state.viewMode = getViewModeForViewport(urlViewMode);\n    }\n\n    if (params.has(DATAGRID_URL_KEY_EXPANDED_GROUPS)) {\n      grid.state.expandedGroups = decodeExpandedGroupsToken(\n        params.get(DATAGRID_URL_KEY_EXPANDED_GROUPS),\n      );\n      grid.state.expandMode = 'explicit';\n      grid.state.hasPersistedExpandState = true;\n    }\n  }\n\n  const hiddenColumnsParam = params.get(DATAGRID_URL_KEY_HIDDEN_COLUMNS);\n  if (hiddenColumnsParam) {\n    const hiddenArray = grid.parseJSONArray(hiddenColumnsParam, 'hidden columns');\n    if (hiddenArray) {\n      const validFields = new Set(grid.config.columns.map((col: ColumnDefinition) => col.field));\n      grid.state.hiddenColumns = new Set(\n        hiddenArray\n          .map((field) => (typeof field === 'string' ? field.trim() : ''))\n          .filter((field) => field.length > 0 && validFields.has(field)),\n      );\n    }\n  } else if (!grid.hasPersistedHiddenColumnState && grid.config.behaviors?.columnVisibility) {\n    const allColumnFields = grid.config.columns.map((col: ColumnDefinition) => col.field);\n    const cachedHidden = grid.config.behaviors.columnVisibility.loadHiddenColumnsFromCache(allColumnFields);\n    if (cachedHidden.size > 0) {\n      grid.state.hiddenColumns = cachedHidden;\n    }\n  }\n\n  if (!grid.hasPersistedColumnOrderState && grid.config.behaviors?.columnVisibility?.loadColumnOrderFromCache) {\n    const allColumnFields = grid.config.columns.map((col: ColumnDefinition) => col.field);\n    const cachedOrder = grid.config.behaviors.columnVisibility.loadColumnOrderFromCache(allColumnFields);\n    if (cachedOrder && cachedOrder.length > 0) {\n      const validOrder = grid.mergeColumnOrder(cachedOrder);\n      grid.state.columnOrder = validOrder;\n\n      grid.didRestoreColumnOrder = true;\n      const defaultOrder = grid.defaultColumns.map((col: ColumnDefinition) => col.field);\n      grid.shouldReorderDOMOnRestore = defaultOrder.join('|') !== validOrder.join('|');\n\n      const columnMap = new Map(grid.config.columns.map((c: ColumnDefinition) => [c.field, c]));\n      grid.config.columns = validOrder\n        .map((field) => columnMap.get(field))\n        .filter((c: ColumnDefinition | undefined): c is ColumnDefinition => c !== undefined);\n    }\n  }\n\n  grid.persistStateSnapshot();\n\n  console.log('[DataGrid] State restored from URL:', grid.state);\n\n  setTimeout(() => {\n    grid.applyRestoredState();\n  }, 0);\n}\n\nexport function applyRestoredState(grid: any): void {\n  const searchInput = document.querySelector<HTMLInputElement>(grid.selectors.searchInput);\n  if (searchInput) {\n    searchInput.value = grid.state.search;\n  }\n\n  const perPageSelect = document.querySelector<HTMLSelectElement>(grid.selectors.perPageSelect);\n  if (perPageSelect) {\n    perPageSelect.value = String(grid.state.perPage);\n  }\n\n  if (grid.state.filters.length > 0) {\n    grid.state.filters.forEach((filter: ColumnFilter) => {\n      const input = document.querySelector<HTMLInputElement>(\n        `[data-filter-column=\"${filter.column}\"]`,\n      );\n      if (input) {\n        input.value = String(filter.value);\n      }\n    });\n  }\n\n  if (grid.didRestoreColumnOrder && grid.shouldReorderDOMOnRestore) {\n    grid.reorderTableColumns(grid.state.columnOrder);\n  }\n\n  const visibleColumns = grid.config.columns\n    .filter((col: ColumnDefinition) => !grid.state.hiddenColumns.has(col.field))\n    .map((col: ColumnDefinition) => col.field);\n\n  grid.updateColumnVisibility(visibleColumns, true);\n\n  if (grid.state.sort.length > 0) {\n    grid.updateSortIndicators();\n  }\n}\n\nexport function pushStateToURL(grid: any, options: { replace?: boolean } = {}): void {\n  grid.persistStateSnapshot();\n  const urlState = grid.getURLStateConfig();\n  const params = new URLSearchParams(window.location.search);\n\n  deleteSearchParams(params, DATAGRID_MANAGED_URL_KEYS);\n\n  if (grid.state.search) {\n    params.set(DATAGRID_URL_KEY_SEARCH, grid.state.search);\n  }\n\n  if (grid.state.currentPage > 1) {\n    params.set(DATAGRID_URL_KEY_PAGE, String(grid.state.currentPage));\n  }\n\n  if (grid.state.perPage !== (grid.config.perPage || 10)) {\n    params.set(DATAGRID_URL_KEY_PER_PAGE, String(grid.state.perPage));\n  }\n\n  let filtersTooLong = false;\n  if (grid.state.filters.length > 0) {\n    const serializedFilters = JSON.stringify(grid.state.filters);\n    if (serializedFilters.length <= urlState.maxFiltersLength) {\n      params.set(DATAGRID_URL_KEY_FILTERS, serializedFilters);\n    } else {\n      filtersTooLong = true;\n    }\n  }\n\n  if (grid.state.sort.length > 0) {\n    params.set(DATAGRID_URL_KEY_SORT, JSON.stringify(grid.state.sort));\n  }\n\n  if (grid.config.enableGroupedMode) {\n    params.set(DATAGRID_URL_KEY_VIEW_MODE, grid.state.viewMode);\n  }\n\n  let newURL = buildURL(window.location.pathname, params);\n\n  const exceedsBudget = newURL.length > urlState.maxURLLength;\n  if (urlState.enableStateToken && (filtersTooLong || exceedsBudget)) {\n    params.delete(DATAGRID_URL_KEY_SEARCH);\n    params.delete(DATAGRID_URL_KEY_PAGE);\n    params.delete(DATAGRID_URL_KEY_PER_PAGE);\n    params.delete(DATAGRID_URL_KEY_FILTERS);\n    params.delete(DATAGRID_URL_KEY_SORT);\n\n    const token = grid.stateStore.createShareState(grid.buildShareStateSnapshot());\n    if (token) {\n      params.set(DATAGRID_URL_KEY_STATE, token);\n    }\n    newURL = buildURL(window.location.pathname, params);\n  }\n\n  if (options.replace) {\n    window.history.replaceState({}, '', newURL);\n  } else {\n    window.history.pushState({}, '', newURL);\n  }\n  console.log('[DataGrid] URL updated:', newURL);\n}\n","export interface HTTPRequestOptions extends RequestInit {\n  json?: unknown;\n  idempotencyKey?: string;\n  accept?: string;\n}\n\nexport async function httpRequest(input: string, options: HTTPRequestOptions = {}): Promise<Response> {\n  const {\n    json,\n    idempotencyKey,\n    accept,\n    headers,\n    ...rest\n  } = options;\n\n  const mergedHeaders = new Headers(headers || {});\n  if (accept) {\n    mergedHeaders.set('Accept', accept);\n  } else if (!mergedHeaders.has('Accept')) {\n    mergedHeaders.set('Accept', 'application/json');\n  }\n\n  if (idempotencyKey && idempotencyKey.trim()) {\n    mergedHeaders.set('X-Idempotency-Key', idempotencyKey.trim());\n  }\n\n  let body = rest.body;\n  if (json !== undefined) {\n    if (!mergedHeaders.has('Content-Type')) {\n      mergedHeaders.set('Content-Type', 'application/json');\n    }\n    body = JSON.stringify(json);\n  }\n\n  return fetch(input, {\n    ...rest,\n    headers: mergedHeaders,\n    body,\n  });\n}\n\nexport async function readHTTPError(response: Response, fallback: string = 'Request failed'): Promise<string> {\n  try {\n    const text = await response.text();\n    if (text && text.trim()) {\n      return text.trim();\n    }\n  } catch {\n    // Ignore read errors and use fallback below.\n  }\n  return `${fallback}: ${response.status}`;\n}\n\nexport async function httpJSON<T = unknown>(input: string, options: HTTPRequestOptions = {}): Promise<T> {\n  const response = await httpRequest(input, options);\n  if (!response.ok) {\n    throw new Error(await readHTTPError(response));\n  }\n  return response.json() as Promise<T>;\n}\n","// @ts-nocheck\nimport type { ApiResponse, DetailResponse } from './core-types.js';\nimport { httpRequest } from '../shared/transport/http-client.js';\n\nexport async function refresh(grid: any): Promise<void> {\n    console.log('[DataGrid] ===== refresh() CALLED =====');\n    console.log('[DataGrid] Current sort state:', JSON.stringify(grid.state.sort));\n\n    if (grid.abortController) {\n      grid.abortController.abort();\n    }\n\n    grid.abortController = new AbortController();\n\n    try {\n      const url = grid.buildApiUrl();\n      const response = await httpRequest(url, {\n        signal: grid.abortController.signal,\n        method: 'GET',\n        accept: 'application/json',\n      });\n\n      if (!response.ok) {\n        if (grid.handleGroupedModeStatusFallback(response.status)) {\n          return;\n        }\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data: ApiResponse = await response.json();\n      console.log('[DataGrid] API Response:', data);\n      console.log('[DataGrid] API Response data array:', data.data);\n      console.log('[DataGrid] API Response total:', data.total, 'count:', data.count, '$meta:', data.$meta);\n      const items = data.data || data.records || [];\n      if (grid.handleGroupedModePayloadFallback(items)) {\n        return;\n      }\n      grid.lastSchema = data.schema || null;\n      grid.lastForm = data.form || null;\n      const total = grid.getResponseTotal(data);\n      if (grid.normalizePagination(total)) {\n        return grid.refresh();\n      }\n      console.log('[DataGrid] About to call renderData()...');\n      grid.renderData(data);\n      console.log('[DataGrid] renderData() completed');\n      grid.updatePaginationUI(data);\n      console.log('[DataGrid] ===== refresh() COMPLETED =====');\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        console.log('[DataGrid] Request aborted');\n        return;\n      }\n      console.error('[DataGrid] Error fetching data:', error);\n      grid.showError('Failed to load data');\n    }\n  }\n\n  /**\n   * Build API URL with all query parameters\n   */\nexport function buildApiUrl(grid: any): string {\n    const params = new URLSearchParams();\n    const queryParams = grid.buildQueryParams();\n\n    Object.entries(queryParams).forEach(([key, value]) => {\n      if (value !== null && value !== undefined) {\n        params.append(key, String(value));\n      }\n    });\n\n    const url = `${grid.config.apiEndpoint}?${params.toString()}`;\n    console.log(`[DataGrid] API URL: ${url}`);\n    return url;\n  }\n\n  /**\n   * Build query string (for exports, etc.)\n   */\nexport function buildQueryString(grid: any): string {\n    const params = new URLSearchParams();\n    const queryParams = grid.buildQueryParams();\n\n    Object.entries(queryParams).forEach(([key, value]) => {\n      if (value !== null && value !== undefined) {\n        params.append(key, String(value));\n      }\n    });\n\n    return params.toString();\n  }\n\n  /**\n   * Build query parameters from state using behaviors\n   */\nexport function buildQueryParams(grid: any): Record<string, any> {\n    const params: Record<string, any> = {};\n\n    // Pagination\n    if (grid.config.behaviors?.pagination) {\n      const paginationParams = grid.config.behaviors.pagination.buildQuery(\n        grid.state.currentPage,\n        grid.state.perPage\n      );\n      Object.assign(params, paginationParams);\n    }\n\n    // Search\n    if (grid.state.search && grid.config.behaviors?.search) {\n      const searchParams = grid.config.behaviors.search.buildQuery(grid.state.search);\n      Object.assign(params, searchParams);\n    }\n\n    // Filters\n    if (grid.state.filters.length > 0 && grid.config.behaviors?.filter) {\n      const filterParams = grid.config.behaviors.filter.buildFilters(grid.state.filters);\n      Object.assign(params, filterParams);\n    }\n\n    // Sorting\n    if (grid.state.sort.length > 0 && grid.config.behaviors?.sort) {\n      const sortParams = grid.config.behaviors.sort.buildQuery(grid.state.sort);\n      Object.assign(params, sortParams);\n    }\n\n    // Grouping (Phase 2 / TX-058)\n    if (grid.isGroupedViewActive()) {\n      params.group_by = grid.config.groupByField || 'translation_group_id';\n    }\n\n    return params;\n  }\n\nexport function getResponseTotal(grid: any, data: ApiResponse): number | null {\n    if (data.total !== undefined && data.total !== null) return data.total;\n    if (data.$meta?.count !== undefined && data.$meta?.count !== null) return data.$meta.count;\n    if (data.count !== undefined && data.count !== null) return data.count;\n    return null;\n  }\n\nexport function normalizePagination(grid: any, total: number | null): boolean {\n    if (total === null) {\n      return false;\n    }\n\n    const nextPerPage = Math.max(1, grid.state.perPage || grid.config.perPage || 10);\n    const maxPage = Math.max(1, Math.ceil(total / nextPerPage));\n    let nextPage = grid.state.currentPage;\n\n    if (total === 0) {\n      nextPage = 1;\n    } else if (nextPage > maxPage) {\n      nextPage = maxPage;\n    } else if (nextPage < 1) {\n      nextPage = 1;\n    }\n\n    const didCorrect = nextPerPage !== grid.state.perPage || nextPage !== grid.state.currentPage;\n    if (didCorrect) {\n      grid.state.perPage = nextPerPage;\n      grid.state.currentPage = nextPage;\n      grid.pushStateToURL();\n    }\n\n    if (total === 0) {\n      return false;\n    }\n\n    return didCorrect;\n  }\n\n\nexport async function fetchDetail(grid: any, id: string): Promise<{ data: any; schema?: Record<string, any>; form?: Record<string, any>; tabs?: any[] }> {\n  const response = await httpRequest(`${grid.config.apiEndpoint}/${id}`, {\n    method: 'GET',\n    accept: 'application/json',\n  });\n  if (!response.ok) {\n    throw new Error(`Detail request failed: ${response.status}`);\n  }\n  const payload = await response.json();\n  const detail = grid.normalizeDetailResponse(payload);\n  if (detail.schema) {\n    grid.lastSchema = detail.schema;\n  }\n  if (detail.form) {\n    grid.lastForm = detail.form;\n  }\n  return {\n    ...detail,\n    tabs: detail.schema?.tabs || [],\n  };\n}\n\nexport function normalizeDetailResponse(_grid: any, payload: any): { data: any; schema?: Record<string, any>; form?: Record<string, any> } {\n  if (payload && typeof payload === 'object' && 'data' in payload) {\n    const detail = payload as DetailResponse;\n    return {\n      data: detail.data,\n      schema: detail.schema,\n      form: detail.form,\n    };\n  }\n  return { data: payload };\n}\n\nexport function getSchema(grid: any): Record<string, any> | null {\n  return grid.lastSchema;\n}\n\nexport function getForm(grid: any): Record<string, any> | null {\n  return grid.lastForm;\n}\n\nexport function getTabs(grid: any): any[] {\n  return grid.lastSchema?.tabs || [];\n}\n","// @ts-nocheck\nimport type { ApiResponse, GroupedData, ViewMode } from './core-types.js';\nimport {\n  extractBackendSummaries,\n  getViewModeForViewport,\n  hasBackendGroupedRows,\n  mergeBackendSummaries,\n  normalizeBackendGroupedRows,\n  normalizeExpandMode,\n  renderGroupHeaderRow,\n  transformToGroups,\n} from './grouped-mode.js';\n\nexport function renderGroupedData(grid: any, data: ApiResponse, items: any[], tbody: HTMLElement): void {\n    const groupByField = grid.config.groupByField || 'translation_group_id';\n    const records = items.filter((item): item is Record<string, unknown> => {\n      return !!item && typeof item === 'object' && !Array.isArray(item);\n    });\n\n    // Prefer backend grouped payload when contract is available.\n    let groupedData = normalizeBackendGroupedRows(records, {\n      groupByField,\n      defaultExpanded: !grid.state.hasPersistedExpandState,\n      expandMode: grid.state.expandMode,\n      expandedGroups: grid.state.expandedGroups,\n    });\n\n    // Fallback for legacy flat payloads (local grouping).\n    if (!groupedData) {\n      groupedData = transformToGroups(records, {\n        groupByField,\n        defaultExpanded: !grid.state.hasPersistedExpandState,\n        expandMode: grid.state.expandMode,\n        expandedGroups: grid.state.expandedGroups,\n      });\n    }\n\n    // Merge backend summaries if available\n    const backendSummaries = extractBackendSummaries(data as Record<string, unknown>);\n    if (backendSummaries.size > 0) {\n      groupedData = mergeBackendSummaries(groupedData, backendSummaries);\n    }\n\n    // Store grouped data in state\n    grid.state.groupedData = groupedData;\n\n    const colSpan = grid.config.columns.length;\n\n    // Render grouped rows\n    for (const group of groupedData.groups) {\n      // Render group header row\n      const headerHtml = renderGroupHeaderRow(group, colSpan);\n      tbody.insertAdjacentHTML('beforeend', headerHtml);\n\n      // Get the header row and bind click handler\n      const headerRow = tbody.lastElementChild as HTMLElement;\n      if (headerRow) {\n        headerRow.addEventListener('click', () => grid.toggleGroup(group.groupId));\n        headerRow.addEventListener('keydown', (e: KeyboardEvent) => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            grid.toggleGroup(group.groupId);\n          }\n        });\n      }\n\n      // Render child rows (collapsed groups keep rows hidden for fast toggle updates).\n      for (const record of group.records) {\n        if (record.id) {\n          grid.recordsById[record.id as string] = record;\n        }\n        const row = grid.createTableRow(record);\n        row.dataset.groupId = group.groupId;\n        row.classList.add('group-child-row');\n        if (!group.expanded) {\n          row.style.display = 'none';\n        }\n        tbody.appendChild(row);\n      }\n    }\n\n    // Render ungrouped rows (if any)\n    for (const record of groupedData.ungrouped) {\n      if (record.id) {\n        grid.recordsById[record.id as string] = record;\n      }\n      const row = grid.createTableRow(record);\n      tbody.appendChild(row);\n    }\n\n    console.log(`[DataGrid] Rendered ${groupedData.groups.length} groups, ${groupedData.ungrouped.length} ungrouped`);\n  }\n\n  /**\n   * Whether grouped or matrix view is currently active and enabled.\n   */\nexport function isGroupedViewActive(grid: any): boolean {\n    if (!grid.config.enableGroupedMode) {\n      return false;\n    }\n    return grid.state.viewMode === 'grouped' || grid.state.viewMode === 'matrix';\n  }\n\n  /**\n   * Fallback to flat mode when grouped pagination contract is unavailable.\n   */\nexport function fallbackGroupedMode(grid: any, reason: string): void {\n    if (!grid.isGroupedViewActive()) {\n      return;\n    }\n\n    grid.state.viewMode = 'flat';\n    grid.state.groupedData = null;\n    grid.pushStateToURL({ replace: true });\n\n    grid.notify(reason, 'warning');\n    void grid.refresh();\n  }\n\n  /**\n   * Fallback on grouped mode request errors that indicate unsupported contract.\n   */\nexport function handleGroupedModeStatusFallback(grid: any, status: number): boolean {\n    if (!grid.isGroupedViewActive()) {\n      return false;\n    }\n    if (![400, 404, 405, 422].includes(status)) {\n      return false;\n    }\n    grid.fallbackGroupedMode('Grouped pagination is not supported by this panel. Switched to flat view.');\n    return true;\n  }\n\n  /**\n   * Fallback when payload does not follow backend grouped-row contract.\n   */\nexport function handleGroupedModePayloadFallback(grid: any, items: unknown[]): boolean {\n    if (!grid.isGroupedViewActive() || items.length === 0) {\n      return false;\n    }\n\n    const records = items.filter((item): item is Record<string, unknown> => {\n      return !!item && typeof item === 'object' && !Array.isArray(item);\n    });\n    if (records.length !== items.length || !hasBackendGroupedRows(records)) {\n      grid.fallbackGroupedMode('Grouped pagination contract is unavailable. Switched to flat view to avoid split groups.');\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Toggle group expand/collapse state (Phase 2)\n   */\nexport function toggleGroup(grid: any, groupId: string): void {\n    if (!grid.state.groupedData) return;\n    const normalizedGroupID = String(groupId || '').trim();\n    if (!normalizedGroupID) return;\n    const currentlyExpanded = grid.isGroupExpandedByState(normalizedGroupID, !grid.state.hasPersistedExpandState);\n\n    if (grid.state.expandMode === 'all') {\n      if (currentlyExpanded) {\n        grid.state.expandedGroups.add(normalizedGroupID);\n      } else {\n        grid.state.expandedGroups.delete(normalizedGroupID);\n      }\n    } else if (grid.state.expandMode === 'none') {\n      if (currentlyExpanded) {\n        grid.state.expandedGroups.delete(normalizedGroupID);\n      } else {\n        grid.state.expandedGroups.add(normalizedGroupID);\n      }\n    } else {\n      // When default-expanded and no explicit state exists yet, seed with all groups first.\n      if (!grid.state.hasPersistedExpandState && grid.state.expandedGroups.size === 0) {\n        grid.state.expandedGroups = new Set(grid.state.groupedData.groups.map((group) => group.groupId));\n      }\n      if (grid.state.expandedGroups.has(normalizedGroupID)) {\n        grid.state.expandedGroups.delete(normalizedGroupID);\n      } else {\n        grid.state.expandedGroups.add(normalizedGroupID);\n      }\n    }\n\n    grid.state.hasPersistedExpandState = true;\n\n    // Update the group's expanded state\n    const group = grid.state.groupedData.groups.find(g => g.groupId === normalizedGroupID);\n    if (group) {\n      group.expanded = grid.isGroupExpandedByState(normalizedGroupID);\n    }\n\n    // Re-render the affected group (toggle child row visibility)\n    grid.updateGroupVisibility(normalizedGroupID);\n    grid.pushStateToURL({ replace: true });\n  }\n\n  /**\n   * Set explicit expanded group IDs and switch expand mode to explicit.\n   */\nexport function setExpandedGroups(grid: any, groupIDs: string[]): void {\n    if (!grid.config.enableGroupedMode) {\n      return;\n    }\n    const next = new Set(\n      (groupIDs || [])\n        .map((value) => String(value || '').trim())\n        .filter(Boolean)\n    );\n    grid.state.expandMode = 'explicit';\n    grid.state.expandedGroups = next;\n    grid.state.hasPersistedExpandState = true;\n    grid.updateGroupedRowsFromState();\n    grid.pushStateToURL({ replace: true });\n    if (!grid.state.groupedData && grid.isGroupedViewActive()) {\n      void grid.refresh();\n    }\n  }\n\n  /**\n   * Expand all groups using compact mode semantics.\n   */\nexport function expandAllGroups(grid: any): void {\n    if (!grid.config.enableGroupedMode) {\n      return;\n    }\n    grid.state.expandMode = 'all';\n    grid.state.expandedGroups.clear();\n    grid.state.hasPersistedExpandState = true;\n    grid.updateGroupedRowsFromState();\n    grid.pushStateToURL({ replace: true });\n    if (!grid.state.groupedData && grid.isGroupedViewActive()) {\n      void grid.refresh();\n    }\n  }\n\n  /**\n   * Collapse all groups using compact mode semantics.\n   */\nexport function collapseAllGroups(grid: any): void {\n    if (!grid.config.enableGroupedMode) {\n      return;\n    }\n    grid.state.expandMode = 'none';\n    grid.state.expandedGroups.clear();\n    grid.state.hasPersistedExpandState = true;\n    grid.updateGroupedRowsFromState();\n    grid.pushStateToURL({ replace: true });\n    if (!grid.state.groupedData && grid.isGroupedViewActive()) {\n      void grid.refresh();\n    }\n  }\n\n  /**\n   * Update visibility of child rows for a group\n   */\nexport function updateGroupVisibility(grid: any, groupId: string): void {\n    const tbody = grid.tableEl?.querySelector('tbody');\n    if (!tbody) return;\n\n    const headerRow = tbody.querySelector(`tr[data-group-id=\"${groupId}\"]`) as HTMLElement;\n    if (!headerRow) return;\n\n    const isExpanded = grid.isGroupExpandedByState(groupId);\n\n    // Update header row state\n    headerRow.dataset.expanded = String(isExpanded);\n    headerRow.setAttribute('aria-expanded', String(isExpanded));\n\n    // Update expand icon\n    const expandIcon = headerRow.querySelector('.expand-icon');\n    if (expandIcon) {\n      expandIcon.textContent = isExpanded ? '▼' : '▶';\n    }\n\n    // Toggle child rows visibility\n    const childRows = tbody.querySelectorAll<HTMLElement>(`tr.group-child-row[data-group-id=\"${groupId}\"]`);\n    childRows.forEach(row => {\n      row.style.display = isExpanded ? '' : 'none';\n    });\n  }\n\nexport function updateGroupedRowsFromState(grid: any): void {\n    if (!grid.state.groupedData) {\n      return;\n    }\n    for (const group of grid.state.groupedData.groups) {\n      group.expanded = grid.isGroupExpandedByState(group.groupId);\n      grid.updateGroupVisibility(group.groupId);\n    }\n  }\n\nexport function isGroupExpandedByState(grid: any, groupId: string, defaultExpanded: boolean = false): boolean {\n    const mode = normalizeExpandMode(grid.state.expandMode, 'explicit');\n    if (mode === 'all') {\n      return !grid.state.expandedGroups.has(groupId);\n    }\n    if (mode === 'none') {\n      return grid.state.expandedGroups.has(groupId);\n    }\n    if (grid.state.expandedGroups.size === 0) {\n      return defaultExpanded;\n    }\n    return grid.state.expandedGroups.has(groupId);\n  }\n\n  /**\n   * Set view mode (flat, grouped, matrix) - Phase 2\n   */\nexport function setViewMode(grid: any, mode: ViewMode): void {\n    if (!grid.config.enableGroupedMode) {\n      console.warn('[DataGrid] Grouped mode not enabled');\n      return;\n    }\n\n    // Apply viewport-specific adjustments\n    const effectiveMode = getViewModeForViewport(mode);\n\n    grid.state.viewMode = effectiveMode;\n    if (effectiveMode === 'flat') {\n      grid.state.groupedData = null;\n    }\n    grid.pushStateToURL();\n\n    // Re-fetch data with new mode\n    void grid.refresh();\n  }\n\n  /**\n   * Get current view mode\n   */\nexport function getViewMode(grid: any): ViewMode {\n    return grid.state.viewMode;\n  }\n\n  /**\n   * Get grouped data (if available)\n   */\nexport function getGroupedData(grid: any): GroupedData | null {\n    return grid.state.groupedData;\n  }\n","// @ts-nocheck\nimport type { ApiResponse, ColumnDefinition } from './core-types.js';\nimport type { CellRendererContext } from './renderers.js';\nimport { renderGroupedEmptyState } from './grouped-mode.js';\nimport { httpRequest } from '../shared/transport/http-client.js';\n\nexport function updateColumnVisibility(grid: any, visibleColumns: string[], skipURLUpdate: boolean = false): void {\n    if (!grid.tableEl) return;\n\n    const visibleSet = new Set(visibleColumns);\n\n    // Update hidden columns state\n    grid.state.hiddenColumns.clear();\n    grid.config.columns.forEach(col => {\n      if (!visibleSet.has(col.field)) {\n        grid.state.hiddenColumns.add(col.field);\n      }\n    });\n\n    // Update URL with new hidden columns state (unless during restoration)\n    if (!skipURLUpdate) {\n      grid.pushStateToURL();\n    }\n\n    // Update header and filter row visibility\n    // Note: This selector matches both header row th[data-column] and filter row th[data-column]\n    // Filter row cells must have data-column attributes to stay aligned with headers\n    const headerCells = grid.tableEl.querySelectorAll('thead th[data-column]');\n    headerCells.forEach((th) => {\n      const field = (th as HTMLElement).dataset.column;\n      if (field) {\n        (th as HTMLElement).style.display = visibleSet.has(field) ? '' : 'none';\n      }\n    });\n\n    // Update body cell visibility\n    const bodyCells = grid.tableEl.querySelectorAll('tbody td[data-column]');\n    bodyCells.forEach((td) => {\n      const field = (td as HTMLElement).dataset.column;\n      if (field) {\n        (td as HTMLElement).style.display = visibleSet.has(field) ? '' : 'none';\n      }\n    });\n\n    // Sync checkbox state in column visibility menu\n    grid.syncColumnVisibilityCheckboxes();\n  }\n\n  /**\n   * Sync column visibility switches with current state\n   * Uses ColumnManager if available, falls back to direct DOM manipulation\n   */\nexport function syncColumnVisibilityCheckboxes(grid: any): void {\n    // Prefer ColumnManager if initialized\n    if (grid.columnManager) {\n      grid.columnManager.syncWithGridState();\n      return;\n    }\n\n    // Fallback to direct DOM manipulation for legacy checkboxes\n    const menu = document.querySelector(grid.selectors.columnToggleMenu);\n    if (!menu) return;\n\n    grid.config.columns.forEach(col => {\n      const checkbox = menu.querySelector<HTMLInputElement>(\n        `input[data-column=\"${col.field}\"]`\n      );\n      if (checkbox) {\n        checkbox.checked = !grid.state.hiddenColumns.has(col.field);\n      }\n    });\n  }\n\n  /**\n   * Render data into table\n   */\nexport function renderData(grid: any, data: ApiResponse): void {\n    const tbody = grid.tableEl?.querySelector('tbody');\n    if (!tbody) {\n      console.error('[DataGrid] tbody not found!');\n      return;\n    }\n\n    tbody.innerHTML = '';\n\n    const items = data.data || data.records || [];\n    console.log(`[DataGrid] renderData() called with ${items.length} items`);\n    console.log('[DataGrid] First 3 items:', items.slice(0, 3));\n    const total = grid.getResponseTotal(data);\n    grid.state.totalRows = total ?? items.length;\n\n    if (items.length === 0) {\n      // Use grouped empty state if in grouped mode\n      if (grid.isGroupedViewActive()) {\n        tbody.innerHTML = renderGroupedEmptyState(grid.config.columns.length);\n      } else {\n        tbody.innerHTML = `\n          <tr>\n            <td colspan=\"${grid.config.columns.length + 2}\" class=\"px-6 py-8 text-center text-gray-500\">\n              No results found\n            </td>\n          </tr>\n        `;\n      }\n      return;\n    }\n\n    // Clear records by ID cache\n    grid.recordsById = {};\n\n    // Phase 2: Check if grouped mode is enabled and active\n    if (grid.isGroupedViewActive()) {\n      grid.renderGroupedData(data, items, tbody);\n    } else {\n      // Flat mode rendering (original behavior)\n      grid.renderFlatData(items, tbody);\n    }\n\n    // Apply column visibility to new body cells\n    // Note: config.columns is already in the correct order, but some may be hidden\n    if (grid.state.hiddenColumns.size > 0) {\n      const bodyCells = tbody.querySelectorAll('td[data-column]');\n      bodyCells.forEach((td) => {\n        const field = (td as HTMLElement).dataset.column;\n        if (field && grid.state.hiddenColumns.has(field)) {\n          (td as HTMLElement).style.display = 'none';\n        }\n      });\n    }\n\n    // Rebind selection after rendering\n    grid.updateSelectionBindings();\n  }\n\n  /**\n   * Render data in flat mode (original behavior)\n   */\nexport function renderFlatData(grid: any, items: any[], tbody: HTMLElement): void {\n    items.forEach((item: any, index: number) => {\n      console.log(`[DataGrid] Rendering row ${index + 1}: id=${item.id}`);\n      if (item.id) {\n        grid.recordsById[item.id] = item;\n      }\n      const row = grid.createTableRow(item);\n      tbody.appendChild(row);\n    });\n\n    console.log(`[DataGrid] Finished appending ${items.length} rows to tbody`);\n    console.log(`[DataGrid] tbody.children.length =`, tbody.children.length);\n  }\n\n  /**\n   * Render data in grouped mode (Phase 2)\n   */\nexport function resolveRendererOptions(grid: any, col: ColumnDefinition): Record<string, any> {\n    const options = col.rendererOptions ?? col.renderer_options;\n    if (!options || typeof options !== 'object' || Array.isArray(options)) {\n      return {};\n    }\n    return options;\n  }\n\n  /**\n   * Create table row element\n   */\nexport function createTableRow(grid: any, item: any): HTMLTableRowElement {\n    const row = document.createElement('tr');\n\n    // Apply custom row classes if provider is configured\n    let rowClasses = ['hover:bg-gray-50'];\n    if (grid.config.rowClassProvider) {\n      rowClasses = rowClasses.concat(grid.config.rowClassProvider(item));\n    }\n    row.className = rowClasses.join(' ');\n\n    // Checkbox cell\n    const checkboxCell = document.createElement('td');\n    checkboxCell.className = 'px-6 py-4 whitespace-nowrap';\n    checkboxCell.dataset.role = 'selection';\n    checkboxCell.dataset.fixed = 'left';\n    checkboxCell.innerHTML = `\n      <label class=\"flex\">\n        <input type=\"checkbox\"\n               class=\"table-checkbox shrink-0 border-gray-300 rounded text-blue-600 focus:ring-blue-500\"\n               data-id=\"${item.id}\">\n        <span class=\"sr-only\">Select</span>\n      </label>\n    `;\n    row.appendChild(checkboxCell);\n\n    // Data cells\n    grid.config.columns.forEach((col) => {\n      const cell = document.createElement('td');\n      cell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-800';\n      cell.setAttribute('data-column', col.field);\n\n      const value = item[col.field];\n      const rendererName = typeof col.renderer === 'string' ? col.renderer.trim() : '';\n      const rendererContext: CellRendererContext = {\n        options: grid.resolveRendererOptions(col),\n      };\n\n      // Priority: column render > field renderer > named renderer > default renderer\n      if (col.render) {\n        cell.innerHTML = col.render(value, item);\n      } else if (grid.cellRendererRegistry.has(col.field)) {\n        const renderer = grid.cellRendererRegistry.get(col.field);\n        cell.innerHTML = renderer(value, item, col.field, rendererContext);\n      } else if (rendererName && grid.cellRendererRegistry.has(rendererName)) {\n        const renderer = grid.cellRendererRegistry.get(rendererName);\n        cell.innerHTML = renderer(value, item, col.field, rendererContext);\n      } else if (value === null || value === undefined) {\n        cell.textContent = '-';\n      } else if (col.field.includes('_at')) {\n        cell.textContent = new Date(value).toLocaleDateString();\n      } else {\n        cell.textContent = String(value);\n      }\n\n      row.appendChild(cell);\n    });\n\n    // Actions cell\n    const actionBase = grid.config.actionBasePath || grid.config.apiEndpoint;\n    const actionsCell = document.createElement('td');\n    actionsCell.className = 'px-6 py-4 whitespace-nowrap text-end text-sm font-medium';\n    actionsCell.dataset.role = 'actions';\n    actionsCell.dataset.fixed = 'right';\n\n    // Use custom row actions if provided, otherwise use default actions\n    if (grid.config.rowActions) {\n      const actions = grid.config.rowActions(item);\n      actionsCell.innerHTML = grid.actionRenderer.renderRowActions(item, actions);\n\n      // Attach event listeners for each action button\n      actions.forEach(action => {\n        const actionId = grid.sanitizeActionId(action.label);\n        const button = actionsCell.querySelector(`[data-action-id=\"${actionId}\"]`);\n        if (action.disabled) {\n          return;\n        }\n        if (button) {\n          button.addEventListener('click', async (e) => {\n            e.preventDefault();\n            if ((button as HTMLButtonElement).disabled) {\n              return;\n            }\n            try {\n              await action.action(item);\n            } catch (error) {\n              console.error(`Action \"${action.label}\" failed:`, error);\n              const errorMsg = error instanceof Error ? error.message : `Action \"${action.label}\" failed`;\n              grid.notify(errorMsg, 'error');\n            }\n          });\n        }\n      });\n    } else if (grid.config.useDefaultActions !== false) {\n      // Default actions (view, edit, delete)\n      const defaultActions = [\n        {\n          label: 'View',\n          icon: 'eye',\n          action: () => { window.location.href = `${actionBase}/${item.id}`; },\n          variant: 'secondary' as const\n        },\n        {\n          label: 'Edit',\n          icon: 'edit',\n          action: () => { window.location.href = `${actionBase}/${item.id}/edit`; },\n          variant: 'primary' as const\n        },\n        {\n          label: 'Delete',\n          icon: 'trash',\n          action: async () => { await grid.handleDelete(item.id); },\n          variant: 'danger' as const\n        }\n      ];\n\n      actionsCell.innerHTML = grid.actionRenderer.renderRowActions(item, defaultActions);\n\n      // Attach event listeners for each default action\n      defaultActions.forEach(action => {\n        const actionId = grid.sanitizeActionId(action.label);\n        const button = actionsCell.querySelector(`[data-action-id=\"${actionId}\"]`);\n        if (button) {\n          button.addEventListener('click', async (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            if ((button as HTMLButtonElement).disabled) {\n              return;\n            }\n            try {\n              await action.action();\n            } catch (error) {\n              console.error(`Action \"${action.label}\" failed:`, error);\n              const errorMsg = error instanceof Error ? error.message : `Action \"${action.label}\" failed`;\n              grid.notify(errorMsg, 'error');\n            }\n          });\n        }\n      });\n    }\n\n    row.appendChild(actionsCell);\n\n    return row;\n  }\n\n  /**\n   * Sanitize action label to create a valid ID\n   */\nexport function sanitizeActionId(grid: any, label: string): string {\n    return label.toLowerCase().replace(/[^a-z0-9]/g, '-');\n  }\n\n  /**\n   * Handle delete action\n   */\nexport async function handleDelete(grid: any, id: string): Promise<void> {\n    const confirmed = await grid.confirmAction('Are you sure you want to delete this item?');\n    if (!confirmed) {\n      return;\n    }\n\n    try {\n      const response = await httpRequest(`${grid.config.apiEndpoint}/${id}`, {\n        method: 'DELETE',\n        accept: 'application/json',\n      });\n\n      if (!response.ok) {\n        throw new Error('Delete failed');\n      }\n\n      await grid.refresh();\n    } catch (error) {\n      console.error('Error deleting item:', error);\n      grid.showError('Failed to delete item');\n    }\n  }\n\n  /**\n   * Update pagination UI\n   */\nexport function updatePaginationUI(grid: any, data: ApiResponse): void {\n    const total = grid.getResponseTotal(data) ?? grid.state.totalRows;\n    const offset = grid.state.perPage * (grid.state.currentPage - 1);\n    const start = total === 0 ? 0 : offset + 1;\n    const end = Math.min(offset + grid.state.perPage, total);\n\n    const startEl = document.querySelector(grid.selectors.tableInfoStart);\n    const endEl = document.querySelector(grid.selectors.tableInfoEnd);\n    const totalEl = document.querySelector(grid.selectors.tableInfoTotal);\n\n    if (startEl) startEl.textContent = String(start);\n    if (endEl) endEl.textContent = String(end);\n    if (totalEl) totalEl.textContent = String(total);\n\n    grid.renderPaginationButtons(total);\n  }\n\n  /**\n   * Render pagination buttons\n   */\nexport function renderPaginationButtons(grid: any, total: number): void {\n    const container = document.querySelector(grid.selectors.paginationContainer);\n    if (!container) return;\n\n    const totalPages = Math.ceil(total / grid.state.perPage);\n    if (totalPages <= 1) {\n      container.innerHTML = '';\n      return;\n    }\n\n    const buttons: string[] = [];\n    const current = grid.state.currentPage;\n\n    // Previous button\n    buttons.push(`\n      <button type=\"button\"\n              data-page=\"${current - 1}\"\n              ${current === 1 ? 'disabled' : ''}\n              class=\"min-h-[38px] min-w-[38px] py-2 px-2.5 inline-flex justify-center items-center gap-x-1.5 text-sm rounded-lg text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none\">\n        <svg class=\"shrink-0 size-3.5\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"m15 18-6-6 6-6\"></path>\n        </svg>\n        <span>Previous</span>\n      </button>\n    `);\n\n    // Page numbers\n    const maxButtons = 5;\n    let startPage = Math.max(1, current - Math.floor(maxButtons / 2));\n    let endPage = Math.min(totalPages, startPage + maxButtons - 1);\n\n    if (endPage - startPage < maxButtons - 1) {\n      startPage = Math.max(1, endPage - maxButtons + 1);\n    }\n\n    for (let i = startPage; i <= endPage; i++) {\n      const isActive = i === current;\n      buttons.push(`\n        <button type=\"button\"\n                data-page=\"${i}\"\n                class=\"min-h-[38px] min-w-[38px] flex justify-center items-center ${\n                  isActive\n                    ? 'bg-gray-200 text-gray-800 focus:outline-none focus:bg-gray-300'\n                    : 'text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100'\n                } py-2 px-3 text-sm rounded-lg\">\n          ${i}\n        </button>\n      `);\n    }\n\n    // Next button\n    buttons.push(`\n      <button type=\"button\"\n              data-page=\"${current + 1}\"\n              ${current === totalPages ? 'disabled' : ''}\n              class=\"min-h-[38px] min-w-[38px] py-2 px-2.5 inline-flex justify-center items-center gap-x-1.5 text-sm rounded-lg text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none\">\n        <span>Next</span>\n        <svg class=\"shrink-0 size-3.5\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"m9 18 6-6-6-6\"></path>\n        </svg>\n      </button>\n    `);\n\n    container.innerHTML = buttons.join('');\n\n    // Bind click handlers\n    container.querySelectorAll('[data-page]').forEach((btn) => {\n      btn.addEventListener('click', async () => {\n        const page = parseInt((btn as HTMLElement).dataset.page || '1', 10);\n        if (page >= 1 && page <= totalPages) {\n          grid.state.currentPage = page;\n          grid.pushStateToURL();\n          if (grid.config.behaviors?.pagination) {\n            await grid.config.behaviors.pagination.onPageChange(page, grid);\n          } else {\n            await grid.refresh();\n          }\n        }\n      });\n    });\n  }\n","import Sortable from 'sortablejs';\nimport type { DataGrid } from './core.js';\n\n/**\n * Configuration for the ColumnManager component\n */\nexport interface ColumnManagerConfig {\n  container: HTMLElement;\n  grid: DataGrid;\n  onReorder?: (order: string[]) => void;\n  onToggle?: (field: string, visible: boolean) => void;\n  onReset?: () => void;\n}\n\n/**\n * ColumnManager - Manages column visibility and ordering with drag-and-drop support\n *\n * Renders a list of columns with:\n * - Search/filter field to find columns quickly\n * - Item count badge showing visible/total columns\n * - Scroll shadows to indicate content above/below fold\n * - Drag handles for reordering\n * - iOS-style switches for visibility toggle\n *\n * Uses safe DOM construction (textContent) to prevent XSS when labels come from server metadata.\n */\nexport class ColumnManager {\n  private container: HTMLElement;\n  private grid: DataGrid;\n  private sortable: Sortable | null = null;\n  private onReorder?: (order: string[]) => void;\n  private onToggle?: (field: string, visible: boolean) => void;\n  private onReset?: () => void;\n  private searchInput: HTMLInputElement | null = null;\n  private columnListEl: HTMLElement | null = null;\n  private countBadgeEl: HTMLElement | null = null;\n\n  constructor(config: ColumnManagerConfig) {\n    this.container = config.container;\n    this.grid = config.grid;\n    this.onReorder = config.onReorder;\n    this.onToggle = config.onToggle;\n    this.onReset = config.onReset;\n    this.initialize();\n  }\n\n  private initialize(): void {\n    // Render column items with switches and drag handles\n    this.render();\n\n    // Setup SortableJS for drag-and-drop\n    this.setupDragAndDrop();\n\n    // Bind switch toggle events\n    this.bindSwitchToggles();\n\n    // Setup scroll shadow detection\n    this.setupScrollShadows();\n  }\n\n  /**\n   * Render column items using safe DOM construction\n   * Uses textContent for labels to prevent XSS\n   */\n  private render(): void {\n    const columns = this.grid.config.columns;\n    const hiddenSet = this.grid.state.hiddenColumns;\n\n    // Clear container\n    this.container.innerHTML = '';\n\n    // Create header with search and count badge\n    const header = this.createHeader(columns.length, columns.length - hiddenSet.size);\n    this.container.appendChild(header);\n\n    // Create column list wrapper for SortableJS\n    const columnList = document.createElement('div');\n    columnList.className = 'column-list';\n    columnList.setAttribute('role', 'list');\n    columnList.setAttribute('aria-label', 'Column visibility and order');\n    this.columnListEl = columnList;\n\n    // Build each column item using DOM APIs (safe from XSS)\n    columns.forEach(col => {\n      const item = this.createColumnItem(col.field, col.label || col.field, !hiddenSet.has(col.field));\n      columnList.appendChild(item);\n    });\n\n    this.container.appendChild(columnList);\n\n    // Add Reset to Default button at the bottom\n    const footer = this.createFooter();\n    this.container.appendChild(footer);\n  }\n\n  /**\n   * Create header with search input and count badge\n   */\n  private createHeader(totalCount: number, visibleCount: number): HTMLElement {\n    const header = document.createElement('div');\n    header.className = 'column-manager-header';\n\n    // Search input container\n    const searchContainer = document.createElement('div');\n    searchContainer.className = 'column-search-container';\n\n    const searchIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    searchIcon.setAttribute('class', 'column-search-icon');\n    searchIcon.setAttribute('viewBox', '0 0 24 24');\n    searchIcon.setAttribute('fill', 'none');\n    searchIcon.setAttribute('stroke', 'currentColor');\n    searchIcon.setAttribute('stroke-width', '2');\n    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n    circle.setAttribute('cx', '11');\n    circle.setAttribute('cy', '11');\n    circle.setAttribute('r', '8');\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.setAttribute('d', 'm21 21-4.3-4.3');\n    searchIcon.appendChild(circle);\n    searchIcon.appendChild(path);\n\n    const searchInput = document.createElement('input');\n    searchInput.type = 'text';\n    searchInput.className = 'column-search-input';\n    searchInput.placeholder = 'Filter columns...';\n    searchInput.setAttribute('aria-label', 'Filter columns');\n    this.searchInput = searchInput;\n\n    // Bind search input\n    searchInput.addEventListener('input', () => {\n      this.filterColumns(searchInput.value);\n    });\n\n    searchContainer.appendChild(searchIcon);\n    searchContainer.appendChild(searchInput);\n\n    // Count badge\n    const countBadge = document.createElement('span');\n    countBadge.className = 'column-count-badge';\n    countBadge.textContent = `${visibleCount} of ${totalCount}`;\n    countBadge.setAttribute('aria-live', 'polite');\n    this.countBadgeEl = countBadge;\n\n    header.appendChild(searchContainer);\n    header.appendChild(countBadge);\n\n    return header;\n  }\n\n  /**\n   * Filter columns by search term\n   */\n  private filterColumns(searchTerm: string): void {\n    const term = searchTerm.toLowerCase().trim();\n    const items = this.container.querySelectorAll('.column-item');\n\n    items.forEach((item) => {\n      const label = item.querySelector('.column-label')?.textContent?.toLowerCase() || '';\n      const matches = term === '' || label.includes(term);\n      (item as HTMLElement).style.display = matches ? '' : 'none';\n    });\n\n    // Update scroll shadows after filtering\n    this.updateScrollShadows();\n  }\n\n  /**\n   * Update the count badge\n   */\n  private updateCountBadge(): void {\n    if (!this.countBadgeEl) return;\n\n    const columns = this.grid.config.columns;\n    const hiddenSet = this.grid.state.hiddenColumns;\n    const visibleCount = columns.length - hiddenSet.size;\n\n    this.countBadgeEl.textContent = `${visibleCount} of ${columns.length}`;\n  }\n\n  /**\n   * Setup scroll shadow detection on the column list\n   */\n  private setupScrollShadows(): void {\n    if (!this.columnListEl) return;\n\n    // Initial check\n    this.updateScrollShadows();\n\n    // Update on scroll\n    this.columnListEl.addEventListener('scroll', () => {\n      this.updateScrollShadows();\n    });\n\n    // Update on resize (debounced)\n    const resizeObserver = new ResizeObserver(() => {\n      this.updateScrollShadows();\n    });\n    resizeObserver.observe(this.columnListEl);\n  }\n\n  /**\n   * Update scroll shadow classes based on scroll position\n   */\n  private updateScrollShadows(): void {\n    if (!this.columnListEl) return;\n\n    const el = this.columnListEl;\n    const scrollTop = el.scrollTop;\n    const scrollHeight = el.scrollHeight;\n    const clientHeight = el.clientHeight;\n\n    // Check if content is scrollable\n    const isScrollable = scrollHeight > clientHeight;\n\n    // Determine shadow states\n    const hasTopShadow = isScrollable && scrollTop > 0;\n    const hasBottomShadow = isScrollable && (scrollTop + clientHeight) < (scrollHeight - 1);\n\n    // Apply classes\n    el.classList.toggle('column-list--shadow-top', hasTopShadow);\n    el.classList.toggle('column-list--shadow-bottom', hasBottomShadow);\n  }\n\n  /**\n   * Create footer with Reset to Default button\n   */\n  private createFooter(): HTMLElement {\n    const footer = document.createElement('div');\n    footer.className = 'column-manager-footer';\n\n    const resetBtn = document.createElement('button');\n    resetBtn.type = 'button';\n    resetBtn.className = 'column-reset-btn';\n    resetBtn.setAttribute('aria-label', 'Reset columns to default');\n\n    // Reset icon (SVG)\n    const resetIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    resetIcon.setAttribute('class', 'column-reset-icon');\n    resetIcon.setAttribute('viewBox', '0 0 24 24');\n    resetIcon.setAttribute('fill', 'none');\n    resetIcon.setAttribute('stroke', 'currentColor');\n    resetIcon.setAttribute('stroke-width', '2');\n    resetIcon.setAttribute('stroke-linecap', 'round');\n    resetIcon.setAttribute('stroke-linejoin', 'round');\n\n    // Rotate CCW icon path\n    const path1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path1.setAttribute('d', 'M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8');\n    const path2 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path2.setAttribute('d', 'M3 3v5h5');\n    resetIcon.appendChild(path1);\n    resetIcon.appendChild(path2);\n\n    const resetText = document.createElement('span');\n    resetText.textContent = 'Reset to Default';\n\n    resetBtn.appendChild(resetIcon);\n    resetBtn.appendChild(resetText);\n\n    // Bind reset click handler\n    resetBtn.addEventListener('click', () => {\n      this.handleReset();\n    });\n\n    footer.appendChild(resetBtn);\n    return footer;\n  }\n\n  /**\n   * Handle reset button click\n   */\n  private handleReset(): void {\n    this.grid.resetColumnsToDefault();\n    this.onReset?.();\n\n    // Clear search and update UI\n    if (this.searchInput) {\n      this.searchInput.value = '';\n      this.filterColumns('');\n    }\n    this.updateCountBadge();\n  }\n\n  /**\n   * Create a single column item element\n   * Uses DOM APIs with textContent for safe label rendering\n   * Includes full ARIA support for accessibility\n   */\n  private createColumnItem(field: string, label: string, isVisible: boolean): HTMLElement {\n    const itemId = `column-item-${field}`;\n    const switchId = `column-switch-${field}`;\n\n    const item = document.createElement('div');\n    item.className = 'column-item';\n    item.id = itemId;\n    item.dataset.column = field;\n    item.setAttribute('role', 'listitem');\n\n    // Content wrapper (drag handle + label)\n    const content = document.createElement('div');\n    content.className = 'column-item-content';\n\n    // Drag handle SVG with accessibility\n    const dragHandle = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    dragHandle.setAttribute('class', 'drag-handle');\n    dragHandle.setAttribute('viewBox', '0 0 20 20');\n    dragHandle.setAttribute('fill', 'currentColor');\n    dragHandle.setAttribute('aria-hidden', 'true');  // Decorative, hidden from screen readers\n    dragHandle.setAttribute('focusable', 'false');\n\n    // Create 6 dots for drag handle (2x3 grid)\n    const dotPositions = [\n      [5, 4], [5, 10], [5, 16],\n      [11, 4], [11, 10], [11, 16]\n    ];\n    dotPositions.forEach(([cx, cy]) => {\n      const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n      circle.setAttribute('cx', String(cx));\n      circle.setAttribute('cy', String(cy));\n      circle.setAttribute('r', '1.5');\n      dragHandle.appendChild(circle);\n    });\n\n    // Label (uses textContent for XSS safety)\n    const labelSpan = document.createElement('span');\n    labelSpan.className = 'column-label';\n    labelSpan.id = `${itemId}-label`;\n    labelSpan.textContent = label;\n\n    content.appendChild(dragHandle);\n    content.appendChild(labelSpan);\n\n    // Switch toggle with full accessibility\n    const switchLabel = document.createElement('label');\n    switchLabel.className = 'column-switch';\n    switchLabel.htmlFor = switchId;\n\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.id = switchId;\n    checkbox.dataset.column = field;\n    checkbox.checked = isVisible;\n    checkbox.setAttribute('role', 'switch');\n    checkbox.setAttribute('aria-checked', String(isVisible));\n    checkbox.setAttribute('aria-labelledby', `${itemId}-label`);\n    checkbox.setAttribute('aria-describedby', `${itemId}-desc`);\n\n    // Hidden description for screen readers\n    const description = document.createElement('span');\n    description.id = `${itemId}-desc`;\n    description.className = 'sr-only';\n    description.textContent = `Press Space or Enter to toggle ${label} column visibility. Currently ${isVisible ? 'visible' : 'hidden'}.`;\n\n    const slider = document.createElement('span');\n    slider.className = 'column-switch-slider';\n    slider.setAttribute('aria-hidden', 'true');  // Visual-only element\n\n    switchLabel.appendChild(checkbox);\n    switchLabel.appendChild(slider);\n\n    item.appendChild(content);\n    item.appendChild(switchLabel);\n    item.appendChild(description);\n\n    return item;\n  }\n\n  /**\n   * Setup SortableJS for drag-and-drop reordering\n   */\n  private setupDragAndDrop(): void {\n    // SortableJS should be attached to the column-list wrapper, not the container\n    const columnList = this.container.querySelector('.column-list') || this.container;\n\n    this.sortable = Sortable.create(columnList as HTMLElement, {\n      animation: 150,\n      handle: '.drag-handle',\n      ghostClass: 'column-item-ghost',\n      dragClass: 'column-item-drag',\n      chosenClass: 'column-item-chosen',\n      // Touch handling for mobile\n      touchStartThreshold: 3,\n      delay: 100,\n      delayOnTouchOnly: true,\n      onEnd: () => {\n        // Get current column order from DOM\n        const items = columnList.querySelectorAll('.column-item');\n        const newOrder = Array.from(items).map(item =>\n          (item as HTMLElement).dataset.column!\n        );\n\n        // Notify via callback if provided\n        if (this.onReorder) {\n          this.onReorder(newOrder);\n        }\n\n        // Apply to grid (Phase FE2)\n        this.grid.reorderColumns(newOrder);\n\n        // Also persist via behavior layer\n        this.grid.config.behaviors?.columnVisibility?.reorderColumns?.(newOrder, this.grid);\n      }\n    });\n  }\n\n  /**\n   * Bind change events for visibility switches\n   * Includes ARIA state updates for accessibility\n   */\n  private bindSwitchToggles(): void {\n    const switches = this.container.querySelectorAll<HTMLInputElement>('input[type=\"checkbox\"]');\n\n    switches.forEach((checkbox) => {\n      checkbox.addEventListener('change', () => {\n        const field = checkbox.dataset.column;\n        if (!field) return;\n\n        const isVisible = checkbox.checked;\n\n        // Update ARIA attributes\n        checkbox.setAttribute('aria-checked', String(isVisible));\n\n        // Update description text\n        const descId = `column-item-${field}-desc`;\n        const description = this.container.querySelector(`#${descId}`);\n        if (description) {\n          const label = this.container.querySelector(`#column-item-${field}-label`)?.textContent || field;\n          description.textContent = `Press Space or Enter to toggle ${label} column visibility. Currently ${isVisible ? 'visible' : 'hidden'}.`;\n        }\n\n        // Notify via callback if provided\n        if (this.onToggle) {\n          this.onToggle(field, isVisible);\n        }\n\n        // Use behavior layer for toggle\n        if (this.grid.config.behaviors?.columnVisibility) {\n          this.grid.config.behaviors.columnVisibility.toggleColumn(field, this.grid);\n        }\n\n        // Update count badge\n        this.updateCountBadge();\n      });\n    });\n  }\n\n  /**\n   * Update the switch state for a specific column\n   * Called when visibility changes externally (e.g., URL restore)\n   * Also updates ARIA attributes for accessibility\n   */\n  updateSwitchState(field: string, isVisible: boolean): void {\n    const checkbox = this.container.querySelector<HTMLInputElement>(\n      `input[type=\"checkbox\"][data-column=\"${field}\"]`\n    );\n    if (checkbox) {\n      checkbox.checked = isVisible;\n      checkbox.setAttribute('aria-checked', String(isVisible));\n    }\n  }\n\n  /**\n   * Sync all switch states with current grid state\n   */\n  syncWithGridState(): void {\n    const hiddenSet = this.grid.state.hiddenColumns;\n    this.grid.config.columns.forEach(col => {\n      this.updateSwitchState(col.field, !hiddenSet.has(col.field));\n    });\n    this.updateCountBadge();\n  }\n\n  /**\n   * Get the current column order from the DOM\n   */\n  getColumnOrder(): string[] {\n    const items = this.container.querySelectorAll('.column-item');\n    return Array.from(items).map(item => (item as HTMLElement).dataset.column!);\n  }\n\n  /**\n   * Re-render the column list (e.g., after columns change)\n   */\n  refresh(): void {\n    // Re-render replaces the `.column-list` node, so Sortable must be re-initialized.\n    this.destroy();\n    this.render();\n    this.setupDragAndDrop();\n    this.bindSwitchToggles();\n    this.setupScrollShadows();\n  }\n\n  /**\n   * Cleanup - destroy SortableJS instance\n   */\n  destroy(): void {\n    if (this.sortable) {\n      this.sortable.destroy();\n      this.sortable = null;\n    }\n  }\n}\n\n// Export for module usage\nexport default ColumnManager;\n","export type DelegatedEventHandler = (event: Event, matched: HTMLElement) => void;\n\nexport function addDelegatedEventListener(\n  root: Document | HTMLElement,\n  eventName: string,\n  selector: string,\n  handler: DelegatedEventHandler,\n  options?: AddEventListenerOptions,\n): () => void {\n  const listener = (event: Event) => {\n    const target = event.target as Element | null;\n    if (!target) {\n      return;\n    }\n    const matched = target.closest(selector);\n    if (!matched || !(matched instanceof HTMLElement)) {\n      return;\n    }\n    handler(event, matched);\n  };\n\n  root.addEventListener(eventName, listener, options);\n  return () => root.removeEventListener(eventName, listener, options);\n}\n","// @ts-nocheck\nimport type { ColumnFilter } from './core-types.js';\nimport { ColumnManager } from './column-manager.js';\nimport { extractErrorMessage } from '../toast/error-helpers.js';\nimport { addDelegatedEventListener } from '../shared/events/delegation.js';\n\nexport function bindSearchInput(grid: any): void {\n    const input = document.querySelector<HTMLInputElement>(grid.selectors.searchInput);\n    if (!input) {\n      console.warn(`[DataGrid] Search input not found: ${grid.selectors.searchInput}`);\n      return;\n    }\n\n    console.log(`[DataGrid] Search input bound to: ${grid.selectors.searchInput}`);\n\n    const clearBtn = document.getElementById('clear-search-btn');\n\n    // Toggle clear button visibility\n    const toggleClearBtn = () => {\n      if (clearBtn) {\n        if (input.value.trim()) {\n          clearBtn.classList.remove('hidden');\n        } else {\n          clearBtn.classList.add('hidden');\n        }\n      }\n    };\n\n    input.addEventListener('input', () => {\n      toggleClearBtn();\n\n      if (grid.searchTimeout) {\n        clearTimeout(grid.searchTimeout);\n      }\n\n      grid.searchTimeout = window.setTimeout(async () => {\n        console.log(`[DataGrid] Search triggered: \"${input.value}\"`);\n        grid.state.search = input.value;\n        grid.pushStateToURL();\n        if (grid.config.behaviors?.search) {\n          await grid.config.behaviors.search.onSearch(input.value, grid);\n        } else {\n          grid.resetPagination();\n          await grid.refresh();\n        }\n      }, grid.config.searchDelay);\n    });\n\n    // Clear button handler\n    if (clearBtn) {\n      clearBtn.addEventListener('click', async () => {\n        input.value = '';\n        input.focus();\n        toggleClearBtn();\n\n        // Trigger search with empty value\n        grid.state.search = '';\n        grid.pushStateToURL();\n        if (grid.config.behaviors?.search) {\n          await grid.config.behaviors.search.onSearch('', grid);\n        } else {\n          grid.resetPagination();\n          await grid.refresh();\n        }\n      });\n    }\n\n    // Initial toggle on page load\n    toggleClearBtn();\n  }\n\n  /**\n   * Bind per-page select\n   */\nexport function bindPerPageSelect(grid: any): void {\n    const select = document.querySelector<HTMLSelectElement>(grid.selectors.perPageSelect);\n    if (!select) return;\n\n    select.addEventListener('change', async () => {\n      grid.state.perPage = parseInt(select.value, 10);\n      grid.resetPagination();\n      grid.pushStateToURL();\n      await grid.refresh();\n    });\n  }\n\n  /**\n   * Bind filter inputs\n   */\nexport function bindFilterInputs(grid: any): void {\n    const filterInputs = document.querySelectorAll<HTMLInputElement | HTMLSelectElement>(grid.selectors.filterRow);\n\n    filterInputs.forEach((input) => {\n      // Handler function for both input and change events\n      const handleFilterChange = async () => {\n        const column = input.dataset.filterColumn;\n        const inputType = input instanceof HTMLInputElement ? input.type.toLowerCase() : '';\n        const inferredOperator = input instanceof HTMLSelectElement\n          ? 'eq'\n          : (inputType === '' || inputType === 'text' || inputType === 'search' || inputType === 'email' || inputType === 'tel' || inputType === 'url')\n            ? 'ilike'\n            : 'eq';\n        const operator = (input.dataset.filterOperator as any) || inferredOperator;\n        const value = input.value;\n\n        if (!column) return;\n\n        // Update filters state\n        const existingIndex = grid.state.filters.findIndex(f => f.column === column);\n        if (value) {\n          const filter: ColumnFilter = { column, operator, value };\n          if (existingIndex >= 0) {\n            grid.state.filters[existingIndex] = filter;\n          } else {\n            grid.state.filters.push(filter);\n          }\n        } else {\n          // Remove filter if value is empty\n          if (existingIndex >= 0) {\n            grid.state.filters.splice(existingIndex, 1);\n          }\n        }\n\n        grid.pushStateToURL();\n        if (grid.config.behaviors?.filter) {\n          await grid.config.behaviors.filter.onFilterChange(column, value, grid);\n        } else {\n          grid.resetPagination();\n          await grid.refresh();\n        }\n      };\n\n      // Bind both input (for text inputs) and change (for selects) events\n      input.addEventListener('input', handleFilterChange);\n      input.addEventListener('change', handleFilterChange);\n    });\n  }\n\n  /**\n   * Bind column visibility toggle using ColumnManager\n   */\nexport function bindColumnVisibility(grid: any): void {\n    const toggleBtn = document.querySelector(grid.selectors.columnToggleBtn);\n    const menu = document.querySelector<HTMLElement>(grid.selectors.columnToggleMenu);\n\n    if (!toggleBtn || !menu) return;\n\n    // Initialize ColumnManager to render column items with switches and drag handles\n    grid.columnManager = new ColumnManager({\n      container: menu,\n      grid: grid,\n      onToggle: (field, visible) => {\n        console.log(`[DataGrid] Column ${field} visibility toggled to ${visible}`);\n      },\n      onReorder: (order) => {\n        console.log(`[DataGrid] Columns reordered:`, order);\n      }\n    });\n  }\n\n  /**\n   * Bind export buttons\n   */\nexport function bindExportButtons(grid: any): void {\n    const menu = document.querySelector(grid.selectors.exportMenu);\n    if (!menu) return;\n\n    const exportButtons = menu.querySelectorAll<HTMLButtonElement>('[data-export-format]');\n\n    exportButtons.forEach((btn) => {\n      btn.addEventListener('click', async () => {\n        const format = (btn as HTMLElement).dataset.exportFormat as 'csv' | 'json' | 'excel' | 'pdf';\n        if (!format || !grid.config.behaviors?.export) return;\n\n        // Get concurrency mode (default to 'single')\n        const concurrency = grid.config.behaviors.export.getConcurrency?.() || 'single';\n\n        // Determine which buttons to disable based on concurrency mode\n        const buttonsToDisable: HTMLButtonElement[] = [];\n        if (concurrency === 'single') {\n          // Disable all export buttons\n          exportButtons.forEach(b => buttonsToDisable.push(b));\n        } else if (concurrency === 'per-format') {\n          // Disable only the clicked button\n          buttonsToDisable.push(btn);\n        }\n        // 'none' mode: no buttons disabled, but clicked button still shows spinner\n\n        // Helper to toggle spinner visibility on a button\n        const showSpinner = (b: HTMLButtonElement) => {\n          const icon = b.querySelector('.export-icon');\n          const spinner = b.querySelector('.export-spinner');\n          if (icon) icon.classList.add('hidden');\n          if (spinner) spinner.classList.remove('hidden');\n        };\n\n        const hideSpinner = (b: HTMLButtonElement) => {\n          const icon = b.querySelector('.export-icon');\n          const spinner = b.querySelector('.export-spinner');\n          if (icon) icon.classList.remove('hidden');\n          if (spinner) spinner.classList.add('hidden');\n        };\n\n        // Apply loading state to buttons that should be disabled\n        buttonsToDisable.forEach(b => {\n          b.setAttribute('data-export-loading', 'true');\n          b.disabled = true;\n          showSpinner(b);\n        });\n\n        // For 'none' mode, still show spinner on clicked button (but don't disable)\n        const showSpinnerOnly = concurrency === 'none';\n        if (showSpinnerOnly) {\n          btn.setAttribute('data-export-loading', 'true');\n          showSpinner(btn);\n        }\n\n        try {\n          await grid.config.behaviors.export.export(format, grid);\n        } catch (error) {\n          // Error already handled by the export behavior (toast shown)\n          console.error('[DataGrid] Export failed:', error);\n        } finally {\n          // Clear loading state from disabled buttons\n          buttonsToDisable.forEach(b => {\n            b.removeAttribute('data-export-loading');\n            b.disabled = false;\n            hideSpinner(b);\n          });\n\n          // Clear spinner-only state for 'none' mode\n          if (showSpinnerOnly) {\n            btn.removeAttribute('data-export-loading');\n            hideSpinner(btn);\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Bind table sorting\n   */\nexport function bindSorting(grid: any): void {\n    if (!grid.tableEl) return;\n\n    // Bind new sort buttons ([data-sort-column])\n    const sortButtons = grid.tableEl.querySelectorAll<HTMLButtonElement>('[data-sort-column]');\n\n    sortButtons.forEach((button) => {\n      button.addEventListener('click', async (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const field = button.dataset.sortColumn;\n        if (!field) return;\n\n        console.log(`[DataGrid] Sort button clicked for field: ${field}`);\n\n        // Triple-click cycle: none -> asc -> desc -> none -> asc -> ...\n        const existing = grid.state.sort.find(s => s.field === field);\n        let direction: 'asc' | 'desc' | null = null;\n\n        if (existing) {\n          if (existing.direction === 'asc') {\n            // asc -> desc\n            direction = 'desc';\n            existing.direction = direction;\n          } else {\n            // desc -> none (clear sort)\n            grid.state.sort = grid.state.sort.filter(s => s.field !== field);\n            direction = null;\n            console.log(`[DataGrid] Sort cleared for field: ${field}`);\n          }\n        } else {\n          // none -> asc\n          direction = 'asc';\n          grid.state.sort = [{ field, direction }];\n        }\n\n        console.log(`[DataGrid] New sort state:`, grid.state.sort);\n\n        grid.pushStateToURL();\n\n        if (direction !== null && grid.config.behaviors?.sort) {\n          console.log('[DataGrid] Calling custom sort behavior');\n          await grid.config.behaviors.sort.onSort(field, direction, grid);\n        } else {\n          console.log('[DataGrid] Calling refresh() for sort');\n          await grid.refresh();\n        }\n\n        // Update UI\n        console.log('[DataGrid] Updating sort indicators');\n        grid.updateSortIndicators();\n      });\n    });\n\n    // Also bind legacy sortable headers ([data-sort])\n    const sortableHeaders = grid.tableEl.querySelectorAll<HTMLElement>('[data-sort]');\n\n    sortableHeaders.forEach((header) => {\n      header.addEventListener('click', async () => {\n        const field = header.dataset.sort;\n        if (!field) return;\n\n        // Triple-click cycle: none -> asc -> desc -> none -> asc -> ...\n        const existing = grid.state.sort.find(s => s.field === field);\n        let direction: 'asc' | 'desc' | null = null;\n\n        if (existing) {\n          if (existing.direction === 'asc') {\n            // asc -> desc\n            direction = 'desc';\n            existing.direction = direction;\n          } else {\n            // desc -> none (clear sort)\n            grid.state.sort = grid.state.sort.filter(s => s.field !== field);\n            direction = null;\n          }\n        } else {\n          // none -> asc\n          direction = 'asc';\n          grid.state.sort = [{ field, direction }];\n        }\n\n        grid.pushStateToURL();\n\n        if (direction !== null && grid.config.behaviors?.sort) {\n          await grid.config.behaviors.sort.onSort(field, direction, grid);\n        } else {\n          await grid.refresh();\n        }\n\n        // Update UI\n        grid.updateSortIndicators();\n      });\n    });\n  }\n\n  /**\n   * Update sort indicators in table headers\n   */\nexport function updateSortIndicators(grid: any): void {\n    if (!grid.tableEl) return;\n\n    // Handle both old [data-sort] and new [data-sort-column] buttons\n    const sortButtons = grid.tableEl.querySelectorAll<HTMLButtonElement>('[data-sort-column]');\n\n    sortButtons.forEach((button) => {\n      const field = button.dataset.sortColumn;\n      if (!field) return;\n\n      const sorted = grid.state.sort.find(s => s.field === field);\n      const svg = button.querySelector('svg');\n\n      if (svg) {\n        // Update button visibility and styling based on sort state\n        if (sorted) {\n          button.classList.remove('opacity-0');\n          button.classList.add('opacity-100');\n\n          // Update icon based on direction\n          if (sorted.direction === 'asc') {\n            // Show ascending arrow (up arrow only)\n            svg.innerHTML = '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 15l7-7 7 7\" />';\n            svg.classList.add('text-blue-600');\n            svg.classList.remove('text-gray-400');\n          } else {\n            // Show descending arrow (down arrow only)\n            svg.innerHTML = '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />';\n            svg.classList.add('text-blue-600');\n            svg.classList.remove('text-gray-400');\n          }\n        } else {\n          // Reset to default double arrow\n          svg.innerHTML = '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 9l4-4 4 4m0 6l-4 4-4-4\" />';\n          svg.classList.remove('text-blue-600');\n          svg.classList.add('text-gray-400');\n        }\n      }\n    });\n\n    // Also handle legacy [data-sort] headers with .sort-indicator\n    const headers = grid.tableEl.querySelectorAll<HTMLElement>('[data-sort]');\n    headers.forEach((header) => {\n      const field = header.dataset.sort;\n      const sorted = grid.state.sort.find(s => s.field === field);\n\n      const indicator = header.querySelector('.sort-indicator');\n      if (indicator) {\n        indicator.textContent = sorted ? (sorted.direction === 'asc' ? '↑' : '↓') : '';\n      }\n    });\n  }\n\n  /**\n   * Bind selection checkboxes\n   */\nexport function bindSelection(grid: any): void {\n    const selectAll = document.querySelector<HTMLInputElement>(grid.selectors.selectAllCheckbox);\n\n    if (selectAll) {\n      selectAll.addEventListener('change', () => {\n        const checkboxes = document.querySelectorAll<HTMLInputElement>(grid.selectors.rowCheckboxes);\n        checkboxes.forEach((cb) => {\n          cb.checked = selectAll.checked;\n          const id = cb.dataset.id;\n          if (id) {\n            if (selectAll.checked) {\n              grid.state.selectedRows.add(id);\n            } else {\n              grid.state.selectedRows.delete(id);\n            }\n          }\n        });\n        grid.updateBulkActionsBar();\n      });\n    }\n\n    grid.updateSelectionBindings();\n  }\n\n  /**\n   * Update selection bindings after rendering\n   * This syncs checkbox states with the selectedRows Set\n   */\nexport function updateSelectionBindings(grid: any): void {\n    const checkboxes = document.querySelectorAll<HTMLInputElement>(grid.selectors.rowCheckboxes);\n\n    checkboxes.forEach((cb) => {\n      const id = cb.dataset.id;\n\n      // Sync checkbox state with selectedRows Set\n      if (id) {\n        cb.checked = grid.state.selectedRows.has(id);\n      }\n\n      // Remove old listeners to avoid duplicates (use once: true or track bound status in production)\n      cb.addEventListener('change', () => {\n        if (id) {\n          if (cb.checked) {\n            grid.state.selectedRows.add(id);\n          } else {\n            grid.state.selectedRows.delete(id);\n          }\n        }\n        grid.updateBulkActionsBar();\n      });\n    });\n  }\n\n  /**\n   * Bind bulk action buttons\n   */\nexport function bindBulkActions(grid: any): void {\n    const overlay = document.getElementById('bulk-actions-overlay');\n    const bulkBase = overlay?.dataset?.bulkBase || '';\n    const bulkActionButtons = document.querySelectorAll('[data-bulk-action]');\n\n    bulkActionButtons.forEach((btn) => {\n      btn.addEventListener('click', async () => {\n        const el = btn as HTMLElement;\n        const actionId = el.dataset.bulkAction;\n        if (!actionId) return;\n\n        const ids = Array.from(grid.state.selectedRows);\n        if (ids.length === 0) {\n          grid.notify('Please select items first', 'warning');\n          return;\n        }\n\n        // 1. Try config.bulkActions first (inline JS config)\n        if (grid.config.bulkActions) {\n          const bulkActionConfig = grid.config.bulkActions.find(ba => ba.id === actionId);\n          if (bulkActionConfig) {\n            try {\n              await grid.actionRenderer.executeBulkAction(bulkActionConfig, ids);\n              grid.state.selectedRows.clear();\n              grid.updateBulkActionsBar();\n              await grid.refresh();\n            } catch (error) {\n              console.error('Bulk action failed:', error);\n              grid.showError('Bulk action failed');\n            }\n            return;\n          }\n        }\n\n        // 2. Try DOM data-driven config (from server-rendered data-bulk-* attributes)\n        if (bulkBase) {\n          const endpoint = `${bulkBase}/${actionId}`;\n          const confirmMsg = el.dataset.bulkConfirm;\n          const payloadRequired = grid.parseDatasetStringArray(el.dataset.bulkPayloadRequired);\n          const payloadSchema = grid.parseDatasetObject(el.dataset.bulkPayloadSchema);\n          const domConfig = {\n            id: actionId,\n            label: el.textContent?.trim() || actionId,\n            endpoint: endpoint,\n            confirm: confirmMsg,\n            payloadRequired: payloadRequired,\n            payloadSchema: payloadSchema,\n          };\n          try {\n            await grid.actionRenderer.executeBulkAction(domConfig, ids);\n            grid.state.selectedRows.clear();\n            grid.updateBulkActionsBar();\n            await grid.refresh();\n          } catch (error) {\n            console.error('Bulk action failed:', error);\n            grid.showError('Bulk action failed');\n          }\n          return;\n        }\n\n        // 3. Fall back to behaviors.bulkActions (old system)\n        if (grid.config.behaviors?.bulkActions) {\n          try {\n            await grid.config.behaviors.bulkActions.execute(actionId, ids, grid);\n            grid.state.selectedRows.clear();\n            grid.updateBulkActionsBar();\n          } catch (error) {\n            console.error('Bulk action failed:', error);\n            grid.showError('Bulk action failed');\n          }\n        }\n      });\n    });\n\n    // Bind clear selection button\n    const clearBtn = document.getElementById('clear-selection-btn');\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => {\n        grid.state.selectedRows.clear();\n        grid.updateBulkActionsBar();\n        // Uncheck all checkboxes\n        const checkboxes = document.querySelectorAll<HTMLInputElement>('.table-checkbox');\n        checkboxes.forEach(cb => cb.checked = false);\n        const selectAll = document.querySelector<HTMLInputElement>(grid.selectors.selectAllCheckbox);\n        if (selectAll) selectAll.checked = false;\n      });\n    }\n\n    // Bind overflow menu toggle\n    grid.bindOverflowMenu();\n  }\n\n  /**\n   * Bind overflow menu toggle (three-dot \"More\" button)\n   */\nexport function bindOverflowMenu(grid: any): void {\n    const moreBtn = document.getElementById('bulk-more-btn');\n    const menu = document.getElementById('bulk-overflow-menu');\n    if (!moreBtn || !menu) return;\n\n    moreBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      menu.classList.toggle('hidden');\n    });\n\n    // Close on outside click\n    document.addEventListener('click', () => {\n      menu.classList.add('hidden');\n    });\n\n    // Close on Escape\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        menu.classList.add('hidden');\n      }\n    });\n\n    // Prevent menu clicks from closing the menu\n    menu.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n  }\n\n  /**\n   * Update bulk actions bar visibility with animation\n   */\nexport function updateBulkActionsBar(grid: any): void {\n    const overlay = document.getElementById('bulk-actions-overlay');\n    const countEl = document.getElementById('selected-count');\n    const selectedCount = grid.state.selectedRows.size;\n\n    console.log('[DataGrid] updateBulkActionsBar - overlay:', overlay, 'countEl:', countEl, 'count:', selectedCount);\n\n    if (!overlay || !countEl) {\n      console.error('[DataGrid] Missing bulk actions elements!');\n      return;\n    }\n\n    // Update count\n    countEl.textContent = String(selectedCount);\n\n    // Show/hide with animation\n    if (selectedCount > 0) {\n      overlay.classList.remove('hidden');\n      // Trigger reflow for animation\n      void overlay.offsetHeight;\n    } else {\n      overlay.classList.add('hidden');\n    }\n  }\n\n  /**\n   * Bind clear selection button\n   */\nexport function bindBulkClearButton(grid: any): void {\n    const clearBtn = document.getElementById('bulk-clear-selection');\n    console.log('[DataGrid] Binding clear button:', clearBtn);\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => {\n        console.log('[DataGrid] Clear button clicked!');\n        grid.clearSelection();\n      });\n    } else {\n      console.error('[DataGrid] Clear button not found!');\n    }\n  }\n\n  /**\n   * Clear all selections\n   */\nexport function clearSelection(grid: any): void {\n    console.log('[DataGrid] Clearing selection...');\n    grid.state.selectedRows.clear();\n\n    // Uncheck the \"select all\" checkbox in the table header\n    const selectAllCheckbox = document.querySelector<HTMLInputElement>(grid.selectors.selectAllCheckbox);\n    if (selectAllCheckbox) {\n      selectAllCheckbox.checked = false;\n    }\n\n    grid.updateBulkActionsBar();\n    grid.updateSelectionBindings();\n  }\n\n  /**\n   * Position dropdown menu intelligently based on available space\n   */\nexport function positionDropdownMenu(grid: any, trigger: HTMLElement, menu: HTMLElement): void {\n    const triggerRect = trigger.getBoundingClientRect();\n    const menuHeight = menu.offsetHeight || 300; // Estimate if not rendered\n    const viewportHeight = window.innerHeight;\n    const spaceBelow = viewportHeight - triggerRect.bottom;\n    const spaceAbove = triggerRect.top;\n\n    // Determine if menu should open upward or downward\n    const shouldOpenUpward = spaceBelow < menuHeight && spaceAbove > spaceBelow;\n\n    // Position horizontally (align right edge of menu with trigger)\n    const left = triggerRect.right - (menu.offsetWidth || 224); // 224px = 14rem default width\n    menu.style.left = `${Math.max(10, left)}px`; // At least 10px from left edge\n\n    // Position vertically\n    if (shouldOpenUpward) {\n      // Open upward\n      menu.style.top = `${triggerRect.top - menuHeight - 8}px`;\n      menu.style.bottom = 'auto';\n    } else {\n      // Open downward (default)\n      menu.style.top = `${triggerRect.bottom + 8}px`;\n      menu.style.bottom = 'auto';\n    }\n  }\n\n  /**\n   * Bind dropdown toggles\n   */\nexport function bindDropdownToggles(grid: any): void {\n    // Ensure we don't stack global listeners across in-page navigations.\n    if (grid.dropdownAbortController) {\n      grid.dropdownAbortController.abort();\n    }\n    grid.dropdownAbortController = new AbortController();\n    const { signal } = grid.dropdownAbortController;\n\n    // Existing dropdown toggles (column visibility, export, etc.)\n    // Defensive: ensure all dropdown menus start hidden\n    document.querySelectorAll('[data-dropdown-toggle]').forEach((toggle) => {\n      const targetId = (toggle as HTMLElement).dataset.dropdownToggle;\n      const target = document.getElementById(targetId || '');\n      if (target && !target.classList.contains('hidden')) {\n        target.classList.add('hidden');\n      }\n    });\n\n    addDelegatedEventListener(document, 'click', '[data-dropdown-toggle]', (event, toggle) => {\n      event.stopPropagation();\n      const targetId = toggle.dataset.dropdownToggle;\n      const target = document.getElementById(targetId || '');\n\n      if (target) {\n        document.querySelectorAll('[data-dropdown-toggle]').forEach((otherToggle) => {\n          const otherId = (otherToggle as HTMLElement).dataset.dropdownToggle;\n          const otherTarget = document.getElementById(otherId || '');\n          if (otherTarget && otherTarget !== target) {\n            otherTarget.classList.add('hidden');\n          }\n        });\n\n        target.classList.toggle('hidden');\n      }\n    }, { signal });\n\n    // Action dropdown menus (row actions)\n    document.addEventListener('click', (e) => {\n      const trigger = (e.target as HTMLElement).closest('[data-dropdown-trigger]');\n\n      if (trigger) {\n        e.stopPropagation();\n        const dropdown = trigger.closest('[data-dropdown]');\n        const menu = dropdown?.querySelector('.actions-menu') as HTMLElement;\n\n        // Close other action dropdowns\n        document.querySelectorAll('.actions-menu').forEach(m => {\n          if (m !== menu) m.classList.add('hidden');\n        });\n\n        // Toggle this dropdown\n        const isOpening = menu?.classList.contains('hidden');\n        menu?.classList.toggle('hidden');\n        trigger.setAttribute('aria-expanded', isOpening ? 'true' : 'false');\n\n        // Position the dropdown intelligently (only when opening)\n        if (isOpening && menu) {\n          grid.positionDropdownMenu(trigger as HTMLElement, menu);\n        }\n      } else {\n        // Check if the click is inside an open dropdown menu (e.g., column toggle menu)\n        const clickedInsideDropdownMenu = (e.target as HTMLElement).closest('[data-dropdown-toggle], #column-toggle-menu, #export-menu');\n\n        if (!clickedInsideDropdownMenu) {\n          // Close all action dropdowns when clicking outside\n          document.querySelectorAll('.actions-menu').forEach(m =>\n            m.classList.add('hidden')\n          );\n\n          // Also close existing dropdowns\n          document.querySelectorAll('[data-dropdown-toggle]').forEach((toggle) => {\n            const targetId = (toggle as HTMLElement).dataset.dropdownToggle;\n            const target = document.getElementById(targetId || '');\n            if (target) {\n              target.classList.add('hidden');\n            }\n          });\n        }\n      }\n    }, { signal });\n\n    // ESC key closes all dropdowns\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        // Close action dropdowns\n        document.querySelectorAll('.actions-menu').forEach(m => {\n          m.classList.add('hidden');\n          const trigger = m.closest('[data-dropdown]')?.querySelector('[data-dropdown-trigger]');\n          if (trigger) trigger.setAttribute('aria-expanded', 'false');\n        });\n\n        // Close toggle dropdowns (column visibility, export, etc.)\n        document.querySelectorAll('[data-dropdown-toggle]').forEach((toggle) => {\n          const targetId = (toggle as HTMLElement).dataset.dropdownToggle;\n          const target = document.getElementById(targetId || '');\n          if (target) {\n            target.classList.add('hidden');\n          }\n        });\n      }\n    }, { signal });\n  }\n\n  /**\n   * Show error message using notifier\n   */\nexport function showError(grid: any, message: string): void {\n    console.error(message);\n    grid.notifier.error(message);\n  }\n\n  /**\n   * Show notification using notifier\n   */\nexport function notify(grid: any, message: string, type: 'success' | 'error' | 'warning' | 'info'): void {\n    grid.notifier.show({ message, type });\n  }\n\n  /**\n   * Show confirmation dialog using notifier\n   */\nexport async function confirmAction(grid: any, message: string): Promise<boolean> {\n    return grid.notifier.confirm(message);\n  }\n\n  /**\n   * Extract error message from Response or Error\n   */\nexport async function extractError(grid: any, error: unknown): Promise<string> {\n    if (error instanceof Response) {\n      return extractErrorMessage(error);\n    }\n    if (error instanceof Error) {\n      return error.message;\n    }\n    return 'An unexpected error occurred';\n  }\n\nexport function parseDatasetStringArray(grid: any, raw: string | undefined): string[] | undefined {\n    if (!raw) {\n      return undefined;\n    }\n    try {\n      const parsed = JSON.parse(raw) as unknown;\n      if (!Array.isArray(parsed)) {\n        return undefined;\n      }\n      const result = parsed\n        .map((item) => (typeof item === 'string' ? item.trim() : ''))\n        .filter((item) => item.length > 0);\n      return result.length > 0 ? result : undefined;\n    } catch (error) {\n      console.warn('[DataGrid] Failed to parse bulk payload_required:', error);\n      return undefined;\n    }\n  }\n\nexport function parseDatasetObject(grid: any, raw: string | undefined): Record<string, unknown> | undefined {\n    if (!raw) {\n      return undefined;\n    }\n    try {\n      const parsed = JSON.parse(raw) as unknown;\n      if (!parsed || typeof parsed !== 'object' || Array.isArray(parsed)) {\n        return undefined;\n      }\n      return parsed as Record<string, unknown>;\n    } catch (error) {\n      console.warn('[DataGrid] Failed to parse bulk payload_schema:', error);\n      return undefined;\n    }\n  }\n","// @ts-nocheck\nimport type { ColumnDefinition } from './core-types.js';\n\nexport function reorderColumns(grid: any, newOrder: string[]): void {\n    if (!grid.tableEl) return;\n\n    // Validate and merge order with current columns\n    // - Keep only columns that exist in config.columns\n    // - Append any new columns not in newOrder\n    const validOrder = grid.mergeColumnOrder(newOrder);\n\n    // Update state\n    grid.state.columnOrder = validOrder;\n\n    // Reorder config.columns to match the new order\n    const columnMap = new Map(grid.config.columns.map(c => [c.field, c]));\n    grid.config.columns = validOrder\n      .map(field => columnMap.get(field))\n      .filter((c): c is ColumnDefinition => c !== undefined);\n\n    // Reorder DOM elements\n    grid.reorderTableColumns(validOrder);\n    grid.persistStateSnapshot();\n\n    console.log('[DataGrid] Columns reordered:', validOrder);\n  }\n\n  /**\n   * Reset columns to their initial/default order and visibility.\n   * Intended to be called by ColumnManager's \"Reset to Default\" action.\n   */\nexport function resetColumnsToDefault(grid: any): void {\n    // Clear persisted preferences first (localStorage + optional server sync)\n    // so \"Reset to Default\" truly removes saved state instead of re-saving defaults.\n    grid.config.behaviors?.columnVisibility?.clearSavedPrefs?.();\n\n    // Restore default config columns (shallow copies)\n    grid.config.columns = grid.defaultColumns.map(col => ({ ...col }));\n    grid.state.columnOrder = grid.config.columns.map(col => col.field);\n\n    // Default visibility: visible unless column.hidden is true\n    const visibleColumns = grid.config.columns\n      .filter(col => !col.hidden)\n      .map(col => col.field);\n\n    // Apply DOM updates if table is initialized\n    if (grid.tableEl) {\n      grid.reorderTableColumns(grid.state.columnOrder);\n      grid.updateColumnVisibility(visibleColumns);\n    } else {\n      grid.state.hiddenColumns = new Set(\n        grid.config.columns.filter(col => col.hidden).map(col => col.field)\n      );\n      grid.persistStateSnapshot();\n    }\n\n    // Re-render the column menu to reflect defaults (Sortable is re-initialized in refresh()).\n    if (grid.columnManager) {\n      grid.columnManager.refresh();\n      grid.columnManager.syncWithGridState();\n    }\n\n    console.log('[DataGrid] Columns reset to default');\n  }\n\n  /**\n   * Merge and validate saved column order with current columns\n   * - Drops columns that no longer exist\n   * - Appends new columns that aren't in saved order\n   */\nexport function mergeColumnOrder(grid: any, savedOrder: string[]): string[] {\n    const currentFields = new Set(grid.config.columns.map(c => c.field));\n    const savedSet = new Set(savedOrder);\n\n    // Keep only saved columns that still exist\n    const validSaved = savedOrder.filter(field => currentFields.has(field));\n\n    // Find new columns not in saved order (append at end)\n    const newColumns = grid.config.columns\n      .map(c => c.field)\n      .filter(field => !savedSet.has(field));\n\n    return [...validSaved, ...newColumns];\n  }\n\n  /**\n   * Reorder table DOM elements (header, filter row, body rows)\n   * Moves existing nodes rather than recreating them to preserve event listeners\n   */\nexport function reorderTableColumns(grid: any, order: string[]): void {\n    if (!grid.tableEl) return;\n\n    // Reorder header row\n    const headerRow = grid.tableEl.querySelector('thead tr:first-child');\n    if (headerRow) {\n      grid.reorderRowCells(headerRow, order, 'th');\n    }\n\n    // Reorder filter row\n    const filterRow = grid.tableEl.querySelector('#filter-row');\n    if (filterRow) {\n      grid.reorderRowCells(filterRow, order, 'th');\n    }\n\n    // Reorder body rows\n    const bodyRows = grid.tableEl.querySelectorAll('tbody tr');\n    bodyRows.forEach(row => {\n      grid.reorderRowCells(row, order, 'td');\n    });\n  }\n\n  /**\n   * Reorder cells within a single row\n   * Preserves fixed columns (selection on left, actions on right)\n   */\nexport function reorderRowCells(grid: any, row: Element, order: string[], cellTag: 'th' | 'td'): void {\n    // Get data cells (those with data-column attribute)\n    const dataCells = Array.from(row.querySelectorAll(`${cellTag}[data-column]`));\n    const cellMap = new Map(\n      dataCells.map(cell => [(cell as HTMLElement).dataset.column!, cell])\n    );\n\n    // Get fixed cells (selection/actions)\n    // Prefer explicit markers; fall back to heuristics for legacy tables.\n    const allCells = Array.from(row.querySelectorAll(cellTag));\n    const selectionCell =\n      row.querySelector(`${cellTag}[data-role=\"selection\"]`) ||\n      allCells.find(cell => cell.querySelector('input[type=\"checkbox\"]'));\n    const actionsCell =\n      row.querySelector(`${cellTag}[data-role=\"actions\"]`) ||\n      allCells.find(cell =>\n        !((cell as HTMLElement).dataset.column) && (\n          cell.querySelector('[data-action]') ||\n          cell.querySelector('[data-action-id]') ||\n          cell.querySelector('.dropdown')\n        )\n      );\n\n    // Build reordered cells array\n    const reorderedCells: Element[] = [];\n\n    // Add selection cell first (if exists)\n    if (selectionCell) {\n      reorderedCells.push(selectionCell);\n    }\n\n    // Add data cells in new order\n    order.forEach(field => {\n      const cell = cellMap.get(field);\n      if (cell) {\n        reorderedCells.push(cell);\n      }\n    });\n\n    // Add actions cell last (if exists)\n    if (actionsCell) {\n      reorderedCells.push(actionsCell);\n    }\n\n    // Move cells to new positions (appending moves, doesn't clone)\n    reorderedCells.forEach(cell => {\n      row.appendChild(cell);\n    });\n  }\n","import type {\n  DataGridConfig,\n  DataGridURLStateConfig,\n  DataGridSelectors,\n  DataGridState,\n  ApiResponse,\n  DetailResponse,\n  ColumnDefinition,\n  DataGridStateStore,\n} from './core-types.js';\nimport { ActionRenderer } from './actions.js';\nimport { CellRendererRegistry } from './renderers.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\nimport { createDataGridStateStore } from './state-store.js';\nimport {\n  getPersistedExpandMode,\n  getPersistedExpandState,\n  getPersistedViewMode,\n  hasPersistedExpandState,\n  normalizeExpandMode,\n} from './grouped-mode.js';\nimport {\n  DATAGRID_DEFAULT_MAX_FILTERS_LENGTH,\n  DATAGRID_DEFAULT_MAX_URL_LENGTH,\n  DATAGRID_MANAGED_URL_KEYS,\n  DATAGRID_URL_KEY_EXPANDED_GROUPS,\n  DATAGRID_URL_KEY_FILTERS,\n  DATAGRID_URL_KEY_HIDDEN_COLUMNS,\n  DATAGRID_URL_KEY_PAGE,\n  DATAGRID_URL_KEY_PER_PAGE,\n  DATAGRID_URL_KEY_SEARCH,\n  DATAGRID_URL_KEY_SORT,\n  DATAGRID_URL_KEY_STATE,\n  DATAGRID_URL_KEY_VIEW_MODE,\n} from './core-constants.js';\nimport * as stateOps from './core-state.js';\nimport * as fetchOps from './core-fetch-query.js';\nimport * as groupedOps from './core-grouped.js';\nimport * as renderOps from './core-rendering.js';\nimport * as lifecycleOps from './core-lifecycle.js';\nimport * as columnOps from './core-columns.js';\n\nexport type { DataGridConfig } from './core-types.js';\n\nexport class DataGrid {\n  private static readonly URL_KEY_SEARCH = DATAGRID_URL_KEY_SEARCH;\n  private static readonly URL_KEY_PAGE = DATAGRID_URL_KEY_PAGE;\n  private static readonly URL_KEY_PER_PAGE = DATAGRID_URL_KEY_PER_PAGE;\n  private static readonly URL_KEY_FILTERS = DATAGRID_URL_KEY_FILTERS;\n  private static readonly URL_KEY_SORT = DATAGRID_URL_KEY_SORT;\n  private static readonly URL_KEY_STATE = DATAGRID_URL_KEY_STATE;\n  private static readonly URL_KEY_HIDDEN_COLUMNS = DATAGRID_URL_KEY_HIDDEN_COLUMNS;\n  private static readonly URL_KEY_VIEW_MODE = DATAGRID_URL_KEY_VIEW_MODE;\n  private static readonly URL_KEY_EXPANDED_GROUPS = DATAGRID_URL_KEY_EXPANDED_GROUPS;\n  private static readonly MANAGED_URL_KEYS = DATAGRID_MANAGED_URL_KEYS;\n  private static readonly DEFAULT_MAX_URL_LENGTH = DATAGRID_DEFAULT_MAX_URL_LENGTH;\n  private static readonly DEFAULT_MAX_FILTERS_LENGTH = DATAGRID_DEFAULT_MAX_FILTERS_LENGTH;\n\n  public config: DataGridConfig;\n  public state: DataGridState;\n  private selectors: DataGridSelectors;\n  private tableEl: HTMLTableElement | null = null;\n  private searchTimeout: number | null = null;\n  private abortController: AbortController | null = null;\n  private dropdownAbortController: AbortController | null = null;\n  private didRestoreColumnOrder: boolean = false;\n  private shouldReorderDOMOnRestore: boolean = false;\n  private actionRenderer: ActionRenderer;\n  private cellRendererRegistry: CellRendererRegistry;\n  private recordsById: Record<string, any> = {};\n  private notifier: any;\n  private columnManager: any = null;\n  private defaultColumns: ColumnDefinition[];\n  private lastSchema: Record<string, any> | null = null;\n  private lastForm: Record<string, any> | null = null;\n  private stateStore: DataGridStateStore;\n  private hasURLStateOverrides: boolean = false;\n  private hasPersistedHiddenColumnState: boolean = false;\n  private hasPersistedColumnOrderState: boolean = false;\n\n  constructor(config: DataGridConfig) {\n    this.config = {\n      perPage: 10,\n      searchDelay: 300,\n      behaviors: {},\n      ...config,\n    };\n\n    this.notifier = config.notifier || new FallbackNotifier();\n\n    this.selectors = {\n      table: `#${config.tableId}`,\n      searchInput: '#table-search',\n      perPageSelect: '#table-per-page',\n      filterRow: '[data-filter-column]',\n      columnToggleBtn: '#column-toggle-btn',\n      columnToggleMenu: '#column-toggle-menu',\n      exportBtn: '#export-btn',\n      exportMenu: '#export-menu',\n      paginationContainer: '#table-pagination',\n      tableInfoStart: '#table-info-start',\n      tableInfoEnd: '#table-info-end',\n      tableInfoTotal: '#table-info-total',\n      selectAllCheckbox: '#table-checkbox-all',\n      rowCheckboxes: '.table-checkbox',\n      bulkActionsBar: '#bulk-actions-bar',\n      selectedCount: '#selected-count',\n      ...config.selectors,\n    };\n\n    const panelId = this.config.panelId || this.config.tableId;\n    this.stateStore = this.config.stateStore || createDataGridStateStore({\n      key: panelId,\n      ...(this.config.stateStoreConfig || {}),\n    });\n\n    const persistedState = this.stateStore.loadPersistedState();\n    const validFields = new Set(this.config.columns.map((col) => col.field));\n    const defaultHiddenColumns = new Set(\n      this.config.columns.filter((col) => col.hidden).map((col) => col.field),\n    );\n    const hasPersistedHiddenColumns = !!persistedState && Array.isArray(persistedState.hiddenColumns);\n    this.hasPersistedHiddenColumnState = hasPersistedHiddenColumns;\n    const persistedHiddenColumns = new Set(\n      (persistedState?.hiddenColumns || []).filter((field) => validFields.has(field)),\n    );\n    const defaultColumnOrder = this.config.columns.map((col) => col.field);\n    const hasPersistedColumnOrder = !!persistedState && Array.isArray(persistedState.columnOrder) && persistedState.columnOrder.length > 0;\n    this.hasPersistedColumnOrderState = hasPersistedColumnOrder;\n    const persistedColumnOrder = (persistedState?.columnOrder || []).filter((field) => validFields.has(field));\n    const mergedColumnOrder = hasPersistedColumnOrder\n      ? [...persistedColumnOrder, ...defaultColumnOrder.filter((field) => !persistedColumnOrder.includes(field))]\n      : defaultColumnOrder;\n\n    const legacyHasPersistedExpandState = this.config.enableGroupedMode\n      ? hasPersistedExpandState(panelId)\n      : false;\n    const legacyViewMode = this.config.enableGroupedMode\n      ? getPersistedViewMode(panelId)\n      : null;\n    const legacyExpandMode = this.config.enableGroupedMode\n      ? getPersistedExpandMode(panelId)\n      : 'explicit';\n    const legacyExpandedGroups = this.config.enableGroupedMode\n      ? getPersistedExpandState(panelId)\n      : new Set<string>();\n\n    const persistedExpandMode = normalizeExpandMode(\n      persistedState?.expandMode,\n      legacyExpandMode,\n    );\n    const persistedExpandState = new Set(\n      (persistedState?.expandedGroups || Array.from(legacyExpandedGroups))\n        .map((groupId) => String(groupId).trim())\n        .filter(Boolean),\n    );\n    const hasPersistedGroupedExpandState = this.config.enableGroupedMode\n      ? persistedState?.expandMode !== undefined || persistedExpandState.size > 0 || legacyHasPersistedExpandState\n      : false;\n    const persistedViewMode = this.config.enableGroupedMode\n      ? (persistedState?.viewMode || legacyViewMode)\n      : null;\n    const initialViewMode = persistedViewMode || this.config.defaultViewMode || 'flat';\n\n    this.state = {\n      currentPage: 1,\n      perPage: this.config.perPage || 10,\n      totalRows: 0,\n      search: '',\n      filters: [],\n      sort: [],\n      selectedRows: new Set(),\n      hiddenColumns: hasPersistedHiddenColumns ? persistedHiddenColumns : defaultHiddenColumns,\n      columnOrder: mergedColumnOrder,\n      viewMode: initialViewMode,\n      expandMode: persistedExpandMode,\n      groupedData: null,\n      expandedGroups: persistedExpandState,\n      hasPersistedExpandState: hasPersistedGroupedExpandState,\n    };\n\n    this.actionRenderer = new ActionRenderer({\n      mode: this.config.actionRenderMode || 'dropdown',\n      actionBasePath: this.config.actionBasePath || this.config.apiEndpoint,\n      notifier: this.notifier,\n    });\n    this.cellRendererRegistry = new CellRendererRegistry();\n\n    if (this.config.cellRenderers) {\n      Object.entries(this.config.cellRenderers).forEach(([field, renderer]) => {\n        this.cellRendererRegistry.register(field, renderer);\n      });\n    }\n\n    this.defaultColumns = this.config.columns.map((col) => ({ ...col }));\n  }\n\n  init(): void {\n    console.log('[DataGrid] Initializing with config:', this.config);\n    this.tableEl = document.querySelector(this.selectors.table);\n    if (!this.tableEl) {\n      console.error(`[DataGrid] Table element not found: ${this.selectors.table}`);\n      return;\n    }\n    console.log('[DataGrid] Table element found:', this.tableEl);\n\n    this.restoreStateFromURL();\n\n    this.bindSearchInput();\n    this.bindPerPageSelect();\n    this.bindFilterInputs();\n    this.bindColumnVisibility();\n    this.bindExportButtons();\n    this.bindSorting();\n    this.bindSelection();\n    this.bindBulkActions();\n    this.bindBulkClearButton();\n    this.bindDropdownToggles();\n\n    void this.refresh();\n\n    if (typeof this.stateStore.hydrate === 'function') {\n      void this.stateStore.hydrate().then(() => {\n        if (this.hasURLStateOverrides) {\n          return;\n        }\n        const hydrated = this.stateStore.loadPersistedState();\n        if (!hydrated) {\n          return;\n        }\n        this.applyPersistedStateSnapshot(hydrated, { merge: true });\n        this.applyRestoredState();\n        this.pushStateToURL({ replace: true });\n        void this.refresh();\n      }).catch(() => {\n        // Ignore async hydrate failures.\n      });\n    }\n  }\n\n  private getURLStateConfig(): Required<DataGridURLStateConfig> {\n    return stateOps.getURLStateConfig(this);\n  }\n\n  private parseJSONArray(raw: string, label: string): unknown[] | null {\n    return stateOps.parseJSONArray(this, raw, label);\n  }\n\n  private applyPersistedStateSnapshot(snapshot: any, options: { merge?: boolean } = {}): void {\n    stateOps.applyPersistedStateSnapshot(this, snapshot, options);\n  }\n\n  private applyShareStateSnapshot(snapshot: any): void {\n    stateOps.applyShareStateSnapshot(this, snapshot);\n  }\n\n  private buildPersistedStateSnapshot(): any {\n    return stateOps.buildPersistedStateSnapshot(this);\n  }\n\n  private buildShareStateSnapshot(): any {\n    return stateOps.buildShareStateSnapshot(this);\n  }\n\n  private persistStateSnapshot(): void {\n    stateOps.persistStateSnapshot(this);\n  }\n\n  private restoreStateFromURL(): void {\n    stateOps.restoreStateFromURL(this);\n  }\n\n  private applyRestoredState(): void {\n    stateOps.applyRestoredState(this);\n  }\n\n  private pushStateToURL(options: { replace?: boolean } = {}): void {\n    stateOps.pushStateToURL(this, options);\n  }\n\n  syncURL(): void {\n    this.pushStateToURL();\n  }\n\n  async refresh(): Promise<void> {\n    return fetchOps.refresh(this);\n  }\n\n  buildApiUrl(): string {\n    return fetchOps.buildApiUrl(this);\n  }\n\n  buildQueryString(): string {\n    return fetchOps.buildQueryString(this);\n  }\n\n  private buildQueryParams(): Record<string, any> {\n    return fetchOps.buildQueryParams(this);\n  }\n\n  private getResponseTotal(data: ApiResponse): number | null {\n    return fetchOps.getResponseTotal(this, data);\n  }\n\n  private normalizePagination(total: number | null): boolean {\n    return fetchOps.normalizePagination(this, total);\n  }\n\n  resetPagination(): void {\n    this.state.currentPage = 1;\n  }\n\n  updateColumnVisibility(visibleColumns: string[], skipURLUpdate: boolean = false): void {\n    renderOps.updateColumnVisibility(this, visibleColumns, skipURLUpdate);\n  }\n\n  private syncColumnVisibilityCheckboxes(): void {\n    renderOps.syncColumnVisibilityCheckboxes(this);\n  }\n\n  private renderData(data: ApiResponse): void {\n    renderOps.renderData(this, data);\n  }\n\n  private renderFlatData(items: any[], tbody: HTMLElement): void {\n    renderOps.renderFlatData(this, items, tbody);\n  }\n\n  private renderGroupedData(data: ApiResponse, items: any[], tbody: HTMLElement): void {\n    groupedOps.renderGroupedData(this, data, items, tbody);\n  }\n\n  private isGroupedViewActive(): boolean {\n    return groupedOps.isGroupedViewActive(this);\n  }\n\n  private fallbackGroupedMode(reason: string): void {\n    groupedOps.fallbackGroupedMode(this, reason);\n  }\n\n  private handleGroupedModeStatusFallback(status: number): boolean {\n    return groupedOps.handleGroupedModeStatusFallback(this, status);\n  }\n\n  private handleGroupedModePayloadFallback(items: unknown[]): boolean {\n    return groupedOps.handleGroupedModePayloadFallback(this, items);\n  }\n\n  toggleGroup(groupId: string): void {\n    groupedOps.toggleGroup(this, groupId);\n  }\n\n  setExpandedGroups(groupIDs: string[]): void {\n    groupedOps.setExpandedGroups(this, groupIDs);\n  }\n\n  expandAllGroups(): void {\n    groupedOps.expandAllGroups(this);\n  }\n\n  collapseAllGroups(): void {\n    groupedOps.collapseAllGroups(this);\n  }\n\n  private updateGroupVisibility(groupId: string): void {\n    groupedOps.updateGroupVisibility(this, groupId);\n  }\n\n  private updateGroupedRowsFromState(): void {\n    groupedOps.updateGroupedRowsFromState(this);\n  }\n\n  private isGroupExpandedByState(groupId: string, defaultExpanded: boolean = false): boolean {\n    return groupedOps.isGroupExpandedByState(this, groupId, defaultExpanded);\n  }\n\n  setViewMode(mode: any): void {\n    groupedOps.setViewMode(this, mode);\n  }\n\n  getViewMode(): any {\n    return groupedOps.getViewMode(this);\n  }\n\n  getGroupedData(): any {\n    return groupedOps.getGroupedData(this);\n  }\n\n  async fetchDetail(id: string): Promise<{ data: any; schema?: Record<string, any>; form?: Record<string, any>; tabs?: any[] }> {\n    return fetchOps.fetchDetail(this, id);\n  }\n\n  getSchema(): Record<string, any> | null {\n    return fetchOps.getSchema(this);\n  }\n\n  getForm(): Record<string, any> | null {\n    return fetchOps.getForm(this);\n  }\n\n  getTabs(): any[] {\n    return fetchOps.getTabs(this);\n  }\n\n  private normalizeDetailResponse(payload: any): { data: any; schema?: Record<string, any>; form?: Record<string, any> } {\n    return fetchOps.normalizeDetailResponse(this, payload);\n  }\n\n  private resolveRendererOptions(col: ColumnDefinition): Record<string, any> {\n    return renderOps.resolveRendererOptions(this, col);\n  }\n\n  private createTableRow(item: any): HTMLTableRowElement {\n    return renderOps.createTableRow(this, item);\n  }\n\n  private sanitizeActionId(label: string): string {\n    return renderOps.sanitizeActionId(this, label);\n  }\n\n  private async handleDelete(id: string): Promise<void> {\n    return renderOps.handleDelete(this, id);\n  }\n\n  private updatePaginationUI(data: ApiResponse): void {\n    renderOps.updatePaginationUI(this, data);\n  }\n\n  private renderPaginationButtons(total: number): void {\n    renderOps.renderPaginationButtons(this, total);\n  }\n\n  private bindSearchInput(): void {\n    lifecycleOps.bindSearchInput(this);\n  }\n\n  private bindPerPageSelect(): void {\n    lifecycleOps.bindPerPageSelect(this);\n  }\n\n  private bindFilterInputs(): void {\n    lifecycleOps.bindFilterInputs(this);\n  }\n\n  private bindColumnVisibility(): void {\n    lifecycleOps.bindColumnVisibility(this);\n  }\n\n  private bindExportButtons(): void {\n    lifecycleOps.bindExportButtons(this);\n  }\n\n  private bindSorting(): void {\n    lifecycleOps.bindSorting(this);\n  }\n\n  private updateSortIndicators(): void {\n    lifecycleOps.updateSortIndicators(this);\n  }\n\n  private bindSelection(): void {\n    lifecycleOps.bindSelection(this);\n  }\n\n  private updateSelectionBindings(): void {\n    lifecycleOps.updateSelectionBindings(this);\n  }\n\n  private bindBulkActions(): void {\n    lifecycleOps.bindBulkActions(this);\n  }\n\n  private bindOverflowMenu(): void {\n    lifecycleOps.bindOverflowMenu(this);\n  }\n\n  private updateBulkActionsBar(): void {\n    lifecycleOps.updateBulkActionsBar(this);\n  }\n\n  private bindBulkClearButton(): void {\n    lifecycleOps.bindBulkClearButton(this);\n  }\n\n  private clearSelection(): void {\n    lifecycleOps.clearSelection(this);\n  }\n\n  private positionDropdownMenu(trigger: HTMLElement, menu: HTMLElement): void {\n    lifecycleOps.positionDropdownMenu(this, trigger, menu);\n  }\n\n  private bindDropdownToggles(): void {\n    lifecycleOps.bindDropdownToggles(this);\n  }\n\n  private showError(message: string): void {\n    lifecycleOps.showError(this, message);\n  }\n\n  private notify(message: string, type: 'success' | 'error' | 'warning' | 'info'): void {\n    lifecycleOps.notify(this, message, type);\n  }\n\n  private async confirmAction(message: string): Promise<boolean> {\n    return lifecycleOps.confirmAction(this, message);\n  }\n\n  private async extractError(error: unknown): Promise<string> {\n    return lifecycleOps.extractError(this, error);\n  }\n\n  private parseDatasetStringArray(raw: string | undefined): string[] | undefined {\n    return lifecycleOps.parseDatasetStringArray(this, raw);\n  }\n\n  private parseDatasetObject(raw: string | undefined): Record<string, unknown> | undefined {\n    return lifecycleOps.parseDatasetObject(this, raw);\n  }\n\n  reorderColumns(newOrder: string[]): void {\n    columnOps.reorderColumns(this, newOrder);\n  }\n\n  resetColumnsToDefault(): void {\n    columnOps.resetColumnsToDefault(this);\n  }\n\n  private mergeColumnOrder(savedOrder: string[]): string[] {\n    return columnOps.mergeColumnOrder(this, savedOrder);\n  }\n\n  private reorderTableColumns(order: string[]): void {\n    columnOps.reorderTableColumns(this, order);\n  }\n\n  private reorderRowCells(row: Element, order: string[], cellTag: 'th' | 'td'): void {\n    columnOps.reorderRowCells(this, row, order, cellTag);\n  }\n\n  destroy(): void {\n    if (this.columnManager) {\n      this.columnManager.destroy();\n      this.columnManager = null;\n    }\n\n    if (this.dropdownAbortController) {\n      this.dropdownAbortController.abort();\n      this.dropdownAbortController = null;\n    }\n\n    if (this.abortController) {\n      this.abortController.abort();\n      this.abortController = null;\n    }\n\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n      this.searchTimeout = null;\n    }\n\n    console.log('[DataGrid] Instance destroyed');\n  }\n}\n\nif (typeof window !== 'undefined') {\n  (window as any).DataGrid = DataGrid;\n}\n","/**\n * Advanced Search Component\n * Provides a query builder UI for complex search queries\n */\n\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\nimport { TextPromptModal } from '../shared/modal.js';\n\nexport interface SearchCriterion {\n  field: string;\n  operator: string;\n  value: string | number;\n  logic?: 'and' | 'or'; // Logic connector to next criterion\n}\n\nexport interface AdvancedSearchConfig {\n  fields: FieldDefinition[];\n  onSearch: (criteria: SearchCriterion[]) => void;\n  onClear: () => void;\n  notifier?: ToastNotifier;\n}\n\nexport interface FieldDefinition {\n  name: string;\n  label: string;\n  type: 'text' | 'number' | 'select' | 'date';\n  operators?: string[];\n  options?: { label: string; value: string }[];\n}\n\nconst DEFAULT_OPERATORS: Record<string, { label: string; value: string }[]> = {\n  text: [\n    { label: 'contains', value: 'ilike' },\n    { label: 'equals', value: 'eq' },\n    { label: 'starts with', value: 'starts' },\n    { label: 'ends with', value: 'ends' },\n    { label: 'not equals', value: 'ne' }\n  ],\n  number: [\n    { label: 'equals', value: 'eq' },\n    { label: 'not equals', value: 'ne' },\n    { label: 'greater than', value: 'gt' },\n    { label: 'less than', value: 'lt' },\n    { label: 'between', value: 'between' }\n  ],\n  select: [\n    { label: 'equals', value: 'eq' },\n    { label: 'not equals', value: 'ne' }\n  ],\n  date: [\n    { label: 'on', value: 'eq' },\n    { label: 'before', value: 'lt' },\n    { label: 'after', value: 'gt' },\n    { label: 'between', value: 'between' }\n  ]\n};\n\nexport class AdvancedSearch {\n  private config: AdvancedSearchConfig;\n  private criteria: SearchCriterion[] = [];\n  private modal: HTMLElement | null = null;\n  private container: HTMLElement | null = null;\n  private searchInput: HTMLInputElement | null = null;\n  private clearBtn: HTMLElement | null = null;\n  private notifier: ToastNotifier;\n\n  constructor(config: AdvancedSearchConfig) {\n    this.config = config;\n    this.notifier = config.notifier || new FallbackNotifier();\n  }\n\n  init(): void {\n    this.modal = document.getElementById('advanced-search-modal');\n    this.container = document.getElementById('search-criteria-container');\n    this.searchInput = document.getElementById('table-search') as HTMLInputElement;\n    this.clearBtn = document.getElementById('search-clear-btn');\n\n    if (!this.modal || !this.container) {\n      console.error('[AdvancedSearch] Required elements not found');\n      return;\n    }\n\n    // Restore criteria from URL on init\n    this.restoreCriteriaFromURL();\n\n    // Re-render to show restored criteria in the modal and chips in input\n    if (this.criteria.length > 0) {\n      this.renderCriteria();\n      this.renderChips();\n    }\n\n    this.bindEvents();\n    this.bindClearButton();\n  }\n\n  /**\n   * Restore advanced search criteria from URL\n   */\n  private restoreCriteriaFromURL(): void {\n    const params = new URLSearchParams(window.location.search);\n    // Use the same 'filters' parameter as DataGrid for consistency\n    const filtersParam = params.get('filters');\n\n    if (filtersParam) {\n      try {\n        const filters = JSON.parse(filtersParam);\n        // Convert DataGrid filters format to advanced search criteria format\n        this.criteria = filters.map((f: any) => ({\n          field: f.column,\n          operator: f.operator || 'ilike',\n          value: f.value,\n          logic: 'and' // Default logic connector\n        }));\n        console.log('[AdvancedSearch] Restored criteria from URL:', this.criteria);\n      } catch (e) {\n        console.warn('[AdvancedSearch] Failed to parse filters from URL:', e);\n      }\n    }\n  }\n\n  /**\n   * Push criteria to URL\n   */\n  private pushCriteriaToURL(): void {\n    const params = new URLSearchParams(window.location.search);\n\n    if (this.criteria.length > 0) {\n      params.set('advancedSearch', JSON.stringify(this.criteria));\n    } else {\n      params.delete('advancedSearch');\n    }\n\n    const newURL = params.toString()\n      ? `${window.location.pathname}?${params.toString()}`\n      : window.location.pathname;\n\n    window.history.pushState({}, '', newURL);\n    console.log('[AdvancedSearch] URL updated with criteria');\n  }\n\n  private bindEvents(): void {\n    // Open modal\n    const openBtn = document.getElementById('advanced-search-btn');\n    openBtn?.addEventListener('click', () => this.open());\n\n    // Close modal\n    const closeBtn = document.getElementById('advanced-search-close');\n    const cancelBtn = document.getElementById('advanced-search-cancel');\n    const overlay = document.getElementById('advanced-search-overlay');\n\n    closeBtn?.addEventListener('click', () => this.close());\n    cancelBtn?.addEventListener('click', () => this.close());\n    overlay?.addEventListener('click', () => this.close());\n\n    // Add criteria\n    const addBtn = document.getElementById('add-criteria-btn');\n    addBtn?.addEventListener('click', () => this.addCriterion());\n\n    // Apply search\n    const applyBtn = document.getElementById('advanced-search-apply');\n    applyBtn?.addEventListener('click', () => this.applySearch());\n\n    // Save/Load presets\n    const saveBtn = document.getElementById('save-search-preset-btn');\n    const loadBtn = document.getElementById('load-search-preset-btn');\n\n    saveBtn?.addEventListener('click', () => this.savePreset());\n    loadBtn?.addEventListener('click', () => this.loadPreset());\n  }\n\n  private bindClearButton(): void {\n    if (!this.searchInput || !this.clearBtn) return;\n\n    // Show/hide clear button based on input value\n    const updateClearButton = () => {\n      if (this.searchInput!.value.trim()) {\n        this.clearBtn!.classList.remove('hidden');\n      } else {\n        this.clearBtn!.classList.add('hidden');\n      }\n    };\n\n    this.searchInput.addEventListener('input', updateClearButton);\n\n    // Clear search\n    this.clearBtn.addEventListener('click', () => {\n      if (this.searchInput) {\n        this.searchInput.value = '';\n        this.clearBtn!.classList.add('hidden');\n\n        // Clear advanced search criteria and chips\n        this.clearAllChips();\n      }\n    });\n\n    // Initial update\n    updateClearButton();\n  }\n\n  open(): void {\n    if (!this.modal) return;\n\n    this.modal.classList.remove('hidden');\n\n    // Initialize with one criterion if empty\n    if (this.criteria.length === 0) {\n      this.addCriterion();\n    } else {\n      this.renderCriteria();\n    }\n  }\n\n  close(): void {\n    if (!this.modal) return;\n    this.modal.classList.add('hidden');\n  }\n\n  addCriterion(criterion?: Partial<SearchCriterion>): void {\n    const newCriterion: SearchCriterion = {\n      field: criterion?.field || this.config.fields[0]?.name || '',\n      operator: criterion?.operator || 'ilike',\n      value: criterion?.value || '',\n      logic: criterion?.logic || 'and'\n    };\n\n    this.criteria.push(newCriterion);\n    this.renderCriteria();\n  }\n\n  removeCriterion(index: number): void {\n    this.criteria.splice(index, 1);\n    this.renderCriteria();\n  }\n\n  private renderCriteria(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = '';\n\n    this.criteria.forEach((criterion, index) => {\n      // Create wrapper for row + connector to keep separator line behind buttons\n      const wrapper = document.createElement('div');\n\n      const row = this.createCriterionRow(criterion, index);\n      wrapper.appendChild(row);\n\n      // Add logic connector between rows (except last)\n      if (index < this.criteria.length - 1) {\n        const connector = this.createLogicConnector(index);\n        wrapper.appendChild(connector);\n      }\n\n      this.container!.appendChild(wrapper);\n    });\n  }\n\n  private createCriterionRow(criterion: SearchCriterion, index: number): HTMLElement {\n    const row = document.createElement('div');\n    row.className = 'flex items-center gap-2 py-3';\n\n    const field = this.config.fields.find(f => f.name === criterion.field) || this.config.fields[0];\n\n    // Field selector\n    row.innerHTML = `\n      <select data-criterion-index=\"${index}\" data-criterion-part=\"field\"\n              class=\"py-2 px-3 pe-9 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50\">\n        ${this.config.fields.map(f => `\n          <option value=\"${f.name}\" ${f.name === criterion.field ? 'selected' : ''}>${f.label}</option>\n        `).join('')}\n      </select>\n\n      <select data-criterion-index=\"${index}\" data-criterion-part=\"operator\"\n              class=\"py-2 px-3 pe-9 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50\">\n        ${this.getOperatorsForField(field).map(op => `\n          <option value=\"${op.value}\" ${op.value === criterion.operator ? 'selected' : ''}>${op.label}</option>\n        `).join('')}\n      </select>\n\n      ${this.createValueInput(field, criterion, index)}\n\n      <button type=\"button\" data-criterion-index=\"${index}\" data-action=\"remove\"\n              class=\"p-2 text-gray-400 hover:text-red-600\">\n        <svg class=\"h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M3 6h18\"/><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/>\n        </svg>\n      </button>\n    `;\n\n    // Bind events\n    row.querySelectorAll('select, input').forEach(el => {\n      el.addEventListener('change', (e) => this.updateCriterion(e.target as HTMLElement));\n    });\n\n    row.querySelector('[data-action=\"remove\"]')?.addEventListener('click', () => {\n      this.removeCriterion(index);\n    });\n\n    return row;\n  }\n\n  private createValueInput(field: FieldDefinition, criterion: SearchCriterion, index: number): string {\n    if (field.type === 'select' && field.options) {\n      return `\n        <select data-criterion-index=\"${index}\" data-criterion-part=\"value\"\n                class=\"flex-1 py-2 px-3 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500\">\n          <option value=\"\">Select...</option>\n          ${field.options.map(opt => `\n            <option value=\"${opt.value}\" ${opt.value === criterion.value ? 'selected' : ''}>${opt.label}</option>\n          `).join('')}\n        </select>\n      `;\n    }\n\n    const inputType = field.type === 'date' ? 'date' : field.type === 'number' ? 'number' : 'text';\n\n    return `\n      <input type=\"${inputType}\"\n             data-criterion-index=\"${index}\"\n             data-criterion-part=\"value\"\n             value=\"${criterion.value}\"\n             placeholder=\"Enter value...\"\n             class=\"flex-1 py-2 px-3 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500\">\n    `;\n  }\n\n  private createLogicConnector(index: number): HTMLElement {\n    const connector = document.createElement('div');\n    connector.className = 'flex items-center justify-center gap-2 py-2';\n\n    const logic = this.criteria[index].logic || 'and';\n\n    connector.innerHTML = `\n      <button type=\"button\"\n              data-logic-index=\"${index}\"\n              data-logic-value=\"and\"\n              class=\"px-3 py-1 text-xs font-medium rounded border ${logic === 'and' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        And\n      </button>\n      <button type=\"button\"\n              data-logic-index=\"${index}\"\n              data-logic-value=\"or\"\n              class=\"px-3 py-1 text-xs font-medium rounded border ${logic === 'or' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        Or\n      </button>\n    `;\n\n    connector.querySelectorAll('[data-logic-index]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const idx = parseInt(target.dataset.logicIndex || '0', 10);\n        const value = target.dataset.logicValue as 'and' | 'or';\n        this.criteria[idx].logic = value;\n        this.renderCriteria();\n      });\n    });\n\n    return connector;\n  }\n\n  private updateCriterion(element: HTMLElement): void {\n    const index = parseInt(element.dataset.criterionIndex || '0', 10);\n    const part = element.dataset.criterionPart as 'field' | 'operator' | 'value';\n\n    if (!this.criteria[index]) return;\n\n    const value = (element as HTMLInputElement | HTMLSelectElement).value;\n\n    if (part === 'field') {\n      this.criteria[index].field = value;\n      // Re-render to update operators and value input for new field type\n      this.renderCriteria();\n    } else if (part === 'operator') {\n      this.criteria[index].operator = value;\n    } else if (part === 'value') {\n      this.criteria[index].value = value;\n    }\n  }\n\n  private getOperatorsForField(field: FieldDefinition): { label: string; value: string }[] {\n    if (field.operators && field.operators.length > 0) {\n      return field.operators.map(op => ({ label: op, value: op }));\n    }\n    return DEFAULT_OPERATORS[field.type] || DEFAULT_OPERATORS.text;\n  }\n\n  private applySearch(): void {\n    this.pushCriteriaToURL();\n    this.config.onSearch(this.criteria);\n    this.renderChips(); // Render chips before closing modal\n    this.close();\n  }\n\n  private savePreset(): void {\n    const modal = new TextPromptModal({\n      title: 'Save Search Preset',\n      label: 'Preset name',\n      placeholder: 'e.g. Active users filter',\n      confirmLabel: 'Save',\n      onConfirm: (name) => {\n        const presets = this.loadPresetsFromStorage();\n        presets[name] = this.criteria;\n        localStorage.setItem('search_presets', JSON.stringify(presets));\n        this.notifier.success(`Preset \"${name}\" saved!`);\n      },\n    });\n    modal.show();\n  }\n\n  private loadPreset(): void {\n    const presets = this.loadPresetsFromStorage();\n    const names = Object.keys(presets);\n\n    if (names.length === 0) {\n      this.notifier.warning('No saved presets found.');\n      return;\n    }\n\n    const modal = new TextPromptModal({\n      title: 'Load Search Preset',\n      label: `Available presets: ${names.join(', ')}`,\n      placeholder: 'Enter preset name',\n      confirmLabel: 'Load',\n      onConfirm: (name) => {\n        if (!presets[name]) {\n          this.notifier.warning(`Preset \"${name}\" not found.`);\n          return;\n        }\n        this.criteria = presets[name];\n        this.renderCriteria();\n      },\n    });\n    modal.show();\n  }\n\n  private loadPresetsFromStorage(): Record<string, SearchCriterion[]> {\n    try {\n      const stored = localStorage.getItem('search_presets');\n      return stored ? JSON.parse(stored) : {};\n    } catch (e) {\n      return {};\n    }\n  }\n\n  getCriteria(): SearchCriterion[] {\n    return this.criteria;\n  }\n\n  setCriteria(criteria: SearchCriterion[]): void {\n    this.criteria = criteria;\n    this.renderCriteria();\n    this.renderChips();\n  }\n\n  /**\n   * Render filter chips in the search input\n   */\n  renderChips(): void {\n    const chipsContainer = document.getElementById('filter-chips-container');\n    const searchInput = document.getElementById('table-search') as HTMLInputElement;\n    const clearBtn = document.getElementById('search-clear-btn');\n\n    if (!chipsContainer) return;\n\n    chipsContainer.innerHTML = '';\n\n    if (this.criteria.length === 0) {\n      // No chips - show placeholder, hide clear button\n      if (searchInput) {\n        searchInput.placeholder = 'Search for items';\n        searchInput.style.display = '';\n      }\n      if (clearBtn) clearBtn.classList.add('hidden');\n      return;\n    }\n\n    // Hide placeholder when chips present\n    if (searchInput) {\n      searchInput.placeholder = '';\n      searchInput.style.display = '';\n    }\n\n    // Show clear button\n    if (clearBtn) clearBtn.classList.remove('hidden');\n\n    // Render each criterion as a chip\n    this.criteria.forEach((criterion, index) => {\n      const chip = this.createChip(criterion, index);\n      chipsContainer.appendChild(chip);\n    });\n  }\n\n  /**\n   * Create a single filter chip\n   */\n  private createChip(criterion: SearchCriterion, index: number): HTMLElement {\n    const chip = document.createElement('div');\n    chip.className = 'inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded border border-blue-200';\n\n    const field = this.config.fields.find(f => f.name === criterion.field);\n    const fieldLabel = field?.label || criterion.field;\n    const operatorLabel = criterion.operator === 'ilike' ? 'contains' :\n                         criterion.operator === 'eq' ? 'is' :\n                         criterion.operator;\n\n    chip.innerHTML = `\n      <span>${fieldLabel} ${operatorLabel} \"${criterion.value}\"</span>\n      <button type=\"button\"\n              data-chip-index=\"${index}\"\n              class=\"ml-1 text-blue-600 hover:text-blue-800 focus:outline-none\"\n              title=\"Remove filter\">\n        <svg class=\"h-3 w-3\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/>\n        </svg>\n      </button>\n    `;\n\n    // Bind remove handler\n    const removeBtn = chip.querySelector('[data-chip-index]');\n    if (removeBtn) {\n      removeBtn.addEventListener('click', () => {\n        this.removeChip(index);\n      });\n    }\n\n    return chip;\n  }\n\n  /**\n   * Remove a chip and update filters\n   */\n  private removeChip(index: number): void {\n    this.criteria.splice(index, 1);\n    this.renderCriteria();\n    this.renderChips();\n\n    // Trigger search with updated criteria\n    this.config.onSearch(this.criteria);\n  }\n\n  /**\n   * Clear all chips\n   */\n  clearAllChips(): void {\n    this.criteria = [];\n    this.renderCriteria();\n    this.renderChips();\n\n    // Trigger clear callback\n    if (this.config.onClear) {\n      this.config.onClear();\n    }\n  }\n}\n","/**\n * FilterBuilder Component\n *\n * Manages complex filter groups with AND/OR logic between conditions and groups.\n * Renders a UI similar to query builders with drag-and-drop reordering.\n */\n\nimport type { FilterCondition, FilterGroup, FilterStructure } from './behaviors/types.js';\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\n\nexport interface FieldDefinition {\n  name: string;\n  label: string;\n  type: 'text' | 'number' | 'date' | 'select';\n  operators?: string[];\n  options?: { label: string; value: string }[];\n}\n\nexport interface FilterBuilderConfig {\n  fields: FieldDefinition[];\n  onApply: (structure: FilterStructure) => void;\n  onClear: () => void;\n  notifier?: ToastNotifier;\n}\n\nconst DEFAULT_OPERATORS: Record<string, { label: string; value: string }[]> = {\n  text: [\n    { label: 'contains', value: 'ilike' },\n    { label: 'is', value: 'eq' },\n    { label: 'is not', value: 'ne' },\n  ],\n  number: [\n    { label: 'equals', value: 'eq' },\n    { label: 'not equals', value: 'ne' },\n    { label: 'greater than', value: 'gt' },\n    { label: 'less than', value: 'lt' },\n    { label: 'greater than or equal', value: 'gte' },\n    { label: 'less than or equal', value: 'lte' },\n  ],\n  date: [\n    { label: 'is', value: 'eq' },\n    { label: 'before', value: 'lt' },\n    { label: 'after', value: 'gt' },\n  ],\n  select: [\n    { label: 'is', value: 'eq' },\n    { label: 'is not', value: 'ne' },\n  ],\n};\n\nexport class FilterBuilder {\n  private config: FilterBuilderConfig;\n  private structure: FilterStructure;\n  private panel: HTMLElement | null = null;\n  private container: HTMLElement | null = null;\n  private previewElement: HTMLElement | null = null;\n  private sqlPreviewElement: HTMLElement | null = null;\n  private overlay: HTMLElement | null = null;\n  private notifier: ToastNotifier;\n\n  constructor(config: FilterBuilderConfig) {\n    this.config = config;\n    this.notifier = config.notifier || new FallbackNotifier();\n    this.structure = { groups: [], groupLogic: [] };\n    this.init();\n  }\n\n  private init(): void {\n    this.panel = document.getElementById('filter-panel');\n    this.overlay = document.getElementById('filter-overlay');\n    this.previewElement = document.getElementById('filter-preview-text');\n\n    if (!this.panel) {\n      console.error('[FilterBuilder] Panel element not found');\n      return;\n    }\n\n    // Build panel structure\n    this.buildPanelStructure();\n\n    // Bind toggle button\n    const toggleBtn = document.getElementById('filter-toggle-btn');\n    if (toggleBtn) {\n      toggleBtn.addEventListener('click', () => this.toggle());\n    }\n\n    // Bind clear filters\n    const clearBtn = document.getElementById('clear-filters-btn');\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => this.clearFilters());\n    }\n\n    // Close on overlay click\n    if (this.overlay) {\n      this.overlay.addEventListener('click', () => this.close());\n    }\n\n    // Close on Escape\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape' && !this.panel!.classList.contains('hidden')) {\n        this.close();\n      }\n    });\n\n    // Restore from URL\n    this.restoreFromURL();\n  }\n\n  private buildPanelStructure(): void {\n    if (!this.panel) return;\n\n    this.panel.innerHTML = `\n      <div class=\"flex items-center justify-between mb-4\">\n        <h3 class=\"text-base font-semibold text-gray-900\">Filters</h3>\n        <div class=\"flex gap-2\">\n          <button type=\"button\" id=\"saved-filters-btn\" class=\"text-sm text-blue-600 hover:text-blue-800\">\n            Saved filters ▾\n          </button>\n          <button type=\"button\" id=\"edit-sql-btn\" class=\"text-sm text-blue-600 hover:text-blue-800\">\n            Edit as SQL\n          </button>\n        </div>\n      </div>\n\n      <!-- Filter Groups Container -->\n      <div id=\"filter-groups-container\" class=\"space-y-3 mb-4\">\n        <!-- Groups will be rendered here -->\n      </div>\n\n      <!-- Add Group Button -->\n      <button type=\"button\" id=\"add-group-btn\" class=\"inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800 mb-4\">\n        <svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"/><rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"/>\n          <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"/><rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"/>\n        </svg>\n        AND\n      </button>\n\n      <!-- SQL Preview -->\n      <div class=\"border-t border-gray-200 pt-3 mb-4\">\n        <div class=\"text-xs text-gray-500 mb-1\">Preview:</div>\n        <div id=\"sql-preview\" class=\"text-xs font-mono text-gray-700 bg-gray-50 p-2 rounded border border-gray-200 min-h-[40px] max-h-[100px] overflow-y-auto break-words\">\n          No filters applied\n        </div>\n      </div>\n\n      <!-- Action Buttons -->\n      <div class=\"flex items-center justify-between border-t border-gray-200 pt-4\">\n        <div class=\"flex gap-2\">\n          <input type=\"text\" id=\"save-filter-name\" placeholder=\"Type a name here\" class=\"text-sm border border-gray-200 rounded px-3 py-1.5 w-48\">\n          <button type=\"button\" id=\"save-filter-btn\" class=\"text-sm text-gray-600 hover:text-gray-800 border border-gray-200 rounded px-3 py-1.5\">\n            Save filter\n          </button>\n        </div>\n        <div class=\"flex gap-2\">\n          <button type=\"button\" id=\"clear-all-btn\" class=\"text-sm text-gray-700 hover:text-gray-900 px-4 py-2\">\n            Clear all\n          </button>\n          <button type=\"button\" id=\"apply-filter-btn\" class=\"text-sm text-white bg-blue-600 hover:bg-blue-700 rounded-lg px-4 py-2\">\n            Apply filter\n          </button>\n        </div>\n      </div>\n    `;\n\n    this.container = document.getElementById('filter-groups-container');\n    this.sqlPreviewElement = document.getElementById('sql-preview');\n\n    // Bind action buttons\n    this.bindActions();\n\n    // Start with one empty group\n    if (this.structure.groups.length === 0) {\n      this.addGroup();\n    }\n  }\n\n  private bindActions(): void {\n    const addGroupBtn = document.getElementById('add-group-btn');\n    const applyBtn = document.getElementById('apply-filter-btn');\n    const clearAllBtn = document.getElementById('clear-all-btn');\n    const saveBtn = document.getElementById('save-filter-btn');\n\n    if (addGroupBtn) {\n      addGroupBtn.addEventListener('click', () => this.addGroup());\n    }\n\n    if (applyBtn) {\n      applyBtn.addEventListener('click', () => this.applyFilters());\n    }\n\n    if (clearAllBtn) {\n      clearAllBtn.addEventListener('click', () => this.clearAll());\n    }\n\n    if (saveBtn) {\n      saveBtn.addEventListener('click', () => this.saveFilter());\n    }\n  }\n\n  private addGroup(): void {\n    const newGroup: FilterGroup = {\n      conditions: [this.createEmptyCondition()],\n      logic: 'or'\n    };\n\n    this.structure.groups.push(newGroup);\n\n    // Add group logic if not first group\n    if (this.structure.groups.length > 1) {\n      this.structure.groupLogic.push('and');\n    }\n\n    this.render();\n  }\n\n  private createEmptyCondition(): FilterCondition {\n    const firstField = this.config.fields[0];\n    return {\n      field: firstField.name,\n      operator: 'ilike',\n      value: ''\n    };\n  }\n\n  private render(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = '';\n\n    this.structure.groups.forEach((group, groupIndex) => {\n      // Create group container\n      const groupEl = this.createGroupElement(group, groupIndex);\n      this.container!.appendChild(groupEl);\n\n      // Add group logic connector (except after last group)\n      if (groupIndex < this.structure.groups.length - 1) {\n        const connector = this.createGroupConnector(groupIndex);\n        this.container!.appendChild(connector);\n      }\n    });\n\n    this.updatePreview();\n  }\n\n  private createGroupElement(group: FilterGroup, groupIndex: number): HTMLElement {\n    const groupEl = document.createElement('div');\n    groupEl.className = 'border border-gray-200 rounded-lg p-3 bg-gray-50';\n\n    // Group header (if multiple groups)\n    const header = document.createElement('div');\n    header.className = 'flex justify-end mb-2';\n    header.innerHTML = `\n      <button type=\"button\" data-remove-group=\"${groupIndex}\" class=\"text-xs text-red-600 hover:text-red-800\">\n        Remove group\n      </button>\n    `;\n    groupEl.appendChild(header);\n\n    // Render conditions\n    group.conditions.forEach((condition, condIndex) => {\n      const condEl = this.createConditionElement(condition, groupIndex, condIndex);\n      groupEl.appendChild(condEl);\n\n      // Add condition logic (except after last condition)\n      if (condIndex < group.conditions.length - 1) {\n        const condConnector = this.createConditionConnector(groupIndex, condIndex, group.logic);\n        groupEl.appendChild(condConnector);\n      }\n    });\n\n    // Add condition button\n    const addCondBtn = document.createElement('button');\n    addCondBtn.type = 'button';\n    addCondBtn.className = 'mt-2 inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800';\n    addCondBtn.dataset.addCondition = String(groupIndex);\n    addCondBtn.innerHTML = `\n      <svg class=\"h-3 w-3\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M12 5v14\"/><path d=\"M5 12h14\"/>\n      </svg>\n      ${group.logic.toUpperCase()}\n    `;\n    groupEl.appendChild(addCondBtn);\n\n    // Bind events\n    this.bindGroupEvents(groupEl, groupIndex);\n\n    return groupEl;\n  }\n\n  private createConditionElement(condition: FilterCondition, groupIndex: number, condIndex: number): HTMLElement {\n    const condEl = document.createElement('div');\n    condEl.className = 'flex items-center gap-2 mb-2';\n\n    const field = this.config.fields.find(f => f.name === condition.field) || this.config.fields[0];\n\n    condEl.innerHTML = `\n      <div class=\"flex items-center text-gray-400 cursor-move\" title=\"Drag to reorder\">\n        <svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <circle cx=\"9\" cy=\"5\" r=\"1\"/><circle cx=\"9\" cy=\"12\" r=\"1\"/><circle cx=\"9\" cy=\"19\" r=\"1\"/>\n          <circle cx=\"15\" cy=\"5\" r=\"1\"/><circle cx=\"15\" cy=\"12\" r=\"1\"/><circle cx=\"15\" cy=\"19\" r=\"1\"/>\n        </svg>\n      </div>\n\n      <select data-cond=\"${groupIndex}-${condIndex}-field\" class=\"py-1.5 px-2 text-sm border-gray-200 rounded-lg bg-white w-32\">\n        ${this.config.fields.map(f => `\n          <option value=\"${f.name}\" ${f.name === condition.field ? 'selected' : ''}>${f.label}</option>\n        `).join('')}\n      </select>\n\n      <select data-cond=\"${groupIndex}-${condIndex}-operator\" class=\"py-1.5 px-2 text-sm border-gray-200 rounded-lg bg-white w-36\">\n        ${this.getOperatorsForField(field).map(op => `\n          <option value=\"${op.value}\" ${op.value === condition.operator ? 'selected' : ''}>${op.label}</option>\n        `).join('')}\n      </select>\n\n      ${this.renderValueInput(field, condition, groupIndex, condIndex)}\n\n      <button type=\"button\" data-remove-cond=\"${groupIndex}-${condIndex}\" class=\"text-red-600 hover:text-red-800\">\n        <svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M3 6h18\"/><path d=\"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6\"/><path d=\"M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2\"/>\n        </svg>\n      </button>\n\n      <button type=\"button\" data-add-cond-or=\"${groupIndex}-${condIndex}\" class=\"px-2 py-1 text-xs border border-blue-600 text-blue-600 rounded hover:bg-blue-50\" title=\"Add OR condition\">\n        OR\n      </button>\n\n      <button type=\"button\" data-add-cond-and=\"${groupIndex}-${condIndex}\" class=\"px-2 py-1 text-xs border border-blue-600 text-blue-600 rounded hover:bg-blue-50\" title=\"Add AND condition\">\n        AND\n      </button>\n    `;\n\n    return condEl;\n  }\n\n  private renderValueInput(field: FieldDefinition, condition: FilterCondition, groupIndex: number, condIndex: number): string {\n    if (field.type === 'select' && field.options) {\n      return `\n        <select data-cond=\"${groupIndex}-${condIndex}-value\" class=\"flex-1 min-w-[200px] py-1.5 px-2 text-sm border-gray-200 rounded-lg bg-white\">\n          <option value=\"\">Select...</option>\n          ${field.options.map(opt => `\n            <option value=\"${opt.value}\" ${opt.value === condition.value ? 'selected' : ''}>${opt.label}</option>\n          `).join('')}\n        </select>\n      `;\n    }\n\n    const inputType = field.type === 'date' ? 'date' : field.type === 'number' ? 'number' : 'text';\n\n    return `\n      <input type=\"${inputType}\"\n             data-cond=\"${groupIndex}-${condIndex}-value\"\n             value=\"${condition.value || ''}\"\n             placeholder=\"Enter value...\"\n             class=\"flex-1 min-w-[200px] py-1.5 px-2 text-sm border-gray-200 rounded-lg\">\n    `;\n  }\n\n  private createConditionConnector(groupIndex: number, condIndex: number, logic: 'and' | 'or'): HTMLElement {\n    const connector = document.createElement('div');\n    connector.className = 'flex items-center justify-center my-1';\n    connector.innerHTML = `\n      <span class=\"text-xs font-medium text-gray-500 px-2 py-0.5 bg-white border border-gray-200 rounded\">\n        ${logic.toUpperCase()}\n      </span>\n    `;\n    return connector;\n  }\n\n  private createGroupConnector(groupIndex: number): HTMLElement {\n    const connector = document.createElement('div');\n    connector.className = 'flex items-center justify-center py-2';\n\n    const logic = this.structure.groupLogic[groupIndex] || 'and';\n\n    connector.innerHTML = `\n      <button type=\"button\"\n              data-group-logic=\"${groupIndex}\"\n              data-logic-value=\"and\"\n              class=\"px-3 py-1 text-xs font-medium rounded-l border ${logic === 'and' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        AND\n      </button>\n      <button type=\"button\"\n              data-group-logic=\"${groupIndex}\"\n              data-logic-value=\"or\"\n              class=\"px-3 py-1 text-xs font-medium rounded-r border ${logic === 'or' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        OR\n      </button>\n    `;\n\n    // Bind logic toggle\n    connector.querySelectorAll('[data-group-logic]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const idx = parseInt(target.dataset.groupLogic || '0', 10);\n        const value = target.dataset.logicValue as 'and' | 'or';\n        this.structure.groupLogic[idx] = value;\n        this.render();\n      });\n    });\n\n    return connector;\n  }\n\n  private bindGroupEvents(groupEl: HTMLElement, groupIndex: number): void {\n    // Remove group\n    const removeGroupBtn = groupEl.querySelector(`[data-remove-group=\"${groupIndex}\"]`);\n    if (removeGroupBtn) {\n      removeGroupBtn.addEventListener('click', () => this.removeGroup(groupIndex));\n    }\n\n    // Add condition\n    const addCondBtn = groupEl.querySelector(`[data-add-condition=\"${groupIndex}\"]`);\n    if (addCondBtn) {\n      addCondBtn.addEventListener('click', () => this.addCondition(groupIndex));\n    }\n\n    // Condition field changes\n    groupEl.querySelectorAll('[data-cond]').forEach(el => {\n      const input = el as HTMLInputElement | HTMLSelectElement;\n      const [gIdx, cIdx, part] = input.dataset.cond!.split('-');\n      const gi = parseInt(gIdx, 10);\n      const ci = parseInt(cIdx, 10);\n\n      input.addEventListener('change', () => {\n        if (part === 'field') {\n          this.structure.groups[gi].conditions[ci].field = input.value;\n          this.render(); // Re-render to update operators\n        } else if (part === 'operator') {\n          this.structure.groups[gi].conditions[ci].operator = input.value;\n          this.updatePreview();\n        } else if (part === 'value') {\n          this.structure.groups[gi].conditions[ci].value = input.value;\n          this.updatePreview();\n        }\n      });\n    });\n\n    // Remove condition\n    groupEl.querySelectorAll('[data-remove-cond]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const closest = target.closest('[data-remove-cond]') as HTMLElement;\n        if (!closest) return;\n        const [gIdx, cIdx] = closest.dataset.removeCond!.split('-').map(Number);\n        this.removeCondition(gIdx, cIdx);\n      });\n    });\n\n    // Add OR/AND condition\n    groupEl.querySelectorAll('[data-add-cond-or], [data-add-cond-and]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const isOr = target.dataset.addCondOr !== undefined;\n        const dataAttr = isOr ? target.dataset.addCondOr : target.dataset.addCondAnd;\n        if (!dataAttr) return;\n        const [gIdx] = dataAttr.split('-').map(Number);\n\n        // Toggle group logic\n        this.structure.groups[gIdx].logic = isOr ? 'or' : 'and';\n        this.addCondition(gIdx);\n      });\n    });\n  }\n\n  private addCondition(groupIndex: number): void {\n    this.structure.groups[groupIndex].conditions.push(this.createEmptyCondition());\n    this.render();\n  }\n\n  private removeCondition(groupIndex: number, condIndex: number): void {\n    const group = this.structure.groups[groupIndex];\n    group.conditions.splice(condIndex, 1);\n\n    // If group is empty, remove it\n    if (group.conditions.length === 0) {\n      this.removeGroup(groupIndex);\n    } else {\n      this.render();\n    }\n  }\n\n  private removeGroup(groupIndex: number): void {\n    this.structure.groups.splice(groupIndex, 1);\n\n    // Adjust groupLogic array\n    if (groupIndex < this.structure.groupLogic.length) {\n      this.structure.groupLogic.splice(groupIndex, 1);\n    } else if (groupIndex > 0 && this.structure.groupLogic.length > 0) {\n      this.structure.groupLogic.splice(groupIndex - 1, 1);\n    }\n\n    // Ensure at least one group\n    if (this.structure.groups.length === 0) {\n      this.addGroup();\n    } else {\n      this.render();\n    }\n  }\n\n  private getOperatorsForField(field: FieldDefinition): { label: string; value: string }[] {\n    if (field.operators && field.operators.length > 0) {\n      return field.operators.map(op => ({ label: op, value: op }));\n    }\n    return DEFAULT_OPERATORS[field.type] || DEFAULT_OPERATORS.text;\n  }\n\n  private updatePreview(): void {\n    const sqlPreview = this.generateSQLPreview();\n    const textPreview = this.generateTextPreview();\n\n    if (this.sqlPreviewElement) {\n      this.sqlPreviewElement.textContent = sqlPreview || 'No filters applied';\n    }\n\n    if (this.previewElement) {\n      this.previewElement.textContent = textPreview;\n    }\n\n    // Show/hide applied filter preview\n    const previewContainer = document.getElementById('applied-filter-preview');\n    if (previewContainer) {\n      if (this.hasActiveFilters()) {\n        previewContainer.classList.remove('hidden');\n      } else {\n        previewContainer.classList.add('hidden');\n      }\n    }\n  }\n\n  private hasActiveFilters(): boolean {\n    return this.structure.groups.some(g =>\n      g.conditions.some(c => c.value !== '' && c.value !== null && c.value !== undefined)\n    );\n  }\n\n  private generateSQLPreview(): string {\n    const groupParts = this.structure.groups.map(group => {\n      const condParts = group.conditions\n        .filter(c => c.value !== '' && c.value !== null)\n        .map(c => {\n          const op = c.operator.toUpperCase();\n          const val = typeof c.value === 'string' ? `'${c.value}'` : c.value;\n          return `${c.field} ${op === 'ILIKE' ? 'ILIKE' : op === 'EQ' ? '=' : op} ${val}`;\n        });\n\n      if (condParts.length === 0) return '';\n      if (condParts.length === 1) return condParts[0];\n      return `( ${condParts.join(` ${group.logic.toUpperCase()} `)} )`;\n    }).filter(p => p !== '');\n\n    if (groupParts.length === 0) return '';\n    if (groupParts.length === 1) return groupParts[0];\n\n    return groupParts.reduce((acc, part, idx) => {\n      if (idx === 0) return part;\n      const logic = this.structure.groupLogic[idx - 1] || 'and';\n      return `${acc} ${logic.toUpperCase()} ${part}`;\n    }, '');\n  }\n\n  private generateTextPreview(): string {\n    const groupParts = this.structure.groups.map(group => {\n      const condParts = group.conditions\n        .filter(c => c.value !== '' && c.value !== null)\n        .map(c => {\n          const field = this.config.fields.find(f => f.name === c.field);\n          const fieldLabel = field?.label || c.field;\n          const opLabel = this.getOperatorsForField(field!).find(op => op.value === c.operator)?.label || c.operator;\n          return `${fieldLabel} ${opLabel} \"${c.value}\"`;\n        });\n\n      if (condParts.length === 0) return '';\n      if (condParts.length === 1) return condParts[0];\n      return `( ${condParts.join(` ${group.logic.toUpperCase()} `)} )`;\n    }).filter(p => p !== '');\n\n    if (groupParts.length === 0) return '';\n    if (groupParts.length === 1) return groupParts[0];\n\n    return groupParts.reduce((acc, part, idx) => {\n      if (idx === 0) return part;\n      const logic = this.structure.groupLogic[idx - 1] || 'and';\n      return `${acc} ${logic.toUpperCase()} ${part}`;\n    }, '');\n  }\n\n  private applyFilters(): void {\n    this.config.onApply(this.structure);\n    this.close();\n  }\n\n  private clearAll(): void {\n    this.structure = { groups: [], groupLogic: [] };\n    this.addGroup();\n    this.updatePreview();\n  }\n\n  private clearFilters(): void {\n    this.clearAll();\n    this.config.onClear();\n    this.updatePreview();\n  }\n\n  private saveFilter(): void {\n    const nameInput = document.getElementById('save-filter-name') as HTMLInputElement;\n    const name = nameInput?.value.trim();\n\n    if (!name) {\n      this.notifier.warning('Please enter a name for the filter');\n      return;\n    }\n\n    const saved = this.getSavedFilters();\n    saved[name] = this.structure;\n    localStorage.setItem('saved_filters', JSON.stringify(saved));\n\n    this.notifier.success(`Filter \"${name}\" saved!`);\n    if (nameInput) nameInput.value = '';\n  }\n\n  private getSavedFilters(): Record<string, FilterStructure> {\n    try {\n      const saved = localStorage.getItem('saved_filters');\n      return saved ? JSON.parse(saved) : {};\n    } catch {\n      return {};\n    }\n  }\n\n  private toggle(): void {\n    if (this.panel?.classList.contains('hidden')) {\n      this.open();\n    } else {\n      this.close();\n    }\n  }\n\n  private open(): void {\n    // Position panel below the filter button\n    const toggleBtn = document.getElementById('filter-toggle-btn');\n    if (toggleBtn && this.panel) {\n      const rect = toggleBtn.getBoundingClientRect();\n      this.panel.style.top = `${rect.bottom + 8}px`;\n      this.panel.style.left = `${rect.left}px`;\n    }\n\n    this.panel?.classList.remove('hidden');\n    this.overlay?.classList.remove('hidden');\n  }\n\n  private close(): void {\n    this.panel?.classList.add('hidden');\n    this.overlay?.classList.add('hidden');\n  }\n\n  private restoreFromURL(): void {\n    const params = new URLSearchParams(window.location.search);\n    const filtersParam = params.get('filters');\n\n    if (filtersParam) {\n      try {\n        const filters = JSON.parse(filtersParam);\n        // Convert old format to new group structure if needed\n        if (Array.isArray(filters) && filters.length > 0) {\n          this.structure = this.convertLegacyFilters(filters);\n          this.render();\n        }\n      } catch (e) {\n        console.warn('[FilterBuilder] Failed to parse filters from URL:', e);\n      }\n    }\n  }\n\n  private convertLegacyFilters(filters: any[]): FilterStructure {\n    // Group filters by field to detect OR conditions\n    const fieldGroups = new Map<string, any[]>();\n\n    filters.forEach(f => {\n      const key = f.column;\n      if (!fieldGroups.has(key)) {\n        fieldGroups.set(key, []);\n      }\n      fieldGroups.get(key)!.push(f);\n    });\n\n    const groups: FilterGroup[] = [];\n\n    fieldGroups.forEach((conditions) => {\n      groups.push({\n        conditions: conditions.map(c => ({\n          field: c.column,\n          operator: c.operator || 'ilike',\n          value: c.value\n        })),\n        logic: conditions.length > 1 ? 'or' : 'and'\n      });\n    });\n\n    return {\n      groups,\n      groupLogic: new Array(groups.length - 1).fill('and')\n    };\n  }\n\n  getStructure(): FilterStructure {\n    return this.structure;\n  }\n\n  setStructure(structure: FilterStructure): void {\n    this.structure = structure;\n    this.render();\n  }\n}\n","import type { SearchBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud search behavior\n * Builds OR queries across multiple fields using __ilike operator\n */\nexport class GoCrudSearchBehavior implements SearchBehavior {\n  constructor(private searchableFields: string[]) {\n    if (!searchableFields || searchableFields.length === 0) {\n      throw new Error('At least one searchable field is required');\n    }\n  }\n\n  buildQuery(term: string): Record<string, any> {\n    if (!term || term.trim() === '') {\n      return {};\n    }\n\n    const params: Record<string, any> = {};\n    const trimmedTerm = term.trim();\n\n    // Build OR query: ?name__ilike=%term%&email__ilike=%term%\n    // Note: go-crud will OR these together when multiple fields match the same operator pattern\n    this.searchableFields.forEach(field => {\n      params[`${field}__ilike`] = `%${trimmedTerm}%`;\n    });\n\n    return params;\n  }\n\n  async onSearch(term: string, grid: DataGrid): Promise<void> {\n    // Reset to first page when searching\n    grid.resetPagination();\n    await grid.refresh();\n  }\n}\n","import type { FilterBehavior, ColumnFilter } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud filter behavior\n * Builds query parameters using go-crud's filter syntax\n */\nexport class GoCrudFilterBehavior implements FilterBehavior {\n  buildFilters(filters: ColumnFilter[]): Record<string, any> {\n    const params: Record<string, any> = {};\n\n    // Group filters by column to detect OR conditions\n    const grouped = new Map<string, { operator: string; values: any[] }>();\n\n    filters.forEach(filter => {\n      if (filter.value === null || filter.value === undefined || filter.value === '') {\n        return;\n      }\n\n      const operator = filter.operator || 'eq';\n      const column = filter.column;\n\n      if (!grouped.has(column)) {\n        grouped.set(column, { operator, values: [] });\n      }\n      grouped.get(column)!.values.push(filter.value);\n    });\n\n    // Convert grouped filters to params\n    grouped.forEach((data, column) => {\n      if (data.values.length === 1) {\n        // Single value - use the original operator\n        const key = data.operator === 'eq' ? column : `${column}__${data.operator}`;\n        params[key] = data.values[0];\n      } else {\n        // Multiple values for same field - use __in for OR logic (exact match)\n        // For pattern matching like ILIKE, join with comma and handle in backend\n        if (data.operator === 'ilike') {\n          // Use custom OR syntax: field__ilike=val1,val2\n          params[`${column}__ilike`] = data.values.join(',');\n        } else if (data.operator === 'eq') {\n          // Use __in for exact matches with multiple values\n          params[`${column}__in`] = data.values.join(',');\n        } else {\n          // For other operators, join with comma\n          params[`${column}__${data.operator}`] = data.values.join(',');\n        }\n      }\n    });\n\n    return params;\n  }\n\n  async onFilterChange(column: string, value: any, grid: DataGrid): Promise<void> {\n    // Reset to first page when filtering changes\n    grid.resetPagination();\n    await grid.refresh();\n  }\n}\n","import type { PaginationBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud pagination behavior\n * Uses limit/offset query parameters\n */\nexport class GoCrudPaginationBehavior implements PaginationBehavior {\n  buildQuery(page: number, perPage: number): Record<string, any> {\n    return {\n      limit: perPage,\n      offset: (page - 1) * perPage\n    };\n  }\n\n  async onPageChange(page: number, grid: DataGrid): Promise<void> {\n    await grid.refresh();\n  }\n}\n","import type { SortBehavior, SortColumn } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud sort behavior\n * Uses order query parameter with comma-separated values\n */\nexport class GoCrudSortBehavior implements SortBehavior {\n  buildQuery(columns: SortColumn[]): Record<string, any> {\n    if (!columns || columns.length === 0) {\n      return {};\n    }\n\n    // Build order parameter: ?order=name asc,created_at desc\n    const order = columns\n      .map(col => `${col.field} ${col.direction}`)\n      .join(',');\n\n    return { order };\n  }\n\n  async onSort(column: string, direction: 'asc' | 'desc', grid: DataGrid): Promise<void> {\n    await grid.refresh();\n  }\n}\n","import type { ExportBehavior, ExportConcurrencyMode } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\nimport { httpRequest } from '../../shared/transport/http-client.js';\n\ntype ExportFormat = 'csv' | 'json' | 'excel' | 'pdf';\ntype DeliveryMode = 'sync' | 'async' | 'auto';\n\ninterface ExportSelection {\n  mode: 'all' | 'ids' | 'query';\n  ids?: string[];\n  query?: {\n    name: string;\n    params?: Record<string, any>;\n  };\n}\n\ninterface ExportQueryFilter {\n  field: string;\n  op: string;\n  value: any;\n}\n\ninterface ExportQuerySort {\n  field: string;\n  desc: boolean;\n}\n\ninterface ExportQuery {\n  filters?: ExportQueryFilter[];\n  search?: string;\n  sort?: ExportQuerySort[];\n  limit?: number;\n  offset?: number;\n  cursor?: string;\n}\n\ninterface ExportPayload {\n  definition?: string;\n  resource?: string;\n  source_variant?: string;\n  format: string;\n  query?: ExportQuery;\n  selection?: ExportSelection;\n  columns?: string[];\n  delivery?: DeliveryMode;\n  estimated_rows?: number;\n  estimated_bytes?: number;\n}\n\ninterface ExportAsyncResponse {\n  id?: string;\n  status_url?: string;\n  download_url?: string;\n}\n\ninterface ExportStatusRecord {\n  id?: string;\n  state?: string;\n}\n\nexport interface GoCrudExportConfig {\n  endpoint: string;\n  definition?: string;\n  resource?: string;\n  variant?: string;\n  sourceVariant?: string;\n  delivery?: DeliveryMode;\n  /**\n   * Formats that should default to async delivery (when delivery is not explicitly set).\n   * Defaults to ['pdf'].\n   */\n  asyncFormats?: ExportFormat[];\n  /**\n   * Polling interval for async exports (ms).\n   */\n  statusPollIntervalMs?: number;\n  /**\n   * Maximum polling duration for async exports (ms). Set to 0 to disable timeout.\n   */\n  statusPollTimeoutMs?: number;\n  selection?: ExportSelection;\n  columns?: string[];\n  /**\n   * Concurrency mode for export operations\n   * - 'single': Block all export buttons while any export is in progress (default)\n   * - 'per-format': Block only the clicked format's button\n   * - 'none': Allow parallel exports (no blocking)\n   */\n  concurrency?: ExportConcurrencyMode;\n}\n\n/**\n * go-export export behavior\n * Uses go-export endpoints with the datagrid request contract\n */\nexport class GoCrudExportBehavior implements ExportBehavior {\n  private config: GoCrudExportConfig;\n\n  constructor(config: GoCrudExportConfig) {\n    if (!config || !config.endpoint) {\n      throw new Error('export endpoint is required');\n    }\n    if (!config.definition && !config.resource) {\n      throw new Error('export definition or resource is required');\n    }\n    this.config = config;\n  }\n\n  getEndpoint(): string {\n    return this.config.endpoint;\n  }\n\n  getConcurrency(): ExportConcurrencyMode {\n    return this.config.concurrency || 'single';\n  }\n\n  async export(format: ExportFormat, grid: DataGrid): Promise<void> {\n    if (!grid) {\n      throw new Error('datagrid instance is required');\n    }\n\n    const payload = buildDatagridExportRequest(grid, this.config, format);\n    payload.delivery = resolveDelivery(this.config, format);\n\n    let response: Response;\n    try {\n      response = await httpRequest(this.getEndpoint(), {\n        method: 'POST',\n        json: payload,\n        headers: {\n          'Accept': 'application/json,application/octet-stream',\n        },\n      });\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Network error during export';\n      notify(grid, 'error', message);\n      throw err; // Re-throw so core.ts finally block can clear loading state\n    }\n\n    if (response.status === 202) {\n      const result = (await response.json().catch(() => ({}))) as ExportAsyncResponse;\n      notify(grid, 'info', 'Export queued. You can download it when ready.');\n      const statusURL = result?.status_url || '';\n      if (statusURL) {\n        const downloadURL = resolveDownloadURL(result, statusURL);\n        try {\n          await pollExportStatus(statusURL, {\n            intervalMs: resolvePollIntervalMs(this.config),\n            timeoutMs: resolvePollTimeoutMs(this.config)\n          });\n          const downloadResponse = await httpRequest(downloadURL, {\n            method: 'GET',\n            headers: {\n              'Accept': 'application/octet-stream',\n            },\n          });\n          if (!downloadResponse.ok) {\n            const message = await readErrorMessage(downloadResponse);\n            notify(grid, 'error', message);\n            throw new Error(message);\n          }\n          await downloadExport(downloadResponse, payload.definition || payload.resource || 'export', payload.format);\n          notify(grid, 'success', 'Export ready.');\n          return;\n        } catch (err) {\n          const message = err instanceof Error ? err.message : 'Export failed';\n          notify(grid, 'error', message);\n          throw err;\n        }\n      }\n      if (result?.download_url) {\n        window.open(result.download_url, '_blank');\n        return;\n      }\n      return;\n    }\n\n    if (!response.ok) {\n      const message = await readErrorMessage(response);\n      notify(grid, 'error', message);\n      throw new Error(message); // Throw so core.ts finally block can clear loading state\n    }\n\n    await downloadExport(response, payload.definition || payload.resource || 'export', payload.format);\n    notify(grid, 'success', 'Export ready.');\n  }\n}\n\nfunction buildDatagridExportRequest(\n  grid: DataGrid,\n  config: GoCrudExportConfig,\n  format: ExportFormat\n): ExportPayload {\n  const normalizedFormat = normalizeFormat(format);\n  const selection = buildSelection(grid, config);\n  const columns = buildVisibleColumns(grid, config);\n  const queryParams = buildQueryParams(grid);\n  const query = buildQuery(queryParams);\n\n  const payload: ExportPayload = {\n    format: normalizedFormat,\n    query,\n    selection,\n    columns,\n    delivery: config.delivery || 'auto'\n  };\n\n  if (config.definition) {\n    payload.definition = config.definition;\n  }\n  if (config.resource) {\n    payload.resource = config.resource;\n  }\n  const sourceVariant = config.sourceVariant || config.variant;\n  if (sourceVariant) {\n    payload.source_variant = sourceVariant;\n  }\n\n  return payload;\n}\n\nfunction resolveDelivery(config: GoCrudExportConfig, format: ExportFormat): DeliveryMode {\n  if (config.delivery) {\n    return config.delivery;\n  }\n  const asyncFormats = config.asyncFormats && config.asyncFormats.length > 0\n    ? config.asyncFormats\n    : ['pdf'];\n  if (asyncFormats.includes(format)) {\n    return 'async';\n  }\n  return 'auto';\n}\n\nfunction resolvePollIntervalMs(config: GoCrudExportConfig): number {\n  const value = Number(config.statusPollIntervalMs);\n  if (Number.isFinite(value) && value > 0) {\n    return value;\n  }\n  return 2000;\n}\n\nfunction resolvePollTimeoutMs(config: GoCrudExportConfig): number {\n  const value = Number(config.statusPollTimeoutMs);\n  if (Number.isFinite(value) && value >= 0) {\n    return value;\n  }\n  return 300000;\n}\n\nfunction resolveDownloadURL(result: ExportAsyncResponse, statusURL: string): string {\n  if (result?.download_url) {\n    return result.download_url;\n  }\n  const base = statusURL.replace(/\\/+$/, '');\n  return `${base}/download`;\n}\n\nasync function pollExportStatus(\n  statusURL: string,\n  opts: { intervalMs: number; timeoutMs: number }\n): Promise<ExportStatusRecord> {\n  const started = Date.now();\n  const interval = Math.max(250, opts.intervalMs);\n\n  while (true) {\n    const response = await httpRequest(statusURL, {\n      method: 'GET',\n      headers: {\n        'Accept': 'application/json',\n      },\n    });\n    if (!response.ok) {\n      const message = await readErrorMessage(response);\n      throw new Error(message);\n    }\n    const record = (await response.json().catch(() => ({}))) as ExportStatusRecord;\n    const state = String(record?.state || '').toLowerCase();\n    if (state === 'completed') {\n      return record;\n    }\n    if (state === 'failed') {\n      throw new Error('Export failed');\n    }\n    if (state === 'canceled') {\n      throw new Error('Export canceled');\n    }\n    if (state === 'deleted') {\n      throw new Error('Export deleted');\n    }\n    if (opts.timeoutMs > 0 && Date.now() - started > opts.timeoutMs) {\n      throw new Error('Export status timed out');\n    }\n    await sleep(interval);\n  }\n}\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nfunction buildSelection(grid: DataGrid, config: GoCrudExportConfig): ExportSelection {\n  if (config.selection?.mode) {\n    return config.selection;\n  }\n  const selected = Array.from(grid.state.selectedRows || []);\n  const mode = selected.length > 0 ? 'ids' : 'all';\n  return {\n    mode,\n    ids: mode === 'ids' ? selected : []\n  };\n}\n\nfunction buildVisibleColumns(grid: DataGrid, config: GoCrudExportConfig): string[] {\n  if (Array.isArray(config.columns) && config.columns.length > 0) {\n    return config.columns.slice();\n  }\n  const hidden = grid.state?.hiddenColumns ? new Set(grid.state.hiddenColumns) : new Set<string>();\n  const order = Array.isArray(grid.state?.columnOrder) && grid.state.columnOrder.length > 0\n    ? grid.state.columnOrder\n    : grid.config.columns.map((col) => col.field);\n  return order.filter((field) => !hidden.has(field));\n}\n\nfunction buildQueryParams(grid: DataGrid): Record<string, any> {\n  const params: Record<string, any> = {};\n  const behaviors = grid.config.behaviors || {};\n\n  if (behaviors.pagination) {\n    Object.assign(params, behaviors.pagination.buildQuery(grid.state.currentPage, grid.state.perPage));\n  }\n  if (grid.state.search && behaviors.search) {\n    Object.assign(params, behaviors.search.buildQuery(grid.state.search));\n  }\n  if (grid.state.filters.length > 0 && behaviors.filter) {\n    Object.assign(params, behaviors.filter.buildFilters(grid.state.filters));\n  }\n  if (grid.state.sort.length > 0 && behaviors.sort) {\n    Object.assign(params, behaviors.sort.buildQuery(grid.state.sort));\n  }\n\n  return params;\n}\n\nfunction buildQuery(params: Record<string, any>): ExportQuery {\n  const query: ExportQuery = {};\n  const filters: ExportQueryFilter[] = [];\n\n  Object.entries(params).forEach(([key, value]) => {\n    if (value === null || value === undefined || value === '') {\n      return;\n    }\n    switch (key) {\n      case 'limit':\n        query.limit = toNumber(value);\n        return;\n      case 'offset':\n        query.offset = toNumber(value);\n        return;\n      case 'order':\n      case 'sort':\n        query.sort = parseSort(String(value));\n        return;\n      case 'q':\n      case 'search':\n        query.search = String(value);\n        return;\n      default:\n        break;\n    }\n\n    const { field, op } = splitFilterKey(key);\n    if (!field) {\n      return;\n    }\n    filters.push({ field, op, value });\n  });\n\n  if (filters.length > 0) {\n    query.filters = filters;\n  }\n\n  return query;\n}\n\nfunction splitFilterKey(key: string): { field: string; op: string } {\n  const parts = key.split('__');\n  const field = parts[0]?.trim() || '';\n  const op = parts[1]?.trim() || 'eq';\n  return { field, op };\n}\n\nfunction parseSort(raw: string): ExportQuerySort[] {\n  if (!raw) return [];\n  return raw\n    .split(',')\n    .map((chunk) => chunk.trim())\n    .filter(Boolean)\n    .map((chunk) => {\n      const parts = chunk.split(/\\s+/);\n      const field = parts[0] || '';\n      const direction = parts[1] || 'asc';\n      return { field, desc: direction.toLowerCase() === 'desc' };\n    })\n    .filter((item) => item.field);\n}\n\nfunction normalizeFormat(format: ExportFormat): string {\n  const value = String(format || '').trim().toLowerCase();\n  if (value === 'excel' || value === 'xls') {\n    return 'xlsx';\n  }\n  return value || 'csv';\n}\n\nfunction toNumber(value: any): number {\n  const parsed = Number(value);\n  return Number.isFinite(parsed) ? parsed : 0;\n}\n\nasync function downloadExport(response: Response, definition: string, format: string): Promise<void> {\n  const blob = await response.blob();\n  const filename = resolveFilename(response, definition, format);\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.rel = 'noopener';\n  document.body.appendChild(link);\n  link.click();\n  link.remove();\n  URL.revokeObjectURL(url);\n}\n\nfunction resolveFilename(response: Response, definition: string, format: string): string {\n  const header = response.headers.get('content-disposition') || '';\n  const fallback = `${definition}.${format}`;\n  const filename = parseFilename(header);\n  return filename || fallback;\n}\n\nfunction parseFilename(header: string): string | null {\n  if (!header) return null;\n  const utfMatch = header.match(/filename\\*=(?:UTF-8'')?([^;]+)/i);\n  if (utfMatch && utfMatch[1]) {\n    return decodeURIComponent(utfMatch[1].replace(/\"/g, '').trim());\n  }\n  const match = header.match(/filename=\"?([^\";]+)\"?/i);\n  if (match && match[1]) {\n    return match[1].trim();\n  }\n  return null;\n}\n\nasync function readErrorMessage(response: Response): Promise<string> {\n  const contentType = response.headers.get('content-type') || '';\n  if (contentType.includes('application/json')) {\n    const payload = await response.json().catch(() => ({}));\n    if (payload?.error?.message) {\n      return payload.error.message;\n    }\n    if (payload?.message) {\n      return payload.message;\n    }\n  }\n  const text = await response.text().catch(() => '');\n  if (text) {\n    return text;\n  }\n  return `Export failed (${response.status})`;\n}\n\nfunction notify(grid: DataGrid, type: 'info' | 'success' | 'error', message: string): void {\n  const notifier = grid.config.notifier as any;\n  if (notifier && typeof notifier[type] === 'function') {\n    notifier[type](message);\n    return;\n  }\n  const toast = (window as any).toastManager;\n  if (toast && typeof toast[type] === 'function') {\n    toast[type](message);\n    return;\n  }\n  if (type === 'error') {\n    alert(message);\n  }\n}\n","import type { BulkActionBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\nimport { httpRequest, readHTTPError } from '../../shared/transport/http-client.js';\n\n/**\n * go-crud bulk action behavior\n * Uses custom action endpoints for bulk operations\n */\nexport class GoCrudBulkActionBehavior implements BulkActionBehavior {\n  constructor(private baseEndpoint: string) {}\n\n  getActionEndpoint(action: string): string {\n    // Bulk action endpoint pattern: /admin/crud/users/bulk/{action}\n    const plural = this.getPluralEndpoint();\n    return `${plural}/bulk/${action}`;\n  }\n\n  private getPluralEndpoint(): string {\n    // If baseEndpoint ends with singular form, convert to plural\n    if (this.baseEndpoint.endsWith('s')) {\n      return this.baseEndpoint;\n    }\n    return `${this.baseEndpoint}s`;\n  }\n\n  async execute(action: string, ids: string[], grid: DataGrid): Promise<void> {\n    const endpoint = this.getActionEndpoint(action);\n\n    const response = await httpRequest(endpoint, {\n      method: 'POST',\n      json: { ids },\n      accept: 'application/json',\n    });\n\n    if (!response.ok) {\n      const errorText = await readHTTPError(response, `Bulk action '${action}' failed`);\n      throw new Error(`Bulk action '${action}' failed: ${errorText}`);\n    }\n\n    // Refresh grid after successful bulk action\n    await grid.refresh();\n  }\n}\n","import type { ColumnVisibilityBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\nimport { httpRequest } from '../../shared/transport/http-client.js';\n\n/**\n * Legacy V1 storage format (visibility only)\n */\ntype ColumnPrefsV1 = Record<string, boolean>;\n\n/**\n * V2 storage format (visibility + order)\n */\ninterface ColumnPrefsV2 {\n  version: 2;\n  visibility: Record<string, boolean>;\n  order?: string[];\n}\n\nfunction normalizeBasePath(basePath?: string): string {\n  const trimmed = (basePath || '').trim();\n  if (!trimmed || trimmed === '/') return '';\n  return '/' + trimmed.replace(/^\\/+|\\/+$/g, '');\n}\n\nfunction normalizeApiBasePath(apiBasePath?: string): string {\n  const trimmed = (apiBasePath || '').trim();\n  if (!trimmed || trimmed === '/') return '';\n  return trimmed.replace(/\\/+$/, '');\n}\n\n/**\n * Type guard to check if prefs are V2 format\n */\nfunction isV2Prefs(data: unknown): data is ColumnPrefsV2 {\n  return (\n    typeof data === 'object' &&\n    data !== null &&\n    'version' in data &&\n    (data as ColumnPrefsV2).version === 2\n  );\n}\n\n/**\n * Default column visibility behavior\n * Stores state in localStorage as a cache, but DataGrid.state.hiddenColumns is the single source of truth\n *\n * Storage schema (V2):\n * {\n *   version: 2,\n *   visibility: { email: true, username: true, ... },\n *   order: [\"email\", \"username\", \"status\", ...]\n * }\n *\n * Migrates automatically from V1 format (Record<string, boolean>)\n */\nexport class DefaultColumnVisibilityBehavior implements ColumnVisibilityBehavior {\n  protected storageKey: string;\n  private cachedOrder: string[] | null = null;\n\n  constructor(\n    initialColumns: string[],\n    storageKey: string = 'datatable_columns'\n  ) {\n    this.storageKey = storageKey;\n  }\n\n  /**\n   * Get visible columns from grid state (single source of truth)\n   */\n  getVisibleColumns(grid: DataGrid): string[] {\n    return grid.config.columns\n      .filter(col => !grid.state.hiddenColumns.has(col.field))\n      .map(col => col.field);\n  }\n\n  /**\n   * Toggle column visibility based on current grid state\n   * Preserves column order when writing visibility updates\n   */\n  toggleColumn(field: string, grid: DataGrid): void {\n    // Read current state from grid (single source of truth)\n    const currentlyVisible = !grid.state.hiddenColumns.has(field);\n\n    // Compute new visible columns\n    const newVisibleColumns = grid.config.columns\n      .filter(col => {\n        if (col.field === field) {\n          return !currentlyVisible; // Toggle the clicked field\n        }\n        return !grid.state.hiddenColumns.has(col.field); // Keep others as-is\n      })\n      .map(col => col.field);\n\n    // Build visibility map\n    const visibility: Record<string, boolean> = {};\n    grid.config.columns.forEach(col => {\n      visibility[col.field] = newVisibleColumns.includes(col.field);\n    });\n\n    // Save to localStorage preserving existing order\n    // Use cached order if available, otherwise use current grid column order\n    const currentOrder = this.cachedOrder || grid.state.columnOrder;\n    this.savePrefs({\n      version: 2,\n      visibility,\n      order: currentOrder.length > 0 ? currentOrder : undefined\n    });\n\n    // Update grid (which will sync checkboxes automatically)\n    grid.updateColumnVisibility(newVisibleColumns);\n  }\n\n  /**\n   * Reorder columns and persist to storage\n   * Stores both visibility and order in V2 format\n   */\n  reorderColumns(order: string[], grid: DataGrid): void {\n    // Build visibility map from current grid state\n    const visibility: Record<string, boolean> = {};\n    grid.config.columns.forEach(col => {\n      visibility[col.field] = !grid.state.hiddenColumns.has(col.field);\n    });\n\n    // Update cached order\n    this.cachedOrder = order;\n\n    // Save V2 prefs with both visibility and order\n    this.savePrefs({\n      version: 2,\n      visibility,\n      order\n    });\n\n    console.log('[ColumnVisibility] Order saved:', order);\n  }\n\n  /**\n   * Load column order from cache (localStorage)\n   * Validates order against current columns (drops missing, doesn't append new)\n   * New columns are appended by DataGrid.mergeColumnOrder()\n   */\n  loadColumnOrderFromCache(allColumns: string[]): string[] {\n    try {\n      const prefs = this.loadPrefs();\n      if (!prefs || !prefs.order) {\n        return [];\n      }\n\n      // Validate: keep only columns that exist in allColumns\n      const validColumns = new Set(allColumns);\n      const validOrder = prefs.order.filter(field => validColumns.has(field));\n\n      // Cache the loaded order for future saves\n      this.cachedOrder = validOrder;\n\n      console.log('[ColumnVisibility] Order loaded from cache:', validOrder);\n      return validOrder;\n    } catch (e) {\n      console.warn('Failed to load column order from cache:', e);\n      return [];\n    }\n  }\n\n  /**\n   * Load saved visibility state from localStorage\n   * Returns hiddenColumns Set to be merged with URL state\n   * Handles both V1 and V2 formats (migrates V1 automatically)\n   * Filters out stale columns that no longer exist in allColumns\n   */\n  loadHiddenColumnsFromCache(allColumns: string[]): Set<string> {\n    try {\n      const prefs = this.loadPrefs();\n      if (!prefs) return new Set();\n\n      // Build set of valid columns to filter stale entries\n      const validColumns = new Set(allColumns);\n\n      // Return hidden columns (visible=false), filtered against valid columns\n      const hidden = new Set<string>();\n      Object.entries(prefs.visibility).forEach(([field, visible]) => {\n        // Only include if column still exists and is hidden\n        if (!visible && validColumns.has(field)) {\n          hidden.add(field);\n        }\n      });\n\n      return hidden;\n    } catch (e) {\n      console.warn('Failed to load column visibility state:', e);\n      return new Set();\n    }\n  }\n\n  /**\n   * Load preferences from localStorage with V1->V2 migration\n   */\n  protected loadPrefs(): ColumnPrefsV2 | null {\n    try {\n      const saved = localStorage.getItem(this.storageKey);\n      if (!saved) return null;\n\n      const data = JSON.parse(saved);\n\n      // Check if V2 format\n      if (isV2Prefs(data)) {\n        return data;\n      }\n\n      // Migrate V1 format (Record<string, boolean>) to V2\n      const v1Data = data as ColumnPrefsV1;\n      const migratedPrefs: ColumnPrefsV2 = {\n        version: 2,\n        visibility: v1Data\n        // order is undefined - will be populated on first reorder\n      };\n\n      // Save migrated prefs back to storage\n      console.log('[ColumnVisibility] Migrating V1 prefs to V2 format');\n      this.savePrefs(migratedPrefs);\n\n      return migratedPrefs;\n    } catch (e) {\n      console.warn('Failed to load column preferences:', e);\n      return null;\n    }\n  }\n\n  /**\n   * Save V2 preferences to localStorage\n   */\n  protected savePrefs(prefs: ColumnPrefsV2): void {\n    try {\n      localStorage.setItem(this.storageKey, JSON.stringify(prefs));\n    } catch (e) {\n      console.warn('Failed to save column preferences:', e);\n    }\n  }\n\n  /**\n   * Clear saved preferences from localStorage\n   * Called when user clicks \"Reset to Default\"\n   */\n  clearSavedPrefs(): void {\n    try {\n      localStorage.removeItem(this.storageKey);\n      this.cachedOrder = null;\n      console.log('[ColumnVisibility] Preferences cleared');\n    } catch (e) {\n      console.warn('Failed to clear column preferences:', e);\n    }\n  }\n}\n\n/**\n * Server-synced column visibility behavior configuration\n */\nexport interface ServerColumnVisibilityConfig {\n  /** Resource name for the preference key (e.g., 'users' -> 'ui.datagrid.users.columns') */\n  resource: string;\n  /** Base path for the preferences API (used when preferencesEndpoint is omitted) */\n  basePath?: string;\n  /** Full API base path (preferred when using versioned admin APIs) */\n  apiBasePath?: string;\n  /** Full preferences collection endpoint (defaults to '/api/panels/preferences') */\n  preferencesEndpoint?: string;\n  /** localStorage key for local cache (default: '<resource>_datatable_columns') */\n  localStorageKey?: string;\n  /** Debounce delay in ms for server sync (default: 1000) */\n  syncDebounce?: number;\n}\n\n/**\n * Server-synced column visibility behavior\n *\n * Extends DefaultColumnVisibilityBehavior with server persistence:\n * - On reorder/toggle, saves to localStorage immediately (fast) and syncs to server (durable)\n * - On init, can hydrate from server preferences before DataGrid starts\n *\n * Server preference key format: `ui.datagrid.<resource>.columns`\n * Server payload format: { raw: { \"ui.datagrid.<resource>.columns\": <V2 prefs> } }\n */\nexport class ServerColumnVisibilityBehavior extends DefaultColumnVisibilityBehavior {\n  private resource: string;\n  private preferencesEndpoint: string;\n  private syncDebounce: number;\n  private syncTimeout: ReturnType<typeof setTimeout> | null = null;\n  private serverPrefs: ColumnPrefsV2 | null = null;\n\n  constructor(initialColumns: string[], config: ServerColumnVisibilityConfig) {\n    const localStorageKey = config.localStorageKey || `${config.resource}_datatable_columns`;\n    super(initialColumns, localStorageKey);\n\n    this.resource = config.resource;\n    const basePath = normalizeBasePath(config.basePath);\n    const apiBasePath = normalizeApiBasePath(config.apiBasePath);\n    if (config.preferencesEndpoint) {\n      this.preferencesEndpoint = config.preferencesEndpoint;\n    } else if (apiBasePath) {\n      this.preferencesEndpoint = `${apiBasePath}/panels/preferences`;\n    } else if (basePath) {\n      this.preferencesEndpoint = `${basePath}/api/panels/preferences`;\n    } else {\n      this.preferencesEndpoint = '/api/panels/preferences';\n    }\n    this.syncDebounce = config.syncDebounce ?? 1000;\n  }\n\n  /**\n   * Get the server preference key for this resource\n   */\n  private get serverPrefsKey(): string {\n    return `ui.datagrid.${this.resource}.columns`;\n  }\n\n  /**\n   * Toggle column visibility and sync to server\n   */\n  override toggleColumn(field: string, grid: DataGrid): void {\n    // Call parent to update localStorage immediately\n    super.toggleColumn(field, grid);\n\n    // Schedule server sync\n    this.scheduleServerSync(grid);\n  }\n\n  /**\n   * Reorder columns and sync to server\n   */\n  override reorderColumns(order: string[], grid: DataGrid): void {\n    // Call parent to update localStorage immediately\n    super.reorderColumns(order, grid);\n\n    // Schedule server sync\n    this.scheduleServerSync(grid);\n  }\n\n  /**\n   * Load preferences from server\n   * Call this before DataGrid.init() to hydrate state from server\n   * Returns the V2 prefs if found, null otherwise\n   */\n  async loadFromServer(): Promise<ColumnPrefsV2 | null> {\n    try {\n      const response = await httpRequest(this.preferencesEndpoint, {\n        method: 'GET',\n        credentials: 'same-origin',\n        headers: {\n          'Accept': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        console.warn('[ServerColumnVisibility] Failed to load server prefs:', response.status);\n        return null;\n      }\n\n      const data = await response.json();\n\n      // Server response format: { records: [{ raw: { \"ui.datagrid.users.columns\": {...} } }] }\n      const records = data.records || [];\n      if (records.length === 0) {\n        console.log('[ServerColumnVisibility] No server preferences found');\n        return null;\n      }\n\n      const rawPrefs = records[0]?.raw;\n      if (!rawPrefs || !rawPrefs[this.serverPrefsKey]) {\n        console.log('[ServerColumnVisibility] No column preferences in server response');\n        return null;\n      }\n\n      const serverPrefs = rawPrefs[this.serverPrefsKey];\n\n      // Validate it's V2 format\n      if (!isV2Prefs(serverPrefs)) {\n        console.warn('[ServerColumnVisibility] Server prefs not in V2 format:', serverPrefs);\n        return null;\n      }\n\n      // Cache server prefs\n      this.serverPrefs = serverPrefs;\n\n      // Store as local cache so DataGrid can restore synchronously on init.\n      this.savePrefs(serverPrefs);\n\n      console.log('[ServerColumnVisibility] Loaded prefs from server:', serverPrefs);\n      return serverPrefs;\n    } catch (e) {\n      console.warn('[ServerColumnVisibility] Error loading server prefs:', e);\n      return null;\n    }\n  }\n\n  /**\n   * Get initial column prefs (server takes precedence over localStorage)\n   * Call this after loadFromServer() to get the prefs to use\n   */\n  getInitialPrefs(allColumns: string[]): { hiddenColumns: Set<string>; columnOrder: string[] } {\n    // Use server prefs if available, otherwise fall back to localStorage\n    const prefs = this.serverPrefs;\n\n    if (prefs) {\n      // Build hidden columns set from server prefs\n      const hidden = new Set<string>();\n      Object.entries(prefs.visibility).forEach(([field, visible]) => {\n        if (!visible) {\n          hidden.add(field);\n        }\n      });\n\n      // Validate order against current columns\n      const validColumns = new Set(allColumns);\n      const validOrder = (prefs.order || []).filter(field => validColumns.has(field));\n\n      return {\n        hiddenColumns: hidden,\n        columnOrder: validOrder\n      };\n    }\n\n    // Fall back to localStorage via parent methods\n    return {\n      hiddenColumns: this.loadHiddenColumnsFromCache(allColumns),\n      columnOrder: this.loadColumnOrderFromCache(allColumns)\n    };\n  }\n\n  /**\n   * Schedule a debounced sync to server\n   */\n  private scheduleServerSync(grid: DataGrid): void {\n    // Clear existing timeout\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n    }\n\n    // Schedule new sync\n    this.syncTimeout = setTimeout(() => {\n      this.syncToServer(grid);\n    }, this.syncDebounce);\n  }\n\n  /**\n   * Sync current preferences to server\n   */\n  private async syncToServer(grid: DataGrid): Promise<void> {\n    // Build V2 prefs from current grid state\n    const visibility: Record<string, boolean> = {};\n    grid.config.columns.forEach(col => {\n      visibility[col.field] = !grid.state.hiddenColumns.has(col.field);\n    });\n\n    const prefs: ColumnPrefsV2 = {\n      version: 2,\n      visibility,\n      order: grid.state.columnOrder.length > 0 ? grid.state.columnOrder : undefined\n    };\n\n    try {\n      const response = await httpRequest(this.preferencesEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        json: {\n          raw: {\n            [this.serverPrefsKey]: prefs,\n          },\n        },\n      });\n\n      if (!response.ok) {\n        console.warn('[ServerColumnVisibility] Failed to sync to server:', response.status);\n        return;\n      }\n\n      // Update cached server prefs\n      this.serverPrefs = prefs;\n\n      console.log('[ServerColumnVisibility] Synced prefs to server:', prefs);\n    } catch (e) {\n      console.warn('[ServerColumnVisibility] Error syncing to server:', e);\n    }\n  }\n\n  /**\n   * Clear saved preferences from both localStorage and server\n   * Called when user clicks \"Reset to Default\"\n   */\n  override clearSavedPrefs(): void {\n    // Clear localStorage\n    super.clearSavedPrefs();\n\n    // Clear server prefs\n    this.serverPrefs = null;\n\n    // Clear server prefs by sending empty/null value\n    this.clearServerPrefs();\n  }\n\n  /**\n   * Clear preferences on server\n   */\n  private async clearServerPrefs(): Promise<void> {\n    try {\n      const response = await httpRequest(this.preferencesEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        json: {\n          raw: {\n            [this.serverPrefsKey]: null,\n          },\n        },\n      });\n\n      if (!response.ok) {\n        console.warn('[ServerColumnVisibility] Failed to clear server prefs:', response.status);\n        return;\n      }\n\n      console.log('[ServerColumnVisibility] Server prefs cleared');\n    } catch (e) {\n      console.warn('[ServerColumnVisibility] Error clearing server prefs:', e);\n    }\n  }\n}\n","/**\n * Lazy payload modal proxy.\n *\n * Keeps payload modal code out of the main datatable chunk while exposing\n * a stable PayloadInputModal API for callers that patch prompt() in tests.\n */\nexport const PayloadInputModal = {\n  async prompt(\n    config: import('./payload-modal.js').PayloadModalConfig\n  ): Promise<Record<string, string> | null> {\n    const { PayloadInputModal: Modal } = await import('./payload-modal.js');\n    return Modal.prompt(config);\n  },\n};\n","/**\n * Schema-Driven Actions for DataGrid\n *\n * Builds row actions from server-provided schema.actions,\n * with fallback to default view/edit/delete when absent.\n *\n * Design decisions (per CONTENT_TRANSLATION_TDD.md):\n * - Schema actions are authoritative when present\n * - Default actions (view/edit/delete) are fallback only\n * - Duplicate prevention by action name\n * - Deterministic precedence: schema > defaults\n */\n\nimport type { ActionButton, ActionVariant } from './actions.js';\nimport {\n  executeActionRequest,\n  formatStructuredErrorForDisplay,\n  extractTranslationBlocker,\n  isTranslationBlocker,\n  type StructuredError,\n} from '../toast/error-helpers.js';\nimport { getDisabledReasonDisplay } from './translation-status-vocabulary.js';\nimport { PayloadInputModal } from './payload-modal-lazy.js';\n\n// ============================================================================\n// Schema Action Types\n// ============================================================================\n\n/**\n * Schema action definition from server (schema.actions[*])\n */\nexport interface SchemaAction {\n  /** Unique action identifier */\n  name: string;\n  /** Display label */\n  label?: string;\n  /** i18n label key */\n  label_key?: string;\n  /** Command name for command-backed actions */\n  command_name?: string;\n  /** Confirmation message (if action requires confirmation) */\n  confirm?: string;\n  /** Action visual variant */\n  variant?: 'primary' | 'secondary' | 'danger' | 'success' | 'warning';\n  /** Icon identifier */\n  icon?: string;\n  /** Required payload fields (legacy boolean is also tolerated) */\n  payload_required?: string[] | boolean;\n  /** JSON Schema for payload */\n  payload_schema?: PayloadSchema | Record<string, unknown>;\n  /** Action type hint (navigation vs POST) */\n  type?: 'navigation' | 'action';\n  /** Target URL pattern for navigation actions */\n  href?: string;\n  /** Scope where this action is valid */\n  scope?: 'all' | 'row' | 'detail' | 'bulk';\n  /** Record fields required to render/execute this action in a given context */\n  context_required?: string[];\n  /** Permission required for this action */\n  permission?: string;\n  /** Server-authoritative display order (lower numbers appear first) */\n  order?: number;\n}\n\nexport interface ActionState {\n  enabled?: boolean;\n  reason?: string;\n  reason_code?: string;\n  available_transitions?: string[];\n}\n\n/**\n * Payload schema for actions requiring input\n */\nexport interface PayloadSchema {\n  type?: string;\n  required?: string[];\n  properties?: Record<string, PayloadSchemaProperty>;\n  'x-translation-context'?: Record<string, unknown>;\n  x_translation_context?: Record<string, unknown>;\n}\n\nexport interface PayloadSchemaProperty {\n  type?: string;\n  title?: string;\n  description?: string;\n  default?: unknown;\n  enum?: unknown[];\n  oneOf?: PayloadSchemaOption[];\n}\n\nexport interface PayloadSchemaOption {\n  const?: unknown;\n  title?: string;\n}\n\n// ============================================================================\n// Schema Action Builder Configuration\n// ============================================================================\n\n/**\n * Configuration for building schema-driven actions\n */\nexport interface SchemaActionBuilderConfig {\n  /** Base path for action API endpoint (e.g., /admin/api/panels/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation actions (e.g., /admin/content/pages) */\n  actionBasePath: string;\n  /** Current locale context (passed to action payloads) */\n  locale?: string;\n  /** Current environment context (passed to action payloads) */\n  environment?: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Callback for handling translation blockers */\n  onTranslationBlocker?: (info: TranslationBlockerContext) => void;\n  /** Callback after successful action execution */\n  onActionSuccess?: (actionName: string, result: ActionResult) => void;\n  /** Callback after action error */\n  onActionError?: (actionName: string, error: StructuredError) => void;\n  /** Whether to use default actions as fallback (default: true) */\n  useDefaultFallback?: boolean;\n  /** Explicit compatibility mode: append defaults even with schema actions */\n  appendDefaultActions?: boolean;\n  /** Action rendering context (DataGrid row actions use 'row') */\n  actionContext?: 'row' | 'detail' | 'bulk';\n  /** Optional client-side action order override (action name -> order) */\n  actionOrderOverride?: Record<string, number>;\n}\n\n/**\n * Result from action execution\n */\nexport interface ActionResult {\n  success: boolean;\n  data?: Record<string, unknown>;\n  error?: StructuredError;\n}\n\n/**\n * Context for translation blocker handling\n */\nexport interface TranslationBlockerContext {\n  actionName: string;\n  recordId: string;\n  missingLocales: string[];\n  missingFieldsByLocale: Record<string, string[]> | null;\n  transition: string | null;\n  entityType: string | null;\n  requestedLocale: string | null;\n  environment: string | null;\n  retry?: () => Promise<ActionResult>;\n}\n\n// ============================================================================\n// Schema Action Builder\n// ============================================================================\n\n// ============================================================================\n// Action Ordering Constants\n// ============================================================================\n\n/**\n * Stable fallback order map for common actions.\n * Used when server doesn't provide explicit order.\n * Lower numbers appear first.\n */\nconst STABLE_ACTION_ORDER: Record<string, number> = {\n  view: 100,\n  edit: 200,\n  duplicate: 300,\n  create_translation: 400,\n  publish: 500,\n  unpublish: 600,\n  submit: 700,\n  approve: 800,\n  reject: 900,\n  archive: 1000,\n  restore: 1100,\n  delete: 9000, // Destructive actions last\n};\n\n/** Default order for unknown actions (before destructive actions) */\nconst DEFAULT_ACTION_ORDER = 5000;\n\n/** Maximum order value for insertion-order tie-breaking */\nconst MAX_ORDER = 10000;\n\n/**\n * Internal wrapper for action with ordering metadata\n */\ninterface OrderedAction {\n  action: ActionButton;\n  name: string;\n  order: number;\n  insertionIndex: number;\n}\n\n/**\n * Builds row actions from schema.actions with proper precedence and deduplication.\n *\n * Rules:\n * 1. Navigation actions (view, edit): build navigation URLs\n * 2. Delete action: existing delete flow\n * 3. All other schema actions: POST to /admin/api/panels/{panel}/actions/{action.name}\n * 4. Duplicate prevention by action name\n * 5. Schema actions take precedence over defaults\n * 6. Action ordering precedence: schema.order > actionOrderOverride > stable fallback > insertion\n */\nexport class SchemaActionBuilder {\n  private config: SchemaActionBuilderConfig;\n  private seenActions: Set<string> = new Set();\n\n  constructor(config: SchemaActionBuilderConfig) {\n    this.config = {\n      useDefaultFallback: true,\n      appendDefaultActions: false,\n      actionContext: 'row',\n      ...config,\n    };\n  }\n\n  /**\n   * Build row actions for a record from schema.actions\n   *\n   * @param record - The data record\n   * @param schemaActions - Actions from schema.actions (may be undefined)\n   * @returns Array of ActionButton for rendering\n   */\n  buildRowActions(record: Record<string, unknown>, schemaActions?: SchemaAction[]): ActionButton[] {\n    this.seenActions.clear();\n    const orderedActions: OrderedAction[] = [];\n    let insertionIndex = 0;\n\n    // Build URL query context\n    const queryContext = this.buildQueryContext();\n\n    // If schema actions exist, use them as authoritative source\n    if (Array.isArray(schemaActions) && schemaActions.length > 0) {\n      for (const schemaAction of schemaActions) {\n        if (!schemaAction.name) continue;\n        if (!this.shouldIncludeAction(record, schemaAction)) continue;\n\n        // Skip duplicates\n        const actionKey = schemaAction.name.toLowerCase();\n        if (this.seenActions.has(actionKey)) continue;\n        this.seenActions.add(actionKey);\n\n        const actionState = this.resolveRecordActionState(record, schemaAction.name);\n        const actionButton = this.buildActionFromSchema(record, schemaAction, queryContext, actionState);\n        if (actionButton) {\n          orderedActions.push({\n            action: actionButton,\n            name: schemaAction.name,\n            order: this.resolveActionOrder(schemaAction.name, schemaAction.order),\n            insertionIndex: insertionIndex++,\n          });\n        }\n      }\n\n      // Only append defaults if explicitly requested (compatibility mode)\n      if (this.config.appendDefaultActions) {\n        this.appendDefaultActionsOrdered(orderedActions, record, queryContext, insertionIndex);\n      }\n    } else if (this.config.useDefaultFallback) {\n      // No schema actions - use defaults as fallback\n      this.appendDefaultActionsOrdered(orderedActions, record, queryContext, insertionIndex);\n    }\n\n    // Sort actions by order (ascending), then by insertion index for tie-breaking\n    orderedActions.sort((a, b) => {\n      if (a.order !== b.order) {\n        return a.order - b.order;\n      }\n      return a.insertionIndex - b.insertionIndex;\n    });\n\n    return orderedActions.map((oa) => oa.action);\n  }\n\n  /**\n   * Resolve action order using precedence:\n   * 1. schema.actions[*].order (server authoritative)\n   * 2. actionOrderOverride (optional client override)\n   * 3. stable fallback map\n   * 4. default order\n   */\n  private resolveActionOrder(actionName: string, schemaOrder?: number): number {\n    // 1. Server-provided order takes highest precedence\n    if (typeof schemaOrder === 'number' && Number.isFinite(schemaOrder)) {\n      return schemaOrder;\n    }\n\n    const normalizedName = actionName.toLowerCase();\n\n    // 2. Client-side override\n    if (this.config.actionOrderOverride?.[normalizedName] !== undefined) {\n      return this.config.actionOrderOverride[normalizedName];\n    }\n\n    // 3. Stable fallback map\n    if (STABLE_ACTION_ORDER[normalizedName] !== undefined) {\n      return STABLE_ACTION_ORDER[normalizedName];\n    }\n\n    // 4. Default order for unknown actions\n    return DEFAULT_ACTION_ORDER;\n  }\n\n  /**\n   * Build a single action from schema definition\n   */\n  private buildActionFromSchema(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction,\n    queryContext: string,\n    actionState: ActionState | null\n  ): ActionButton | null {\n    const actionName = schemaAction.name;\n    const label = schemaAction.label || schemaAction.label_key || actionName;\n    const variant = (schemaAction.variant || 'secondary') as ActionVariant;\n    const icon = schemaAction.icon;\n\n    // Determine action type based on name or explicit type hint\n    const isNavigationAction = this.isNavigationAction(schemaAction);\n    const isDeleteAction = actionName === 'delete';\n\n    if (isNavigationAction) {\n      return this.applyActionState(\n        this.buildNavigationAction(record, schemaAction, label, variant, icon, queryContext),\n        actionState\n      );\n    }\n\n    if (isDeleteAction) {\n      return this.applyActionState(this.buildDeleteAction(record, label, variant, icon), actionState);\n    }\n\n    // All other actions: POST to panel action endpoint\n    return this.applyActionState(this.buildPostAction(record, schemaAction, label, variant, icon), actionState);\n  }\n\n  /**\n   * Check if action is a navigation action\n   */\n  private isNavigationAction(schemaAction: SchemaAction): boolean {\n    if (schemaAction.type === 'navigation') return true;\n    if (schemaAction.href) return true;\n\n    // Known navigation actions by name\n    const navActions = ['view', 'edit', 'show', 'details'];\n    return navActions.includes(schemaAction.name.toLowerCase());\n  }\n\n  private shouldIncludeAction(record: Record<string, unknown>, schemaAction: SchemaAction): boolean {\n    if (!this.matchesActionScope(schemaAction.scope)) {\n      return false;\n    }\n\n    const requiredContext = Array.isArray(schemaAction.context_required)\n      ? schemaAction.context_required\n      : [];\n    if (requiredContext.length === 0) {\n      return true;\n    }\n\n    for (const rawField of requiredContext) {\n      const field = typeof rawField === 'string' ? rawField.trim() : '';\n      if (!field) continue;\n      const value = this.resolveRecordContextValue(record, field);\n      if (this.isEmptyPayloadValue(value)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  private resolveRecordActionState(record: Record<string, unknown>, actionName: string): ActionState | null {\n    const rawState = record['_action_state'];\n    if (!rawState || typeof rawState !== 'object' || Array.isArray(rawState)) {\n      return null;\n    }\n    const perAction = (rawState as Record<string, unknown>)[actionName];\n    if (!perAction || typeof perAction !== 'object' || Array.isArray(perAction)) {\n      return null;\n    }\n    return perAction as ActionState;\n  }\n\n  private applyActionState(action: ActionButton, state: ActionState | null): ActionButton {\n    if (!state) {\n      return action;\n    }\n    if (state.enabled !== false) {\n      return action;\n    }\n    const disabledReason = this.disabledReason(state);\n    return {\n      ...action,\n      disabled: true,\n      disabledReason,\n    };\n  }\n\n  private disabledReason(state: ActionState): string {\n    const reason = typeof state.reason === 'string' ? state.reason.trim() : '';\n    if (reason) {\n      return reason;\n    }\n    const normalizedCode = typeof state.reason_code === 'string' ? state.reason_code.trim() : '';\n    if (normalizedCode) {\n      const shared = getDisabledReasonDisplay(normalizedCode);\n      if (shared?.message) {\n        return shared.message;\n      }\n    }\n    switch (normalizedCode.toLowerCase()) {\n      case 'workflow_transition_not_available':\n      case 'invalid_status':\n        return 'Action is not available in the current workflow state.';\n      case 'permission_denied':\n        return 'You do not have permission to execute this action.';\n      case 'missing_context_required':\n      case 'missing_context':\n        return 'Action is unavailable because required record context is missing.';\n      case 'translation_missing':\n        return 'Required translations are missing.';\n      case 'feature_disabled':\n        return 'This feature is currently disabled.';\n      default:\n        return 'Action is currently unavailable.';\n    }\n  }\n\n  private matchesActionScope(scope: SchemaAction['scope']): boolean {\n    const normalizedScope = typeof scope === 'string' ? scope.trim().toLowerCase() : '';\n    if (!normalizedScope || normalizedScope === 'all') {\n      return true;\n    }\n    const context = (this.config.actionContext || 'row').toLowerCase();\n    return normalizedScope === context;\n  }\n\n  private resolveRecordContextValue(record: Record<string, unknown>, path: string): unknown {\n    const normalizedPath = path.trim();\n    if (!normalizedPath) return undefined;\n    if (!normalizedPath.includes('.')) {\n      return record[normalizedPath];\n    }\n\n    const segments = normalizedPath.split('.').map((segment) => segment.trim()).filter(Boolean);\n    if (segments.length === 0) return undefined;\n\n    let cursor: unknown = record;\n    for (const segment of segments) {\n      if (!cursor || typeof cursor !== 'object' || Array.isArray(cursor)) {\n        return undefined;\n      }\n      cursor = (cursor as Record<string, unknown>)[segment];\n    }\n    return cursor;\n  }\n\n  /**\n   * Build navigation action (view, edit, etc.)\n   */\n  private buildNavigationAction(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction,\n    label: string,\n    variant: ActionVariant,\n    icon: string | undefined,\n    queryContext: string\n  ): ActionButton {\n    const recordId = String(record.id || '');\n    const basePath = this.config.actionBasePath;\n\n    // Determine target URL\n    let targetUrl: string;\n    if (schemaAction.href) {\n      // Use explicit href pattern, replacing {id} placeholder\n      targetUrl = schemaAction.href.replace('{id}', recordId);\n    } else if (schemaAction.name === 'edit') {\n      targetUrl = `${basePath}/${recordId}/edit`;\n    } else {\n      // Default: view\n      targetUrl = `${basePath}/${recordId}`;\n    }\n\n    // Append query context\n    if (queryContext) {\n      targetUrl += targetUrl.includes('?') ? `&${queryContext}` : `?${queryContext}`;\n    }\n\n    return {\n      id: schemaAction.name,\n      label,\n      icon: icon || this.getDefaultIcon(schemaAction.name),\n      variant,\n      action: () => {\n        window.location.href = targetUrl;\n      },\n    };\n  }\n\n  /**\n   * Build delete action with confirmation\n   */\n  private buildDeleteAction(\n    record: Record<string, unknown>,\n    label: string,\n    variant: ActionVariant,\n    icon: string | undefined\n  ): ActionButton {\n    const recordId = String(record.id || '');\n    const endpoint = this.config.apiEndpoint;\n\n    return {\n      id: 'delete',\n      label,\n      icon: icon || 'trash',\n      variant: variant === 'secondary' ? 'danger' : variant,\n      action: async () => {\n        const confirmed = window.confirm(`Are you sure you want to delete this item?`);\n        if (!confirmed) return;\n\n        const response = await fetch(`${endpoint}/${recordId}`, {\n          method: 'DELETE',\n          headers: { 'Accept': 'application/json' },\n        });\n\n        if (!response.ok) {\n          throw new Error('Delete failed');\n        }\n      },\n    };\n  }\n\n  /**\n   * Build POST action for workflow/panel actions\n   */\n  private buildPostAction(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction,\n    label: string,\n    variant: ActionVariant,\n    icon: string | undefined\n  ): ActionButton {\n    const recordId = String(record.id || '');\n    const actionName = schemaAction.name;\n    const endpoint = `${this.config.apiEndpoint}/actions/${actionName}`;\n\n    return {\n      id: actionName,\n      label,\n      icon: icon || this.getDefaultIcon(actionName),\n      variant,\n      action: async () => {\n        // Handle confirmation if required\n        if (schemaAction.confirm) {\n          const confirmed = window.confirm(schemaAction.confirm);\n          if (!confirmed) return;\n        }\n\n        // Build payload\n        const payload = await this.buildActionPayload(record, schemaAction);\n        if (payload === null) {\n          // User cancelled payload input\n          return;\n        }\n\n        await this.executePostAction({\n          actionName,\n          endpoint,\n          payload,\n          recordId,\n        });\n      },\n    };\n  }\n\n  private async executePostAction(input: {\n    actionName: string;\n    endpoint: string;\n    payload: Record<string, unknown>;\n    recordId: string;\n  }): Promise<ActionResult> {\n    const result = await executeActionRequest(input.endpoint, input.payload);\n\n    if (result.success) {\n      this.config.onActionSuccess?.(input.actionName, result);\n\n      // Post-create handoff for create_translation action\n      if (input.actionName.toLowerCase() === 'create_translation' && result.data) {\n        this.handleCreateTranslationSuccess(result.data, input.payload);\n      }\n\n      return result;\n    }\n\n    if (!result.error) {\n      return result;\n    }\n\n    // Translation blockers require a modal-first remediation flow with retry support.\n    if (isTranslationBlocker(result.error)) {\n      const blockerInfo = extractTranslationBlocker(result.error);\n      if (blockerInfo && this.config.onTranslationBlocker) {\n        const retryPayload = { ...input.payload };\n        this.config.onTranslationBlocker({\n          actionName: input.actionName,\n          recordId: input.recordId,\n          ...blockerInfo,\n          retry: async () => this.executePostAction({\n            actionName: input.actionName,\n            endpoint: input.endpoint,\n            payload: { ...retryPayload },\n            recordId: input.recordId,\n          }),\n        });\n        return { success: false, error: result.error };\n      }\n    }\n\n    const formattedMessage = this.buildActionErrorMessage(input.actionName, result.error);\n    this.config.onActionError?.(input.actionName, {\n      ...result.error,\n      message: formattedMessage,\n    });\n    throw new Error(formattedMessage);\n  }\n\n  /**\n   * Handle successful create_translation action:\n   * - Show success toast with source locale shortcut\n   * - Redirect to new locale edit page\n   */\n  private handleCreateTranslationSuccess(\n    data: Record<string, unknown>,\n    originalPayload: Record<string, unknown>\n  ): void {\n    // Extract new record info from response\n    const newId = typeof data.id === 'string' ? data.id : String(data.id || '');\n    const newLocale = typeof data.locale === 'string' ? data.locale : '';\n\n    if (!newId) {\n      console.warn('[SchemaActionBuilder] create_translation response missing id');\n      return;\n    }\n\n    // Build redirect URL to edit the new translation\n    const basePath = this.config.actionBasePath;\n    const params = new URLSearchParams();\n    if (newLocale) {\n      params.set('locale', newLocale);\n    }\n    if (this.config.environment) {\n      params.set('env', this.config.environment);\n    }\n    const queryString = params.toString();\n    const editUrl = `${basePath}/${newId}/edit${queryString ? `?${queryString}` : ''}`;\n\n    // Show success toast with source locale shortcut\n    const sourceLocale = typeof originalPayload.source_locale === 'string'\n      ? originalPayload.source_locale\n      : this.config.locale || 'source';\n    const localeLabel = this.localeLabel(newLocale || 'unknown');\n\n    // Use toast if available, otherwise console log\n    if (typeof window !== 'undefined' && 'toastManager' in window) {\n      const toastManager = (window as unknown as {\n        toastManager: { success: (msg: string, opts?: { action?: { label: string; handler: () => void } }) => void }\n      }).toastManager;\n\n      toastManager.success(`${localeLabel} translation created`, {\n        action: {\n          label: `View ${sourceLocale.toUpperCase()}`,\n          handler: () => {\n            // Navigate back to source locale\n            const sourceParams = new URLSearchParams();\n            sourceParams.set('locale', sourceLocale);\n            if (this.config.environment) {\n              sourceParams.set('env', this.config.environment);\n            }\n            const sourceId = typeof originalPayload.id === 'string'\n              ? originalPayload.id\n              : String(originalPayload.id || newId);\n            window.location.href = `${basePath}/${sourceId}/edit?${sourceParams.toString()}`;\n          },\n        },\n      });\n    } else {\n      console.log(`[SchemaActionBuilder] Translation created: ${newLocale}`);\n    }\n\n    // Redirect to new translation edit page\n    window.location.href = editUrl;\n  }\n\n  /**\n   * Build action payload from record and schema\n   */\n  private async buildActionPayload(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction\n  ): Promise<Record<string, unknown> | null> {\n    const normalizedActionName = schemaAction.name.trim().toLowerCase();\n    const payload: Record<string, unknown> = {\n      id: record.id,\n    };\n\n    // Add locale/environment context\n    if (this.config.locale && normalizedActionName !== 'create_translation') {\n      payload.locale = this.config.locale;\n    }\n    if (this.config.environment) {\n      payload.environment = this.config.environment;\n    }\n    if (this.config.panelName) {\n      payload.policy_entity = this.config.panelName;\n    }\n\n    const schema = this.normalizePayloadSchema(schemaAction.payload_schema);\n    const requiredFields = this.collectRequiredFields(schemaAction.payload_required, schema);\n    if (normalizedActionName === 'create_translation') {\n      this.applySchemaTranslationContext(payload, record, schema);\n    }\n\n    // Seed defaults from schema definitions.\n    if (schema?.properties) {\n      for (const [field, definition] of Object.entries(schema.properties)) {\n        if (payload[field] === undefined && definition.default !== undefined) {\n          payload[field] = definition.default;\n        }\n      }\n    }\n\n    // Generate idempotency_key for send-like actions when required but absent.\n    if (\n      requiredFields.includes('idempotency_key') &&\n      this.isEmptyPayloadValue(payload.idempotency_key)\n    ) {\n      payload.idempotency_key = this.generateIdempotencyKey(schemaAction.name, String(record.id || ''));\n    }\n\n    const missingRequired = requiredFields.filter((field) => this.isEmptyPayloadValue(payload[field]));\n    if (missingRequired.length === 0) {\n      return payload;\n    }\n\n    const promptedValues = await this.promptForPayload(schemaAction, missingRequired, schema, payload, record);\n    if (promptedValues === null) {\n      return null; // User cancelled\n    }\n\n    for (const field of missingRequired) {\n      const definition = schema?.properties?.[field];\n      const rawValue = promptedValues[field] ?? '';\n      const parsed = this.coercePromptValue(rawValue, field, definition);\n      if (parsed.error) {\n        throw new Error(parsed.error);\n      }\n      payload[field] = parsed.value;\n    }\n\n    return payload;\n  }\n\n  /**\n   * Prompt user for required payload values\n   * Uses the lazy payload modal proxy.\n   */\n  private async promptForPayload(\n    schemaAction: SchemaAction,\n    requiredFields: string[],\n    schema: PayloadSchema | null,\n    payload: Record<string, unknown>,\n    record?: Record<string, unknown>\n  ): Promise<Record<string, unknown> | null> {\n    if (requiredFields.length === 0) {\n      return {};\n    }\n\n    const fields = requiredFields.map((name) => {\n      const definition = schema?.properties?.[name];\n      return {\n        name,\n        label: definition?.title || name,\n        description: definition?.description,\n        value: this.stringifyDefault(payload[name] ?? definition?.default),\n        type: definition?.type || 'string',\n        options: this.buildFieldOptions(name, schemaAction.name, definition, record, payload),\n      };\n    });\n\n    const result = await PayloadInputModal.prompt({\n      title: `Complete ${schemaAction.label || schemaAction.name}`,\n      fields,\n    });\n\n    return result;\n  }\n\n  /**\n   * Build field options from schema property\n   */\n  private buildFieldOptions(\n    fieldName: string,\n    actionName: string,\n    prop: PayloadSchemaProperty | undefined,\n    record?: Record<string, unknown>,\n    payload?: Record<string, unknown>\n  ): Array<{ value: string; label: string }> | undefined {\n    const createTranslationOptions = this.deriveCreateTranslationLocaleOptions(fieldName, actionName, record, prop, payload);\n    if (createTranslationOptions && createTranslationOptions.length > 0) {\n      return createTranslationOptions;\n    }\n    if (!prop) {\n      return undefined;\n    }\n    if (prop.oneOf) {\n      return prop.oneOf\n        .filter(opt => opt && 'const' in opt)\n        .map(opt => ({\n          value: this.stringifyDefault(opt.const),\n          label: opt.title || this.stringifyDefault(opt.const),\n        }));\n    }\n\n    if (prop.enum) {\n      return prop.enum.map(val => ({\n        value: this.stringifyDefault(val),\n        label: this.stringifyDefault(val),\n      }));\n    }\n\n    const extensionOptions = this.buildExtensionFieldOptions(prop);\n    if (extensionOptions && extensionOptions.length > 0) {\n      return extensionOptions;\n    }\n    return undefined;\n  }\n\n  private buildExtensionFieldOptions(prop: PayloadSchemaProperty): Array<{ value: string; label: string }> | undefined {\n    const raw = prop as Record<string, unknown>;\n    const candidate =\n      raw['x-options'] ??\n      raw.x_options ??\n      raw.xOptions;\n    if (!Array.isArray(candidate) || candidate.length === 0) {\n      return undefined;\n    }\n\n    const options: Array<{ value: string; label: string }> = [];\n    for (const item of candidate) {\n      if (typeof item === 'string') {\n        const value = this.stringifyDefault(item);\n        if (!value) {\n          continue;\n        }\n        options.push({ value, label: value });\n        continue;\n      }\n      if (!item || typeof item !== 'object') {\n        continue;\n      }\n      const candidateValue = (item as Record<string, unknown>).value;\n      const value = this.stringifyDefault(candidateValue);\n      if (!value) {\n        continue;\n      }\n      const candidateLabel = (item as Record<string, unknown>).label;\n      const label = this.stringifyDefault(candidateLabel) || value;\n      options.push({ value, label });\n    }\n    return options.length > 0 ? options : undefined;\n  }\n\n  private deriveCreateTranslationLocaleOptions(\n    fieldName: string,\n    actionName: string,\n    record?: Record<string, unknown>,\n    prop?: PayloadSchemaProperty,\n    payload?: Record<string, unknown>\n  ): Array<{ value: string; label: string; description?: string; recommended?: boolean }> | undefined {\n    if (fieldName.trim().toLowerCase() !== 'locale') {\n      return undefined;\n    }\n    if (actionName.trim().toLowerCase() !== 'create_translation') {\n      return undefined;\n    }\n    if (!record || typeof record !== 'object') {\n      return undefined;\n    }\n\n    const readiness = this.asObject(record.translation_readiness);\n    const context = payload && typeof payload === 'object'\n      ? payload as Record<string, unknown>\n      : {};\n    let locales = this.asStringArray(context.missing_locales);\n    if (locales.length === 0) {\n      locales = this.asStringArray(readiness?.missing_required_locales);\n    }\n    if (locales.length === 0) {\n      locales = this.asStringArray((record as Record<string, unknown>).missing_locales);\n    }\n    if (locales.length === 0 && readiness) {\n      const required = this.asStringArray(readiness.required_locales);\n      const availableSet = new Set(this.asStringArray(readiness.available_locales));\n      locales = required.filter((locale) => !availableSet.has(locale));\n    }\n    const allowedLocales = this.asStringArray(prop?.enum);\n    if (allowedLocales.length > 0) {\n      const allowedSet = new Set(allowedLocales);\n      locales = locales.filter((locale) => allowedSet.has(locale));\n    }\n    if (locales.length === 0) {\n      return undefined;\n    }\n\n    // Extract context for hints\n    const recommendedLocale = this.extractStringField(context, 'recommended_locale')\n      || this.extractStringField(record, 'recommended_locale')\n      || this.extractStringField(readiness || {}, 'recommended_locale');\n    const requiredForPublish = this.asStringArray(\n      context.required_for_publish\n      ?? record.required_for_publish\n      ?? readiness?.required_for_publish\n      ?? readiness?.required_locales\n    );\n    const existingLocales = this.asStringArray(\n      context.existing_locales\n      ?? record.existing_locales\n      ?? readiness?.available_locales\n    );\n    const localizedLabels = this.createTranslationLocaleLabelMap(prop);\n\n    const seen = new Set<string>();\n    const options: Array<{ value: string; label: string; description?: string; recommended?: boolean }> = [];\n    for (const rawLocale of locales) {\n      const locale = rawLocale.trim().toLowerCase();\n      if (!locale || seen.has(locale)) {\n        continue;\n      }\n      seen.add(locale);\n\n      const isRecommended = recommendedLocale?.toLowerCase() === locale;\n      const isRequiredForPublish = requiredForPublish.includes(locale);\n\n      // Build description hint\n      const hints: string[] = [];\n      if (isRequiredForPublish) {\n        hints.push('Required for publishing');\n      }\n      if (existingLocales.length > 0) {\n        hints.push(`${existingLocales.length} translation${existingLocales.length > 1 ? 's' : ''} exist`);\n      }\n      const description = hints.length > 0 ? hints.join(' • ') : undefined;\n\n      // Build label with explicit format: \"FR - French (recommended)\"\n      const languageLabel = localizedLabels[locale] || this.localeLabel(locale);\n      let label = `${locale.toUpperCase()} - ${languageLabel}`;\n      if (isRecommended) {\n        label += ' (recommended)';\n      }\n\n      options.push({\n        value: locale,\n        label,\n        description,\n        recommended: isRecommended,\n      });\n    }\n\n    // Sort: recommended first, then alphabetically\n    options.sort((a, b) => {\n      if (a.recommended && !b.recommended) return -1;\n      if (!a.recommended && b.recommended) return 1;\n      return a.value.localeCompare(b.value);\n    });\n\n    return options.length > 0 ? options : undefined;\n  }\n\n  private applySchemaTranslationContext(\n    payload: Record<string, unknown>,\n    record: Record<string, unknown>,\n    schema: PayloadSchema | null\n  ): void {\n    if (!schema) {\n      return;\n    }\n    const context = this.extractTranslationContextMap(schema);\n    if (Object.keys(context).length === 0) {\n      return;\n    }\n    for (const [targetField, sourcePath] of Object.entries(context)) {\n      const target = targetField.trim();\n      const source = sourcePath.trim();\n      if (!target || !source) {\n        continue;\n      }\n      if (!this.isEmptyPayloadValue(payload[target])) {\n        continue;\n      }\n      const value = this.resolveRecordContextValue(record, source);\n      if (value === undefined || value === null) {\n        continue;\n      }\n      payload[target] = this.clonePayloadValue(value);\n    }\n  }\n\n  private extractTranslationContextMap(schema: PayloadSchema): Record<string, string> {\n    const raw = (schema['x-translation-context'] ?? schema.x_translation_context) as Record<string, unknown> | undefined;\n    if (!raw || typeof raw !== 'object' || Array.isArray(raw)) {\n      return {};\n    }\n    const out: Record<string, string> = {};\n    for (const [targetField, sourcePath] of Object.entries(raw)) {\n      const target = targetField.trim();\n      const source = typeof sourcePath === 'string' ? sourcePath.trim() : '';\n      if (!target || !source) {\n        continue;\n      }\n      out[target] = source;\n    }\n    return out;\n  }\n\n  private clonePayloadValue(value: unknown): unknown {\n    if (Array.isArray(value)) {\n      return value.map((entry) => this.clonePayloadValue(entry));\n    }\n    if (value && typeof value === 'object') {\n      return { ...(value as Record<string, unknown>) };\n    }\n    return value;\n  }\n\n  private createTranslationLocaleLabelMap(prop?: PayloadSchemaProperty): Record<string, string> {\n    const labels: Record<string, string> = {};\n    if (!prop) {\n      return labels;\n    }\n    if (Array.isArray(prop.oneOf)) {\n      for (const option of prop.oneOf) {\n        const value = this.stringifyDefault(option?.const).trim().toLowerCase();\n        if (!value) {\n          continue;\n        }\n        const label = this.stringifyDefault(option?.title).trim();\n        if (label) {\n          labels[value] = label;\n        }\n      }\n    }\n    const raw = prop as Record<string, unknown>;\n    const candidate = raw['x-options'] ?? raw.x_options ?? raw.xOptions;\n    if (Array.isArray(candidate)) {\n      for (const option of candidate) {\n        if (!option || typeof option !== 'object') {\n          continue;\n        }\n        const value = this.stringifyDefault((option as Record<string, unknown>).value).trim().toLowerCase();\n        const label = this.stringifyDefault((option as Record<string, unknown>).label).trim();\n        if (value && label) {\n          labels[value] = label;\n        }\n      }\n    }\n    return labels;\n  }\n\n  private extractStringField(record: Record<string, unknown>, field: string): string | null {\n    const value = record[field];\n    if (typeof value === 'string' && value.trim()) {\n      return value.trim();\n    }\n    return null;\n  }\n\n  private asObject(value: unknown): Record<string, unknown> | null {\n    if (!value || typeof value !== 'object' || Array.isArray(value)) {\n      return null;\n    }\n    return value as Record<string, unknown>;\n  }\n\n  private asStringArray(value: unknown): string[] {\n    if (!Array.isArray(value)) {\n      return [];\n    }\n    return value\n      .filter((entry): entry is string => typeof entry === 'string')\n      .map((entry) => entry.trim().toLowerCase())\n      .filter((entry) => entry.length > 0);\n  }\n\n  private localeLabel(locale: string): string {\n    const labels: Record<string, string> = {\n      en: 'English',\n      es: 'Spanish',\n      fr: 'French',\n      de: 'German',\n      it: 'Italian',\n      pt: 'Portuguese',\n    };\n    return labels[locale] || locale.toUpperCase();\n  }\n\n  /**\n   * Stringify default value for form input\n   */\n  private stringifyDefault(value: unknown): string {\n    if (value === undefined || value === null) return '';\n    if (typeof value === 'string') return value;\n    if (typeof value === 'object') {\n      try {\n        return JSON.stringify(value);\n      } catch {\n        return '';\n      }\n    }\n    return String(value);\n  }\n\n  private normalizePayloadSchema(schema: SchemaAction['payload_schema']): PayloadSchema | null {\n    if (!schema || typeof schema !== 'object') {\n      return null;\n    }\n\n    const propertiesRaw = (schema as Record<string, unknown>).properties;\n    let properties: Record<string, PayloadSchemaProperty> | undefined;\n    if (propertiesRaw && typeof propertiesRaw === 'object' && !Array.isArray(propertiesRaw)) {\n      properties = {};\n      for (const [key, value] of Object.entries(propertiesRaw as Record<string, unknown>)) {\n        if (value && typeof value === 'object' && !Array.isArray(value)) {\n          properties[key] = value as PayloadSchemaProperty;\n        }\n      }\n    }\n\n    const requiredRaw = (schema as Record<string, unknown>).required;\n    const required = Array.isArray(requiredRaw)\n      ? requiredRaw\n        .filter((field): field is string => typeof field === 'string')\n        .map((field) => field.trim())\n        .filter((field) => field.length > 0)\n      : undefined;\n\n    const translationContextRaw = (\n      (schema as Record<string, unknown>)['x-translation-context']\n      ?? (schema as Record<string, unknown>).x_translation_context\n    );\n    const translationContext = (\n      translationContextRaw\n      && typeof translationContextRaw === 'object'\n      && !Array.isArray(translationContextRaw)\n    )\n      ? translationContextRaw as Record<string, unknown>\n      : undefined;\n\n    return {\n      type: typeof (schema as Record<string, unknown>).type === 'string'\n        ? ((schema as Record<string, unknown>).type as string)\n        : undefined,\n      required,\n      properties,\n      ...(translationContext ? { 'x-translation-context': translationContext } : {}),\n    };\n  }\n\n  private collectRequiredFields(\n    payloadRequired: SchemaAction['payload_required'],\n    schema: PayloadSchema | null\n  ): string[] {\n    const ordered: string[] = [];\n    const seen = new Set<string>();\n    const append = (field: string): void => {\n      const name = field.trim();\n      if (!name || seen.has(name)) {\n        return;\n      }\n      seen.add(name);\n      ordered.push(name);\n    };\n\n    if (Array.isArray(payloadRequired)) {\n      payloadRequired.forEach((field) => append(String(field)));\n    }\n    if (Array.isArray(schema?.required)) {\n      schema.required.forEach((field) => append(String(field)));\n    }\n    return ordered;\n  }\n\n  private isEmptyPayloadValue(value: unknown): boolean {\n    if (value === null || value === undefined) {\n      return true;\n    }\n    if (typeof value === 'string') {\n      return value.trim() === '';\n    }\n    if (Array.isArray(value)) {\n      return value.length === 0;\n    }\n    if (typeof value === 'object') {\n      return Object.keys(value as Record<string, unknown>).length === 0;\n    }\n    return false;\n  }\n\n  private generateIdempotencyKey(actionName: string, recordId: string): string {\n    const safeAction = actionName.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    const safeRecord = recordId.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    const suffix = typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function'\n      ? crypto.randomUUID()\n      : `${Date.now()}-${Math.floor(Math.random() * 1_000_000)}`;\n    return `${safeAction || 'action'}-${safeRecord || 'record'}-${suffix}`;\n  }\n\n  private coercePromptValue(\n    rawValue: unknown,\n    field: string,\n    prop: PayloadSchemaProperty | undefined\n  ): { value: unknown; error?: string } {\n    const value = typeof rawValue === 'string' ? rawValue.trim() : String(rawValue ?? '').trim();\n    const type = typeof prop?.type === 'string' ? prop.type.toLowerCase() : 'string';\n\n    if (value.length === 0) {\n      return { value };\n    }\n\n    if (type === 'number' || type === 'integer') {\n      const parsed = Number(value);\n      if (!Number.isFinite(parsed)) {\n        return { value: null, error: `${field} must be a valid number` };\n      }\n      return { value: type === 'integer' ? Math.trunc(parsed) : parsed };\n    }\n\n    if (type === 'boolean') {\n      const normalized = value.toLowerCase();\n      if (normalized === 'true' || normalized === '1' || normalized === 'yes') {\n        return { value: true };\n      }\n      if (normalized === 'false' || normalized === '0' || normalized === 'no') {\n        return { value: false };\n      }\n      return { value: null, error: `${field} must be true or false` };\n    }\n\n    if (type === 'array' || type === 'object') {\n      try {\n        return { value: JSON.parse(value) };\n      } catch {\n        const expected = type === 'array' ? '[...]' : '{...}';\n        return { value: null, error: `${field} must be valid JSON (${expected})` };\n      }\n    }\n\n    return { value };\n  }\n\n  private buildActionErrorMessage(actionName: string, error: StructuredError): string {\n    return formatStructuredErrorForDisplay(error, `${actionName} failed`);\n  }\n\n  /**\n   * Build URL query context from locale/environment\n   */\n  private buildQueryContext(): string {\n    const params = new URLSearchParams();\n    if (this.config.locale) {\n      params.set('locale', this.config.locale);\n    }\n    if (this.config.environment) {\n      params.set('env', this.config.environment);\n    }\n    return params.toString();\n  }\n\n  /**\n   * Append default actions (view, edit, delete) avoiding duplicates\n   */\n  private appendDefaultActions(\n    actions: ActionButton[],\n    record: Record<string, unknown>,\n    queryContext: string\n  ): void {\n    const recordId = String(record.id || '');\n    const basePath = this.config.actionBasePath;\n    const apiEndpoint = this.config.apiEndpoint;\n\n    const defaults: Array<{ name: string; button: ActionButton }> = [\n      {\n        name: 'view',\n        button: {\n          id: 'view',\n          label: 'View',\n          icon: 'eye',\n          variant: 'secondary',\n          action: () => {\n            let url = `${basePath}/${recordId}`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'edit',\n        button: {\n          id: 'edit',\n          label: 'Edit',\n          icon: 'edit',\n          variant: 'primary',\n          action: () => {\n            let url = `${basePath}/${recordId}/edit`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'delete',\n        button: {\n          id: 'delete',\n          label: 'Delete',\n          icon: 'trash',\n          variant: 'danger',\n          action: async () => {\n            if (!window.confirm('Are you sure you want to delete this item?')) return;\n            const response = await fetch(`${apiEndpoint}/${recordId}`, {\n              method: 'DELETE',\n              headers: { 'Accept': 'application/json' },\n            });\n            if (!response.ok) {\n              throw new Error('Delete failed');\n            }\n          },\n        },\n      },\n    ];\n\n    for (const def of defaults) {\n      if (!this.seenActions.has(def.name)) {\n        this.seenActions.add(def.name);\n        actions.push(def.button);\n      }\n    }\n  }\n\n  /**\n   * Append default actions with ordering metadata\n   */\n  private appendDefaultActionsOrdered(\n    orderedActions: OrderedAction[],\n    record: Record<string, unknown>,\n    queryContext: string,\n    startingIndex: number\n  ): void {\n    const recordId = String(record.id || '');\n    const basePath = this.config.actionBasePath;\n    const apiEndpoint = this.config.apiEndpoint;\n\n    const defaults: Array<{ name: string; button: ActionButton }> = [\n      {\n        name: 'view',\n        button: {\n          id: 'view',\n          label: 'View',\n          icon: 'eye',\n          variant: 'secondary',\n          action: () => {\n            let url = `${basePath}/${recordId}`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'edit',\n        button: {\n          id: 'edit',\n          label: 'Edit',\n          icon: 'edit',\n          variant: 'primary',\n          action: () => {\n            let url = `${basePath}/${recordId}/edit`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'delete',\n        button: {\n          id: 'delete',\n          label: 'Delete',\n          icon: 'trash',\n          variant: 'danger',\n          action: async () => {\n            if (!window.confirm('Are you sure you want to delete this item?')) return;\n            const response = await fetch(`${apiEndpoint}/${recordId}`, {\n              method: 'DELETE',\n              headers: { 'Accept': 'application/json' },\n            });\n            if (!response.ok) {\n              throw new Error('Delete failed');\n            }\n          },\n        },\n      },\n    ];\n\n    let insertionIndex = startingIndex;\n    for (const def of defaults) {\n      if (!this.seenActions.has(def.name)) {\n        this.seenActions.add(def.name);\n        orderedActions.push({\n          action: def.button,\n          name: def.name,\n          order: this.resolveActionOrder(def.name, undefined),\n          insertionIndex: insertionIndex++,\n        });\n      }\n    }\n  }\n\n  /**\n   * Get default icon for action by name\n   */\n  private getDefaultIcon(actionName: string): string | undefined {\n    const icons: Record<string, string> = {\n      view: 'eye',\n      edit: 'edit',\n      delete: 'trash',\n      publish: 'check-circle',\n      unpublish: 'x-circle',\n      archive: 'archive',\n      restore: 'archive',\n      duplicate: 'copy',\n      create_translation: 'copy',\n      approve: 'check-circle',\n      reject: 'x-circle',\n      submit: 'check-circle',\n    };\n    return icons[actionName.toLowerCase()];\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Build row actions from schema with default configuration\n */\nexport function buildSchemaRowActions(\n  record: Record<string, unknown>,\n  schemaActions: SchemaAction[] | undefined,\n  config: SchemaActionBuilderConfig\n): ActionButton[] {\n  const builder = new SchemaActionBuilder(config);\n  return builder.buildRowActions(record, schemaActions);\n}\n\n/**\n * Extract schema.actions from API response\n */\nexport function extractSchemaActions(response: {\n  schema?: { actions?: SchemaAction[] };\n}): SchemaAction[] | undefined {\n  return response.schema?.actions;\n}\n","/**\n * Translation Blocker Modal\n *\n * Modal-first UI for TRANSLATION_MISSING errors that provides actionable\n * remediation for editors. Shows missing locales, per-locale field hints,\n * and quick actions (Create/Open translation).\n *\n * Design decisions (per CONTENT_TRANSLATION_TDD.md):\n * - Modal is primary UX, toast is fallback only for render failure\n * - Quick actions operate from typed contract data (no heuristics/string matching)\n * - Accessible with keyboard navigation and screen-reader labels\n */\n\nimport { Modal, escapeHtml } from '../shared/modal.js';\nimport { executeActionRequest } from '../toast/error-helpers.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for the translation blocker modal\n */\nexport interface TranslationBlockerModalConfig {\n  /** The workflow transition that was blocked (e.g., 'publish') */\n  transition: string | null;\n  /** Entity type (e.g., 'pages', 'posts') */\n  entityType: string | null;\n  /** The record ID that triggered the blocker */\n  recordId: string;\n  /** Locales that are missing translations */\n  missingLocales: string[];\n  /** Required fields missing per locale (optional) */\n  missingFieldsByLocale: Record<string, string[]> | null;\n  /** The locale that was requested */\n  requestedLocale: string | null;\n  /** The environment context (e.g., 'production', 'staging') */\n  environment: string | null;\n  /** API endpoint for panel actions (e.g., /admin/api/panels/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Callback after successful create translation action */\n  onCreateSuccess?: (locale: string, result: CreateTranslationResult) => void;\n  /** Callback after action error */\n  onError?: (message: string) => void;\n  /** Callback when retry is requested */\n  onRetry?: () => void | Promise<void>;\n  /** Callback when modal is dismissed without action */\n  onDismiss?: () => void;\n}\n\n/**\n * Result from create_translation action\n */\nexport interface CreateTranslationResult {\n  id: string;\n  locale: string;\n  status: string;\n  translation_group_id?: string;\n}\n\n/**\n * Internal state for locale action status\n */\ninterface LocaleActionState {\n  loading: boolean;\n  created: boolean;\n  newRecordId?: string;\n}\n\n// ============================================================================\n// Translation Blocker Modal\n// ============================================================================\n\nexport class TranslationBlockerModal extends Modal {\n  private config: TranslationBlockerModalConfig;\n  private localeStates: Map<string, LocaleActionState> = new Map();\n  private resolved = false;\n\n  constructor(config: TranslationBlockerModalConfig) {\n    super({\n      size: 'lg',\n      initialFocus: '[data-blocker-action]',\n      lockBodyScroll: true,\n      dismissOnBackdropClick: true,\n      dismissOnEscape: true,\n    });\n    this.config = config;\n\n    // Initialize state for each missing locale\n    for (const locale of config.missingLocales) {\n      this.localeStates.set(locale, { loading: false, created: false });\n    }\n  }\n\n  /**\n   * Show the translation blocker modal.\n   * Returns a promise that resolves when the modal is closed.\n   */\n  static showBlocker(config: TranslationBlockerModalConfig): Promise<void> {\n    return new Promise<void>((resolve) => {\n      const originalOnDismiss = config.onDismiss;\n      const modal = new TranslationBlockerModal({\n        ...config,\n        onDismiss: () => {\n          originalOnDismiss?.();\n          resolve();\n        },\n      });\n      modal.show();\n    });\n  }\n\n  protected renderContent(): string {\n    const transition = this.config.transition || 'complete action';\n    const entityType = this.config.entityType || 'content';\n    const hasFieldHints = this.config.missingFieldsByLocale !== null &&\n      Object.keys(this.config.missingFieldsByLocale).length > 0;\n\n    return `\n      <div class=\"flex flex-col\" role=\"dialog\" aria-labelledby=\"blocker-title\" aria-describedby=\"blocker-description\">\n        <!-- Header -->\n        <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-amber-50 dark:bg-amber-900/20\">\n          <div class=\"flex items-center gap-3\">\n            <div class=\"flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-amber-100 dark:bg-amber-800/40\">\n              <svg class=\"w-5 h-5 text-amber-600 dark:text-amber-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n              </svg>\n            </div>\n            <div>\n              <h2 id=\"blocker-title\" class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                Cannot ${escapeHtml(transition)} ${escapeHtml(entityType)}\n              </h2>\n              <p id=\"blocker-description\" class=\"text-sm text-gray-600 dark:text-gray-400 mt-0.5\">\n                ${this.renderDescription(hasFieldHints)}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Missing Locales List -->\n        <div class=\"px-6 py-4 max-h-[50vh] overflow-y-auto\">\n          <p class=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\" id=\"locales-heading\">\n            Missing translations (${this.config.missingLocales.length}):\n          </p>\n          <ul class=\"space-y-3\" role=\"list\" aria-labelledby=\"locales-heading\">\n            ${this.config.missingLocales.map(locale => this.renderLocaleItem(locale)).join('')}\n          </ul>\n        </div>\n\n        <!-- Footer -->\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n          <button type=\"button\"\n                  data-blocker-dismiss\n                  class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer transition-colors\">\n            Close\n          </button>\n          <button type=\"button\"\n                  data-blocker-retry\n                  class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                  aria-describedby=\"retry-hint\">\n            Retry ${escapeHtml(transition)}\n          </button>\n        </div>\n        <p id=\"retry-hint\" class=\"sr-only\">Retry the blocked action after creating missing translations</p>\n      </div>\n    `;\n  }\n\n  private renderDescription(hasFieldHints: boolean): string {\n    if (hasFieldHints) {\n      return 'Required translations are missing or incomplete. Create or complete the translations listed below.';\n    }\n    return 'Required translations are missing. Create the translations listed below to continue.';\n  }\n\n  private renderLocaleItem(locale: string): string {\n    const state = this.localeStates.get(locale) || { loading: false, created: false };\n    const missingFields = this.config.missingFieldsByLocale?.[locale];\n    const hasFields = Array.isArray(missingFields) && missingFields.length > 0;\n    const localeLabel = this.getLocaleLabel(locale);\n\n    // Determine action button state\n    const actionDisabled = state.loading ? 'disabled' : '';\n    const loadingClass = state.loading ? 'opacity-50' : '';\n\n    return `\n      <li class=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 ${loadingClass}\"\n          data-locale-item=\"${escapeHtml(locale)}\"\n          role=\"listitem\">\n        <div class=\"flex items-start justify-between gap-4\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 uppercase tracking-wide\"\n                    aria-label=\"Locale code\">\n                ${escapeHtml(locale)}\n              </span>\n              <span class=\"text-sm font-medium text-gray-900 dark:text-white\">\n                ${escapeHtml(localeLabel)}\n              </span>\n              ${state.created ? `\n                <span class=\"inline-flex items-center text-xs text-green-600 dark:text-green-400\" role=\"status\">\n                  <svg class=\"w-4 h-4 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n                    <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/>\n                  </svg>\n                  Created\n                </span>\n              ` : ''}\n            </div>\n            ${hasFields ? `\n              <div class=\"mt-2\">\n                <p class=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Missing required fields:</p>\n                <div class=\"flex flex-wrap gap-1.5\">\n                  ${missingFields.map(field => `\n                    <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800\">\n                      ${escapeHtml(field)}\n                    </span>\n                  `).join('')}\n                </div>\n              </div>\n            ` : ''}\n          </div>\n          <div class=\"flex items-center gap-2 flex-shrink-0\">\n            ${state.created ? this.renderOpenButton(locale, state.newRecordId) : this.renderCreateButton(locale, actionDisabled)}\n            ${this.renderOpenButton(locale, undefined, state.created)}\n          </div>\n        </div>\n        ${state.loading ? `\n          <div class=\"mt-2 flex items-center text-xs text-gray-500 dark:text-gray-400\" role=\"status\" aria-live=\"polite\">\n            <svg class=\"animate-spin w-4 h-4 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n              <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"/>\n              <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"/>\n            </svg>\n            Creating translation...\n          </div>\n        ` : ''}\n      </li>\n    `;\n  }\n\n  private renderCreateButton(locale: string, disabled: string): string {\n    return `\n      <button type=\"button\"\n              data-blocker-action=\"create\"\n              data-locale=\"${escapeHtml(locale)}\"\n              ${disabled}\n              class=\"inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer transition-colors\"\n              aria-label=\"Create ${this.getLocaleLabel(locale)} translation\">\n        <svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\"/>\n        </svg>\n        Create\n      </button>\n    `;\n  }\n\n  private renderOpenButton(locale: string, recordId?: string, hideIfNotCreated = false): string {\n    if (hideIfNotCreated) return '';\n\n    // Build URL with locale context preserved\n    const baseUrl = this.config.navigationBasePath;\n    const targetId = recordId || this.config.recordId;\n    const params = new URLSearchParams();\n    params.set('locale', locale);\n    if (this.config.environment) {\n      params.set('env', this.config.environment);\n    }\n    const url = `${baseUrl}/${targetId}/edit?${params.toString()}`;\n\n    return `\n      <a href=\"${escapeHtml(url)}\"\n         data-blocker-action=\"open\"\n         data-locale=\"${escapeHtml(locale)}\"\n         class=\"inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer transition-colors\"\n         aria-label=\"Open ${this.getLocaleLabel(locale)} translation\">\n        <svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n        </svg>\n        Open\n      </a>\n    `;\n  }\n\n  private getLocaleLabel(locale: string): string {\n    // Common locale labels - can be extended\n    const labels: Record<string, string> = {\n      en: 'English',\n      es: 'Spanish',\n      fr: 'French',\n      de: 'German',\n      it: 'Italian',\n      pt: 'Portuguese',\n      ja: 'Japanese',\n      ko: 'Korean',\n      zh: 'Chinese',\n      ar: 'Arabic',\n      ru: 'Russian',\n      nl: 'Dutch',\n      pl: 'Polish',\n      sv: 'Swedish',\n      da: 'Danish',\n      no: 'Norwegian',\n      fi: 'Finnish',\n    };\n    return labels[locale.toLowerCase()] || locale.toUpperCase();\n  }\n\n  protected bindContentEvents(): void {\n    // Dismiss button\n    const dismissBtn = this.container?.querySelector<HTMLButtonElement>('[data-blocker-dismiss]');\n    dismissBtn?.addEventListener('click', () => {\n      this.dismiss();\n    });\n\n    // Retry button\n    const retryBtn = this.container?.querySelector<HTMLButtonElement>('[data-blocker-retry]');\n    retryBtn?.addEventListener('click', async () => {\n      await this.handleRetry();\n    });\n\n    // Create translation buttons\n    const createBtns = this.container?.querySelectorAll<HTMLButtonElement>('[data-blocker-action=\"create\"]');\n    createBtns?.forEach(btn => {\n      btn.addEventListener('click', () => {\n        const locale = btn.getAttribute('data-locale');\n        if (locale) {\n          this.handleCreateTranslation(locale);\n        }\n      });\n    });\n\n    // Keyboard navigation within locale list\n    const localeItems = this.container?.querySelectorAll<HTMLElement>('[data-locale-item]');\n    localeItems?.forEach((item, index) => {\n      item.addEventListener('keydown', (e) => {\n        if (e.key === 'ArrowDown' && index < localeItems.length - 1) {\n          e.preventDefault();\n          const nextItem = localeItems[index + 1];\n          const focusable = nextItem.querySelector<HTMLElement>('[data-blocker-action]');\n          focusable?.focus();\n        } else if (e.key === 'ArrowUp' && index > 0) {\n          e.preventDefault();\n          const prevItem = localeItems[index - 1];\n          const focusable = prevItem.querySelector<HTMLElement>('[data-blocker-action]');\n          focusable?.focus();\n        }\n      });\n    });\n  }\n\n  private async handleCreateTranslation(locale: string): Promise<void> {\n    const state = this.localeStates.get(locale);\n    if (!state || state.loading || state.created) return;\n\n    // Update state to loading\n    state.loading = true;\n    this.updateLocaleItemUI(locale);\n\n    try {\n      // Build payload for create_translation action\n      const payload: Record<string, unknown> = {\n        id: this.config.recordId,\n        locale: locale,\n      };\n\n      if (this.config.environment) {\n        payload.environment = this.config.environment;\n      }\n      if (this.config.panelName) {\n        payload.policy_entity = this.config.panelName;\n      }\n\n      // Execute create_translation action\n      const endpoint = `${this.config.apiEndpoint}/actions/create_translation`;\n      const result = await executeActionRequest(endpoint, payload);\n\n      if (result.success) {\n        // Update state to created\n        state.loading = false;\n        state.created = true;\n\n        // Extract new record ID from response data if present\n        if (result.data?.id) {\n          state.newRecordId = String(result.data.id);\n        }\n\n        this.updateLocaleItemUI(locale);\n\n        // Call success callback\n        const createResult: CreateTranslationResult = {\n          id: state.newRecordId || this.config.recordId,\n          locale: locale,\n          status: String(result.data?.status || 'draft'),\n          translation_group_id: result.data?.translation_group_id\n            ? String(result.data.translation_group_id)\n            : undefined,\n        };\n        this.config.onCreateSuccess?.(locale, createResult);\n      } else {\n        state.loading = false;\n        this.updateLocaleItemUI(locale);\n\n        const errorMessage = result.error?.message || 'Failed to create translation';\n        this.config.onError?.(errorMessage);\n      }\n    } catch (err) {\n      state.loading = false;\n      this.updateLocaleItemUI(locale);\n\n      const errorMessage = err instanceof Error ? err.message : 'Failed to create translation';\n      this.config.onError?.(errorMessage);\n    }\n  }\n\n  private updateLocaleItemUI(locale: string): void {\n    const item = this.container?.querySelector(`[data-locale-item=\"${locale}\"]`);\n    if (!item) return;\n\n    // Re-render the locale item\n    const state = this.localeStates.get(locale);\n    if (!state) return;\n\n    // Find the parent list and replace this item\n    const parent = item.parentElement;\n    if (!parent) return;\n\n    const temp = document.createElement('div');\n    temp.innerHTML = this.renderLocaleItem(locale);\n    const newItem = temp.firstElementChild;\n    if (newItem) {\n      parent.replaceChild(newItem, item);\n\n      // Re-bind events for the new item\n      const createBtn = newItem.querySelector<HTMLButtonElement>('[data-blocker-action=\"create\"]');\n      createBtn?.addEventListener('click', () => {\n        this.handleCreateTranslation(locale);\n      });\n    }\n  }\n\n  private async handleRetry(): Promise<void> {\n    // Close modal first, then retry the blocked action from caller context.\n    this.resolved = true;\n    this.hide();\n    if (!this.config.onRetry) return;\n\n    try {\n      await this.config.onRetry();\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Retry failed';\n      this.config.onError?.(message);\n    }\n  }\n\n  private dismiss(): void {\n    this.resolved = true;\n    this.config.onDismiss?.();\n    this.hide();\n  }\n\n  protected onBeforeHide(): boolean {\n    if (!this.resolved) {\n      this.resolved = true;\n      this.config.onDismiss?.();\n    }\n    return true;\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Show translation blocker modal with simplified configuration.\n * Use this as the primary entry point for displaying blockers.\n */\nexport async function showTranslationBlocker(config: TranslationBlockerModalConfig): Promise<void> {\n  try {\n    await TranslationBlockerModal.showBlocker(config);\n  } catch (err) {\n    // Fallback to toast/alert if modal render fails\n    console.error('[TranslationBlockerModal] Render failed, using fallback:', err);\n    const transition = config.transition || 'complete action';\n    const locales = config.missingLocales.join(', ');\n    const message = `Cannot ${transition}: Missing translations for ${locales}`;\n\n    if (typeof window !== 'undefined' && 'toastManager' in window) {\n      (window as unknown as { toastManager: { error: (msg: string) => void } }).toastManager.error(message);\n    } else {\n      alert(message);\n    }\n  }\n}\n","/**\n * Translation Status Legend Component\n *\n * Provides a visual legend for translation status indicators in content list views.\n * Shows readiness states using consistent iconography across the admin panel.\n *\n * Contract:\n * - ● ready: All required translations complete\n * - ◐ incomplete: Has translations but missing required fields\n * - ○ missing: Missing required locale translations\n * - ⚠ fallback/stale: Viewing fallback content or stale data\n *\n * Phase 1 behavior:\n * - Always visible in list toolbar\n * - Non-collapsible\n * - No persisted user preference\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Status legend item definition\n */\nexport interface StatusLegendItem {\n  /** Unique status key */\n  key: string;\n  /** Display label */\n  label: string;\n  /** Icon character or SVG */\n  icon: string;\n  /** CSS color class for the icon */\n  colorClass: string;\n  /** Tooltip/description */\n  description: string;\n}\n\n/**\n * Status legend configuration\n */\nexport interface StatusLegendConfig {\n  /** Container element or selector */\n  container: HTMLElement | string;\n  /** Additional CSS classes for the legend container */\n  containerClass?: string;\n  /** Legend title (optional) */\n  title?: string;\n  /** Orientation: horizontal (default) or vertical */\n  orientation?: 'horizontal' | 'vertical';\n  /** Size variant */\n  size?: 'sm' | 'default';\n  /** Items to display (uses defaults if not provided) */\n  items?: StatusLegendItem[];\n}\n\n// ============================================================================\n// Default Legend Items\n// ============================================================================\n\n/**\n * Default translation status legend items per contract\n */\nexport const DEFAULT_STATUS_LEGEND_ITEMS: StatusLegendItem[] = [\n  {\n    key: 'ready',\n    label: 'Ready',\n    icon: '●',\n    colorClass: 'text-green-500',\n    description: 'All required translations are complete',\n  },\n  {\n    key: 'incomplete',\n    label: 'Incomplete',\n    icon: '◐',\n    colorClass: 'text-amber-500',\n    description: 'Has translations but missing required fields',\n  },\n  {\n    key: 'missing',\n    label: 'Missing',\n    icon: '○',\n    colorClass: 'text-red-500',\n    description: 'Missing required locale translations',\n  },\n  {\n    key: 'fallback',\n    label: 'Fallback',\n    icon: '⚠',\n    colorClass: 'text-amber-600',\n    description: 'Viewing fallback content or stale data',\n  },\n];\n\n// ============================================================================\n// Status Legend Component\n// ============================================================================\n\nexport class StatusLegend {\n  private container: HTMLElement | null = null;\n  private config: Required<Omit<StatusLegendConfig, 'container'>> & { container: HTMLElement | null };\n\n  constructor(config: StatusLegendConfig) {\n    const containerEl = typeof config.container === 'string'\n      ? document.querySelector<HTMLElement>(config.container)\n      : config.container;\n\n    this.config = {\n      container: containerEl,\n      containerClass: config.containerClass || '',\n      title: config.title || '',\n      orientation: config.orientation || 'horizontal',\n      size: config.size || 'default',\n      items: config.items || DEFAULT_STATUS_LEGEND_ITEMS,\n    };\n\n    this.container = containerEl;\n  }\n\n  /**\n   * Render the legend into the container\n   */\n  render(): void {\n    if (!this.container) {\n      console.warn('[StatusLegend] Container not found');\n      return;\n    }\n\n    this.container.innerHTML = this.buildHTML();\n  }\n\n  /**\n   * Build HTML for the legend\n   */\n  buildHTML(): string {\n    const { title, orientation, size, items, containerClass } = this.config;\n    const isVertical = orientation === 'vertical';\n    const isSmall = size === 'sm';\n\n    const flexDirection = isVertical ? 'flex-col' : 'flex-row flex-wrap';\n    const gap = isSmall ? 'gap-2' : 'gap-4';\n    const textSize = isSmall ? 'text-xs' : 'text-sm';\n    const iconSize = isSmall ? 'text-sm' : 'text-base';\n\n    const titleHtml = title\n      ? `<span class=\"font-medium text-gray-600 dark:text-gray-400 mr-2 ${textSize}\">${this.escapeHtml(title)}</span>`\n      : '';\n\n    const itemsHtml = items.map(item => this.renderItem(item, iconSize, textSize)).join('');\n\n    return `\n      <div class=\"status-legend inline-flex items-center ${flexDirection} ${gap} ${containerClass}\"\n           role=\"list\"\n           aria-label=\"Translation status legend\">\n        ${titleHtml}\n        ${itemsHtml}\n      </div>\n    `;\n  }\n\n  /**\n   * Render a single legend item\n   */\n  private renderItem(item: StatusLegendItem, iconSize: string, textSize: string): string {\n    return `\n      <div class=\"status-legend-item inline-flex items-center gap-1\"\n           role=\"listitem\"\n           title=\"${this.escapeHtml(item.description)}\"\n           aria-label=\"${this.escapeHtml(item.label)}: ${this.escapeHtml(item.description)}\">\n        <span class=\"${item.colorClass} ${iconSize}\" aria-hidden=\"true\">${item.icon}</span>\n        <span class=\"text-gray-600 dark:text-gray-400 ${textSize}\">${this.escapeHtml(item.label)}</span>\n      </div>\n    `;\n  }\n\n  /**\n   * Update items and re-render\n   */\n  setItems(items: StatusLegendItem[]): void {\n    this.config.items = items;\n    this.render();\n  }\n\n  /**\n   * Destroy the legend\n   */\n  destroy(): void {\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n\n  /**\n   * Escape HTML special characters\n   */\n  private escapeHtml(str: string): string {\n    // Use string replacement instead of DOM for Node.js test compatibility\n    return str\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create and render a status legend\n */\nexport function createStatusLegend(config: StatusLegendConfig): StatusLegend {\n  const legend = new StatusLegend(config);\n  legend.render();\n  return legend;\n}\n\n/**\n * Initialize status legend on elements with data-status-legend attribute\n */\nexport function initStatusLegends(): StatusLegend[] {\n  const elements = document.querySelectorAll<HTMLElement>('[data-status-legend]');\n  const legends: StatusLegend[] = [];\n\n  elements.forEach((el) => {\n    // Skip if already initialized\n    if (el.hasAttribute('data-status-legend-init')) {\n      return;\n    }\n\n    const orientation = (el.dataset.orientation as 'horizontal' | 'vertical') || 'horizontal';\n    const size = (el.dataset.size as 'sm' | 'default') || 'default';\n    const title = el.dataset.title || '';\n\n    const legend = createStatusLegend({\n      container: el,\n      orientation,\n      size,\n      title,\n    });\n\n    el.setAttribute('data-status-legend-init', 'true');\n    legends.push(legend);\n  });\n\n  return legends;\n}\n\n/**\n * Render inline legend HTML for embedding in templates\n */\nexport function renderStatusLegendHTML(options: {\n  title?: string;\n  orientation?: 'horizontal' | 'vertical';\n  size?: 'sm' | 'default';\n  items?: StatusLegendItem[];\n  containerClass?: string;\n} = {}): string {\n  // Create a temporary legend instance to generate HTML\n  const tempContainer = document.createElement('div');\n  const legend = new StatusLegend({\n    container: tempContainer,\n    ...options,\n  });\n  return legend.buildHTML();\n}\n","/**\n * Quick Filters Component (Phase 2)\n *\n * Provides preset filter buttons for common translation filter scenarios.\n * Supports capability-aware disabled states with visible reason text.\n *\n * Contract:\n * - Quick filters are visible-disabled when unsupported, not hidden\n * - Each filter shows a reason when disabled\n * - Filter state is synchronized with DataGrid\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Quick filter definition\n */\nexport interface QuickFilter {\n  /** Unique filter key */\n  key: string;\n  /** Display label */\n  label: string;\n  /** Filter field name */\n  field: string;\n  /** Filter value */\n  value: string;\n  /** Icon or badge (optional) */\n  icon?: string;\n  /** CSS class for styling */\n  styleClass?: string;\n  /** Tooltip description */\n  description?: string;\n}\n\n/**\n * Quick filter capability - defines whether a filter is supported\n */\nexport interface QuickFilterCapability {\n  /** The filter key */\n  key: string;\n  /** Whether the filter is supported */\n  supported: boolean;\n  /** Reason why filter is disabled (when not supported) */\n  disabledReason?: string;\n}\n\n/**\n * Quick filter state\n */\nexport interface QuickFilterState {\n  /** Currently active filter key (null if none) */\n  activeKey: string | null;\n  /** Filter capabilities */\n  capabilities: Map<string, QuickFilterCapability>;\n}\n\n/**\n * Quick filters configuration\n */\nexport interface QuickFiltersConfig {\n  /** Container element or selector */\n  container: HTMLElement | string;\n  /** Available filters */\n  filters: QuickFilter[];\n  /** Initial capabilities (optional) */\n  capabilities?: QuickFilterCapability[];\n  /** Callback when filter is selected */\n  onFilterSelect: (filter: QuickFilter | null) => void;\n  /** Additional CSS classes */\n  containerClass?: string;\n  /** Size variant */\n  size?: 'sm' | 'default';\n}\n\n// ============================================================================\n// Default Translation Quick Filters\n// ============================================================================\n\n/**\n * Default quick filters for translation readiness states\n */\nexport const DEFAULT_TRANSLATION_QUICK_FILTERS: QuickFilter[] = [\n  {\n    key: 'all',\n    label: 'All',\n    field: '',\n    value: '',\n    icon: '○',\n    styleClass: 'bg-gray-100 text-gray-700 hover:bg-gray-200',\n    description: 'Show all records',\n  },\n  {\n    key: 'ready',\n    label: 'Ready',\n    field: 'readiness_state',\n    value: 'ready',\n    icon: '●',\n    styleClass: 'bg-green-100 text-green-700 hover:bg-green-200',\n    description: 'All translations complete',\n  },\n  {\n    key: 'missing_locales',\n    label: 'Missing',\n    field: 'readiness_state',\n    value: 'missing_locales',\n    icon: '○',\n    styleClass: 'bg-amber-100 text-amber-700 hover:bg-amber-200',\n    description: 'Missing required locale translations',\n  },\n  {\n    key: 'missing_fields',\n    label: 'Incomplete',\n    field: 'readiness_state',\n    value: 'missing_fields',\n    icon: '◐',\n    styleClass: 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200',\n    description: 'Has translations but missing required fields',\n  },\n  {\n    key: 'fallback',\n    label: 'Fallback',\n    field: 'fallback_used',\n    value: 'true',\n    icon: '⚠',\n    styleClass: 'bg-orange-100 text-orange-700 hover:bg-orange-200',\n    description: 'Records currently viewed in fallback mode',\n  },\n];\n\n// ============================================================================\n// Quick Filters Component\n// ============================================================================\n\nexport class QuickFilters {\n  private container: HTMLElement | null = null;\n  private config: QuickFiltersConfig;\n  private state: QuickFilterState;\n\n  constructor(config: QuickFiltersConfig) {\n    this.config = config;\n\n    // Resolve container\n    this.container = typeof config.container === 'string'\n      ? document.querySelector<HTMLElement>(config.container)\n      : config.container;\n\n    // Initialize state\n    this.state = {\n      activeKey: null,\n      capabilities: new Map(),\n    };\n\n    // Apply initial capabilities\n    if (config.capabilities) {\n      for (const cap of config.capabilities) {\n        this.state.capabilities.set(cap.key, cap);\n      }\n    }\n\n    // Set defaults for filters without explicit capability\n    for (const filter of config.filters) {\n      if (!this.state.capabilities.has(filter.key)) {\n        this.state.capabilities.set(filter.key, { key: filter.key, supported: true });\n      }\n    }\n\n    this.render();\n  }\n\n  /**\n   * Render the quick filters\n   */\n  render(): void {\n    if (!this.container) {\n      console.warn('[QuickFilters] Container not found');\n      return;\n    }\n\n    const { size = 'default', containerClass = '' } = this.config;\n    const textSize = size === 'sm' ? 'text-xs' : 'text-sm';\n    const padding = size === 'sm' ? 'px-2 py-1' : 'px-3 py-1.5';\n\n    const filtersHtml = this.config.filters\n      .map((filter) => this.renderFilterButton(filter, textSize, padding))\n      .join('');\n\n    this.container.innerHTML = `\n      <div class=\"quick-filters inline-flex items-center gap-2 flex-wrap ${containerClass}\"\n           role=\"group\"\n           aria-label=\"Quick filters\">\n        ${filtersHtml}\n      </div>\n    `;\n\n    // Bind click handlers\n    this.bindEventListeners();\n  }\n\n  /**\n   * Render a single filter button\n   */\n  private renderFilterButton(filter: QuickFilter, textSize: string, padding: string): string {\n    const capability = this.state.capabilities.get(filter.key);\n    const isSupported = capability?.supported !== false;\n    const isActive = this.state.activeKey === filter.key;\n    const disabledReason = capability?.disabledReason || 'Filter not available';\n\n    const baseClasses = `inline-flex items-center gap-1 ${padding} ${textSize} rounded-full font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500`;\n\n    let stateClasses: string;\n    let ariaAttributes: string;\n\n    if (!isSupported) {\n      // Disabled state with visible reason\n      stateClasses = 'bg-gray-100 text-gray-400 cursor-not-allowed opacity-60';\n      ariaAttributes = `aria-disabled=\"true\" title=\"${escapeAttr(disabledReason)}\"`;\n    } else if (isActive) {\n      // Active state\n      stateClasses = `${filter.styleClass || 'bg-blue-100 text-blue-700'} ring-2 ring-offset-1 ring-blue-500`;\n      ariaAttributes = 'aria-pressed=\"true\"';\n    } else {\n      // Normal state\n      stateClasses = filter.styleClass || 'bg-gray-100 text-gray-700 hover:bg-gray-200';\n      ariaAttributes = 'aria-pressed=\"false\"';\n    }\n\n    const iconHtml = filter.icon\n      ? `<span aria-hidden=\"true\">${filter.icon}</span>`\n      : '';\n\n    return `\n      <button type=\"button\"\n              class=\"quick-filter-btn ${baseClasses} ${stateClasses}\"\n              data-filter-key=\"${escapeAttr(filter.key)}\"\n              ${ariaAttributes}\n              ${!isSupported ? 'disabled' : ''}>\n        ${iconHtml}\n        <span>${escapeHtml(filter.label)}</span>\n      </button>\n    `;\n  }\n\n  /**\n   * Bind event listeners to filter buttons\n   */\n  private bindEventListeners(): void {\n    if (!this.container) return;\n\n    const buttons = this.container.querySelectorAll<HTMLButtonElement>('.quick-filter-btn');\n    buttons.forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const key = btn.dataset.filterKey;\n        if (key && !btn.disabled) {\n          this.selectFilter(key);\n        }\n      });\n    });\n  }\n\n  /**\n   * Select a filter by key\n   */\n  selectFilter(key: string): void {\n    const filter = this.config.filters.find((f) => f.key === key);\n    if (!filter) {\n      console.warn(`[QuickFilters] Filter not found: ${key}`);\n      return;\n    }\n\n    const capability = this.state.capabilities.get(key);\n    if (capability?.supported === false) {\n      console.warn(`[QuickFilters] Filter not supported: ${key}`);\n      return;\n    }\n\n    // Toggle if same filter clicked\n    if (this.state.activeKey === key) {\n      this.clearFilter();\n      return;\n    }\n\n    this.state.activeKey = key;\n    this.render();\n\n    // Notify callback\n    if (filter.field === '') {\n      // \"All\" filter clears the filter\n      this.config.onFilterSelect(null);\n    } else {\n      this.config.onFilterSelect(filter);\n    }\n  }\n\n  /**\n   * Clear the active filter\n   */\n  clearFilter(): void {\n    this.state.activeKey = null;\n    this.render();\n    this.config.onFilterSelect(null);\n  }\n\n  /**\n   * Update filter capabilities\n   */\n  updateCapabilities(capabilities: QuickFilterCapability[]): void {\n    for (const cap of capabilities) {\n      this.state.capabilities.set(cap.key, cap);\n    }\n    this.render();\n  }\n\n  /**\n   * Set a specific capability\n   */\n  setCapability(key: string, supported: boolean, disabledReason?: string): void {\n    this.state.capabilities.set(key, { key, supported, disabledReason });\n    this.render();\n  }\n\n  /**\n   * Get current active filter\n   */\n  getActiveFilter(): QuickFilter | null {\n    if (!this.state.activeKey) return null;\n    return this.config.filters.find((f) => f.key === this.state.activeKey) || null;\n  }\n\n  /**\n   * Set active filter programmatically\n   */\n  setActiveFilter(key: string | null): void {\n    this.state.activeKey = key;\n    this.render();\n  }\n\n  /**\n   * Destroy the component\n   */\n  destroy(): void {\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create quick filters for translation readiness\n */\nexport function createTranslationQuickFilters(\n  container: HTMLElement | string,\n  onFilterSelect: (filter: QuickFilter | null) => void,\n  options: {\n    capabilities?: QuickFilterCapability[];\n    size?: 'sm' | 'default';\n    containerClass?: string;\n  } = {}\n): QuickFilters {\n  return new QuickFilters({\n    container,\n    filters: DEFAULT_TRANSLATION_QUICK_FILTERS,\n    onFilterSelect,\n    ...options,\n  });\n}\n\n/**\n * Initialize quick filters on elements with data-quick-filters attribute\n */\nexport function initQuickFilters(\n  onFilterSelect: (filter: QuickFilter | null, container: HTMLElement) => void\n): QuickFilters[] {\n  const elements = document.querySelectorAll<HTMLElement>('[data-quick-filters]');\n  const instances: QuickFilters[] = [];\n\n  elements.forEach((el) => {\n    // Skip if already initialized\n    if (el.hasAttribute('data-quick-filters-init')) {\n      return;\n    }\n\n    const size = (el.dataset.size as 'sm' | 'default') || 'default';\n\n    const instance = createTranslationQuickFilters(\n      el,\n      (filter) => onFilterSelect(filter, el),\n      { size }\n    );\n\n    el.setAttribute('data-quick-filters-init', 'true');\n    instances.push(instance);\n  });\n\n  return instances;\n}\n\n/**\n * Render inline quick filters HTML for embedding in templates\n */\nexport function renderQuickFiltersHTML(options: {\n  filters?: QuickFilter[];\n  activeKey?: string | null;\n  capabilities?: QuickFilterCapability[];\n  size?: 'sm' | 'default';\n  containerClass?: string;\n} = {}): string {\n  const {\n    filters = DEFAULT_TRANSLATION_QUICK_FILTERS,\n    activeKey = null,\n    capabilities = [],\n    size = 'default',\n    containerClass = '',\n  } = options;\n\n  const textSize = size === 'sm' ? 'text-xs' : 'text-sm';\n  const padding = size === 'sm' ? 'px-2 py-1' : 'px-3 py-1.5';\n\n  const capMap = new Map<string, QuickFilterCapability>();\n  for (const cap of capabilities) {\n    capMap.set(cap.key, cap);\n  }\n\n  const filtersHtml = filters\n    .map((filter) => {\n      const capability = capMap.get(filter.key);\n      const isSupported = capability?.supported !== false;\n      const isActive = activeKey === filter.key;\n      const disabledReason = capability?.disabledReason || 'Filter not available';\n\n      const baseClasses = `inline-flex items-center gap-1 ${padding} ${textSize} rounded-full font-medium`;\n\n      let stateClasses: string;\n      if (!isSupported) {\n        stateClasses = 'bg-gray-100 text-gray-400 cursor-not-allowed opacity-60';\n      } else if (isActive) {\n        stateClasses = `${filter.styleClass || 'bg-blue-100 text-blue-700'} ring-2 ring-offset-1 ring-blue-500`;\n      } else {\n        stateClasses = filter.styleClass || 'bg-gray-100 text-gray-700';\n      }\n\n      const iconHtml = filter.icon ? `<span>${filter.icon}</span>` : '';\n      const titleAttr = !isSupported ? `title=\"${escapeAttr(disabledReason)}\"` : '';\n\n      return `<span class=\"${baseClasses} ${stateClasses}\" ${titleAttr}>${iconHtml}<span>${escapeHtml(filter.label)}</span></span>`;\n    })\n    .join('');\n\n  return `<div class=\"quick-filters inline-flex items-center gap-2 flex-wrap ${containerClass}\">${filtersHtml}</div>`;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction escapeAttr(str: string): string {\n  return escapeHtml(str);\n}\n","/**\n * Translation Bulk Actions (Phase 2)\n *\n * Provides bulk action handlers for translation operations:\n * - Create missing translations\n *\n * Contract:\n * - Uses typed per-item success/failure results from backend\n * - Shows deterministic result summary toast/report\n * - Refreshes affected rows after mutation\n */\n\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Per-item result from bulk create-missing-translations\n */\nexport interface BulkCreateResult {\n  /** Source record ID */\n  id: string;\n  /** Target locale */\n  locale: string;\n  /** Whether creation succeeded */\n  success: boolean;\n  /** Error message if failed */\n  error?: string;\n  /** Created record ID if succeeded */\n  created_id?: string;\n}\n\n/**\n * Bulk create-missing-translations response\n */\nexport interface BulkCreateMissingResponse {\n  /** Whether overall operation completed */\n  success: boolean;\n  /** Per-item results */\n  data?: BulkCreateResult[];\n  /** Total items processed */\n  total?: number;\n  /** Count of successful creations */\n  created_count?: number;\n  /** Count of failed creations */\n  failed_count?: number;\n  /** Count of items skipped (already exist) */\n  skipped_count?: number;\n  /** Overall error message if failed */\n  error?: string;\n  /** Validation errors */\n  validation_errors?: Record<string, string>;\n}\n\n/**\n * Summary for display\n */\nexport interface BulkActionSummary {\n  /** Total items processed */\n  total: number;\n  /** Successfully created */\n  created: number;\n  /** Failed */\n  failed: number;\n  /** Skipped (already exist) */\n  skipped: number;\n  /** Failure details (limited) */\n  failures: { id: string; locale: string; error: string }[];\n}\n\n/**\n * Configuration for bulk create-missing action\n */\nexport interface BulkCreateMissingConfig {\n  /** API endpoint */\n  apiEndpoint: string;\n  /** Toast notifier */\n  notifier?: ToastNotifier;\n  /** Callback after successful operation */\n  onSuccess?: (summary: BulkActionSummary) => void;\n  /** Callback on error */\n  onError?: (error: Error) => void;\n  /** Max failures to show in summary */\n  maxFailuresToShow?: number;\n}\n\n// ============================================================================\n// Bulk Create Missing Translations Handler\n// ============================================================================\n\n/**\n * Execute bulk create-missing-translations action.\n *\n * @param config - Action configuration\n * @param recordIds - IDs of records to create missing translations for\n * @param options - Optional action parameters\n * @returns Summary of the operation\n */\nexport async function executeBulkCreateMissing(\n  config: BulkCreateMissingConfig,\n  recordIds: string[],\n  options: { locales?: string[] } = {}\n): Promise<BulkActionSummary> {\n  const { apiEndpoint, notifier = new FallbackNotifier(), maxFailuresToShow = 5 } = config;\n\n  const endpoint = `${apiEndpoint}/bulk/create-missing-translations`;\n\n  try {\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n      },\n      body: JSON.stringify({\n        ids: recordIds,\n        locales: options.locales,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorBody = await response.text();\n      let errorMessage = `Request failed: ${response.status}`;\n\n      try {\n        const errorJson = JSON.parse(errorBody);\n        errorMessage = errorJson.error || errorJson.message || errorMessage;\n      } catch {\n        // Use text error\n        if (errorBody) {\n          errorMessage = errorBody;\n        }\n      }\n\n      throw new Error(errorMessage);\n    }\n\n    const data: BulkCreateMissingResponse = await response.json();\n\n    // Parse response into summary\n    const summary = parseBulkResponse(data, maxFailuresToShow);\n\n    // Show result toast\n    showResultToast(summary, notifier);\n\n    // Call success callback\n    if (config.onSuccess) {\n      config.onSuccess(summary);\n    }\n\n    return summary;\n  } catch (error) {\n    const err = error instanceof Error ? error : new Error(String(error));\n\n    notifier.error(`Failed to create translations: ${err.message}`);\n\n    if (config.onError) {\n      config.onError(err);\n    }\n\n    throw err;\n  }\n}\n\n/**\n * Parse bulk response into summary\n */\nfunction parseBulkResponse(\n  response: BulkCreateMissingResponse,\n  maxFailures: number\n): BulkActionSummary {\n  const results = response.data || [];\n\n  const created = response.created_count ?? results.filter((r) => r.success).length;\n  const failed = response.failed_count ?? results.filter((r) => !r.success).length;\n  const skipped = response.skipped_count ?? 0;\n  const total = response.total ?? results.length;\n\n  // Collect failure details (limited)\n  const failures = results\n    .filter((r) => !r.success && r.error)\n    .slice(0, maxFailures)\n    .map((r) => ({\n      id: r.id,\n      locale: r.locale,\n      error: r.error || 'Unknown error',\n    }));\n\n  return {\n    total,\n    created,\n    failed,\n    skipped,\n    failures,\n  };\n}\n\n/**\n * Show result toast based on summary\n */\nfunction showResultToast(summary: BulkActionSummary, notifier: ToastNotifier): void {\n  const { created, failed, skipped, total } = summary;\n\n  if (total === 0) {\n    notifier.info('No translations to create');\n    return;\n  }\n\n  if (failed === 0) {\n    // All successful\n    if (created > 0) {\n      notifier.success(`Created ${created} translation${created !== 1 ? 's' : ''}${skipped > 0 ? ` (${skipped} skipped)` : ''}`);\n    } else if (skipped > 0) {\n      notifier.info(`All ${skipped} translation${skipped !== 1 ? 's' : ''} already exist`);\n    }\n  } else if (created === 0) {\n    // All failed\n    notifier.error(`Failed to create ${failed} translation${failed !== 1 ? 's' : ''}`);\n  } else {\n    // Partial success\n    notifier.warning(\n      `Created ${created}, failed ${failed}${skipped > 0 ? `, skipped ${skipped}` : ''}`\n    );\n  }\n}\n\n// ============================================================================\n// Result Summary Rendering\n// ============================================================================\n\n/**\n * Render detailed result summary HTML for modal or report\n */\nexport function renderBulkResultSummary(summary: BulkActionSummary): string {\n  const { created, failed, skipped, total, failures } = summary;\n\n  // Overall stats\n  const statsHtml = `\n    <div class=\"grid grid-cols-3 gap-4 mb-4\">\n      <div class=\"text-center p-3 bg-green-50 rounded\">\n        <div class=\"text-2xl font-bold text-green-700\">${created}</div>\n        <div class=\"text-sm text-green-600\">Created</div>\n      </div>\n      <div class=\"text-center p-3 ${failed > 0 ? 'bg-red-50' : 'bg-gray-50'} rounded\">\n        <div class=\"text-2xl font-bold ${failed > 0 ? 'text-red-700' : 'text-gray-400'}\">${failed}</div>\n        <div class=\"text-sm ${failed > 0 ? 'text-red-600' : 'text-gray-500'}\">Failed</div>\n      </div>\n      <div class=\"text-center p-3 ${skipped > 0 ? 'bg-yellow-50' : 'bg-gray-50'} rounded\">\n        <div class=\"text-2xl font-bold ${skipped > 0 ? 'text-yellow-700' : 'text-gray-400'}\">${skipped}</div>\n        <div class=\"text-sm ${skipped > 0 ? 'text-yellow-600' : 'text-gray-500'}\">Skipped</div>\n      </div>\n    </div>\n  `;\n\n  // Failure details\n  let failuresHtml = '';\n  if (failures.length > 0) {\n    const failureRows = failures\n      .map(\n        (f) => `\n        <tr>\n          <td class=\"px-3 py-2 text-sm text-gray-700\">${escapeHtml(f.id)}</td>\n          <td class=\"px-3 py-2 text-sm text-gray-700\">${escapeHtml(f.locale)}</td>\n          <td class=\"px-3 py-2 text-sm text-red-600\">${escapeHtml(f.error)}</td>\n        </tr>\n      `\n      )\n      .join('');\n\n    failuresHtml = `\n      <div class=\"mt-4\">\n        <h4 class=\"text-sm font-medium text-gray-700 mb-2\">Failure Details</h4>\n        <div class=\"border rounded overflow-hidden\">\n          <table class=\"min-w-full divide-y divide-gray-200\">\n            <thead class=\"bg-gray-50\">\n              <tr>\n                <th class=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">ID</th>\n                <th class=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Locale</th>\n                <th class=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Error</th>\n              </tr>\n            </thead>\n            <tbody class=\"bg-white divide-y divide-gray-200\">\n              ${failureRows}\n            </tbody>\n          </table>\n        </div>\n        ${failed > failures.length ? `<p class=\"mt-2 text-sm text-gray-500\">Showing ${failures.length} of ${failed} failures</p>` : ''}\n      </div>\n    `;\n  }\n\n  return `\n    <div class=\"bulk-result-summary\">\n      <div class=\"mb-4 text-sm text-gray-600\">\n        Processed ${total} item${total !== 1 ? 's' : ''}\n      </div>\n      ${statsHtml}\n      ${failuresHtml}\n    </div>\n  `;\n}\n\n/**\n * Render compact inline summary for list view\n */\nexport function renderBulkResultInline(summary: BulkActionSummary): string {\n  const { created, failed, skipped } = summary;\n\n  const parts: string[] = [];\n\n  if (created > 0) {\n    parts.push(`<span class=\"text-green-600\">+${created}</span>`);\n  }\n  if (failed > 0) {\n    parts.push(`<span class=\"text-red-600\">${failed} failed</span>`);\n  }\n  if (skipped > 0) {\n    parts.push(`<span class=\"text-yellow-600\">${skipped} skipped</span>`);\n  }\n\n  return parts.join(' · ');\n}\n\n// ============================================================================\n// Action Builder Integration\n// ============================================================================\n\n/**\n * Create a bulk action handler for create-missing-translations\n * that can be passed to DataGrid configuration.\n */\nexport function createBulkCreateMissingHandler(\n  apiEndpoint: string,\n  notifier?: ToastNotifier,\n  onComplete?: (summary: BulkActionSummary) => void\n): (ids: string[]) => Promise<BulkActionSummary> {\n  return async (ids: string[]) => {\n    return executeBulkCreateMissing(\n      {\n        apiEndpoint,\n        notifier,\n        onSuccess: onComplete,\n      },\n      ids\n    );\n  };\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n","/**\n * Shared Locale Action Component\n *\n * Reusable UI component for locale-level actions (Create/Open translation).\n * Used across fallback banner, blocker modal, and inline missing-locale affordances.\n *\n * Design decisions (per TRANSLATION_UX_IMPL.md):\n * - Single component for create/open actions ensures consistent UX\n * - Loading/success/error states handled uniformly\n * - Accessible with keyboard navigation and screen-reader labels\n */\n\nimport { executeActionRequest } from '../toast/error-helpers.js';\nimport { escapeHtml } from '../shared/modal.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for a locale action chip\n */\nexport interface LocaleActionConfig {\n  /** The locale code (e.g., 'es', 'fr') */\n  locale: string;\n  /** The record ID for actions */\n  recordId: string;\n  /** API endpoint for panel actions (e.g., /admin/api/panels/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Current environment context */\n  environment?: string;\n  /** Whether the locale exists (for existing locales, only show open action) */\n  localeExists?: boolean;\n  /** Display size variant */\n  size?: 'sm' | 'md';\n  /** Display mode: 'chip' for inline, 'button' for prominent */\n  mode?: 'chip' | 'button';\n  /** Callback after successful create action */\n  onCreateSuccess?: (locale: string, result: CreateActionResult) => void;\n  /** Callback after action error */\n  onError?: (locale: string, message: string) => void;\n  /** Callback after open action triggered */\n  onOpen?: (locale: string, url: string) => void;\n}\n\n/**\n * Result from create_translation action\n */\nexport interface CreateActionResult {\n  id: string;\n  locale: string;\n  status: string;\n  translationGroupId?: string;\n}\n\n/**\n * State for a locale action component\n */\nexport interface LocaleActionState {\n  loading: boolean;\n  created: boolean;\n  error: string | null;\n  newRecordId?: string;\n}\n\n// ============================================================================\n// Locale Label Mapping\n// ============================================================================\n\nconst LOCALE_LABELS: Record<string, string> = {\n  en: 'English',\n  es: 'Spanish',\n  fr: 'French',\n  de: 'German',\n  it: 'Italian',\n  pt: 'Portuguese',\n  ja: 'Japanese',\n  ko: 'Korean',\n  zh: 'Chinese',\n  ar: 'Arabic',\n  ru: 'Russian',\n  nl: 'Dutch',\n  pl: 'Polish',\n  sv: 'Swedish',\n  da: 'Danish',\n  no: 'Norwegian',\n  fi: 'Finnish',\n};\n\n/**\n * Get human-readable label for a locale code.\n */\nexport function getLocaleLabel(locale: string): string {\n  const normalized = locale.toLowerCase();\n  return LOCALE_LABELS[normalized] || locale.toUpperCase();\n}\n\n// ============================================================================\n// Locale Action Component\n// ============================================================================\n\n/**\n * LocaleActionChip renders a locale chip with create/open actions.\n * Manages its own state and can be used standalone or in a list.\n */\nexport class LocaleActionChip {\n  private config: LocaleActionConfig;\n  private state: LocaleActionState;\n  private element: HTMLElement | null = null;\n\n  constructor(config: LocaleActionConfig) {\n    this.config = {\n      size: 'sm',\n      mode: 'chip',\n      localeExists: false,\n      ...config,\n    };\n    this.state = {\n      loading: false,\n      created: false,\n      error: null,\n    };\n  }\n\n  /**\n   * Render the locale action chip as HTML string.\n   * Use when generating static HTML.\n   */\n  render(): string {\n    const { locale, size, mode, localeExists } = this.config;\n    const { loading, created, error } = this.state;\n\n    const localeLabel = getLocaleLabel(locale);\n    const sizeClasses = size === 'sm'\n      ? 'text-xs px-2 py-1'\n      : 'text-sm px-3 py-1.5';\n\n    // Determine base styling based on mode\n    const modeClasses = mode === 'button'\n      ? 'rounded-lg'\n      : 'rounded-full';\n\n    // Determine state-based styling\n    let stateClasses: string;\n    let statusIcon = '';\n\n    if (loading) {\n      stateClasses = 'bg-gray-100 text-gray-600 border-gray-300';\n      statusIcon = this.renderSpinner();\n    } else if (created) {\n      stateClasses = 'bg-green-100 text-green-700 border-green-300';\n      statusIcon = this.renderCheckIcon();\n    } else if (error) {\n      stateClasses = 'bg-red-100 text-red-700 border-red-300';\n      statusIcon = this.renderErrorIcon();\n    } else if (localeExists) {\n      stateClasses = 'bg-blue-100 text-blue-700 border-blue-300';\n    } else {\n      stateClasses = 'bg-amber-100 text-amber-700 border-amber-300';\n    }\n\n    const actionsHtml = this.renderActions();\n\n    return `\n      <div class=\"inline-flex items-center gap-1.5 ${sizeClasses} ${modeClasses} border ${stateClasses}\"\n           data-locale-action=\"${escapeHtml(locale)}\"\n           data-locale-exists=\"${localeExists}\"\n           data-loading=\"${loading}\"\n           data-created=\"${created}\"\n           role=\"group\"\n           aria-label=\"${localeLabel} translation\">\n        ${statusIcon}\n        <span class=\"font-medium uppercase tracking-wide\" aria-hidden=\"true\">${escapeHtml(locale)}</span>\n        <span class=\"sr-only\">${localeLabel}</span>\n        ${actionsHtml}\n      </div>\n    `;\n  }\n\n  /**\n   * Render action buttons (create/open).\n   */\n  private renderActions(): string {\n    const { locale, localeExists, size } = this.config;\n    const { loading, created } = this.state;\n\n    const buttonSize = size === 'sm' ? 'p-0.5' : 'p-1';\n    const iconSize = size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n\n    const actions: string[] = [];\n\n    // Create button (only for missing locales that haven't been created)\n    if (!localeExists && !created && !loading) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"inline-flex items-center justify-center ${buttonSize} rounded hover:bg-amber-200 focus:outline-none focus:ring-1 focus:ring-amber-500 transition-colors\"\n                data-action=\"create\"\n                data-locale=\"${escapeHtml(locale)}\"\n                aria-label=\"Create ${getLocaleLabel(locale)} translation\"\n                title=\"Create ${getLocaleLabel(locale)} translation\">\n          <svg class=\"${iconSize}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n        </button>\n      `);\n    }\n\n    // Open button (for existing locales or newly created ones)\n    if (localeExists || created) {\n      const openBgClass = created ? 'hover:bg-green-200' : 'hover:bg-blue-200';\n      const openRingClass = created ? 'focus:ring-green-500' : 'focus:ring-blue-500';\n      actions.push(`\n        <button type=\"button\"\n                class=\"inline-flex items-center justify-center ${buttonSize} rounded ${openBgClass} focus:outline-none focus:ring-1 ${openRingClass} transition-colors\"\n                data-action=\"open\"\n                data-locale=\"${escapeHtml(locale)}\"\n                aria-label=\"Open ${getLocaleLabel(locale)} translation\"\n                title=\"Open ${getLocaleLabel(locale)} translation\">\n          <svg class=\"${iconSize}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n          </svg>\n        </button>\n      `);\n    }\n\n    return actions.join('');\n  }\n\n  /**\n   * Mount the component to a container element and bind events.\n   */\n  mount(container: HTMLElement): void {\n    container.innerHTML = this.render();\n    this.element = container.querySelector(`[data-locale-action=\"${this.config.locale}\"]`);\n    this.bindEvents();\n  }\n\n  /**\n   * Bind event handlers to action buttons.\n   */\n  private bindEvents(): void {\n    if (!this.element) return;\n\n    const createBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"create\"]');\n    const openBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"open\"]');\n\n    createBtn?.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.handleCreate();\n    });\n\n    openBtn?.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.handleOpen();\n    });\n  }\n\n  /**\n   * Handle create translation action.\n   */\n  async handleCreate(): Promise<void> {\n    if (this.state.loading || this.state.created) return;\n\n    this.setState({ loading: true, error: null });\n\n    try {\n      const payload: Record<string, unknown> = {\n        id: this.config.recordId,\n        locale: this.config.locale,\n      };\n\n      if (this.config.environment) {\n        payload.environment = this.config.environment;\n      }\n      if (this.config.panelName) {\n        payload.policy_entity = this.config.panelName;\n      }\n\n      const endpoint = `${this.config.apiEndpoint}/actions/create_translation`;\n      const result = await executeActionRequest(endpoint, payload);\n\n      if (result.success) {\n        const newId = result.data?.id ? String(result.data.id) : undefined;\n        this.setState({\n          loading: false,\n          created: true,\n          newRecordId: newId,\n        });\n\n        const createResult: CreateActionResult = {\n          id: newId || this.config.recordId,\n          locale: this.config.locale,\n          status: String(result.data?.status || 'draft'),\n          translationGroupId: result.data?.translation_group_id\n            ? String(result.data.translation_group_id)\n            : undefined,\n        };\n\n        this.config.onCreateSuccess?.(this.config.locale, createResult);\n      } else {\n        const errorMessage = result.error?.message || 'Failed to create translation';\n        this.setState({ loading: false, error: errorMessage });\n        this.config.onError?.(this.config.locale, errorMessage);\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to create translation';\n      this.setState({ loading: false, error: errorMessage });\n      this.config.onError?.(this.config.locale, errorMessage);\n    }\n  }\n\n  /**\n   * Handle open translation action.\n   */\n  handleOpen(): void {\n    const { locale, navigationBasePath, recordId, environment } = this.config;\n    const { newRecordId } = this.state;\n\n    const targetId = newRecordId || recordId;\n    const params = new URLSearchParams();\n    params.set('locale', locale);\n    if (environment) {\n      params.set('env', environment);\n    }\n\n    const url = `${navigationBasePath}/${targetId}/edit?${params.toString()}`;\n    this.config.onOpen?.(locale, url);\n\n    // Default behavior: navigate to the URL\n    window.location.href = url;\n  }\n\n  /**\n   * Update component state and re-render.\n   */\n  private setState(updates: Partial<LocaleActionState>): void {\n    this.state = { ...this.state, ...updates };\n    if (this.element) {\n      const parent = this.element.parentElement;\n      if (parent) {\n        this.mount(parent);\n      }\n    }\n  }\n\n  /**\n   * Render spinner icon for loading state.\n   */\n  private renderSpinner(): string {\n    const size = this.config.size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n    return `\n      <svg class=\"${size} animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n        <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"/>\n        <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Render check icon for success state.\n   */\n  private renderCheckIcon(): string {\n    const size = this.config.size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n    return `\n      <svg class=\"${size}\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n        <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Render error icon for error state.\n   */\n  private renderErrorIcon(): string {\n    const size = this.config.size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n    return `\n      <svg class=\"${size}\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n        <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Get current state (for testing/inspection).\n   */\n  getState(): LocaleActionState {\n    return { ...this.state };\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Render a static locale action chip as HTML.\n * Use for server-side or initial render scenarios.\n */\nexport function renderLocaleActionChip(config: LocaleActionConfig): string {\n  const chip = new LocaleActionChip(config);\n  return chip.render();\n}\n\n/**\n * Render a list of locale action chips.\n * Useful for rendering multiple missing locales at once.\n */\nexport function renderLocaleActionList(\n  locales: string[],\n  baseConfig: Omit<LocaleActionConfig, 'locale'>\n): string {\n  if (locales.length === 0) return '';\n\n  const chips = locales.map((locale) => {\n    const config: LocaleActionConfig = { ...baseConfig, locale };\n    return renderLocaleActionChip(config);\n  });\n\n  return `\n    <div class=\"flex flex-wrap items-center gap-2\" role=\"list\" aria-label=\"Missing translations\">\n      ${chips.join('')}\n    </div>\n  `;\n}\n\n/**\n * Initialize locale action chips within a container.\n * Binds event handlers to all chips matching the selector.\n */\nexport function initLocaleActionChips(\n  container: HTMLElement,\n  baseConfig: Omit<LocaleActionConfig, 'locale'>\n): Map<string, LocaleActionChip> {\n  const chips = new Map<string, LocaleActionChip>();\n  const elements = container.querySelectorAll<HTMLElement>('[data-locale-action]');\n\n  elements.forEach((element) => {\n    const locale = element.getAttribute('data-locale-action');\n    if (!locale) return;\n\n    const localeExists = element.getAttribute('data-locale-exists') === 'true';\n    const config: LocaleActionConfig = { ...baseConfig, locale, localeExists };\n    const chip = new LocaleActionChip(config);\n\n    // Re-mount to bind events\n    const parent = element.parentElement;\n    if (parent) {\n      chip.mount(parent);\n      chips.set(locale, chip);\n    }\n  });\n\n  return chips;\n}\n\n/**\n * Build URL for editing a specific locale of a record.\n */\nexport function buildLocaleEditUrl(\n  basePath: string,\n  recordId: string,\n  locale: string,\n  environment?: string\n): string {\n  const params = new URLSearchParams();\n  params.set('locale', locale);\n  if (environment) {\n    params.set('env', environment);\n  }\n  return `${basePath}/${recordId}/edit?${params.toString()}`;\n}\n","/**\n * Fallback Banner Component\n *\n * Renders a warning banner when content is displayed in fallback mode\n * (requested locale doesn't exist, showing fallback/source locale instead).\n * Includes form lock behavior to prevent editing fallback content.\n *\n * Design decisions (per TRANSLATION_UX_IMPL.md Section 8.1):\n * - Banner is explicit and non-dismissible in fallback mode\n * - Form is locked (non-editable) until user creates missing translation\n * - Primary CTA: Create requested locale\n * - Secondary CTA: Open resolved/source locale\n */\n\nimport { escapeHtml } from '../shared/modal.js';\nimport {\n  LocaleActionChip,\n  getLocaleLabel,\n  buildLocaleEditUrl,\n  type CreateActionResult,\n} from './locale-action.js';\nimport { extractTranslationContext, type TranslationContext } from './translation-context.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for the fallback banner\n */\nexport interface FallbackBannerConfig {\n  /** Translation context extracted from the record */\n  context: TranslationContext;\n  /** API endpoint for panel actions (e.g., /admin/api/panels/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Current environment context */\n  environment?: string;\n  /** Callback after successful create action */\n  onCreateSuccess?: (locale: string, result: CreateActionResult) => void;\n  /** Callback after action error */\n  onError?: (message: string) => void;\n  /** Callback when open source action is triggered */\n  onOpenSource?: (locale: string, url: string) => void;\n  /** Whether to show the form lock message */\n  showFormLockMessage?: boolean;\n  /** Custom form lock message */\n  formLockMessage?: string;\n}\n\n/**\n * Form lock state\n */\nexport interface FormLockState {\n  /** Whether the form is locked */\n  locked: boolean;\n  /** The reason the form is locked */\n  reason: string | null;\n  /** The locale that was requested but missing */\n  missingLocale: string | null;\n  /** The locale being shown as fallback */\n  fallbackLocale: string | null;\n}\n\n// ============================================================================\n// Fallback Banner Component\n// ============================================================================\n\n/**\n * FallbackBanner renders a warning banner with actions for fallback mode.\n * Manages form lock state and provides CTA buttons.\n */\nexport class FallbackBanner {\n  private config: FallbackBannerConfig;\n  private element: HTMLElement | null = null;\n  private localeChip: LocaleActionChip | null = null;\n\n  constructor(config: FallbackBannerConfig) {\n    this.config = {\n      showFormLockMessage: true,\n      ...config,\n    };\n  }\n\n  /**\n   * Check if fallback mode is active.\n   */\n  isInFallbackMode(): boolean {\n    const { context } = this.config;\n    return context.fallbackUsed || context.missingRequestedLocale;\n  }\n\n  /**\n   * Get form lock state.\n   */\n  getFormLockState(): FormLockState {\n    const { context } = this.config;\n\n    if (!this.isInFallbackMode()) {\n      return {\n        locked: false,\n        reason: null,\n        missingLocale: null,\n        fallbackLocale: null,\n      };\n    }\n\n    return {\n      locked: true,\n      reason: this.config.formLockMessage ||\n        `The ${context.requestedLocale?.toUpperCase() || 'requested'} translation doesn't exist. Create it to enable editing.`,\n      missingLocale: context.requestedLocale,\n      fallbackLocale: context.resolvedLocale,\n    };\n  }\n\n  /**\n   * Render the fallback banner as HTML string.\n   */\n  render(): string {\n    if (!this.isInFallbackMode()) {\n      return '';\n    }\n\n    const { context, showFormLockMessage } = this.config;\n    const requestedLocale = context.requestedLocale || 'requested';\n    const resolvedLocale = context.resolvedLocale || 'default';\n    const requestedLabel = getLocaleLabel(requestedLocale);\n    const resolvedLabel = getLocaleLabel(resolvedLocale);\n\n    // Build locale action chip for primary CTA\n    const primaryCtaHtml = this.renderPrimaryCta();\n    const secondaryCtaHtml = this.renderSecondaryCta();\n    const formLockHtml = showFormLockMessage ? this.renderFormLockMessage() : '';\n\n    return `\n      <div class=\"fallback-banner bg-amber-50 border border-amber-200 rounded-lg shadow-sm\"\n           role=\"alert\"\n           aria-live=\"polite\"\n           data-fallback-banner=\"true\"\n           data-requested-locale=\"${escapeHtml(requestedLocale)}\"\n           data-resolved-locale=\"${escapeHtml(resolvedLocale)}\">\n        <div class=\"p-4\">\n          <div class=\"flex items-start gap-3\">\n            <!-- Warning Icon -->\n            <div class=\"flex-shrink-0 mt-0.5\">\n              <svg class=\"w-5 h-5 text-amber-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n                <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n              </svg>\n            </div>\n\n            <!-- Content -->\n            <div class=\"flex-1 min-w-0\">\n              <h3 class=\"text-sm font-semibold text-amber-800\">\n                Viewing fallback content\n              </h3>\n              <p class=\"mt-1 text-sm text-amber-700\">\n                The <strong class=\"font-medium\">${escapeHtml(requestedLabel)}</strong> (${escapeHtml(requestedLocale.toUpperCase())})\n                translation doesn't exist yet. You're viewing content from\n                <strong class=\"font-medium\">${escapeHtml(resolvedLabel)}</strong> (${escapeHtml(resolvedLocale.toUpperCase())}).\n              </p>\n\n              ${formLockHtml}\n\n              <!-- Actions -->\n              <div class=\"mt-4 flex flex-wrap items-center gap-3\">\n                ${primaryCtaHtml}\n                ${secondaryCtaHtml}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render the primary CTA (Create missing locale).\n   */\n  private renderPrimaryCta(): string {\n    const { context, apiEndpoint, navigationBasePath, panelName, environment } = this.config;\n    const requestedLocale = context.requestedLocale;\n\n    if (!requestedLocale || !context.recordId) {\n      return '';\n    }\n\n    return `\n      <button type=\"button\"\n              class=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-amber-600 rounded-lg hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors\"\n              data-action=\"create-translation\"\n              data-locale=\"${escapeHtml(requestedLocale)}\"\n              data-record-id=\"${escapeHtml(context.recordId)}\"\n              data-api-endpoint=\"${escapeHtml(apiEndpoint)}\"\n              data-panel=\"${escapeHtml(panelName || '')}\"\n              data-environment=\"${escapeHtml(environment || '')}\"\n              aria-label=\"Create ${getLocaleLabel(requestedLocale)} translation\">\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n        </svg>\n        Create ${escapeHtml(requestedLocale.toUpperCase())} translation\n      </button>\n    `;\n  }\n\n  /**\n   * Render the secondary CTA (Open source locale).\n   */\n  private renderSecondaryCta(): string {\n    const { context, navigationBasePath, environment } = this.config;\n    const resolvedLocale = context.resolvedLocale;\n\n    if (!resolvedLocale || !context.recordId) {\n      return '';\n    }\n\n    const url = buildLocaleEditUrl(navigationBasePath, context.recordId, resolvedLocale, environment);\n\n    return `\n      <a href=\"${escapeHtml(url)}\"\n         class=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 bg-white border border-amber-300 rounded-lg hover:bg-amber-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors\"\n         data-action=\"open-source\"\n         data-locale=\"${escapeHtml(resolvedLocale)}\"\n         aria-label=\"Open ${getLocaleLabel(resolvedLocale)} translation\">\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n        </svg>\n        Open ${escapeHtml(resolvedLocale.toUpperCase())} (source)\n      </a>\n    `;\n  }\n\n  /**\n   * Render the form lock message.\n   */\n  private renderFormLockMessage(): string {\n    return `\n      <p class=\"mt-2 text-sm text-amber-600 flex items-center gap-1.5\">\n        <svg class=\"w-4 h-4 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n          <path fill-rule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clip-rule=\"evenodd\"/>\n        </svg>\n        <span>Editing is disabled until you create the missing translation.</span>\n      </p>\n    `;\n  }\n\n  /**\n   * Mount the banner to a container and bind events.\n   */\n  mount(container: HTMLElement): void {\n    container.innerHTML = this.render();\n    this.element = container.querySelector('[data-fallback-banner]');\n    this.bindEvents();\n  }\n\n  /**\n   * Bind event handlers.\n   */\n  private bindEvents(): void {\n    if (!this.element) return;\n\n    const createBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"create-translation\"]');\n    const openBtn = this.element.querySelector<HTMLAnchorElement>('[data-action=\"open-source\"]');\n\n    createBtn?.addEventListener('click', async (e) => {\n      e.preventDefault();\n      await this.handleCreate();\n    });\n\n    openBtn?.addEventListener('click', (e) => {\n      const locale = openBtn.getAttribute('data-locale');\n      const url = openBtn.getAttribute('href');\n      if (locale && url) {\n        this.config.onOpenSource?.(locale, url);\n      }\n      // Let the default navigation happen unless prevented\n    });\n  }\n\n  /**\n   * Handle create translation action.\n   */\n  private async handleCreate(): Promise<void> {\n    const { context, apiEndpoint, panelName, environment, navigationBasePath } = this.config;\n    const locale = context.requestedLocale;\n    const recordId = context.recordId;\n\n    if (!locale || !recordId) return;\n\n    // Create locale action chip for handling the create action\n    const chip = new LocaleActionChip({\n      locale,\n      recordId,\n      apiEndpoint,\n      navigationBasePath,\n      panelName,\n      environment,\n      localeExists: false,\n      onCreateSuccess: (loc, result) => {\n        this.config.onCreateSuccess?.(loc, result);\n        // Redirect to edit the new translation\n        const url = buildLocaleEditUrl(navigationBasePath, result.id, loc, environment);\n        window.location.href = url;\n      },\n      onError: (_loc, message) => {\n        this.config.onError?.(message);\n      },\n    });\n\n    await chip.handleCreate();\n  }\n}\n\n// ============================================================================\n// Form Lock Helpers\n// ============================================================================\n\n/**\n * Apply form lock to a form element based on fallback state.\n * Disables all form inputs and adds visual indicators.\n */\nexport function applyFormLock(form: HTMLFormElement, lockState: FormLockState): void {\n  if (!lockState.locked) {\n    removeFormLock(form);\n    return;\n  }\n\n  // Add locked class for styling\n  form.classList.add('form-locked', 'pointer-events-none', 'opacity-75');\n  form.setAttribute('data-form-locked', 'true');\n  form.setAttribute('data-lock-reason', lockState.reason || '');\n\n  // Disable all form elements\n  const inputs = form.querySelectorAll<HTMLElement>('input, textarea, select, button[type=\"submit\"]');\n  inputs.forEach((input) => {\n    input.setAttribute('disabled', 'true');\n    input.setAttribute('data-was-enabled', 'true');\n    input.setAttribute('aria-disabled', 'true');\n  });\n\n  // Add lock overlay if not present\n  if (!form.querySelector('[data-form-lock-overlay]')) {\n    const overlay = document.createElement('div');\n    overlay.setAttribute('data-form-lock-overlay', 'true');\n    overlay.className = 'absolute inset-0 bg-amber-50/30 cursor-not-allowed z-10';\n    overlay.setAttribute('title', lockState.reason || 'Form is locked');\n\n    // Ensure form has relative positioning\n    const computedStyle = window.getComputedStyle(form);\n    if (computedStyle.position === 'static') {\n      form.style.position = 'relative';\n    }\n\n    form.appendChild(overlay);\n  }\n}\n\n/**\n * Remove form lock from a form element.\n */\nexport function removeFormLock(form: HTMLFormElement): void {\n  form.classList.remove('form-locked', 'pointer-events-none', 'opacity-75');\n  form.removeAttribute('data-form-locked');\n  form.removeAttribute('data-lock-reason');\n\n  // Re-enable previously enabled form elements\n  const inputs = form.querySelectorAll<HTMLElement>('[data-was-enabled=\"true\"]');\n  inputs.forEach((input) => {\n    input.removeAttribute('disabled');\n    input.removeAttribute('data-was-enabled');\n    input.removeAttribute('aria-disabled');\n  });\n\n  // Remove lock overlay\n  const overlay = form.querySelector('[data-form-lock-overlay]');\n  overlay?.remove();\n}\n\n/**\n * Check if a form is locked.\n */\nexport function isFormLocked(form: HTMLFormElement): boolean {\n  return form.getAttribute('data-form-locked') === 'true';\n}\n\n/**\n * Get form lock reason.\n */\nexport function getFormLockReason(form: HTMLFormElement): string | null {\n  return form.getAttribute('data-lock-reason');\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Render fallback banner from a record payload.\n */\nexport function renderFallbackBannerFromRecord(\n  record: Record<string, unknown>,\n  config: Omit<FallbackBannerConfig, 'context'>\n): string {\n  const context = extractTranslationContext(record);\n  const banner = new FallbackBanner({ ...config, context });\n  return banner.render();\n}\n\n/**\n * Check if a record is in fallback mode and should show banner.\n */\nexport function shouldShowFallbackBanner(record: Record<string, unknown>): boolean {\n  const context = extractTranslationContext(record);\n  return context.fallbackUsed || context.missingRequestedLocale;\n}\n\n/**\n * Initialize fallback banner in a container with event handling.\n */\nexport function initFallbackBanner(\n  container: HTMLElement,\n  config: FallbackBannerConfig\n): FallbackBanner {\n  const banner = new FallbackBanner(config);\n  banner.mount(container);\n  return banner;\n}\n\n/**\n * Initialize form lock based on translation context.\n * Returns the form lock state.\n */\nexport function initFormLock(\n  form: HTMLFormElement,\n  record: Record<string, unknown>\n): FormLockState {\n  const context = extractTranslationContext(record);\n  const banner = new FallbackBanner({\n    context,\n    apiEndpoint: '',\n    navigationBasePath: '',\n  });\n\n  const lockState = banner.getFormLockState();\n  applyFormLock(form, lockState);\n\n  return lockState;\n}\n","/**\n * Inline Missing Locale Chips Component\n *\n * Renders actionable locale chips inline with content rows for creating\n * missing translations directly from list/grid views.\n *\n * Design decisions (per TRANSLATION_UX_IMPL.md Section 8.2):\n * - Chips appear inline with rows that have missing required locales\n * - Create action is gated by _action_state for the create_translation action\n * - Uses shared LocaleActionChip component for consistent UX\n */\n\nimport { escapeHtml } from '../shared/modal.js';\nimport {\n  LocaleActionChip,\n  getLocaleLabel,\n  renderLocaleActionChip,\n  type LocaleActionConfig,\n  type CreateActionResult,\n} from './locale-action.js';\nimport {\n  extractTranslationReadiness,\n  type TranslationReadiness,\n} from './translation-context.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for inline locale chips\n */\nexport interface InlineLocaleChipsConfig {\n  /** Record ID */\n  recordId: string;\n  /** API endpoint for panel actions (e.g., /admin/api/panels/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Current environment context */\n  environment?: string;\n  /** Maximum number of chips to display (default: 3) */\n  maxChips?: number;\n  /** Size variant for chips */\n  size?: 'sm' | 'md';\n  /** Callback after successful create action */\n  onCreateSuccess?: (locale: string, result: CreateActionResult) => void;\n  /** Callback after action error */\n  onError?: (locale: string, message: string) => void;\n}\n\n/**\n * Action state from record _action_state field\n */\nexport interface ActionStateEntry {\n  enabled?: boolean;\n  reason?: string;\n  reason_code?: string;\n}\n\n// ============================================================================\n// Inline Locale Chips Component\n// ============================================================================\n\n/**\n * InlineLocaleChips renders actionable chips for missing locales.\n * Respects _action_state for gating the create_translation action.\n */\nexport class InlineLocaleChips {\n  private config: InlineLocaleChipsConfig;\n  private readiness: TranslationReadiness;\n  private actionState: ActionStateEntry | null;\n  private chips: Map<string, LocaleActionChip> = new Map();\n  private element: HTMLElement | null = null;\n\n  constructor(\n    record: Record<string, unknown>,\n    config: InlineLocaleChipsConfig\n  ) {\n    this.config = {\n      maxChips: 3,\n      size: 'sm',\n      ...config,\n    };\n    this.readiness = extractTranslationReadiness(record);\n    this.actionState = this.extractActionState(record, 'create_translation');\n  }\n\n  /**\n   * Extract action state for a specific action from the record.\n   */\n  private extractActionState(\n    record: Record<string, unknown>,\n    actionName: string\n  ): ActionStateEntry | null {\n    const rawState = record._action_state;\n    if (!rawState || typeof rawState !== 'object' || Array.isArray(rawState)) {\n      return null;\n    }\n    const perAction = (rawState as Record<string, unknown>)[actionName];\n    if (!perAction || typeof perAction !== 'object' || Array.isArray(perAction)) {\n      return null;\n    }\n    return perAction as ActionStateEntry;\n  }\n\n  /**\n   * Check if the create_translation action is enabled.\n   */\n  isCreateActionEnabled(): boolean {\n    // If no action state, assume enabled (backward compat)\n    if (!this.actionState) {\n      return true;\n    }\n    // Explicit enabled: false means disabled\n    return this.actionState.enabled !== false;\n  }\n\n  /**\n   * Get the disabled reason if create action is disabled.\n   */\n  getDisabledReason(): string | null {\n    if (this.isCreateActionEnabled()) {\n      return null;\n    }\n    if (this.actionState?.reason) {\n      return this.actionState.reason;\n    }\n    // Map reason codes to human-readable messages\n    const code = this.actionState?.reason_code;\n    if (code === 'workflow_transition_not_available') {\n      return 'Translation creation is not available in the current workflow state.';\n    }\n    if (code === 'permission_denied') {\n      return 'You do not have permission to create translations.';\n    }\n    return 'Translation creation is currently unavailable.';\n  }\n\n  /**\n   * Get missing locales to display as chips.\n   */\n  getMissingLocales(): string[] {\n    if (!this.readiness.hasReadinessMetadata) {\n      return [];\n    }\n    return this.readiness.missingRequiredLocales.slice(0, this.config.maxChips);\n  }\n\n  /**\n   * Get count of overflow locales (not displayed).\n   */\n  getOverflowCount(): number {\n    if (!this.readiness.hasReadinessMetadata) {\n      return 0;\n    }\n    const total = this.readiness.missingRequiredLocales.length;\n    return Math.max(0, total - (this.config.maxChips || 3));\n  }\n\n  /**\n   * Render the inline locale chips as HTML string.\n   */\n  render(): string {\n    const missingLocales = this.getMissingLocales();\n\n    if (missingLocales.length === 0) {\n      return '';\n    }\n\n    const isEnabled = this.isCreateActionEnabled();\n    const disabledReason = this.getDisabledReason();\n    const overflowCount = this.getOverflowCount();\n\n    const chipsHtml = missingLocales.map((locale) =>\n      this.renderChip(locale, isEnabled, disabledReason)\n    ).join('');\n\n    const overflowHtml = overflowCount > 0\n      ? this.renderOverflow(overflowCount)\n      : '';\n\n    const containerClass = isEnabled\n      ? 'inline-flex items-center gap-1.5 flex-wrap'\n      : 'inline-flex items-center gap-1.5 flex-wrap opacity-60';\n\n    return `\n      <div class=\"${containerClass}\"\n           data-inline-locale-chips=\"true\"\n           data-record-id=\"${escapeHtml(this.config.recordId)}\"\n           data-action-enabled=\"${isEnabled}\"\n           role=\"list\"\n           aria-label=\"Missing translations\">\n        ${chipsHtml}${overflowHtml}\n      </div>\n    `;\n  }\n\n  /**\n   * Render a single locale chip.\n   */\n  private renderChip(\n    locale: string,\n    isEnabled: boolean,\n    disabledReason: string | null\n  ): string {\n    const { recordId, apiEndpoint, navigationBasePath, panelName, environment, size } = this.config;\n\n    if (!isEnabled) {\n      // Render disabled chip without action buttons\n      return this.renderDisabledChip(locale, disabledReason, size);\n    }\n\n    // Render actionable chip\n    return renderLocaleActionChip({\n      locale,\n      recordId,\n      apiEndpoint,\n      navigationBasePath,\n      panelName,\n      environment,\n      localeExists: false,\n      size,\n      mode: 'chip',\n      onCreateSuccess: this.config.onCreateSuccess,\n      onError: this.config.onError,\n    });\n  }\n\n  /**\n   * Render a disabled locale chip (no action buttons).\n   */\n  private renderDisabledChip(\n    locale: string,\n    disabledReason: string | null,\n    size: 'sm' | 'md' | undefined\n  ): string {\n    const sizeClasses = size === 'md'\n      ? 'text-sm px-3 py-1.5'\n      : 'text-xs px-2 py-1';\n\n    const tooltip = disabledReason || 'Translation creation unavailable';\n    const localeLabel = getLocaleLabel(locale);\n\n    return `\n      <div class=\"inline-flex items-center gap-1 ${sizeClasses} rounded-full border border-gray-300 bg-gray-100 text-gray-500 cursor-not-allowed\"\n           data-locale=\"${escapeHtml(locale)}\"\n           data-disabled=\"true\"\n           title=\"${escapeHtml(tooltip)}\"\n           role=\"listitem\"\n           aria-label=\"${localeLabel} translation (unavailable)\">\n        <svg class=\"w-3 h-3 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n          <path fill-rule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clip-rule=\"evenodd\"/>\n        </svg>\n        <span class=\"font-medium uppercase tracking-wide\">${escapeHtml(locale)}</span>\n      </div>\n    `;\n  }\n\n  /**\n   * Render overflow indicator.\n   */\n  private renderOverflow(count: number): string {\n    const { size } = this.config;\n    const sizeClasses = size === 'md'\n      ? 'text-sm px-2 py-1'\n      : 'text-xs px-1.5 py-0.5';\n\n    const allMissing = this.readiness.missingRequiredLocales.join(', ').toUpperCase();\n\n    return `\n      <span class=\"${sizeClasses} rounded text-gray-500 font-medium\"\n            title=\"Also missing: ${escapeHtml(allMissing)}\"\n            aria-label=\"${count} more missing translations\">\n        +${count}\n      </span>\n    `;\n  }\n\n  /**\n   * Mount the component and bind events.\n   */\n  mount(container: HTMLElement): void {\n    container.innerHTML = this.render();\n    this.element = container.querySelector('[data-inline-locale-chips]');\n    this.bindEvents();\n  }\n\n  /**\n   * Bind event handlers for actionable chips.\n   */\n  private bindEvents(): void {\n    if (!this.element || !this.isCreateActionEnabled()) return;\n\n    const chipElements = this.element.querySelectorAll<HTMLElement>('[data-locale-action]');\n    chipElements.forEach((chipEl) => {\n      const locale = chipEl.getAttribute('data-locale-action');\n      if (!locale) return;\n\n      // Create chip instance for event handling\n      const chip = new LocaleActionChip({\n        locale,\n        recordId: this.config.recordId,\n        apiEndpoint: this.config.apiEndpoint,\n        navigationBasePath: this.config.navigationBasePath,\n        panelName: this.config.panelName,\n        environment: this.config.environment,\n        localeExists: false,\n        size: this.config.size,\n        onCreateSuccess: this.config.onCreateSuccess,\n        onError: this.config.onError,\n      });\n\n      this.chips.set(locale, chip);\n\n      // Bind create button\n      const createBtn = chipEl.querySelector<HTMLButtonElement>('[data-action=\"create\"]');\n      createBtn?.addEventListener('click', async (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        await chip.handleCreate();\n      });\n\n      // Bind open button\n      const openBtn = chipEl.querySelector<HTMLButtonElement>('[data-action=\"open\"]');\n      openBtn?.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        chip.handleOpen();\n      });\n    });\n  }\n\n  /**\n   * Get chip instance by locale (for testing/inspection).\n   */\n  getChip(locale: string): LocaleActionChip | undefined {\n    return this.chips.get(locale);\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Render inline locale chips from a record payload.\n */\nexport function renderInlineLocaleChips(\n  record: Record<string, unknown>,\n  config: Omit<InlineLocaleChipsConfig, 'recordId'>\n): string {\n  const recordId = String(record.id || '');\n  if (!recordId) return '';\n\n  const component = new InlineLocaleChips(record, { ...config, recordId });\n  return component.render();\n}\n\n/**\n * Check if a record has missing locales that should show chips.\n */\nexport function shouldShowInlineLocaleChips(record: Record<string, unknown>): boolean {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.hasReadinessMetadata && readiness.missingRequiredLocales.length > 0;\n}\n\n/**\n * Initialize inline locale chips in a container.\n */\nexport function initInlineLocaleChips(\n  container: HTMLElement,\n  record: Record<string, unknown>,\n  config: Omit<InlineLocaleChipsConfig, 'recordId'>\n): InlineLocaleChips {\n  const recordId = String(record.id || '');\n  const component = new InlineLocaleChips(record, { ...config, recordId });\n  component.mount(container);\n  return component;\n}\n\n/**\n * Create a cell renderer for inline locale chips.\n * Can be used with DataGrid column configuration.\n */\nexport function createInlineLocaleChipsRenderer(\n  config: Omit<InlineLocaleChipsConfig, 'recordId'>\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderInlineLocaleChips(record, config);\n  };\n}\n","/**\n * Keyboard Shortcuts Registry\n *\n * ===========================================================================\n * DESIGN NOTE (TX-072): Keyboard Shortcut System for Translation Workflow\n * ===========================================================================\n *\n * Goals:\n * 1. Accelerate common translation operations (save, publish, locale switch)\n * 2. Provide discoverability through visual cues and help modal\n * 3. Maintain consistency with standard editor conventions\n * 4. Support context-aware shortcuts (form vs list view)\n *\n * Shortcut Categories:\n * ┌─────────────────────────────────────────────────────────────────────────┐\n * │ Category        │ Shortcuts                                            │\n * ├─────────────────┼──────────────────────────────────────────────────────┤\n * │ Save/Submit     │ Ctrl/Cmd+S (save), Ctrl/Cmd+Enter (submit)           │\n * │ Locale          │ Ctrl/Cmd+Shift+L (locale picker), Ctrl/Cmd+1-9       │\n * │ Navigation      │ Ctrl/Cmd+[ ] (prev/next locale)                      │\n * │ Actions         │ Ctrl/Cmd+P (publish), Ctrl/Cmd+Shift+T (translate)   │\n * │ Help            │ ? (show shortcuts help), Esc (dismiss modals)        │\n * └─────────────────────────────────────────────────────────────────────────┘\n *\n * Key Design Decisions:\n * - Use Cmd on Mac, Ctrl on other platforms (detected via platform check)\n * - Shortcuts are opt-in and configurable per context\n * - Conflicts with browser/OS shortcuts are avoided\n * - All shortcuts are documented and discoverable via ? key\n * - Shortcuts respect focus state (don't trigger when typing in inputs)\n *\n * Discoverability:\n * - Help modal (? key) shows all available shortcuts\n * - Tooltips on buttons show keyboard shortcuts\n * - First-time hint for ? key in toolbar\n *\n * ===========================================================================\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Platform-independent modifier key representation\n */\nexport type ModifierKey = 'ctrl' | 'alt' | 'shift' | 'meta';\n\n/**\n * Keyboard shortcut definition\n */\nexport interface KeyboardShortcut {\n  /** Unique identifier for this shortcut */\n  id: string;\n  /** Human-readable description */\n  description: string;\n  /** Category for grouping in help modal */\n  category: ShortcutCategory;\n  /** Primary key (e.g., 's', 'Enter', '1') */\n  key: string;\n  /** Modifier keys required */\n  modifiers: ModifierKey[];\n  /** Handler function called when shortcut is triggered */\n  handler: (event: KeyboardEvent) => void | Promise<void>;\n  /** Whether shortcut is enabled (default: true) */\n  enabled?: boolean;\n  /** Context where shortcut is active (default: 'global') */\n  context?: ShortcutContext;\n  /** Whether to prevent default browser behavior */\n  preventDefault?: boolean;\n  /** Whether shortcut should work when focused on form inputs */\n  allowInInput?: boolean;\n}\n\n/**\n * Shortcut category for grouping\n */\nexport type ShortcutCategory =\n  | 'save'\n  | 'navigation'\n  | 'locale'\n  | 'actions'\n  | 'help'\n  | 'other';\n\n/**\n * Context where shortcuts are active\n */\nexport type ShortcutContext = 'global' | 'form' | 'list' | 'modal';\n\n/**\n * Shortcut registration options\n */\nexport interface ShortcutRegistrationOptions {\n  /** Override existing shortcut with same ID */\n  override?: boolean;\n  /** Priority for handling (higher = processed first) */\n  priority?: number;\n}\n\n/**\n * Configuration for the shortcut registry\n */\nexport interface ShortcutRegistryConfig {\n  /** Enable/disable the entire registry */\n  enabled?: boolean;\n  /** Current active context */\n  context?: ShortcutContext;\n  /** Platform override for modifier key display (auto-detected if not set) */\n  platform?: 'mac' | 'windows' | 'linux';\n  /** Callback for when a shortcut is triggered */\n  onShortcutTriggered?: (shortcut: KeyboardShortcut) => void;\n  /** Callback for when help is requested (? key) */\n  onHelpRequested?: () => void;\n}\n\n// ============================================================================\n// Platform Detection\n// ============================================================================\n\n/**\n * Detect if running on Mac platform\n */\nexport function isMacPlatform(): boolean {\n  if (typeof navigator === 'undefined') return false;\n  return /Mac|iPhone|iPad|iPod/i.test(navigator.platform || navigator.userAgent);\n}\n\n/**\n * Get the primary modifier key label for the current platform\n */\nexport function getPrimaryModifierLabel(): string {\n  return isMacPlatform() ? '⌘' : 'Ctrl';\n}\n\n/**\n * Get the modifier key symbol for display\n */\nexport function getModifierSymbol(modifier: ModifierKey): string {\n  if (isMacPlatform()) {\n    switch (modifier) {\n      case 'ctrl': return '⌃';\n      case 'alt': return '⌥';\n      case 'shift': return '⇧';\n      case 'meta': return '⌘';\n    }\n  }\n  switch (modifier) {\n    case 'ctrl': return 'Ctrl';\n    case 'alt': return 'Alt';\n    case 'shift': return 'Shift';\n    case 'meta': return 'Win';\n  }\n}\n\n/**\n * Format a shortcut for display (e.g., \"⌘+S\" or \"Ctrl+S\")\n */\nexport function formatShortcutDisplay(shortcut: KeyboardShortcut): string {\n  const modifiers = shortcut.modifiers.map(getModifierSymbol);\n  const key = formatKeyDisplay(shortcut.key);\n\n  if (isMacPlatform()) {\n    // Mac style: symbols without + separators\n    return [...modifiers, key].join('');\n  }\n  // Windows/Linux style: with + separators\n  return [...modifiers, key].join('+');\n}\n\n/**\n * Format a key for display\n */\nfunction formatKeyDisplay(key: string): string {\n  const keyMappings: Record<string, string> = {\n    'Enter': '↵',\n    'Escape': 'Esc',\n    'ArrowUp': '↑',\n    'ArrowDown': '↓',\n    'ArrowLeft': '←',\n    'ArrowRight': '→',\n    ' ': 'Space',\n    '[': '[',\n    ']': ']',\n  };\n  return keyMappings[key] || key.toUpperCase();\n}\n\n// ============================================================================\n// Keyboard Shortcut Registry\n// ============================================================================\n\n/**\n * KeyboardShortcutRegistry manages keyboard shortcuts and their handlers.\n * Provides a centralized place to register, unregister, and trigger shortcuts.\n */\nexport class KeyboardShortcutRegistry {\n  private shortcuts: Map<string, KeyboardShortcut> = new Map();\n  private config: ShortcutRegistryConfig;\n  private keydownHandler: ((event: KeyboardEvent) => void) | null = null;\n  private boundElement: Document | HTMLElement | null = null;\n\n  constructor(config: ShortcutRegistryConfig = {}) {\n    this.config = {\n      enabled: true,\n      context: 'global',\n      ...config,\n    };\n  }\n\n  /**\n   * Register a keyboard shortcut.\n   */\n  register(\n    shortcut: KeyboardShortcut,\n    options: ShortcutRegistrationOptions = {}\n  ): void {\n    const { override = false } = options;\n\n    if (this.shortcuts.has(shortcut.id) && !override) {\n      console.warn(`[KeyboardShortcuts] Shortcut \"${shortcut.id}\" already registered`);\n      return;\n    }\n\n    this.shortcuts.set(shortcut.id, {\n      enabled: true,\n      context: 'global',\n      preventDefault: true,\n      allowInInput: false,\n      ...shortcut,\n    });\n  }\n\n  /**\n   * Unregister a keyboard shortcut by ID.\n   */\n  unregister(id: string): boolean {\n    return this.shortcuts.delete(id);\n  }\n\n  /**\n   * Enable or disable a specific shortcut.\n   */\n  setEnabled(id: string, enabled: boolean): void {\n    const shortcut = this.shortcuts.get(id);\n    if (shortcut) {\n      shortcut.enabled = enabled;\n    }\n  }\n\n  /**\n   * Set the current active context.\n   */\n  setContext(context: ShortcutContext): void {\n    this.config.context = context;\n  }\n\n  /**\n   * Get the current context.\n   */\n  getContext(): ShortcutContext {\n    return this.config.context || 'global';\n  }\n\n  /**\n   * Get all registered shortcuts.\n   */\n  getShortcuts(): KeyboardShortcut[] {\n    return Array.from(this.shortcuts.values());\n  }\n\n  /**\n   * Get shortcuts by category.\n   */\n  getShortcutsByCategory(category: ShortcutCategory): KeyboardShortcut[] {\n    return this.getShortcuts().filter((s) => s.category === category);\n  }\n\n  /**\n   * Get shortcuts grouped by category.\n   */\n  getShortcutsGroupedByCategory(): Map<ShortcutCategory, KeyboardShortcut[]> {\n    const grouped = new Map<ShortcutCategory, KeyboardShortcut[]>();\n    for (const shortcut of this.shortcuts.values()) {\n      const list = grouped.get(shortcut.category) || [];\n      list.push(shortcut);\n      grouped.set(shortcut.category, list);\n    }\n    return grouped;\n  }\n\n  /**\n   * Bind keyboard event listeners.\n   */\n  bind(element: Document | HTMLElement = document): void {\n    if (this.keydownHandler) {\n      this.unbind();\n    }\n\n    this.keydownHandler = (event: KeyboardEvent) => {\n      this.handleKeydown(event);\n    };\n\n    this.boundElement = element;\n    element.addEventListener('keydown', this.keydownHandler as EventListener);\n  }\n\n  /**\n   * Unbind keyboard event listeners.\n   */\n  unbind(): void {\n    if (this.keydownHandler && this.boundElement) {\n      this.boundElement.removeEventListener('keydown', this.keydownHandler as EventListener);\n      this.keydownHandler = null;\n      this.boundElement = null;\n    }\n  }\n\n  /**\n   * Handle keydown event.\n   */\n  private handleKeydown(event: KeyboardEvent): void {\n    if (!this.config.enabled) return;\n\n    // Check for help shortcut (? key without modifiers)\n    if (event.key === '?' && !event.ctrlKey && !event.altKey && !event.metaKey) {\n      if (!this.isInputFocused(event)) {\n        event.preventDefault();\n        this.config.onHelpRequested?.();\n        return;\n      }\n    }\n\n    // Find matching shortcut\n    const matchingShortcut = this.findMatchingShortcut(event);\n    if (!matchingShortcut) return;\n\n    // Check if shortcut is enabled\n    if (!matchingShortcut.enabled) return;\n\n    // Check context\n    if (matchingShortcut.context !== 'global' &&\n        matchingShortcut.context !== this.config.context) {\n      return;\n    }\n\n    // Check if we should allow in input\n    if (!matchingShortcut.allowInInput && this.isInputFocused(event)) {\n      return;\n    }\n\n    // Prevent default if configured\n    if (matchingShortcut.preventDefault) {\n      event.preventDefault();\n    }\n\n    // Trigger callback\n    this.config.onShortcutTriggered?.(matchingShortcut);\n\n    // Execute handler\n    try {\n      const result = matchingShortcut.handler(event);\n      if (result instanceof Promise) {\n        result.catch((err) => {\n          console.error(`[KeyboardShortcuts] Handler error for \"${matchingShortcut.id}\":`, err);\n        });\n      }\n    } catch (err) {\n      console.error(`[KeyboardShortcuts] Handler error for \"${matchingShortcut.id}\":`, err);\n    }\n  }\n\n  /**\n   * Find a shortcut matching the given keyboard event.\n   */\n  private findMatchingShortcut(event: KeyboardEvent): KeyboardShortcut | null {\n    for (const shortcut of this.shortcuts.values()) {\n      if (this.matchesEvent(shortcut, event)) {\n        return shortcut;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Check if a shortcut matches a keyboard event.\n   */\n  private matchesEvent(shortcut: KeyboardShortcut, event: KeyboardEvent): boolean {\n    // Check key\n    const eventKey = event.key.toLowerCase();\n    const shortcutKey = shortcut.key.toLowerCase();\n\n    if (eventKey !== shortcutKey && event.code.toLowerCase() !== shortcutKey) {\n      return false;\n    }\n\n    // Check modifiers\n    const isMac = isMacPlatform();\n    const expectedModifiers = new Set(shortcut.modifiers);\n\n    // On Mac, treat 'ctrl' in shortcuts as 'meta' (Cmd)\n    const wantsCtrl = expectedModifiers.has('ctrl');\n    const wantsMeta = expectedModifiers.has('meta');\n    const wantsAlt = expectedModifiers.has('alt');\n    const wantsShift = expectedModifiers.has('shift');\n\n    // Check primary modifier (Cmd on Mac, Ctrl on others)\n    if (wantsCtrl) {\n      const hasModifier = isMac ? event.metaKey : event.ctrlKey;\n      if (!hasModifier) return false;\n    }\n\n    // Check explicit meta requirement\n    if (wantsMeta && !isMac && !event.metaKey) return false;\n\n    // Check alt/option\n    if (wantsAlt && !event.altKey) return false;\n\n    // Check shift\n    if (wantsShift && !event.shiftKey) return false;\n\n    // Check for unexpected modifiers\n    if (!wantsCtrl && !wantsMeta) {\n      if (isMac ? event.metaKey : event.ctrlKey) return false;\n    }\n    if (!wantsAlt && event.altKey) return false;\n    if (!wantsShift && event.shiftKey) return false;\n\n    return true;\n  }\n\n  /**\n   * Check if an input element is focused.\n   */\n  private isInputFocused(event: KeyboardEvent): boolean {\n    const target = event.target as HTMLElement;\n    if (!target) return false;\n\n    const tagName = target.tagName.toLowerCase();\n    if (tagName === 'input' || tagName === 'textarea' || tagName === 'select') {\n      return true;\n    }\n\n    // Check for contenteditable\n    if (target.isContentEditable) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Destroy the registry and clean up.\n   */\n  destroy(): void {\n    this.unbind();\n    this.shortcuts.clear();\n  }\n}\n\n// ============================================================================\n// Default Translation Shortcuts\n// ============================================================================\n\n/**\n * Create default translation workflow shortcuts.\n */\nexport function createTranslationShortcuts(handlers: {\n  onSave?: () => void | Promise<void>;\n  onPublish?: () => void | Promise<void>;\n  onLocalePicker?: () => void;\n  onPrevLocale?: () => void;\n  onNextLocale?: () => void;\n  onCreateTranslation?: () => void;\n  onHelp?: () => void;\n}): KeyboardShortcut[] {\n  const shortcuts: KeyboardShortcut[] = [];\n\n  if (handlers.onSave) {\n    shortcuts.push({\n      id: 'save',\n      description: 'Save changes',\n      category: 'save',\n      key: 's',\n      modifiers: ['ctrl'],\n      handler: handlers.onSave,\n      context: 'form',\n    });\n  }\n\n  if (handlers.onPublish) {\n    shortcuts.push({\n      id: 'publish',\n      description: 'Publish content',\n      category: 'actions',\n      key: 'p',\n      modifiers: ['ctrl', 'shift'],\n      handler: handlers.onPublish,\n      context: 'form',\n    });\n  }\n\n  if (handlers.onLocalePicker) {\n    shortcuts.push({\n      id: 'locale-picker',\n      description: 'Open locale picker',\n      category: 'locale',\n      key: 'l',\n      modifiers: ['ctrl', 'shift'],\n      handler: handlers.onLocalePicker,\n    });\n  }\n\n  if (handlers.onPrevLocale) {\n    shortcuts.push({\n      id: 'prev-locale',\n      description: 'Switch to previous locale',\n      category: 'locale',\n      key: '[',\n      modifiers: ['ctrl'],\n      handler: handlers.onPrevLocale,\n    });\n  }\n\n  if (handlers.onNextLocale) {\n    shortcuts.push({\n      id: 'next-locale',\n      description: 'Switch to next locale',\n      category: 'locale',\n      key: ']',\n      modifiers: ['ctrl'],\n      handler: handlers.onNextLocale,\n    });\n  }\n\n  if (handlers.onCreateTranslation) {\n    shortcuts.push({\n      id: 'create-translation',\n      description: 'Create new translation',\n      category: 'actions',\n      key: 't',\n      modifiers: ['ctrl', 'shift'],\n      handler: handlers.onCreateTranslation,\n    });\n  }\n\n  return shortcuts;\n}\n\n// ============================================================================\n// Help Modal Rendering\n// ============================================================================\n\n/**\n * Render keyboard shortcuts help modal content.\n */\nexport function renderShortcutsHelpContent(shortcuts: KeyboardShortcut[]): string {\n  const grouped = new Map<ShortcutCategory, KeyboardShortcut[]>();\n  for (const shortcut of shortcuts) {\n    // Treat undefined as enabled (default), only skip if explicitly false\n    if (shortcut.enabled === false) continue;\n    const list = grouped.get(shortcut.category) || [];\n    list.push(shortcut);\n    grouped.set(shortcut.category, list);\n  }\n\n  const categoryLabels: Record<ShortcutCategory, string> = {\n    save: 'Save & Submit',\n    navigation: 'Navigation',\n    locale: 'Locale Switching',\n    actions: 'Actions',\n    help: 'Help',\n    other: 'Other',\n  };\n\n  const categoryOrder: ShortcutCategory[] = ['save', 'locale', 'navigation', 'actions', 'help', 'other'];\n\n  let html = `\n    <div class=\"shortcuts-help\" role=\"document\">\n      <div class=\"text-sm text-gray-500 mb-4\">\n        Press <kbd class=\"px-1.5 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs font-mono\">?</kbd> to show this help anytime\n      </div>\n  `;\n\n  for (const category of categoryOrder) {\n    const categoryShortcuts = grouped.get(category);\n    if (!categoryShortcuts || categoryShortcuts.length === 0) continue;\n\n    html += `\n      <div class=\"mb-4\">\n        <h4 class=\"text-sm font-medium text-gray-700 mb-2\">${categoryLabels[category]}</h4>\n        <dl class=\"space-y-1\">\n    `;\n\n    for (const shortcut of categoryShortcuts) {\n      const display = formatShortcutDisplay(shortcut);\n      html += `\n          <div class=\"flex justify-between items-center py-1\">\n            <dt class=\"text-sm text-gray-600\">${escapeHtml(shortcut.description)}</dt>\n            <dd class=\"flex-shrink-0 ml-4\">\n              <kbd class=\"px-2 py-1 bg-gray-100 border border-gray-200 rounded text-xs font-mono text-gray-700\">${escapeHtml(display)}</kbd>\n            </dd>\n          </div>\n      `;\n    }\n\n    html += `\n        </dl>\n      </div>\n    `;\n  }\n\n  html += `</div>`;\n  return html;\n}\n\n/**\n * Simple HTML escaping\n */\nfunction escapeHtml(text: string): string {\n  const div = typeof document !== 'undefined' ? document.createElement('div') : null;\n  if (div) {\n    div.textContent = text;\n    return div.innerHTML;\n  }\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\n// ============================================================================\n// Persistence and Settings\n// ============================================================================\n\n/**\n * Storage key for shortcut settings\n */\nconst SHORTCUTS_STORAGE_KEY = 'admin_keyboard_shortcuts_settings';\n\n/**\n * Storage key for first-time hint dismissed\n */\nconst SHORTCUTS_HINT_DISMISSED_KEY = 'admin_keyboard_shortcuts_hint_dismissed';\n\n/**\n * Persisted shortcut settings\n */\nexport interface ShortcutSettings {\n  /** Whether shortcuts are globally enabled */\n  enabled: boolean;\n  /** Per-shortcut enable/disable overrides */\n  shortcuts: Record<string, boolean>;\n  /** When settings were last updated */\n  updatedAt: string;\n}\n\n/**\n * Default shortcut settings\n */\nconst DEFAULT_SHORTCUT_SETTINGS: ShortcutSettings = {\n  enabled: true,\n  shortcuts: {},\n  updatedAt: new Date().toISOString(),\n};\n\ninterface StorageLike {\n  getItem: (key: string) => string | null;\n  setItem: (key: string, value: string) => void;\n}\n\nfunction getStorage(): StorageLike | null {\n  if (typeof localStorage === 'undefined' || !localStorage) {\n    return null;\n  }\n  if (typeof localStorage.getItem !== 'function' || typeof localStorage.setItem !== 'function') {\n    return null;\n  }\n  return localStorage as unknown as StorageLike;\n}\n\n/**\n * Load shortcut settings from localStorage.\n */\nexport function loadShortcutSettings(): ShortcutSettings {\n  const storage = getStorage();\n  if (!storage) {\n    return { ...DEFAULT_SHORTCUT_SETTINGS };\n  }\n\n  try {\n    const stored = storage.getItem(SHORTCUTS_STORAGE_KEY);\n    if (!stored) {\n      return { ...DEFAULT_SHORTCUT_SETTINGS };\n    }\n    const parsed = JSON.parse(stored) as Partial<ShortcutSettings>;\n    return {\n      enabled: typeof parsed.enabled === 'boolean' ? parsed.enabled : true,\n      shortcuts: typeof parsed.shortcuts === 'object' && parsed.shortcuts !== null\n        ? parsed.shortcuts\n        : {},\n      updatedAt: typeof parsed.updatedAt === 'string'\n        ? parsed.updatedAt\n        : new Date().toISOString(),\n    };\n  } catch {\n    return { ...DEFAULT_SHORTCUT_SETTINGS };\n  }\n}\n\n/**\n * Save shortcut settings to localStorage.\n */\nexport function saveShortcutSettings(settings: ShortcutSettings): void {\n  const storage = getStorage();\n  if (!storage) return;\n\n  try {\n    const toSave: ShortcutSettings = {\n      ...settings,\n      updatedAt: new Date().toISOString(),\n    };\n    storage.setItem(SHORTCUTS_STORAGE_KEY, JSON.stringify(toSave));\n  } catch {\n    // Ignore storage errors (quota exceeded, etc.)\n  }\n}\n\n/**\n * Check if the first-time hint has been dismissed.\n */\nexport function isShortcutHintDismissed(): boolean {\n  const storage = getStorage();\n  if (!storage) return false;\n  return storage.getItem(SHORTCUTS_HINT_DISMISSED_KEY) === 'true';\n}\n\n/**\n * Mark the first-time hint as dismissed.\n */\nexport function dismissShortcutHint(): void {\n  const storage = getStorage();\n  if (!storage) return;\n  try {\n    storage.setItem(SHORTCUTS_HINT_DISMISSED_KEY, 'true');\n  } catch {\n    // Ignore storage errors\n  }\n}\n\n// ============================================================================\n// Discovery Hint Component\n// ============================================================================\n\n/**\n * Configuration for the discovery hint\n */\nexport interface DiscoveryHintConfig {\n  /** Where to render the hint */\n  container: HTMLElement;\n  /** Position relative to container */\n  position?: 'top' | 'bottom';\n  /** Callback when hint is dismissed */\n  onDismiss?: () => void;\n  /** Callback when help is requested from hint */\n  onShowHelp?: () => void;\n  /** Auto-dismiss after delay (ms). Set to 0 to disable. */\n  autoDismissMs?: number;\n}\n\n/**\n * Render a first-time discovery hint for keyboard shortcuts.\n * Shows once per user and can be permanently dismissed.\n */\nexport function renderDiscoveryHint(config: DiscoveryHintConfig): HTMLElement | null {\n  if (isShortcutHintDismissed()) {\n    return null;\n  }\n\n  const { container, position = 'bottom', onDismiss, onShowHelp, autoDismissMs = 10000 } = config;\n\n  const hintEl = document.createElement('div');\n  hintEl.className = `shortcuts-discovery-hint fixed ${position === 'top' ? 'top-4' : 'bottom-4'} right-4 z-50 animate-fade-in`;\n  hintEl.setAttribute('role', 'alert');\n  hintEl.setAttribute('aria-live', 'polite');\n\n  const modKey = getPrimaryModifierLabel();\n\n  hintEl.innerHTML = `\n    <div class=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 max-w-sm\">\n      <div class=\"flex items-start gap-3\">\n        <div class=\"flex-shrink-0\">\n          <svg class=\"w-5 h-5 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n          </svg>\n        </div>\n        <div class=\"flex-1 min-w-0\">\n          <p class=\"text-sm font-medium text-gray-900 dark:text-white\">\n            Keyboard shortcuts available\n          </p>\n          <p class=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n            Press <kbd class=\"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-xs font-mono\">?</kbd>\n            to view all shortcuts, or use <kbd class=\"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-xs font-mono\">${modKey}+S</kbd> to save.\n          </p>\n          <div class=\"mt-3 flex items-center gap-2\">\n            <button type=\"button\" data-hint-action=\"show-help\"\n                    class=\"text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 focus:outline-none focus:underline\">\n              View shortcuts\n            </button>\n            <span class=\"text-gray-300 dark:text-gray-600\" aria-hidden=\"true\">|</span>\n            <button type=\"button\" data-hint-action=\"dismiss\"\n                    class=\"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none focus:underline\">\n              Don't show again\n            </button>\n          </div>\n        </div>\n        <button type=\"button\" data-hint-action=\"close\" aria-label=\"Close hint\"\n                class=\"flex-shrink-0 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none\">\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n          </svg>\n        </button>\n      </div>\n    </div>\n  `;\n\n  // Bind events\n  const removeHint = (permanent: boolean): void => {\n    if (permanent) {\n      dismissShortcutHint();\n    }\n    hintEl.remove();\n    onDismiss?.();\n  };\n\n  hintEl.querySelector('[data-hint-action=\"show-help\"]')?.addEventListener('click', () => {\n    removeHint(true);\n    onShowHelp?.();\n  });\n\n  hintEl.querySelector('[data-hint-action=\"dismiss\"]')?.addEventListener('click', () => {\n    removeHint(true);\n  });\n\n  hintEl.querySelector('[data-hint-action=\"close\"]')?.addEventListener('click', () => {\n    removeHint(false);\n  });\n\n  // Auto-dismiss after delay\n  if (autoDismissMs > 0) {\n    setTimeout(() => {\n      if (hintEl.parentElement) {\n        removeHint(false);\n      }\n    }, autoDismissMs);\n  }\n\n  container.appendChild(hintEl);\n  return hintEl;\n}\n\n// ============================================================================\n// Settings UI Component\n// ============================================================================\n\n/**\n * Configuration for the settings UI\n */\nexport interface ShortcutSettingsUIConfig {\n  /** Container to render into */\n  container: HTMLElement;\n  /** Shortcuts to display */\n  shortcuts: KeyboardShortcut[];\n  /** Current settings */\n  settings: ShortcutSettings;\n  /** Callback when settings change */\n  onSettingsChange: (settings: ShortcutSettings) => void;\n}\n\n/**\n * Render the keyboard shortcuts settings UI.\n * Allows users to enable/disable shortcuts globally and per-shortcut.\n */\nexport function renderShortcutSettingsUI(config: ShortcutSettingsUIConfig): void {\n  const { container, shortcuts, settings, onSettingsChange } = config;\n\n  const categoryLabels: Record<ShortcutCategory, string> = {\n    save: 'Save & Submit',\n    navigation: 'Navigation',\n    locale: 'Locale Switching',\n    actions: 'Actions',\n    help: 'Help',\n    other: 'Other',\n  };\n\n  // Group shortcuts by category\n  const grouped = new Map<ShortcutCategory, KeyboardShortcut[]>();\n  for (const shortcut of shortcuts) {\n    const list = grouped.get(shortcut.category) || [];\n    list.push(shortcut);\n    grouped.set(shortcut.category, list);\n  }\n\n  const categoryOrder: ShortcutCategory[] = ['save', 'locale', 'navigation', 'actions', 'help', 'other'];\n\n  let html = `\n    <div class=\"shortcuts-settings space-y-6\">\n      <!-- Global toggle -->\n      <div class=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n        <div>\n          <label for=\"shortcuts-global-toggle\" class=\"text-sm font-medium text-gray-900 dark:text-white\">\n            Enable keyboard shortcuts\n          </label>\n          <p class=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n            Turn off to disable all keyboard shortcuts\n          </p>\n        </div>\n        <button type=\"button\"\n                id=\"shortcuts-global-toggle\"\n                role=\"switch\"\n                aria-checked=\"${settings.enabled}\"\n                data-settings-action=\"toggle-global\"\n                class=\"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${settings.enabled ? 'bg-blue-600' : 'bg-gray-200 dark:bg-gray-600'}\">\n          <span class=\"sr-only\">Enable keyboard shortcuts</span>\n          <span aria-hidden=\"true\"\n                class=\"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${settings.enabled ? 'translate-x-5' : 'translate-x-0'}\"></span>\n        </button>\n      </div>\n\n      <!-- Per-shortcut toggles -->\n      <div class=\"${settings.enabled ? '' : 'opacity-50 pointer-events-none'}\" data-shortcuts-list>\n  `;\n\n  for (const category of categoryOrder) {\n    const categoryShortcuts = grouped.get(category);\n    if (!categoryShortcuts || categoryShortcuts.length === 0) continue;\n\n    html += `\n      <div class=\"space-y-2\">\n        <h4 class=\"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n          ${categoryLabels[category]}\n        </h4>\n        <div class=\"space-y-1\">\n    `;\n\n    for (const shortcut of categoryShortcuts) {\n      const isEnabled = settings.shortcuts[shortcut.id] !== false;\n      const display = formatShortcutDisplay(shortcut);\n\n      html += `\n        <div class=\"flex items-center justify-between py-2 px-3 rounded hover:bg-gray-50 dark:hover:bg-gray-700/50\">\n          <div class=\"flex items-center gap-3\">\n            <kbd class=\"px-2 py-1 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded text-xs font-mono text-gray-700 dark:text-gray-300\">\n              ${escapeHtml(display)}\n            </kbd>\n            <span class=\"text-sm text-gray-700 dark:text-gray-300\">${escapeHtml(shortcut.description)}</span>\n          </div>\n          <input type=\"checkbox\"\n                 id=\"shortcut-${escapeHtml(shortcut.id)}\"\n                 data-settings-action=\"toggle-shortcut\"\n                 data-shortcut-id=\"${escapeHtml(shortcut.id)}\"\n                 ${isEnabled ? 'checked' : ''}\n                 class=\"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer\"\n                 aria-label=\"Enable ${escapeHtml(shortcut.description)} shortcut\">\n        </div>\n      `;\n    }\n\n    html += `\n        </div>\n      </div>\n    `;\n  }\n\n  html += `\n      </div>\n\n      <!-- Reset button -->\n      <div class=\"pt-4 border-t border-gray-200 dark:border-gray-700\">\n        <button type=\"button\"\n                data-settings-action=\"reset\"\n                class=\"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none focus:underline\">\n          Reset to defaults\n        </button>\n      </div>\n    </div>\n  `;\n\n  container.innerHTML = html;\n\n  // Bind events\n  const globalToggle = container.querySelector<HTMLButtonElement>('[data-settings-action=\"toggle-global\"]');\n  globalToggle?.addEventListener('click', () => {\n    const newSettings: ShortcutSettings = {\n      ...settings,\n      enabled: !settings.enabled,\n    };\n    onSettingsChange(newSettings);\n  });\n\n  const shortcutToggles = container.querySelectorAll<HTMLInputElement>('[data-settings-action=\"toggle-shortcut\"]');\n  shortcutToggles.forEach(toggle => {\n    toggle.addEventListener('change', () => {\n      const shortcutId = toggle.getAttribute('data-shortcut-id');\n      if (!shortcutId) return;\n\n      const newSettings: ShortcutSettings = {\n        ...settings,\n        shortcuts: {\n          ...settings.shortcuts,\n          [shortcutId]: toggle.checked,\n        },\n      };\n      onSettingsChange(newSettings);\n    });\n  });\n\n  const resetBtn = container.querySelector<HTMLButtonElement>('[data-settings-action=\"reset\"]');\n  resetBtn?.addEventListener('click', () => {\n    onSettingsChange({ ...DEFAULT_SHORTCUT_SETTINGS });\n  });\n}\n\n/**\n * Apply persisted settings to a shortcut registry.\n */\nexport function applyShortcutSettings(\n  registry: KeyboardShortcutRegistry,\n  settings: ShortcutSettings\n): void {\n  // Apply global enable/disable\n  const config = registry as unknown as { config: ShortcutRegistryConfig };\n  if (config.config) {\n    config.config.enabled = settings.enabled;\n  }\n\n  // Apply per-shortcut settings\n  for (const shortcut of registry.getShortcuts()) {\n    const isEnabled = settings.shortcuts[shortcut.id] !== false;\n    registry.setEnabled(shortcut.id, isEnabled);\n  }\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\nlet defaultRegistry: KeyboardShortcutRegistry | null = null;\n\n/**\n * Get the default global shortcut registry.\n */\nexport function getDefaultShortcutRegistry(): KeyboardShortcutRegistry {\n  if (!defaultRegistry) {\n    defaultRegistry = new KeyboardShortcutRegistry();\n  }\n  return defaultRegistry;\n}\n\n/**\n * Initialize shortcuts with handlers and bind to document.\n * Automatically loads and applies persisted settings.\n */\nexport function initKeyboardShortcuts(\n  handlers: Parameters<typeof createTranslationShortcuts>[0],\n  config?: ShortcutRegistryConfig\n): KeyboardShortcutRegistry {\n  // Load persisted settings\n  const settings = loadShortcutSettings();\n\n  const registry = new KeyboardShortcutRegistry({\n    ...config,\n    enabled: settings.enabled,\n  });\n  const shortcuts = createTranslationShortcuts(handlers);\n\n  for (const shortcut of shortcuts) {\n    registry.register(shortcut);\n  }\n\n  // Apply per-shortcut settings\n  applyShortcutSettings(registry, settings);\n\n  registry.bind();\n  return registry;\n}\n\n/**\n * Initialize shortcuts with discovery hint support.\n * Shows first-time hint if not previously dismissed.\n */\nexport function initKeyboardShortcutsWithDiscovery(\n  handlers: Parameters<typeof createTranslationShortcuts>[0],\n  config: ShortcutRegistryConfig & {\n    /** Container for discovery hint */\n    hintContainer?: HTMLElement;\n    /** Show help modal callback (for discovery hint) */\n    onShowHelp?: () => void;\n  }\n): KeyboardShortcutRegistry {\n  const registry = initKeyboardShortcuts(handlers, config);\n\n  // Show discovery hint if not dismissed\n  if (config.hintContainer) {\n    renderDiscoveryHint({\n      container: config.hintContainer,\n      onShowHelp: config.onShowHelp,\n      onDismiss: () => {\n        // Hint was dismissed\n      },\n    });\n  }\n\n  return registry;\n}\n","/**\n * Autosave Indicator Component\n *\n * Phase 3a baseline autosave UX for translation forms.\n * Provides visual feedback for autosave states: idle, saving, saved, error.\n *\n * Phase 3b (TX-074): Conflict-aware autosave with recovery UI.\n * Handles AUTOSAVE_CONFLICT errors from backend TX-015.\n *\n * Usage:\n *   const indicator = new AutosaveIndicator({\n *     container: document.querySelector('.autosave-container'),\n *     onSave: async (data) => { await saveToServer(data); },\n *     debounceMs: 1500\n *   });\n *\n *   // Mark form as dirty when user edits\n *   indicator.markDirty(formData);\n *\n *   // Manual save trigger\n *   await indicator.save();\n *\n *   // With conflict handling (TX-074):\n *   const indicator = new AutosaveIndicator({\n *     container: document.querySelector('.autosave-container'),\n *     onSave: async (data) => { await saveToServer(data); },\n *     onConflictResolve: async (resolution) => {\n *       if (resolution.action === 'use_server') {\n *         loadServerVersion(resolution.serverState);\n *       } else if (resolution.action === 'force_save') {\n *         await forceSaveToServer(data);\n *       }\n *     },\n *     enableConflictDetection: true\n *   });\n */\n\nimport type { ToastNotifier } from '../toast/types.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Autosave state machine states.\n * Phase 3a baseline: idle, saving, saved, error.\n * Phase 3b (TX-074): conflict state for version conflicts.\n */\nexport type AutosaveState = 'idle' | 'saving' | 'saved' | 'error' | 'conflict';\n\n/**\n * Conflict information from AUTOSAVE_CONFLICT error (TX-074).\n * Matches backend AutosaveConflictError contract from TX-015.\n */\nexport interface AutosaveConflictInfo {\n  /** Current server version token */\n  version: string;\n  /** Version the client expected */\n  expectedVersion: string;\n  /** Path to fetch latest server state */\n  latestStatePath?: string;\n  /** Latest server state (if provided inline) */\n  latestServerState?: Record<string, unknown>;\n  /** Entity ID that conflicted */\n  entityId?: string;\n  /** Panel/entity type */\n  panel?: string;\n}\n\n/**\n * Resolution action for autosave conflicts.\n */\nexport type ConflictResolutionAction =\n  | 'use_server'   // Discard local changes, use server version\n  | 'force_save'   // Force save local changes (overwrite server)\n  | 'merge'        // Attempt to merge (advanced, optional)\n  | 'dismiss';     // Dismiss conflict, keep local changes but don't save\n\n/**\n * Conflict resolution result passed to callback.\n */\nexport interface ConflictResolution {\n  /** The action chosen by the user */\n  action: ConflictResolutionAction;\n  /** Server state if using server version */\n  serverState?: Record<string, unknown>;\n  /** Local data that was conflicting */\n  localData?: unknown;\n  /** The conflict info */\n  conflict: AutosaveConflictInfo;\n}\n\n/**\n * Configuration for the AutosaveIndicator component.\n */\nexport interface AutosaveIndicatorConfig {\n  /**\n   * Container element to render the indicator into.\n   * If not provided, use renderIndicator() to get HTML string.\n   */\n  container?: HTMLElement;\n\n  /**\n   * Async save handler. Called with current dirty data when autosave triggers.\n   * Should return the saved data or throw on error.\n   * For conflict detection: throw an error with `code: 'AUTOSAVE_CONFLICT'`\n   * and `metadata` containing conflict info.\n   */\n  onSave?: (data: unknown) => Promise<unknown>;\n\n  /**\n   * Debounce delay in milliseconds before triggering autosave.\n   * Default: 1500ms\n   */\n  debounceMs?: number;\n\n  /**\n   * Duration to show \"saved\" state before returning to idle.\n   * Default: 2000ms\n   */\n  savedDurationMs?: number;\n\n  /**\n   * Optional toast notifier for showing save feedback.\n   */\n  notifier?: ToastNotifier;\n\n  /**\n   * Whether to show toast notifications for state changes.\n   * Default: false (only shows indicator)\n   */\n  showToasts?: boolean;\n\n  /**\n   * CSS class prefix for styling.\n   * Default: 'autosave'\n   */\n  classPrefix?: string;\n\n  /**\n   * Labels for each state (for i18n support).\n   */\n  labels?: Partial<AutosaveLabels>;\n\n  // ==========================================================================\n  // Phase 3b Conflict Handling (TX-074)\n  // ==========================================================================\n\n  /**\n   * Enable conflict detection and recovery UI.\n   * When true, AUTOSAVE_CONFLICT errors trigger the conflict state.\n   * Default: false\n   */\n  enableConflictDetection?: boolean;\n\n  /**\n   * Callback when user resolves a conflict.\n   * Called with the resolution action and relevant data.\n   */\n  onConflictResolve?: (resolution: ConflictResolution) => void | Promise<void>;\n\n  /**\n   * Optional handler to fetch latest server state when conflict occurs.\n   * Used when latestServerState is not included inline.\n   */\n  fetchServerState?: (path: string) => Promise<Record<string, unknown>>;\n\n  /**\n   * Whether to show force save option in conflict UI.\n   * Default: true\n   */\n  allowForceSave?: boolean;\n\n  /**\n   * Conflict-specific labels (for i18n support).\n   */\n  conflictLabels?: Partial<ConflictLabels>;\n}\n\n/**\n * Labels for conflict UI (TX-074).\n */\nexport interface ConflictLabels {\n  title: string;\n  message: string;\n  useServer: string;\n  forceSave: string;\n  viewDiff: string;\n  dismiss: string;\n}\n\n/**\n * Labels for autosave states.\n */\nexport interface AutosaveLabels {\n  idle: string;\n  saving: string;\n  saved: string;\n  error: string;\n  conflict: string;\n}\n\n/**\n * Event emitted when autosave state changes.\n */\nexport interface AutosaveStateChangeEvent {\n  previousState: AutosaveState;\n  currentState: AutosaveState;\n  error?: Error;\n  data?: unknown;\n}\n\n/**\n * Callback for state change events.\n */\nexport type AutosaveStateChangeCallback = (event: AutosaveStateChangeEvent) => void;\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nconst DEFAULT_DEBOUNCE_MS = 1500;\nconst DEFAULT_SAVED_DURATION_MS = 2000;\nconst DEFAULT_CLASS_PREFIX = 'autosave';\n\nconst DEFAULT_LABELS: AutosaveLabels = {\n  idle: '',\n  saving: 'Saving...',\n  saved: 'Saved',\n  error: 'Save failed',\n  conflict: 'Conflict detected'\n};\n\nconst DEFAULT_CONFLICT_LABELS: ConflictLabels = {\n  title: 'Save Conflict',\n  message: 'This content was modified by someone else. Choose how to proceed:',\n  useServer: 'Use server version',\n  forceSave: 'Overwrite with my changes',\n  viewDiff: 'View differences',\n  dismiss: 'Dismiss'\n};\n\n// =============================================================================\n// AutosaveIndicator Class\n// =============================================================================\n\n/**\n * AutosaveIndicator manages autosave state and provides visual feedback.\n *\n * State machine:\n *   idle -> saving (on markDirty after debounce)\n *   saving -> saved (on successful save)\n *   saving -> error (on failed save)\n *   saving -> conflict (on AUTOSAVE_CONFLICT error, TX-074)\n *   saved -> idle (after savedDurationMs)\n *   error -> saving (on retry/markDirty)\n *   conflict -> idle (on dismiss or resolve)\n *   conflict -> saving (on force save)\n */\nexport class AutosaveIndicator {\n  private config: Required<Omit<AutosaveIndicatorConfig, 'container' | 'onSave' | 'notifier' | 'onConflictResolve' | 'fetchServerState'>> & {\n    container?: HTMLElement;\n    onSave?: (data: unknown) => Promise<unknown>;\n    notifier?: ToastNotifier;\n    onConflictResolve?: (resolution: ConflictResolution) => void | Promise<void>;\n    fetchServerState?: (path: string) => Promise<Record<string, unknown>>;\n  };\n\n  private state: AutosaveState = 'idle';\n  private conflictInfo: AutosaveConflictInfo | null = null;\n  private pendingData: unknown = null;\n  private lastError: Error | null = null;\n  private debounceTimer: ReturnType<typeof setTimeout> | null = null;\n  private savedTimer: ReturnType<typeof setTimeout> | null = null;\n  private listeners: AutosaveStateChangeCallback[] = [];\n  private isDirty: boolean = false;\n\n  constructor(config: AutosaveIndicatorConfig = {}) {\n    this.config = {\n      container: config.container,\n      onSave: config.onSave,\n      debounceMs: config.debounceMs ?? DEFAULT_DEBOUNCE_MS,\n      savedDurationMs: config.savedDurationMs ?? DEFAULT_SAVED_DURATION_MS,\n      notifier: config.notifier,\n      showToasts: config.showToasts ?? false,\n      classPrefix: config.classPrefix ?? DEFAULT_CLASS_PREFIX,\n      labels: { ...DEFAULT_LABELS, ...config.labels },\n      // Phase 3b conflict handling (TX-074)\n      enableConflictDetection: config.enableConflictDetection ?? false,\n      onConflictResolve: config.onConflictResolve,\n      fetchServerState: config.fetchServerState,\n      allowForceSave: config.allowForceSave ?? true,\n      conflictLabels: { ...DEFAULT_CONFLICT_LABELS, ...config.conflictLabels }\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get current autosave state.\n   */\n  getState(): AutosaveState {\n    return this.state;\n  }\n\n  /**\n   * Check if there are unsaved changes.\n   */\n  hasPendingChanges(): boolean {\n    return this.isDirty || this.pendingData !== null;\n  }\n\n  /**\n   * Get the last error that occurred during save.\n   */\n  getLastError(): Error | null {\n    return this.lastError;\n  }\n\n  /**\n   * Mark form as dirty with new data. Triggers debounced autosave.\n   */\n  markDirty(data?: unknown): void {\n    this.isDirty = true;\n    this.pendingData = data;\n    this.lastError = null;\n\n    this.cancelDebounce();\n\n    if (this.config.onSave) {\n      this.debounceTimer = setTimeout(() => {\n        this.save();\n      }, this.config.debounceMs);\n    }\n\n    // Update indicator if currently showing saved or idle\n    if (this.state === 'saved' || this.state === 'idle') {\n      this.cancelSavedTimer();\n      // Don't change state yet - wait for save to trigger\n    }\n\n    this.render();\n  }\n\n  /**\n   * Mark form as clean (no pending changes).\n   */\n  markClean(): void {\n    this.isDirty = false;\n    this.pendingData = null;\n    this.cancelDebounce();\n    this.setState('idle');\n  }\n\n  /**\n   * Trigger save immediately (bypassing debounce).\n   */\n  async save(): Promise<boolean> {\n    if (!this.config.onSave) {\n      return true;\n    }\n\n    if (!this.isDirty && this.pendingData === null) {\n      return true;\n    }\n\n    this.cancelDebounce();\n    const dataToSave = this.pendingData;\n\n    this.setState('saving');\n\n    try {\n      await this.config.onSave(dataToSave);\n      this.isDirty = false;\n      this.pendingData = null;\n      this.lastError = null;\n      this.conflictInfo = null;\n      this.setState('saved');\n\n      // Auto-transition back to idle after duration\n      this.savedTimer = setTimeout(() => {\n        if (this.state === 'saved') {\n          this.setState('idle');\n        }\n      }, this.config.savedDurationMs);\n\n      return true;\n    } catch (error) {\n      this.lastError = error instanceof Error ? error : new Error(String(error));\n\n      // Check for conflict error (TX-074)\n      if (this.config.enableConflictDetection && this.isConflictError(error)) {\n        this.conflictInfo = this.extractConflictInfo(error);\n        this.setState('conflict');\n        return false;\n      }\n\n      this.setState('error');\n      return false;\n    }\n  }\n\n  /**\n   * Retry a failed save.\n   */\n  async retry(): Promise<boolean> {\n    if (this.state !== 'error' && this.state !== 'conflict') {\n      return true;\n    }\n    this.conflictInfo = null;\n    return this.save();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Conflict Handling (TX-074)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get current conflict info if in conflict state.\n   */\n  getConflictInfo(): AutosaveConflictInfo | null {\n    return this.conflictInfo;\n  }\n\n  /**\n   * Check if in conflict state.\n   */\n  isInConflict(): boolean {\n    return this.state === 'conflict' && this.conflictInfo !== null;\n  }\n\n  /**\n   * Resolve conflict by using server version (discard local changes).\n   */\n  async resolveWithServerVersion(): Promise<void> {\n    if (!this.isInConflict() || !this.conflictInfo) return;\n\n    const conflict = this.conflictInfo;\n    let serverState = conflict.latestServerState;\n\n    // Fetch server state if not provided inline\n    if (!serverState && conflict.latestStatePath && this.config.fetchServerState) {\n      try {\n        serverState = await this.config.fetchServerState(conflict.latestStatePath);\n      } catch {\n        // Failed to fetch, show error\n        this.lastError = new Error('Failed to fetch server version');\n        this.setState('error');\n        return;\n      }\n    }\n\n    const resolution: ConflictResolution = {\n      action: 'use_server',\n      serverState,\n      localData: this.pendingData,\n      conflict\n    };\n\n    // Clear local state\n    this.isDirty = false;\n    this.pendingData = null;\n    this.conflictInfo = null;\n    this.setState('idle');\n\n    // Notify caller\n    if (this.config.onConflictResolve) {\n      try {\n        await this.config.onConflictResolve(resolution);\n      } catch {\n        // Ignore callback errors\n      }\n    }\n  }\n\n  /**\n   * Resolve conflict by forcing save (overwrite server version).\n   */\n  async resolveWithForceSave(): Promise<boolean> {\n    if (!this.isInConflict() || !this.conflictInfo) return true;\n    if (!this.config.allowForceSave) return false;\n\n    const conflict = this.conflictInfo;\n\n    const resolution: ConflictResolution = {\n      action: 'force_save',\n      localData: this.pendingData,\n      conflict\n    };\n\n    // Notify caller that force save was requested\n    if (this.config.onConflictResolve) {\n      try {\n        await this.config.onConflictResolve(resolution);\n      } catch {\n        // Ignore callback errors\n      }\n    }\n\n    // Clear conflict state and retry save\n    this.conflictInfo = null;\n    return this.save();\n  }\n\n  /**\n   * Dismiss conflict without resolving (keep local changes but don't save).\n   */\n  dismissConflict(): void {\n    if (!this.isInConflict() || !this.conflictInfo) return;\n\n    const conflict = this.conflictInfo;\n\n    const resolution: ConflictResolution = {\n      action: 'dismiss',\n      localData: this.pendingData,\n      conflict\n    };\n\n    this.conflictInfo = null;\n    this.setState('idle');\n\n    // Notify caller\n    if (this.config.onConflictResolve) {\n      try {\n        this.config.onConflictResolve(resolution);\n      } catch {\n        // Ignore callback errors\n      }\n    }\n  }\n\n  /**\n   * Check if an error is an autosave conflict error.\n   */\n  private isConflictError(error: unknown): boolean {\n    if (!error) return false;\n\n    // Check for error code\n    const errorObj = error as { code?: string; text_code?: string; name?: string };\n    if (errorObj.code === 'AUTOSAVE_CONFLICT' || errorObj.text_code === 'AUTOSAVE_CONFLICT') {\n      return true;\n    }\n    if (errorObj.name === 'AutosaveConflictError') {\n      return true;\n    }\n\n    // Check error message\n    const message = error instanceof Error ? error.message : String(error);\n    if (message.toLowerCase().includes('autosave conflict')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Extract conflict info from an error.\n   */\n  private extractConflictInfo(error: unknown): AutosaveConflictInfo {\n    const errorObj = error as {\n      metadata?: {\n        version?: string;\n        expected_version?: string;\n        latest_state_path?: string;\n        latest_server_state?: Record<string, unknown>;\n        entity_id?: string;\n        panel?: string;\n      };\n      version?: string;\n      expectedVersion?: string;\n      latestStatePath?: string;\n      latestServerState?: Record<string, unknown>;\n      entityId?: string;\n      panel?: string;\n    };\n\n    // Try metadata first (backend response format)\n    const metadata = errorObj.metadata;\n    if (metadata) {\n      return {\n        version: metadata.version || '',\n        expectedVersion: metadata.expected_version || '',\n        latestStatePath: metadata.latest_state_path,\n        latestServerState: metadata.latest_server_state,\n        entityId: metadata.entity_id,\n        panel: metadata.panel\n      };\n    }\n\n    // Fall back to direct properties\n    return {\n      version: errorObj.version || '',\n      expectedVersion: errorObj.expectedVersion || '',\n      latestStatePath: errorObj.latestStatePath,\n      latestServerState: errorObj.latestServerState,\n      entityId: errorObj.entityId,\n      panel: errorObj.panel\n    };\n  }\n\n  /**\n   * Add a state change listener.\n   */\n  onStateChange(callback: AutosaveStateChangeCallback): () => void {\n    this.listeners.push(callback);\n    return () => {\n      const index = this.listeners.indexOf(callback);\n      if (index >= 0) {\n        this.listeners.splice(index, 1);\n      }\n    };\n  }\n\n  /**\n   * Render the indicator HTML.\n   * Call this to get HTML string for manual rendering.\n   */\n  renderIndicator(): string {\n    const prefix = this.config.classPrefix;\n    const labels = this.config.labels;\n\n    const stateClass = `${prefix}--${this.state}`;\n    const label = labels[this.state] || '';\n    const icon = this.getStateIcon();\n\n    // Conflict state renders expanded UI (TX-074)\n    if (this.state === 'conflict') {\n      return this.renderConflictUI();\n    }\n\n    return `<div class=\"${prefix} ${stateClass}\" role=\"status\" aria-live=\"polite\" aria-atomic=\"true\">\n      <span class=\"${prefix}__icon\">${icon}</span>\n      <span class=\"${prefix}__label\">${label}</span>\n      ${this.state === 'error' ? `<button type=\"button\" class=\"${prefix}__retry\" aria-label=\"Retry save\">Retry</button>` : ''}\n    </div>`;\n  }\n\n  /**\n   * Render conflict recovery UI (TX-074).\n   */\n  renderConflictUI(): string {\n    const prefix = this.config.classPrefix;\n    const labels = this.config.conflictLabels;\n\n    return `<div class=\"${prefix} ${prefix}--conflict\" role=\"alertdialog\" aria-labelledby=\"${prefix}-conflict-title\" aria-describedby=\"${prefix}-conflict-desc\">\n      <div class=\"${prefix}__conflict-header\">\n        <span class=\"${prefix}__icon\">${this.getStateIcon()}</span>\n        <span id=\"${prefix}-conflict-title\" class=\"${prefix}__conflict-title\">${labels.title}</span>\n      </div>\n      <p id=\"${prefix}-conflict-desc\" class=\"${prefix}__conflict-message\">${labels.message}</p>\n      <div class=\"${prefix}__conflict-actions\">\n        <button type=\"button\" class=\"${prefix}__conflict-use-server\" aria-label=\"${labels.useServer}\">\n          ${labels.useServer}\n        </button>\n        ${this.config.allowForceSave ? `\n          <button type=\"button\" class=\"${prefix}__conflict-force-save\" aria-label=\"${labels.forceSave}\">\n            ${labels.forceSave}\n          </button>\n        ` : ''}\n        <button type=\"button\" class=\"${prefix}__conflict-dismiss\" aria-label=\"${labels.dismiss}\">\n          ${labels.dismiss}\n        </button>\n      </div>\n    </div>`;\n  }\n\n  /**\n   * Render indicator into configured container.\n   */\n  render(): void {\n    if (this.config.container) {\n      this.config.container.innerHTML = this.renderIndicator();\n      this.bindRetryButton();\n      this.bindConflictButtons();\n    }\n  }\n\n  /**\n   * Clean up timers and listeners.\n   */\n  destroy(): void {\n    this.cancelDebounce();\n    this.cancelSavedTimer();\n    this.listeners = [];\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Methods\n  // ---------------------------------------------------------------------------\n\n  private setState(newState: AutosaveState): void {\n    if (newState === this.state) return;\n\n    const previousState = this.state;\n    this.state = newState;\n\n    // Emit state change event\n    const event: AutosaveStateChangeEvent = {\n      previousState,\n      currentState: newState,\n      error: this.lastError ?? undefined,\n      data: this.pendingData ?? undefined\n    };\n\n    for (const listener of this.listeners) {\n      try {\n        listener(event);\n      } catch {\n        // Ignore listener errors\n      }\n    }\n\n    // Show toast if enabled\n    if (this.config.showToasts && this.config.notifier) {\n      this.showToast(newState);\n    }\n\n    this.render();\n  }\n\n  private showToast(state: AutosaveState): void {\n    const notifier = this.config.notifier;\n    if (!notifier) return;\n\n    switch (state) {\n      case 'saved':\n        notifier.success(this.config.labels.saved ?? DEFAULT_LABELS.saved, 2000);\n        break;\n      case 'error':\n        notifier.error(this.lastError?.message ?? this.config.labels.error ?? DEFAULT_LABELS.error);\n        break;\n      case 'conflict':\n        notifier.warning?.(this.config.labels.conflict ?? DEFAULT_LABELS.conflict);\n        break;\n    }\n  }\n\n  private getStateIcon(): string {\n    switch (this.state) {\n      case 'saving':\n        return `<svg class=\"${this.config.classPrefix}__spinner\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <circle cx=\"8\" cy=\"8\" r=\"6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-dasharray=\"28\" stroke-dashoffset=\"7\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 8 8\" to=\"360 8 8\" dur=\"1s\" repeatCount=\"indefinite\"/>\n          </circle>\n        </svg>`;\n      case 'saved':\n        return `<svg viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M3 8.5L6.5 12L13 4\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>`;\n      case 'error':\n        return `<svg viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <circle cx=\"8\" cy=\"8\" r=\"6\" stroke=\"currentColor\" stroke-width=\"2\"/>\n          <path d=\"M8 5v4M8 11v.5\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`;\n      case 'conflict':\n        // Warning triangle icon for conflict state (TX-074)\n        return `<svg viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M8 1L15 14H1L8 1Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linejoin=\"round\"/>\n          <path d=\"M8 6v4M8 12v.5\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\n        </svg>`;\n      default:\n        return '';\n    }\n  }\n\n  private bindConflictButtons(): void {\n    if (!this.config.container || this.state !== 'conflict') return;\n\n    const prefix = this.config.classPrefix;\n\n    const useServerBtn = this.config.container.querySelector(`.${prefix}__conflict-use-server`);\n    if (useServerBtn) {\n      useServerBtn.addEventListener('click', () => this.resolveWithServerVersion());\n    }\n\n    const forceSaveBtn = this.config.container.querySelector(`.${prefix}__conflict-force-save`);\n    if (forceSaveBtn) {\n      forceSaveBtn.addEventListener('click', () => this.resolveWithForceSave());\n    }\n\n    const dismissBtn = this.config.container.querySelector(`.${prefix}__conflict-dismiss`);\n    if (dismissBtn) {\n      dismissBtn.addEventListener('click', () => this.dismissConflict());\n    }\n  }\n\n  private cancelDebounce(): void {\n    if (this.debounceTimer) {\n      clearTimeout(this.debounceTimer);\n      this.debounceTimer = null;\n    }\n  }\n\n  private cancelSavedTimer(): void {\n    if (this.savedTimer) {\n      clearTimeout(this.savedTimer);\n      this.savedTimer = null;\n    }\n  }\n\n  private bindRetryButton(): void {\n    if (!this.config.container) return;\n    const retryBtn = this.config.container.querySelector(`.${this.config.classPrefix}__retry`);\n    if (retryBtn) {\n      retryBtn.addEventListener('click', () => this.retry());\n    }\n  }\n}\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\n/**\n * Create an AutosaveIndicator with common defaults for translation forms.\n */\nexport function createTranslationAutosave(config: AutosaveIndicatorConfig): AutosaveIndicator {\n  return new AutosaveIndicator({\n    debounceMs: 1500,\n    savedDurationMs: 2000,\n    showToasts: false,\n    labels: {\n      idle: '',\n      saving: 'Saving...',\n      saved: 'All changes saved',\n      error: 'Failed to save',\n      conflict: 'Conflict detected'\n    },\n    // Enable conflict detection by default for translation forms (TX-074)\n    enableConflictDetection: true,\n    allowForceSave: true,\n    ...config\n  });\n}\n\n/**\n * Render a standalone autosave indicator HTML string.\n */\nexport function renderAutosaveIndicator(\n  state: AutosaveState,\n  options: {\n    classPrefix?: string;\n    labels?: Partial<AutosaveLabels>;\n  } = {}\n): string {\n  const prefix = options.classPrefix ?? DEFAULT_CLASS_PREFIX;\n  const labels = { ...DEFAULT_LABELS, ...options.labels };\n  const label = labels[state] || '';\n\n  let icon = '';\n  switch (state) {\n    case 'saving':\n      icon = `<span class=\"${prefix}__spinner\"></span>`;\n      break;\n    case 'saved':\n      icon = `<span class=\"${prefix}__check\">✓</span>`;\n      break;\n    case 'error':\n      icon = `<span class=\"${prefix}__error\">!</span>`;\n      break;\n    case 'conflict':\n      icon = `<span class=\"${prefix}__conflict-icon\">⚠</span>`;\n      break;\n  }\n\n  return `<div class=\"${prefix} ${prefix}--${state}\" role=\"status\" aria-live=\"polite\">\n    ${icon}\n    <span class=\"${prefix}__label\">${label}</span>\n  </div>`;\n}\n\n/**\n * Get CSS variables for autosave indicator styling.\n */\nexport function getAutosaveIndicatorStyles(classPrefix: string = DEFAULT_CLASS_PREFIX): string {\n  return `\n    .${classPrefix} {\n      display: inline-flex;\n      align-items: center;\n      gap: 0.375rem;\n      font-size: 0.75rem;\n      color: var(--autosave-color, #6b7280);\n      transition: opacity 200ms ease;\n    }\n\n    .${classPrefix}--idle {\n      opacity: 0;\n    }\n\n    .${classPrefix}--saving {\n      color: var(--autosave-saving-color, #3b82f6);\n    }\n\n    .${classPrefix}--saved {\n      color: var(--autosave-saved-color, #10b981);\n    }\n\n    .${classPrefix}--error {\n      color: var(--autosave-error-color, #ef4444);\n    }\n\n    .${classPrefix}__icon {\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      width: 1rem;\n      height: 1rem;\n    }\n\n    .${classPrefix}__icon svg {\n      width: 100%;\n      height: 100%;\n    }\n\n    .${classPrefix}__spinner {\n      animation: ${classPrefix}-spin 1s linear infinite;\n    }\n\n    .${classPrefix}__retry {\n      margin-left: 0.5rem;\n      padding: 0.125rem 0.375rem;\n      font-size: 0.75rem;\n      color: var(--autosave-retry-color, #3b82f6);\n      background: transparent;\n      border: 1px solid currentColor;\n      border-radius: 0.25rem;\n      cursor: pointer;\n      transition: background-color 150ms ease;\n    }\n\n    .${classPrefix}__retry:hover {\n      background-color: var(--autosave-retry-hover-bg, rgba(59, 130, 246, 0.1));\n    }\n\n    @keyframes ${classPrefix}-spin {\n      from { transform: rotate(0deg); }\n      to { transform: rotate(360deg); }\n    }\n\n    /* Conflict state styles (TX-074) */\n    .${classPrefix}--conflict {\n      color: var(--autosave-conflict-color, #f59e0b);\n      padding: 0.75rem;\n      background: var(--autosave-conflict-bg, #fffbeb);\n      border: 1px solid var(--autosave-conflict-border, #fcd34d);\n      border-radius: 0.5rem;\n      flex-direction: column;\n      align-items: stretch;\n      gap: 0.5rem;\n    }\n\n    .${classPrefix}__conflict-header {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n    }\n\n    .${classPrefix}__conflict-title {\n      font-weight: 600;\n      color: var(--autosave-conflict-title-color, #92400e);\n    }\n\n    .${classPrefix}__conflict-message {\n      font-size: 0.75rem;\n      color: var(--autosave-conflict-message-color, #78350f);\n      margin: 0;\n    }\n\n    .${classPrefix}__conflict-actions {\n      display: flex;\n      gap: 0.5rem;\n      flex-wrap: wrap;\n      margin-top: 0.25rem;\n    }\n\n    .${classPrefix}__conflict-actions button {\n      padding: 0.25rem 0.5rem;\n      font-size: 0.75rem;\n      border-radius: 0.25rem;\n      cursor: pointer;\n      transition: background-color 150ms ease;\n    }\n\n    .${classPrefix}__conflict-use-server {\n      color: white;\n      background: var(--autosave-conflict-use-server-bg, #3b82f6);\n      border: none;\n    }\n\n    .${classPrefix}__conflict-use-server:hover {\n      background: var(--autosave-conflict-use-server-hover-bg, #2563eb);\n    }\n\n    .${classPrefix}__conflict-force-save {\n      color: var(--autosave-conflict-force-color, #ef4444);\n      background: transparent;\n      border: 1px solid currentColor;\n    }\n\n    .${classPrefix}__conflict-force-save:hover {\n      background: var(--autosave-conflict-force-hover-bg, rgba(239, 68, 68, 0.1));\n    }\n\n    .${classPrefix}__conflict-dismiss {\n      color: var(--autosave-conflict-dismiss-color, #6b7280);\n      background: transparent;\n      border: 1px solid var(--autosave-conflict-dismiss-border, #d1d5db);\n    }\n\n    .${classPrefix}__conflict-dismiss:hover {\n      background: var(--autosave-conflict-dismiss-hover-bg, #f3f4f6);\n    }\n  `;\n}\n\n/**\n * Initialize autosave behavior on a form element.\n * Automatically tracks changes and triggers save.\n */\nexport function initFormAutosave(\n  form: HTMLFormElement,\n  config: AutosaveIndicatorConfig & {\n    /**\n     * Fields to watch for changes. If not specified, watches all inputs.\n     */\n    watchFields?: string[];\n\n    /**\n     * Selector for where to render the indicator within the form.\n     */\n    indicatorSelector?: string;\n  }\n): AutosaveIndicator {\n  const { watchFields, indicatorSelector, ...indicatorConfig } = config;\n\n  // Find or create indicator container\n  let container = indicatorConfig.container;\n  if (!container && indicatorSelector) {\n    container = form.querySelector<HTMLElement>(indicatorSelector) ?? undefined;\n  }\n\n  const indicator = new AutosaveIndicator({\n    ...indicatorConfig,\n    container\n  });\n\n  // Get form data helper\n  const getFormData = (): Record<string, unknown> => {\n    const formData = new FormData(form);\n    const data: Record<string, unknown> = {};\n    formData.forEach((value, key) => {\n      data[key] = value;\n    });\n    return data;\n  };\n\n  // Change handler\n  const handleChange = (event: Event): void => {\n    const target = event.target as HTMLElement;\n    if (!target) return;\n\n    // Check if we should watch this field\n    if (watchFields && watchFields.length > 0) {\n      const fieldName = (target as HTMLInputElement).name;\n      if (!fieldName || !watchFields.includes(fieldName)) {\n        return;\n      }\n    }\n\n    indicator.markDirty(getFormData());\n  };\n\n  // Bind change listeners\n  form.addEventListener('input', handleChange);\n  form.addEventListener('change', handleChange);\n\n  // Save on form submit\n  form.addEventListener('submit', async (event) => {\n    if (indicator.hasPendingChanges()) {\n      event.preventDefault();\n      const success = await indicator.save();\n      if (success) {\n        // Re-submit after save\n        form.submit();\n      }\n    }\n  });\n\n  // Warn before leaving with unsaved changes\n  const beforeUnloadHandler = (event: BeforeUnloadEvent): void => {\n    if (indicator.hasPendingChanges()) {\n      event.preventDefault();\n      event.returnValue = '';\n    }\n  };\n  window.addEventListener('beforeunload', beforeUnloadHandler);\n\n  // Save on visibility change (tab switch)\n  const visibilityHandler = (): void => {\n    if (document.hidden && indicator.hasPendingChanges()) {\n      indicator.save();\n    }\n  };\n  document.addEventListener('visibilitychange', visibilityHandler);\n\n  // Extend destroy to clean up listeners\n  const originalDestroy = indicator.destroy.bind(indicator);\n  indicator.destroy = (): void => {\n    form.removeEventListener('input', handleChange);\n    form.removeEventListener('change', handleChange);\n    window.removeEventListener('beforeunload', beforeUnloadHandler);\n    document.removeEventListener('visibilitychange', visibilityHandler);\n    originalDestroy();\n  };\n\n  return indicator;\n}\n","/**\n * Field-Level Helpers for Translation Forms\n *\n * Phase 3 translation UX: character counters, interpolation preview, RTL/LTR toggle.\n * These helpers enhance text input fields with translation-specific features.\n *\n * Features:\n * - Character counter with soft/hard thresholds\n * - Interpolation preview for template variables ({{name}}, {0}, %s, etc.)\n * - RTL/LTR text direction toggle with persistence\n * - Schema-driven configuration when available\n */\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Character counter threshold configuration.\n */\nexport interface CharacterCounterThreshold {\n  /**\n   * Character limit for this threshold.\n   */\n  limit: number;\n\n  /**\n   * Severity level: 'info' | 'warning' | 'error'.\n   */\n  severity: 'info' | 'warning' | 'error';\n\n  /**\n   * Optional message to display when threshold is reached.\n   */\n  message?: string;\n}\n\n/**\n * Character counter configuration.\n */\nexport interface CharacterCounterConfig {\n  /**\n   * Target input element.\n   */\n  input: HTMLInputElement | HTMLTextAreaElement;\n\n  /**\n   * Container element for the counter display.\n   * If not provided, counter is appended after input.\n   */\n  container?: HTMLElement;\n\n  /**\n   * Soft limit (warning threshold).\n   */\n  softLimit?: number;\n\n  /**\n   * Hard limit (error/maximum threshold).\n   */\n  hardLimit?: number;\n\n  /**\n   * Custom thresholds for more granular control.\n   */\n  thresholds?: CharacterCounterThreshold[];\n\n  /**\n   * Whether to enforce hard limit by preventing input.\n   * Default: false\n   */\n  enforceHardLimit?: boolean;\n\n  /**\n   * CSS class prefix.\n   * Default: 'char-counter'\n   */\n  classPrefix?: string;\n\n  /**\n   * Custom format function for the counter display.\n   */\n  formatDisplay?: (current: number, limit?: number) => string;\n}\n\n/**\n * Interpolation pattern definition.\n */\nexport interface InterpolationPattern {\n  /**\n   * Regex pattern to match interpolation syntax.\n   */\n  pattern: RegExp;\n\n  /**\n   * Name of this pattern type (for display).\n   */\n  name: string;\n\n  /**\n   * Example of the pattern.\n   */\n  example: string;\n}\n\n/**\n * Interpolation preview configuration.\n */\nexport interface InterpolationPreviewConfig {\n  /**\n   * Target input element.\n   */\n  input: HTMLInputElement | HTMLTextAreaElement;\n\n  /**\n   * Container element for the preview display.\n   */\n  container?: HTMLElement;\n\n  /**\n   * Sample values to use for preview.\n   */\n  sampleValues?: Record<string, string>;\n\n  /**\n   * Custom patterns to detect (in addition to defaults).\n   */\n  customPatterns?: InterpolationPattern[];\n\n  /**\n   * Whether to highlight variables in the preview.\n   * Default: true\n   */\n  highlightVariables?: boolean;\n\n  /**\n   * CSS class prefix.\n   * Default: 'interpolation-preview'\n   */\n  classPrefix?: string;\n}\n\n/**\n * RTL/LTR toggle configuration.\n */\nexport interface DirectionToggleConfig {\n  /**\n   * Target input element.\n   */\n  input: HTMLInputElement | HTMLTextAreaElement;\n\n  /**\n   * Container element for the toggle button.\n   */\n  container?: HTMLElement;\n\n  /**\n   * Initial direction.\n   * Default: auto-detected or 'ltr'\n   */\n  initialDirection?: 'ltr' | 'rtl' | 'auto';\n\n  /**\n   * Persistence key for localStorage.\n   * If provided, direction is persisted per field.\n   */\n  persistenceKey?: string;\n\n  /**\n   * CSS class prefix.\n   * Default: 'dir-toggle'\n   */\n  classPrefix?: string;\n\n  /**\n   * Callback when direction changes.\n   */\n  onChange?: (direction: 'ltr' | 'rtl') => void;\n}\n\n/**\n * Field helper state.\n */\nexport interface FieldHelperState {\n  charCount: number;\n  severity: 'info' | 'warning' | 'error' | null;\n  direction: 'ltr' | 'rtl';\n  interpolations: InterpolationMatch[];\n}\n\n/**\n * Interpolation match result.\n */\nexport interface InterpolationMatch {\n  pattern: string;\n  variable: string;\n  start: number;\n  end: number;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nconst DEFAULT_CHAR_COUNTER_PREFIX = 'char-counter';\nconst DEFAULT_INTERPOLATION_PREFIX = 'interpolation-preview';\nconst DEFAULT_DIR_TOGGLE_PREFIX = 'dir-toggle';\n\n/**\n * Default interpolation patterns for common template syntaxes.\n */\nexport const DEFAULT_INTERPOLATION_PATTERNS: InterpolationPattern[] = [\n  // Mustache/Handlebars: {{name}}, {{user.name}}\n  { pattern: /\\{\\{(\\w+(?:\\.\\w+)*)\\}\\}/g, name: 'Mustache', example: '{{name}}' },\n  // ICU MessageFormat: {name}, {count, plural, ...}\n  { pattern: /\\{(\\w+)(?:,\\s*\\w+(?:,\\s*[^}]+)?)?\\}/g, name: 'ICU', example: '{name}' },\n  // Printf: %s, %d, %1$s\n  { pattern: /%(\\d+\\$)?[sdfc]/g, name: 'Printf', example: '%s' },\n  // Ruby/Python named: %(name)s, ${name}\n  { pattern: /%\\((\\w+)\\)[sdf]/g, name: 'Named Printf', example: '%(name)s' },\n  { pattern: /\\$\\{(\\w+)\\}/g, name: 'Template Literal', example: '${name}' }\n];\n\n/**\n * Default sample values for interpolation preview.\n */\nexport const DEFAULT_SAMPLE_VALUES: Record<string, string> = {\n  name: 'John',\n  count: '5',\n  email: 'user@example.com',\n  date: '2024-01-15',\n  price: '$29.99',\n  user: 'Jane',\n  item: 'Product',\n  total: '100'\n};\n\n// =============================================================================\n// CharacterCounter Class\n// =============================================================================\n\n/**\n * Character counter for text inputs with threshold support.\n */\nexport class CharacterCounter {\n  private config: Required<Omit<CharacterCounterConfig, 'container' | 'thresholds' | 'formatDisplay' | 'softLimit' | 'hardLimit'>> & {\n    container?: HTMLElement;\n    thresholds: CharacterCounterThreshold[];\n    formatDisplay: (current: number, limit?: number) => string;\n    softLimit?: number;\n    hardLimit?: number;\n  };\n\n  private counterEl: HTMLElement | null = null;\n  private boundUpdate: () => void;\n\n  constructor(config: CharacterCounterConfig) {\n    this.config = {\n      input: config.input,\n      container: config.container,\n      softLimit: config.softLimit,\n      hardLimit: config.hardLimit,\n      thresholds: config.thresholds ?? this.buildDefaultThresholds(config),\n      enforceHardLimit: config.enforceHardLimit ?? false,\n      classPrefix: config.classPrefix ?? DEFAULT_CHAR_COUNTER_PREFIX,\n      formatDisplay: config.formatDisplay ?? this.defaultFormatDisplay.bind(this)\n    };\n\n    this.boundUpdate = this.update.bind(this);\n    this.init();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get current character count.\n   */\n  getCount(): number {\n    return this.config.input.value.length;\n  }\n\n  /**\n   * Get current severity based on thresholds.\n   */\n  getSeverity(): 'info' | 'warning' | 'error' | null {\n    const count = this.getCount();\n\n    // Sort thresholds by limit descending\n    const sortedThresholds = [...this.config.thresholds].sort((a, b) => b.limit - a.limit);\n\n    for (const threshold of sortedThresholds) {\n      if (count >= threshold.limit) {\n        return threshold.severity;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Update the counter display.\n   */\n  update(): void {\n    const count = this.getCount();\n    const severity = this.getSeverity();\n    const limit = this.config.hardLimit ?? this.config.softLimit;\n\n    // Enforce hard limit if configured\n    if (this.config.enforceHardLimit && this.config.hardLimit && count > this.config.hardLimit) {\n      this.config.input.value = this.config.input.value.slice(0, this.config.hardLimit);\n    }\n\n    if (this.counterEl) {\n      this.counterEl.textContent = this.config.formatDisplay(count, limit);\n      this.counterEl.className = this.buildCounterClasses(severity);\n\n      // Set ARIA attributes\n      this.counterEl.setAttribute('aria-live', 'polite');\n      if (severity === 'error') {\n        this.counterEl.setAttribute('role', 'alert');\n      } else {\n        this.counterEl.removeAttribute('role');\n      }\n    }\n  }\n\n  /**\n   * Render the counter HTML.\n   */\n  render(): string {\n    const count = this.getCount();\n    const severity = this.getSeverity();\n    const limit = this.config.hardLimit ?? this.config.softLimit;\n\n    return `<span class=\"${this.buildCounterClasses(severity)}\" aria-live=\"polite\">${this.config.formatDisplay(count, limit)}</span>`;\n  }\n\n  /**\n   * Clean up event listeners.\n   */\n  destroy(): void {\n    this.config.input.removeEventListener('input', this.boundUpdate);\n    this.config.input.removeEventListener('change', this.boundUpdate);\n    if (this.counterEl?.parentElement) {\n      this.counterEl.parentElement.removeChild(this.counterEl);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Methods\n  // ---------------------------------------------------------------------------\n\n  private init(): void {\n    // Create counter element\n    this.counterEl = document.createElement('span');\n    this.counterEl.className = this.buildCounterClasses(null);\n\n    // Mount counter\n    if (this.config.container) {\n      this.config.container.appendChild(this.counterEl);\n    } else {\n      this.config.input.parentElement?.insertBefore(\n        this.counterEl,\n        this.config.input.nextSibling\n      );\n    }\n\n    // Bind events\n    this.config.input.addEventListener('input', this.boundUpdate);\n    this.config.input.addEventListener('change', this.boundUpdate);\n\n    // Initial update\n    this.update();\n  }\n\n  private buildDefaultThresholds(config: CharacterCounterConfig): CharacterCounterThreshold[] {\n    const thresholds: CharacterCounterThreshold[] = [];\n\n    if (config.softLimit) {\n      thresholds.push({\n        limit: config.softLimit,\n        severity: 'warning',\n        message: `Approaching limit (${config.softLimit} characters)`\n      });\n    }\n\n    if (config.hardLimit) {\n      thresholds.push({\n        limit: config.hardLimit,\n        severity: 'error',\n        message: `Maximum limit reached (${config.hardLimit} characters)`\n      });\n    }\n\n    return thresholds;\n  }\n\n  private buildCounterClasses(severity: 'info' | 'warning' | 'error' | null): string {\n    const prefix = this.config.classPrefix;\n    const classes = [prefix];\n\n    if (severity) {\n      classes.push(`${prefix}--${severity}`);\n    }\n\n    return classes.join(' ');\n  }\n\n  private defaultFormatDisplay(current: number, limit?: number): string {\n    if (limit) {\n      return `${current} / ${limit}`;\n    }\n    return `${current}`;\n  }\n}\n\n// =============================================================================\n// InterpolationPreview Class\n// =============================================================================\n\n/**\n * Interpolation preview for template variables in translation text.\n */\nexport class InterpolationPreview {\n  private config: Required<Omit<InterpolationPreviewConfig, 'container' | 'customPatterns'>> & {\n    container?: HTMLElement;\n    patterns: InterpolationPattern[];\n  };\n\n  private previewEl: HTMLElement | null = null;\n  private boundUpdate: () => void;\n\n  constructor(config: InterpolationPreviewConfig) {\n    this.config = {\n      input: config.input,\n      container: config.container,\n      sampleValues: config.sampleValues ?? DEFAULT_SAMPLE_VALUES,\n      patterns: [...DEFAULT_INTERPOLATION_PATTERNS, ...(config.customPatterns ?? [])],\n      highlightVariables: config.highlightVariables ?? true,\n      classPrefix: config.classPrefix ?? DEFAULT_INTERPOLATION_PREFIX\n    };\n\n    this.boundUpdate = this.update.bind(this);\n    this.init();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get all interpolation matches in the current text.\n   */\n  getMatches(): InterpolationMatch[] {\n    const text = this.config.input.value;\n    const matches: InterpolationMatch[] = [];\n\n    for (const patternDef of this.config.patterns) {\n      // Reset pattern lastIndex for global patterns\n      patternDef.pattern.lastIndex = 0;\n\n      let match: RegExpExecArray | null;\n      while ((match = patternDef.pattern.exec(text)) !== null) {\n        matches.push({\n          pattern: patternDef.name,\n          variable: match[1] ?? match[0],\n          start: match.index,\n          end: match.index + match[0].length\n        });\n      }\n    }\n\n    return matches;\n  }\n\n  /**\n   * Get preview text with sample values substituted.\n   */\n  getPreviewText(): string {\n    let text = this.config.input.value;\n\n    for (const patternDef of this.config.patterns) {\n      patternDef.pattern.lastIndex = 0;\n      text = text.replace(patternDef.pattern, (match, variable) => {\n        const varName = variable ?? match;\n        const normalized = varName.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n\n        // Try to find a matching sample value\n        for (const [key, value] of Object.entries(this.config.sampleValues)) {\n          if (key.toLowerCase() === normalized) {\n            return value;\n          }\n        }\n\n        // Return the match highlighted if no sample found\n        return match;\n      });\n    }\n\n    return text;\n  }\n\n  /**\n   * Update the preview display.\n   */\n  update(): void {\n    if (!this.previewEl) return;\n\n    const matches = this.getMatches();\n    const hasInterpolations = matches.length > 0;\n\n    if (!hasInterpolations) {\n      this.previewEl.classList.add(`${this.config.classPrefix}--empty`);\n      this.previewEl.innerHTML = '';\n      return;\n    }\n\n    this.previewEl.classList.remove(`${this.config.classPrefix}--empty`);\n\n    if (this.config.highlightVariables) {\n      this.previewEl.innerHTML = this.renderHighlightedPreview();\n    } else {\n      this.previewEl.textContent = this.getPreviewText();\n    }\n  }\n\n  /**\n   * Render preview with highlighted variables.\n   */\n  renderHighlightedPreview(): string {\n    const text = this.config.input.value;\n    const matches = this.getMatches();\n    const prefix = this.config.classPrefix;\n\n    if (matches.length === 0) {\n      return this.escapeHtml(text);\n    }\n\n    // Sort matches by start position\n    matches.sort((a, b) => a.start - b.start);\n\n    let result = '';\n    let lastIndex = 0;\n\n    for (const match of matches) {\n      // Add text before this match\n      result += this.escapeHtml(text.slice(lastIndex, match.start));\n\n      // Add highlighted variable\n      const sampleValue = this.getSampleValue(match.variable);\n      const original = text.slice(match.start, match.end);\n\n      result += `<span class=\"${prefix}__variable\" title=\"${this.escapeHtml(original)}\">${this.escapeHtml(sampleValue ?? original)}</span>`;\n\n      lastIndex = match.end;\n    }\n\n    // Add remaining text\n    result += this.escapeHtml(text.slice(lastIndex));\n\n    return result;\n  }\n\n  /**\n   * Render the preview HTML structure.\n   */\n  render(): string {\n    const prefix = this.config.classPrefix;\n    const matches = this.getMatches();\n    const isEmpty = matches.length === 0;\n\n    return `<div class=\"${prefix}${isEmpty ? ` ${prefix}--empty` : ''}\">\n      <span class=\"${prefix}__label\">Preview:</span>\n      <span class=\"${prefix}__content\">${this.config.highlightVariables ? this.renderHighlightedPreview() : this.escapeHtml(this.getPreviewText())}</span>\n    </div>`;\n  }\n\n  /**\n   * Clean up event listeners.\n   */\n  destroy(): void {\n    this.config.input.removeEventListener('input', this.boundUpdate);\n    if (this.previewEl?.parentElement) {\n      this.previewEl.parentElement.removeChild(this.previewEl);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Methods\n  // ---------------------------------------------------------------------------\n\n  private init(): void {\n    // Create preview element\n    this.previewEl = document.createElement('div');\n    this.previewEl.className = this.config.classPrefix;\n\n    // Mount preview\n    if (this.config.container) {\n      this.config.container.appendChild(this.previewEl);\n    } else {\n      this.config.input.parentElement?.appendChild(this.previewEl);\n    }\n\n    // Bind events\n    this.config.input.addEventListener('input', this.boundUpdate);\n\n    // Initial update\n    this.update();\n  }\n\n  private getSampleValue(variable: string): string | null {\n    const normalized = variable.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n\n    for (const [key, value] of Object.entries(this.config.sampleValues)) {\n      if (key.toLowerCase() === normalized) {\n        return value;\n      }\n    }\n\n    return null;\n  }\n\n  private escapeHtml(text: string): string {\n    return text\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  }\n}\n\n// =============================================================================\n// DirectionToggle Class\n// =============================================================================\n\n/**\n * RTL/LTR direction toggle for text inputs.\n */\nexport class DirectionToggle {\n  private config: Required<Omit<DirectionToggleConfig, 'container' | 'persistenceKey' | 'onChange'>> & {\n    container?: HTMLElement;\n    persistenceKey?: string;\n    onChange?: (direction: 'ltr' | 'rtl') => void;\n  };\n\n  private toggleEl: HTMLButtonElement | null = null;\n  private currentDirection: 'ltr' | 'rtl';\n\n  constructor(config: DirectionToggleConfig) {\n    this.config = {\n      input: config.input,\n      container: config.container,\n      initialDirection: config.initialDirection ?? 'auto',\n      persistenceKey: config.persistenceKey,\n      classPrefix: config.classPrefix ?? DEFAULT_DIR_TOGGLE_PREFIX,\n      onChange: config.onChange\n    };\n\n    this.currentDirection = this.resolveInitialDirection();\n    this.init();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get current text direction.\n   */\n  getDirection(): 'ltr' | 'rtl' {\n    return this.currentDirection;\n  }\n\n  /**\n   * Set text direction.\n   */\n  setDirection(direction: 'ltr' | 'rtl'): void {\n    if (direction === this.currentDirection) return;\n\n    this.currentDirection = direction;\n    this.config.input.dir = direction;\n    this.config.input.style.textAlign = direction === 'rtl' ? 'right' : 'left';\n\n    // Persist if configured\n    if (this.config.persistenceKey) {\n      try {\n        localStorage.setItem(this.config.persistenceKey, direction);\n      } catch {\n        // Ignore storage errors\n      }\n    }\n\n    // Update toggle button\n    this.updateToggle();\n\n    // Notify callback\n    this.config.onChange?.(direction);\n  }\n\n  /**\n   * Toggle between LTR and RTL.\n   */\n  toggle(): void {\n    this.setDirection(this.currentDirection === 'ltr' ? 'rtl' : 'ltr');\n  }\n\n  /**\n   * Render the toggle button HTML.\n   */\n  render(): string {\n    const prefix = this.config.classPrefix;\n    const isRtl = this.currentDirection === 'rtl';\n\n    return `<button type=\"button\" class=\"${prefix}\" aria-pressed=\"${isRtl}\" title=\"Toggle text direction (${isRtl ? 'RTL' : 'LTR'})\">\n      <span class=\"${prefix}__icon\">${isRtl ? this.rtlIcon() : this.ltrIcon()}</span>\n      <span class=\"${prefix}__label\">${isRtl ? 'RTL' : 'LTR'}</span>\n    </button>`;\n  }\n\n  /**\n   * Clean up.\n   */\n  destroy(): void {\n    if (this.toggleEl?.parentElement) {\n      this.toggleEl.parentElement.removeChild(this.toggleEl);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Methods\n  // ---------------------------------------------------------------------------\n\n  private init(): void {\n    // Apply initial direction to input\n    this.config.input.dir = this.currentDirection;\n    this.config.input.style.textAlign = this.currentDirection === 'rtl' ? 'right' : 'left';\n\n    // Create toggle button\n    this.toggleEl = document.createElement('button');\n    this.toggleEl.type = 'button';\n    this.toggleEl.className = this.config.classPrefix;\n    this.updateToggle();\n\n    // Bind click handler\n    this.toggleEl.addEventListener('click', () => this.toggle());\n\n    // Mount toggle\n    if (this.config.container) {\n      this.config.container.appendChild(this.toggleEl);\n    } else {\n      this.config.input.parentElement?.appendChild(this.toggleEl);\n    }\n  }\n\n  private resolveInitialDirection(): 'ltr' | 'rtl' {\n    // Check persistence first\n    if (this.config.persistenceKey) {\n      try {\n        const stored = localStorage.getItem(this.config.persistenceKey);\n        if (stored === 'ltr' || stored === 'rtl') {\n          return stored;\n        }\n      } catch {\n        // Ignore storage errors\n      }\n    }\n\n    // Check config\n    if (this.config.initialDirection === 'ltr' || this.config.initialDirection === 'rtl') {\n      return this.config.initialDirection;\n    }\n\n    // Auto-detect from input or document\n    if (this.config.input.dir === 'rtl') {\n      return 'rtl';\n    }\n\n    if (document.dir === 'rtl' || document.documentElement.dir === 'rtl') {\n      return 'rtl';\n    }\n\n    // Default to LTR\n    return 'ltr';\n  }\n\n  private updateToggle(): void {\n    if (!this.toggleEl) return;\n\n    const isRtl = this.currentDirection === 'rtl';\n    this.toggleEl.setAttribute('aria-pressed', String(isRtl));\n    this.toggleEl.setAttribute('title', `Toggle text direction (${isRtl ? 'RTL' : 'LTR'})`);\n    this.toggleEl.innerHTML = `\n      <span class=\"${this.config.classPrefix}__icon\">${isRtl ? this.rtlIcon() : this.ltrIcon()}</span>\n      <span class=\"${this.config.classPrefix}__label\">${isRtl ? 'RTL' : 'LTR'}</span>\n    `;\n  }\n\n  private ltrIcon(): string {\n    return `<svg viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\">\n      <path d=\"M3 8h10M10 5l3 3-3 3\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n    </svg>`;\n  }\n\n  private rtlIcon(): string {\n    return `<svg viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\">\n      <path d=\"M13 8H3M6 5L3 8l3 3\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n    </svg>`;\n  }\n}\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\n/**\n * Initialize all field helpers for a form.\n */\nexport function initFieldHelpers(\n  form: HTMLFormElement,\n  options: {\n    charCounterFields?: string[];\n    charCounterConfig?: Partial<CharacterCounterConfig>;\n    interpolationFields?: string[];\n    interpolationConfig?: Partial<InterpolationPreviewConfig>;\n    directionToggleFields?: string[];\n    directionToggleConfig?: Partial<DirectionToggleConfig>;\n  } = {}\n): {\n  counters: CharacterCounter[];\n  previews: InterpolationPreview[];\n  toggles: DirectionToggle[];\n  destroy: () => void;\n} {\n  const counters: CharacterCounter[] = [];\n  const previews: InterpolationPreview[] = [];\n  const toggles: DirectionToggle[] = [];\n\n  // Initialize character counters\n  for (const fieldName of options.charCounterFields ?? []) {\n    const input = form.querySelector(`[name=\"${fieldName}\"]`) as HTMLInputElement | HTMLTextAreaElement;\n    if (input) {\n      counters.push(new CharacterCounter({\n        input,\n        ...options.charCounterConfig\n      }));\n    }\n  }\n\n  // Initialize interpolation previews\n  for (const fieldName of options.interpolationFields ?? []) {\n    const input = form.querySelector(`[name=\"${fieldName}\"]`) as HTMLInputElement | HTMLTextAreaElement;\n    if (input) {\n      previews.push(new InterpolationPreview({\n        input,\n        ...options.interpolationConfig\n      }));\n    }\n  }\n\n  // Initialize direction toggles\n  for (const fieldName of options.directionToggleFields ?? []) {\n    const input = form.querySelector(`[name=\"${fieldName}\"]`) as HTMLInputElement | HTMLTextAreaElement;\n    if (input) {\n      toggles.push(new DirectionToggle({\n        input,\n        persistenceKey: `dir-${fieldName}`,\n        ...options.directionToggleConfig\n      }));\n    }\n  }\n\n  return {\n    counters,\n    previews,\n    toggles,\n    destroy: () => {\n      counters.forEach(c => c.destroy());\n      previews.forEach(p => p.destroy());\n      toggles.forEach(t => t.destroy());\n    }\n  };\n}\n\n/**\n * Render standalone character counter HTML.\n */\nexport function renderCharacterCounter(\n  count: number,\n  limit?: number,\n  severity?: 'info' | 'warning' | 'error' | null,\n  classPrefix: string = DEFAULT_CHAR_COUNTER_PREFIX\n): string {\n  const classes = [classPrefix];\n  if (severity) {\n    classes.push(`${classPrefix}--${severity}`);\n  }\n\n  const display = limit ? `${count} / ${limit}` : `${count}`;\n\n  return `<span class=\"${classes.join(' ')}\" aria-live=\"polite\">${display}</span>`;\n}\n\n/**\n * Render standalone direction toggle HTML.\n */\nexport function renderDirectionToggle(\n  direction: 'ltr' | 'rtl',\n  classPrefix: string = DEFAULT_DIR_TOGGLE_PREFIX\n): string {\n  const isRtl = direction === 'rtl';\n  const icon = isRtl\n    ? `<path d=\"M13 8H3M6 5L3 8l3 3\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>`\n    : `<path d=\"M3 8h10M10 5l3 3-3 3\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>`;\n\n  return `<button type=\"button\" class=\"${classPrefix}\" aria-pressed=\"${isRtl}\" title=\"Toggle text direction (${direction.toUpperCase()})\">\n    <svg viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\">${icon}</svg>\n    <span class=\"${classPrefix}__label\">${direction.toUpperCase()}</span>\n  </button>`;\n}\n\n/**\n * Get CSS styles for field helpers.\n */\nexport function getFieldHelperStyles(): string {\n  return `\n    /* Character Counter */\n    .char-counter {\n      display: inline-flex;\n      font-size: 0.75rem;\n      color: var(--char-counter-color, #6b7280);\n      margin-left: 0.5rem;\n    }\n\n    .char-counter--warning {\n      color: var(--char-counter-warning-color, #f59e0b);\n    }\n\n    .char-counter--error {\n      color: var(--char-counter-error-color, #ef4444);\n      font-weight: 500;\n    }\n\n    /* Interpolation Preview */\n    .interpolation-preview {\n      margin-top: 0.5rem;\n      padding: 0.5rem;\n      background: var(--preview-bg, #f9fafb);\n      border-radius: 0.25rem;\n      font-size: 0.875rem;\n    }\n\n    .interpolation-preview--empty {\n      display: none;\n    }\n\n    .interpolation-preview__label {\n      color: var(--preview-label-color, #6b7280);\n      font-size: 0.75rem;\n      margin-right: 0.5rem;\n    }\n\n    .interpolation-preview__variable {\n      background: var(--preview-variable-bg, #e0f2fe);\n      color: var(--preview-variable-color, #0369a1);\n      padding: 0.125rem 0.25rem;\n      border-radius: 0.125rem;\n      font-family: monospace;\n    }\n\n    /* Direction Toggle */\n    .dir-toggle {\n      display: inline-flex;\n      align-items: center;\n      gap: 0.25rem;\n      padding: 0.25rem 0.5rem;\n      font-size: 0.75rem;\n      color: var(--dir-toggle-color, #374151);\n      background: var(--dir-toggle-bg, #f3f4f6);\n      border: 1px solid var(--dir-toggle-border, #d1d5db);\n      border-radius: 0.25rem;\n      cursor: pointer;\n      transition: background-color 150ms ease;\n    }\n\n    .dir-toggle:hover {\n      background: var(--dir-toggle-hover-bg, #e5e7eb);\n    }\n\n    .dir-toggle[aria-pressed=\"true\"] {\n      background: var(--dir-toggle-active-bg, #dbeafe);\n      border-color: var(--dir-toggle-active-border, #93c5fd);\n      color: var(--dir-toggle-active-color, #1d4ed8);\n    }\n\n    .dir-toggle__icon {\n      display: inline-flex;\n    }\n\n    .dir-toggle__label {\n      font-weight: 500;\n    }\n  `;\n}\n\n/**\n * Detect interpolation variables in text.\n */\nexport function detectInterpolations(\n  text: string,\n  patterns: InterpolationPattern[] = DEFAULT_INTERPOLATION_PATTERNS\n): InterpolationMatch[] {\n  const matches: InterpolationMatch[] = [];\n\n  for (const patternDef of patterns) {\n    patternDef.pattern.lastIndex = 0;\n\n    let match: RegExpExecArray | null;\n    while ((match = patternDef.pattern.exec(text)) !== null) {\n      matches.push({\n        pattern: patternDef.name,\n        variable: match[1] ?? match[0],\n        start: match.index,\n        end: match.index + match[0].length\n      });\n    }\n  }\n\n  return matches;\n}\n\n/**\n * Calculate character count severity based on thresholds.\n */\nexport function getCharCountSeverity(\n  count: number,\n  softLimit?: number,\n  hardLimit?: number\n): 'info' | 'warning' | 'error' | null {\n  if (hardLimit && count >= hardLimit) {\n    return 'error';\n  }\n  if (softLimit && count >= softLimit) {\n    return 'warning';\n  }\n  return null;\n}\n","/**\n * Capability Gate Utility (Phase 4 - TX-046)\n *\n * Provides capability-mode and permission gating for translation module\n * navigation and action controls. Follows the graceful degradation strategy:\n *\n * - Hidden: Module is off OR backend marks module as not visible\n * - Visible + Disabled: Module is visible but entry/action permission is denied\n * - Visible + Enabled: Module is on and user has all required permissions\n */\n\nimport { renderReasonCodeBadge } from './translation-status-vocabulary.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Supported capability modes matching backend `translation_capabilities.profile`\n */\nexport type CapabilityMode = 'none' | 'core' | 'core+exchange' | 'core+queue' | 'full';\n\n/**\n * Action state from backend permission evaluation\n */\nexport interface ActionState {\n  enabled: boolean;\n  reason?: string;\n  reason_code?: string;\n  permission?: string;\n}\n\n/**\n * Module state with entry permission and per-action permissions\n */\nexport interface ModuleState {\n  enabled: boolean;\n  visible: boolean;\n  entry: ActionState;\n  actions: Record<string, ActionState>;\n}\n\n/**\n * Route configuration from capabilities\n */\nexport interface RouteConfig {\n  [key: string]: string;\n}\n\n/**\n * Translation capabilities payload from backend\n */\nexport interface TranslationCapabilities {\n  profile: CapabilityMode;\n  capability_mode: CapabilityMode;\n  supported_profiles: CapabilityMode[];\n  schema_version: number;\n  modules: {\n    exchange?: ModuleState;\n    queue?: ModuleState;\n  };\n  features: {\n    cms?: boolean;\n    dashboard?: boolean;\n  };\n  routes: RouteConfig;\n  panels: string[];\n  resolver_keys: string[];\n  warnings: string[];\n  contracts?: Record<string, unknown>;\n}\n\n/**\n * Gate result for UI rendering\n */\nexport interface GateResult {\n  /** Whether the element should be rendered */\n  visible: boolean;\n  /** Whether the element should be interactive */\n  enabled: boolean;\n  /** Reason for disabled state (if applicable) */\n  reason?: string;\n  /** Machine-readable reason code */\n  reasonCode?: string;\n  /** Permission that was evaluated */\n  permission?: string;\n}\n\n/**\n * Nav item gate configuration\n */\nexport interface NavItemGate {\n  /** Module key (exchange, queue) */\n  module: 'exchange' | 'queue';\n  /** Action key (optional - for action-level gating) */\n  action?: string;\n}\n\n// ============================================================================\n// Capability Mode Helpers\n// ============================================================================\n\n/**\n * Parse capability mode from string, with fallback to 'none'\n */\nexport function parseCapabilityMode(value: unknown): CapabilityMode {\n  const validModes: CapabilityMode[] = ['none', 'core', 'core+exchange', 'core+queue', 'full'];\n  if (typeof value === 'string' && validModes.includes(value as CapabilityMode)) {\n    return value as CapabilityMode;\n  }\n  return 'none';\n}\n\n/**\n * Check if exchange module is enabled by capability mode\n */\nexport function isExchangeEnabled(mode: CapabilityMode): boolean {\n  return mode === 'core+exchange' || mode === 'full';\n}\n\n/**\n * Check if queue module is enabled by capability mode\n */\nexport function isQueueEnabled(mode: CapabilityMode): boolean {\n  return mode === 'core+queue' || mode === 'full';\n}\n\n/**\n * Check if core translation features are enabled\n */\nexport function isCoreEnabled(mode: CapabilityMode): boolean {\n  return mode !== 'none';\n}\n\n// ============================================================================\n// Capability Extraction\n// ============================================================================\n\n/**\n * Extract translation capabilities from a raw payload\n */\nexport function extractCapabilities(payload: unknown): TranslationCapabilities | null {\n  if (!payload || typeof payload !== 'object') {\n    return null;\n  }\n\n  const raw = payload as Record<string, unknown>;\n\n  // Validate required fields\n  const profile = parseCapabilityMode(raw.profile || raw.capability_mode);\n  const schemaVersion = typeof raw.schema_version === 'number' ? raw.schema_version : 0;\n\n  return {\n    profile,\n    capability_mode: profile,\n    supported_profiles: Array.isArray(raw.supported_profiles)\n      ? raw.supported_profiles.filter((p): p is CapabilityMode =>\n          typeof p === 'string' && ['none', 'core', 'core+exchange', 'core+queue', 'full'].includes(p)\n        )\n      : ['none', 'core', 'core+exchange', 'core+queue', 'full'],\n    schema_version: schemaVersion,\n    modules: extractModules(raw.modules),\n    features: extractFeatures(raw.features),\n    routes: extractRoutes(raw.routes),\n    panels: extractPanels(raw.panels),\n    resolver_keys: extractResolverKeys(raw.resolver_keys),\n    warnings: extractWarnings(raw.warnings),\n    contracts: raw.contracts && typeof raw.contracts === 'object'\n      ? raw.contracts as Record<string, unknown>\n      : undefined,\n  };\n}\n\nfunction extractModules(modules: unknown): TranslationCapabilities['modules'] {\n  if (!modules || typeof modules !== 'object') {\n    return {};\n  }\n\n  const raw = modules as Record<string, unknown>;\n  const result: TranslationCapabilities['modules'] = {};\n\n  if (raw.exchange && typeof raw.exchange === 'object') {\n    result.exchange = extractModuleState(raw.exchange);\n  }\n  if (raw.queue && typeof raw.queue === 'object') {\n    result.queue = extractModuleState(raw.queue);\n  }\n\n  return result;\n}\n\nfunction extractModuleState(state: unknown): ModuleState {\n  if (!state || typeof state !== 'object') {\n    return {\n      enabled: false,\n      visible: false,\n      entry: { enabled: false, reason: 'Invalid module state', reason_code: 'INVALID_STATE' },\n      actions: {},\n    };\n  }\n\n  const raw = state as Record<string, unknown>;\n\n  return {\n    enabled: raw.enabled === true,\n    visible: raw.visible === true,\n    entry: extractActionState(raw.entry),\n    actions: extractActionsMap(raw.actions),\n  };\n}\n\nfunction extractActionState(action: unknown): ActionState {\n  if (!action || typeof action !== 'object') {\n    return { enabled: false };\n  }\n\n  const raw = action as Record<string, unknown>;\n\n  return {\n    enabled: raw.enabled === true,\n    reason: typeof raw.reason === 'string' ? raw.reason : undefined,\n    reason_code: typeof raw.reason_code === 'string' ? raw.reason_code : undefined,\n    permission: typeof raw.permission === 'string' ? raw.permission : undefined,\n  };\n}\n\nfunction extractActionsMap(actions: unknown): Record<string, ActionState> {\n  if (!actions || typeof actions !== 'object') {\n    return {};\n  }\n\n  const raw = actions as Record<string, unknown>;\n  const result: Record<string, ActionState> = {};\n\n  for (const [key, value] of Object.entries(raw)) {\n    if (value && typeof value === 'object') {\n      result[key] = extractActionState(value);\n    }\n  }\n\n  return result;\n}\n\nfunction extractFeatures(features: unknown): TranslationCapabilities['features'] {\n  if (!features || typeof features !== 'object') {\n    return {};\n  }\n\n  const raw = features as Record<string, unknown>;\n  return {\n    cms: raw.cms === true,\n    dashboard: raw.dashboard === true,\n  };\n}\n\nfunction extractRoutes(routes: unknown): RouteConfig {\n  if (!routes || typeof routes !== 'object') {\n    return {};\n  }\n\n  const result: RouteConfig = {};\n  const raw = routes as Record<string, unknown>;\n\n  for (const [key, value] of Object.entries(raw)) {\n    if (typeof value === 'string') {\n      result[key] = value;\n    }\n  }\n\n  return result;\n}\n\nfunction extractPanels(panels: unknown): string[] {\n  if (!Array.isArray(panels)) {\n    return [];\n  }\n  return panels.filter((p): p is string => typeof p === 'string');\n}\n\nfunction extractResolverKeys(keys: unknown): string[] {\n  if (!Array.isArray(keys)) {\n    return [];\n  }\n  return keys.filter((k): k is string => typeof k === 'string');\n}\n\nfunction extractWarnings(warnings: unknown): string[] {\n  if (!Array.isArray(warnings)) {\n    return [];\n  }\n  return warnings.filter((w): w is string => typeof w === 'string');\n}\n\n// ============================================================================\n// Gate Evaluation\n// ============================================================================\n\n/**\n * Create a CapabilityGate instance for evaluating visibility and permissions\n */\nexport class CapabilityGate {\n  private capabilities: TranslationCapabilities;\n\n  constructor(capabilities: TranslationCapabilities) {\n    this.capabilities = capabilities;\n  }\n\n  /**\n   * Get the current capability mode\n   */\n  getMode(): CapabilityMode {\n    return this.capabilities.profile;\n  }\n\n  /**\n   * Get all capabilities\n   */\n  getCapabilities(): TranslationCapabilities {\n    return this.capabilities;\n  }\n\n  /**\n   * Check if a module is enabled by capability mode\n   */\n  isModuleEnabledByMode(module: 'exchange' | 'queue'): boolean {\n    const mode = this.capabilities.profile;\n    if (module === 'exchange') {\n      return isExchangeEnabled(mode);\n    }\n    return isQueueEnabled(mode);\n  }\n\n  /**\n   * Get module state from capabilities\n   */\n  getModuleState(module: 'exchange' | 'queue'): ModuleState | null {\n    return this.capabilities.modules[module] || null;\n  }\n\n  /**\n   * Get action state from a module\n   */\n  getActionState(module: 'exchange' | 'queue', action: string): ActionState | null {\n    const moduleState = this.getModuleState(module);\n    if (!moduleState) {\n      return null;\n    }\n    return moduleState.actions[action] || null;\n  }\n\n  /**\n   * Gate a navigation item.\n   * Returns visibility/enabled state for rendering.\n   *\n   * Rule:\n   * - backend visible=false => hidden\n   * - backend visible=true + entry/action denied => visible-disabled\n   */\n  gateNavItem(gate: NavItemGate): GateResult {\n    const moduleState = this.getModuleState(gate.module);\n\n    // No module state = hidden\n    if (!moduleState) {\n      return {\n        visible: false,\n        enabled: false,\n        reason: `${gate.module} module not configured`,\n        reasonCode: 'MODULE_NOT_CONFIGURED',\n      };\n    }\n\n    // Module disabled by capability mode = hidden\n    if (!moduleState.enabled) {\n      return {\n        visible: false,\n        enabled: false,\n        reason: moduleState.entry.reason || 'Module disabled by capability mode',\n        reasonCode: moduleState.entry.reason_code || 'FEATURE_DISABLED',\n      };\n    }\n\n    // Backend explicitly hides module = hidden\n    if (!moduleState.visible) {\n      return {\n        visible: false,\n        enabled: false,\n        reason: moduleState.entry.reason || 'Module hidden by capability metadata',\n        reasonCode: moduleState.entry.reason_code || 'FEATURE_DISABLED',\n        permission: moduleState.entry.permission,\n      };\n    }\n\n    // Module is visible, but entry permission denied = visible-disabled\n    if (!moduleState.entry.enabled) {\n      return {\n        visible: true,\n        enabled: false,\n        reason: moduleState.entry.reason || 'Missing module view permission',\n        reasonCode: moduleState.entry.reason_code || 'PERMISSION_DENIED',\n        permission: moduleState.entry.permission,\n      };\n    }\n\n    // If action specified, check action permission\n    if (gate.action) {\n      const actionState = moduleState.actions[gate.action];\n      if (!actionState) {\n        // Action not defined = visible but disabled\n        return {\n          visible: true,\n          enabled: false,\n          reason: `Action ${gate.action} not configured`,\n          reasonCode: 'ACTION_NOT_CONFIGURED',\n        };\n      }\n\n      if (!actionState.enabled) {\n        // Action permission denied = visible but disabled\n        return {\n          visible: true,\n          enabled: false,\n          reason: actionState.reason || `Missing ${gate.action} permission`,\n          reasonCode: actionState.reason_code || 'PERMISSION_DENIED',\n          permission: actionState.permission,\n        };\n      }\n    }\n\n    // All checks passed = visible and enabled\n    return {\n      visible: true,\n      enabled: true,\n    };\n  }\n\n  /**\n   * Gate an action control.\n   * Returns visibility/enabled state for rendering action buttons.\n   */\n  gateAction(module: 'exchange' | 'queue', action: string): GateResult {\n    return this.gateNavItem({ module, action });\n  }\n\n  /**\n   * Check if exchange module is accessible (visible and entry enabled)\n   */\n  canAccessExchange(): boolean {\n    const gate = this.gateNavItem({ module: 'exchange' });\n    return gate.visible && gate.enabled;\n  }\n\n  /**\n   * Check if queue module is accessible (visible and entry enabled)\n   */\n  canAccessQueue(): boolean {\n    const gate = this.gateNavItem({ module: 'queue' });\n    return gate.visible && gate.enabled;\n  }\n\n  /**\n   * Get route URL for a given key\n   */\n  getRoute(key: string): string | null {\n    return this.capabilities.routes[key] || null;\n  }\n\n  /**\n   * Check if a feature is enabled\n   */\n  isFeatureEnabled(feature: 'cms' | 'dashboard'): boolean {\n    return this.capabilities.features[feature] === true;\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create a CapabilityGate from raw payload\n */\nexport function createCapabilityGate(payload: unknown): CapabilityGate | null {\n  const capabilities = extractCapabilities(payload);\n  if (!capabilities) {\n    return null;\n  }\n  return new CapabilityGate(capabilities);\n}\n\n/**\n * Create a default (empty) CapabilityGate for fallback\n */\nexport function createEmptyCapabilityGate(): CapabilityGate {\n  return new CapabilityGate({\n    profile: 'none',\n    capability_mode: 'none',\n    supported_profiles: ['none', 'core', 'core+exchange', 'core+queue', 'full'],\n    schema_version: 0,\n    modules: {},\n    features: {},\n    routes: {},\n    panels: [],\n    resolver_keys: [],\n    warnings: [],\n  });\n}\n\n// ============================================================================\n// Render Helpers\n// ============================================================================\n\n/**\n * Render ARIA attributes for a gated element\n */\nexport function renderGateAriaAttributes(gate: GateResult): string {\n  if (!gate.visible) {\n    return 'aria-hidden=\"true\" style=\"display: none;\"';\n  }\n\n  if (!gate.enabled) {\n    const reasonAttr = gate.reason ? ` title=\"${escapeAttr(gate.reason)}\"` : '';\n    return `aria-disabled=\"true\"${reasonAttr}`;\n  }\n\n  return '';\n}\n\n/**\n * Render a disabled reason badge\n */\nexport function renderDisabledReasonBadge(gate: GateResult): string {\n  if (gate.enabled || !gate.reason) {\n    return '';\n  }\n\n  const reasonCode = (gate.reasonCode || '').trim();\n  if (reasonCode) {\n    return renderReasonCodeBadge(reasonCode, { size: 'sm', showFullMessage: true });\n  }\n\n  return `\n    <span class=\"capability-gate-reason text-gray-500 bg-gray-100\"\n          role=\"status\"\n          aria-label=\"${escapeAttr(gate.reason)}\">\n      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4 inline-block mr-1\">\n        <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z\" clip-rule=\"evenodd\" />\n      </svg>\n      ${escapeHtml(gate.reason)}\n    </span>\n  `.trim();\n}\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction escapeAttr(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\n// ============================================================================\n// CSS Styles\n// ============================================================================\n\n/**\n * Get CSS styles for capability gate components\n */\nexport function getCapabilityGateStyles(): string {\n  return `\n    /* Capability Gate Styles */\n    .capability-gate-reason {\n      display: inline-flex;\n      align-items: center;\n      padding: 0.25rem 0.5rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      border-radius: 0.25rem;\n      white-space: nowrap;\n    }\n\n    .capability-gate-disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n      pointer-events: none;\n    }\n\n    .capability-gate-disabled:focus-visible {\n      pointer-events: auto;\n    }\n\n    [aria-disabled=\"true\"].capability-gate-action {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n\n    [aria-disabled=\"true\"].capability-gate-action:hover {\n      background-color: inherit;\n    }\n\n    .capability-gate-hidden {\n      display: none !important;\n    }\n  `;\n}\n\n// ============================================================================\n// Integration Helpers\n// ============================================================================\n\n/**\n * Apply gate result to a DOM element\n */\nexport function applyGateToElement(element: HTMLElement, gate: GateResult): void {\n  if (!gate.visible) {\n    element.style.display = 'none';\n    element.setAttribute('aria-hidden', 'true');\n    return;\n  }\n\n  element.style.display = '';\n  element.removeAttribute('aria-hidden');\n\n  if (!gate.enabled) {\n    element.setAttribute('aria-disabled', 'true');\n    element.classList.add('capability-gate-disabled');\n    if (gate.reason) {\n      element.setAttribute('title', gate.reason);\n      element.dataset.reasonCode = gate.reasonCode || '';\n    }\n\n    // Prevent clicks but keep focusable for screen readers\n    element.addEventListener('click', preventDisabledClick, true);\n  } else {\n    element.removeAttribute('aria-disabled');\n    element.classList.remove('capability-gate-disabled');\n    element.removeAttribute('title');\n    delete element.dataset.reasonCode;\n    element.removeEventListener('click', preventDisabledClick, true);\n  }\n}\n\nfunction preventDisabledClick(event: Event): void {\n  const target = event.currentTarget as HTMLElement;\n  if (target.getAttribute('aria-disabled') === 'true') {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n}\n\n/**\n * Initialize capability gating for all elements with data-capability-gate attribute\n */\nexport function initCapabilityGating(\n  container: HTMLElement,\n  gate: CapabilityGate\n): void {\n  const elements = container.querySelectorAll<HTMLElement>('[data-capability-gate]');\n\n  elements.forEach((element) => {\n    const gateConfig = element.dataset.capabilityGate;\n    if (!gateConfig) return;\n\n    try {\n      const config = JSON.parse(gateConfig) as NavItemGate;\n      const result = gate.gateNavItem(config);\n      applyGateToElement(element, result);\n    } catch {\n      console.warn('Invalid capability gate config:', gateConfig);\n    }\n  });\n}\n","/**\n * Translator Dashboard Component (Phase 4 - TX-047)\n *\n * Provides a focused work queue for translators with progress and due-date awareness.\n * Card + table hybrid: workload summary + actionable assignments list.\n */\n\nimport type { GateResult, CapabilityGate } from './capability-gate.js';\nimport { createCapabilityGate, renderDisabledReasonBadge } from './capability-gate.js';\nimport { renderVocabularyStatusBadge } from './translation-status-vocabulary.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Due state classification from backend\n */\nexport type DueState = 'overdue' | 'due_soon' | 'on_track' | 'none';\n\n/**\n * Queue state / assignment status\n */\nexport type QueueState =\n  | 'pending'\n  | 'assigned'\n  | 'in_progress'\n  | 'review'\n  | 'approved'\n  | 'published'\n  | 'archived';\n\n/**\n * Content state derived from queue state\n */\nexport type ContentState = 'draft' | 'review' | 'ready' | 'archived';\n\n/**\n * Assignment priority levels\n */\nexport type AssignmentPriority = 'low' | 'normal' | 'high' | 'urgent';\n\n/**\n * Action state for review actions\n */\nexport interface ReviewActionState {\n  enabled: boolean;\n  reason?: string;\n  reason_code?: string;\n  permission?: string;\n}\n\n/**\n * Assignment row from API\n */\nexport interface TranslationAssignment {\n  id: string;\n  translation_group_id: string;\n  entity_type: string;\n  source_record_id: string;\n  target_record_id: string;\n  source_locale: string;\n  target_locale: string;\n  source_title: string;\n  source_path: string;\n  assignee_id: string;\n  assignment_type: string;\n  content_state: ContentState;\n  queue_state: QueueState;\n  status: QueueState;\n  priority: AssignmentPriority;\n  due_state: DueState;\n  due_date?: string;\n  updated_at: string;\n  created_at: string;\n  review_actions: {\n    submit_review: ReviewActionState;\n    approve: ReviewActionState;\n    reject: ReviewActionState;\n  };\n}\n\n/**\n * My Work API response\n */\nexport interface MyWorkResponse {\n  scope: 'my_work';\n  user_id: string;\n  summary: {\n    total: number;\n    overdue: number;\n    due_soon: number;\n    on_track: number;\n    none: number;\n    review: number;\n  };\n  assignments: TranslationAssignment[];\n  items: TranslationAssignment[];\n  total: number;\n  page: number;\n  per_page: number;\n  updated_at: string;\n}\n\n/**\n * Queue API response\n */\nexport interface QueueResponse {\n  scope: 'queue';\n  summary: {\n    total: number;\n    by_queue_state: Record<string, number>;\n    by_due_state: Record<string, number>;\n  };\n  assignments: TranslationAssignment[];\n  items: TranslationAssignment[];\n  total: number;\n  page: number;\n  per_page: number;\n  updated_at: string;\n}\n\n/**\n * Filter preset definition\n */\nexport interface FilterPreset {\n  id: string;\n  label: string;\n  icon?: string;\n  filters: Record<string, string>;\n  badge?: () => number | string | null;\n}\n\n/**\n * Dashboard state\n *\n * States follow the visible-disabled pattern for capability gating:\n * - 'disabled': Module accessible but user lacks permission (visible-disabled)\n * - 'loading': Initial data load in progress\n * - 'loaded': Data loaded successfully with assignments\n * - 'error': Data load failed (transport or server error)\n * - 'empty': Data loaded but no assignments\n */\nexport type DashboardState = 'disabled' | 'loading' | 'loaded' | 'error' | 'empty';\n\n/**\n * Dashboard configuration\n */\nexport interface TranslatorDashboardConfig {\n  /** API endpoint for my-work data */\n  myWorkEndpoint: string;\n  /** API endpoint for queue data (optional for unified view) */\n  queueEndpoint?: string;\n  /** Panel base URL for opening assignments */\n  panelBaseUrl?: string;\n  /** Capability gate for permission checks */\n  capabilityGate?: CapabilityGate;\n  /** Custom filter presets */\n  filterPresets?: FilterPreset[];\n  /** Auto-refresh interval in ms (0 = disabled) */\n  refreshInterval?: number;\n  /** Callback when assignment is clicked */\n  onAssignmentClick?: (assignment: TranslationAssignment) => void;\n  /** Callback when action is clicked */\n  onActionClick?: (action: string, assignment: TranslationAssignment) => Promise<void>;\n  /** Custom labels (merged with defaults) */\n  labels?: Partial<DashboardLabels>;\n}\n\n/**\n * Optional init-time overrides for `initTranslatorDashboard`.\n * Supports explicit capability gate injection while keeping\n * capability auto-detection as the default.\n */\nexport interface InitTranslatorDashboardOptions {\n  capabilityGate?: CapabilityGate;\n  capabilitiesPayload?: unknown;\n}\n\n/**\n * Internal config with resolved labels\n */\ninterface ResolvedDashboardConfig {\n  myWorkEndpoint: string;\n  queueEndpoint: string;\n  panelBaseUrl: string;\n  filterPresets: FilterPreset[];\n  refreshInterval: number;\n  labels: DashboardLabels;\n  capabilityGate?: CapabilityGate;\n  onAssignmentClick?: (assignment: TranslationAssignment) => void;\n  onActionClick?: (action: string, assignment: TranslationAssignment) => Promise<void>;\n}\n\n/**\n * Customizable labels\n */\nexport interface DashboardLabels {\n  title: string;\n  myAssignments: string;\n  dueSoon: string;\n  needsReview: string;\n  all: string;\n  overdue: string;\n  onTrack: string;\n  noAssignments: string;\n  noAssignmentsDescription: string;\n  loading: string;\n  error: string;\n  retry: string;\n  submitForReview: string;\n  approve: string;\n  reject: string;\n  openAssignment: string;\n  dueDate: string;\n  priority: string;\n  status: string;\n  targetLocale: string;\n  sourceTitle: string;\n}\n\nconst DEFAULT_LABELS: DashboardLabels = {\n  title: 'My Translation Work',\n  myAssignments: 'My Assignments',\n  dueSoon: 'Due Soon',\n  needsReview: 'Needs Review',\n  all: 'All',\n  overdue: 'Overdue',\n  onTrack: 'On Track',\n  noAssignments: 'No assignments',\n  noAssignmentsDescription: 'You have no translation assignments at this time.',\n  loading: 'Loading assignments...',\n  error: 'Failed to load assignments',\n  retry: 'Retry',\n  submitForReview: 'Submit for Review',\n  approve: 'Approve',\n  reject: 'Reject',\n  openAssignment: 'Open',\n  dueDate: 'Due Date',\n  priority: 'Priority',\n  status: 'Status',\n  targetLocale: 'Target',\n  sourceTitle: 'Content',\n};\n\n/**\n * Default filter presets for translator dashboard\n */\nexport const DEFAULT_FILTER_PRESETS: FilterPreset[] = [\n  {\n    id: 'all',\n    label: 'All',\n    filters: {},\n  },\n  {\n    id: 'in_progress',\n    label: 'In Progress',\n    filters: { status: 'in_progress' },\n  },\n  {\n    id: 'due_soon',\n    label: 'Due Soon',\n    filters: { status: 'in_progress' }, // Due soon is filtered client-side\n  },\n  {\n    id: 'review',\n    label: 'Needs Review',\n    filters: { status: 'review' },\n  },\n];\n\n// ============================================================================\n// TranslatorDashboard Class\n// ============================================================================\n\n/**\n * Translator Dashboard component\n */\nexport class TranslatorDashboard {\n  private config: ResolvedDashboardConfig;\n  private container: HTMLElement | null = null;\n  private state: DashboardState = 'loading';\n  private gateResult: GateResult | null = null;\n  private data: MyWorkResponse | null = null;\n  private error: Error | null = null;\n  private activePreset: string = 'all';\n  private refreshTimer: number | null = null;\n\n  constructor(config: TranslatorDashboardConfig) {\n    this.config = {\n      myWorkEndpoint: config.myWorkEndpoint,\n      queueEndpoint: config.queueEndpoint || '',\n      panelBaseUrl: config.panelBaseUrl || '',\n      capabilityGate: config.capabilityGate,\n      filterPresets: config.filterPresets || DEFAULT_FILTER_PRESETS,\n      refreshInterval: config.refreshInterval || 0,\n      onAssignmentClick: config.onAssignmentClick,\n      onActionClick: config.onActionClick,\n      labels: { ...DEFAULT_LABELS, ...(config.labels || {}) },\n    };\n  }\n\n  /**\n   * Mount the dashboard to a container element.\n   *\n   * If a capabilityGate is configured, checks queue module access first.\n   * If permission is denied, renders a visible-disabled state with reason\n   * instead of attempting to load data.\n   */\n  mount(container: HTMLElement): void {\n    this.container = container;\n\n    // Check capability gate before loading data\n    if (this.config.capabilityGate) {\n      this.gateResult = this.config.capabilityGate.gateNavItem({ module: 'queue' });\n\n      if (!this.gateResult.visible) {\n        this.container.setAttribute('aria-hidden', 'true');\n        this.container.style.display = 'none';\n        return;\n      }\n\n      if (!this.gateResult.enabled) {\n        // Visible-disabled: show dashboard UI with disabled state\n        this.state = 'disabled';\n        this.render();\n        return;\n      }\n    }\n\n    this.render();\n    this.loadData();\n\n    if (this.config.refreshInterval > 0) {\n      this.startAutoRefresh();\n    }\n  }\n\n  /**\n   * Unmount and cleanup\n   */\n  unmount(): void {\n    this.stopAutoRefresh();\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n\n  /**\n   * Refresh dashboard data\n   */\n  async refresh(): Promise<void> {\n    await this.loadData();\n  }\n\n  /**\n   * Set active filter preset\n   */\n  setActivePreset(presetId: string): void {\n    this.activePreset = presetId;\n    this.loadData();\n  }\n\n  /**\n   * Get current state\n   */\n  getState(): DashboardState {\n    return this.state;\n  }\n\n  /**\n   * Get current data\n   */\n  getData(): MyWorkResponse | null {\n    return this.data;\n  }\n\n  private startAutoRefresh(): void {\n    if (this.refreshTimer) return;\n    this.refreshTimer = window.setInterval(() => {\n      this.loadData();\n    }, this.config.refreshInterval);\n  }\n\n  private stopAutoRefresh(): void {\n    if (this.refreshTimer) {\n      window.clearInterval(this.refreshTimer);\n      this.refreshTimer = null;\n    }\n  }\n\n  private async loadData(): Promise<void> {\n    this.state = 'loading';\n    this.render();\n\n    try {\n      const preset = this.config.filterPresets.find(p => p.id === this.activePreset);\n      const params = new URLSearchParams(preset?.filters || {});\n      const url = `${this.config.myWorkEndpoint}${params.toString() ? '?' + params.toString() : ''}`;\n\n      const response = await fetch(url, {\n        headers: {\n          'Accept': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to load: ${response.status}`);\n      }\n\n      this.data = await response.json() as MyWorkResponse;\n      this.state = this.data.assignments.length === 0 ? 'empty' : 'loaded';\n      this.error = null;\n    } catch (err) {\n      this.error = err instanceof Error ? err : new Error(String(err));\n      this.state = 'error';\n    }\n\n    this.render();\n  }\n\n  private render(): void {\n    if (!this.container) return;\n\n    const labels = this.config.labels;\n    this.container.innerHTML = `\n      <div class=\"translator-dashboard\" role=\"region\" aria-label=\"${escapeHtml(labels.title)}\">\n        ${this.renderHeader()}\n        ${this.renderSummaryCards()}\n        ${this.renderFilterBar()}\n        ${this.renderContent()}\n      </div>\n    `;\n\n    this.attachEventListeners();\n  }\n\n  private renderHeader(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"dashboard-header\">\n        <h2 class=\"dashboard-title\">${escapeHtml(labels.title)}</h2>\n        <button type=\"button\" class=\"dashboard-refresh-btn\" aria-label=\"Refresh\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-5 h-5\">\n            <path fill-rule=\"evenodd\" d=\"M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm-1.621-6.01a7 7 0 00-11.712 3.138.75.75 0 001.449.39 5.5 5.5 0 019.201-2.466l.312.311H10.51a.75.75 0 000 1.5h4.243a.75.75 0 00.75-.75V3.295a.75.75 0 00-1.5 0v2.43l-.311-.311z\" clip-rule=\"evenodd\" />\n          </svg>\n        </button>\n      </div>\n    `;\n  }\n\n  private renderSummaryCards(): string {\n    if (this.state === 'loading' || !this.data) {\n      return this.renderSummaryLoading();\n    }\n\n    const summary = this.data.summary;\n    const labels = this.config.labels;\n\n    return `\n      <div class=\"dashboard-summary-cards\" role=\"list\" aria-label=\"Work summary\">\n        ${this.renderSummaryCard('total', labels.myAssignments, summary.total, 'text-blue-600 bg-blue-50')}\n        ${this.renderSummaryCard('overdue', labels.overdue, summary.overdue, 'text-red-600 bg-red-50')}\n        ${this.renderSummaryCard('due_soon', labels.dueSoon, summary.due_soon, 'text-amber-600 bg-amber-50')}\n        ${this.renderSummaryCard('review', labels.needsReview, summary.review, 'text-purple-600 bg-purple-50')}\n      </div>\n    `;\n  }\n\n  private renderSummaryCard(id: string, label: string, count: number, colorClass: string): string {\n    return `\n      <div class=\"summary-card ${colorClass}\" role=\"listitem\" data-summary=\"${id}\">\n        <div class=\"summary-count\">${count}</div>\n        <div class=\"summary-label\">${escapeHtml(label)}</div>\n      </div>\n    `;\n  }\n\n  private renderSummaryLoading(): string {\n    return `\n      <div class=\"dashboard-summary-cards loading\" role=\"list\" aria-busy=\"true\">\n        <div class=\"summary-card bg-gray-100 animate-pulse\" role=\"listitem\"><div class=\"h-12\"></div></div>\n        <div class=\"summary-card bg-gray-100 animate-pulse\" role=\"listitem\"><div class=\"h-12\"></div></div>\n        <div class=\"summary-card bg-gray-100 animate-pulse\" role=\"listitem\"><div class=\"h-12\"></div></div>\n        <div class=\"summary-card bg-gray-100 animate-pulse\" role=\"listitem\"><div class=\"h-12\"></div></div>\n      </div>\n    `;\n  }\n\n  private renderFilterBar(): string {\n    return `\n      <div class=\"dashboard-filter-bar\" role=\"tablist\" aria-label=\"Filter assignments\">\n        ${this.config.filterPresets.map(preset => this.renderFilterPreset(preset)).join('')}\n      </div>\n    `;\n  }\n\n  private renderFilterPreset(preset: FilterPreset): string {\n    const isActive = this.activePreset === preset.id;\n    const badge = preset.badge?.() ?? null;\n    const badgeHtml = badge !== null ? `<span class=\"filter-badge\">${badge}</span>` : '';\n\n    return `\n      <button type=\"button\"\n              class=\"filter-preset ${isActive ? 'active' : ''}\"\n              role=\"tab\"\n              aria-selected=\"${isActive}\"\n              data-preset=\"${preset.id}\">\n        ${preset.icon || ''}\n        <span class=\"filter-label\">${escapeHtml(preset.label)}</span>\n        ${badgeHtml}\n      </button>\n    `;\n  }\n\n  private renderContent(): string {\n    switch (this.state) {\n      case 'disabled':\n        return this.renderDisabled();\n      case 'loading':\n        return this.renderLoading();\n      case 'error':\n        return this.renderError();\n      case 'empty':\n        return this.renderEmpty();\n      case 'loaded':\n        return this.renderAssignmentList();\n      default:\n        return '';\n    }\n  }\n\n  private renderLoading(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"dashboard-loading\" role=\"status\" aria-busy=\"true\">\n        <div class=\"loading-spinner\"></div>\n        <p>${escapeHtml(labels.loading)}</p>\n      </div>\n    `;\n  }\n\n  private renderError(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"dashboard-error\" role=\"alert\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-10 h-10 text-red-500\">\n          <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z\" clip-rule=\"evenodd\" />\n        </svg>\n        <p class=\"error-message\">${escapeHtml(labels.error)}</p>\n        ${this.error ? `<p class=\"error-detail\">${escapeHtml(this.error.message)}</p>` : ''}\n        <button type=\"button\" class=\"retry-btn\">${escapeHtml(labels.retry)}</button>\n      </div>\n    `;\n  }\n\n  private renderEmpty(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"dashboard-empty\" role=\"status\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-12 h-12 text-gray-400\">\n          <path fill-rule=\"evenodd\" d=\"M2.5 3A1.5 1.5 0 001 4.5v4A1.5 1.5 0 002.5 10h6A1.5 1.5 0 0010 8.5v-4A1.5 1.5 0 008.5 3h-6zm11 2A1.5 1.5 0 0012 6.5v7a1.5 1.5 0 001.5 1.5h4a1.5 1.5 0 001.5-1.5v-7A1.5 1.5 0 0017.5 5h-4zm-10 7A1.5 1.5 0 002 13.5v2A1.5 1.5 0 003.5 17h5A1.5 1.5 0 0010 15.5v-2A1.5 1.5 0 008.5 12h-5z\" clip-rule=\"evenodd\" />\n        </svg>\n        <p class=\"empty-title\">${escapeHtml(labels.noAssignments)}</p>\n        <p class=\"empty-description\">${escapeHtml(labels.noAssignmentsDescription)}</p>\n      </div>\n    `;\n  }\n\n  /**\n   * Render disabled state (TX-101: visible-disabled module/dashboard UX).\n   * Shows the dashboard structure but with disabled controls and a reason badge.\n   * This is distinct from error state (transport failure) and empty state (no data).\n   */\n  private renderDisabled(): string {\n    const reason = this.gateResult?.reason || 'Access to this feature is not available.';\n    const reasonBadge = this.gateResult\n      ? renderDisabledReasonBadge(this.gateResult)\n      : '';\n\n    return `\n      <div class=\"dashboard-disabled\" role=\"alert\" aria-live=\"polite\">\n        <div class=\"disabled-icon\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-12 h-12 text-gray-400\">\n            <path fill-rule=\"evenodd\" d=\"M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z\" clip-rule=\"evenodd\" />\n          </svg>\n        </div>\n        <p class=\"disabled-title\">Translator Dashboard Unavailable</p>\n        <p class=\"disabled-description\">${escapeHtml(reason)}</p>\n        ${reasonBadge}\n        <p class=\"disabled-help-text\">\n          Contact your administrator if you believe you should have access to this feature.\n        </p>\n      </div>\n    `;\n  }\n\n  private renderAssignmentList(): string {\n    if (!this.data) return '';\n\n    const labels = this.config.labels;\n    let assignments = this.data.assignments;\n\n    // Client-side filtering for due_soon preset\n    if (this.activePreset === 'due_soon') {\n      assignments = assignments.filter(a => a.due_state === 'due_soon' || a.due_state === 'overdue');\n    }\n\n    if (assignments.length === 0) {\n      return this.renderEmpty();\n    }\n\n    return `\n      <div class=\"dashboard-assignment-list\">\n        <table class=\"assignment-table\" role=\"grid\" aria-label=\"Translation assignments\">\n          <thead>\n            <tr>\n              <th scope=\"col\">${escapeHtml(labels.sourceTitle)}</th>\n              <th scope=\"col\">${escapeHtml(labels.targetLocale)}</th>\n              <th scope=\"col\">${escapeHtml(labels.status)}</th>\n              <th scope=\"col\">${escapeHtml(labels.dueDate)}</th>\n              <th scope=\"col\">${escapeHtml(labels.priority)}</th>\n              <th scope=\"col\" class=\"actions-col\">Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${assignments.map(a => this.renderAssignmentRow(a)).join('')}\n          </tbody>\n        </table>\n      </div>\n    `;\n  }\n\n  private renderAssignmentRow(assignment: TranslationAssignment): string {\n    const labels = this.config.labels;\n    const dueStateClass = getDueStateClass(assignment.due_state);\n    const priorityClass = getPriorityClass(assignment.priority);\n    const queueStateBadge = renderVocabularyStatusBadge(assignment.queue_state, {\n      domain: 'queue',\n      size: 'sm',\n    });\n\n    const dueDateDisplay = assignment.due_date\n      ? formatRelativeDate(new Date(assignment.due_date))\n      : '-';\n\n    return `\n      <tr class=\"assignment-row\" data-assignment-id=\"${escapeAttr(assignment.id)}\">\n        <td class=\"title-cell\">\n          <div class=\"title-content\">\n            <span class=\"source-title\">${escapeHtml(assignment.source_title || assignment.source_path || assignment.id)}</span>\n            <span class=\"entity-type\">${escapeHtml(assignment.entity_type)}</span>\n          </div>\n        </td>\n        <td class=\"locale-cell\">\n          <span class=\"locale-badge\">${escapeHtml(assignment.target_locale.toUpperCase())}</span>\n          <span class=\"locale-arrow\">←</span>\n          <span class=\"locale-badge source\">${escapeHtml(assignment.source_locale.toUpperCase())}</span>\n        </td>\n        <td class=\"status-cell\">\n          ${queueStateBadge}\n        </td>\n        <td class=\"due-cell ${dueStateClass}\">\n          ${dueDateDisplay}\n        </td>\n        <td class=\"priority-cell\">\n          <span class=\"priority-indicator ${priorityClass}\">${escapeHtml(formatPriority(assignment.priority))}</span>\n        </td>\n        <td class=\"actions-cell\">\n          ${this.renderAssignmentActions(assignment)}\n        </td>\n      </tr>\n    `;\n  }\n\n  private renderAssignmentActions(assignment: TranslationAssignment): string {\n    const labels = this.config.labels;\n    const actions: string[] = [];\n    const hasActionHandler = typeof this.config.onActionClick === 'function';\n\n    // Open action\n    actions.push(`\n      <button type=\"button\" class=\"action-btn open-btn\" data-action=\"open\" title=\"${escapeAttr(labels.openAssignment)}\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4\">\n          <path d=\"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z\" />\n          <path d=\"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z\" />\n        </svg>\n      </button>\n    `);\n\n    // Review actions based on state and permissions\n    const reviewActions = assignment.review_actions;\n\n    if (hasActionHandler && assignment.queue_state === 'in_progress' && reviewActions.submit_review.enabled) {\n      actions.push(`\n        <button type=\"button\" class=\"action-btn submit-review-btn\" data-action=\"submit_review\" title=\"${escapeAttr(labels.submitForReview)}\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4\">\n            <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z\" clip-rule=\"evenodd\" />\n          </svg>\n        </button>\n      `);\n    }\n\n    if (hasActionHandler && assignment.queue_state === 'review') {\n      if (reviewActions.approve.enabled) {\n        actions.push(`\n          <button type=\"button\" class=\"action-btn approve-btn\" data-action=\"approve\" title=\"${escapeAttr(labels.approve)}\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4\">\n              <path fill-rule=\"evenodd\" d=\"M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z\" clip-rule=\"evenodd\" />\n            </svg>\n          </button>\n        `);\n      }\n\n      if (reviewActions.reject.enabled) {\n        actions.push(`\n          <button type=\"button\" class=\"action-btn reject-btn\" data-action=\"reject\" title=\"${escapeAttr(labels.reject)}\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4\">\n              <path d=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\" />\n            </svg>\n          </button>\n        `);\n      }\n    }\n\n    return `<div class=\"action-buttons\">${actions.join('')}</div>`;\n  }\n\n  private attachEventListeners(): void {\n    if (!this.container) return;\n\n    // Refresh button\n    const refreshBtn = this.container.querySelector('.dashboard-refresh-btn');\n    refreshBtn?.addEventListener('click', () => this.loadData());\n\n    // Retry button\n    const retryBtn = this.container.querySelector('.retry-btn');\n    retryBtn?.addEventListener('click', () => this.loadData());\n\n    // Filter presets\n    const presetBtns = this.container.querySelectorAll('.filter-preset');\n    presetBtns.forEach(btn => {\n      btn.addEventListener('click', () => {\n        const presetId = (btn as HTMLElement).dataset.preset;\n        if (presetId) {\n          this.setActivePreset(presetId);\n        }\n      });\n    });\n\n    // Assignment row clicks\n    const rows = this.container.querySelectorAll('.assignment-row');\n    rows.forEach(row => {\n      const assignmentId = (row as HTMLElement).dataset.assignmentId;\n      if (!assignmentId || !this.data) return;\n\n      const assignment = this.data.assignments.find(a => a.id === assignmentId);\n      if (!assignment) return;\n\n      // Action buttons\n      const actionBtns = row.querySelectorAll('.action-btn');\n      actionBtns.forEach(btn => {\n        btn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          const action = (btn as HTMLElement).dataset.action;\n          if (!action) return;\n\n          if (action === 'open') {\n            this.openAssignment(assignment);\n          } else {\n            if (typeof this.config.onActionClick === 'function') {\n              await this.config.onActionClick(action, assignment);\n            }\n          }\n        });\n      });\n\n      // Row click (open assignment)\n      row.addEventListener('click', () => {\n        this.openAssignment(assignment);\n      });\n    });\n\n    // Summary card clicks (filter shortcut)\n    const summaryCards = this.container.querySelectorAll('.summary-card');\n    summaryCards.forEach(card => {\n      card.addEventListener('click', () => {\n        const summaryType = (card as HTMLElement).dataset.summary;\n        if (summaryType === 'review') {\n          this.setActivePreset('review');\n        } else if (summaryType === 'due_soon' || summaryType === 'overdue') {\n          this.setActivePreset('due_soon');\n        } else {\n          this.setActivePreset('all');\n        }\n      });\n    });\n  }\n\n  private openAssignment(assignment: TranslationAssignment): void {\n    if (typeof this.config.onAssignmentClick === 'function') {\n      this.config.onAssignmentClick(assignment);\n      return;\n    }\n    const url = this.buildAssignmentEditURL(assignment);\n    if (!url || typeof window === 'undefined') {\n      return;\n    }\n    window.location.href = url;\n  }\n\n  private buildAssignmentEditURL(assignment: TranslationAssignment): string {\n    const base = this.config.panelBaseUrl.trim().replace(/\\/+$/, '');\n    if (!base) {\n      return '';\n    }\n    const panel = assignment.entity_type.trim();\n    const targetID = assignment.target_record_id.trim() || assignment.source_record_id.trim();\n    if (!panel || !targetID) {\n      return '';\n    }\n    return `${base}/${encodeURIComponent(panel)}/${encodeURIComponent(targetID)}/edit`;\n  }\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction escapeAttr(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction getDueStateClass(state: DueState): string {\n  switch (state) {\n    case 'overdue':\n      return 'due-overdue';\n    case 'due_soon':\n      return 'due-soon';\n    case 'on_track':\n      return 'due-on-track';\n    default:\n      return '';\n  }\n}\n\nfunction getPriorityClass(priority: AssignmentPriority): string {\n  switch (priority) {\n    case 'urgent':\n      return 'priority-urgent';\n    case 'high':\n      return 'priority-high';\n    case 'normal':\n      return 'priority-normal';\n    case 'low':\n      return 'priority-low';\n    default:\n      return 'priority-normal';\n  }\n}\n\nfunction formatPriority(priority: AssignmentPriority): string {\n  return priority.charAt(0).toUpperCase() + priority.slice(1);\n}\n\nfunction formatRelativeDate(date: Date): string {\n  const now = new Date();\n  const diff = date.getTime() - now.getTime();\n  const days = Math.ceil(diff / (1000 * 60 * 60 * 24));\n\n  if (days < 0) {\n    return `${Math.abs(days)}d overdue`;\n  } else if (days === 0) {\n    return 'Today';\n  } else if (days === 1) {\n    return 'Tomorrow';\n  } else if (days <= 7) {\n    return `${days}d`;\n  } else {\n    return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\n  }\n}\n\n// ============================================================================\n// CSS Styles\n// ============================================================================\n\n/**\n * Get CSS styles for translator dashboard\n */\nexport function getTranslatorDashboardStyles(): string {\n  return `\n    /* Translator Dashboard Styles */\n    .translator-dashboard {\n      display: flex;\n      flex-direction: column;\n      gap: 1.5rem;\n      padding: 1.5rem;\n      background: white;\n      border-radius: 0.5rem;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n    }\n\n    .dashboard-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .dashboard-title {\n      font-size: 1.25rem;\n      font-weight: 600;\n      color: #1f2937;\n      margin: 0;\n    }\n\n    .dashboard-refresh-btn {\n      padding: 0.5rem;\n      border: none;\n      background: transparent;\n      cursor: pointer;\n      color: #6b7280;\n      border-radius: 0.25rem;\n      transition: color 0.2s, background 0.2s;\n    }\n\n    .dashboard-refresh-btn:hover {\n      color: #374151;\n      background: #f3f4f6;\n    }\n\n    /* Summary Cards */\n    .dashboard-summary-cards {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n      gap: 1rem;\n    }\n\n    .summary-card {\n      padding: 1rem;\n      border-radius: 0.5rem;\n      text-align: center;\n      cursor: pointer;\n      transition: transform 0.2s, box-shadow 0.2s;\n    }\n\n    .summary-card:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    }\n\n    .summary-count {\n      font-size: 1.75rem;\n      font-weight: 700;\n      line-height: 1;\n    }\n\n    .summary-label {\n      font-size: 0.875rem;\n      margin-top: 0.25rem;\n      opacity: 0.8;\n    }\n\n    /* Filter Bar */\n    .dashboard-filter-bar {\n      display: flex;\n      gap: 0.5rem;\n      flex-wrap: wrap;\n      border-bottom: 1px solid #e5e7eb;\n      padding-bottom: 0.75rem;\n    }\n\n    .filter-preset {\n      display: inline-flex;\n      align-items: center;\n      gap: 0.375rem;\n      padding: 0.5rem 0.75rem;\n      font-size: 0.875rem;\n      border: 1px solid #e5e7eb;\n      border-radius: 0.375rem;\n      background: white;\n      cursor: pointer;\n      color: #6b7280;\n      transition: all 0.2s;\n    }\n\n    .filter-preset:hover {\n      border-color: #d1d5db;\n      color: #374151;\n    }\n\n    .filter-preset.active {\n      border-color: #2563eb;\n      background: #eff6ff;\n      color: #2563eb;\n    }\n\n    .filter-badge {\n      padding: 0.125rem 0.375rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      background: #e5e7eb;\n      border-radius: 9999px;\n    }\n\n    .filter-preset.active .filter-badge {\n      background: #dbeafe;\n    }\n\n    /* Loading State */\n    .dashboard-loading {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      padding: 3rem;\n      color: #6b7280;\n    }\n\n    .loading-spinner {\n      width: 2rem;\n      height: 2rem;\n      border: 2px solid #e5e7eb;\n      border-top-color: #2563eb;\n      border-radius: 50%;\n      animation: spin 1s linear infinite;\n      margin-bottom: 1rem;\n    }\n\n    @keyframes spin {\n      to { transform: rotate(360deg); }\n    }\n\n    /* Error State */\n    .dashboard-error {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 3rem;\n      text-align: center;\n    }\n\n    .error-message {\n      font-weight: 500;\n      color: #dc2626;\n      margin: 1rem 0 0.5rem;\n    }\n\n    .error-detail {\n      font-size: 0.875rem;\n      color: #6b7280;\n      margin: 0 0 1rem;\n    }\n\n    .retry-btn {\n      padding: 0.5rem 1rem;\n      font-size: 0.875rem;\n      border: 1px solid #d1d5db;\n      border-radius: 0.375rem;\n      background: white;\n      cursor: pointer;\n      color: #374151;\n      transition: all 0.2s;\n    }\n\n    .retry-btn:hover {\n      background: #f3f4f6;\n    }\n\n    /* Empty State */\n    .dashboard-empty {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 3rem;\n      text-align: center;\n    }\n\n    .empty-title {\n      font-weight: 500;\n      color: #374151;\n      margin: 1rem 0 0.5rem;\n    }\n\n    .empty-description {\n      font-size: 0.875rem;\n      color: #6b7280;\n      margin: 0;\n    }\n\n    /* Disabled State (TX-101: visible-disabled module UX) */\n    .dashboard-disabled {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 3rem;\n      text-align: center;\n      background: #f9fafb;\n      border: 2px dashed #d1d5db;\n      border-radius: 0.5rem;\n      opacity: 0.9;\n    }\n\n    .disabled-icon {\n      margin-bottom: 1rem;\n    }\n\n    .disabled-title {\n      font-weight: 600;\n      color: #4b5563;\n      margin: 0 0 0.5rem;\n      font-size: 1.125rem;\n    }\n\n    .disabled-description {\n      font-size: 0.875rem;\n      color: #6b7280;\n      margin: 0 0 1rem;\n      max-width: 300px;\n    }\n\n    .disabled-help-text {\n      font-size: 0.75rem;\n      color: #9ca3af;\n      margin: 1rem 0 0;\n      max-width: 300px;\n    }\n\n    /* Assignment Table */\n    .dashboard-assignment-list {\n      overflow-x: auto;\n    }\n\n    .assignment-table {\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 0.875rem;\n    }\n\n    .assignment-table th {\n      text-align: left;\n      padding: 0.75rem;\n      font-weight: 500;\n      color: #6b7280;\n      border-bottom: 1px solid #e5e7eb;\n      white-space: nowrap;\n    }\n\n    .assignment-table td {\n      padding: 0.75rem;\n      border-bottom: 1px solid #f3f4f6;\n      vertical-align: middle;\n    }\n\n    .assignment-row {\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    .assignment-row:hover {\n      background: #f9fafb;\n    }\n\n    .title-cell .title-content {\n      display: flex;\n      flex-direction: column;\n      gap: 0.125rem;\n    }\n\n    .source-title {\n      font-weight: 500;\n      color: #1f2937;\n    }\n\n    .entity-type {\n      font-size: 0.75rem;\n      color: #9ca3af;\n    }\n\n    .locale-cell {\n      display: flex;\n      align-items: center;\n      gap: 0.25rem;\n    }\n\n    .locale-badge {\n      padding: 0.125rem 0.375rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      background: #dbeafe;\n      color: #1d4ed8;\n      border-radius: 0.25rem;\n    }\n\n    .locale-badge.source {\n      background: #f3f4f6;\n      color: #6b7280;\n    }\n\n    .locale-arrow {\n      color: #9ca3af;\n    }\n\n    .status-badge {\n      display: inline-block;\n      padding: 0.25rem 0.5rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      border-radius: 9999px;\n    }\n\n    .status-pending { background: #f3f4f6; color: #6b7280; }\n    .status-assigned { background: #e0e7ff; color: #4338ca; }\n    .status-in-progress { background: #dbeafe; color: #1d4ed8; }\n    .status-review { background: #fae8ff; color: #a21caf; }\n    .status-approved { background: #d1fae5; color: #059669; }\n    .status-published { background: #d1fae5; color: #047857; }\n    .status-archived { background: #e5e7eb; color: #6b7280; }\n\n    .due-overdue { color: #dc2626; font-weight: 500; }\n    .due-soon { color: #d97706; }\n    .due-on-track { color: #059669; }\n\n    .priority-indicator {\n      font-size: 0.75rem;\n      font-weight: 500;\n    }\n\n    .priority-urgent { color: #dc2626; }\n    .priority-high { color: #d97706; }\n    .priority-normal { color: #6b7280; }\n    .priority-low { color: #9ca3af; }\n\n    .actions-col { width: 100px; text-align: right; }\n    .actions-cell { text-align: right; }\n\n    .action-buttons {\n      display: flex;\n      justify-content: flex-end;\n      gap: 0.25rem;\n    }\n\n    .action-btn {\n      padding: 0.375rem;\n      border: none;\n      background: transparent;\n      cursor: pointer;\n      border-radius: 0.25rem;\n      color: #6b7280;\n      transition: all 0.2s;\n    }\n\n    .action-btn:hover {\n      background: #f3f4f6;\n      color: #374151;\n    }\n\n    .open-btn:hover { color: #2563eb; }\n    .submit-review-btn:hover { color: #7c3aed; }\n    .approve-btn:hover { color: #059669; }\n    .reject-btn:hover { color: #dc2626; }\n\n    /* Responsive */\n    @media (max-width: 640px) {\n      .translator-dashboard {\n        padding: 1rem;\n      }\n\n      .dashboard-summary-cards {\n        grid-template-columns: repeat(2, 1fr);\n      }\n\n      .assignment-table th:nth-child(4),\n      .assignment-table td:nth-child(4),\n      .assignment-table th:nth-child(5),\n      .assignment-table td:nth-child(5) {\n        display: none;\n      }\n    }\n  `;\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create and mount a translator dashboard\n */\nexport function createTranslatorDashboard(\n  container: HTMLElement,\n  config: TranslatorDashboardConfig\n): TranslatorDashboard {\n  const dashboard = new TranslatorDashboard(config);\n  dashboard.mount(container);\n  return dashboard;\n}\n\n/**\n * Initialize translator dashboard from data attributes\n */\nexport function initTranslatorDashboard(container: HTMLElement): TranslatorDashboard | null {\n  return initTranslatorDashboardWithOptions(container);\n}\n\n/**\n * Initialize translator dashboard from data attributes with optional overrides.\n *\n * Hybrid behavior:\n * - Default: auto-resolve capability gate from global translation capabilities.\n * - Override: caller-provided capabilityGate/capabilitiesPayload wins.\n */\nexport function initTranslatorDashboardWithOptions(\n  container: HTMLElement,\n  options: InitTranslatorDashboardOptions = {}\n): TranslatorDashboard | null {\n  const endpoint = container.dataset.myWorkEndpoint;\n  if (!endpoint) {\n    console.warn('TranslatorDashboard: Missing data-my-work-endpoint attribute');\n    return null;\n  }\n\n  const capabilityGate = resolveInitCapabilityGate(options);\n\n  return createTranslatorDashboard(container, {\n    myWorkEndpoint: endpoint,\n    panelBaseUrl: container.dataset.panelBaseUrl,\n    queueEndpoint: container.dataset.queueEndpoint,\n    refreshInterval: parseInt(container.dataset.refreshInterval || '0', 10),\n    capabilityGate: capabilityGate || undefined,\n  });\n}\n\nfunction resolveInitCapabilityGate(options: InitTranslatorDashboardOptions): CapabilityGate | null {\n  if (options.capabilityGate) {\n    return options.capabilityGate;\n  }\n  if (options.capabilitiesPayload !== undefined) {\n    return createCapabilityGate(options.capabilitiesPayload);\n  }\n  const globalPayload = resolveGlobalCapabilitiesPayload();\n  if (globalPayload === null) {\n    return null;\n  }\n  return createCapabilityGate(globalPayload);\n}\n\nfunction resolveGlobalCapabilitiesPayload(): unknown | null {\n  if (typeof window !== 'undefined') {\n    const globalCaps = (window as any).__TRANSLATION_CAPABILITIES__;\n    if (globalCaps && typeof globalCaps === 'object') {\n      return globalCaps;\n    }\n  }\n\n  if (typeof document !== 'undefined') {\n    const scriptEl = document.querySelector<HTMLScriptElement>('script[data-translation-capabilities]');\n    if (scriptEl && scriptEl.textContent) {\n      try {\n        return JSON.parse(scriptEl.textContent);\n      } catch {\n        return null;\n      }\n    }\n  }\n\n  return null;\n}\n","/**\n * Exchange Import Component (Phase 4 - TX-048)\n *\n * Provides enhanced import workflow with:\n * - Preview grid for validation results\n * - Selective row apply\n * - Conflict resolution controls\n * - Permission-gated apply action\n */\n\nimport type { GateResult, CapabilityGate } from './capability-gate.js';\nimport type {\n  ExchangeRowResult,\n  ExchangeRowStatus,\n  ExchangeConflictInfo,\n  ExchangeResultSummary,\n  ExchangeImportResult,\n} from '../toast/error-helpers.js';\nimport { renderVocabularyStatusBadge, getStatusCssClass } from './translation-status-vocabulary.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Conflict resolution strategy for import rows\n * (Named ImportConflictResolution to avoid collision with autosave-indicator's ConflictResolution)\n */\nexport type ImportConflictResolution = 'skip' | 'keep_current' | 'accept_incoming' | 'force';\n\n/**\n * Row selection state\n */\nexport interface RowSelectionState {\n  selected: Set<number>;\n  excluded: Set<number>;\n  allSelected: boolean;\n}\n\n/**\n * Import preview row with selection and resolution state\n */\nexport interface ImportPreviewRow extends ExchangeRowResult {\n  isSelected: boolean;\n  resolution?: ImportConflictResolution;\n}\n\n/**\n * Import preview state\n */\nexport type ImportPreviewState = 'idle' | 'validating' | 'validated' | 'applying' | 'applied' | 'error';\n\n/**\n * Import apply options\n */\nexport interface ImportApplyOptions {\n  selectedIndices?: number[];\n  allowCreateMissing?: boolean;\n  allowSourceHashOverride?: boolean;\n  continueOnError?: boolean;\n  dryRun?: boolean;\n  async?: boolean;\n}\n\n/**\n * Import component configuration\n */\nexport interface ExchangeImportConfig {\n  /** Validation endpoint */\n  validateEndpoint: string;\n  /** Apply endpoint */\n  applyEndpoint: string;\n  /** Capability gate for permission checks */\n  capabilityGate?: CapabilityGate;\n  /** Callback when validation completes */\n  onValidationComplete?: (result: ExchangeImportResult) => void;\n  /** Callback when apply completes */\n  onApplyComplete?: (result: ExchangeImportResult) => void;\n  /** Callback when error occurs */\n  onError?: (error: Error) => void;\n  /** Custom labels */\n  labels?: Partial<ImportLabels>;\n}\n\n/**\n * Customizable labels\n */\nexport interface ImportLabels {\n  title: string;\n  selectFile: string;\n  validateButton: string;\n  applyButton: string;\n  cancelButton: string;\n  selectAll: string;\n  deselectAll: string;\n  selectedCount: string;\n  previewTitle: string;\n  conflictResolution: string;\n  keepCurrent: string;\n  acceptIncoming: string;\n  skip: string;\n  force: string;\n  success: string;\n  error: string;\n  conflict: string;\n  skipped: string;\n  validating: string;\n  applying: string;\n  noRowsSelected: string;\n  applyDisabledReason: string;\n  resource: string;\n  field: string;\n  status: string;\n  sourceText: string;\n  translatedText: string;\n  conflictDetails: string;\n  allowCreateMissing: string;\n  continueOnError: string;\n  dryRun: string;\n}\n\nconst DEFAULT_LABELS: ImportLabels = {\n  title: 'Import Translations',\n  selectFile: 'Select file or paste data',\n  validateButton: 'Validate',\n  applyButton: 'Apply',\n  cancelButton: 'Cancel',\n  selectAll: 'Select All',\n  deselectAll: 'Deselect All',\n  selectedCount: 'selected',\n  previewTitle: 'Preview',\n  conflictResolution: 'Conflict Resolution',\n  keepCurrent: 'Keep Current',\n  acceptIncoming: 'Accept Incoming',\n  skip: 'Skip',\n  force: 'Force',\n  success: 'Success',\n  error: 'Error',\n  conflict: 'Conflict',\n  skipped: 'Skipped',\n  validating: 'Validating...',\n  applying: 'Applying...',\n  noRowsSelected: 'No rows selected',\n  applyDisabledReason: 'Missing import.apply permission',\n  resource: 'Resource',\n  field: 'Field',\n  status: 'Status',\n  sourceText: 'Source',\n  translatedText: 'Translation',\n  conflictDetails: 'Conflict Details',\n  allowCreateMissing: 'Create missing translations',\n  continueOnError: 'Continue on error',\n  dryRun: 'Dry run (preview only)',\n};\n\n/**\n * Resolved config with labels fully typed (merged with defaults)\n */\ninterface ResolvedExchangeImportConfig {\n  validateEndpoint: string;\n  applyEndpoint: string;\n  capabilityGate?: CapabilityGate;\n  onValidationComplete?: (result: ExchangeImportResult) => void;\n  onApplyComplete?: (result: ExchangeImportResult) => void;\n  onError?: (error: Error) => void;\n  labels: ImportLabels;\n}\n\n// ============================================================================\n// ExchangeImport Class\n// ============================================================================\n\n/**\n * Exchange Import component\n */\nexport class ExchangeImport {\n  private config: ResolvedExchangeImportConfig;\n  private container: HTMLElement | null = null;\n  private state: ImportPreviewState = 'idle';\n  private validationResult: ExchangeImportResult | null = null;\n  private previewRows: ImportPreviewRow[] = [];\n  private selection: RowSelectionState = {\n    selected: new Set(),\n    excluded: new Set(),\n    allSelected: false,\n  };\n  private applyOptions: ImportApplyOptions = {\n    allowCreateMissing: false,\n    continueOnError: false,\n    dryRun: false,\n    async: false,\n  };\n  private error: Error | null = null;\n  private file: File | null = null;\n  private rawData: string = '';\n\n  constructor(config: ExchangeImportConfig) {\n    const labels = { ...DEFAULT_LABELS, ...(config.labels || {}) };\n    this.config = {\n      validateEndpoint: config.validateEndpoint,\n      applyEndpoint: config.applyEndpoint,\n      capabilityGate: config.capabilityGate,\n      onValidationComplete: config.onValidationComplete,\n      onApplyComplete: config.onApplyComplete,\n      onError: config.onError,\n      labels,\n    };\n  }\n\n  /**\n   * Mount the component to a container\n   */\n  mount(container: HTMLElement): void {\n    this.container = container;\n    this.render();\n  }\n\n  /**\n   * Unmount and cleanup\n   */\n  unmount(): void {\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n\n  /**\n   * Get current state\n   */\n  getState(): ImportPreviewState {\n    return this.state;\n  }\n\n  /**\n   * Get validation result\n   */\n  getValidationResult(): ExchangeImportResult | null {\n    return this.validationResult;\n  }\n\n  /**\n   * Get selected row indices\n   */\n  getSelectedIndices(): number[] {\n    if (this.selection.allSelected) {\n      return this.previewRows\n        .filter(row => !this.selection.excluded.has(row.index))\n        .map(row => row.index);\n    }\n    return Array.from(this.selection.selected);\n  }\n\n  /**\n   * Set file for import\n   */\n  setFile(file: File): void {\n    this.file = file;\n    this.rawData = '';\n    this.render();\n  }\n\n  /**\n   * Set raw data for import\n   */\n  setRawData(data: string): void {\n    this.rawData = data;\n    this.file = null;\n    this.render();\n  }\n\n  /**\n   * Validate the import data\n   */\n  async validate(): Promise<ExchangeImportResult | null> {\n    this.state = 'validating';\n    this.error = null;\n    this.render();\n\n    try {\n      const formData = new FormData();\n\n      if (this.file) {\n        formData.append('file', this.file);\n      } else if (this.rawData) {\n        // Send as JSON body\n        const response = await fetch(this.config.validateEndpoint, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n          },\n          body: this.rawData,\n        });\n\n        if (!response.ok) {\n          throw new Error(`Validation failed: ${response.status}`);\n        }\n\n        const result = await response.json() as ExchangeImportResult;\n        this.handleValidationResult(result);\n        return result;\n      } else {\n        throw new Error('No file or data to validate');\n      }\n\n      const response = await fetch(this.config.validateEndpoint, {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(`Validation failed: ${response.status}`);\n      }\n\n      const result = await response.json() as ExchangeImportResult;\n      this.handleValidationResult(result);\n      return result;\n    } catch (err) {\n      this.error = err instanceof Error ? err : new Error(String(err));\n      this.state = 'error';\n      this.config.onError?.(this.error);\n      this.render();\n      return null;\n    }\n  }\n\n  /**\n   * Apply the import with selected rows\n   */\n  async apply(options?: ImportApplyOptions): Promise<ExchangeImportResult | null> {\n    const mergedOptions = { ...this.applyOptions, ...options };\n    const selectedIndices = mergedOptions.selectedIndices || this.getSelectedIndices();\n\n    if (selectedIndices.length === 0) {\n      this.error = new Error(this.config.labels.noRowsSelected);\n      this.render();\n      return null;\n    }\n\n    // Check permission\n    if (this.config.capabilityGate) {\n      const gate = this.config.capabilityGate.gateAction('exchange', 'import.apply');\n      if (!gate.enabled) {\n        this.error = new Error(gate.reason || this.config.labels.applyDisabledReason);\n        this.render();\n        return null;\n      }\n    }\n\n    this.state = 'applying';\n    this.error = null;\n    this.render();\n\n    try {\n      // Filter rows by selected indices\n      const selectedRows = this.validationResult?.results.filter(\n        row => selectedIndices.includes(row.index)\n      ) || [];\n\n      // Apply conflict resolutions\n      const rowsWithResolutions = selectedRows.map(row => {\n        const previewRow = this.previewRows.find(p => p.index === row.index);\n        return {\n          ...row,\n          resolution: previewRow?.resolution,\n        };\n      });\n\n      const payload = {\n        rows: rowsWithResolutions,\n        allow_create_missing: mergedOptions.allowCreateMissing,\n        allow_source_hash_override: mergedOptions.allowSourceHashOverride,\n        continue_on_error: mergedOptions.continueOnError,\n        dry_run: mergedOptions.dryRun,\n        async: mergedOptions.async,\n      };\n\n      const response = await fetch(this.config.applyEndpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Apply failed: ${response.status}`);\n      }\n\n      const result = await response.json() as ExchangeImportResult;\n      this.state = 'applied';\n      this.config.onApplyComplete?.(result);\n      this.render();\n      return result;\n    } catch (err) {\n      this.error = err instanceof Error ? err : new Error(String(err));\n      this.state = 'error';\n      this.config.onError?.(this.error);\n      this.render();\n      return null;\n    }\n  }\n\n  /**\n   * Toggle row selection\n   */\n  toggleRowSelection(index: number): void {\n    if (this.selection.allSelected) {\n      if (this.selection.excluded.has(index)) {\n        this.selection.excluded.delete(index);\n      } else {\n        this.selection.excluded.add(index);\n      }\n    } else {\n      if (this.selection.selected.has(index)) {\n        this.selection.selected.delete(index);\n      } else {\n        this.selection.selected.add(index);\n      }\n    }\n    this.updatePreviewRowSelection();\n    this.render();\n  }\n\n  /**\n   * Select all rows\n   */\n  selectAll(): void {\n    this.selection.allSelected = true;\n    this.selection.excluded.clear();\n    this.updatePreviewRowSelection();\n    this.render();\n  }\n\n  /**\n   * Deselect all rows\n   */\n  deselectAll(): void {\n    this.selection.allSelected = false;\n    this.selection.selected.clear();\n    this.selection.excluded.clear();\n    this.updatePreviewRowSelection();\n    this.render();\n  }\n\n  /**\n   * Set resolution for a row\n   */\n  setRowResolution(index: number, resolution: ImportConflictResolution): void {\n    const row = this.previewRows.find(r => r.index === index);\n    if (row) {\n      row.resolution = resolution;\n      this.render();\n    }\n  }\n\n  /**\n   * Set apply option\n   */\n  setApplyOption<K extends keyof ImportApplyOptions>(key: K, value: ImportApplyOptions[K]): void {\n    this.applyOptions[key] = value;\n    this.render();\n  }\n\n  /**\n   * Reset to idle state\n   */\n  reset(): void {\n    this.state = 'idle';\n    this.validationResult = null;\n    this.previewRows = [];\n    this.selection = {\n      selected: new Set(),\n      excluded: new Set(),\n      allSelected: false,\n    };\n    this.error = null;\n    this.file = null;\n    this.rawData = '';\n    this.render();\n  }\n\n  private handleValidationResult(result: ExchangeImportResult): void {\n    this.validationResult = result;\n    this.previewRows = result.results.map(row => ({\n      ...row,\n      isSelected: row.status !== 'error',\n      resolution: row.status === 'conflict' ? 'skip' : undefined,\n    }));\n\n    // Auto-select all non-error rows\n    this.selection.allSelected = true;\n    this.selection.excluded = new Set(\n      result.results.filter(r => r.status === 'error').map(r => r.index)\n    );\n\n    this.state = 'validated';\n    this.config.onValidationComplete?.(result);\n    this.render();\n  }\n\n  private updatePreviewRowSelection(): void {\n    this.previewRows = this.previewRows.map(row => ({\n      ...row,\n      isSelected: this.selection.allSelected\n        ? !this.selection.excluded.has(row.index)\n        : this.selection.selected.has(row.index),\n    }));\n  }\n\n  private render(): void {\n    if (!this.container) return;\n\n    const labels = this.config.labels;\n    this.container.innerHTML = `\n      <div class=\"exchange-import\" role=\"dialog\" aria-label=\"${escapeHtml(labels.title)}\">\n        ${this.renderHeader()}\n        ${this.renderContent()}\n        ${this.renderFooter()}\n      </div>\n    `;\n\n    this.attachEventListeners();\n  }\n\n  private renderHeader(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"import-header\">\n        <h3 class=\"import-title\">${escapeHtml(labels.title)}</h3>\n        ${this.validationResult ? this.renderSummaryBadges() : ''}\n      </div>\n    `;\n  }\n\n  private renderSummaryBadges(): string {\n    if (!this.validationResult) return '';\n\n    const summary = this.validationResult.summary;\n    const labels = this.config.labels;\n\n    return `\n      <div class=\"import-summary-badges\">\n        <span class=\"summary-badge success\">${summary.succeeded} ${escapeHtml(labels.success)}</span>\n        <span class=\"summary-badge error\">${summary.failed} ${escapeHtml(labels.error)}</span>\n        <span class=\"summary-badge conflict\">${summary.conflicts} ${escapeHtml(labels.conflict)}</span>\n        <span class=\"summary-badge skipped\">${summary.skipped} ${escapeHtml(labels.skipped)}</span>\n      </div>\n    `;\n  }\n\n  private renderContent(): string {\n    switch (this.state) {\n      case 'idle':\n        return this.renderFileInput();\n      case 'validating':\n        return this.renderLoading(this.config.labels.validating);\n      case 'validated':\n        return this.renderPreviewGrid();\n      case 'applying':\n        return this.renderLoading(this.config.labels.applying);\n      case 'applied':\n        return this.renderApplyResult();\n      case 'error':\n        return this.renderError();\n      default:\n        return '';\n    }\n  }\n\n  private renderFileInput(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"import-file-input\">\n        <label class=\"file-dropzone\">\n          <input type=\"file\" accept=\".csv,.json\" class=\"file-input\" />\n          <span class=\"dropzone-text\">${escapeHtml(labels.selectFile)}</span>\n        </label>\n        <div class=\"or-divider\">or</div>\n        <textarea class=\"data-input\" placeholder=\"Paste JSON or CSV data here...\" rows=\"5\"></textarea>\n      </div>\n    `;\n  }\n\n  private renderLoading(message: string): string {\n    return `\n      <div class=\"import-loading\" role=\"status\" aria-busy=\"true\">\n        <div class=\"loading-spinner\"></div>\n        <p>${escapeHtml(message)}</p>\n      </div>\n    `;\n  }\n\n  private renderPreviewGrid(): string {\n    const labels = this.config.labels;\n    const selectedCount = this.getSelectedIndices().length;\n    const totalCount = this.previewRows.length;\n\n    return `\n      <div class=\"import-preview\">\n        <div class=\"preview-toolbar\">\n          <div class=\"selection-controls\">\n            <button type=\"button\" class=\"select-all-btn\">${escapeHtml(labels.selectAll)}</button>\n            <button type=\"button\" class=\"deselect-all-btn\">${escapeHtml(labels.deselectAll)}</button>\n            <span class=\"selection-count\">${selectedCount} / ${totalCount} ${escapeHtml(labels.selectedCount)}</span>\n          </div>\n          <div class=\"import-options\">\n            <label class=\"option-checkbox\">\n              <input type=\"checkbox\" name=\"allowCreateMissing\" ${this.applyOptions.allowCreateMissing ? 'checked' : ''} />\n              ${escapeHtml(labels.allowCreateMissing)}\n            </label>\n            <label class=\"option-checkbox\">\n              <input type=\"checkbox\" name=\"continueOnError\" ${this.applyOptions.continueOnError ? 'checked' : ''} />\n              ${escapeHtml(labels.continueOnError)}\n            </label>\n            <label class=\"option-checkbox\">\n              <input type=\"checkbox\" name=\"dryRun\" ${this.applyOptions.dryRun ? 'checked' : ''} />\n              ${escapeHtml(labels.dryRun)}\n            </label>\n          </div>\n        </div>\n        <div class=\"preview-grid-container\">\n          <table class=\"preview-grid\" role=\"grid\">\n            <thead>\n              <tr>\n                <th scope=\"col\" class=\"select-col\">\n                  <input type=\"checkbox\" class=\"select-all-checkbox\" ${this.selection.allSelected && this.selection.excluded.size === 0 ? 'checked' : ''} />\n                </th>\n                <th scope=\"col\">${escapeHtml(labels.resource)}</th>\n                <th scope=\"col\">${escapeHtml(labels.field)}</th>\n                <th scope=\"col\">${escapeHtml(labels.status)}</th>\n                <th scope=\"col\">${escapeHtml(labels.translatedText)}</th>\n                <th scope=\"col\">${escapeHtml(labels.conflictResolution)}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${this.previewRows.map(row => this.renderPreviewRow(row)).join('')}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderPreviewRow(row: ImportPreviewRow): string {\n    const labels = this.config.labels;\n    const statusClass = getStatusCssClass(row.status, 'exchange');\n    const isDisabled = row.status === 'error';\n    const statusBadge = renderVocabularyStatusBadge(row.status, {\n      domain: 'exchange',\n      size: 'sm',\n    });\n\n    return `\n      <tr class=\"preview-row ${statusClass} ${row.isSelected ? 'selected' : ''}\" data-index=\"${row.index}\">\n        <td class=\"select-col\">\n          <input type=\"checkbox\" class=\"row-checkbox\" ${row.isSelected ? 'checked' : ''} ${isDisabled ? 'disabled' : ''} />\n        </td>\n        <td class=\"resource-cell\">\n          <span class=\"resource-type\">${escapeHtml(row.resource)}</span>\n          <span class=\"entity-id\">${escapeHtml(row.entityId)}</span>\n        </td>\n        <td class=\"field-cell\">${escapeHtml(row.fieldPath)}</td>\n        <td class=\"status-cell\">\n          ${statusBadge}\n          ${row.error ? `<span class=\"error-message\" title=\"${escapeAttr(row.error)}\">${escapeHtml(truncate(row.error, 30))}</span>` : ''}\n        </td>\n        <td class=\"translation-cell\">\n          <span class=\"translation-text\" title=\"${escapeAttr(row.targetLocale)}\">${escapeHtml(row.targetLocale)}</span>\n        </td>\n        <td class=\"resolution-cell\">\n          ${row.status === 'conflict' ? this.renderConflictResolution(row) : '-'}\n        </td>\n      </tr>\n    `;\n  }\n\n  private renderConflictResolution(row: ImportPreviewRow): string {\n    const labels = this.config.labels;\n    const resolution = row.resolution || 'skip';\n\n    return `\n      <select class=\"resolution-select\" data-index=\"${row.index}\">\n        <option value=\"skip\" ${resolution === 'skip' ? 'selected' : ''}>${escapeHtml(labels.skip)}</option>\n        <option value=\"keep_current\" ${resolution === 'keep_current' ? 'selected' : ''}>${escapeHtml(labels.keepCurrent)}</option>\n        <option value=\"accept_incoming\" ${resolution === 'accept_incoming' ? 'selected' : ''}>${escapeHtml(labels.acceptIncoming)}</option>\n        <option value=\"force\" ${resolution === 'force' ? 'selected' : ''}>${escapeHtml(labels.force)}</option>\n      </select>\n      ${row.conflict ? `<button type=\"button\" class=\"conflict-details-btn\" data-index=\"${row.index}\" title=\"${escapeAttr(labels.conflictDetails)}\">?</button>` : ''}\n    `;\n  }\n\n  private renderApplyResult(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"import-applied\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-12 h-12 text-green-500\">\n          <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z\" clip-rule=\"evenodd\" />\n        </svg>\n        <p class=\"applied-message\">Import completed successfully</p>\n        <button type=\"button\" class=\"reset-btn\">Import Another</button>\n      </div>\n    `;\n  }\n\n  private renderError(): string {\n    const labels = this.config.labels;\n    return `\n      <div class=\"import-error\" role=\"alert\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-10 h-10 text-red-500\">\n          <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z\" clip-rule=\"evenodd\" />\n        </svg>\n        <p class=\"error-message\">${escapeHtml(this.error?.message || labels.error)}</p>\n        <button type=\"button\" class=\"reset-btn\">${escapeHtml(labels.cancelButton)}</button>\n      </div>\n    `;\n  }\n\n  private renderFooter(): string {\n    const labels = this.config.labels;\n    const canApply = this.state === 'validated' && this.getSelectedIndices().length > 0;\n    const applyGate = this.getApplyGate();\n\n    return `\n      <div class=\"import-footer\">\n        <button type=\"button\" class=\"cancel-btn\">${escapeHtml(labels.cancelButton)}</button>\n        ${this.state === 'idle' ? `\n          <button type=\"button\" class=\"validate-btn\" ${!this.file && !this.rawData ? 'disabled' : ''}>\n            ${escapeHtml(labels.validateButton)}\n          </button>\n        ` : ''}\n        ${this.state === 'validated' ? `\n          <button type=\"button\"\n                  class=\"apply-btn\"\n                  ${!canApply || !applyGate.enabled ? 'disabled' : ''}\n                  ${!applyGate.enabled ? `aria-disabled=\"true\" title=\"${escapeAttr(applyGate.reason || labels.applyDisabledReason)}\"` : ''}>\n            ${escapeHtml(labels.applyButton)}\n          </button>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  private getApplyGate(): GateResult {\n    if (!this.config.capabilityGate) {\n      return { visible: true, enabled: true };\n    }\n    return this.config.capabilityGate.gateAction('exchange', 'import.apply');\n  }\n\n  private attachEventListeners(): void {\n    if (!this.container) return;\n\n    // File input\n    const fileInput = this.container.querySelector<HTMLInputElement>('.file-input');\n    fileInput?.addEventListener('change', (e) => {\n      const target = e.target as HTMLInputElement;\n      if (target.files?.[0]) {\n        this.setFile(target.files[0]);\n      }\n    });\n\n    // Data input\n    const dataInput = this.container.querySelector<HTMLTextAreaElement>('.data-input');\n    dataInput?.addEventListener('input', (e) => {\n      const target = e.target as HTMLTextAreaElement;\n      this.rawData = target.value;\n    });\n\n    // Validate button\n    const validateBtn = this.container.querySelector('.validate-btn');\n    validateBtn?.addEventListener('click', () => this.validate());\n\n    // Apply button\n    const applyBtn = this.container.querySelector('.apply-btn');\n    applyBtn?.addEventListener('click', () => this.apply());\n\n    // Cancel button\n    const cancelBtn = this.container.querySelector('.cancel-btn');\n    cancelBtn?.addEventListener('click', () => this.reset());\n\n    // Reset button\n    const resetBtn = this.container.querySelector('.reset-btn');\n    resetBtn?.addEventListener('click', () => this.reset());\n\n    // Select all / deselect all\n    const selectAllBtn = this.container.querySelector('.select-all-btn');\n    selectAllBtn?.addEventListener('click', () => this.selectAll());\n\n    const deselectAllBtn = this.container.querySelector('.deselect-all-btn');\n    deselectAllBtn?.addEventListener('click', () => this.deselectAll());\n\n    // Select all checkbox\n    const selectAllCheckbox = this.container.querySelector<HTMLInputElement>('.select-all-checkbox');\n    selectAllCheckbox?.addEventListener('change', (e) => {\n      const target = e.target as HTMLInputElement;\n      if (target.checked) {\n        this.selectAll();\n      } else {\n        this.deselectAll();\n      }\n    });\n\n    // Row checkboxes\n    const rowCheckboxes = this.container.querySelectorAll<HTMLInputElement>('.row-checkbox');\n    rowCheckboxes.forEach(checkbox => {\n      checkbox.addEventListener('change', () => {\n        const row = checkbox.closest<HTMLTableRowElement>('.preview-row');\n        const index = parseInt(row?.dataset.index || '', 10);\n        if (!isNaN(index)) {\n          this.toggleRowSelection(index);\n        }\n      });\n    });\n\n    // Resolution selects\n    const resolutionSelects = this.container.querySelectorAll<HTMLSelectElement>('.resolution-select');\n    resolutionSelects.forEach(select => {\n      select.addEventListener('change', () => {\n        const index = parseInt(select.dataset.index || '', 10);\n        if (!isNaN(index)) {\n          this.setRowResolution(index, select.value as ImportConflictResolution);\n        }\n      });\n    });\n\n    // Option checkboxes\n    const optionCheckboxes = this.container.querySelectorAll<HTMLInputElement>('.option-checkbox input');\n    optionCheckboxes.forEach(checkbox => {\n      checkbox.addEventListener('change', () => {\n        const name = checkbox.name as keyof ImportApplyOptions;\n        if (name) {\n          this.setApplyOption(name, checkbox.checked);\n        }\n      });\n    });\n  }\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction escapeAttr(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\n// Local getStatusClass removed - now using shared getStatusCssClass from translation-status-vocabulary.ts (TX-053)\n\nfunction truncate(str: string, maxLength: number): string {\n  if (str.length <= maxLength) return str;\n  return str.slice(0, maxLength - 3) + '...';\n}\n\n// ============================================================================\n// CSS Styles\n// ============================================================================\n\n/**\n * Get CSS styles for exchange import component\n */\nexport function getExchangeImportStyles(): string {\n  return `\n    /* Exchange Import Styles */\n    .exchange-import {\n      display: flex;\n      flex-direction: column;\n      gap: 1.5rem;\n      padding: 1.5rem;\n      background: white;\n      border-radius: 0.5rem;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n      max-height: 80vh;\n      overflow: hidden;\n    }\n\n    .import-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      flex-wrap: wrap;\n      gap: 1rem;\n    }\n\n    .import-title {\n      font-size: 1.25rem;\n      font-weight: 600;\n      color: #1f2937;\n      margin: 0;\n    }\n\n    .import-summary-badges {\n      display: flex;\n      gap: 0.5rem;\n    }\n\n    .summary-badge {\n      padding: 0.25rem 0.5rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      border-radius: 9999px;\n    }\n\n    .summary-badge.success { background: #d1fae5; color: #059669; }\n    .summary-badge.error { background: #fee2e2; color: #dc2626; }\n    .summary-badge.conflict { background: #fef3c7; color: #d97706; }\n    .summary-badge.skipped { background: #f3f4f6; color: #6b7280; }\n\n    /* File Input */\n    .import-file-input {\n      display: flex;\n      flex-direction: column;\n      gap: 1rem;\n    }\n\n    .file-dropzone {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 2rem;\n      border: 2px dashed #d1d5db;\n      border-radius: 0.5rem;\n      cursor: pointer;\n      transition: border-color 0.2s, background 0.2s;\n    }\n\n    .file-dropzone:hover {\n      border-color: #2563eb;\n      background: #eff6ff;\n    }\n\n    .file-input {\n      display: none;\n    }\n\n    .dropzone-text {\n      font-size: 0.875rem;\n      color: #6b7280;\n    }\n\n    .or-divider {\n      text-align: center;\n      color: #9ca3af;\n      font-size: 0.875rem;\n    }\n\n    .data-input {\n      width: 100%;\n      padding: 0.75rem;\n      font-family: monospace;\n      font-size: 0.875rem;\n      border: 1px solid #d1d5db;\n      border-radius: 0.375rem;\n      resize: vertical;\n    }\n\n    /* Loading */\n    .import-loading {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      padding: 3rem;\n      color: #6b7280;\n    }\n\n    .loading-spinner {\n      width: 2rem;\n      height: 2rem;\n      border: 2px solid #e5e7eb;\n      border-top-color: #2563eb;\n      border-radius: 50%;\n      animation: spin 1s linear infinite;\n      margin-bottom: 1rem;\n    }\n\n    @keyframes spin {\n      to { transform: rotate(360deg); }\n    }\n\n    /* Preview Grid */\n    .import-preview {\n      display: flex;\n      flex-direction: column;\n      gap: 1rem;\n      flex: 1;\n      overflow: hidden;\n    }\n\n    .preview-toolbar {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      flex-wrap: wrap;\n      gap: 1rem;\n    }\n\n    .selection-controls {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n    }\n\n    .selection-count {\n      font-size: 0.875rem;\n      color: #6b7280;\n    }\n\n    .import-options {\n      display: flex;\n      gap: 1rem;\n      flex-wrap: wrap;\n    }\n\n    .option-checkbox {\n      display: flex;\n      align-items: center;\n      gap: 0.375rem;\n      font-size: 0.875rem;\n      color: #374151;\n      cursor: pointer;\n    }\n\n    .preview-grid-container {\n      flex: 1;\n      overflow: auto;\n      border: 1px solid #e5e7eb;\n      border-radius: 0.375rem;\n    }\n\n    .preview-grid {\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 0.875rem;\n    }\n\n    .preview-grid th {\n      position: sticky;\n      top: 0;\n      background: #f9fafb;\n      padding: 0.75rem 0.5rem;\n      text-align: left;\n      font-weight: 500;\n      color: #6b7280;\n      border-bottom: 1px solid #e5e7eb;\n    }\n\n    .preview-grid td {\n      padding: 0.5rem;\n      border-bottom: 1px solid #f3f4f6;\n      vertical-align: middle;\n    }\n\n    .preview-row.selected {\n      background: #eff6ff;\n    }\n\n    .preview-row.status-error {\n      opacity: 0.6;\n    }\n\n    .select-col {\n      width: 40px;\n      text-align: center;\n    }\n\n    .resource-cell {\n      display: flex;\n      flex-direction: column;\n      gap: 0.125rem;\n    }\n\n    .resource-type {\n      font-weight: 500;\n      color: #1f2937;\n    }\n\n    .entity-id {\n      font-size: 0.75rem;\n      color: #9ca3af;\n    }\n\n    .status-badge {\n      display: inline-block;\n      padding: 0.125rem 0.375rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      border-radius: 0.25rem;\n    }\n\n    .status-badge.status-success { background: #d1fae5; color: #059669; }\n    .status-badge.status-error { background: #fee2e2; color: #dc2626; }\n    .status-badge.status-conflict { background: #fef3c7; color: #d97706; }\n    .status-badge.status-skipped { background: #f3f4f6; color: #6b7280; }\n\n    .error-message {\n      display: block;\n      font-size: 0.75rem;\n      color: #dc2626;\n      margin-top: 0.125rem;\n    }\n\n    .resolution-select {\n      padding: 0.25rem 0.5rem;\n      font-size: 0.75rem;\n      border: 1px solid #d1d5db;\n      border-radius: 0.25rem;\n    }\n\n    .conflict-details-btn {\n      padding: 0.125rem 0.375rem;\n      font-size: 0.75rem;\n      border: 1px solid #d1d5db;\n      border-radius: 0.25rem;\n      background: white;\n      cursor: pointer;\n      margin-left: 0.25rem;\n    }\n\n    /* Applied / Error states */\n    .import-applied,\n    .import-error {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 3rem;\n      text-align: center;\n    }\n\n    .applied-message,\n    .error-message {\n      font-weight: 500;\n      margin: 1rem 0;\n    }\n\n    .import-applied .applied-message { color: #059669; }\n    .import-error .error-message { color: #dc2626; }\n\n    /* Footer */\n    .import-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 0.75rem;\n      padding-top: 1rem;\n      border-top: 1px solid #e5e7eb;\n    }\n\n    .cancel-btn,\n    .validate-btn,\n    .apply-btn,\n    .reset-btn,\n    .select-all-btn,\n    .deselect-all-btn {\n      padding: 0.5rem 1rem;\n      font-size: 0.875rem;\n      border-radius: 0.375rem;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .cancel-btn,\n    .reset-btn,\n    .select-all-btn,\n    .deselect-all-btn {\n      background: white;\n      border: 1px solid #d1d5db;\n      color: #374151;\n    }\n\n    .cancel-btn:hover,\n    .reset-btn:hover,\n    .select-all-btn:hover,\n    .deselect-all-btn:hover {\n      background: #f3f4f6;\n    }\n\n    .validate-btn,\n    .apply-btn {\n      background: #2563eb;\n      border: none;\n      color: white;\n    }\n\n    .validate-btn:hover,\n    .apply-btn:hover {\n      background: #1d4ed8;\n    }\n\n    .validate-btn:disabled,\n    .apply-btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .apply-btn[aria-disabled=\"true\"] {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n  `;\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create and mount an exchange import component\n */\nexport function createExchangeImport(\n  container: HTMLElement,\n  config: ExchangeImportConfig\n): ExchangeImport {\n  const component = new ExchangeImport(config);\n  component.mount(container);\n  return component;\n}\n\n/**\n * Initialize exchange import from data attributes\n */\nexport function initExchangeImport(container: HTMLElement): ExchangeImport | null {\n  const validateEndpoint = container.dataset.validateEndpoint;\n  const applyEndpoint = container.dataset.applyEndpoint;\n\n  if (!validateEndpoint || !applyEndpoint) {\n    console.warn('ExchangeImport: Missing required data attributes');\n    return null;\n  }\n\n  return createExchangeImport(container, {\n    validateEndpoint,\n    applyEndpoint,\n  });\n}\n","/**\n * Async Progress UI Component (Phase 4 - TX-049)\n *\n * Provides async job progress tracking with:\n * - Status polling with configurable interval\n * - Progress bar based on counters\n * - Resume capability (localStorage persistence)\n * - Completion/failure states\n */\n\nimport { renderVocabularyStatusBadge, getStatusCssClass } from './translation-status-vocabulary.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Job status from backend\n */\nexport type JobStatus = 'running' | 'completed' | 'failed';\n\n/**\n * Component polling state\n */\nexport type PollingState = 'idle' | 'polling' | 'paused' | 'stopped';\n\n/**\n * Progress counters from backend\n */\nexport interface JobProgress {\n  processed: number;\n  succeeded: number;\n  failed: number;\n  total?: number;\n}\n\n/**\n * Conflict summary from backend\n */\nexport interface ConflictSummary {\n  total: number;\n  by_type: Record<string, number>;\n  rows?: Array<{\n    index: number;\n    type: string;\n    message: string;\n  }>;\n}\n\n/**\n * Async job envelope from backend\n */\nexport interface AsyncJobEnvelope {\n  id: string;\n  kind: string;\n  status: JobStatus;\n  poll_endpoint: string;\n  progress: JobProgress;\n  created_at: string;\n  updated_at: string;\n  error?: string;\n  result?: Record<string, unknown>;\n  conflict_summary?: ConflictSummary;\n}\n\n/**\n * Persisted job state for resume capability\n */\nexport interface PersistedJobState {\n  jobId: string;\n  kind: string;\n  pollEndpoint: string;\n  startedAt: string;\n  lastPolledAt?: string;\n}\n\n/**\n * Progress component configuration\n */\nexport interface AsyncProgressConfig {\n  /** Storage key prefix for persistence */\n  storageKeyPrefix?: string;\n  /** Polling interval in milliseconds */\n  pollInterval?: number;\n  /** Maximum polling attempts before giving up */\n  maxPollAttempts?: number;\n  /** Callback when job completes successfully */\n  onComplete?: (job: AsyncJobEnvelope) => void;\n  /** Callback when job fails */\n  onFailed?: (job: AsyncJobEnvelope) => void;\n  /** Callback on polling error */\n  onError?: (error: Error) => void;\n  /** Callback on each progress update */\n  onProgress?: (job: AsyncJobEnvelope) => void;\n  /** Custom labels */\n  labels?: Partial<AsyncProgressLabels>;\n  /** Auto-start polling when job is set */\n  autoStart?: boolean;\n}\n\n/**\n * Customizable labels\n */\nexport interface AsyncProgressLabels {\n  title: string;\n  running: string;\n  completed: string;\n  failed: string;\n  processed: string;\n  succeeded: string;\n  failedCount: string;\n  resume: string;\n  cancel: string;\n  retry: string;\n  dismiss: string;\n  noActiveJob: string;\n  pollingPaused: string;\n  pollingStopped: string;\n  jobId: string;\n  startedAt: string;\n  elapsed: string;\n  conflicts: string;\n}\n\nconst DEFAULT_LABELS: AsyncProgressLabels = {\n  title: 'Job Progress',\n  running: 'In Progress',\n  completed: 'Completed',\n  failed: 'Failed',\n  processed: 'Processed',\n  succeeded: 'Succeeded',\n  failedCount: 'Failed',\n  resume: 'Resume',\n  cancel: 'Cancel',\n  retry: 'Retry',\n  dismiss: 'Dismiss',\n  noActiveJob: 'No active job',\n  pollingPaused: 'Polling paused',\n  pollingStopped: 'Polling stopped',\n  jobId: 'Job ID',\n  startedAt: 'Started',\n  elapsed: 'Elapsed',\n  conflicts: 'Conflicts',\n};\n\nconst DEFAULT_POLL_INTERVAL = 2000;\nconst DEFAULT_MAX_POLL_ATTEMPTS = 300; // 10 minutes at 2s interval\nconst DEFAULT_STORAGE_KEY_PREFIX = 'async_job_';\n\n/**\n * Resolved config with all labels\n */\ninterface ResolvedAsyncProgressConfig {\n  storageKeyPrefix: string;\n  pollInterval: number;\n  maxPollAttempts: number;\n  onComplete?: (job: AsyncJobEnvelope) => void;\n  onFailed?: (job: AsyncJobEnvelope) => void;\n  onError?: (error: Error) => void;\n  onProgress?: (job: AsyncJobEnvelope) => void;\n  labels: AsyncProgressLabels;\n  autoStart: boolean;\n}\n\n// ============================================================================\n// AsyncProgress Class\n// ============================================================================\n\n/**\n * Async Progress UI component\n */\nexport class AsyncProgress {\n  private config: ResolvedAsyncProgressConfig;\n  private container: HTMLElement | null = null;\n  private job: AsyncJobEnvelope | null = null;\n  private pollingState: PollingState = 'idle';\n  private pollTimer: ReturnType<typeof setTimeout> | null = null;\n  private pollAttempts: number = 0;\n  private startTime: Date | null = null;\n  private error: Error | null = null;\n\n  constructor(config: AsyncProgressConfig = {}) {\n    const labels = { ...DEFAULT_LABELS, ...(config.labels || {}) };\n    this.config = {\n      storageKeyPrefix: config.storageKeyPrefix || DEFAULT_STORAGE_KEY_PREFIX,\n      pollInterval: config.pollInterval || DEFAULT_POLL_INTERVAL,\n      maxPollAttempts: config.maxPollAttempts || DEFAULT_MAX_POLL_ATTEMPTS,\n      onComplete: config.onComplete,\n      onFailed: config.onFailed,\n      onError: config.onError,\n      onProgress: config.onProgress,\n      labels,\n      autoStart: config.autoStart !== false,\n    };\n  }\n\n  /**\n   * Mount the component to a container\n   */\n  mount(container: HTMLElement): void {\n    this.container = container;\n    this.render();\n  }\n\n  /**\n   * Unmount and cleanup\n   */\n  unmount(): void {\n    this.stopPolling();\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n\n  /**\n   * Get current job\n   */\n  getJob(): AsyncJobEnvelope | null {\n    return this.job;\n  }\n\n  /**\n   * Get polling state\n   */\n  getPollingState(): PollingState {\n    return this.pollingState;\n  }\n\n  /**\n   * Set a new job to track\n   */\n  setJob(job: AsyncJobEnvelope): void {\n    this.job = job;\n    this.startTime = new Date();\n    this.pollAttempts = 0;\n    this.error = null;\n    this.persistJob(job);\n\n    if (this.config.autoStart && job.status === 'running') {\n      this.startPolling();\n    } else {\n      this.render();\n    }\n  }\n\n  /**\n   * Start from a job envelope (initial response)\n   */\n  startFromEnvelope(envelope: AsyncJobEnvelope): void {\n    this.setJob(envelope);\n  }\n\n  /**\n   * Resume tracking a persisted job\n   */\n  resumeFromStorage(kind: string): boolean {\n    const persisted = this.loadPersistedJob(kind);\n    if (!persisted) {\n      return false;\n    }\n\n    // Create minimal job envelope to start polling\n    this.job = {\n      id: persisted.jobId,\n      kind: persisted.kind,\n      status: 'running',\n      poll_endpoint: persisted.pollEndpoint,\n      progress: { processed: 0, succeeded: 0, failed: 0 },\n      created_at: persisted.startedAt,\n      updated_at: persisted.lastPolledAt || persisted.startedAt,\n    };\n    this.startTime = new Date(persisted.startedAt);\n    this.pollAttempts = 0;\n    this.error = null;\n\n    if (this.config.autoStart) {\n      this.startPolling();\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if there's a persisted job for a kind\n   */\n  hasPersistedJob(kind: string): boolean {\n    return this.loadPersistedJob(kind) !== null;\n  }\n\n  /**\n   * Start polling\n   */\n  startPolling(): void {\n    if (!this.job) return;\n    if (this.pollingState === 'polling') return;\n\n    this.pollingState = 'polling';\n    this.error = null;\n    this.schedulePoll();\n    this.render();\n  }\n\n  /**\n   * Pause polling (can be resumed)\n   */\n  pausePolling(): void {\n    if (this.pollingState !== 'polling') return;\n\n    this.pollingState = 'paused';\n    if (this.pollTimer) {\n      clearTimeout(this.pollTimer);\n      this.pollTimer = null;\n    }\n    this.render();\n  }\n\n  /**\n   * Stop polling (cannot be resumed without new setJob)\n   */\n  stopPolling(): void {\n    this.pollingState = 'stopped';\n    if (this.pollTimer) {\n      clearTimeout(this.pollTimer);\n      this.pollTimer = null;\n    }\n    this.clearPersistedJob(this.job?.kind || '');\n    this.render();\n  }\n\n  /**\n   * Resume paused polling\n   */\n  resumePolling(): void {\n    if (this.pollingState !== 'paused') return;\n\n    this.pollingState = 'polling';\n    this.schedulePoll();\n    this.render();\n  }\n\n  /**\n   * Reset to initial state\n   */\n  reset(): void {\n    this.stopPolling();\n    this.job = null;\n    this.pollingState = 'idle';\n    this.pollAttempts = 0;\n    this.startTime = null;\n    this.error = null;\n    this.render();\n  }\n\n  /**\n   * Retry after failure\n   */\n  retry(): void {\n    if (!this.job) return;\n    this.pollAttempts = 0;\n    this.error = null;\n    this.startPolling();\n  }\n\n  private schedulePoll(): void {\n    if (this.pollingState !== 'polling') return;\n\n    this.pollTimer = setTimeout(() => {\n      this.poll();\n    }, this.config.pollInterval);\n  }\n\n  private async poll(): Promise<void> {\n    if (!this.job || this.pollingState !== 'polling') return;\n\n    this.pollAttempts++;\n\n    try {\n      const response = await fetch(this.job.poll_endpoint, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(`Poll failed: ${response.status}`);\n      }\n\n      const data = await response.json();\n      this.handlePollResponse(data);\n    } catch (err) {\n      this.handlePollError(err instanceof Error ? err : new Error(String(err)));\n    }\n  }\n\n  private handlePollResponse(data: AsyncJobEnvelope): void {\n    this.job = data;\n    this.updatePersistedJob(data);\n    this.config.onProgress?.(data);\n\n    if (data.status === 'completed') {\n      this.pollingState = 'stopped';\n      this.clearPersistedJob(data.kind);\n      this.config.onComplete?.(data);\n      this.render();\n      return;\n    }\n\n    if (data.status === 'failed') {\n      this.pollingState = 'stopped';\n      this.clearPersistedJob(data.kind);\n      this.config.onFailed?.(data);\n      this.render();\n      return;\n    }\n\n    // Check max attempts\n    if (this.pollAttempts >= this.config.maxPollAttempts) {\n      this.error = new Error('Max polling attempts reached');\n      this.pollingState = 'stopped';\n      this.config.onError?.(this.error);\n      this.render();\n      return;\n    }\n\n    // Continue polling\n    this.render();\n    this.schedulePoll();\n  }\n\n  private handlePollError(error: Error): void {\n    this.error = error;\n    this.pollingState = 'paused'; // Pause on error, allow retry\n    this.config.onError?.(error);\n    this.render();\n  }\n\n  // Storage helpers\n  private getStorageKey(kind: string): string {\n    return `${this.config.storageKeyPrefix}${kind}`;\n  }\n\n  private persistJob(job: AsyncJobEnvelope): void {\n    try {\n      const state: PersistedJobState = {\n        jobId: job.id,\n        kind: job.kind,\n        pollEndpoint: job.poll_endpoint,\n        startedAt: job.created_at,\n      };\n      localStorage.setItem(this.getStorageKey(job.kind), JSON.stringify(state));\n    } catch {\n      // localStorage not available\n    }\n  }\n\n  private updatePersistedJob(job: AsyncJobEnvelope): void {\n    try {\n      const key = this.getStorageKey(job.kind);\n      const existing = localStorage.getItem(key);\n      if (existing) {\n        const state: PersistedJobState = JSON.parse(existing);\n        state.lastPolledAt = new Date().toISOString();\n        localStorage.setItem(key, JSON.stringify(state));\n      }\n    } catch {\n      // localStorage not available\n    }\n  }\n\n  private clearPersistedJob(kind: string): void {\n    try {\n      localStorage.removeItem(this.getStorageKey(kind));\n    } catch {\n      // localStorage not available\n    }\n  }\n\n  private loadPersistedJob(kind: string): PersistedJobState | null {\n    try {\n      const data = localStorage.getItem(this.getStorageKey(kind));\n      if (!data) return null;\n      return JSON.parse(data) as PersistedJobState;\n    } catch {\n      return null;\n    }\n  }\n\n  // Rendering\n  private render(): void {\n    if (!this.container) return;\n\n    const labels = this.config.labels;\n\n    this.container.innerHTML = `\n      <div class=\"async-progress\" role=\"region\" aria-label=\"${escapeHtml(labels.title)}\">\n        ${this.renderHeader()}\n        ${this.renderContent()}\n        ${this.renderFooter()}\n      </div>\n    `;\n\n    this.attachEventListeners();\n  }\n\n  private renderHeader(): string {\n    const labels = this.config.labels;\n\n    if (!this.job) {\n      return `\n        <div class=\"progress-header idle\">\n          <h4 class=\"progress-title\">${escapeHtml(labels.title)}</h4>\n          <span class=\"progress-status\">${escapeHtml(labels.noActiveJob)}</span>\n        </div>\n      `;\n    }\n\n    const statusClass = getStatusCssClass(this.job.status, 'exchange');\n    const statusLabel = this.getStatusLabel();\n    const statusHtml = this.pollingState === 'paused'\n      ? `<span class=\"progress-status ${statusClass}\">${escapeHtml(statusLabel)}</span>`\n      : renderVocabularyStatusBadge(this.job.status, { domain: 'exchange', size: 'sm' });\n\n    return `\n      <div class=\"progress-header ${statusClass}\">\n        <h4 class=\"progress-title\">${escapeHtml(labels.title)}</h4>\n        ${statusHtml}\n      </div>\n    `;\n  }\n\n  private renderContent(): string {\n    if (!this.job) {\n      return '';\n    }\n\n    const labels = this.config.labels;\n    const progress = this.job.progress;\n    const total = progress.total || (progress.processed + 1); // Estimate if not provided\n    const percentage = progress.total\n      ? Math.round((progress.processed / progress.total) * 100)\n      : null;\n\n    return `\n      <div class=\"progress-content\">\n        ${this.renderProgressBar(percentage)}\n        <div class=\"progress-counters\">\n          <span class=\"counter processed\">\n            <span class=\"counter-label\">${escapeHtml(labels.processed)}:</span>\n            <span class=\"counter-value\">${progress.processed}${progress.total ? ` / ${progress.total}` : ''}</span>\n          </span>\n          <span class=\"counter succeeded\">\n            <span class=\"counter-label\">${escapeHtml(labels.succeeded)}:</span>\n            <span class=\"counter-value\">${progress.succeeded}</span>\n          </span>\n          <span class=\"counter failed\">\n            <span class=\"counter-label\">${escapeHtml(labels.failedCount)}:</span>\n            <span class=\"counter-value\">${progress.failed}</span>\n          </span>\n        </div>\n        ${this.renderJobInfo()}\n        ${this.renderConflictSummary()}\n        ${this.renderError()}\n      </div>\n    `;\n  }\n\n  private renderProgressBar(percentage: number | null): string {\n    if (percentage === null) {\n      // Indeterminate progress bar\n      return `\n        <div class=\"progress-bar-container\">\n          <div class=\"progress-bar indeterminate\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"progress-bar-container\">\n        <div class=\"progress-bar\"\n             role=\"progressbar\"\n             aria-valuenow=\"${percentage}\"\n             aria-valuemin=\"0\"\n             aria-valuemax=\"100\"\n             style=\"width: ${percentage}%\">\n        </div>\n        <span class=\"progress-percentage\">${percentage}%</span>\n      </div>\n    `;\n  }\n\n  private renderJobInfo(): string {\n    if (!this.job) return '';\n\n    const labels = this.config.labels;\n    const elapsed = this.getElapsedTime();\n\n    return `\n      <div class=\"progress-info\">\n        <span class=\"info-item\">\n          <span class=\"info-label\">${escapeHtml(labels.jobId)}:</span>\n          <code class=\"info-value\">${escapeHtml(this.job.id)}</code>\n        </span>\n        ${elapsed ? `\n          <span class=\"info-item\">\n            <span class=\"info-label\">${escapeHtml(labels.elapsed)}:</span>\n            <span class=\"info-value\">${escapeHtml(elapsed)}</span>\n          </span>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  private renderConflictSummary(): string {\n    if (!this.job?.conflict_summary || this.job.conflict_summary.total === 0) {\n      return '';\n    }\n\n    const labels = this.config.labels;\n    const summary = this.job.conflict_summary;\n\n    return `\n      <div class=\"progress-conflicts\">\n        <span class=\"conflicts-header\">\n          <span class=\"conflicts-label\">${escapeHtml(labels.conflicts)}:</span>\n          <span class=\"conflicts-count\">${summary.total}</span>\n        </span>\n        <div class=\"conflicts-by-type\">\n          ${Object.entries(summary.by_type)\n            .map(([type, count]) => `\n              <span class=\"conflict-type\">\n                <span class=\"type-name\">${escapeHtml(type)}:</span>\n                <span class=\"type-count\">${count}</span>\n              </span>\n            `)\n            .join('')}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderError(): string {\n    const errorMessage = this.error?.message || this.job?.error;\n    if (!errorMessage) return '';\n\n    return `\n      <div class=\"progress-error\" role=\"alert\">\n        <span class=\"error-message\">${escapeHtml(errorMessage)}</span>\n      </div>\n    `;\n  }\n\n  private renderFooter(): string {\n    const labels = this.config.labels;\n    const buttons: string[] = [];\n\n    if (this.pollingState === 'paused') {\n      buttons.push(`<button type=\"button\" class=\"resume-btn\">${escapeHtml(labels.resume)}</button>`);\n    }\n\n    if (this.pollingState === 'polling') {\n      buttons.push(`<button type=\"button\" class=\"cancel-btn\">${escapeHtml(labels.cancel)}</button>`);\n    }\n\n    if (this.error || this.job?.status === 'failed') {\n      buttons.push(`<button type=\"button\" class=\"retry-btn\">${escapeHtml(labels.retry)}</button>`);\n    }\n\n    if (this.job?.status === 'completed' || this.job?.status === 'failed') {\n      buttons.push(`<button type=\"button\" class=\"dismiss-btn\">${escapeHtml(labels.dismiss)}</button>`);\n    }\n\n    if (buttons.length === 0) {\n      return '';\n    }\n\n    return `\n      <div class=\"progress-footer\">\n        ${buttons.join('')}\n      </div>\n    `;\n  }\n\n  private getStatusLabel(): string {\n    const labels = this.config.labels;\n\n    if (this.pollingState === 'paused') {\n      return labels.pollingPaused;\n    }\n    if (this.pollingState === 'stopped' && !this.job?.status) {\n      return labels.pollingStopped;\n    }\n\n    switch (this.job?.status) {\n      case 'running':\n        return labels.running;\n      case 'completed':\n        return labels.completed;\n      case 'failed':\n        return labels.failed;\n      default:\n        return '';\n    }\n  }\n\n  private getElapsedTime(): string | null {\n    if (!this.startTime) return null;\n\n    const now = new Date();\n    const elapsed = now.getTime() - this.startTime.getTime();\n    const seconds = Math.floor(elapsed / 1000);\n\n    if (seconds < 60) {\n      return `${seconds}s`;\n    }\n\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = seconds % 60;\n\n    if (minutes < 60) {\n      return `${minutes}m ${remainingSeconds}s`;\n    }\n\n    const hours = Math.floor(minutes / 60);\n    const remainingMinutes = minutes % 60;\n\n    return `${hours}h ${remainingMinutes}m`;\n  }\n\n  private attachEventListeners(): void {\n    if (!this.container) return;\n\n    const resumeBtn = this.container.querySelector('.resume-btn');\n    resumeBtn?.addEventListener('click', () => this.resumePolling());\n\n    const cancelBtn = this.container.querySelector('.cancel-btn');\n    cancelBtn?.addEventListener('click', () => this.stopPolling());\n\n    const retryBtn = this.container.querySelector('.retry-btn');\n    retryBtn?.addEventListener('click', () => this.retry());\n\n    const dismissBtn = this.container.querySelector('.dismiss-btn');\n    dismissBtn?.addEventListener('click', () => this.reset());\n  }\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\n// Local getStatusClass removed - now using shared getStatusCssClass from translation-status-vocabulary.ts (TX-053)\n\n// ============================================================================\n// CSS Styles\n// ============================================================================\n\n/**\n * Get CSS styles for async progress component\n */\nexport function getAsyncProgressStyles(): string {\n  return `\n    /* Async Progress Styles */\n    .async-progress {\n      display: flex;\n      flex-direction: column;\n      gap: 1rem;\n      padding: 1rem;\n      background: white;\n      border: 1px solid #e5e7eb;\n      border-radius: 0.5rem;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n    }\n\n    .progress-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .progress-title {\n      font-size: 1rem;\n      font-weight: 600;\n      color: #1f2937;\n      margin: 0;\n    }\n\n    .progress-status {\n      padding: 0.25rem 0.5rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      border-radius: 9999px;\n    }\n\n    .progress-status.status-running {\n      background: #dbeafe;\n      color: #2563eb;\n    }\n\n    .progress-status.status-completed {\n      background: #d1fae5;\n      color: #059669;\n    }\n\n    .progress-status.status-failed {\n      background: #fee2e2;\n      color: #dc2626;\n    }\n\n    .progress-content {\n      display: flex;\n      flex-direction: column;\n      gap: 0.75rem;\n    }\n\n    /* Progress Bar */\n    .progress-bar-container {\n      position: relative;\n      height: 8px;\n      background: #e5e7eb;\n      border-radius: 9999px;\n      overflow: hidden;\n    }\n\n    .progress-bar {\n      height: 100%;\n      background: #2563eb;\n      border-radius: 9999px;\n      transition: width 0.3s ease;\n    }\n\n    .progress-bar.indeterminate {\n      width: 30%;\n      animation: progress-indeterminate 1.5s infinite ease-in-out;\n    }\n\n    @keyframes progress-indeterminate {\n      0% { transform: translateX(-100%); }\n      50% { transform: translateX(200%); }\n      100% { transform: translateX(-100%); }\n    }\n\n    .progress-percentage {\n      position: absolute;\n      right: 0;\n      top: 12px;\n      font-size: 0.75rem;\n      color: #6b7280;\n    }\n\n    /* Counters */\n    .progress-counters {\n      display: flex;\n      gap: 1rem;\n      flex-wrap: wrap;\n    }\n\n    .counter {\n      display: flex;\n      gap: 0.25rem;\n      font-size: 0.875rem;\n    }\n\n    .counter-label {\n      color: #6b7280;\n    }\n\n    .counter-value {\n      font-weight: 500;\n      color: #1f2937;\n    }\n\n    .counter.succeeded .counter-value {\n      color: #059669;\n    }\n\n    .counter.failed .counter-value {\n      color: #dc2626;\n    }\n\n    /* Job Info */\n    .progress-info {\n      display: flex;\n      flex-direction: column;\n      gap: 0.25rem;\n      padding-top: 0.5rem;\n      border-top: 1px solid #f3f4f6;\n    }\n\n    .info-item {\n      display: flex;\n      gap: 0.5rem;\n      font-size: 0.75rem;\n    }\n\n    .info-label {\n      color: #9ca3af;\n    }\n\n    .info-value {\n      color: #6b7280;\n    }\n\n    .info-value code {\n      font-family: monospace;\n      background: #f3f4f6;\n      padding: 0.125rem 0.25rem;\n      border-radius: 0.25rem;\n    }\n\n    /* Conflicts */\n    .progress-conflicts {\n      padding: 0.5rem;\n      background: #fef3c7;\n      border-radius: 0.375rem;\n    }\n\n    .conflicts-header {\n      display: flex;\n      gap: 0.25rem;\n      font-size: 0.875rem;\n      font-weight: 500;\n      color: #92400e;\n    }\n\n    .conflicts-by-type {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.25rem;\n    }\n\n    .conflict-type {\n      font-size: 0.75rem;\n      color: #b45309;\n    }\n\n    /* Error */\n    .progress-error {\n      padding: 0.5rem;\n      background: #fee2e2;\n      border-radius: 0.375rem;\n    }\n\n    .progress-error .error-message {\n      font-size: 0.875rem;\n      color: #dc2626;\n    }\n\n    /* Footer */\n    .progress-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 0.5rem;\n      padding-top: 0.75rem;\n      border-top: 1px solid #e5e7eb;\n    }\n\n    .resume-btn,\n    .cancel-btn,\n    .retry-btn,\n    .dismiss-btn {\n      padding: 0.375rem 0.75rem;\n      font-size: 0.875rem;\n      border-radius: 0.375rem;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .resume-btn,\n    .retry-btn {\n      background: #2563eb;\n      border: none;\n      color: white;\n    }\n\n    .resume-btn:hover,\n    .retry-btn:hover {\n      background: #1d4ed8;\n    }\n\n    .cancel-btn,\n    .dismiss-btn {\n      background: white;\n      border: 1px solid #d1d5db;\n      color: #374151;\n    }\n\n    .cancel-btn:hover,\n    .dismiss-btn:hover {\n      background: #f3f4f6;\n    }\n  `;\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create and mount an async progress component\n */\nexport function createAsyncProgress(\n  container: HTMLElement,\n  config?: AsyncProgressConfig\n): AsyncProgress {\n  const component = new AsyncProgress(config);\n  component.mount(container);\n  return component;\n}\n\n/**\n * Initialize async progress from data attributes\n */\nexport function initAsyncProgress(container: HTMLElement): AsyncProgress | null {\n  const pollInterval = container.dataset.pollInterval\n    ? parseInt(container.dataset.pollInterval, 10)\n    : undefined;\n  const autoStart = container.dataset.autoStart !== 'false';\n\n  return createAsyncProgress(container, {\n    pollInterval,\n    autoStart,\n  });\n}\n\n/**\n * Check for and resume any persisted jobs for a kind\n */\nexport function checkForPersistedJob(\n  kind: string,\n  config?: AsyncProgressConfig\n): AsyncProgress | null {\n  const component = new AsyncProgress(config);\n  if (component.hasPersistedJob(kind)) {\n    return component;\n  }\n  return null;\n}\n","/**\n * Side-by-Side Translation Editor (Phase 5 - TX-051)\n *\n * Provides a split-pane translation editor with source-target field pairing\n * and drift banner support. Uses the `source_target_drift` contract from backend.\n *\n * Contract (from backend translation_contracts.go):\n * - source_target_drift.source_hash: Hash of source content for drift detection\n * - source_target_drift.source_version: Version of source content\n * - source_target_drift.changed_fields_summary: { count: number, fields: string[] }\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Source-target drift metadata from backend\n */\nexport interface SourceTargetDrift {\n  /** Hash of source content */\n  sourceHash: string | null;\n  /** Version of source content */\n  sourceVersion: string | null;\n  /** Changed fields summary */\n  changedFieldsSummary: {\n    /** Number of changed fields */\n    count: number;\n    /** List of changed field names */\n    fields: string[];\n  };\n  /** Whether drift is detected */\n  hasDrift: boolean;\n}\n\n/**\n * Field definition for side-by-side editing\n */\nexport interface SideBySideField {\n  /** Field key/name */\n  key: string;\n  /** Display label */\n  label: string;\n  /** Field type (text, textarea, richtext, etc.) */\n  type: 'text' | 'textarea' | 'richtext' | 'html';\n  /** Whether the source has changed for this field */\n  hasSourceChanged: boolean;\n  /** Source value (read-only) */\n  sourceValue: string;\n  /** Target value (editable) */\n  targetValue: string;\n  /** Source locale */\n  sourceLocale: string;\n  /** Target locale */\n  targetLocale: string;\n  /** Whether field is required */\n  required?: boolean;\n  /** Character limit */\n  maxLength?: number;\n  /** Placeholder text */\n  placeholder?: string;\n}\n\n/**\n * Side-by-side editor configuration\n */\nexport interface SideBySideEditorConfig {\n  /** Container element or selector */\n  container: HTMLElement | string;\n  /** Fields to display */\n  fields: SideBySideField[];\n  /** Source-target drift metadata */\n  drift: SourceTargetDrift | null;\n  /** Source locale code */\n  sourceLocale: string;\n  /** Target locale code */\n  targetLocale: string;\n  /** Panel name for API calls */\n  panelName: string;\n  /** Record ID being edited */\n  recordId: string;\n  /** Base API path */\n  basePath?: string;\n  /** Callback when a field value changes */\n  onChange?: (key: string, value: string) => void;\n  /** Callback when drift is acknowledged */\n  onDriftAcknowledge?: () => void;\n  /** Callback to copy source to target */\n  onCopySource?: (key: string) => void;\n  /** Labels for UI elements */\n  labels?: SideBySideLabels;\n}\n\n/**\n * UI labels for the side-by-side editor\n */\nexport interface SideBySideLabels {\n  sourceColumn?: string;\n  targetColumn?: string;\n  driftBannerTitle?: string;\n  driftBannerDescription?: string;\n  driftAcknowledgeButton?: string;\n  driftViewChangesButton?: string;\n  copySourceButton?: string;\n  fieldChangedIndicator?: string;\n}\n\n/**\n * Default labels\n */\nexport const DEFAULT_SIDE_BY_SIDE_LABELS: Required<SideBySideLabels> = {\n  sourceColumn: 'Source',\n  targetColumn: 'Translation',\n  driftBannerTitle: 'Source content has changed',\n  driftBannerDescription: 'The source content has been updated since this translation was last edited.',\n  driftAcknowledgeButton: 'Acknowledge',\n  driftViewChangesButton: 'View Changes',\n  copySourceButton: 'Copy from source',\n  fieldChangedIndicator: 'Source changed',\n};\n\n// ============================================================================\n// Drift Extraction\n// ============================================================================\n\n/**\n * Extract source-target drift metadata from a record payload\n */\nexport function extractSourceTargetDrift(record: Record<string, unknown>): SourceTargetDrift {\n  const result: SourceTargetDrift = {\n    sourceHash: null,\n    sourceVersion: null,\n    changedFieldsSummary: { count: 0, fields: [] },\n    hasDrift: false,\n  };\n\n  if (!record || typeof record !== 'object') {\n    return result;\n  }\n\n  // Check for source_target_drift nested object (canonical format)\n  const drift = record.source_target_drift as Record<string, unknown> | undefined;\n\n  if (drift && typeof drift === 'object') {\n    result.sourceHash = typeof drift.source_hash === 'string' ? drift.source_hash : null;\n    result.sourceVersion = typeof drift.source_version === 'string' ? drift.source_version : null;\n\n    const summary = drift.changed_fields_summary as Record<string, unknown> | undefined;\n    if (summary && typeof summary === 'object') {\n      result.changedFieldsSummary.count = typeof summary.count === 'number' ? summary.count : 0;\n      result.changedFieldsSummary.fields = Array.isArray(summary.fields)\n        ? summary.fields.filter((f): f is string => typeof f === 'string')\n        : [];\n    }\n\n    // Drift is present if there are changed fields\n    result.hasDrift = result.changedFieldsSummary.count > 0 || result.changedFieldsSummary.fields.length > 0;\n  }\n\n  return result;\n}\n\n/**\n * Check if a specific field has source changes\n */\nexport function hasFieldDrift(drift: SourceTargetDrift | null, fieldKey: string): boolean {\n  if (!drift || !drift.hasDrift) {\n    return false;\n  }\n  return drift.changedFieldsSummary.fields.some(\n    f => f.toLowerCase() === fieldKey.toLowerCase()\n  );\n}\n\n/**\n * Get list of changed field keys\n */\nexport function getChangedFields(drift: SourceTargetDrift | null): string[] {\n  if (!drift || !drift.hasDrift) {\n    return [];\n  }\n  return [...drift.changedFieldsSummary.fields];\n}\n\n// ============================================================================\n// Side-by-Side Editor Component\n// ============================================================================\n\nexport class SideBySideEditor {\n  private container: HTMLElement | null = null;\n  private config: Required<Omit<SideBySideEditorConfig, 'container' | 'onChange' | 'onDriftAcknowledge' | 'onCopySource'>> & {\n    container: HTMLElement | null;\n    onChange?: (key: string, value: string) => void;\n    onDriftAcknowledge?: () => void;\n    onCopySource?: (key: string) => void;\n  };\n  private driftAcknowledged: boolean = false;\n\n  constructor(config: SideBySideEditorConfig) {\n    const containerEl = typeof config.container === 'string'\n      ? document.querySelector<HTMLElement>(config.container)\n      : config.container;\n\n    this.config = {\n      container: containerEl,\n      fields: config.fields,\n      drift: config.drift,\n      sourceLocale: config.sourceLocale,\n      targetLocale: config.targetLocale,\n      panelName: config.panelName,\n      recordId: config.recordId,\n      basePath: config.basePath || '/admin',\n      onChange: config.onChange,\n      onDriftAcknowledge: config.onDriftAcknowledge,\n      onCopySource: config.onCopySource,\n      labels: { ...DEFAULT_SIDE_BY_SIDE_LABELS, ...config.labels },\n    };\n\n    this.container = containerEl;\n  }\n\n  /**\n   * Render the side-by-side editor\n   */\n  render(): void {\n    if (!this.container) {\n      console.warn('[SideBySideEditor] Container not found');\n      return;\n    }\n\n    this.container.innerHTML = this.buildHTML();\n    this.attachEventListeners();\n  }\n\n  /**\n   * Build HTML for the editor\n   */\n  buildHTML(): string {\n    const { drift, labels, sourceLocale, targetLocale, fields } = this.config;\n\n    const driftBanner = this.shouldShowDriftBanner()\n      ? this.renderDriftBanner(drift!, labels)\n      : '';\n\n    const fieldsHtml = fields.map(field => this.renderFieldRow(field, labels)).join('');\n\n    return `\n      <div class=\"side-by-side-editor\" data-source-locale=\"${sourceLocale}\" data-target-locale=\"${targetLocale}\">\n        ${driftBanner}\n        <div class=\"sbs-columns\">\n          <div class=\"sbs-header\">\n            <div class=\"sbs-column-header sbs-source-header\">\n              <span class=\"sbs-column-title\">${escapeHtml(labels.sourceColumn!)}</span>\n              <span class=\"sbs-locale-badge\">${sourceLocale.toUpperCase()}</span>\n            </div>\n            <div class=\"sbs-column-header sbs-target-header\">\n              <span class=\"sbs-column-title\">${escapeHtml(labels.targetColumn!)}</span>\n              <span class=\"sbs-locale-badge\">${targetLocale.toUpperCase()}</span>\n            </div>\n          </div>\n          <div class=\"sbs-fields\">\n            ${fieldsHtml}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render the drift warning banner\n   */\n  private renderDriftBanner(drift: SourceTargetDrift, labels: SideBySideLabels): string {\n    const l = { ...DEFAULT_SIDE_BY_SIDE_LABELS, ...labels };\n    const changedCount = drift.changedFieldsSummary.count;\n    const changedFields = drift.changedFieldsSummary.fields;\n\n    const fieldsList = changedFields.length > 0\n      ? `<ul class=\"sbs-drift-fields-list\">${changedFields.map(f => `<li>${escapeHtml(f)}</li>`).join('')}</ul>`\n      : '';\n\n    return `\n      <div class=\"sbs-drift-banner\" role=\"alert\" aria-live=\"polite\" data-drift-banner=\"true\">\n        <div class=\"sbs-drift-icon\">\n          <svg class=\"w-5 h-5 text-amber-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n          </svg>\n        </div>\n        <div class=\"sbs-drift-content\">\n          <h3 class=\"sbs-drift-title\">${escapeHtml(l.driftBannerTitle)}</h3>\n          <p class=\"sbs-drift-description\">\n            ${escapeHtml(l.driftBannerDescription)}\n            ${changedCount > 0 ? `<span class=\"sbs-drift-count\">${changedCount} field${changedCount !== 1 ? 's' : ''} changed.</span>` : ''}\n          </p>\n          ${fieldsList}\n        </div>\n        <div class=\"sbs-drift-actions\">\n          <button type=\"button\" class=\"sbs-drift-acknowledge\" data-action=\"acknowledge-drift\">\n            ${escapeHtml(l.driftAcknowledgeButton)}\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render a single field row\n   */\n  private renderFieldRow(field: SideBySideField, labels: SideBySideLabels): string {\n    const l = { ...DEFAULT_SIDE_BY_SIDE_LABELS, ...labels };\n    const changedIndicator = field.hasSourceChanged\n      ? `<span class=\"sbs-field-changed\" title=\"${escapeHtml(l.fieldChangedIndicator)}\">\n          <svg class=\"w-4 h-4 text-amber-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z\" clip-rule=\"evenodd\" />\n          </svg>\n        </span>`\n      : '';\n\n    const sourceInput = this.renderSourceField(field);\n    const targetInput = this.renderTargetField(field);\n\n    const copyButton = `\n      <button type=\"button\"\n              class=\"sbs-copy-source\"\n              data-action=\"copy-source\"\n              data-field=\"${escapeAttr(field.key)}\"\n              title=\"${escapeAttr(l.copySourceButton)}\"\n              aria-label=\"${escapeAttr(l.copySourceButton)} for ${escapeAttr(field.label)}\">\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/>\n        </svg>\n      </button>\n    `;\n\n    const rowClass = field.hasSourceChanged ? 'sbs-field-row sbs-field-changed-row' : 'sbs-field-row';\n\n    return `\n      <div class=\"${rowClass}\" data-field-key=\"${escapeAttr(field.key)}\">\n        <div class=\"sbs-field-header\">\n          <label class=\"sbs-field-label\">\n            ${escapeHtml(field.label)}\n            ${field.required ? '<span class=\"sbs-required\">*</span>' : ''}\n          </label>\n          ${changedIndicator}\n        </div>\n        <div class=\"sbs-field-content\">\n          <div class=\"sbs-source-field\">\n            ${sourceInput}\n          </div>\n          <div class=\"sbs-field-actions\">\n            ${copyButton}\n          </div>\n          <div class=\"sbs-target-field\">\n            ${targetInput}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render source field (read-only)\n   */\n  private renderSourceField(field: SideBySideField): string {\n    const value = escapeHtml(field.sourceValue || '');\n\n    if (field.type === 'textarea' || field.type === 'richtext' || field.type === 'html') {\n      return `\n        <div class=\"sbs-source-content sbs-textarea-field\"\n             data-field=\"${escapeAttr(field.key)}\"\n             aria-label=\"Source: ${escapeAttr(field.label)}\">\n          ${value || '<span class=\"sbs-empty\">Empty</span>'}\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"sbs-source-content sbs-text-field\"\n           data-field=\"${escapeAttr(field.key)}\"\n           aria-label=\"Source: ${escapeAttr(field.label)}\">\n        ${value || '<span class=\"sbs-empty\">Empty</span>'}\n      </div>\n    `;\n  }\n\n  /**\n   * Render target field (editable)\n   */\n  private renderTargetField(field: SideBySideField): string {\n    const value = escapeHtml(field.targetValue || '');\n    const placeholder = field.placeholder ? `placeholder=\"${escapeAttr(field.placeholder)}\"` : '';\n    const required = field.required ? 'required' : '';\n    const maxLength = field.maxLength ? `maxlength=\"${field.maxLength}\"` : '';\n\n    if (field.type === 'textarea' || field.type === 'richtext' || field.type === 'html') {\n      return `\n        <textarea class=\"sbs-target-input sbs-textarea-input\"\n                  name=\"${escapeAttr(field.key)}\"\n                  data-field=\"${escapeAttr(field.key)}\"\n                  aria-label=\"Translation: ${escapeAttr(field.label)}\"\n                  ${placeholder}\n                  ${required}\n                  ${maxLength}>${value}</textarea>\n      `;\n    }\n\n    return `\n      <input type=\"text\"\n             class=\"sbs-target-input sbs-text-input\"\n             name=\"${escapeAttr(field.key)}\"\n             data-field=\"${escapeAttr(field.key)}\"\n             value=\"${value}\"\n             aria-label=\"Translation: ${escapeAttr(field.label)}\"\n             ${placeholder}\n             ${required}\n             ${maxLength}>\n    `;\n  }\n\n  /**\n   * Check if drift banner should be shown\n   */\n  private shouldShowDriftBanner(): boolean {\n    return !this.driftAcknowledged && this.config.drift !== null && this.config.drift.hasDrift;\n  }\n\n  /**\n   * Attach event listeners\n   */\n  private attachEventListeners(): void {\n    if (!this.container) return;\n\n    // Drift acknowledge button\n    const acknowledgeBtn = this.container.querySelector('[data-action=\"acknowledge-drift\"]');\n    if (acknowledgeBtn) {\n      acknowledgeBtn.addEventListener('click', () => this.acknowledgeDrift());\n    }\n\n    // Copy source buttons\n    this.container.querySelectorAll('[data-action=\"copy-source\"]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const fieldKey = (e.currentTarget as HTMLElement).dataset.field;\n        if (fieldKey) {\n          this.copySourceToTarget(fieldKey);\n        }\n      });\n    });\n\n    // Input change listeners\n    this.container.querySelectorAll('.sbs-target-input').forEach(input => {\n      input.addEventListener('input', (e) => {\n        const target = e.target as HTMLInputElement | HTMLTextAreaElement;\n        const fieldKey = target.dataset.field;\n        if (fieldKey && this.config.onChange) {\n          this.config.onChange(fieldKey, target.value);\n        }\n      });\n    });\n  }\n\n  /**\n   * Acknowledge drift\n   */\n  acknowledgeDrift(): void {\n    this.driftAcknowledged = true;\n\n    const banner = this.container?.querySelector('[data-drift-banner]');\n    if (banner) {\n      banner.classList.add('sbs-drift-acknowledged');\n      setTimeout(() => banner.remove(), 300);\n    }\n\n    if (this.config.onDriftAcknowledge) {\n      this.config.onDriftAcknowledge();\n    }\n  }\n\n  /**\n   * Copy source value to target field\n   */\n  copySourceToTarget(fieldKey: string): void {\n    const field = this.config.fields.find(f => f.key === fieldKey);\n    if (!field) return;\n\n    const targetInput = this.container?.querySelector<HTMLInputElement | HTMLTextAreaElement>(\n      `.sbs-target-input[data-field=\"${fieldKey}\"]`\n    );\n\n    if (targetInput) {\n      targetInput.value = field.sourceValue || '';\n\n      // Trigger input event for change detection\n      const event = new Event('input', { bubbles: true });\n      targetInput.dispatchEvent(event);\n    }\n\n    if (this.config.onCopySource) {\n      this.config.onCopySource(fieldKey);\n    }\n  }\n\n  /**\n   * Get current field values\n   */\n  getValues(): Record<string, string> {\n    const values: Record<string, string> = {};\n\n    if (!this.container) return values;\n\n    this.container.querySelectorAll<HTMLInputElement | HTMLTextAreaElement>('.sbs-target-input').forEach(input => {\n      const fieldKey = input.dataset.field;\n      if (fieldKey) {\n        values[fieldKey] = input.value;\n      }\n    });\n\n    return values;\n  }\n\n  /**\n   * Set field value programmatically\n   */\n  setValue(fieldKey: string, value: string): void {\n    const input = this.container?.querySelector<HTMLInputElement | HTMLTextAreaElement>(\n      `.sbs-target-input[data-field=\"${fieldKey}\"]`\n    );\n\n    if (input) {\n      input.value = value;\n    }\n  }\n\n  /**\n   * Update fields and re-render\n   */\n  setFields(fields: SideBySideField[]): void {\n    this.config.fields = fields;\n    this.render();\n  }\n\n  /**\n   * Update drift metadata\n   */\n  setDrift(drift: SourceTargetDrift | null): void {\n    this.config.drift = drift;\n    this.driftAcknowledged = false;\n    this.render();\n  }\n\n  /**\n   * Check if drift is currently acknowledged\n   */\n  isDriftAcknowledged(): boolean {\n    return this.driftAcknowledged;\n  }\n\n  /**\n   * Destroy the editor\n   */\n  destroy(): void {\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create and render a side-by-side editor\n */\nexport function createSideBySideEditor(config: SideBySideEditorConfig): SideBySideEditor {\n  const editor = new SideBySideEditor(config);\n  editor.render();\n  return editor;\n}\n\n/**\n * Initialize side-by-side editor from record data\n */\nexport function initSideBySideEditorFromRecord(\n  container: HTMLElement | string,\n  record: Record<string, unknown>,\n  sourceRecord: Record<string, unknown>,\n  fieldKeys: string[],\n  config: Partial<SideBySideEditorConfig>\n): SideBySideEditor {\n  const drift = extractSourceTargetDrift(record);\n\n  const fields: SideBySideField[] = fieldKeys.map(key => ({\n    key,\n    label: key.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase()),\n    type: 'text' as const,\n    hasSourceChanged: hasFieldDrift(drift, key),\n    sourceValue: String(sourceRecord[key] || ''),\n    targetValue: String(record[key] || ''),\n    sourceLocale: config.sourceLocale || 'en',\n    targetLocale: config.targetLocale || '',\n  }));\n\n  return createSideBySideEditor({\n    container,\n    fields,\n    drift,\n    sourceLocale: config.sourceLocale || 'en',\n    targetLocale: config.targetLocale || '',\n    panelName: config.panelName || '',\n    recordId: config.recordId || '',\n    ...config,\n  });\n}\n\n// ============================================================================\n// CSS Styles\n// ============================================================================\n\n/**\n * Get CSS styles for the side-by-side editor\n */\nexport function getSideBySideEditorStyles(): string {\n  return `\n    /* Side-by-Side Editor Styles */\n    .side-by-side-editor {\n      display: flex;\n      flex-direction: column;\n      gap: 1rem;\n      width: 100%;\n    }\n\n    /* Drift Banner */\n    .sbs-drift-banner {\n      display: flex;\n      align-items: flex-start;\n      gap: 0.75rem;\n      padding: 1rem;\n      background-color: #fffbeb;\n      border: 1px solid #fcd34d;\n      border-radius: 0.5rem;\n      transition: opacity 0.3s ease, transform 0.3s ease;\n    }\n\n    .sbs-drift-banner.sbs-drift-acknowledged {\n      opacity: 0;\n      transform: translateY(-0.5rem);\n    }\n\n    .sbs-drift-icon {\n      flex-shrink: 0;\n      color: #d97706;\n    }\n\n    .sbs-drift-content {\n      flex: 1;\n    }\n\n    .sbs-drift-title {\n      font-size: 0.875rem;\n      font-weight: 600;\n      color: #92400e;\n      margin: 0 0 0.25rem 0;\n    }\n\n    .sbs-drift-description {\n      font-size: 0.875rem;\n      color: #b45309;\n      margin: 0;\n    }\n\n    .sbs-drift-count {\n      font-weight: 500;\n    }\n\n    .sbs-drift-fields-list {\n      margin: 0.5rem 0 0 0;\n      padding-left: 1.25rem;\n      font-size: 0.75rem;\n      color: #92400e;\n    }\n\n    .sbs-drift-actions {\n      flex-shrink: 0;\n    }\n\n    .sbs-drift-acknowledge {\n      padding: 0.375rem 0.75rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      color: #92400e;\n      background-color: white;\n      border: 1px solid #fcd34d;\n      border-radius: 0.375rem;\n      cursor: pointer;\n      transition: background-color 0.15s ease;\n    }\n\n    .sbs-drift-acknowledge:hover {\n      background-color: #fef3c7;\n    }\n\n    /* Columns Layout */\n    .sbs-columns {\n      display: flex;\n      flex-direction: column;\n      gap: 0;\n      border: 1px solid #e5e7eb;\n      border-radius: 0.5rem;\n      overflow: hidden;\n    }\n\n    .sbs-header {\n      display: grid;\n      grid-template-columns: 1fr auto 1fr;\n      background-color: #f9fafb;\n      border-bottom: 1px solid #e5e7eb;\n    }\n\n    .sbs-column-header {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n      padding: 0.75rem 1rem;\n    }\n\n    .sbs-source-header {\n      border-right: 1px solid #e5e7eb;\n    }\n\n    .sbs-target-header {\n      padding-left: calc(1rem + 2.5rem); /* Account for copy button column */\n    }\n\n    .sbs-column-title {\n      font-size: 0.75rem;\n      font-weight: 600;\n      color: #374151;\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    }\n\n    .sbs-locale-badge {\n      font-size: 0.625rem;\n      font-weight: 600;\n      padding: 0.125rem 0.375rem;\n      background-color: #e5e7eb;\n      color: #4b5563;\n      border-radius: 0.25rem;\n    }\n\n    /* Fields */\n    .sbs-fields {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .sbs-field-row {\n      border-bottom: 1px solid #e5e7eb;\n    }\n\n    .sbs-field-row:last-child {\n      border-bottom: none;\n    }\n\n    .sbs-field-row.sbs-field-changed-row {\n      background-color: #fffbeb;\n    }\n\n    .sbs-field-header {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n      padding: 0.5rem 1rem;\n      background-color: #f9fafb;\n      border-bottom: 1px solid #e5e7eb;\n    }\n\n    .sbs-field-label {\n      font-size: 0.875rem;\n      font-weight: 500;\n      color: #374151;\n    }\n\n    .sbs-required {\n      color: #dc2626;\n    }\n\n    .sbs-field-changed {\n      display: flex;\n      align-items: center;\n    }\n\n    .sbs-field-content {\n      display: grid;\n      grid-template-columns: 1fr auto 1fr;\n      min-height: 5rem;\n    }\n\n    .sbs-source-field,\n    .sbs-target-field {\n      padding: 0.75rem 1rem;\n    }\n\n    .sbs-source-field {\n      background-color: #f9fafb;\n      border-right: 1px solid #e5e7eb;\n    }\n\n    .sbs-source-content {\n      font-size: 0.875rem;\n      color: #6b7280;\n      line-height: 1.5;\n      white-space: pre-wrap;\n      word-break: break-word;\n    }\n\n    .sbs-empty {\n      font-style: italic;\n      color: #9ca3af;\n    }\n\n    .sbs-field-actions {\n      display: flex;\n      align-items: flex-start;\n      padding: 0.75rem 0.5rem;\n      background-color: #f3f4f6;\n      border-right: 1px solid #e5e7eb;\n    }\n\n    .sbs-copy-source {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 2rem;\n      height: 2rem;\n      color: #6b7280;\n      background-color: white;\n      border: 1px solid #d1d5db;\n      border-radius: 0.375rem;\n      cursor: pointer;\n      transition: all 0.15s ease;\n    }\n\n    .sbs-copy-source:hover {\n      color: #3b82f6;\n      border-color: #3b82f6;\n      background-color: #eff6ff;\n    }\n\n    .sbs-target-input {\n      width: 100%;\n      font-size: 0.875rem;\n      line-height: 1.5;\n      color: #111827;\n      background-color: white;\n      border: 1px solid #d1d5db;\n      border-radius: 0.375rem;\n      padding: 0.5rem 0.75rem;\n      transition: border-color 0.15s ease, box-shadow 0.15s ease;\n    }\n\n    .sbs-target-input:focus {\n      outline: none;\n      border-color: #3b82f6;\n      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n    }\n\n    .sbs-textarea-input {\n      min-height: 6rem;\n      resize: vertical;\n    }\n\n    /* Responsive */\n    @media (max-width: 768px) {\n      .sbs-header {\n        display: none;\n      }\n\n      .sbs-field-content {\n        display: flex;\n        flex-direction: column;\n        gap: 0.5rem;\n      }\n\n      .sbs-source-field,\n      .sbs-field-actions,\n      .sbs-target-field {\n        border: none;\n        padding: 0.5rem 1rem;\n      }\n\n      .sbs-source-field {\n        background-color: #f9fafb;\n        border-radius: 0.375rem;\n      }\n\n      .sbs-source-field::before {\n        content: 'Source';\n        display: block;\n        font-size: 0.625rem;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        color: #6b7280;\n        margin-bottom: 0.25rem;\n      }\n\n      .sbs-target-field::before {\n        content: 'Translation';\n        display: block;\n        font-size: 0.625rem;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        color: #6b7280;\n        margin-bottom: 0.25rem;\n      }\n\n      .sbs-field-actions {\n        background: transparent;\n        padding: 0 1rem;\n      }\n    }\n\n    /* Dark mode support */\n    @media (prefers-color-scheme: dark) {\n      .sbs-drift-banner {\n        background-color: #451a03;\n        border-color: #92400e;\n      }\n\n      .sbs-drift-title {\n        color: #fcd34d;\n      }\n\n      .sbs-drift-description {\n        color: #fbbf24;\n      }\n\n      .sbs-drift-acknowledge {\n        background-color: #1f2937;\n        border-color: #92400e;\n        color: #fcd34d;\n      }\n\n      .sbs-columns {\n        border-color: #374151;\n      }\n\n      .sbs-header,\n      .sbs-field-header,\n      .sbs-source-field {\n        background-color: #1f2937;\n      }\n\n      .sbs-column-title,\n      .sbs-field-label {\n        color: #e5e7eb;\n      }\n\n      .sbs-locale-badge {\n        background-color: #374151;\n        color: #d1d5db;\n      }\n\n      .sbs-source-content {\n        color: #9ca3af;\n      }\n\n      .sbs-field-actions {\n        background-color: #111827;\n      }\n\n      .sbs-copy-source {\n        background-color: #1f2937;\n        border-color: #4b5563;\n        color: #9ca3af;\n      }\n\n      .sbs-target-input {\n        background-color: #1f2937;\n        border-color: #4b5563;\n        color: #f3f4f6;\n      }\n\n      .sbs-field-row.sbs-field-changed-row {\n        background-color: #451a03;\n      }\n    }\n  `;\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction escapeAttr(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n"],"names":["PayloadInputModal","Modal","config","onConfirm","onCancel","resolve","values","fields","field","escapeModalHtml","form","cancelBtn","submit","firstInvalid","input","value","event","description","control","selected","optionHtml","option","isSelected","cls","inputType","el","name","message","errorEl","ActionRenderer","FallbackNotifier","record","actions","visibleActions","action","variantClass","icon","customClass","disabled","actionKey","disabledClass","ariaDisabledAttr","titleAttr","menuId","actionItems","index","isDestructive","divider","itemClass","label","basePath","container","records","button","btn","recordId","e","error","errorMsg","bulkActions","toolbar","info","actionsContainer","clearButton","selectedIds","requestPayload","response","extractErrorMessage","data","payload","schema","definition","missingRequired","rawValues","rawValue","parsed","required","ordered","seen","append","propertiesRaw","properties","key","requiredFields","modalFields","rawType","options","item","match","allowed","type","normalized","fallbackCount","actionLabel","summary","succeeded","failed","variant","existing","configuredID","str","div","ICONS","CORE_READINESS_DISPLAY","QUEUE_STATE_DISPLAY","QUEUE_CONTENT_STATE_DISPLAY","QUEUE_DUE_STATE_DISPLAY","EXCHANGE_ROW_STATUS_DISPLAY","EXCHANGE_JOB_STATUS_DISPLAY","DISABLED_REASON_DISPLAY","getStatusDisplay","status","domain","getDisabledReasonDisplay","code","isValidStatus","isValidReasonCode","getStatusesForDomain","getAllReasonCodes","getStatusCssClass","getSeverityCssClass","display","renderVocabularyStatusBadge","escapeHtml","size","showIcon","showLabel","extraClass","sizeClasses","iconHtml","renderVocabularyStatusIcon","labelHtml","renderReasonCodeBadge","showFullMessage","renderReasonCodeIndicator","tooltip","title","createStatusCellRenderer","createReasonCodeCellRenderer","initializeVocabularyFromPayload","_payload","getStatusVocabularyStyles","extractTranslationContext","context","extractStringField","extractStringArrayField","extractBooleanField","isInFallbackMode","ctx","hasTranslationContext","extractTranslationReadiness","readiness","readinessObj","v","fieldsByLocale","locale","state","isValidReadinessState","readyFor","transition","ready","hasTranslationReadiness","isReadyForTransition","renderLocaleBadge","showFallbackIndicator","isFallback","baseClasses","renderAvailableLocalesIndicator","maxLocales","sizeClass","pillSize","visibleLocales","hiddenCount","pills","overflow","renderTranslationStatusCell","showResolvedLocale","parts","renderStatusBadge","normalizedStatus","statusLower","badge","renderReadinessIndicator","showDetailedTooltip","bgClass","textClass","getReadinessStateDisplay","renderPublishReadinessBadge","isReady","missingCount","renderLocaleCompleteness","available","loc","colorClass","renderMissingTranslationsBadge","hasMissingLocales","hasMissingFields","hasMissingTranslations","getMissingTranslationsCount","sharedDisplay","sharedIcon","sharedBgClass","sharedTextClass","sharedLabel","sharedDescription","missing","localesWithMissingFields","missingLocales","renderTranslationMatrixCell","showLabels","requiredLocales","availableLocales","missingRequiredFieldsByLocale","allLocales","availableSet","incompleteLocales","getIncompleteLocales","chips","isAvailable","isIncomplete","isComplete","stateClass","stateLabel","incomplete","createTranslationMatrixRenderer","_value","_column","renderFallbackWarning","showCreateButton","createTranslationUrl","panelName","requestedLocale","resolvedLocale","createButtonHtml","createTranslationStatusRenderer","createLocaleBadgeRenderer","paths","path","getNestedValue","obj","current","part","EMPTY_CELL_HTML","DEFAULT_OBJECT_LABEL_KEYS","compactJSON","normalizeDisplayKeys","keys","pushKey","candidate","listCandidate","objectValueByPath","segments","segment","scalarSummary","summarizeObjectValue","summarizeArrayValue","rawLimit","limit","preview","normalizeNumberOption","snakeKey","camelKey","defaultValue","raw","normalizeBooleanOption","normalizeStringOption","resolveBlockLabel","typeKeys","val","blocksChipVariantClass","CellRendererRegistry","column","renderer","bytes","sizes","i","text","maxLength","_record","tag","maxVisible","showCount","chipVariant","iconMap","visibleItems","iconRef","renderIcon","remaining","overflowBadge","initial","CommonRenderers","_colorMap","role","email","sharedBooleanChip","date","diffMs","diffMins","diffHours","diffDays","PERSISTED_PREFIX","SHARE_PREFIX","SHARE_INDEX_KEY","DEFAULT_MAX_SHARE_ENTRIES","toStorageKey","normalizeStringArray","out","entry","normalizePersistedState","expanded","hiddenColumns","columnOrder","normalizeShareState","search","persisted","normalizePreferencesEndpoint","trimmed","normalizeResource","newShareToken","time","rand","loadShareIndex","maxEntries","rec","token","updatedAt","a","b","saveShareIndex","LocalDataGridStateStore","normalizedKey","storageKey","nextIndex","removed","normalizedToken","PreferencesDataGridStateStore","url","effective","separator","root","first","createDataGridStateStore","transformToGroups","groupByField","defaultExpanded","expandMode","expandedGroups","groupMap","ungrouped","groupId","getGroupId","groups","groupRecords","computeGroupSummary","isGroupExpanded","aIndex","bIndex","hasBackendGroupedRows","hasContractRows","isBackendGroupedRow","isBackendUngroupedRow","normalizeBackendGroupedRows","totalRecords","row","getBackendGroupID","children","getBackendGroupChildren","getBackendGroupSummary","getBackendGroupLabel","hasBackendGroupSummary","groupBy","rowType","getBackendGroupRowType","meta","direct","metaID","grouped","primary","parent","isString","readinessState","fallbackTotal","directLabel","summaryLabel","metaLabel","candidates","parentRecord","nestedPaths","nested","allAvailable","allMissing","hasIncomplete","readyCount","legacyAvailable","allReady","hasMissing","mergeBackendSummaries","groupedData","backendSummaries","group","backendSummary","extractBackendSummaries","summaries","groupSummaries","s","EXPAND_STATE_KEY_PREFIX","normalizeExpandIDs","sanitizeGroupId","MAX_EXPANDED_GROUPS_TOKEN_ITEMS","parsePersistedExpandState","mode","normalizeExpandMode","ids","getPersistedExpandState","panelId","getPersistedExpandMode","hasPersistedExpandState","persistExpandState","toggleGroupExpand","expandAllGroups","collapseAllGroups","getExpandedGroupIds","VIEW_MODE_KEY_PREFIX","MAX_EXPANDED_GROUP_ID_LENGTH","fallback","getPersistedViewMode","stored","isValidViewMode","persistViewMode","parseViewMode","encodeExpandedGroupsToken","decodeExpandedGroupsToken","decoded","renderGroupHeaderSummary","textSize","availableCount","totalLocales","readinessBadge","stateConfig","getReadinessStateConfig","localeCount","itemCount","deriveGroupLabel","firstRecord","renderGroupHeaderRow","colSpan","showExpandIcon","expandIcon","summaryHtml","groupLabel","recordCount","countBadge","escapeAttr","renderGroupedEmptyState","renderGroupedLoadingState","renderGroupedErrorState","onRetry","retryButton","isNarrowViewport","breakpoint","getViewModeForViewport","preferredMode","DATAGRID_URL_KEY_SEARCH","DATAGRID_URL_KEY_PAGE","DATAGRID_URL_KEY_PER_PAGE","DATAGRID_URL_KEY_FILTERS","DATAGRID_URL_KEY_SORT","DATAGRID_URL_KEY_STATE","DATAGRID_URL_KEY_HIDDEN_COLUMNS","DATAGRID_URL_KEY_VIEW_MODE","DATAGRID_URL_KEY_EXPANDED_GROUPS","DATAGRID_MANAGED_URL_KEYS","DATAGRID_DEFAULT_MAX_URL_LENGTH","DATAGRID_DEFAULT_MAX_FILTERS_LENGTH","buildURL","pathname","params","query","deleteSearchParams","getURLStateConfig","grid","maxURLLength","maxFiltersLength","enableStateToken","parseJSONArray","_grid","applyPersistedStateSnapshot","snapshot","merge","validFields","col","persistedHidden","persistedOrder","validOrder","defaultOrder","columnMap","c","applyShareStateSnapshot","buildPersistedStateSnapshot","buildShareStateSnapshot","persistStateSnapshot","restoreStateFromURL","stateToken","shared","searchInput","page","parsedPage","perPage","parsedPerPage","fallbackPerPage","perPageSelect","filtersParam","sortParam","urlViewMode","hiddenColumnsParam","hiddenArray","allColumnFields","cachedHidden","cachedOrder","applyRestoredState","filter","visibleColumns","pushStateToURL","urlState","filtersTooLong","serializedFilters","newURL","exceedsBudget","httpRequest","json","idempotencyKey","accept","headers","rest","mergedHeaders","body","readHTTPError","refresh","items","total","buildApiUrl","queryParams","buildQueryString","buildQueryParams","paginationParams","searchParams","filterParams","sortParams","getResponseTotal","normalizePagination","nextPerPage","maxPage","nextPage","didCorrect","fetchDetail","id","detail","normalizeDetailResponse","getSchema","getForm","getTabs","renderGroupedData","tbody","headerHtml","headerRow","isGroupedViewActive","fallbackGroupedMode","reason","handleGroupedModeStatusFallback","handleGroupedModePayloadFallback","toggleGroup","normalizedGroupID","currentlyExpanded","g","setExpandedGroups","groupIDs","next","updateGroupVisibility","isExpanded","updateGroupedRowsFromState","isGroupExpandedByState","setViewMode","effectiveMode","getViewMode","getGroupedData","updateColumnVisibility","skipURLUpdate","visibleSet","th","td","syncColumnVisibilityCheckboxes","menu","checkbox","renderData","renderFlatData","resolveRendererOptions","createTableRow","rowClasses","checkboxCell","cell","rendererName","rendererContext","actionBase","actionsCell","actionId","defaultActions","sanitizeActionId","handleDelete","updatePaginationUI","offset","start","end","startEl","endEl","totalEl","renderPaginationButtons","totalPages","buttons","maxButtons","startPage","endPage","isActive","ColumnManager","columns","hiddenSet","header","columnList","footer","totalCount","visibleCount","searchContainer","searchIcon","circle","searchTerm","term","matches","scrollTop","scrollHeight","clientHeight","isScrollable","hasTopShadow","hasBottomShadow","resetBtn","resetIcon","path1","path2","resetText","isVisible","itemId","switchId","content","dragHandle","cx","cy","labelSpan","switchLabel","slider","Sortable","newOrder","descId","addDelegatedEventListener","eventName","selector","handler","listener","target","matched","bindSearchInput","clearBtn","toggleClearBtn","bindPerPageSelect","select","bindFilterInputs","handleFilterChange","inferredOperator","operator","existingIndex","f","bindColumnVisibility","toggleBtn","visible","order","bindExportButtons","exportButtons","format","concurrency","buttonsToDisable","showSpinner","spinner","hideSpinner","showSpinnerOnly","bindSorting","direction","updateSortIndicators","sorted","svg","indicator","bindSelection","selectAll","cb","updateSelectionBindings","bindBulkActions","bulkBase","bulkActionConfig","ba","endpoint","confirmMsg","payloadRequired","payloadSchema","domConfig","bindOverflowMenu","moreBtn","updateBulkActionsBar","overlay","countEl","selectedCount","bindBulkClearButton","clearSelection","selectAllCheckbox","positionDropdownMenu","trigger","triggerRect","menuHeight","spaceBelow","spaceAbove","shouldOpenUpward","left","bindDropdownToggles","signal","toggle","targetId","otherToggle","otherId","otherTarget","m","isOpening","showError","notify","confirmAction","extractError","parseDatasetStringArray","result","parseDatasetObject","reorderColumns","resetColumnsToDefault","mergeColumnOrder","savedOrder","currentFields","savedSet","validSaved","newColumns","reorderTableColumns","filterRow","reorderRowCells","cellTag","dataCells","cellMap","allCells","selectionCell","reorderedCells","_DataGrid","persistedState","defaultHiddenColumns","hasPersistedHiddenColumns","persistedHiddenColumns","defaultColumnOrder","hasPersistedColumnOrder","persistedColumnOrder","mergedColumnOrder","legacyHasPersistedExpandState","legacyViewMode","legacyExpandMode","legacyExpandedGroups","persistedExpandMode","persistedExpandState","hasPersistedGroupedExpandState","initialViewMode","hydrated","stateOps.getURLStateConfig","stateOps.parseJSONArray","stateOps.applyPersistedStateSnapshot","stateOps.applyShareStateSnapshot","stateOps.buildPersistedStateSnapshot","stateOps.buildShareStateSnapshot","stateOps.persistStateSnapshot","stateOps.restoreStateFromURL","stateOps.applyRestoredState","stateOps.pushStateToURL","fetchOps.refresh","fetchOps.buildApiUrl","fetchOps.buildQueryString","fetchOps.buildQueryParams","fetchOps.getResponseTotal","fetchOps.normalizePagination","renderOps.updateColumnVisibility","renderOps.syncColumnVisibilityCheckboxes","renderOps.renderData","renderOps.renderFlatData","groupedOps.renderGroupedData","groupedOps.isGroupedViewActive","groupedOps.fallbackGroupedMode","groupedOps.handleGroupedModeStatusFallback","groupedOps.handleGroupedModePayloadFallback","groupedOps.toggleGroup","groupedOps.setExpandedGroups","groupedOps.expandAllGroups","groupedOps.collapseAllGroups","groupedOps.updateGroupVisibility","groupedOps.updateGroupedRowsFromState","groupedOps.isGroupExpandedByState","groupedOps.setViewMode","groupedOps.getViewMode","groupedOps.getGroupedData","fetchOps.fetchDetail","fetchOps.getSchema","fetchOps.getForm","fetchOps.getTabs","fetchOps.normalizeDetailResponse","renderOps.resolveRendererOptions","renderOps.createTableRow","renderOps.sanitizeActionId","renderOps.handleDelete","renderOps.updatePaginationUI","renderOps.renderPaginationButtons","lifecycleOps.bindSearchInput","lifecycleOps.bindPerPageSelect","lifecycleOps.bindFilterInputs","lifecycleOps.bindColumnVisibility","lifecycleOps.bindExportButtons","lifecycleOps.bindSorting","lifecycleOps.updateSortIndicators","lifecycleOps.bindSelection","lifecycleOps.updateSelectionBindings","lifecycleOps.bindBulkActions","lifecycleOps.bindOverflowMenu","lifecycleOps.updateBulkActionsBar","lifecycleOps.bindBulkClearButton","lifecycleOps.clearSelection","lifecycleOps.positionDropdownMenu","lifecycleOps.bindDropdownToggles","lifecycleOps.showError","lifecycleOps.notify","lifecycleOps.confirmAction","lifecycleOps.extractError","lifecycleOps.parseDatasetStringArray","lifecycleOps.parseDatasetObject","columnOps.reorderColumns","columnOps.resetColumnsToDefault","columnOps.mergeColumnOrder","columnOps.reorderTableColumns","columnOps.reorderRowCells","DataGrid","DEFAULT_OPERATORS","AdvancedSearch","filters","closeBtn","saveBtn","loadBtn","updateClearButton","criterion","newCriterion","wrapper","connector","op","opt","logic","idx","element","TextPromptModal","presets","names","criteria","chipsContainer","chip","fieldLabel","operatorLabel","removeBtn","FilterBuilder","addGroupBtn","applyBtn","clearAllBtn","newGroup","groupIndex","groupEl","condition","condIndex","condEl","condConnector","addCondBtn","removeGroupBtn","gIdx","cIdx","gi","ci","closest","isOr","dataAttr","sqlPreview","textPreview","previewContainer","groupParts","condParts","p","acc","opLabel","nameInput","saved","rect","fieldGroups","conditions","structure","GoCrudSearchBehavior","searchableFields","trimmedTerm","GoCrudFilterBehavior","GoCrudPaginationBehavior","GoCrudSortBehavior","GoCrudExportBehavior","buildDatagridExportRequest","resolveDelivery","err","statusURL","downloadURL","resolveDownloadURL","pollExportStatus","resolvePollIntervalMs","resolvePollTimeoutMs","downloadResponse","readErrorMessage","downloadExport","normalizedFormat","normalizeFormat","selection","buildSelection","buildVisibleColumns","buildQuery","sourceVariant","opts","started","interval","sleep","ms","hidden","behaviors","toNumber","parseSort","splitFilterKey","chunk","blob","filename","resolveFilename","link","parseFilename","utfMatch","notifier","toast","GoCrudBulkActionBehavior","baseEndpoint","errorText","normalizeBasePath","normalizeApiBasePath","apiBasePath","isV2Prefs","DefaultColumnVisibilityBehavior","initialColumns","currentlyVisible","newVisibleColumns","visibility","currentOrder","allColumns","prefs","validColumns","migratedPrefs","ServerColumnVisibilityBehavior","localStorageKey","rawPrefs","serverPrefs","STABLE_ACTION_ORDER","DEFAULT_ACTION_ORDER","SchemaActionBuilder","schemaActions","orderedActions","insertionIndex","queryContext","schemaAction","actionState","actionButton","oa","actionName","schemaOrder","normalizedName","isNavigationAction","isDeleteAction","requiredContext","rawField","rawState","perAction","disabledReason","normalizedCode","scope","normalizedScope","normalizedPath","cursor","targetUrl","executeActionRequest","isTranslationBlocker","blockerInfo","extractTranslationBlocker","retryPayload","formattedMessage","originalPayload","newId","newLocale","queryString","editUrl","sourceLocale","localeLabel","sourceParams","sourceId","normalizedActionName","promptedValues","fieldName","prop","createTranslationOptions","extensionOptions","candidateValue","candidateLabel","locales","allowedLocales","allowedSet","recommendedLocale","requiredForPublish","existingLocales","localizedLabels","rawLocale","isRecommended","isRequiredForPublish","hints","languageLabel","targetField","sourcePath","source","labels","requiredRaw","translationContextRaw","translationContext","safeAction","safeRecord","suffix","formatStructuredErrorForDisplay","apiEndpoint","defaults","def","startingIndex","buildSchemaRowActions","extractSchemaActions","TranslationBlockerModal","originalOnDismiss","entityType","hasFieldHints","missingFields","hasFields","actionDisabled","hideIfNotCreated","baseUrl","localeItems","createResult","errorMessage","temp","newItem","showTranslationBlocker","DEFAULT_STATUS_LEGEND_ITEMS","StatusLegend","containerEl","orientation","containerClass","isVertical","isSmall","flexDirection","gap","iconSize","titleHtml","itemsHtml","createStatusLegend","legend","initStatusLegends","elements","legends","renderStatusLegendHTML","tempContainer","DEFAULT_TRANSLATION_QUICK_FILTERS","QuickFilters","cap","padding","filtersHtml","capability","isSupported","stateClasses","ariaAttributes","capabilities","supported","createTranslationQuickFilters","onFilterSelect","initQuickFilters","instances","instance","renderQuickFiltersHTML","activeKey","capMap","executeBulkCreateMissing","recordIds","maxFailuresToShow","errorBody","errorJson","parseBulkResponse","showResultToast","maxFailures","results","created","r","skipped","failures","renderBulkResultSummary","statsHtml","failuresHtml","renderBulkResultInline","createBulkCreateMissingHandler","onComplete","LOCALE_LABELS","getLocaleLabel","LocaleActionChip","localeExists","loading","modeClasses","statusIcon","actionsHtml","buttonSize","openBgClass","openRingClass","createBtn","openBtn","navigationBasePath","environment","newRecordId","updates","renderLocaleActionChip","renderLocaleActionList","baseConfig","initLocaleActionChips","buildLocaleEditUrl","FallbackBanner","showFormLockMessage","requestedLabel","resolvedLabel","primaryCtaHtml","secondaryCtaHtml","formLockHtml","_loc","applyFormLock","lockState","removeFormLock","isFormLocked","getFormLockReason","renderFallbackBannerFromRecord","shouldShowFallbackBanner","initFallbackBanner","banner","initFormLock","InlineLocaleChips","isEnabled","overflowCount","chipsHtml","overflowHtml","count","chipEl","renderInlineLocaleChips","shouldShowInlineLocaleChips","initInlineLocaleChips","component","createInlineLocaleChipsRenderer","isMacPlatform","getPrimaryModifierLabel","getModifierSymbol","modifier","formatShortcutDisplay","shortcut","modifiers","formatKeyDisplay","KeyboardShortcutRegistry","override","enabled","category","list","matchingShortcut","eventKey","shortcutKey","isMac","expectedModifiers","wantsCtrl","wantsMeta","wantsAlt","wantsShift","tagName","createTranslationShortcuts","handlers","shortcuts","renderShortcutsHelpContent","categoryLabels","categoryOrder","html","categoryShortcuts","SHORTCUTS_STORAGE_KEY","SHORTCUTS_HINT_DISMISSED_KEY","DEFAULT_SHORTCUT_SETTINGS","getStorage","loadShortcutSettings","storage","saveShortcutSettings","settings","toSave","isShortcutHintDismissed","dismissShortcutHint","renderDiscoveryHint","position","onDismiss","onShowHelp","autoDismissMs","hintEl","modKey","removeHint","permanent","renderShortcutSettingsUI","onSettingsChange","newSettings","shortcutId","applyShortcutSettings","registry","defaultRegistry","getDefaultShortcutRegistry","initKeyboardShortcuts","initKeyboardShortcutsWithDiscovery","DEFAULT_DEBOUNCE_MS","DEFAULT_SAVED_DURATION_MS","DEFAULT_CLASS_PREFIX","DEFAULT_LABELS","DEFAULT_CONFLICT_LABELS","AutosaveIndicator","dataToSave","conflict","serverState","resolution","errorObj","metadata","callback","prefix","newState","previousState","useServerBtn","forceSaveBtn","dismissBtn","retryBtn","createTranslationAutosave","renderAutosaveIndicator","getAutosaveIndicatorStyles","classPrefix","initFormAutosave","watchFields","indicatorSelector","indicatorConfig","getFormData","formData","handleChange","beforeUnloadHandler","visibilityHandler","originalDestroy","DEFAULT_CHAR_COUNTER_PREFIX","DEFAULT_INTERPOLATION_PREFIX","DEFAULT_DIR_TOGGLE_PREFIX","DEFAULT_INTERPOLATION_PATTERNS","DEFAULT_SAMPLE_VALUES","CharacterCounter","sortedThresholds","threshold","severity","thresholds","classes","InterpolationPreview","patternDef","variable","lastIndex","sampleValue","original","isEmpty","DirectionToggle","isRtl","initFieldHelpers","counters","previews","toggles","t","renderCharacterCounter","renderDirectionToggle","getFieldHelperStyles","detectInterpolations","patterns","getCharCountSeverity","softLimit","hardLimit","parseCapabilityMode","isExchangeEnabled","isQueueEnabled","isCoreEnabled","extractCapabilities","profile","schemaVersion","extractModules","extractFeatures","extractRoutes","extractPanels","extractResolverKeys","extractWarnings","modules","extractModuleState","extractActionState","extractActionsMap","features","routes","panels","k","warnings","w","CapabilityGate","module","moduleState","gate","feature","createCapabilityGate","createEmptyCapabilityGate","renderGateAriaAttributes","renderDisabledReasonBadge","reasonCode","getCapabilityGateStyles","applyGateToElement","preventDisabledClick","initCapabilityGating","gateConfig","DEFAULT_FILTER_PRESETS","TranslatorDashboard","presetId","preset","badgeHtml","reasonBadge","assignments","assignment","dueStateClass","getDueStateClass","priorityClass","getPriorityClass","queueStateBadge","dueDateDisplay","formatRelativeDate","formatPriority","hasActionHandler","reviewActions","assignmentId","card","summaryType","base","panel","targetID","priority","now","diff","days","getTranslatorDashboardStyles","createTranslatorDashboard","dashboard","initTranslatorDashboard","initTranslatorDashboardWithOptions","capabilityGate","resolveInitCapabilityGate","globalPayload","resolveGlobalCapabilitiesPayload","globalCaps","scriptEl","ExchangeImport","file","mergedOptions","selectedIndices","previewRow","statusClass","isDisabled","statusBadge","truncate","canApply","applyGate","getExchangeImportStyles","createExchangeImport","initExchangeImport","validateEndpoint","applyEndpoint","DEFAULT_POLL_INTERVAL","DEFAULT_MAX_POLL_ATTEMPTS","DEFAULT_STORAGE_KEY_PREFIX","AsyncProgress","job","envelope","kind","statusLabel","statusHtml","progress","percentage","elapsed","seconds","minutes","remainingSeconds","hours","remainingMinutes","getAsyncProgressStyles","createAsyncProgress","initAsyncProgress","pollInterval","autoStart","checkForPersistedJob","DEFAULT_SIDE_BY_SIDE_LABELS","extractSourceTargetDrift","drift","hasFieldDrift","fieldKey","getChangedFields","SideBySideEditor","targetLocale","driftBanner","fieldsHtml","l","changedCount","changedFields","fieldsList","changedIndicator","sourceInput","targetInput","copyButton","placeholder","acknowledgeBtn","createSideBySideEditor","editor","initSideBySideEditorFromRecord","sourceRecord","fieldKeys","getSideBySideEditorStyles"],"mappings":"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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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"}