{"version":3,"file":"index.js","sources":["../../src/datatable/actions.ts","../../src/datatable/translation-context.ts","../../src/datatable/renderers.ts","../../node_modules/sortablejs/modular/sortable.esm.js","../../src/datatable/column-manager.ts","../../src/datatable/grouped-mode.ts","../../src/datatable/core.ts","../../src/datatable/advanced-search.ts","../../src/datatable/filter-builder.ts","../../src/datatable/go-crud/search.ts","../../src/datatable/go-crud/filter.ts","../../src/datatable/go-crud/pagination.ts","../../src/datatable/go-crud/sort.ts","../../src/datatable/go-crud/export.ts","../../src/datatable/go-crud/bulk.ts","../../src/datatable/go-crud/column-visibility.ts","../../src/datatable/schema-actions.ts","../../src/datatable/payload-modal.ts","../../src/datatable/translation-blocker-modal.ts","../../src/datatable/status-legend.ts","../../src/datatable/quick-filters.ts","../../src/datatable/translation-bulk-actions.ts","../../src/datatable/locale-action.ts","../../src/datatable/fallback-banner.ts","../../src/datatable/inline-locale-chips.ts","../../src/datatable/keyboard-shortcuts.ts"],"sourcesContent":["/**\n * Action System for DataGrid\n * Provides extensible row and bulk action capabilities\n */\n\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\nimport { extractErrorMessage } from '../toast/error-helpers.js';\nimport { Modal, escapeHtml as escapeModalHtml } from '../shared/modal.js';\n\nexport type ActionVariant = 'primary' | 'secondary' | 'danger' | 'success' | 'warning';\nexport type ActionRenderMode = 'inline' | 'dropdown';\n\nexport interface ActionButton {\n  label: string;\n  icon?: string;\n  action: (record: any) => void | Promise<void>;\n  condition?: (record: any) => boolean;\n  disabled?: boolean;\n  disabledReason?: string;\n  variant?: ActionVariant;\n  className?: string;\n}\n\nexport interface BulkActionConfig {\n  id: string;\n  label: string;\n  icon?: string;\n  endpoint: string;\n  method?: 'POST' | 'PUT' | 'DELETE';\n  confirm?: string;\n  guard?: (selectedIds: string[]) => boolean;\n  onSuccess?: (response: any) => void;\n  onError?: (error: Error) => void;\n  payload?: Record<string, unknown>;\n  payloadRequired?: string[];\n  payloadSchema?: Record<string, unknown>;\n}\n\ninterface PayloadSchemaProperty {\n  type?: string;\n  title?: string;\n  description?: string;\n  default?: unknown;\n  enum?: unknown[];\n  oneOf?: PayloadSchemaOption[];\n}\n\ninterface PayloadSchemaOption {\n  const?: unknown;\n  title?: string;\n}\n\ninterface PayloadSchema {\n  type?: string;\n  required?: unknown;\n  properties?: Record<string, PayloadSchemaProperty>;\n}\n\ninterface PayloadModalFieldOption {\n  value: string;\n  label: string;\n}\n\ninterface PayloadModalField {\n  name: string;\n  label: string;\n  description?: string;\n  value: string;\n  type: string;\n  options?: PayloadModalFieldOption[];\n}\n\ninterface PayloadModalConfig {\n  title: string;\n  fields: PayloadModalField[];\n  confirmLabel?: string;\n  cancelLabel?: string;\n}\n\nclass PayloadInputModal extends Modal {\n  private readonly config: PayloadModalConfig;\n  private readonly onConfirm: (values: Record<string, string>) => void;\n  private readonly onCancel: () => void;\n  private resolved = false;\n\n  constructor(\n    config: PayloadModalConfig,\n    onConfirm: (values: Record<string, string>) => void,\n    onCancel: () => void\n  ) {\n    super({ size: 'md', initialFocus: '[data-payload-field]', lockBodyScroll: false });\n    this.config = config;\n    this.onConfirm = onConfirm;\n    this.onCancel = onCancel;\n  }\n\n  static prompt(config: PayloadModalConfig): Promise<Record<string, string> | null> {\n    return new Promise<Record<string, string> | null>((resolve) => {\n      const modal = new PayloadInputModal(\n        config,\n        (values) => resolve(values),\n        () => resolve(null)\n      );\n      modal.show();\n    });\n  }\n\n  protected renderContent(): string {\n    const fields = this.config.fields.map((field) => this.renderField(field)).join('');\n    return `\n      <form class=\"flex flex-col\" data-payload-form>\n        <div class=\"px-6 py-4 border-b border-gray-200\">\n          <h3 class=\"text-lg font-semibold text-gray-900\">${escapeModalHtml(this.config.title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">Complete required fields to continue.</p>\n        </div>\n        <div class=\"px-6 py-4 space-y-4 max-h-[60vh] overflow-y-auto\">\n          ${fields}\n        </div>\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200\">\n          <button type=\"button\"\n                  data-payload-cancel\n                  class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer\">\n            ${escapeModalHtml(this.config.cancelLabel ?? 'Cancel')}\n          </button>\n          <button type=\"submit\"\n                  data-payload-confirm\n                  class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 cursor-pointer\">\n            ${escapeModalHtml(this.config.confirmLabel ?? 'Continue')}\n          </button>\n        </div>\n      </form>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-payload-form]');\n    const cancelBtn = this.container?.querySelector<HTMLButtonElement>('[data-payload-cancel]');\n    const submit = (): void => {\n      this.clearErrors();\n      const values: Record<string, string> = {};\n      let firstInvalid: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null = null;\n\n      for (const field of this.config.fields) {\n        const input = this.container?.querySelector<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>(\n          `[data-payload-field=\"${field.name}\"]`\n        );\n        if (!input) {\n          continue;\n        }\n        const value = input.value.trim();\n        values[field.name] = value;\n        if (!value) {\n          if (!firstInvalid) {\n            firstInvalid = input;\n          }\n          this.showFieldError(field.name, 'This field is required.');\n        }\n      }\n\n      if (firstInvalid) {\n        firstInvalid.focus();\n        return;\n      }\n\n      this.resolved = true;\n      this.onConfirm(values);\n      this.hide();\n    };\n\n    form?.addEventListener('submit', (event) => {\n      event.preventDefault();\n      submit();\n    });\n    cancelBtn?.addEventListener('click', () => {\n      this.hide();\n    });\n  }\n\n  protected onBeforeHide(): boolean {\n    if (!this.resolved) {\n      this.resolved = true;\n      this.onCancel();\n    }\n    return true;\n  }\n\n  private renderField(field: PayloadModalField): string {\n    const description = field.description\n      ? `<p class=\"text-xs text-gray-500 mt-1\">${escapeModalHtml(field.description)}</p>`\n      : '';\n    const control = field.options && field.options.length > 0\n      ? this.renderSelect(field)\n      : this.renderInput(field);\n    return `\n      <div>\n        <label class=\"block text-sm font-medium text-gray-800 mb-1.5\" for=\"payload-field-${field.name}\">\n          ${escapeModalHtml(field.label)}\n        </label>\n        ${control}\n        ${description}\n        <p class=\"hidden text-xs text-red-600 mt-1\" data-payload-error=\"${field.name}\"></p>\n      </div>\n    `;\n  }\n\n  private renderSelect(field: PayloadModalField): string {\n    const selected = field.value;\n    const options = field.options || [];\n    const optionHtml = options\n      .map((option) => {\n        const isSelected = option.value === selected ? ' selected' : '';\n        return `<option value=\"${escapeModalHtml(option.value)}\"${isSelected}>${escapeModalHtml(option.label)}</option>`;\n      })\n      .join('');\n    return `\n      <select id=\"payload-field-${field.name}\"\n              data-payload-field=\"${field.name}\"\n              class=\"w-full border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300\">\n        <option value=\"\">Select an option</option>\n        ${optionHtml}\n      </select>\n    `;\n  }\n\n  private renderInput(field: PayloadModalField): string {\n    const cls = 'w-full border rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300';\n    if (field.type === 'array' || field.type === 'object') {\n      return `\n        <textarea id=\"payload-field-${field.name}\"\n                  data-payload-field=\"${field.name}\"\n                  rows=\"4\"\n                  class=\"${cls}\"\n                  placeholder=\"${field.type === 'array' ? '[...]' : '{...}'}\">${escapeModalHtml(field.value)}</textarea>\n      `;\n    }\n    const inputType = field.type === 'integer' || field.type === 'number' ? 'number' : 'text';\n    return `\n      <input id=\"payload-field-${field.name}\"\n             type=\"${inputType}\"\n             data-payload-field=\"${field.name}\"\n             value=\"${escapeModalHtml(field.value)}\"\n             class=\"${cls}\" />\n    `;\n  }\n\n  private clearErrors(): void {\n    const errors = this.container?.querySelectorAll<HTMLElement>('[data-payload-error]');\n    errors?.forEach((el) => {\n      el.textContent = '';\n      el.classList.add('hidden');\n    });\n  }\n\n  private showFieldError(name: string, message: string): void {\n    const errorEl = this.container?.querySelector<HTMLElement>(`[data-payload-error=\"${name}\"]`);\n    if (!errorEl) {\n      return;\n    }\n    errorEl.textContent = message;\n    errorEl.classList.remove('hidden');\n  }\n}\n\nexport interface ActionRendererConfig {\n  mode?: ActionRenderMode;\n  actionBasePath?: string;\n  notifier?: ToastNotifier;\n}\n\nexport class ActionRenderer {\n  private actionBasePath: string;\n  private mode: ActionRenderMode;\n  private notifier: ToastNotifier;\n\n  constructor(config: ActionRendererConfig = {}) {\n    this.actionBasePath = config.actionBasePath || '';\n    this.mode = config.mode || 'dropdown';  // Default to dropdown\n    this.notifier = config.notifier || new FallbackNotifier();\n  }\n\n  /**\n   * Render row actions as HTML\n   */\n  renderRowActions(record: any, actions: ActionButton[]): string {\n    if (this.mode === 'dropdown') {\n      return this.renderRowActionsDropdown(record, actions);\n    }\n\n    // Inline mode (existing behavior)\n    const visibleActions = actions.filter(action =>\n      !action.condition || action.condition(record)\n    );\n\n    if (visibleActions.length === 0) {\n      return '<div class=\"flex justify-end gap-2\"></div>';\n    }\n\n    const actionButtons = visibleActions.map(action => {\n      const variantClass = this.getVariantClass(action.variant || 'secondary');\n      const icon = action.icon ? this.renderIcon(action.icon) : '';\n      const customClass = action.className || '';\n      const disabled = action.disabled === true;\n      const disabledClass = disabled ? 'opacity-50 cursor-not-allowed' : '';\n      // Use aria-disabled instead of disabled to keep element focusable for accessibility\n      const ariaDisabledAttr = disabled ? 'aria-disabled=\"true\"' : '';\n      const titleAttr = action.disabledReason\n        ? `title=\"${this.escapeHtml(action.disabledReason)}\"`\n        : '';\n\n      return `\n        <button\n          type=\"button\"\n          class=\"btn btn-sm ${variantClass} ${customClass} ${disabledClass}\"\n          data-action-id=\"${this.sanitize(action.label)}\"\n          data-record-id=\"${record.id}\"\n          data-disabled=\"${disabled}\"\n          ${ariaDisabledAttr}\n          ${titleAttr}\n        >\n          ${icon}\n          ${this.sanitize(action.label)}\n        </button>\n      `;\n    }).join('');\n\n    return `<div class=\"flex justify-end gap-2\">${actionButtons}</div>`;\n  }\n\n  /**\n   * Render row actions as dropdown menu\n   */\n  private renderRowActionsDropdown(record: any, actions: ActionButton[]): string {\n    const visibleActions = actions.filter(action =>\n      !action.condition || action.condition(record)\n    );\n\n    if (visibleActions.length === 0) {\n      return '<div class=\"text-sm text-gray-400\">No actions</div>';\n    }\n\n    const menuId = `actions-menu-${record.id}`;\n    const actionItems = this.buildDropdownItems(record, visibleActions);\n\n    return `\n      <div class=\"relative actions-dropdown\" data-dropdown>\n        <button type=\"button\"\n                class=\"actions-menu-trigger p-2 hover:bg-gray-100 rounded-md transition-colors\"\n                data-dropdown-trigger\n                aria-label=\"Actions menu\"\n                aria-haspopup=\"true\"\n                aria-expanded=\"false\">\n          ${this.renderDotsIcon()}\n        </button>\n\n        <div id=\"${menuId}\"\n             class=\"actions-menu hidden absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-10 py-1\"\n             role=\"menu\"\n             aria-orientation=\"vertical\">\n          ${actionItems}\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Build dropdown menu items HTML\n   */\n  private buildDropdownItems(record: any, actions: ActionButton[]): string {\n    return actions.map((action, index) => {\n      const isDestructive = action.variant === 'danger';\n      const disabled = action.disabled === true;\n      const icon = action.icon ? this.renderIcon(action.icon) : '';\n      const needsDivider = this.shouldShowDivider(action, index, actions);\n\n      const divider = needsDivider\n        ? '<div class=\"action-divider border-t border-gray-200 my-1\"></div>'\n        : '';\n\n      const itemClass = disabled\n        ? 'action-item text-gray-400 cursor-not-allowed'\n        : isDestructive\n        ? 'action-item text-red-600 hover:bg-red-50'\n        : 'action-item text-gray-700 hover:bg-gray-50';\n      // Use aria-disabled instead of disabled to keep element focusable for accessibility\n      const ariaDisabledAttr = disabled ? 'aria-disabled=\"true\"' : '';\n      const titleAttr = action.disabledReason\n        ? `title=\"${this.escapeHtml(action.disabledReason)}\"`\n        : '';\n\n      return `\n        ${divider}\n        <button type=\"button\"\n                class=\"${itemClass} flex items-center gap-3 w-full px-4 py-2.5 transition-colors\"\n                data-action-id=\"${this.sanitize(action.label)}\"\n                data-record-id=\"${record.id}\"\n                data-disabled=\"${disabled}\"\n                role=\"menuitem\"\n                ${ariaDisabledAttr}\n                ${titleAttr}>\n          <span class=\"flex-shrink-0 w-5 h-5\">${icon}</span>\n          <span class=\"text-sm font-medium\">${this.escapeHtml(action.label)}</span>\n        </button>\n      `;\n    }).join('');\n  }\n\n  /**\n   * Determine if divider should be shown before action\n   */\n  private shouldShowDivider(action: ActionButton, index: number, actions: ActionButton[]): boolean {\n    if (index === 0) return false;\n\n    // Show divider before destructive actions\n    if (action.variant === 'danger') return true;\n\n    // Show divider before certain action labels\n    const dividerBefore = ['download', 'archive', 'delete', 'remove'];\n    return dividerBefore.some(label =>\n      action.label.toLowerCase().includes(label)\n    );\n  }\n\n  /**\n   * Render three-dot vertical icon\n   */\n  private renderDotsIcon(): string {\n    return `\n      <svg class=\"w-5 h-5 text-gray-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path d=\"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Render default actions (view, edit, delete)\n   * NOTE: This method is deprecated - default actions are now handled in core.ts\n   * Kept for backward compatibility\n   */\n  renderDefaultActions(record: any, basePath: string): string {\n    // Deprecated: Default actions are now created and bound in core.ts\n    // This method is kept for backward compatibility but should not be used\n    return '<div class=\"text-sm text-gray-400\">Use core.ts for default actions</div>';\n  }\n\n  /**\n   * Attach event listeners for row actions\n   */\n  attachRowActionListeners(\n    container: HTMLElement,\n    actions: ActionButton[],\n    records: Record<string, any>\n  ): void {\n    actions.forEach(action => {\n      const buttons = container.querySelectorAll(\n        `[data-action-id=\"${this.sanitize(action.label)}\"]`\n      );\n\n      buttons.forEach((button) => {\n        const btn = button as HTMLElement;\n        const recordId = btn.dataset.recordId;\n        const record = records[recordId!];\n\n        if (record) {\n          btn.addEventListener('click', async (e) => {\n            e.preventDefault();\n            // Click guard: prevent action execution when aria-disabled\n            if (btn.getAttribute('aria-disabled') === 'true' || btn.dataset.disabled === 'true') {\n              return;\n            }\n            try {\n              await action.action(record);\n            } catch (error) {\n              console.error(`Action \"${action.label}\" failed:`, error);\n              const errorMsg = error instanceof Error ? error.message : `Action \"${action.label}\" failed`;\n              this.notifier.error(errorMsg);\n            }\n          });\n        }\n      });\n    });\n  }\n\n  /**\n   * Render bulk actions toolbar\n   */\n  renderBulkActionsToolbar(bulkActions: BulkActionConfig[]): HTMLElement {\n    const toolbar = document.createElement('div');\n    toolbar.id = 'bulk-actions-bar';  // Match core selector\n    toolbar.className = 'hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 flex items-center gap-4';\n\n    const info = document.createElement('span');\n    info.className = 'text-sm font-medium text-blue-900';\n    info.id = 'selected-count';  // Match core selector\n    info.textContent = '0 items selected';\n    toolbar.appendChild(info);\n\n    const actionsContainer = document.createElement('div');\n    actionsContainer.className = 'flex gap-2 flex-1';\n\n    bulkActions.forEach(config => {\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.className = 'btn btn-sm btn-primary';\n      button.dataset.bulkAction = config.id;\n\n      if (config.icon) {\n        button.innerHTML = `${this.renderIcon(config.icon)} ${config.label}`;\n      } else {\n        button.textContent = config.label;\n      }\n\n      actionsContainer.appendChild(button);\n    });\n\n    toolbar.appendChild(actionsContainer);\n\n    const clearButton = document.createElement('button');\n    clearButton.type = 'button';\n    clearButton.className = 'btn btn-sm btn-secondary';\n    clearButton.id = 'clear-selection-btn';\n    clearButton.textContent = 'Clear Selection';\n    toolbar.appendChild(clearButton);\n\n    return toolbar;\n  }\n\n  /**\n   * Execute bulk action\n   */\n  async executeBulkAction(\n    config: BulkActionConfig,\n    selectedIds: string[]\n  ): Promise<void> {\n    // Check guard condition\n    if (config.guard && !config.guard(selectedIds)) {\n      console.warn(`Bulk action \"${config.id}\" guard failed`);\n      return;\n    }\n\n    // Confirm if needed - use notifier's async confirm\n    if (config.confirm) {\n      const message = config.confirm.replace('{count}', selectedIds.length.toString());\n      const confirmed = await this.notifier.confirm(message);\n      if (!confirmed) {\n        return;\n      }\n    }\n\n    const requestPayload = await this.resolveBulkActionPayload(config, selectedIds);\n    if (requestPayload === null) {\n      return;\n    }\n\n    try {\n      const response = await fetch(config.endpoint, {\n        method: config.method || 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        const errorMsg = await extractErrorMessage(response);\n        this.notifier.error(errorMsg);\n        throw new Error(errorMsg);\n      }\n\n      const data = await response.json();\n      this.notifier.success(this.buildBulkSuccessMessage(config, data, selectedIds.length));\n\n      if (config.onSuccess) {\n        config.onSuccess(data);\n      }\n    } catch (error) {\n      console.error(`Bulk action \"${config.id}\" failed:`, error);\n\n      // Show error toast if onError callback didn't handle it\n      if (!config.onError) {\n        const errorMsg = error instanceof Error ? error.message : 'Bulk action failed';\n        this.notifier.error(errorMsg);\n      }\n\n      if (config.onError) {\n        config.onError(error as Error);\n      }\n      throw error;\n    }\n  }\n\n  private async resolveBulkActionPayload(\n    config: BulkActionConfig,\n    selectedIds: string[]\n  ): Promise<Record<string, unknown> | null> {\n    const payload: Record<string, unknown> = {\n      ...(config.payload || {}),\n      ids: selectedIds,\n    };\n\n    const schema = this.normalizePayloadSchema(config.payloadSchema);\n    if (schema?.properties) {\n      Object.entries(schema.properties).forEach(([field, definition]) => {\n        if (payload[field] === undefined && definition && definition.default !== undefined) {\n          payload[field] = definition.default;\n        }\n      });\n    }\n\n    const required = this.collectRequiredFields(config.payloadRequired, schema);\n    const missingRequired = required.filter((field) => field !== 'ids' && this.isEmptyPayloadValue(payload[field]));\n    if (missingRequired.length === 0) {\n      return payload;\n    }\n\n    const rawValues = await this.requestRequiredFields(config, missingRequired, schema, payload);\n    if (rawValues === null) {\n      return null;\n    }\n\n    for (const field of missingRequired) {\n      const definition = schema?.properties?.[field];\n      const rawValue = rawValues[field] ?? '';\n      const parsed = this.coercePromptValue(rawValue, field, definition);\n      if (parsed.error) {\n        this.notifier.error(parsed.error);\n        return null;\n      }\n      payload[field] = parsed.value;\n    }\n\n    return payload;\n  }\n\n  private collectRequiredFields(required: string[] | undefined, schema: PayloadSchema | null): string[] {\n    const ordered: string[] = [];\n    const seen = new Set<string>();\n    const append = (field: string): void => {\n      const value = field.trim();\n      if (!value || seen.has(value)) {\n        return;\n      }\n      seen.add(value);\n      ordered.push(value);\n    };\n\n    if (Array.isArray(required)) {\n      required.forEach((field) => append(String(field)));\n    }\n    if (Array.isArray(schema?.required)) {\n      schema.required.forEach((field) => append(String(field)));\n    }\n    return ordered;\n  }\n\n  private normalizePayloadSchema(schema: Record<string, unknown> | undefined): PayloadSchema | null {\n    if (!schema || typeof schema !== 'object') {\n      return null;\n    }\n    const propertiesRaw = schema.properties;\n    let properties: Record<string, PayloadSchemaProperty> | undefined;\n    if (propertiesRaw && typeof propertiesRaw === 'object') {\n      properties = {};\n      Object.entries(propertiesRaw as Record<string, unknown>).forEach(([key, value]) => {\n        if (value && typeof value === 'object') {\n          properties![key] = value as PayloadSchemaProperty;\n        }\n      });\n    }\n    return {\n      type: typeof schema.type === 'string' ? schema.type : undefined,\n      required: schema.required,\n      properties,\n    };\n  }\n\n  private async requestRequiredFields(\n    config: BulkActionConfig,\n    requiredFields: string[],\n    schema: PayloadSchema | null,\n    payload: Record<string, unknown>\n  ): Promise<Record<string, string> | null> {\n    const modalFields = requiredFields.map((field) => {\n      const definition = schema?.properties?.[field];\n      const rawType = typeof definition?.type === 'string' ? definition.type.toLowerCase() : 'string';\n      return {\n        name: field,\n        label: (definition?.title || field).trim(),\n        description: (definition?.description || '').trim() || undefined,\n        value: this.stringifyPromptDefault(payload[field] !== undefined ? payload[field] : definition?.default),\n        type: rawType,\n        options: this.buildSchemaOptions(definition),\n      };\n    });\n    return PayloadInputModal.prompt({\n      title: `Complete ${config.label || config.id}`,\n      fields: modalFields,\n    });\n  }\n\n  private buildSchemaOptions(definition: PayloadSchemaProperty | undefined): PayloadModalFieldOption[] | undefined {\n    if (!definition) {\n      return undefined;\n    }\n\n    if (Array.isArray(definition.oneOf) && definition.oneOf.length > 0) {\n      const options = definition.oneOf\n        .filter((option) => option && Object.prototype.hasOwnProperty.call(option, 'const'))\n        .map((option) => {\n          const value = this.stringifyPromptDefault(option.const);\n          const label = typeof option.title === 'string' && option.title.trim() ? option.title.trim() : value;\n          return { value, label };\n        });\n      return options.length > 0 ? options : undefined;\n    }\n\n    if (Array.isArray(definition.enum) && definition.enum.length > 0) {\n      const options = definition.enum.map((item) => {\n        const value = this.stringifyPromptDefault(item);\n        return { value, label: value };\n      });\n      return options.length > 0 ? options : undefined;\n    }\n\n    if (typeof definition.type === 'string' && definition.type.toLowerCase() === 'boolean') {\n      return [\n        { value: 'true', label: 'True' },\n        { value: 'false', label: 'False' },\n      ];\n    }\n\n    return undefined;\n  }\n\n  private stringifyPromptDefault(value: unknown): string {\n    if (value === undefined || value === null) {\n      return '';\n    }\n    if (typeof value === 'string') {\n      return value;\n    }\n    if (typeof value === 'number' || typeof value === 'boolean') {\n      return String(value);\n    }\n    try {\n      return JSON.stringify(value);\n    } catch {\n      return '';\n    }\n  }\n\n  private coercePromptValue(\n    rawValue: string,\n    field: string,\n    definition: PayloadSchemaProperty | undefined\n  ): { value: unknown; error?: string } {\n    if (Array.isArray(definition?.oneOf) && definition.oneOf.length > 0) {\n      const match = definition.oneOf.find(\n        (item) => item && Object.prototype.hasOwnProperty.call(item, 'const') && this.stringifyPromptDefault(item.const) === rawValue\n      );\n      if (!match || !Object.prototype.hasOwnProperty.call(match, 'const')) {\n        const allowed = definition.oneOf\n          .map((item) => (typeof item?.title === 'string' && item.title.trim() ? item.title.trim() : this.stringifyPromptDefault(item.const)))\n          .filter((value) => value !== '')\n          .join(', ');\n        return { value: rawValue, error: `${field} must be one of: ${allowed}` };\n      }\n      return { value: match.const };\n    }\n\n    const type = (definition?.type || 'string').toLowerCase();\n    if (rawValue === '') {\n      return { value: '' };\n    }\n\n    let value: unknown = rawValue;\n    switch (type) {\n      case 'integer': {\n        const parsed = Number.parseInt(rawValue, 10);\n        if (Number.isNaN(parsed)) {\n          return { value: rawValue, error: `${field} must be an integer.` };\n        }\n        value = parsed;\n        break;\n      }\n      case 'number': {\n        const parsed = Number.parseFloat(rawValue);\n        if (Number.isNaN(parsed)) {\n          return { value: rawValue, error: `${field} must be a number.` };\n        }\n        value = parsed;\n        break;\n      }\n      case 'boolean': {\n        const normalized = rawValue.toLowerCase();\n        if (['true', '1', 'yes', 'y', 'on'].includes(normalized)) {\n          value = true;\n          break;\n        }\n        if (['false', '0', 'no', 'n', 'off'].includes(normalized)) {\n          value = false;\n          break;\n        }\n        return { value: rawValue, error: `${field} must be true/false.` };\n      }\n      case 'array':\n      case 'object': {\n        try {\n          const parsed = JSON.parse(rawValue) as unknown;\n          if (type === 'array' && !Array.isArray(parsed)) {\n            return { value: rawValue, error: `${field} must be a JSON array.` };\n          }\n          if (type === 'object' && (parsed === null || Array.isArray(parsed) || typeof parsed !== 'object')) {\n            return { value: rawValue, error: `${field} must be a JSON object.` };\n          }\n          value = parsed;\n        } catch {\n          return { value: rawValue, error: `${field} must be valid JSON.` };\n        }\n        break;\n      }\n      default:\n        value = rawValue;\n    }\n\n    if (Array.isArray(definition?.enum) && definition!.enum!.length > 0) {\n      const matches = definition!.enum!.some((item) => item === value || String(item) === String(value));\n      if (!matches) {\n        return { value, error: `${field} must be one of: ${definition!.enum!.map((item) => String(item)).join(', ')}` };\n      }\n    }\n\n    return { value };\n  }\n\n  private isEmptyPayloadValue(value: unknown): boolean {\n    if (value === undefined || value === null) {\n      return true;\n    }\n    if (typeof value === 'string') {\n      return value.trim() === '';\n    }\n    if (Array.isArray(value)) {\n      return value.length === 0;\n    }\n    if (typeof value === 'object') {\n      return Object.keys(value as Record<string, unknown>).length === 0;\n    }\n    return false;\n  }\n\n  private buildBulkSuccessMessage(\n    config: BulkActionConfig,\n    data: any,\n    fallbackCount: number\n  ): string {\n    const actionLabel = config.label || config.id || 'Bulk action';\n    const summary = data && typeof data === 'object' ? data.summary : null;\n    const succeeded = summary && typeof summary.succeeded === 'number'\n      ? summary.succeeded\n      : (typeof data?.processed === 'number' ? data.processed : fallbackCount);\n    const failed = summary && typeof summary.failed === 'number' ? summary.failed : 0;\n    if (failed > 0) {\n      return `${actionLabel} completed: ${succeeded} succeeded, ${failed} failed.`;\n    }\n    return `${actionLabel} completed for ${succeeded} item${succeeded === 1 ? '' : 's'}.`;\n  }\n\n  private getVariantClass(variant: ActionVariant): string {\n    const variants: Record<ActionVariant, string> = {\n      primary: 'btn-primary',\n      secondary: 'btn-secondary',\n      danger: 'btn-danger',\n      success: 'btn-success',\n      warning: 'btn-warning',\n    };\n    return variants[variant] || 'btn-secondary';\n  }\n\n  private renderIcon(icon: string): string {\n    // Simple icon mapping - extend as needed\n    const icons: Record<string, string> = {\n      'eye': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"/></svg>',\n      'edit': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/></svg>',\n      'trash': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/></svg>',\n      'check-circle': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'pause': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'pause-circle': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'x-circle': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>',\n      'key': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"/></svg>',\n      'archive': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4\"/></svg>',\n      'download': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"/></svg>',\n      'copy': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/></svg>',\n      'user-badge': '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/></svg>',\n    };\n    return icons[icon] || '';\n  }\n\n  private sanitize(str: string): string {\n    return str.toLowerCase().replace(/[^a-z0-9]/g, '-');\n  }\n\n  private escapeHtml(str: string): string {\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  }\n}\n","/**\n * Translation Context Helpers\n *\n * Normalizes translation metadata from API responses (flat or nested) and provides\n * UI rendering utilities for locale badges, fallback warnings, and edit guards.\n *\n * Translation context fields (per CONTENT_TRANSLATION_TDD.md):\n * - requested_locale: The locale requested by the user\n * - resolved_locale: The locale actually returned (may differ if fallback used)\n * - available_locales: Array of locales that exist for this translation group\n * - missing_requested_locale: Boolean indicating requested locale doesn't exist\n * - fallback_used: Boolean indicating content is from a fallback locale\n * - translation_group_id: The group ID linking all locale variants\n */\n\nimport { badge } from '../shared/badge.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Normalized translation context extracted from record payloads.\n * Used for UI rendering decisions (badges, warnings, edit guards).\n */\nexport interface TranslationContext {\n  /** The locale that was requested (from query params) */\n  requestedLocale: string | null;\n  /** The locale that was actually resolved/returned */\n  resolvedLocale: string | null;\n  /** Array of available locales for this translation group */\n  availableLocales: string[];\n  /** True if the requested locale doesn't exist */\n  missingRequestedLocale: boolean;\n  /** True if content is from a fallback locale (not the requested one) */\n  fallbackUsed: boolean;\n  /** Translation group ID linking all locale variants */\n  translationGroupId: string | null;\n  /** Workflow status of the current locale variant */\n  status: string | null;\n  /** Entity type (pages, posts, etc.) */\n  entityType: string | null;\n  /** Record ID */\n  recordId: string | null;\n}\n\n/**\n * Translation readiness state from canonical backend `translation_readiness` fields.\n * Used for grid-level visibility without requiring publish-failure round trips.\n */\nexport interface TranslationReadiness {\n  /** Translation group ID linking all locale variants */\n  translationGroupId: string | null;\n  /** Required locales per policy for this entity/transition/environment */\n  requiredLocales: string[];\n  /** Available locales that exist for this translation group */\n  availableLocales: string[];\n  /** Locales that are required but missing */\n  missingRequiredLocales: string[];\n  /** Missing required fields by locale (only includes locales in availableLocales) */\n  missingRequiredFieldsByLocale: Record<string, string[]>;\n  /** Computed readiness state */\n  readinessState: ReadinessState | null;\n  /** Transition readiness map (e.g., { publish: true }) */\n  readyForTransition: Record<string, boolean>;\n  /** Environment used for policy evaluation */\n  evaluatedEnvironment: string | null;\n  /** Whether readiness metadata is present (for legacy compat) */\n  hasReadinessMetadata: boolean;\n}\n\n/** Possible readiness states from backend */\nexport type ReadinessState = 'ready' | 'missing_locales' | 'missing_fields' | 'missing_locales_and_fields';\n\n/**\n * Readiness badge rendering options\n */\nexport interface ReadinessBadgeOptions {\n  /** Size variant for the badge */\n  size?: 'sm' | 'default';\n  /** Show detailed tooltip with missing info */\n  showDetailedTooltip?: boolean;\n  /** Additional CSS classes */\n  extraClass?: string;\n}\n\n/**\n * Badge rendering options\n */\nexport interface LocaleBadgeOptions {\n  /** Show fallback indicator when in fallback mode */\n  showFallbackIndicator?: boolean;\n  /** Size variant for the badge */\n  size?: 'sm' | 'default';\n  /** Additional CSS classes */\n  extraClass?: string;\n}\n\n/**\n * Translation status indicator options\n */\nexport interface TranslationStatusOptions {\n  /** Maximum number of locales to show before truncating */\n  maxLocales?: number;\n  /** Show the resolved locale badge */\n  showResolvedLocale?: boolean;\n  /** Size variant */\n  size?: 'sm' | 'default';\n}\n\n// ============================================================================\n// Translation Context Extraction\n// ============================================================================\n\n/**\n * Extract and normalize translation context from a record payload.\n * Handles both flat fields and nested `translation.meta.*` / `content_translation.meta.*` structures.\n *\n * @param record - The record object from API response\n * @returns Normalized TranslationContext\n */\nexport function extractTranslationContext(record: Record<string, unknown>): TranslationContext {\n  const context: TranslationContext = {\n    requestedLocale: null,\n    resolvedLocale: null,\n    availableLocales: [],\n    missingRequestedLocale: false,\n    fallbackUsed: false,\n    translationGroupId: null,\n    status: null,\n    entityType: null,\n    recordId: null,\n  };\n\n  if (!record || typeof record !== 'object') {\n    return context;\n  }\n\n  // Try flat fields first, then nested structures\n  context.requestedLocale = extractStringField(record, [\n    'requested_locale',\n    'translation.meta.requested_locale',\n    'content_translation.meta.requested_locale',\n  ]);\n\n  context.resolvedLocale = extractStringField(record, [\n    'resolved_locale',\n    'locale',\n    'translation.meta.resolved_locale',\n    'content_translation.meta.resolved_locale',\n  ]);\n\n  context.availableLocales = extractStringArrayField(record, [\n    'available_locales',\n    'translation.meta.available_locales',\n    'content_translation.meta.available_locales',\n  ]);\n\n  context.missingRequestedLocale = extractBooleanField(record, [\n    'missing_requested_locale',\n    'translation.meta.missing_requested_locale',\n    'content_translation.meta.missing_requested_locale',\n  ]);\n\n  context.fallbackUsed = extractBooleanField(record, [\n    'fallback_used',\n    'translation.meta.fallback_used',\n    'content_translation.meta.fallback_used',\n  ]);\n\n  context.translationGroupId = extractStringField(record, [\n    'translation_group_id',\n    'translation.meta.translation_group_id',\n    'content_translation.meta.translation_group_id',\n  ]);\n\n  context.status = extractStringField(record, ['status']);\n  context.entityType = extractStringField(record, ['entity_type', 'type', '_type']);\n  context.recordId = extractStringField(record, ['id']);\n\n  // Infer fallback state from locale mismatch if not explicitly set\n  if (!context.fallbackUsed && context.requestedLocale && context.resolvedLocale) {\n    context.fallbackUsed = context.requestedLocale !== context.resolvedLocale;\n  }\n\n  // Infer missing_requested_locale from fallback state\n  if (!context.missingRequestedLocale && context.fallbackUsed) {\n    context.missingRequestedLocale = true;\n  }\n\n  return context;\n}\n\n/**\n * Check if a record is in fallback mode (requested locale doesn't exist).\n * Use this to determine if edit guards should be applied.\n */\nexport function isInFallbackMode(record: Record<string, unknown>): boolean {\n  const ctx = extractTranslationContext(record);\n  return ctx.fallbackUsed || ctx.missingRequestedLocale;\n}\n\n/**\n * Check if a record has translation context metadata available.\n */\nexport function hasTranslationContext(record: Record<string, unknown>): boolean {\n  const ctx = extractTranslationContext(record);\n  return ctx.translationGroupId !== null || ctx.resolvedLocale !== null || ctx.availableLocales.length > 0;\n}\n\n/**\n * Extract canonical translation readiness fields from a record payload.\n * These fields are exposed by Phase 18.6 productization for grid-level visibility.\n *\n * @param record - The record object from API response\n * @returns Normalized TranslationReadiness\n */\nexport function extractTranslationReadiness(record: Record<string, unknown>): TranslationReadiness {\n  const readiness: TranslationReadiness = {\n    translationGroupId: null,\n    requiredLocales: [],\n    availableLocales: [],\n    missingRequiredLocales: [],\n    missingRequiredFieldsByLocale: {},\n    readinessState: null,\n    readyForTransition: {},\n    evaluatedEnvironment: null,\n    hasReadinessMetadata: false,\n  };\n\n  if (!record || typeof record !== 'object') {\n    return readiness;\n  }\n\n  // Check for nested translation_readiness object (canonical productized format)\n  const readinessObj = record.translation_readiness as Record<string, unknown> | undefined;\n\n  if (readinessObj && typeof readinessObj === 'object') {\n    readiness.hasReadinessMetadata = true;\n\n    readiness.translationGroupId = typeof readinessObj.translation_group_id === 'string'\n      ? readinessObj.translation_group_id\n      : null;\n\n    readiness.requiredLocales = Array.isArray(readinessObj.required_locales)\n      ? readinessObj.required_locales.filter((v): v is string => typeof v === 'string')\n      : [];\n\n    readiness.availableLocales = Array.isArray(readinessObj.available_locales)\n      ? readinessObj.available_locales.filter((v): v is string => typeof v === 'string')\n      : [];\n\n    readiness.missingRequiredLocales = Array.isArray(readinessObj.missing_required_locales)\n      ? readinessObj.missing_required_locales.filter((v): v is string => typeof v === 'string')\n      : [];\n\n    // Parse missing_required_fields_by_locale\n    const fieldsByLocale = readinessObj.missing_required_fields_by_locale;\n    if (fieldsByLocale && typeof fieldsByLocale === 'object' && !Array.isArray(fieldsByLocale)) {\n      for (const [locale, fields] of Object.entries(fieldsByLocale)) {\n        if (Array.isArray(fields)) {\n          readiness.missingRequiredFieldsByLocale[locale] = fields.filter(\n            (v): v is string => typeof v === 'string'\n          );\n        }\n      }\n    }\n\n    // Parse readiness_state\n    const state = readinessObj.readiness_state;\n    if (typeof state === 'string' && isValidReadinessState(state)) {\n      readiness.readinessState = state;\n    }\n\n    // Parse ready_for_transition map\n    const readyFor = readinessObj.ready_for_transition;\n    if (readyFor && typeof readyFor === 'object' && !Array.isArray(readyFor)) {\n      for (const [transition, ready] of Object.entries(readyFor)) {\n        if (typeof ready === 'boolean') {\n          readiness.readyForTransition[transition] = ready;\n        }\n      }\n    }\n\n    readiness.evaluatedEnvironment = typeof readinessObj.evaluated_environment === 'string'\n      ? readinessObj.evaluated_environment\n      : null;\n  }\n\n  return readiness;\n}\n\n/**\n * Check if a record has canonical translation readiness metadata.\n * Used to determine whether to use productized rendering vs legacy fallback.\n */\nexport function hasTranslationReadiness(record: Record<string, unknown>): boolean {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.hasReadinessMetadata;\n}\n\n/**\n * Check if a record is ready for a specific transition (e.g., 'publish').\n */\nexport function isReadyForTransition(record: Record<string, unknown>, transition: string): boolean {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.readyForTransition[transition] === true;\n}\n\n/**\n * Type guard for valid readiness states.\n */\nfunction isValidReadinessState(state: string): state is ReadinessState {\n  return ['ready', 'missing_locales', 'missing_fields', 'missing_locales_and_fields'].includes(state);\n}\n\n// ============================================================================\n// Badge Rendering\n// ============================================================================\n\n/**\n * Render a locale badge for display in content rows.\n * Shows the resolved locale with an optional fallback indicator.\n *\n * @param context - Translation context or record to extract from\n * @param options - Rendering options\n * @returns HTML string for the locale badge\n */\nexport function renderLocaleBadge(\n  context: TranslationContext | Record<string, unknown>,\n  options: LocaleBadgeOptions = {}\n): string {\n  const ctx = 'resolvedLocale' in context\n    ? context as TranslationContext\n    : extractTranslationContext(context as Record<string, unknown>);\n\n  const { showFallbackIndicator = true, size = 'default', extraClass = '' } = options;\n\n  if (!ctx.resolvedLocale) {\n    return '';\n  }\n\n  const locale = ctx.resolvedLocale.toUpperCase();\n  const isFallback = ctx.fallbackUsed || ctx.missingRequestedLocale;\n\n  // Build badge classes\n  const sizeClass = size === 'sm' ? 'text-xs px-1.5 py-0.5' : 'text-xs px-2 py-1';\n  const baseClasses = `inline-flex items-center gap-1 rounded font-medium ${sizeClass}`;\n\n  if (isFallback && showFallbackIndicator) {\n    // Fallback mode: amber/warning style with indicator\n    return `<span class=\"${baseClasses} bg-amber-100 text-amber-800 ${extraClass}\"\n                  title=\"Showing ${ctx.resolvedLocale} content (${ctx.requestedLocale || 'requested locale'} not available)\"\n                  aria-label=\"Fallback locale: ${locale}\">\n      <svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n      </svg>\n      ${locale}\n    </span>`;\n  }\n\n  // Normal locale badge\n  return `<span class=\"${baseClasses} bg-blue-100 text-blue-800 ${extraClass}\"\n                title=\"Locale: ${locale}\"\n                aria-label=\"Locale: ${locale}\">\n    ${locale}\n  </span>`;\n}\n\n/**\n * Render available locales as a compact indicator for content rows.\n * Shows which locales exist for this translation group.\n *\n * @param context - Translation context or record\n * @param options - Rendering options\n * @returns HTML string for available locales indicator\n */\nexport function renderAvailableLocalesIndicator(\n  context: TranslationContext | Record<string, unknown>,\n  options: TranslationStatusOptions = {}\n): string {\n  const ctx = 'resolvedLocale' in context\n    ? context as TranslationContext\n    : extractTranslationContext(context as Record<string, unknown>);\n\n  const { maxLocales = 3, size = 'default' } = options;\n\n  if (ctx.availableLocales.length === 0) {\n    return '';\n  }\n\n  const sizeClass = size === 'sm' ? 'text-xs gap-0.5' : 'text-xs gap-1';\n  const pillSize = size === 'sm' ? 'px-1 py-0.5 text-[10px]' : 'px-1.5 py-0.5';\n\n  const visibleLocales = ctx.availableLocales.slice(0, maxLocales);\n  const hiddenCount = ctx.availableLocales.length - maxLocales;\n\n  const pills = visibleLocales.map(locale => {\n    const isResolved = locale === ctx.resolvedLocale;\n    const pillClass = isResolved\n      ? `${pillSize} rounded bg-blue-100 text-blue-700 font-medium`\n      : `${pillSize} rounded bg-gray-100 text-gray-600`;\n    return `<span class=\"${pillClass}\">${locale.toUpperCase()}</span>`;\n  }).join('');\n\n  const overflow = hiddenCount > 0\n    ? `<span class=\"${pillSize} rounded bg-gray-100 text-gray-500\">+${hiddenCount}</span>`\n    : '';\n\n  return `<span class=\"inline-flex items-center ${sizeClass}\"\n                title=\"Available locales: ${ctx.availableLocales.join(', ')}\"\n                aria-label=\"Available locales: ${ctx.availableLocales.join(', ')}\">\n    ${pills}${overflow}\n  </span>`;\n}\n\n/**\n * Render a combined translation status cell for content rows.\n * Combines locale badge + availability indicator.\n *\n * @param context - Translation context or record\n * @param options - Rendering options\n * @returns HTML string for the translation status cell\n */\nexport function renderTranslationStatusCell(\n  context: TranslationContext | Record<string, unknown>,\n  options: TranslationStatusOptions = {}\n): string {\n  const ctx = 'resolvedLocale' in context\n    ? context as TranslationContext\n    : extractTranslationContext(context as Record<string, unknown>);\n\n  const { showResolvedLocale = true, size = 'default' } = options;\n\n  const parts: string[] = [];\n\n  // Add locale badge\n  if (showResolvedLocale && ctx.resolvedLocale) {\n    parts.push(renderLocaleBadge(ctx, { size, showFallbackIndicator: true }));\n  }\n\n  // Add available locales indicator\n  if (ctx.availableLocales.length > 1) {\n    parts.push(renderAvailableLocalesIndicator(ctx, { ...options, size }));\n  }\n\n  if (parts.length === 0) {\n    return '<span class=\"text-gray-400\">-</span>';\n  }\n\n  const gapClass = size === 'sm' ? 'gap-1' : 'gap-2';\n  return `<div class=\"flex items-center flex-wrap ${gapClass}\">${parts.join('')}</div>`;\n}\n\n/**\n * Render a workflow status badge.\n */\nexport function renderStatusBadge(status: string | null, size: 'sm' | 'default' = 'default'): string {\n  if (!status) {\n    return '';\n  }\n\n  const statusLower = status.toLowerCase();\n  return badge(status, 'status', statusLower, { size: size === 'sm' ? 'sm' : undefined });\n}\n\n// ============================================================================\n// Translation Readiness Rendering (Productized Phase 19)\n// ============================================================================\n\n/**\n * Render a translation readiness indicator for content rows.\n * Shows completeness state based on canonical backend readiness fields.\n *\n * @param record - The record from API response\n * @param options - Rendering options\n * @returns HTML string for the readiness indicator\n */\nexport function renderReadinessIndicator(\n  record: Record<string, unknown>,\n  options: ReadinessBadgeOptions = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  // Legacy mode: no readiness metadata, show nothing or fallback\n  if (!readiness.hasReadinessMetadata) {\n    return '';\n  }\n\n  const { size = 'default', showDetailedTooltip = true, extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-xs px-1.5 py-0.5' : 'text-xs px-2 py-1';\n  const baseClasses = `inline-flex items-center gap-1 rounded font-medium ${sizeClass}`;\n\n  const state = readiness.readinessState || 'ready';\n  const { icon, label, bgClass, textClass, tooltip } = getReadinessStateDisplay(state, readiness, showDetailedTooltip);\n\n  return `<span class=\"${baseClasses} ${bgClass} ${textClass} ${extraClass}\"\n                title=\"${tooltip}\"\n                aria-label=\"${label}\"\n                data-readiness-state=\"${state}\">\n    ${icon}\n    <span>${label}</span>\n  </span>`;\n}\n\n/**\n * Render a compact publish readiness badge (ready/not ready).\n */\nexport function renderPublishReadinessBadge(\n  record: Record<string, unknown>,\n  options: ReadinessBadgeOptions = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  if (!readiness.hasReadinessMetadata) {\n    return '';\n  }\n\n  const isReady = readiness.readyForTransition.publish === true;\n  const { size = 'default', extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-[10px] px-1.5 py-0.5' : 'text-xs px-2 py-1';\n\n  if (isReady) {\n    return `<span class=\"inline-flex items-center gap-1 rounded font-medium ${sizeClass} bg-green-100 text-green-700 ${extraClass}\"\n                  title=\"Ready to publish\"\n                  aria-label=\"Ready to publish\">\n      <svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/>\n      </svg>\n      Ready\n    </span>`;\n  }\n\n  // Not ready - show missing info\n  const missingCount = readiness.missingRequiredLocales.length;\n  const tooltip = missingCount > 0\n    ? `Missing translations: ${readiness.missingRequiredLocales.join(', ')}`\n    : 'Not ready to publish';\n\n  return `<span class=\"inline-flex items-center gap-1 rounded font-medium ${sizeClass} bg-amber-100 text-amber-700 ${extraClass}\"\n                title=\"${tooltip}\"\n                aria-label=\"Not ready to publish\">\n    <svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n      <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n    </svg>\n    ${missingCount > 0 ? `${missingCount} missing` : 'Not ready'}\n  </span>`;\n}\n\n/**\n * Render a locale completeness progress indicator.\n * Shows X/Y locales complete.\n */\nexport function renderLocaleCompleteness(\n  record: Record<string, unknown>,\n  options: { size?: 'sm' | 'default'; extraClass?: string } = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  if (!readiness.hasReadinessMetadata || readiness.requiredLocales.length === 0) {\n    return '';\n  }\n\n  const { size = 'default', extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-xs' : 'text-sm';\n\n  const required = readiness.requiredLocales.length;\n  const available = readiness.availableLocales.filter(\n    loc => readiness.requiredLocales.includes(loc)\n  ).length;\n  const complete = required > 0 && available === required;\n\n  const colorClass = complete\n    ? 'text-green-600'\n    : available > 0\n      ? 'text-amber-600'\n      : 'text-gray-500';\n\n  return `<span class=\"${sizeClass} ${colorClass} font-medium ${extraClass}\"\n                title=\"Locale completeness: ${available} of ${required} required locales available\"\n                aria-label=\"${available} of ${required} locales\">\n    ${available}/${required}\n  </span>`;\n}\n\n/**\n * Render a prominent \"Missing Translations\" badge for list rows.\n * This is a first-class affordance to quickly identify incomplete content.\n *\n * @param record - The record from API response\n * @param options - Rendering options\n * @returns HTML string for the missing translations badge, or empty if complete\n */\nexport function renderMissingTranslationsBadge(\n  record: Record<string, unknown>,\n  options: ReadinessBadgeOptions = {}\n): string {\n  const readiness = extractTranslationReadiness(record);\n\n  // No badge needed if ready or no metadata\n  if (!readiness.hasReadinessMetadata || readiness.readinessState === 'ready') {\n    return '';\n  }\n\n  const { size = 'default', extraClass = '' } = options;\n  const sizeClass = size === 'sm' ? 'text-xs px-2 py-1' : 'text-sm px-2.5 py-1';\n  const missingCount = readiness.missingRequiredLocales.length;\n\n  // Different severity levels\n  const hasMissingLocales = missingCount > 0;\n  const hasMissingFields = Object.keys(readiness.missingRequiredFieldsByLocale).length > 0;\n\n  let bgClass = 'bg-amber-100';\n  let textClass = 'text-amber-800';\n  let label = '';\n  let tooltip = '';\n\n  if (hasMissingLocales && hasMissingFields) {\n    bgClass = 'bg-red-100';\n    textClass = 'text-red-800';\n    label = `${missingCount} missing`;\n    tooltip = `Missing translations: ${readiness.missingRequiredLocales.join(', ')}. Also has incomplete fields.`;\n  } else if (hasMissingLocales) {\n    bgClass = 'bg-amber-100';\n    textClass = 'text-amber-800';\n    label = `${missingCount} missing`;\n    tooltip = `Missing translations: ${readiness.missingRequiredLocales.join(', ')}`;\n  } else if (hasMissingFields) {\n    bgClass = 'bg-yellow-100';\n    textClass = 'text-yellow-800';\n    label = 'Incomplete';\n    const locales = Object.keys(readiness.missingRequiredFieldsByLocale);\n    tooltip = `Incomplete fields in: ${locales.join(', ')}`;\n  }\n\n  if (!label) {\n    return '';\n  }\n\n  const warningIcon = `<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/></svg>`;\n\n  return `<span class=\"inline-flex items-center gap-1.5 rounded-full font-medium ${sizeClass} ${bgClass} ${textClass} ${extraClass}\"\n                title=\"${tooltip}\"\n                aria-label=\"${tooltip}\"\n                data-missing-translations=\"true\"\n                data-missing-count=\"${missingCount}\">\n    ${warningIcon}\n    <span>${label}</span>\n  </span>`;\n}\n\n/**\n * Check if a record has missing required translations.\n * Used for quick filtering in list views.\n */\nexport function hasMissingTranslations(record: Record<string, unknown>): boolean {\n  const readiness = extractTranslationReadiness(record);\n  if (!readiness.hasReadinessMetadata) {\n    return false;\n  }\n  return readiness.readinessState !== 'ready';\n}\n\n/**\n * Get the missing translations count for a record.\n */\nexport function getMissingTranslationsCount(record: Record<string, unknown>): number {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.missingRequiredLocales.length;\n}\n\n/**\n * Get display properties for a readiness state.\n */\nfunction getReadinessStateDisplay(\n  state: ReadinessState,\n  readiness: TranslationReadiness,\n  showDetailedTooltip: boolean\n): { icon: string; label: string; bgClass: string; textClass: string; tooltip: string } {\n  const checkIcon = `<svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/></svg>`;\n  const warningIcon = `<svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/></svg>`;\n\n  switch (state) {\n    case 'ready':\n      return {\n        icon: checkIcon,\n        label: 'Ready',\n        bgClass: 'bg-green-100',\n        textClass: 'text-green-700',\n        tooltip: 'All required translations are complete',\n      };\n\n    case 'missing_locales': {\n      const missing = readiness.missingRequiredLocales;\n      const tooltip = showDetailedTooltip && missing.length > 0\n        ? `Missing translations: ${missing.join(', ')}`\n        : 'Missing required translations';\n      return {\n        icon: warningIcon,\n        label: `${missing.length} missing`,\n        bgClass: 'bg-amber-100',\n        textClass: 'text-amber-700',\n        tooltip,\n      };\n    }\n\n    case 'missing_fields': {\n      const localesWithMissingFields = Object.keys(readiness.missingRequiredFieldsByLocale);\n      const tooltip = showDetailedTooltip && localesWithMissingFields.length > 0\n        ? `Incomplete fields in: ${localesWithMissingFields.join(', ')}`\n        : 'Some translations have missing required fields';\n      return {\n        icon: warningIcon,\n        label: 'Incomplete',\n        bgClass: 'bg-yellow-100',\n        textClass: 'text-yellow-700',\n        tooltip,\n      };\n    }\n\n    case 'missing_locales_and_fields': {\n      const missingLocales = readiness.missingRequiredLocales;\n      const localesWithMissingFields = Object.keys(readiness.missingRequiredFieldsByLocale);\n      const parts: string[] = [];\n      if (missingLocales.length > 0) {\n        parts.push(`Missing: ${missingLocales.join(', ')}`);\n      }\n      if (localesWithMissingFields.length > 0) {\n        parts.push(`Incomplete: ${localesWithMissingFields.join(', ')}`);\n      }\n      const tooltip = showDetailedTooltip ? parts.join('; ') : 'Missing translations and incomplete fields';\n      return {\n        icon: warningIcon,\n        label: 'Not ready',\n        bgClass: 'bg-red-100',\n        textClass: 'text-red-700',\n        tooltip,\n      };\n    }\n\n    default:\n      return {\n        icon: '',\n        label: 'Unknown',\n        bgClass: 'bg-gray-100',\n        textClass: 'text-gray-600',\n        tooltip: 'Unknown readiness state',\n      };\n  }\n}\n\n// ============================================================================\n// Translation Matrix Cell (Phase 2)\n// ============================================================================\n\n/**\n * Matrix cell rendering options\n */\nexport interface MatrixCellOptions {\n  /** Size variant: 'sm' or 'md' */\n  size?: 'sm' | 'md';\n  /** Maximum number of locales to show before truncating */\n  maxLocales?: number;\n  /** Show locale labels alongside icons */\n  showLabels?: boolean;\n}\n\n/**\n * Render a compact translation matrix cell showing locale status for each required locale.\n * Uses translation_readiness data to show  ready,  incomplete,  missing states.\n *\n * @param record - The record from API response\n * @param options - Matrix cell rendering options\n * @returns HTML string for the matrix cell\n */\nexport function renderTranslationMatrixCell(\n  record: Record<string, unknown>,\n  options: MatrixCellOptions = {}\n): string {\n  const { size = 'sm', maxLocales = 5, showLabels = false } = options;\n\n  const readiness = extractTranslationReadiness(record);\n  if (!readiness.hasReadinessMetadata) {\n    return '<span class=\"text-gray-400\">-</span>';\n  }\n\n  const { requiredLocales, availableLocales, missingRequiredFieldsByLocale } = readiness;\n  const allLocales = requiredLocales.length > 0 ? requiredLocales : availableLocales;\n\n  if (allLocales.length === 0) {\n    return '<span class=\"text-gray-400\">-</span>';\n  }\n\n  const availableSet = new Set(availableLocales);\n  const incompleteLocales = getIncompleteLocales(missingRequiredFieldsByLocale);\n\n  const chips = allLocales\n    .slice(0, maxLocales)\n    .map((locale) => {\n      const isAvailable = availableSet.has(locale);\n      const isIncomplete = isAvailable && incompleteLocales.has(locale);\n      const isComplete = isAvailable && !isIncomplete;\n      // isMissing implied when !isComplete && !isIncomplete\n\n      // Determine state and styling\n      let stateClass: string;\n      let icon: string;\n      let stateLabel: string;\n\n      if (isComplete) {\n        stateClass = 'bg-green-100 text-green-700 border-green-300';\n        icon = '';\n        stateLabel = 'Complete';\n      } else if (isIncomplete) {\n        stateClass = 'bg-amber-100 text-amber-700 border-amber-300';\n        icon = '';\n        stateLabel = 'Incomplete';\n      } else {\n        // Missing\n        stateClass = 'bg-white text-gray-400 border-gray-300 border-dashed';\n        icon = '';\n        stateLabel = 'Missing';\n      }\n\n      const sizeClass = size === 'sm'\n        ? 'text-[10px] px-1.5 py-0.5'\n        : 'text-xs px-2 py-1';\n\n      const labelHtml = showLabels\n        ? `<span class=\"font-medium\">${locale.toUpperCase()}</span>`\n        : '';\n\n      return `\n        <span class=\"inline-flex items-center gap-0.5 ${sizeClass} rounded border ${stateClass}\"\n              title=\"${locale.toUpperCase()}: ${stateLabel}\"\n              aria-label=\"${locale.toUpperCase()}: ${stateLabel}\"\n              data-locale=\"${locale}\"\n              data-state=\"${stateLabel.toLowerCase()}\">\n          ${labelHtml}\n          <span aria-hidden=\"true\">${icon}</span>\n        </span>\n      `;\n    })\n    .join('');\n\n  const overflow = allLocales.length > maxLocales\n    ? `<span class=\"text-[10px] text-gray-500\" title=\"${allLocales.length - maxLocales} more locales\">+${allLocales.length - maxLocales}</span>`\n    : '';\n\n  return `<div class=\"flex items-center gap-1 flex-wrap\" data-matrix-cell=\"true\">${chips}${overflow}</div>`;\n}\n\n/**\n * Get set of locales that have missing required fields.\n */\nfunction getIncompleteLocales(fieldsByLocale: Record<string, string[]>): Set<string> {\n  const incomplete = new Set<string>();\n  if (fieldsByLocale && typeof fieldsByLocale === 'object') {\n    for (const [locale, fields] of Object.entries(fieldsByLocale)) {\n      if (Array.isArray(fields) && fields.length > 0) {\n        incomplete.add(locale);\n      }\n    }\n  }\n  return incomplete;\n}\n\n/**\n * Create a cell renderer for translation matrix that can be used with DataGrid.\n * Returns a function compatible with the CellRenderer type.\n *\n * @param options - Matrix cell rendering options\n * @returns CellRenderer function\n */\nexport function createTranslationMatrixRenderer(\n  options: MatrixCellOptions = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderTranslationMatrixCell(record, options);\n  };\n}\n\n// ============================================================================\n// Fallback Warning Rendering\n// ============================================================================\n\n/**\n * Render a fallback warning banner for detail/edit views.\n * Shows when the requested locale doesn't exist and fallback content is displayed.\n *\n * @param context - Translation context\n * @param options - Options for the warning\n * @returns HTML string for the fallback warning banner\n */\nexport function renderFallbackWarning(\n  context: TranslationContext,\n  options: {\n    /** Handler URL for creating the missing translation */\n    createTranslationUrl?: string;\n    /** Panel name for action dispatch */\n    panelName?: string;\n    /** Show create translation button */\n    showCreateButton?: boolean;\n  } = {}\n): string {\n  if (!context.fallbackUsed && !context.missingRequestedLocale) {\n    return '';\n  }\n\n  const { showCreateButton = true, createTranslationUrl, panelName } = options;\n  const requestedLocale = context.requestedLocale || 'requested locale';\n  const resolvedLocale = context.resolvedLocale || 'default';\n\n  const createButtonHtml = showCreateButton ? `\n    <button type=\"button\"\n            class=\"inline-flex items-center gap-1 text-sm font-medium text-amber-800 hover:text-amber-900 underline\"\n            data-action=\"create-translation\"\n            data-locale=\"${context.requestedLocale || ''}\"\n            data-panel=\"${panelName || ''}\"\n            data-record-id=\"${context.recordId || ''}\"\n            ${createTranslationUrl ? `data-url=\"${createTranslationUrl}\"` : ''}>\n      <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n      </svg>\n      Create ${requestedLocale.toUpperCase()} translation\n    </button>\n  ` : '';\n\n  return `\n    <div class=\"fallback-warning bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4\"\n         role=\"alert\"\n         aria-live=\"polite\"\n         data-fallback-mode=\"true\"\n         data-requested-locale=\"${context.requestedLocale || ''}\"\n         data-resolved-locale=\"${context.resolvedLocale || ''}\">\n      <div class=\"flex items-start gap-3\">\n        <div class=\"flex-shrink-0\">\n          <svg class=\"w-5 h-5 text-amber-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n          </svg>\n        </div>\n        <div class=\"flex-1\">\n          <h3 class=\"text-sm font-medium text-amber-800\">\n            Viewing fallback content\n          </h3>\n          <p class=\"mt-1 text-sm text-amber-700\">\n            The <strong>${requestedLocale.toUpperCase()}</strong> translation doesn't exist yet.\n            You're viewing content from <strong>${resolvedLocale.toUpperCase()}</strong>.\n            <span class=\"block mt-1 text-amber-600\">Editing is disabled until you create the missing translation.</span>\n          </p>\n          ${createButtonHtml ? `<div class=\"mt-3\">${createButtonHtml}</div>` : ''}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n// ============================================================================\n// Cell Renderer Factory\n// ============================================================================\n\n/**\n * Create a cell renderer for translation status that can be used with DataGrid.\n * Returns a function compatible with the CellRenderer type.\n *\n * @param options - Rendering options\n * @returns CellRenderer function\n */\nexport function createTranslationStatusRenderer(\n  options: TranslationStatusOptions = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderTranslationStatusCell(record, options);\n  };\n}\n\n/**\n * Create a cell renderer for locale badge only.\n */\nexport function createLocaleBadgeRenderer(\n  options: LocaleBadgeOptions = {}\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderLocaleBadge(record, options);\n  };\n}\n\n// ============================================================================\n// Internal Helpers\n// ============================================================================\n\n/**\n * Extract a string field from a record, trying multiple paths.\n */\nfunction extractStringField(record: Record<string, unknown>, paths: string[]): string | null {\n  for (const path of paths) {\n    const value = getNestedValue(record, path);\n    if (typeof value === 'string' && value.trim()) {\n      return value;\n    }\n  }\n  return null;\n}\n\n/**\n * Extract a string array field from a record, trying multiple paths.\n */\nfunction extractStringArrayField(record: Record<string, unknown>, paths: string[]): string[] {\n  for (const path of paths) {\n    const value = getNestedValue(record, path);\n    if (Array.isArray(value)) {\n      return value.filter((v): v is string => typeof v === 'string');\n    }\n  }\n  return [];\n}\n\n/**\n * Extract a boolean field from a record, trying multiple paths.\n */\nfunction extractBooleanField(record: Record<string, unknown>, paths: string[]): boolean {\n  for (const path of paths) {\n    const value = getNestedValue(record, path);\n    if (typeof value === 'boolean') {\n      return value;\n    }\n    // Also handle string \"true\"/\"false\"\n    if (value === 'true') return true;\n    if (value === 'false') return false;\n  }\n  return false;\n}\n\n/**\n * Get a nested value from an object using dot notation.\n */\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  const parts = path.split('.');\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined || typeof current !== 'object') {\n      return undefined;\n    }\n    current = (current as Record<string, unknown>)[part];\n  }\n\n  return current;\n}\n","/**\n * Cell Renderers for DataGrid\n * Provides extensible cell rendering capabilities\n */\n\nimport { badge, booleanChip as sharedBooleanChip } from '../shared/badge.js';\nimport { renderIcon } from '../shared/icon-renderer.js';\nimport {\n  renderLocaleBadge,\n  renderTranslationStatusCell,\n  createTranslationStatusRenderer,\n  createLocaleBadgeRenderer\n} from './translation-context.js';\n\nconst EMPTY_CELL_HTML = '<span class=\"text-gray-400\">-</span>';\nconst DEFAULT_OBJECT_LABEL_KEYS = [\n  'name',\n  'label',\n  'title',\n  'slug',\n  'id',\n  'code',\n  'key',\n  'value',\n  'type',\n  'blockType',\n  'block_type',\n];\n\nexport interface CellRendererContext {\n  options?: Record<string, any>;\n}\n\nexport type CellRenderer = (value: any, record: any, column: string, context?: CellRendererContext) => string;\n\nfunction escapeHtml(value: string): string {\n  return value\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction compactJSON(value: any): string {\n  try {\n    return JSON.stringify(value);\n  } catch {\n    return String(value);\n  }\n}\n\nfunction normalizeDisplayKeys(options: Record<string, any>): string[] {\n  const keys: string[] = [];\n  const pushKey = (candidate: any) => {\n    if (typeof candidate !== 'string') return;\n    const key = candidate.trim();\n    if (!key || keys.includes(key)) return;\n    keys.push(key);\n  };\n  pushKey(options.display_key);\n  pushKey(options.displayKey);\n  const listCandidate = options.display_keys ?? options.displayKeys;\n  if (Array.isArray(listCandidate)) {\n    listCandidate.forEach(pushKey);\n  }\n  return keys;\n}\n\nfunction objectValueByPath(value: Record<string, any>, key: string): any {\n  if (!key) return undefined;\n  if (Object.prototype.hasOwnProperty.call(value, key)) {\n    return value[key];\n  }\n  if (!key.includes('.')) {\n    return undefined;\n  }\n  const segments = key.split('.');\n  let current: any = value;\n  for (const segment of segments) {\n    if (!current || typeof current !== 'object' || Array.isArray(current)) {\n      return undefined;\n    }\n    if (!Object.prototype.hasOwnProperty.call(current, segment)) {\n      return undefined;\n    }\n    current = current[segment];\n  }\n  return current;\n}\n\nfunction scalarSummary(value: any): string {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  switch (typeof value) {\n    case 'string':\n      return value.trim();\n    case 'number':\n    case 'bigint':\n      return String(value);\n    case 'boolean':\n      return value ? 'true' : 'false';\n    default:\n      return '';\n  }\n}\n\nfunction summarizeObjectValue(value: any, options: Record<string, any>): string {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  if (Array.isArray(value)) {\n    return summarizeArrayValue(value, options);\n  }\n  if (typeof value !== 'object') {\n    return String(value);\n  }\n\n  const displayKeys = normalizeDisplayKeys(options);\n  const keys = [...displayKeys, ...DEFAULT_OBJECT_LABEL_KEYS];\n  const seen = new Set<string>();\n  for (const key of keys) {\n    if (seen.has(key)) continue;\n    seen.add(key);\n    const candidate = objectValueByPath(value as Record<string, any>, key);\n    const summary = scalarSummary(candidate);\n    if (summary) {\n      return summary;\n    }\n  }\n\n  return compactJSON(value);\n}\n\nfunction summarizeArrayValue(value: any[], options: Record<string, any>): string {\n  if (!Array.isArray(value) || value.length === 0) {\n    return '';\n  }\n  const normalized = value\n    .map(item => summarizeObjectValue(item, options).trim())\n    .filter(Boolean);\n  if (normalized.length === 0) {\n    return '';\n  }\n  const rawLimit = Number(options.preview_limit ?? options.previewLimit ?? 3);\n  const limit = Number.isFinite(rawLimit) && rawLimit > 0 ? Math.floor(rawLimit) : 3;\n  const preview = normalized.slice(0, limit);\n  if (normalized.length <= limit) {\n    return preview.join(', ');\n  }\n  return `${preview.join(', ')} +${normalized.length - limit} more`;\n}\n\n// ---------------------------------------------------------------------------\n// blocks_chips helper functions\n// ---------------------------------------------------------------------------\n\n/**\n * Normalizes a number option from renderer_options, checking both snake_case and camelCase keys.\n */\nfunction normalizeNumberOption(\n  options: Record<string, any>,\n  snakeKey: string,\n  camelKey: string,\n  defaultValue: number\n): number {\n  const raw = options[snakeKey] ?? options[camelKey] ?? defaultValue;\n  const parsed = Number(raw);\n  return Number.isFinite(parsed) && parsed > 0 ? Math.floor(parsed) : defaultValue;\n}\n\n/**\n * Normalizes a boolean option from renderer_options, checking both snake_case and camelCase keys.\n */\nfunction normalizeBooleanOption(\n  options: Record<string, any>,\n  snakeKey: string,\n  camelKey: string,\n  defaultValue: boolean\n): boolean {\n  const raw = options[snakeKey] ?? options[camelKey];\n  if (raw === undefined || raw === null) {\n    return defaultValue;\n  }\n  if (typeof raw === 'boolean') {\n    return raw;\n  }\n  if (typeof raw === 'string') {\n    return raw.toLowerCase() === 'true' || raw === '1';\n  }\n  return Boolean(raw);\n}\n\n/**\n * Normalizes a string option from renderer_options, checking both snake_case and camelCase keys.\n */\nfunction normalizeStringOption(\n  options: Record<string, any>,\n  snakeKey: string,\n  camelKey: string,\n  defaultValue: string\n): string {\n  const raw = options[snakeKey] ?? options[camelKey];\n  if (raw === undefined || raw === null) {\n    return defaultValue;\n  }\n  const str = String(raw).trim();\n  return str || defaultValue;\n}\n\n/**\n * Block label resolution order: _type, type, blockType, block_type, then string value fallback.\n */\nfunction resolveBlockLabel(item: any): string {\n  if (item === null || item === undefined) {\n    return '';\n  }\n  // Legacy string array support\n  if (typeof item === 'string') {\n    return item.trim();\n  }\n  if (typeof item !== 'object') {\n    return String(item).trim();\n  }\n  // Embedded objects: check type keys in order\n  const typeKeys = ['_type', 'type', 'blockType', 'block_type'];\n  for (const key of typeKeys) {\n    const val = item[key];\n    if (typeof val === 'string' && val.trim()) {\n      return val.trim();\n    }\n  }\n  return '';\n}\n\n/**\n * Returns Tailwind classes for chip variant styling.\n */\nfunction blocksChipVariantClass(variant: string): string {\n  switch (variant) {\n    case 'muted':\n      return 'bg-gray-100 text-gray-600';\n    case 'outline':\n      return 'bg-white border border-gray-300 text-gray-700';\n    case 'default':\n    default:\n      return 'bg-blue-50 text-blue-700';\n  }\n}\n\nexport class CellRendererRegistry {\n  private renderers: Map<string, CellRenderer> = new Map();\n\n  constructor() {\n    this.registerDefaultRenderers();\n  }\n\n  /**\n   * Register a custom renderer for a column\n   */\n  register(column: string, renderer: CellRenderer): void {\n    this.renderers.set(column, renderer);\n  }\n\n  /**\n   * Get renderer for a column (fallback to default)\n   */\n  get(column: string): CellRenderer {\n    return this.renderers.get(column) || this.defaultRenderer;\n  }\n\n  /**\n   * Check if a custom renderer exists\n   */\n  has(column: string): boolean {\n    return this.renderers.has(column);\n  }\n\n  /**\n   * Default renderer - just returns the value as string\n   */\n  private defaultRenderer: CellRenderer = (value: any): string => {\n    if (value === null || value === undefined) {\n      return EMPTY_CELL_HTML;\n    }\n    if (typeof value === 'boolean') {\n      return value ? 'Yes' : 'No';\n    }\n    if (Array.isArray(value)) {\n      const summary = summarizeArrayValue(value, {});\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    }\n    if (typeof value === 'object') {\n      const summary = summarizeObjectValue(value, {});\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    }\n    return String(value);\n  };\n\n  /**\n   * Register built-in renderers\n   */\n  private registerDefaultRenderers(): void {\n    // Status badge renderer\n    this.renderers.set('_badge', (value: any): string => {\n      const variant = String(value).toLowerCase();\n      return badge(String(value), 'status', variant);\n    });\n\n    // Date/time renderer\n    this.renderers.set('_date', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      try {\n        const date = new Date(value);\n        return date.toLocaleDateString();\n      } catch {\n        return String(value);\n      }\n    });\n\n    // DateTime renderer\n    this.renderers.set('_datetime', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      try {\n        const date = new Date(value);\n        return date.toLocaleString();\n      } catch {\n        return String(value);\n      }\n    });\n\n    // Boolean renderer\n    this.renderers.set('_boolean', (value: any): string => {\n      const isTrue = Boolean(value);\n      const icon = isTrue\n        ? '<svg class=\"w-5 h-5 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/></svg>'\n        : '<svg class=\"w-5 h-5 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clip-rule=\"evenodd\"/></svg>';\n      return `<div class=\"flex justify-center\">${icon}</div>`;\n    });\n\n    // Link renderer\n    this.renderers.set('_link', (value: any, record: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      const href = record.url || record.link || '#';\n      return `<a href=\"${href}\" class=\"text-blue-600 hover:text-blue-800 underline\">${value}</a>`;\n    });\n\n    // Email renderer\n    this.renderers.set('_email', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      return `<a href=\"mailto:${value}\" class=\"text-blue-600 hover:text-blue-800\">${value}</a>`;\n    });\n\n    // URL renderer\n    this.renderers.set('_url', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      return `<a href=\"${value}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1\">\n        ${value}\n        <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n        </svg>\n      </a>`;\n    });\n\n    // Number formatter\n    this.renderers.set('_number', (value: any): string => {\n      if (value === null || value === undefined) return '<span class=\"text-gray-400\">-</span>';\n      return Number(value).toLocaleString();\n    });\n\n    // Currency formatter\n    this.renderers.set('_currency', (value: any): string => {\n      if (value === null || value === undefined) return '<span class=\"text-gray-400\">-</span>';\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD'\n      }).format(Number(value));\n    });\n\n    // Percentage formatter\n    this.renderers.set('_percentage', (value: any): string => {\n      if (value === null || value === undefined) return '<span class=\"text-gray-400\">-</span>';\n      return `${Number(value).toFixed(2)}%`;\n    });\n\n    // File size formatter\n    this.renderers.set('_filesize', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      const bytes = Number(value);\n      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n      if (bytes === 0) return '0 Bytes';\n      const i = Math.floor(Math.log(bytes) / Math.log(1024));\n      return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;\n    });\n\n    // Truncate text renderer\n    this.renderers.set('_truncate', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      const text = String(value);\n      const maxLength = 50;\n      if (text.length <= maxLength) return text;\n      return `<span title=\"${text}\">${text.substring(0, maxLength)}...</span>`;\n    });\n\n    // Array renderer (supports scalar and object arrays)\n    this.renderers.set('_array', (value: any, _record: any, _column: string, context?: CellRendererContext): string => {\n      if (!Array.isArray(value) || value.length === 0) {\n        return EMPTY_CELL_HTML;\n      }\n      const options = context?.options || {};\n      const summary = summarizeArrayValue(value, options);\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    });\n\n    // Object renderer with configurable display-key hints\n    this.renderers.set('_object', (value: any, _record: any, _column: string, context?: CellRendererContext): string => {\n      if (value === null || value === undefined) {\n        return EMPTY_CELL_HTML;\n      }\n      const options = context?.options || {};\n      const summary = summarizeObjectValue(value, options);\n      return summary ? escapeHtml(summary) : EMPTY_CELL_HTML;\n    });\n\n    // Tags/badges renderer\n    this.renderers.set('_tags', (value: any): string => {\n      if (!Array.isArray(value) || value.length === 0) {\n        return '<span class=\"text-gray-400\">-</span>';\n      }\n      return value.map(tag =>\n        `<span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mr-1\">${tag}</span>`\n      ).join('');\n    });\n\n    // Blocks chips renderer - displays block items as styled chips with icons\n    this.renderers.set('blocks_chips', (value: any, _record: any, _column: string, context?: CellRendererContext): string => {\n      if (!Array.isArray(value) || value.length === 0) {\n        return EMPTY_CELL_HTML;\n      }\n      const options = context?.options || {};\n      const maxVisible = normalizeNumberOption(options, 'max_visible', 'maxVisible', 3);\n      const showCount = normalizeBooleanOption(options, 'show_count', 'showCount', true);\n      const chipVariant = normalizeStringOption(options, 'chip_variant', 'chipVariant', 'default');\n      const iconMap: Record<string, string> = options.block_icons_map || options.blockIconsMap || {};\n\n      const chips: string[] = [];\n      const visibleItems = value.slice(0, maxVisible);\n\n      for (const item of visibleItems) {\n        const label = resolveBlockLabel(item);\n        if (!label) continue;\n        const iconRef = iconMap[label] || 'view-grid';\n        const iconHtml = renderIcon(iconRef, { size: '14px', extraClass: 'flex-shrink-0' });\n        const variantClass = blocksChipVariantClass(chipVariant);\n        chips.push(\n          `<span class=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${variantClass}\">${iconHtml}<span>${escapeHtml(label)}</span></span>`\n        );\n      }\n\n      if (chips.length === 0) {\n        return EMPTY_CELL_HTML;\n      }\n\n      const remaining = value.length - maxVisible;\n      let overflowBadge = '';\n      if (showCount && remaining > 0) {\n        overflowBadge = `<span class=\"px-2 py-0.5 rounded text-xs bg-gray-200 text-gray-600\">+${remaining} more</span>`;\n      }\n\n      return `<div class=\"flex flex-wrap gap-1\">${chips.join('')}${overflowBadge}</div>`;\n    });\n\n    // Image thumbnail renderer\n    this.renderers.set('_image', (value: any): string => {\n      if (!value) return '<span class=\"text-gray-400\">-</span>';\n      return `<img src=\"${value}\" alt=\"Thumbnail\" class=\"h-10 w-10 rounded object-cover\" />`;\n    });\n\n    // Avatar renderer\n    this.renderers.set('_avatar', (value: any, record: any): string => {\n      const name = record.name || record.username || record.email || 'U';\n      const initial = name.charAt(0).toUpperCase();\n      if (value) {\n        return `<img src=\"${value}\" alt=\"${name}\" class=\"h-8 w-8 rounded-full object-cover\" />`;\n      }\n      return `<div class=\"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium text-sm\">${initial}</div>`;\n    });\n  }\n}\n\n/**\n * Pre-built cell renderers for common use cases\n */\nexport const CommonRenderers = {\n  /**\n   * Status badge renderer with custom colors\n   */\n  statusBadge: (_colorMap?: Record<string, string>): CellRenderer => {\n    return (value: any): string => {\n      const variant = String(value).toLowerCase();\n      return badge(String(value), 'status', variant);\n    };\n  },\n\n  /**\n   * Role badge renderer with color mapping\n   */\n  roleBadge: (_colorMap?: Record<string, string>): CellRenderer => {\n    return (value: any): string => {\n      const role = String(value).toLowerCase();\n      return badge(String(value), 'role', role);\n    };\n  },\n\n  /**\n   * Combined name+email renderer\n   */\n  userInfo: (value: any, record: any): string => {\n    const name = value || record.name || record.username || '-';\n    const email = record.email || '';\n    if (email) {\n      return `<div><div class=\"font-medium text-gray-900\">${name}</div><div class=\"text-sm text-gray-500\">${email}</div></div>`;\n    }\n    return `<div class=\"font-medium text-gray-900\">${name}</div>`;\n  },\n\n  /**\n   * Boolean chip renderer with icon + label (e.g., [ Yes] or [ No])\n   */\n  booleanChip: (options?: { trueLabel?: string; falseLabel?: string }): CellRenderer => {\n    return (value: any): string => {\n      return sharedBooleanChip(Boolean(value), options);\n    };\n  },\n\n  /**\n   * Relative time renderer (e.g., \"2 hours ago\")\n   */\n  relativeTime: (value: any): string => {\n    if (!value) return '<span class=\"text-gray-400\">-</span>';\n    try {\n      const date = new Date(value);\n      const now = new Date();\n      const diffMs = now.getTime() - date.getTime();\n      const diffMins = Math.floor(diffMs / 60000);\n      const diffHours = Math.floor(diffMs / 3600000);\n      const diffDays = Math.floor(diffMs / 86400000);\n\n      if (diffMins < 1) return 'Just now';\n      if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;\n      if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\n      if (diffDays < 30) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\n      return date.toLocaleDateString();\n    } catch {\n      return String(value);\n    }\n  },\n\n  /**\n   * Locale badge renderer - shows current locale with fallback indicator\n   */\n  localeBadge: createLocaleBadgeRenderer(),\n\n  /**\n   * Translation status renderer - shows locale + available locales\n   */\n  translationStatus: createTranslationStatusRenderer(),\n\n  /**\n   * Compact translation status for smaller cells\n   */\n  translationStatusCompact: createTranslationStatusRenderer({ size: 'sm', maxLocales: 2 }),\n};\n","/**!\n * Sortable 1.15.6\n * @author\tRubaXa   <trash@rubaxa.org>\n * @author\towenm    <owen23355@gmail.com>\n * @license MIT\n */\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n  return _typeof(obj);\n}\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar version = \"1.15.6\";\n\nfunction userAgent(pattern) {\n  if (typeof window !== 'undefined' && window.navigator) {\n    return !! /*@__PURE__*/navigator.userAgent.match(pattern);\n  }\n}\nvar IE11OrLess = userAgent(/(?:Trident.*rv[ :]?11\\.|msie|iemobile|Windows Phone)/i);\nvar Edge = userAgent(/Edge/i);\nvar FireFox = userAgent(/firefox/i);\nvar Safari = userAgent(/safari/i) && !userAgent(/chrome/i) && !userAgent(/android/i);\nvar IOS = userAgent(/iP(ad|od|hone)/i);\nvar ChromeForAndroid = userAgent(/chrome/i) && userAgent(/android/i);\n\nvar captureMode = {\n  capture: false,\n  passive: false\n};\nfunction on(el, event, fn) {\n  el.addEventListener(event, fn, !IE11OrLess && captureMode);\n}\nfunction off(el, event, fn) {\n  el.removeEventListener(event, fn, !IE11OrLess && captureMode);\n}\nfunction matches( /**HTMLElement*/el, /**String*/selector) {\n  if (!selector) return;\n  selector[0] === '>' && (selector = selector.substring(1));\n  if (el) {\n    try {\n      if (el.matches) {\n        return el.matches(selector);\n      } else if (el.msMatchesSelector) {\n        return el.msMatchesSelector(selector);\n      } else if (el.webkitMatchesSelector) {\n        return el.webkitMatchesSelector(selector);\n      }\n    } catch (_) {\n      return false;\n    }\n  }\n  return false;\n}\nfunction getParentOrHost(el) {\n  return el.host && el !== document && el.host.nodeType ? el.host : el.parentNode;\n}\nfunction closest( /**HTMLElement*/el, /**String*/selector, /**HTMLElement*/ctx, includeCTX) {\n  if (el) {\n    ctx = ctx || document;\n    do {\n      if (selector != null && (selector[0] === '>' ? el.parentNode === ctx && matches(el, selector) : matches(el, selector)) || includeCTX && el === ctx) {\n        return el;\n      }\n      if (el === ctx) break;\n      /* jshint boss:true */\n    } while (el = getParentOrHost(el));\n  }\n  return null;\n}\nvar R_SPACE = /\\s+/g;\nfunction toggleClass(el, name, state) {\n  if (el && name) {\n    if (el.classList) {\n      el.classList[state ? 'add' : 'remove'](name);\n    } else {\n      var className = (' ' + el.className + ' ').replace(R_SPACE, ' ').replace(' ' + name + ' ', ' ');\n      el.className = (className + (state ? ' ' + name : '')).replace(R_SPACE, ' ');\n    }\n  }\n}\nfunction css(el, prop, val) {\n  var style = el && el.style;\n  if (style) {\n    if (val === void 0) {\n      if (document.defaultView && document.defaultView.getComputedStyle) {\n        val = document.defaultView.getComputedStyle(el, '');\n      } else if (el.currentStyle) {\n        val = el.currentStyle;\n      }\n      return prop === void 0 ? val : val[prop];\n    } else {\n      if (!(prop in style) && prop.indexOf('webkit') === -1) {\n        prop = '-webkit-' + prop;\n      }\n      style[prop] = val + (typeof val === 'string' ? '' : 'px');\n    }\n  }\n}\nfunction matrix(el, selfOnly) {\n  var appliedTransforms = '';\n  if (typeof el === 'string') {\n    appliedTransforms = el;\n  } else {\n    do {\n      var transform = css(el, 'transform');\n      if (transform && transform !== 'none') {\n        appliedTransforms = transform + ' ' + appliedTransforms;\n      }\n      /* jshint boss:true */\n    } while (!selfOnly && (el = el.parentNode));\n  }\n  var matrixFn = window.DOMMatrix || window.WebKitCSSMatrix || window.CSSMatrix || window.MSCSSMatrix;\n  /*jshint -W056 */\n  return matrixFn && new matrixFn(appliedTransforms);\n}\nfunction find(ctx, tagName, iterator) {\n  if (ctx) {\n    var list = ctx.getElementsByTagName(tagName),\n      i = 0,\n      n = list.length;\n    if (iterator) {\n      for (; i < n; i++) {\n        iterator(list[i], i);\n      }\n    }\n    return list;\n  }\n  return [];\n}\nfunction getWindowScrollingElement() {\n  var scrollingElement = document.scrollingElement;\n  if (scrollingElement) {\n    return scrollingElement;\n  } else {\n    return document.documentElement;\n  }\n}\n\n/**\r\n * Returns the \"bounding client rect\" of given element\r\n * @param  {HTMLElement} el                       The element whose boundingClientRect is wanted\r\n * @param  {[Boolean]} relativeToContainingBlock  Whether the rect should be relative to the containing block of (including) the container\r\n * @param  {[Boolean]} relativeToNonStaticParent  Whether the rect should be relative to the relative parent of (including) the contaienr\r\n * @param  {[Boolean]} undoScale                  Whether the container's scale() should be undone\r\n * @param  {[HTMLElement]} container              The parent the element will be placed in\r\n * @return {Object}                               The boundingClientRect of el, with specified adjustments\r\n */\nfunction getRect(el, relativeToContainingBlock, relativeToNonStaticParent, undoScale, container) {\n  if (!el.getBoundingClientRect && el !== window) return;\n  var elRect, top, left, bottom, right, height, width;\n  if (el !== window && el.parentNode && el !== getWindowScrollingElement()) {\n    elRect = el.getBoundingClientRect();\n    top = elRect.top;\n    left = elRect.left;\n    bottom = elRect.bottom;\n    right = elRect.right;\n    height = elRect.height;\n    width = elRect.width;\n  } else {\n    top = 0;\n    left = 0;\n    bottom = window.innerHeight;\n    right = window.innerWidth;\n    height = window.innerHeight;\n    width = window.innerWidth;\n  }\n  if ((relativeToContainingBlock || relativeToNonStaticParent) && el !== window) {\n    // Adjust for translate()\n    container = container || el.parentNode;\n\n    // solves #1123 (see: https://stackoverflow.com/a/37953806/6088312)\n    // Not needed on <= IE11\n    if (!IE11OrLess) {\n      do {\n        if (container && container.getBoundingClientRect && (css(container, 'transform') !== 'none' || relativeToNonStaticParent && css(container, 'position') !== 'static')) {\n          var containerRect = container.getBoundingClientRect();\n\n          // Set relative to edges of padding box of container\n          top -= containerRect.top + parseInt(css(container, 'border-top-width'));\n          left -= containerRect.left + parseInt(css(container, 'border-left-width'));\n          bottom = top + elRect.height;\n          right = left + elRect.width;\n          break;\n        }\n        /* jshint boss:true */\n      } while (container = container.parentNode);\n    }\n  }\n  if (undoScale && el !== window) {\n    // Adjust for scale()\n    var elMatrix = matrix(container || el),\n      scaleX = elMatrix && elMatrix.a,\n      scaleY = elMatrix && elMatrix.d;\n    if (elMatrix) {\n      top /= scaleY;\n      left /= scaleX;\n      width /= scaleX;\n      height /= scaleY;\n      bottom = top + height;\n      right = left + width;\n    }\n  }\n  return {\n    top: top,\n    left: left,\n    bottom: bottom,\n    right: right,\n    width: width,\n    height: height\n  };\n}\n\n/**\r\n * Checks if a side of an element is scrolled past a side of its parents\r\n * @param  {HTMLElement}  el           The element who's side being scrolled out of view is in question\r\n * @param  {String}       elSide       Side of the element in question ('top', 'left', 'right', 'bottom')\r\n * @param  {String}       parentSide   Side of the parent in question ('top', 'left', 'right', 'bottom')\r\n * @return {HTMLElement}               The parent scroll element that the el's side is scrolled past, or null if there is no such element\r\n */\nfunction isScrolledPast(el, elSide, parentSide) {\n  var parent = getParentAutoScrollElement(el, true),\n    elSideVal = getRect(el)[elSide];\n\n  /* jshint boss:true */\n  while (parent) {\n    var parentSideVal = getRect(parent)[parentSide],\n      visible = void 0;\n    if (parentSide === 'top' || parentSide === 'left') {\n      visible = elSideVal >= parentSideVal;\n    } else {\n      visible = elSideVal <= parentSideVal;\n    }\n    if (!visible) return parent;\n    if (parent === getWindowScrollingElement()) break;\n    parent = getParentAutoScrollElement(parent, false);\n  }\n  return false;\n}\n\n/**\r\n * Gets nth child of el, ignoring hidden children, sortable's elements (does not ignore clone if it's visible)\r\n * and non-draggable elements\r\n * @param  {HTMLElement} el       The parent element\r\n * @param  {Number} childNum      The index of the child\r\n * @param  {Object} options       Parent Sortable's options\r\n * @return {HTMLElement}          The child at index childNum, or null if not found\r\n */\nfunction getChild(el, childNum, options, includeDragEl) {\n  var currentChild = 0,\n    i = 0,\n    children = el.children;\n  while (i < children.length) {\n    if (children[i].style.display !== 'none' && children[i] !== Sortable.ghost && (includeDragEl || children[i] !== Sortable.dragged) && closest(children[i], options.draggable, el, false)) {\n      if (currentChild === childNum) {\n        return children[i];\n      }\n      currentChild++;\n    }\n    i++;\n  }\n  return null;\n}\n\n/**\r\n * Gets the last child in the el, ignoring ghostEl or invisible elements (clones)\r\n * @param  {HTMLElement} el       Parent element\r\n * @param  {selector} selector    Any other elements that should be ignored\r\n * @return {HTMLElement}          The last child, ignoring ghostEl\r\n */\nfunction lastChild(el, selector) {\n  var last = el.lastElementChild;\n  while (last && (last === Sortable.ghost || css(last, 'display') === 'none' || selector && !matches(last, selector))) {\n    last = last.previousElementSibling;\n  }\n  return last || null;\n}\n\n/**\r\n * Returns the index of an element within its parent for a selected set of\r\n * elements\r\n * @param  {HTMLElement} el\r\n * @param  {selector} selector\r\n * @return {number}\r\n */\nfunction index(el, selector) {\n  var index = 0;\n  if (!el || !el.parentNode) {\n    return -1;\n  }\n\n  /* jshint boss:true */\n  while (el = el.previousElementSibling) {\n    if (el.nodeName.toUpperCase() !== 'TEMPLATE' && el !== Sortable.clone && (!selector || matches(el, selector))) {\n      index++;\n    }\n  }\n  return index;\n}\n\n/**\r\n * Returns the scroll offset of the given element, added with all the scroll offsets of parent elements.\r\n * The value is returned in real pixels.\r\n * @param  {HTMLElement} el\r\n * @return {Array}             Offsets in the format of [left, top]\r\n */\nfunction getRelativeScrollOffset(el) {\n  var offsetLeft = 0,\n    offsetTop = 0,\n    winScroller = getWindowScrollingElement();\n  if (el) {\n    do {\n      var elMatrix = matrix(el),\n        scaleX = elMatrix.a,\n        scaleY = elMatrix.d;\n      offsetLeft += el.scrollLeft * scaleX;\n      offsetTop += el.scrollTop * scaleY;\n    } while (el !== winScroller && (el = el.parentNode));\n  }\n  return [offsetLeft, offsetTop];\n}\n\n/**\r\n * Returns the index of the object within the given array\r\n * @param  {Array} arr   Array that may or may not hold the object\r\n * @param  {Object} obj  An object that has a key-value pair unique to and identical to a key-value pair in the object you want to find\r\n * @return {Number}      The index of the object in the array, or -1\r\n */\nfunction indexOfObject(arr, obj) {\n  for (var i in arr) {\n    if (!arr.hasOwnProperty(i)) continue;\n    for (var key in obj) {\n      if (obj.hasOwnProperty(key) && obj[key] === arr[i][key]) return Number(i);\n    }\n  }\n  return -1;\n}\nfunction getParentAutoScrollElement(el, includeSelf) {\n  // skip to window\n  if (!el || !el.getBoundingClientRect) return getWindowScrollingElement();\n  var elem = el;\n  var gotSelf = false;\n  do {\n    // we don't need to get elem css if it isn't even overflowing in the first place (performance)\n    if (elem.clientWidth < elem.scrollWidth || elem.clientHeight < elem.scrollHeight) {\n      var elemCSS = css(elem);\n      if (elem.clientWidth < elem.scrollWidth && (elemCSS.overflowX == 'auto' || elemCSS.overflowX == 'scroll') || elem.clientHeight < elem.scrollHeight && (elemCSS.overflowY == 'auto' || elemCSS.overflowY == 'scroll')) {\n        if (!elem.getBoundingClientRect || elem === document.body) return getWindowScrollingElement();\n        if (gotSelf || includeSelf) return elem;\n        gotSelf = true;\n      }\n    }\n    /* jshint boss:true */\n  } while (elem = elem.parentNode);\n  return getWindowScrollingElement();\n}\nfunction extend(dst, src) {\n  if (dst && src) {\n    for (var key in src) {\n      if (src.hasOwnProperty(key)) {\n        dst[key] = src[key];\n      }\n    }\n  }\n  return dst;\n}\nfunction isRectEqual(rect1, rect2) {\n  return Math.round(rect1.top) === Math.round(rect2.top) && Math.round(rect1.left) === Math.round(rect2.left) && Math.round(rect1.height) === Math.round(rect2.height) && Math.round(rect1.width) === Math.round(rect2.width);\n}\nvar _throttleTimeout;\nfunction throttle(callback, ms) {\n  return function () {\n    if (!_throttleTimeout) {\n      var args = arguments,\n        _this = this;\n      if (args.length === 1) {\n        callback.call(_this, args[0]);\n      } else {\n        callback.apply(_this, args);\n      }\n      _throttleTimeout = setTimeout(function () {\n        _throttleTimeout = void 0;\n      }, ms);\n    }\n  };\n}\nfunction cancelThrottle() {\n  clearTimeout(_throttleTimeout);\n  _throttleTimeout = void 0;\n}\nfunction scrollBy(el, x, y) {\n  el.scrollLeft += x;\n  el.scrollTop += y;\n}\nfunction clone(el) {\n  var Polymer = window.Polymer;\n  var $ = window.jQuery || window.Zepto;\n  if (Polymer && Polymer.dom) {\n    return Polymer.dom(el).cloneNode(true);\n  } else if ($) {\n    return $(el).clone(true)[0];\n  } else {\n    return el.cloneNode(true);\n  }\n}\nfunction setRect(el, rect) {\n  css(el, 'position', 'absolute');\n  css(el, 'top', rect.top);\n  css(el, 'left', rect.left);\n  css(el, 'width', rect.width);\n  css(el, 'height', rect.height);\n}\nfunction unsetRect(el) {\n  css(el, 'position', '');\n  css(el, 'top', '');\n  css(el, 'left', '');\n  css(el, 'width', '');\n  css(el, 'height', '');\n}\nfunction getChildContainingRectFromElement(container, options, ghostEl) {\n  var rect = {};\n  Array.from(container.children).forEach(function (child) {\n    var _rect$left, _rect$top, _rect$right, _rect$bottom;\n    if (!closest(child, options.draggable, container, false) || child.animated || child === ghostEl) return;\n    var childRect = getRect(child);\n    rect.left = Math.min((_rect$left = rect.left) !== null && _rect$left !== void 0 ? _rect$left : Infinity, childRect.left);\n    rect.top = Math.min((_rect$top = rect.top) !== null && _rect$top !== void 0 ? _rect$top : Infinity, childRect.top);\n    rect.right = Math.max((_rect$right = rect.right) !== null && _rect$right !== void 0 ? _rect$right : -Infinity, childRect.right);\n    rect.bottom = Math.max((_rect$bottom = rect.bottom) !== null && _rect$bottom !== void 0 ? _rect$bottom : -Infinity, childRect.bottom);\n  });\n  rect.width = rect.right - rect.left;\n  rect.height = rect.bottom - rect.top;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\nvar expando = 'Sortable' + new Date().getTime();\n\nfunction AnimationStateManager() {\n  var animationStates = [],\n    animationCallbackId;\n  return {\n    captureAnimationState: function captureAnimationState() {\n      animationStates = [];\n      if (!this.options.animation) return;\n      var children = [].slice.call(this.el.children);\n      children.forEach(function (child) {\n        if (css(child, 'display') === 'none' || child === Sortable.ghost) return;\n        animationStates.push({\n          target: child,\n          rect: getRect(child)\n        });\n        var fromRect = _objectSpread2({}, animationStates[animationStates.length - 1].rect);\n\n        // If animating: compensate for current animation\n        if (child.thisAnimationDuration) {\n          var childMatrix = matrix(child, true);\n          if (childMatrix) {\n            fromRect.top -= childMatrix.f;\n            fromRect.left -= childMatrix.e;\n          }\n        }\n        child.fromRect = fromRect;\n      });\n    },\n    addAnimationState: function addAnimationState(state) {\n      animationStates.push(state);\n    },\n    removeAnimationState: function removeAnimationState(target) {\n      animationStates.splice(indexOfObject(animationStates, {\n        target: target\n      }), 1);\n    },\n    animateAll: function animateAll(callback) {\n      var _this = this;\n      if (!this.options.animation) {\n        clearTimeout(animationCallbackId);\n        if (typeof callback === 'function') callback();\n        return;\n      }\n      var animating = false,\n        animationTime = 0;\n      animationStates.forEach(function (state) {\n        var time = 0,\n          target = state.target,\n          fromRect = target.fromRect,\n          toRect = getRect(target),\n          prevFromRect = target.prevFromRect,\n          prevToRect = target.prevToRect,\n          animatingRect = state.rect,\n          targetMatrix = matrix(target, true);\n        if (targetMatrix) {\n          // Compensate for current animation\n          toRect.top -= targetMatrix.f;\n          toRect.left -= targetMatrix.e;\n        }\n        target.toRect = toRect;\n        if (target.thisAnimationDuration) {\n          // Could also check if animatingRect is between fromRect and toRect\n          if (isRectEqual(prevFromRect, toRect) && !isRectEqual(fromRect, toRect) &&\n          // Make sure animatingRect is on line between toRect & fromRect\n          (animatingRect.top - toRect.top) / (animatingRect.left - toRect.left) === (fromRect.top - toRect.top) / (fromRect.left - toRect.left)) {\n            // If returning to same place as started from animation and on same axis\n            time = calculateRealTime(animatingRect, prevFromRect, prevToRect, _this.options);\n          }\n        }\n\n        // if fromRect != toRect: animate\n        if (!isRectEqual(toRect, fromRect)) {\n          target.prevFromRect = fromRect;\n          target.prevToRect = toRect;\n          if (!time) {\n            time = _this.options.animation;\n          }\n          _this.animate(target, animatingRect, toRect, time);\n        }\n        if (time) {\n          animating = true;\n          animationTime = Math.max(animationTime, time);\n          clearTimeout(target.animationResetTimer);\n          target.animationResetTimer = setTimeout(function () {\n            target.animationTime = 0;\n            target.prevFromRect = null;\n            target.fromRect = null;\n            target.prevToRect = null;\n            target.thisAnimationDuration = null;\n          }, time);\n          target.thisAnimationDuration = time;\n        }\n      });\n      clearTimeout(animationCallbackId);\n      if (!animating) {\n        if (typeof callback === 'function') callback();\n      } else {\n        animationCallbackId = setTimeout(function () {\n          if (typeof callback === 'function') callback();\n        }, animationTime);\n      }\n      animationStates = [];\n    },\n    animate: function animate(target, currentRect, toRect, duration) {\n      if (duration) {\n        css(target, 'transition', '');\n        css(target, 'transform', '');\n        var elMatrix = matrix(this.el),\n          scaleX = elMatrix && elMatrix.a,\n          scaleY = elMatrix && elMatrix.d,\n          translateX = (currentRect.left - toRect.left) / (scaleX || 1),\n          translateY = (currentRect.top - toRect.top) / (scaleY || 1);\n        target.animatingX = !!translateX;\n        target.animatingY = !!translateY;\n        css(target, 'transform', 'translate3d(' + translateX + 'px,' + translateY + 'px,0)');\n        this.forRepaintDummy = repaint(target); // repaint\n\n        css(target, 'transition', 'transform ' + duration + 'ms' + (this.options.easing ? ' ' + this.options.easing : ''));\n        css(target, 'transform', 'translate3d(0,0,0)');\n        typeof target.animated === 'number' && clearTimeout(target.animated);\n        target.animated = setTimeout(function () {\n          css(target, 'transition', '');\n          css(target, 'transform', '');\n          target.animated = false;\n          target.animatingX = false;\n          target.animatingY = false;\n        }, duration);\n      }\n    }\n  };\n}\nfunction repaint(target) {\n  return target.offsetWidth;\n}\nfunction calculateRealTime(animatingRect, fromRect, toRect, options) {\n  return Math.sqrt(Math.pow(fromRect.top - animatingRect.top, 2) + Math.pow(fromRect.left - animatingRect.left, 2)) / Math.sqrt(Math.pow(fromRect.top - toRect.top, 2) + Math.pow(fromRect.left - toRect.left, 2)) * options.animation;\n}\n\nvar plugins = [];\nvar defaults = {\n  initializeByDefault: true\n};\nvar PluginManager = {\n  mount: function mount(plugin) {\n    // Set default static properties\n    for (var option in defaults) {\n      if (defaults.hasOwnProperty(option) && !(option in plugin)) {\n        plugin[option] = defaults[option];\n      }\n    }\n    plugins.forEach(function (p) {\n      if (p.pluginName === plugin.pluginName) {\n        throw \"Sortable: Cannot mount plugin \".concat(plugin.pluginName, \" more than once\");\n      }\n    });\n    plugins.push(plugin);\n  },\n  pluginEvent: function pluginEvent(eventName, sortable, evt) {\n    var _this = this;\n    this.eventCanceled = false;\n    evt.cancel = function () {\n      _this.eventCanceled = true;\n    };\n    var eventNameGlobal = eventName + 'Global';\n    plugins.forEach(function (plugin) {\n      if (!sortable[plugin.pluginName]) return;\n      // Fire global events if it exists in this sortable\n      if (sortable[plugin.pluginName][eventNameGlobal]) {\n        sortable[plugin.pluginName][eventNameGlobal](_objectSpread2({\n          sortable: sortable\n        }, evt));\n      }\n\n      // Only fire plugin event if plugin is enabled in this sortable,\n      // and plugin has event defined\n      if (sortable.options[plugin.pluginName] && sortable[plugin.pluginName][eventName]) {\n        sortable[plugin.pluginName][eventName](_objectSpread2({\n          sortable: sortable\n        }, evt));\n      }\n    });\n  },\n  initializePlugins: function initializePlugins(sortable, el, defaults, options) {\n    plugins.forEach(function (plugin) {\n      var pluginName = plugin.pluginName;\n      if (!sortable.options[pluginName] && !plugin.initializeByDefault) return;\n      var initialized = new plugin(sortable, el, sortable.options);\n      initialized.sortable = sortable;\n      initialized.options = sortable.options;\n      sortable[pluginName] = initialized;\n\n      // Add default options from plugin\n      _extends(defaults, initialized.defaults);\n    });\n    for (var option in sortable.options) {\n      if (!sortable.options.hasOwnProperty(option)) continue;\n      var modified = this.modifyOption(sortable, option, sortable.options[option]);\n      if (typeof modified !== 'undefined') {\n        sortable.options[option] = modified;\n      }\n    }\n  },\n  getEventProperties: function getEventProperties(name, sortable) {\n    var eventProperties = {};\n    plugins.forEach(function (plugin) {\n      if (typeof plugin.eventProperties !== 'function') return;\n      _extends(eventProperties, plugin.eventProperties.call(sortable[plugin.pluginName], name));\n    });\n    return eventProperties;\n  },\n  modifyOption: function modifyOption(sortable, name, value) {\n    var modifiedValue;\n    plugins.forEach(function (plugin) {\n      // Plugin must exist on the Sortable\n      if (!sortable[plugin.pluginName]) return;\n\n      // If static option listener exists for this option, call in the context of the Sortable's instance of this plugin\n      if (plugin.optionListeners && typeof plugin.optionListeners[name] === 'function') {\n        modifiedValue = plugin.optionListeners[name].call(sortable[plugin.pluginName], value);\n      }\n    });\n    return modifiedValue;\n  }\n};\n\nfunction dispatchEvent(_ref) {\n  var sortable = _ref.sortable,\n    rootEl = _ref.rootEl,\n    name = _ref.name,\n    targetEl = _ref.targetEl,\n    cloneEl = _ref.cloneEl,\n    toEl = _ref.toEl,\n    fromEl = _ref.fromEl,\n    oldIndex = _ref.oldIndex,\n    newIndex = _ref.newIndex,\n    oldDraggableIndex = _ref.oldDraggableIndex,\n    newDraggableIndex = _ref.newDraggableIndex,\n    originalEvent = _ref.originalEvent,\n    putSortable = _ref.putSortable,\n    extraEventProperties = _ref.extraEventProperties;\n  sortable = sortable || rootEl && rootEl[expando];\n  if (!sortable) return;\n  var evt,\n    options = sortable.options,\n    onName = 'on' + name.charAt(0).toUpperCase() + name.substr(1);\n  // Support for new CustomEvent feature\n  if (window.CustomEvent && !IE11OrLess && !Edge) {\n    evt = new CustomEvent(name, {\n      bubbles: true,\n      cancelable: true\n    });\n  } else {\n    evt = document.createEvent('Event');\n    evt.initEvent(name, true, true);\n  }\n  evt.to = toEl || rootEl;\n  evt.from = fromEl || rootEl;\n  evt.item = targetEl || rootEl;\n  evt.clone = cloneEl;\n  evt.oldIndex = oldIndex;\n  evt.newIndex = newIndex;\n  evt.oldDraggableIndex = oldDraggableIndex;\n  evt.newDraggableIndex = newDraggableIndex;\n  evt.originalEvent = originalEvent;\n  evt.pullMode = putSortable ? putSortable.lastPutMode : undefined;\n  var allEventProperties = _objectSpread2(_objectSpread2({}, extraEventProperties), PluginManager.getEventProperties(name, sortable));\n  for (var option in allEventProperties) {\n    evt[option] = allEventProperties[option];\n  }\n  if (rootEl) {\n    rootEl.dispatchEvent(evt);\n  }\n  if (options[onName]) {\n    options[onName].call(sortable, evt);\n  }\n}\n\nvar _excluded = [\"evt\"];\nvar pluginEvent = function pluginEvent(eventName, sortable) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    originalEvent = _ref.evt,\n    data = _objectWithoutProperties(_ref, _excluded);\n  PluginManager.pluginEvent.bind(Sortable)(eventName, sortable, _objectSpread2({\n    dragEl: dragEl,\n    parentEl: parentEl,\n    ghostEl: ghostEl,\n    rootEl: rootEl,\n    nextEl: nextEl,\n    lastDownEl: lastDownEl,\n    cloneEl: cloneEl,\n    cloneHidden: cloneHidden,\n    dragStarted: moved,\n    putSortable: putSortable,\n    activeSortable: Sortable.active,\n    originalEvent: originalEvent,\n    oldIndex: oldIndex,\n    oldDraggableIndex: oldDraggableIndex,\n    newIndex: newIndex,\n    newDraggableIndex: newDraggableIndex,\n    hideGhostForTarget: _hideGhostForTarget,\n    unhideGhostForTarget: _unhideGhostForTarget,\n    cloneNowHidden: function cloneNowHidden() {\n      cloneHidden = true;\n    },\n    cloneNowShown: function cloneNowShown() {\n      cloneHidden = false;\n    },\n    dispatchSortableEvent: function dispatchSortableEvent(name) {\n      _dispatchEvent({\n        sortable: sortable,\n        name: name,\n        originalEvent: originalEvent\n      });\n    }\n  }, data));\n};\nfunction _dispatchEvent(info) {\n  dispatchEvent(_objectSpread2({\n    putSortable: putSortable,\n    cloneEl: cloneEl,\n    targetEl: dragEl,\n    rootEl: rootEl,\n    oldIndex: oldIndex,\n    oldDraggableIndex: oldDraggableIndex,\n    newIndex: newIndex,\n    newDraggableIndex: newDraggableIndex\n  }, info));\n}\nvar dragEl,\n  parentEl,\n  ghostEl,\n  rootEl,\n  nextEl,\n  lastDownEl,\n  cloneEl,\n  cloneHidden,\n  oldIndex,\n  newIndex,\n  oldDraggableIndex,\n  newDraggableIndex,\n  activeGroup,\n  putSortable,\n  awaitingDragStarted = false,\n  ignoreNextClick = false,\n  sortables = [],\n  tapEvt,\n  touchEvt,\n  lastDx,\n  lastDy,\n  tapDistanceLeft,\n  tapDistanceTop,\n  moved,\n  lastTarget,\n  lastDirection,\n  pastFirstInvertThresh = false,\n  isCircumstantialInvert = false,\n  targetMoveDistance,\n  // For positioning ghost absolutely\n  ghostRelativeParent,\n  ghostRelativeParentInitialScroll = [],\n  // (left, top)\n\n  _silent = false,\n  savedInputChecked = [];\n\n/** @const */\nvar documentExists = typeof document !== 'undefined',\n  PositionGhostAbsolutely = IOS,\n  CSSFloatProperty = Edge || IE11OrLess ? 'cssFloat' : 'float',\n  // This will not pass for IE9, because IE9 DnD only works on anchors\n  supportDraggable = documentExists && !ChromeForAndroid && !IOS && 'draggable' in document.createElement('div'),\n  supportCssPointerEvents = function () {\n    if (!documentExists) return;\n    // false when <= IE11\n    if (IE11OrLess) {\n      return false;\n    }\n    var el = document.createElement('x');\n    el.style.cssText = 'pointer-events:auto';\n    return el.style.pointerEvents === 'auto';\n  }(),\n  _detectDirection = function _detectDirection(el, options) {\n    var elCSS = css(el),\n      elWidth = parseInt(elCSS.width) - parseInt(elCSS.paddingLeft) - parseInt(elCSS.paddingRight) - parseInt(elCSS.borderLeftWidth) - parseInt(elCSS.borderRightWidth),\n      child1 = getChild(el, 0, options),\n      child2 = getChild(el, 1, options),\n      firstChildCSS = child1 && css(child1),\n      secondChildCSS = child2 && css(child2),\n      firstChildWidth = firstChildCSS && parseInt(firstChildCSS.marginLeft) + parseInt(firstChildCSS.marginRight) + getRect(child1).width,\n      secondChildWidth = secondChildCSS && parseInt(secondChildCSS.marginLeft) + parseInt(secondChildCSS.marginRight) + getRect(child2).width;\n    if (elCSS.display === 'flex') {\n      return elCSS.flexDirection === 'column' || elCSS.flexDirection === 'column-reverse' ? 'vertical' : 'horizontal';\n    }\n    if (elCSS.display === 'grid') {\n      return elCSS.gridTemplateColumns.split(' ').length <= 1 ? 'vertical' : 'horizontal';\n    }\n    if (child1 && firstChildCSS[\"float\"] && firstChildCSS[\"float\"] !== 'none') {\n      var touchingSideChild2 = firstChildCSS[\"float\"] === 'left' ? 'left' : 'right';\n      return child2 && (secondChildCSS.clear === 'both' || secondChildCSS.clear === touchingSideChild2) ? 'vertical' : 'horizontal';\n    }\n    return child1 && (firstChildCSS.display === 'block' || firstChildCSS.display === 'flex' || firstChildCSS.display === 'table' || firstChildCSS.display === 'grid' || firstChildWidth >= elWidth && elCSS[CSSFloatProperty] === 'none' || child2 && elCSS[CSSFloatProperty] === 'none' && firstChildWidth + secondChildWidth > elWidth) ? 'vertical' : 'horizontal';\n  },\n  _dragElInRowColumn = function _dragElInRowColumn(dragRect, targetRect, vertical) {\n    var dragElS1Opp = vertical ? dragRect.left : dragRect.top,\n      dragElS2Opp = vertical ? dragRect.right : dragRect.bottom,\n      dragElOppLength = vertical ? dragRect.width : dragRect.height,\n      targetS1Opp = vertical ? targetRect.left : targetRect.top,\n      targetS2Opp = vertical ? targetRect.right : targetRect.bottom,\n      targetOppLength = vertical ? targetRect.width : targetRect.height;\n    return dragElS1Opp === targetS1Opp || dragElS2Opp === targetS2Opp || dragElS1Opp + dragElOppLength / 2 === targetS1Opp + targetOppLength / 2;\n  },\n  /**\r\n   * Detects first nearest empty sortable to X and Y position using emptyInsertThreshold.\r\n   * @param  {Number} x      X position\r\n   * @param  {Number} y      Y position\r\n   * @return {HTMLElement}   Element of the first found nearest Sortable\r\n   */\n  _detectNearestEmptySortable = function _detectNearestEmptySortable(x, y) {\n    var ret;\n    sortables.some(function (sortable) {\n      var threshold = sortable[expando].options.emptyInsertThreshold;\n      if (!threshold || lastChild(sortable)) return;\n      var rect = getRect(sortable),\n        insideHorizontally = x >= rect.left - threshold && x <= rect.right + threshold,\n        insideVertically = y >= rect.top - threshold && y <= rect.bottom + threshold;\n      if (insideHorizontally && insideVertically) {\n        return ret = sortable;\n      }\n    });\n    return ret;\n  },\n  _prepareGroup = function _prepareGroup(options) {\n    function toFn(value, pull) {\n      return function (to, from, dragEl, evt) {\n        var sameGroup = to.options.group.name && from.options.group.name && to.options.group.name === from.options.group.name;\n        if (value == null && (pull || sameGroup)) {\n          // Default pull value\n          // Default pull and put value if same group\n          return true;\n        } else if (value == null || value === false) {\n          return false;\n        } else if (pull && value === 'clone') {\n          return value;\n        } else if (typeof value === 'function') {\n          return toFn(value(to, from, dragEl, evt), pull)(to, from, dragEl, evt);\n        } else {\n          var otherGroup = (pull ? to : from).options.group.name;\n          return value === true || typeof value === 'string' && value === otherGroup || value.join && value.indexOf(otherGroup) > -1;\n        }\n      };\n    }\n    var group = {};\n    var originalGroup = options.group;\n    if (!originalGroup || _typeof(originalGroup) != 'object') {\n      originalGroup = {\n        name: originalGroup\n      };\n    }\n    group.name = originalGroup.name;\n    group.checkPull = toFn(originalGroup.pull, true);\n    group.checkPut = toFn(originalGroup.put);\n    group.revertClone = originalGroup.revertClone;\n    options.group = group;\n  },\n  _hideGhostForTarget = function _hideGhostForTarget() {\n    if (!supportCssPointerEvents && ghostEl) {\n      css(ghostEl, 'display', 'none');\n    }\n  },\n  _unhideGhostForTarget = function _unhideGhostForTarget() {\n    if (!supportCssPointerEvents && ghostEl) {\n      css(ghostEl, 'display', '');\n    }\n  };\n\n// #1184 fix - Prevent click event on fallback if dragged but item not changed position\nif (documentExists && !ChromeForAndroid) {\n  document.addEventListener('click', function (evt) {\n    if (ignoreNextClick) {\n      evt.preventDefault();\n      evt.stopPropagation && evt.stopPropagation();\n      evt.stopImmediatePropagation && evt.stopImmediatePropagation();\n      ignoreNextClick = false;\n      return false;\n    }\n  }, true);\n}\nvar nearestEmptyInsertDetectEvent = function nearestEmptyInsertDetectEvent(evt) {\n  if (dragEl) {\n    evt = evt.touches ? evt.touches[0] : evt;\n    var nearest = _detectNearestEmptySortable(evt.clientX, evt.clientY);\n    if (nearest) {\n      // Create imitation event\n      var event = {};\n      for (var i in evt) {\n        if (evt.hasOwnProperty(i)) {\n          event[i] = evt[i];\n        }\n      }\n      event.target = event.rootEl = nearest;\n      event.preventDefault = void 0;\n      event.stopPropagation = void 0;\n      nearest[expando]._onDragOver(event);\n    }\n  }\n};\nvar _checkOutsideTargetEl = function _checkOutsideTargetEl(evt) {\n  if (dragEl) {\n    dragEl.parentNode[expando]._isOutsideThisEl(evt.target);\n  }\n};\n\n/**\r\n * @class  Sortable\r\n * @param  {HTMLElement}  el\r\n * @param  {Object}       [options]\r\n */\nfunction Sortable(el, options) {\n  if (!(el && el.nodeType && el.nodeType === 1)) {\n    throw \"Sortable: `el` must be an HTMLElement, not \".concat({}.toString.call(el));\n  }\n  this.el = el; // root element\n  this.options = options = _extends({}, options);\n\n  // Export instance\n  el[expando] = this;\n  var defaults = {\n    group: null,\n    sort: true,\n    disabled: false,\n    store: null,\n    handle: null,\n    draggable: /^[uo]l$/i.test(el.nodeName) ? '>li' : '>*',\n    swapThreshold: 1,\n    // percentage; 0 <= x <= 1\n    invertSwap: false,\n    // invert always\n    invertedSwapThreshold: null,\n    // will be set to same as swapThreshold if default\n    removeCloneOnHide: true,\n    direction: function direction() {\n      return _detectDirection(el, this.options);\n    },\n    ghostClass: 'sortable-ghost',\n    chosenClass: 'sortable-chosen',\n    dragClass: 'sortable-drag',\n    ignore: 'a, img',\n    filter: null,\n    preventOnFilter: true,\n    animation: 0,\n    easing: null,\n    setData: function setData(dataTransfer, dragEl) {\n      dataTransfer.setData('Text', dragEl.textContent);\n    },\n    dropBubble: false,\n    dragoverBubble: false,\n    dataIdAttr: 'data-id',\n    delay: 0,\n    delayOnTouchOnly: false,\n    touchStartThreshold: (Number.parseInt ? Number : window).parseInt(window.devicePixelRatio, 10) || 1,\n    forceFallback: false,\n    fallbackClass: 'sortable-fallback',\n    fallbackOnBody: false,\n    fallbackTolerance: 0,\n    fallbackOffset: {\n      x: 0,\n      y: 0\n    },\n    // Disabled on Safari: #1571; Enabled on Safari IOS: #2244\n    supportPointer: Sortable.supportPointer !== false && 'PointerEvent' in window && (!Safari || IOS),\n    emptyInsertThreshold: 5\n  };\n  PluginManager.initializePlugins(this, el, defaults);\n\n  // Set default options\n  for (var name in defaults) {\n    !(name in options) && (options[name] = defaults[name]);\n  }\n  _prepareGroup(options);\n\n  // Bind all private methods\n  for (var fn in this) {\n    if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {\n      this[fn] = this[fn].bind(this);\n    }\n  }\n\n  // Setup drag mode\n  this.nativeDraggable = options.forceFallback ? false : supportDraggable;\n  if (this.nativeDraggable) {\n    // Touch start threshold cannot be greater than the native dragstart threshold\n    this.options.touchStartThreshold = 1;\n  }\n\n  // Bind events\n  if (options.supportPointer) {\n    on(el, 'pointerdown', this._onTapStart);\n  } else {\n    on(el, 'mousedown', this._onTapStart);\n    on(el, 'touchstart', this._onTapStart);\n  }\n  if (this.nativeDraggable) {\n    on(el, 'dragover', this);\n    on(el, 'dragenter', this);\n  }\n  sortables.push(this.el);\n\n  // Restore sorting\n  options.store && options.store.get && this.sort(options.store.get(this) || []);\n\n  // Add animation state manager\n  _extends(this, AnimationStateManager());\n}\nSortable.prototype = /** @lends Sortable.prototype */{\n  constructor: Sortable,\n  _isOutsideThisEl: function _isOutsideThisEl(target) {\n    if (!this.el.contains(target) && target !== this.el) {\n      lastTarget = null;\n    }\n  },\n  _getDirection: function _getDirection(evt, target) {\n    return typeof this.options.direction === 'function' ? this.options.direction.call(this, evt, target, dragEl) : this.options.direction;\n  },\n  _onTapStart: function _onTapStart( /** Event|TouchEvent */evt) {\n    if (!evt.cancelable) return;\n    var _this = this,\n      el = this.el,\n      options = this.options,\n      preventOnFilter = options.preventOnFilter,\n      type = evt.type,\n      touch = evt.touches && evt.touches[0] || evt.pointerType && evt.pointerType === 'touch' && evt,\n      target = (touch || evt).target,\n      originalTarget = evt.target.shadowRoot && (evt.path && evt.path[0] || evt.composedPath && evt.composedPath()[0]) || target,\n      filter = options.filter;\n    _saveInputCheckedState(el);\n\n    // Don't trigger start event when an element is been dragged, otherwise the evt.oldindex always wrong when set option.group.\n    if (dragEl) {\n      return;\n    }\n    if (/mousedown|pointerdown/.test(type) && evt.button !== 0 || options.disabled) {\n      return; // only left button and enabled\n    }\n\n    // cancel dnd if original target is content editable\n    if (originalTarget.isContentEditable) {\n      return;\n    }\n\n    // Safari ignores further event handling after mousedown\n    if (!this.nativeDraggable && Safari && target && target.tagName.toUpperCase() === 'SELECT') {\n      return;\n    }\n    target = closest(target, options.draggable, el, false);\n    if (target && target.animated) {\n      return;\n    }\n    if (lastDownEl === target) {\n      // Ignoring duplicate `down`\n      return;\n    }\n\n    // Get the index of the dragged element within its parent\n    oldIndex = index(target);\n    oldDraggableIndex = index(target, options.draggable);\n\n    // Check filter\n    if (typeof filter === 'function') {\n      if (filter.call(this, evt, target, this)) {\n        _dispatchEvent({\n          sortable: _this,\n          rootEl: originalTarget,\n          name: 'filter',\n          targetEl: target,\n          toEl: el,\n          fromEl: el\n        });\n        pluginEvent('filter', _this, {\n          evt: evt\n        });\n        preventOnFilter && evt.preventDefault();\n        return; // cancel dnd\n      }\n    } else if (filter) {\n      filter = filter.split(',').some(function (criteria) {\n        criteria = closest(originalTarget, criteria.trim(), el, false);\n        if (criteria) {\n          _dispatchEvent({\n            sortable: _this,\n            rootEl: criteria,\n            name: 'filter',\n            targetEl: target,\n            fromEl: el,\n            toEl: el\n          });\n          pluginEvent('filter', _this, {\n            evt: evt\n          });\n          return true;\n        }\n      });\n      if (filter) {\n        preventOnFilter && evt.preventDefault();\n        return; // cancel dnd\n      }\n    }\n    if (options.handle && !closest(originalTarget, options.handle, el, false)) {\n      return;\n    }\n\n    // Prepare `dragstart`\n    this._prepareDragStart(evt, touch, target);\n  },\n  _prepareDragStart: function _prepareDragStart( /** Event */evt, /** Touch */touch, /** HTMLElement */target) {\n    var _this = this,\n      el = _this.el,\n      options = _this.options,\n      ownerDocument = el.ownerDocument,\n      dragStartFn;\n    if (target && !dragEl && target.parentNode === el) {\n      var dragRect = getRect(target);\n      rootEl = el;\n      dragEl = target;\n      parentEl = dragEl.parentNode;\n      nextEl = dragEl.nextSibling;\n      lastDownEl = target;\n      activeGroup = options.group;\n      Sortable.dragged = dragEl;\n      tapEvt = {\n        target: dragEl,\n        clientX: (touch || evt).clientX,\n        clientY: (touch || evt).clientY\n      };\n      tapDistanceLeft = tapEvt.clientX - dragRect.left;\n      tapDistanceTop = tapEvt.clientY - dragRect.top;\n      this._lastX = (touch || evt).clientX;\n      this._lastY = (touch || evt).clientY;\n      dragEl.style['will-change'] = 'all';\n      dragStartFn = function dragStartFn() {\n        pluginEvent('delayEnded', _this, {\n          evt: evt\n        });\n        if (Sortable.eventCanceled) {\n          _this._onDrop();\n          return;\n        }\n        // Delayed drag has been triggered\n        // we can re-enable the events: touchmove/mousemove\n        _this._disableDelayedDragEvents();\n        if (!FireFox && _this.nativeDraggable) {\n          dragEl.draggable = true;\n        }\n\n        // Bind the events: dragstart/dragend\n        _this._triggerDragStart(evt, touch);\n\n        // Drag start event\n        _dispatchEvent({\n          sortable: _this,\n          name: 'choose',\n          originalEvent: evt\n        });\n\n        // Chosen item\n        toggleClass(dragEl, options.chosenClass, true);\n      };\n\n      // Disable \"draggable\"\n      options.ignore.split(',').forEach(function (criteria) {\n        find(dragEl, criteria.trim(), _disableDraggable);\n      });\n      on(ownerDocument, 'dragover', nearestEmptyInsertDetectEvent);\n      on(ownerDocument, 'mousemove', nearestEmptyInsertDetectEvent);\n      on(ownerDocument, 'touchmove', nearestEmptyInsertDetectEvent);\n      if (options.supportPointer) {\n        on(ownerDocument, 'pointerup', _this._onDrop);\n        // Native D&D triggers pointercancel\n        !this.nativeDraggable && on(ownerDocument, 'pointercancel', _this._onDrop);\n      } else {\n        on(ownerDocument, 'mouseup', _this._onDrop);\n        on(ownerDocument, 'touchend', _this._onDrop);\n        on(ownerDocument, 'touchcancel', _this._onDrop);\n      }\n\n      // Make dragEl draggable (must be before delay for FireFox)\n      if (FireFox && this.nativeDraggable) {\n        this.options.touchStartThreshold = 4;\n        dragEl.draggable = true;\n      }\n      pluginEvent('delayStart', this, {\n        evt: evt\n      });\n\n      // Delay is impossible for native DnD in Edge or IE\n      if (options.delay && (!options.delayOnTouchOnly || touch) && (!this.nativeDraggable || !(Edge || IE11OrLess))) {\n        if (Sortable.eventCanceled) {\n          this._onDrop();\n          return;\n        }\n        // If the user moves the pointer or let go the click or touch\n        // before the delay has been reached:\n        // disable the delayed drag\n        if (options.supportPointer) {\n          on(ownerDocument, 'pointerup', _this._disableDelayedDrag);\n          on(ownerDocument, 'pointercancel', _this._disableDelayedDrag);\n        } else {\n          on(ownerDocument, 'mouseup', _this._disableDelayedDrag);\n          on(ownerDocument, 'touchend', _this._disableDelayedDrag);\n          on(ownerDocument, 'touchcancel', _this._disableDelayedDrag);\n        }\n        on(ownerDocument, 'mousemove', _this._delayedDragTouchMoveHandler);\n        on(ownerDocument, 'touchmove', _this._delayedDragTouchMoveHandler);\n        options.supportPointer && on(ownerDocument, 'pointermove', _this._delayedDragTouchMoveHandler);\n        _this._dragStartTimer = setTimeout(dragStartFn, options.delay);\n      } else {\n        dragStartFn();\n      }\n    }\n  },\n  _delayedDragTouchMoveHandler: function _delayedDragTouchMoveHandler( /** TouchEvent|PointerEvent **/e) {\n    var touch = e.touches ? e.touches[0] : e;\n    if (Math.max(Math.abs(touch.clientX - this._lastX), Math.abs(touch.clientY - this._lastY)) >= Math.floor(this.options.touchStartThreshold / (this.nativeDraggable && window.devicePixelRatio || 1))) {\n      this._disableDelayedDrag();\n    }\n  },\n  _disableDelayedDrag: function _disableDelayedDrag() {\n    dragEl && _disableDraggable(dragEl);\n    clearTimeout(this._dragStartTimer);\n    this._disableDelayedDragEvents();\n  },\n  _disableDelayedDragEvents: function _disableDelayedDragEvents() {\n    var ownerDocument = this.el.ownerDocument;\n    off(ownerDocument, 'mouseup', this._disableDelayedDrag);\n    off(ownerDocument, 'touchend', this._disableDelayedDrag);\n    off(ownerDocument, 'touchcancel', this._disableDelayedDrag);\n    off(ownerDocument, 'pointerup', this._disableDelayedDrag);\n    off(ownerDocument, 'pointercancel', this._disableDelayedDrag);\n    off(ownerDocument, 'mousemove', this._delayedDragTouchMoveHandler);\n    off(ownerDocument, 'touchmove', this._delayedDragTouchMoveHandler);\n    off(ownerDocument, 'pointermove', this._delayedDragTouchMoveHandler);\n  },\n  _triggerDragStart: function _triggerDragStart( /** Event */evt, /** Touch */touch) {\n    touch = touch || evt.pointerType == 'touch' && evt;\n    if (!this.nativeDraggable || touch) {\n      if (this.options.supportPointer) {\n        on(document, 'pointermove', this._onTouchMove);\n      } else if (touch) {\n        on(document, 'touchmove', this._onTouchMove);\n      } else {\n        on(document, 'mousemove', this._onTouchMove);\n      }\n    } else {\n      on(dragEl, 'dragend', this);\n      on(rootEl, 'dragstart', this._onDragStart);\n    }\n    try {\n      if (document.selection) {\n        _nextTick(function () {\n          document.selection.empty();\n        });\n      } else {\n        window.getSelection().removeAllRanges();\n      }\n    } catch (err) {}\n  },\n  _dragStarted: function _dragStarted(fallback, evt) {\n    awaitingDragStarted = false;\n    if (rootEl && dragEl) {\n      pluginEvent('dragStarted', this, {\n        evt: evt\n      });\n      if (this.nativeDraggable) {\n        on(document, 'dragover', _checkOutsideTargetEl);\n      }\n      var options = this.options;\n\n      // Apply effect\n      !fallback && toggleClass(dragEl, options.dragClass, false);\n      toggleClass(dragEl, options.ghostClass, true);\n      Sortable.active = this;\n      fallback && this._appendGhost();\n\n      // Drag start event\n      _dispatchEvent({\n        sortable: this,\n        name: 'start',\n        originalEvent: evt\n      });\n    } else {\n      this._nulling();\n    }\n  },\n  _emulateDragOver: function _emulateDragOver() {\n    if (touchEvt) {\n      this._lastX = touchEvt.clientX;\n      this._lastY = touchEvt.clientY;\n      _hideGhostForTarget();\n      var target = document.elementFromPoint(touchEvt.clientX, touchEvt.clientY);\n      var parent = target;\n      while (target && target.shadowRoot) {\n        target = target.shadowRoot.elementFromPoint(touchEvt.clientX, touchEvt.clientY);\n        if (target === parent) break;\n        parent = target;\n      }\n      dragEl.parentNode[expando]._isOutsideThisEl(target);\n      if (parent) {\n        do {\n          if (parent[expando]) {\n            var inserted = void 0;\n            inserted = parent[expando]._onDragOver({\n              clientX: touchEvt.clientX,\n              clientY: touchEvt.clientY,\n              target: target,\n              rootEl: parent\n            });\n            if (inserted && !this.options.dragoverBubble) {\n              break;\n            }\n          }\n          target = parent; // store last element\n        }\n        /* jshint boss:true */ while (parent = getParentOrHost(parent));\n      }\n      _unhideGhostForTarget();\n    }\n  },\n  _onTouchMove: function _onTouchMove( /**TouchEvent*/evt) {\n    if (tapEvt) {\n      var options = this.options,\n        fallbackTolerance = options.fallbackTolerance,\n        fallbackOffset = options.fallbackOffset,\n        touch = evt.touches ? evt.touches[0] : evt,\n        ghostMatrix = ghostEl && matrix(ghostEl, true),\n        scaleX = ghostEl && ghostMatrix && ghostMatrix.a,\n        scaleY = ghostEl && ghostMatrix && ghostMatrix.d,\n        relativeScrollOffset = PositionGhostAbsolutely && ghostRelativeParent && getRelativeScrollOffset(ghostRelativeParent),\n        dx = (touch.clientX - tapEvt.clientX + fallbackOffset.x) / (scaleX || 1) + (relativeScrollOffset ? relativeScrollOffset[0] - ghostRelativeParentInitialScroll[0] : 0) / (scaleX || 1),\n        dy = (touch.clientY - tapEvt.clientY + fallbackOffset.y) / (scaleY || 1) + (relativeScrollOffset ? relativeScrollOffset[1] - ghostRelativeParentInitialScroll[1] : 0) / (scaleY || 1);\n\n      // only set the status to dragging, when we are actually dragging\n      if (!Sortable.active && !awaitingDragStarted) {\n        if (fallbackTolerance && Math.max(Math.abs(touch.clientX - this._lastX), Math.abs(touch.clientY - this._lastY)) < fallbackTolerance) {\n          return;\n        }\n        this._onDragStart(evt, true);\n      }\n      if (ghostEl) {\n        if (ghostMatrix) {\n          ghostMatrix.e += dx - (lastDx || 0);\n          ghostMatrix.f += dy - (lastDy || 0);\n        } else {\n          ghostMatrix = {\n            a: 1,\n            b: 0,\n            c: 0,\n            d: 1,\n            e: dx,\n            f: dy\n          };\n        }\n        var cssMatrix = \"matrix(\".concat(ghostMatrix.a, \",\").concat(ghostMatrix.b, \",\").concat(ghostMatrix.c, \",\").concat(ghostMatrix.d, \",\").concat(ghostMatrix.e, \",\").concat(ghostMatrix.f, \")\");\n        css(ghostEl, 'webkitTransform', cssMatrix);\n        css(ghostEl, 'mozTransform', cssMatrix);\n        css(ghostEl, 'msTransform', cssMatrix);\n        css(ghostEl, 'transform', cssMatrix);\n        lastDx = dx;\n        lastDy = dy;\n        touchEvt = touch;\n      }\n      evt.cancelable && evt.preventDefault();\n    }\n  },\n  _appendGhost: function _appendGhost() {\n    // Bug if using scale(): https://stackoverflow.com/questions/2637058\n    // Not being adjusted for\n    if (!ghostEl) {\n      var container = this.options.fallbackOnBody ? document.body : rootEl,\n        rect = getRect(dragEl, true, PositionGhostAbsolutely, true, container),\n        options = this.options;\n\n      // Position absolutely\n      if (PositionGhostAbsolutely) {\n        // Get relatively positioned parent\n        ghostRelativeParent = container;\n        while (css(ghostRelativeParent, 'position') === 'static' && css(ghostRelativeParent, 'transform') === 'none' && ghostRelativeParent !== document) {\n          ghostRelativeParent = ghostRelativeParent.parentNode;\n        }\n        if (ghostRelativeParent !== document.body && ghostRelativeParent !== document.documentElement) {\n          if (ghostRelativeParent === document) ghostRelativeParent = getWindowScrollingElement();\n          rect.top += ghostRelativeParent.scrollTop;\n          rect.left += ghostRelativeParent.scrollLeft;\n        } else {\n          ghostRelativeParent = getWindowScrollingElement();\n        }\n        ghostRelativeParentInitialScroll = getRelativeScrollOffset(ghostRelativeParent);\n      }\n      ghostEl = dragEl.cloneNode(true);\n      toggleClass(ghostEl, options.ghostClass, false);\n      toggleClass(ghostEl, options.fallbackClass, true);\n      toggleClass(ghostEl, options.dragClass, true);\n      css(ghostEl, 'transition', '');\n      css(ghostEl, 'transform', '');\n      css(ghostEl, 'box-sizing', 'border-box');\n      css(ghostEl, 'margin', 0);\n      css(ghostEl, 'top', rect.top);\n      css(ghostEl, 'left', rect.left);\n      css(ghostEl, 'width', rect.width);\n      css(ghostEl, 'height', rect.height);\n      css(ghostEl, 'opacity', '0.8');\n      css(ghostEl, 'position', PositionGhostAbsolutely ? 'absolute' : 'fixed');\n      css(ghostEl, 'zIndex', '100000');\n      css(ghostEl, 'pointerEvents', 'none');\n      Sortable.ghost = ghostEl;\n      container.appendChild(ghostEl);\n\n      // Set transform-origin\n      css(ghostEl, 'transform-origin', tapDistanceLeft / parseInt(ghostEl.style.width) * 100 + '% ' + tapDistanceTop / parseInt(ghostEl.style.height) * 100 + '%');\n    }\n  },\n  _onDragStart: function _onDragStart( /**Event*/evt, /**boolean*/fallback) {\n    var _this = this;\n    var dataTransfer = evt.dataTransfer;\n    var options = _this.options;\n    pluginEvent('dragStart', this, {\n      evt: evt\n    });\n    if (Sortable.eventCanceled) {\n      this._onDrop();\n      return;\n    }\n    pluginEvent('setupClone', this);\n    if (!Sortable.eventCanceled) {\n      cloneEl = clone(dragEl);\n      cloneEl.removeAttribute(\"id\");\n      cloneEl.draggable = false;\n      cloneEl.style['will-change'] = '';\n      this._hideClone();\n      toggleClass(cloneEl, this.options.chosenClass, false);\n      Sortable.clone = cloneEl;\n    }\n\n    // #1143: IFrame support workaround\n    _this.cloneId = _nextTick(function () {\n      pluginEvent('clone', _this);\n      if (Sortable.eventCanceled) return;\n      if (!_this.options.removeCloneOnHide) {\n        rootEl.insertBefore(cloneEl, dragEl);\n      }\n      _this._hideClone();\n      _dispatchEvent({\n        sortable: _this,\n        name: 'clone'\n      });\n    });\n    !fallback && toggleClass(dragEl, options.dragClass, true);\n\n    // Set proper drop events\n    if (fallback) {\n      ignoreNextClick = true;\n      _this._loopId = setInterval(_this._emulateDragOver, 50);\n    } else {\n      // Undo what was set in _prepareDragStart before drag started\n      off(document, 'mouseup', _this._onDrop);\n      off(document, 'touchend', _this._onDrop);\n      off(document, 'touchcancel', _this._onDrop);\n      if (dataTransfer) {\n        dataTransfer.effectAllowed = 'move';\n        options.setData && options.setData.call(_this, dataTransfer, dragEl);\n      }\n      on(document, 'drop', _this);\n\n      // #1276 fix:\n      css(dragEl, 'transform', 'translateZ(0)');\n    }\n    awaitingDragStarted = true;\n    _this._dragStartId = _nextTick(_this._dragStarted.bind(_this, fallback, evt));\n    on(document, 'selectstart', _this);\n    moved = true;\n    window.getSelection().removeAllRanges();\n    if (Safari) {\n      css(document.body, 'user-select', 'none');\n    }\n  },\n  // Returns true - if no further action is needed (either inserted or another condition)\n  _onDragOver: function _onDragOver( /**Event*/evt) {\n    var el = this.el,\n      target = evt.target,\n      dragRect,\n      targetRect,\n      revert,\n      options = this.options,\n      group = options.group,\n      activeSortable = Sortable.active,\n      isOwner = activeGroup === group,\n      canSort = options.sort,\n      fromSortable = putSortable || activeSortable,\n      vertical,\n      _this = this,\n      completedFired = false;\n    if (_silent) return;\n    function dragOverEvent(name, extra) {\n      pluginEvent(name, _this, _objectSpread2({\n        evt: evt,\n        isOwner: isOwner,\n        axis: vertical ? 'vertical' : 'horizontal',\n        revert: revert,\n        dragRect: dragRect,\n        targetRect: targetRect,\n        canSort: canSort,\n        fromSortable: fromSortable,\n        target: target,\n        completed: completed,\n        onMove: function onMove(target, after) {\n          return _onMove(rootEl, el, dragEl, dragRect, target, getRect(target), evt, after);\n        },\n        changed: changed\n      }, extra));\n    }\n\n    // Capture animation state\n    function capture() {\n      dragOverEvent('dragOverAnimationCapture');\n      _this.captureAnimationState();\n      if (_this !== fromSortable) {\n        fromSortable.captureAnimationState();\n      }\n    }\n\n    // Return invocation when dragEl is inserted (or completed)\n    function completed(insertion) {\n      dragOverEvent('dragOverCompleted', {\n        insertion: insertion\n      });\n      if (insertion) {\n        // Clones must be hidden before folding animation to capture dragRectAbsolute properly\n        if (isOwner) {\n          activeSortable._hideClone();\n        } else {\n          activeSortable._showClone(_this);\n        }\n        if (_this !== fromSortable) {\n          // Set ghost class to new sortable's ghost class\n          toggleClass(dragEl, putSortable ? putSortable.options.ghostClass : activeSortable.options.ghostClass, false);\n          toggleClass(dragEl, options.ghostClass, true);\n        }\n        if (putSortable !== _this && _this !== Sortable.active) {\n          putSortable = _this;\n        } else if (_this === Sortable.active && putSortable) {\n          putSortable = null;\n        }\n\n        // Animation\n        if (fromSortable === _this) {\n          _this._ignoreWhileAnimating = target;\n        }\n        _this.animateAll(function () {\n          dragOverEvent('dragOverAnimationComplete');\n          _this._ignoreWhileAnimating = null;\n        });\n        if (_this !== fromSortable) {\n          fromSortable.animateAll();\n          fromSortable._ignoreWhileAnimating = null;\n        }\n      }\n\n      // Null lastTarget if it is not inside a previously swapped element\n      if (target === dragEl && !dragEl.animated || target === el && !target.animated) {\n        lastTarget = null;\n      }\n\n      // no bubbling and not fallback\n      if (!options.dragoverBubble && !evt.rootEl && target !== document) {\n        dragEl.parentNode[expando]._isOutsideThisEl(evt.target);\n\n        // Do not detect for empty insert if already inserted\n        !insertion && nearestEmptyInsertDetectEvent(evt);\n      }\n      !options.dragoverBubble && evt.stopPropagation && evt.stopPropagation();\n      return completedFired = true;\n    }\n\n    // Call when dragEl has been inserted\n    function changed() {\n      newIndex = index(dragEl);\n      newDraggableIndex = index(dragEl, options.draggable);\n      _dispatchEvent({\n        sortable: _this,\n        name: 'change',\n        toEl: el,\n        newIndex: newIndex,\n        newDraggableIndex: newDraggableIndex,\n        originalEvent: evt\n      });\n    }\n    if (evt.preventDefault !== void 0) {\n      evt.cancelable && evt.preventDefault();\n    }\n    target = closest(target, options.draggable, el, true);\n    dragOverEvent('dragOver');\n    if (Sortable.eventCanceled) return completedFired;\n    if (dragEl.contains(evt.target) || target.animated && target.animatingX && target.animatingY || _this._ignoreWhileAnimating === target) {\n      return completed(false);\n    }\n    ignoreNextClick = false;\n    if (activeSortable && !options.disabled && (isOwner ? canSort || (revert = parentEl !== rootEl) // Reverting item into the original list\n    : putSortable === this || (this.lastPutMode = activeGroup.checkPull(this, activeSortable, dragEl, evt)) && group.checkPut(this, activeSortable, dragEl, evt))) {\n      vertical = this._getDirection(evt, target) === 'vertical';\n      dragRect = getRect(dragEl);\n      dragOverEvent('dragOverValid');\n      if (Sortable.eventCanceled) return completedFired;\n      if (revert) {\n        parentEl = rootEl; // actualization\n        capture();\n        this._hideClone();\n        dragOverEvent('revert');\n        if (!Sortable.eventCanceled) {\n          if (nextEl) {\n            rootEl.insertBefore(dragEl, nextEl);\n          } else {\n            rootEl.appendChild(dragEl);\n          }\n        }\n        return completed(true);\n      }\n      var elLastChild = lastChild(el, options.draggable);\n      if (!elLastChild || _ghostIsLast(evt, vertical, this) && !elLastChild.animated) {\n        // Insert to end of list\n\n        // If already at end of list: Do not insert\n        if (elLastChild === dragEl) {\n          return completed(false);\n        }\n\n        // if there is a last element, it is the target\n        if (elLastChild && el === evt.target) {\n          target = elLastChild;\n        }\n        if (target) {\n          targetRect = getRect(target);\n        }\n        if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, !!target) !== false) {\n          capture();\n          if (elLastChild && elLastChild.nextSibling) {\n            // the last draggable element is not the last node\n            el.insertBefore(dragEl, elLastChild.nextSibling);\n          } else {\n            el.appendChild(dragEl);\n          }\n          parentEl = el; // actualization\n\n          changed();\n          return completed(true);\n        }\n      } else if (elLastChild && _ghostIsFirst(evt, vertical, this)) {\n        // Insert to start of list\n        var firstChild = getChild(el, 0, options, true);\n        if (firstChild === dragEl) {\n          return completed(false);\n        }\n        target = firstChild;\n        targetRect = getRect(target);\n        if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, false) !== false) {\n          capture();\n          el.insertBefore(dragEl, firstChild);\n          parentEl = el; // actualization\n\n          changed();\n          return completed(true);\n        }\n      } else if (target.parentNode === el) {\n        targetRect = getRect(target);\n        var direction = 0,\n          targetBeforeFirstSwap,\n          differentLevel = dragEl.parentNode !== el,\n          differentRowCol = !_dragElInRowColumn(dragEl.animated && dragEl.toRect || dragRect, target.animated && target.toRect || targetRect, vertical),\n          side1 = vertical ? 'top' : 'left',\n          scrolledPastTop = isScrolledPast(target, 'top', 'top') || isScrolledPast(dragEl, 'top', 'top'),\n          scrollBefore = scrolledPastTop ? scrolledPastTop.scrollTop : void 0;\n        if (lastTarget !== target) {\n          targetBeforeFirstSwap = targetRect[side1];\n          pastFirstInvertThresh = false;\n          isCircumstantialInvert = !differentRowCol && options.invertSwap || differentLevel;\n        }\n        direction = _getSwapDirection(evt, target, targetRect, vertical, differentRowCol ? 1 : options.swapThreshold, options.invertedSwapThreshold == null ? options.swapThreshold : options.invertedSwapThreshold, isCircumstantialInvert, lastTarget === target);\n        var sibling;\n        if (direction !== 0) {\n          // Check if target is beside dragEl in respective direction (ignoring hidden elements)\n          var dragIndex = index(dragEl);\n          do {\n            dragIndex -= direction;\n            sibling = parentEl.children[dragIndex];\n          } while (sibling && (css(sibling, 'display') === 'none' || sibling === ghostEl));\n        }\n        // If dragEl is already beside target: Do not insert\n        if (direction === 0 || sibling === target) {\n          return completed(false);\n        }\n        lastTarget = target;\n        lastDirection = direction;\n        var nextSibling = target.nextElementSibling,\n          after = false;\n        after = direction === 1;\n        var moveVector = _onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, after);\n        if (moveVector !== false) {\n          if (moveVector === 1 || moveVector === -1) {\n            after = moveVector === 1;\n          }\n          _silent = true;\n          setTimeout(_unsilent, 30);\n          capture();\n          if (after && !nextSibling) {\n            el.appendChild(dragEl);\n          } else {\n            target.parentNode.insertBefore(dragEl, after ? nextSibling : target);\n          }\n\n          // Undo chrome's scroll adjustment (has no effect on other browsers)\n          if (scrolledPastTop) {\n            scrollBy(scrolledPastTop, 0, scrollBefore - scrolledPastTop.scrollTop);\n          }\n          parentEl = dragEl.parentNode; // actualization\n\n          // must be done before animation\n          if (targetBeforeFirstSwap !== undefined && !isCircumstantialInvert) {\n            targetMoveDistance = Math.abs(targetBeforeFirstSwap - getRect(target)[side1]);\n          }\n          changed();\n          return completed(true);\n        }\n      }\n      if (el.contains(dragEl)) {\n        return completed(false);\n      }\n    }\n    return false;\n  },\n  _ignoreWhileAnimating: null,\n  _offMoveEvents: function _offMoveEvents() {\n    off(document, 'mousemove', this._onTouchMove);\n    off(document, 'touchmove', this._onTouchMove);\n    off(document, 'pointermove', this._onTouchMove);\n    off(document, 'dragover', nearestEmptyInsertDetectEvent);\n    off(document, 'mousemove', nearestEmptyInsertDetectEvent);\n    off(document, 'touchmove', nearestEmptyInsertDetectEvent);\n  },\n  _offUpEvents: function _offUpEvents() {\n    var ownerDocument = this.el.ownerDocument;\n    off(ownerDocument, 'mouseup', this._onDrop);\n    off(ownerDocument, 'touchend', this._onDrop);\n    off(ownerDocument, 'pointerup', this._onDrop);\n    off(ownerDocument, 'pointercancel', this._onDrop);\n    off(ownerDocument, 'touchcancel', this._onDrop);\n    off(document, 'selectstart', this);\n  },\n  _onDrop: function _onDrop( /**Event*/evt) {\n    var el = this.el,\n      options = this.options;\n\n    // Get the index of the dragged element within its parent\n    newIndex = index(dragEl);\n    newDraggableIndex = index(dragEl, options.draggable);\n    pluginEvent('drop', this, {\n      evt: evt\n    });\n    parentEl = dragEl && dragEl.parentNode;\n\n    // Get again after plugin event\n    newIndex = index(dragEl);\n    newDraggableIndex = index(dragEl, options.draggable);\n    if (Sortable.eventCanceled) {\n      this._nulling();\n      return;\n    }\n    awaitingDragStarted = false;\n    isCircumstantialInvert = false;\n    pastFirstInvertThresh = false;\n    clearInterval(this._loopId);\n    clearTimeout(this._dragStartTimer);\n    _cancelNextTick(this.cloneId);\n    _cancelNextTick(this._dragStartId);\n\n    // Unbind events\n    if (this.nativeDraggable) {\n      off(document, 'drop', this);\n      off(el, 'dragstart', this._onDragStart);\n    }\n    this._offMoveEvents();\n    this._offUpEvents();\n    if (Safari) {\n      css(document.body, 'user-select', '');\n    }\n    css(dragEl, 'transform', '');\n    if (evt) {\n      if (moved) {\n        evt.cancelable && evt.preventDefault();\n        !options.dropBubble && evt.stopPropagation();\n      }\n      ghostEl && ghostEl.parentNode && ghostEl.parentNode.removeChild(ghostEl);\n      if (rootEl === parentEl || putSortable && putSortable.lastPutMode !== 'clone') {\n        // Remove clone(s)\n        cloneEl && cloneEl.parentNode && cloneEl.parentNode.removeChild(cloneEl);\n      }\n      if (dragEl) {\n        if (this.nativeDraggable) {\n          off(dragEl, 'dragend', this);\n        }\n        _disableDraggable(dragEl);\n        dragEl.style['will-change'] = '';\n\n        // Remove classes\n        // ghostClass is added in dragStarted\n        if (moved && !awaitingDragStarted) {\n          toggleClass(dragEl, putSortable ? putSortable.options.ghostClass : this.options.ghostClass, false);\n        }\n        toggleClass(dragEl, this.options.chosenClass, false);\n\n        // Drag stop event\n        _dispatchEvent({\n          sortable: this,\n          name: 'unchoose',\n          toEl: parentEl,\n          newIndex: null,\n          newDraggableIndex: null,\n          originalEvent: evt\n        });\n        if (rootEl !== parentEl) {\n          if (newIndex >= 0) {\n            // Add event\n            _dispatchEvent({\n              rootEl: parentEl,\n              name: 'add',\n              toEl: parentEl,\n              fromEl: rootEl,\n              originalEvent: evt\n            });\n\n            // Remove event\n            _dispatchEvent({\n              sortable: this,\n              name: 'remove',\n              toEl: parentEl,\n              originalEvent: evt\n            });\n\n            // drag from one list and drop into another\n            _dispatchEvent({\n              rootEl: parentEl,\n              name: 'sort',\n              toEl: parentEl,\n              fromEl: rootEl,\n              originalEvent: evt\n            });\n            _dispatchEvent({\n              sortable: this,\n              name: 'sort',\n              toEl: parentEl,\n              originalEvent: evt\n            });\n          }\n          putSortable && putSortable.save();\n        } else {\n          if (newIndex !== oldIndex) {\n            if (newIndex >= 0) {\n              // drag & drop within the same list\n              _dispatchEvent({\n                sortable: this,\n                name: 'update',\n                toEl: parentEl,\n                originalEvent: evt\n              });\n              _dispatchEvent({\n                sortable: this,\n                name: 'sort',\n                toEl: parentEl,\n                originalEvent: evt\n              });\n            }\n          }\n        }\n        if (Sortable.active) {\n          /* jshint eqnull:true */\n          if (newIndex == null || newIndex === -1) {\n            newIndex = oldIndex;\n            newDraggableIndex = oldDraggableIndex;\n          }\n          _dispatchEvent({\n            sortable: this,\n            name: 'end',\n            toEl: parentEl,\n            originalEvent: evt\n          });\n\n          // Save sorting\n          this.save();\n        }\n      }\n    }\n    this._nulling();\n  },\n  _nulling: function _nulling() {\n    pluginEvent('nulling', this);\n    rootEl = dragEl = parentEl = ghostEl = nextEl = cloneEl = lastDownEl = cloneHidden = tapEvt = touchEvt = moved = newIndex = newDraggableIndex = oldIndex = oldDraggableIndex = lastTarget = lastDirection = putSortable = activeGroup = Sortable.dragged = Sortable.ghost = Sortable.clone = Sortable.active = null;\n    savedInputChecked.forEach(function (el) {\n      el.checked = true;\n    });\n    savedInputChecked.length = lastDx = lastDy = 0;\n  },\n  handleEvent: function handleEvent( /**Event*/evt) {\n    switch (evt.type) {\n      case 'drop':\n      case 'dragend':\n        this._onDrop(evt);\n        break;\n      case 'dragenter':\n      case 'dragover':\n        if (dragEl) {\n          this._onDragOver(evt);\n          _globalDragOver(evt);\n        }\n        break;\n      case 'selectstart':\n        evt.preventDefault();\n        break;\n    }\n  },\n  /**\r\n   * Serializes the item into an array of string.\r\n   * @returns {String[]}\r\n   */\n  toArray: function toArray() {\n    var order = [],\n      el,\n      children = this.el.children,\n      i = 0,\n      n = children.length,\n      options = this.options;\n    for (; i < n; i++) {\n      el = children[i];\n      if (closest(el, options.draggable, this.el, false)) {\n        order.push(el.getAttribute(options.dataIdAttr) || _generateId(el));\n      }\n    }\n    return order;\n  },\n  /**\r\n   * Sorts the elements according to the array.\r\n   * @param  {String[]}  order  order of the items\r\n   */\n  sort: function sort(order, useAnimation) {\n    var items = {},\n      rootEl = this.el;\n    this.toArray().forEach(function (id, i) {\n      var el = rootEl.children[i];\n      if (closest(el, this.options.draggable, rootEl, false)) {\n        items[id] = el;\n      }\n    }, this);\n    useAnimation && this.captureAnimationState();\n    order.forEach(function (id) {\n      if (items[id]) {\n        rootEl.removeChild(items[id]);\n        rootEl.appendChild(items[id]);\n      }\n    });\n    useAnimation && this.animateAll();\n  },\n  /**\r\n   * Save the current sorting\r\n   */\n  save: function save() {\n    var store = this.options.store;\n    store && store.set && store.set(this);\n  },\n  /**\r\n   * For each element in the set, get the first element that matches the selector by testing the element itself and traversing up through its ancestors in the DOM tree.\r\n   * @param   {HTMLElement}  el\r\n   * @param   {String}       [selector]  default: `options.draggable`\r\n   * @returns {HTMLElement|null}\r\n   */\n  closest: function closest$1(el, selector) {\n    return closest(el, selector || this.options.draggable, this.el, false);\n  },\n  /**\r\n   * Set/get option\r\n   * @param   {string} name\r\n   * @param   {*}      [value]\r\n   * @returns {*}\r\n   */\n  option: function option(name, value) {\n    var options = this.options;\n    if (value === void 0) {\n      return options[name];\n    } else {\n      var modifiedValue = PluginManager.modifyOption(this, name, value);\n      if (typeof modifiedValue !== 'undefined') {\n        options[name] = modifiedValue;\n      } else {\n        options[name] = value;\n      }\n      if (name === 'group') {\n        _prepareGroup(options);\n      }\n    }\n  },\n  /**\r\n   * Destroy\r\n   */\n  destroy: function destroy() {\n    pluginEvent('destroy', this);\n    var el = this.el;\n    el[expando] = null;\n    off(el, 'mousedown', this._onTapStart);\n    off(el, 'touchstart', this._onTapStart);\n    off(el, 'pointerdown', this._onTapStart);\n    if (this.nativeDraggable) {\n      off(el, 'dragover', this);\n      off(el, 'dragenter', this);\n    }\n    // Remove draggable attributes\n    Array.prototype.forEach.call(el.querySelectorAll('[draggable]'), function (el) {\n      el.removeAttribute('draggable');\n    });\n    this._onDrop();\n    this._disableDelayedDragEvents();\n    sortables.splice(sortables.indexOf(this.el), 1);\n    this.el = el = null;\n  },\n  _hideClone: function _hideClone() {\n    if (!cloneHidden) {\n      pluginEvent('hideClone', this);\n      if (Sortable.eventCanceled) return;\n      css(cloneEl, 'display', 'none');\n      if (this.options.removeCloneOnHide && cloneEl.parentNode) {\n        cloneEl.parentNode.removeChild(cloneEl);\n      }\n      cloneHidden = true;\n    }\n  },\n  _showClone: function _showClone(putSortable) {\n    if (putSortable.lastPutMode !== 'clone') {\n      this._hideClone();\n      return;\n    }\n    if (cloneHidden) {\n      pluginEvent('showClone', this);\n      if (Sortable.eventCanceled) return;\n\n      // show clone at dragEl or original position\n      if (dragEl.parentNode == rootEl && !this.options.group.revertClone) {\n        rootEl.insertBefore(cloneEl, dragEl);\n      } else if (nextEl) {\n        rootEl.insertBefore(cloneEl, nextEl);\n      } else {\n        rootEl.appendChild(cloneEl);\n      }\n      if (this.options.group.revertClone) {\n        this.animate(dragEl, cloneEl);\n      }\n      css(cloneEl, 'display', '');\n      cloneHidden = false;\n    }\n  }\n};\nfunction _globalDragOver( /**Event*/evt) {\n  if (evt.dataTransfer) {\n    evt.dataTransfer.dropEffect = 'move';\n  }\n  evt.cancelable && evt.preventDefault();\n}\nfunction _onMove(fromEl, toEl, dragEl, dragRect, targetEl, targetRect, originalEvent, willInsertAfter) {\n  var evt,\n    sortable = fromEl[expando],\n    onMoveFn = sortable.options.onMove,\n    retVal;\n  // Support for new CustomEvent feature\n  if (window.CustomEvent && !IE11OrLess && !Edge) {\n    evt = new CustomEvent('move', {\n      bubbles: true,\n      cancelable: true\n    });\n  } else {\n    evt = document.createEvent('Event');\n    evt.initEvent('move', true, true);\n  }\n  evt.to = toEl;\n  evt.from = fromEl;\n  evt.dragged = dragEl;\n  evt.draggedRect = dragRect;\n  evt.related = targetEl || toEl;\n  evt.relatedRect = targetRect || getRect(toEl);\n  evt.willInsertAfter = willInsertAfter;\n  evt.originalEvent = originalEvent;\n  fromEl.dispatchEvent(evt);\n  if (onMoveFn) {\n    retVal = onMoveFn.call(sortable, evt, originalEvent);\n  }\n  return retVal;\n}\nfunction _disableDraggable(el) {\n  el.draggable = false;\n}\nfunction _unsilent() {\n  _silent = false;\n}\nfunction _ghostIsFirst(evt, vertical, sortable) {\n  var firstElRect = getRect(getChild(sortable.el, 0, sortable.options, true));\n  var childContainingRect = getChildContainingRectFromElement(sortable.el, sortable.options, ghostEl);\n  var spacer = 10;\n  return vertical ? evt.clientX < childContainingRect.left - spacer || evt.clientY < firstElRect.top && evt.clientX < firstElRect.right : evt.clientY < childContainingRect.top - spacer || evt.clientY < firstElRect.bottom && evt.clientX < firstElRect.left;\n}\nfunction _ghostIsLast(evt, vertical, sortable) {\n  var lastElRect = getRect(lastChild(sortable.el, sortable.options.draggable));\n  var childContainingRect = getChildContainingRectFromElement(sortable.el, sortable.options, ghostEl);\n  var spacer = 10;\n  return vertical ? evt.clientX > childContainingRect.right + spacer || evt.clientY > lastElRect.bottom && evt.clientX > lastElRect.left : evt.clientY > childContainingRect.bottom + spacer || evt.clientX > lastElRect.right && evt.clientY > lastElRect.top;\n}\nfunction _getSwapDirection(evt, target, targetRect, vertical, swapThreshold, invertedSwapThreshold, invertSwap, isLastTarget) {\n  var mouseOnAxis = vertical ? evt.clientY : evt.clientX,\n    targetLength = vertical ? targetRect.height : targetRect.width,\n    targetS1 = vertical ? targetRect.top : targetRect.left,\n    targetS2 = vertical ? targetRect.bottom : targetRect.right,\n    invert = false;\n  if (!invertSwap) {\n    // Never invert or create dragEl shadow when target movemenet causes mouse to move past the end of regular swapThreshold\n    if (isLastTarget && targetMoveDistance < targetLength * swapThreshold) {\n      // multiplied only by swapThreshold because mouse will already be inside target by (1 - threshold) * targetLength / 2\n      // check if past first invert threshold on side opposite of lastDirection\n      if (!pastFirstInvertThresh && (lastDirection === 1 ? mouseOnAxis > targetS1 + targetLength * invertedSwapThreshold / 2 : mouseOnAxis < targetS2 - targetLength * invertedSwapThreshold / 2)) {\n        // past first invert threshold, do not restrict inverted threshold to dragEl shadow\n        pastFirstInvertThresh = true;\n      }\n      if (!pastFirstInvertThresh) {\n        // dragEl shadow (target move distance shadow)\n        if (lastDirection === 1 ? mouseOnAxis < targetS1 + targetMoveDistance // over dragEl shadow\n        : mouseOnAxis > targetS2 - targetMoveDistance) {\n          return -lastDirection;\n        }\n      } else {\n        invert = true;\n      }\n    } else {\n      // Regular\n      if (mouseOnAxis > targetS1 + targetLength * (1 - swapThreshold) / 2 && mouseOnAxis < targetS2 - targetLength * (1 - swapThreshold) / 2) {\n        return _getInsertDirection(target);\n      }\n    }\n  }\n  invert = invert || invertSwap;\n  if (invert) {\n    // Invert of regular\n    if (mouseOnAxis < targetS1 + targetLength * invertedSwapThreshold / 2 || mouseOnAxis > targetS2 - targetLength * invertedSwapThreshold / 2) {\n      return mouseOnAxis > targetS1 + targetLength / 2 ? 1 : -1;\n    }\n  }\n  return 0;\n}\n\n/**\r\n * Gets the direction dragEl must be swapped relative to target in order to make it\r\n * seem that dragEl has been \"inserted\" into that element's position\r\n * @param  {HTMLElement} target       The target whose position dragEl is being inserted at\r\n * @return {Number}                   Direction dragEl must be swapped\r\n */\nfunction _getInsertDirection(target) {\n  if (index(dragEl) < index(target)) {\n    return 1;\n  } else {\n    return -1;\n  }\n}\n\n/**\r\n * Generate id\r\n * @param   {HTMLElement} el\r\n * @returns {String}\r\n * @private\r\n */\nfunction _generateId(el) {\n  var str = el.tagName + el.className + el.src + el.href + el.textContent,\n    i = str.length,\n    sum = 0;\n  while (i--) {\n    sum += str.charCodeAt(i);\n  }\n  return sum.toString(36);\n}\nfunction _saveInputCheckedState(root) {\n  savedInputChecked.length = 0;\n  var inputs = root.getElementsByTagName('input');\n  var idx = inputs.length;\n  while (idx--) {\n    var el = inputs[idx];\n    el.checked && savedInputChecked.push(el);\n  }\n}\nfunction _nextTick(fn) {\n  return setTimeout(fn, 0);\n}\nfunction _cancelNextTick(id) {\n  return clearTimeout(id);\n}\n\n// Fixed #973:\nif (documentExists) {\n  on(document, 'touchmove', function (evt) {\n    if ((Sortable.active || awaitingDragStarted) && evt.cancelable) {\n      evt.preventDefault();\n    }\n  });\n}\n\n// Export utils\nSortable.utils = {\n  on: on,\n  off: off,\n  css: css,\n  find: find,\n  is: function is(el, selector) {\n    return !!closest(el, selector, el, false);\n  },\n  extend: extend,\n  throttle: throttle,\n  closest: closest,\n  toggleClass: toggleClass,\n  clone: clone,\n  index: index,\n  nextTick: _nextTick,\n  cancelNextTick: _cancelNextTick,\n  detectDirection: _detectDirection,\n  getChild: getChild,\n  expando: expando\n};\n\n/**\r\n * Get the Sortable instance of an element\r\n * @param  {HTMLElement} element The element\r\n * @return {Sortable|undefined}         The instance of Sortable\r\n */\nSortable.get = function (element) {\n  return element[expando];\n};\n\n/**\r\n * Mount a plugin to Sortable\r\n * @param  {...SortablePlugin|SortablePlugin[]} plugins       Plugins being mounted\r\n */\nSortable.mount = function () {\n  for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {\n    plugins[_key] = arguments[_key];\n  }\n  if (plugins[0].constructor === Array) plugins = plugins[0];\n  plugins.forEach(function (plugin) {\n    if (!plugin.prototype || !plugin.prototype.constructor) {\n      throw \"Sortable: Mounted plugin must be a constructor function, not \".concat({}.toString.call(plugin));\n    }\n    if (plugin.utils) Sortable.utils = _objectSpread2(_objectSpread2({}, Sortable.utils), plugin.utils);\n    PluginManager.mount(plugin);\n  });\n};\n\n/**\r\n * Create sortable instance\r\n * @param {HTMLElement}  el\r\n * @param {Object}      [options]\r\n */\nSortable.create = function (el, options) {\n  return new Sortable(el, options);\n};\n\n// Export\nSortable.version = version;\n\nvar autoScrolls = [],\n  scrollEl,\n  scrollRootEl,\n  scrolling = false,\n  lastAutoScrollX,\n  lastAutoScrollY,\n  touchEvt$1,\n  pointerElemChangedInterval;\nfunction AutoScrollPlugin() {\n  function AutoScroll() {\n    this.defaults = {\n      scroll: true,\n      forceAutoScrollFallback: false,\n      scrollSensitivity: 30,\n      scrollSpeed: 10,\n      bubbleScroll: true\n    };\n\n    // Bind all private methods\n    for (var fn in this) {\n      if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {\n        this[fn] = this[fn].bind(this);\n      }\n    }\n  }\n  AutoScroll.prototype = {\n    dragStarted: function dragStarted(_ref) {\n      var originalEvent = _ref.originalEvent;\n      if (this.sortable.nativeDraggable) {\n        on(document, 'dragover', this._handleAutoScroll);\n      } else {\n        if (this.options.supportPointer) {\n          on(document, 'pointermove', this._handleFallbackAutoScroll);\n        } else if (originalEvent.touches) {\n          on(document, 'touchmove', this._handleFallbackAutoScroll);\n        } else {\n          on(document, 'mousemove', this._handleFallbackAutoScroll);\n        }\n      }\n    },\n    dragOverCompleted: function dragOverCompleted(_ref2) {\n      var originalEvent = _ref2.originalEvent;\n      // For when bubbling is canceled and using fallback (fallback 'touchmove' always reached)\n      if (!this.options.dragOverBubble && !originalEvent.rootEl) {\n        this._handleAutoScroll(originalEvent);\n      }\n    },\n    drop: function drop() {\n      if (this.sortable.nativeDraggable) {\n        off(document, 'dragover', this._handleAutoScroll);\n      } else {\n        off(document, 'pointermove', this._handleFallbackAutoScroll);\n        off(document, 'touchmove', this._handleFallbackAutoScroll);\n        off(document, 'mousemove', this._handleFallbackAutoScroll);\n      }\n      clearPointerElemChangedInterval();\n      clearAutoScrolls();\n      cancelThrottle();\n    },\n    nulling: function nulling() {\n      touchEvt$1 = scrollRootEl = scrollEl = scrolling = pointerElemChangedInterval = lastAutoScrollX = lastAutoScrollY = null;\n      autoScrolls.length = 0;\n    },\n    _handleFallbackAutoScroll: function _handleFallbackAutoScroll(evt) {\n      this._handleAutoScroll(evt, true);\n    },\n    _handleAutoScroll: function _handleAutoScroll(evt, fallback) {\n      var _this = this;\n      var x = (evt.touches ? evt.touches[0] : evt).clientX,\n        y = (evt.touches ? evt.touches[0] : evt).clientY,\n        elem = document.elementFromPoint(x, y);\n      touchEvt$1 = evt;\n\n      // IE does not seem to have native autoscroll,\n      // Edge's autoscroll seems too conditional,\n      // MACOS Safari does not have autoscroll,\n      // Firefox and Chrome are good\n      if (fallback || this.options.forceAutoScrollFallback || Edge || IE11OrLess || Safari) {\n        autoScroll(evt, this.options, elem, fallback);\n\n        // Listener for pointer element change\n        var ogElemScroller = getParentAutoScrollElement(elem, true);\n        if (scrolling && (!pointerElemChangedInterval || x !== lastAutoScrollX || y !== lastAutoScrollY)) {\n          pointerElemChangedInterval && clearPointerElemChangedInterval();\n          // Detect for pointer elem change, emulating native DnD behaviour\n          pointerElemChangedInterval = setInterval(function () {\n            var newElem = getParentAutoScrollElement(document.elementFromPoint(x, y), true);\n            if (newElem !== ogElemScroller) {\n              ogElemScroller = newElem;\n              clearAutoScrolls();\n            }\n            autoScroll(evt, _this.options, newElem, fallback);\n          }, 10);\n          lastAutoScrollX = x;\n          lastAutoScrollY = y;\n        }\n      } else {\n        // if DnD is enabled (and browser has good autoscrolling), first autoscroll will already scroll, so get parent autoscroll of first autoscroll\n        if (!this.options.bubbleScroll || getParentAutoScrollElement(elem, true) === getWindowScrollingElement()) {\n          clearAutoScrolls();\n          return;\n        }\n        autoScroll(evt, this.options, getParentAutoScrollElement(elem, false), false);\n      }\n    }\n  };\n  return _extends(AutoScroll, {\n    pluginName: 'scroll',\n    initializeByDefault: true\n  });\n}\nfunction clearAutoScrolls() {\n  autoScrolls.forEach(function (autoScroll) {\n    clearInterval(autoScroll.pid);\n  });\n  autoScrolls = [];\n}\nfunction clearPointerElemChangedInterval() {\n  clearInterval(pointerElemChangedInterval);\n}\nvar autoScroll = throttle(function (evt, options, rootEl, isFallback) {\n  // Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=505521\n  if (!options.scroll) return;\n  var x = (evt.touches ? evt.touches[0] : evt).clientX,\n    y = (evt.touches ? evt.touches[0] : evt).clientY,\n    sens = options.scrollSensitivity,\n    speed = options.scrollSpeed,\n    winScroller = getWindowScrollingElement();\n  var scrollThisInstance = false,\n    scrollCustomFn;\n\n  // New scroll root, set scrollEl\n  if (scrollRootEl !== rootEl) {\n    scrollRootEl = rootEl;\n    clearAutoScrolls();\n    scrollEl = options.scroll;\n    scrollCustomFn = options.scrollFn;\n    if (scrollEl === true) {\n      scrollEl = getParentAutoScrollElement(rootEl, true);\n    }\n  }\n  var layersOut = 0;\n  var currentParent = scrollEl;\n  do {\n    var el = currentParent,\n      rect = getRect(el),\n      top = rect.top,\n      bottom = rect.bottom,\n      left = rect.left,\n      right = rect.right,\n      width = rect.width,\n      height = rect.height,\n      canScrollX = void 0,\n      canScrollY = void 0,\n      scrollWidth = el.scrollWidth,\n      scrollHeight = el.scrollHeight,\n      elCSS = css(el),\n      scrollPosX = el.scrollLeft,\n      scrollPosY = el.scrollTop;\n    if (el === winScroller) {\n      canScrollX = width < scrollWidth && (elCSS.overflowX === 'auto' || elCSS.overflowX === 'scroll' || elCSS.overflowX === 'visible');\n      canScrollY = height < scrollHeight && (elCSS.overflowY === 'auto' || elCSS.overflowY === 'scroll' || elCSS.overflowY === 'visible');\n    } else {\n      canScrollX = width < scrollWidth && (elCSS.overflowX === 'auto' || elCSS.overflowX === 'scroll');\n      canScrollY = height < scrollHeight && (elCSS.overflowY === 'auto' || elCSS.overflowY === 'scroll');\n    }\n    var vx = canScrollX && (Math.abs(right - x) <= sens && scrollPosX + width < scrollWidth) - (Math.abs(left - x) <= sens && !!scrollPosX);\n    var vy = canScrollY && (Math.abs(bottom - y) <= sens && scrollPosY + height < scrollHeight) - (Math.abs(top - y) <= sens && !!scrollPosY);\n    if (!autoScrolls[layersOut]) {\n      for (var i = 0; i <= layersOut; i++) {\n        if (!autoScrolls[i]) {\n          autoScrolls[i] = {};\n        }\n      }\n    }\n    if (autoScrolls[layersOut].vx != vx || autoScrolls[layersOut].vy != vy || autoScrolls[layersOut].el !== el) {\n      autoScrolls[layersOut].el = el;\n      autoScrolls[layersOut].vx = vx;\n      autoScrolls[layersOut].vy = vy;\n      clearInterval(autoScrolls[layersOut].pid);\n      if (vx != 0 || vy != 0) {\n        scrollThisInstance = true;\n        /* jshint loopfunc:true */\n        autoScrolls[layersOut].pid = setInterval(function () {\n          // emulate drag over during autoscroll (fallback), emulating native DnD behaviour\n          if (isFallback && this.layer === 0) {\n            Sortable.active._onTouchMove(touchEvt$1); // To move ghost if it is positioned absolutely\n          }\n          var scrollOffsetY = autoScrolls[this.layer].vy ? autoScrolls[this.layer].vy * speed : 0;\n          var scrollOffsetX = autoScrolls[this.layer].vx ? autoScrolls[this.layer].vx * speed : 0;\n          if (typeof scrollCustomFn === 'function') {\n            if (scrollCustomFn.call(Sortable.dragged.parentNode[expando], scrollOffsetX, scrollOffsetY, evt, touchEvt$1, autoScrolls[this.layer].el) !== 'continue') {\n              return;\n            }\n          }\n          scrollBy(autoScrolls[this.layer].el, scrollOffsetX, scrollOffsetY);\n        }.bind({\n          layer: layersOut\n        }), 24);\n      }\n    }\n    layersOut++;\n  } while (options.bubbleScroll && currentParent !== winScroller && (currentParent = getParentAutoScrollElement(currentParent, false)));\n  scrolling = scrollThisInstance; // in case another function catches scrolling as false in between when it is not\n}, 30);\n\nvar drop = function drop(_ref) {\n  var originalEvent = _ref.originalEvent,\n    putSortable = _ref.putSortable,\n    dragEl = _ref.dragEl,\n    activeSortable = _ref.activeSortable,\n    dispatchSortableEvent = _ref.dispatchSortableEvent,\n    hideGhostForTarget = _ref.hideGhostForTarget,\n    unhideGhostForTarget = _ref.unhideGhostForTarget;\n  if (!originalEvent) return;\n  var toSortable = putSortable || activeSortable;\n  hideGhostForTarget();\n  var touch = originalEvent.changedTouches && originalEvent.changedTouches.length ? originalEvent.changedTouches[0] : originalEvent;\n  var target = document.elementFromPoint(touch.clientX, touch.clientY);\n  unhideGhostForTarget();\n  if (toSortable && !toSortable.el.contains(target)) {\n    dispatchSortableEvent('spill');\n    this.onSpill({\n      dragEl: dragEl,\n      putSortable: putSortable\n    });\n  }\n};\nfunction Revert() {}\nRevert.prototype = {\n  startIndex: null,\n  dragStart: function dragStart(_ref2) {\n    var oldDraggableIndex = _ref2.oldDraggableIndex;\n    this.startIndex = oldDraggableIndex;\n  },\n  onSpill: function onSpill(_ref3) {\n    var dragEl = _ref3.dragEl,\n      putSortable = _ref3.putSortable;\n    this.sortable.captureAnimationState();\n    if (putSortable) {\n      putSortable.captureAnimationState();\n    }\n    var nextSibling = getChild(this.sortable.el, this.startIndex, this.options);\n    if (nextSibling) {\n      this.sortable.el.insertBefore(dragEl, nextSibling);\n    } else {\n      this.sortable.el.appendChild(dragEl);\n    }\n    this.sortable.animateAll();\n    if (putSortable) {\n      putSortable.animateAll();\n    }\n  },\n  drop: drop\n};\n_extends(Revert, {\n  pluginName: 'revertOnSpill'\n});\nfunction Remove() {}\nRemove.prototype = {\n  onSpill: function onSpill(_ref4) {\n    var dragEl = _ref4.dragEl,\n      putSortable = _ref4.putSortable;\n    var parentSortable = putSortable || this.sortable;\n    parentSortable.captureAnimationState();\n    dragEl.parentNode && dragEl.parentNode.removeChild(dragEl);\n    parentSortable.animateAll();\n  },\n  drop: drop\n};\n_extends(Remove, {\n  pluginName: 'removeOnSpill'\n});\n\nvar lastSwapEl;\nfunction SwapPlugin() {\n  function Swap() {\n    this.defaults = {\n      swapClass: 'sortable-swap-highlight'\n    };\n  }\n  Swap.prototype = {\n    dragStart: function dragStart(_ref) {\n      var dragEl = _ref.dragEl;\n      lastSwapEl = dragEl;\n    },\n    dragOverValid: function dragOverValid(_ref2) {\n      var completed = _ref2.completed,\n        target = _ref2.target,\n        onMove = _ref2.onMove,\n        activeSortable = _ref2.activeSortable,\n        changed = _ref2.changed,\n        cancel = _ref2.cancel;\n      if (!activeSortable.options.swap) return;\n      var el = this.sortable.el,\n        options = this.options;\n      if (target && target !== el) {\n        var prevSwapEl = lastSwapEl;\n        if (onMove(target) !== false) {\n          toggleClass(target, options.swapClass, true);\n          lastSwapEl = target;\n        } else {\n          lastSwapEl = null;\n        }\n        if (prevSwapEl && prevSwapEl !== lastSwapEl) {\n          toggleClass(prevSwapEl, options.swapClass, false);\n        }\n      }\n      changed();\n      completed(true);\n      cancel();\n    },\n    drop: function drop(_ref3) {\n      var activeSortable = _ref3.activeSortable,\n        putSortable = _ref3.putSortable,\n        dragEl = _ref3.dragEl;\n      var toSortable = putSortable || this.sortable;\n      var options = this.options;\n      lastSwapEl && toggleClass(lastSwapEl, options.swapClass, false);\n      if (lastSwapEl && (options.swap || putSortable && putSortable.options.swap)) {\n        if (dragEl !== lastSwapEl) {\n          toSortable.captureAnimationState();\n          if (toSortable !== activeSortable) activeSortable.captureAnimationState();\n          swapNodes(dragEl, lastSwapEl);\n          toSortable.animateAll();\n          if (toSortable !== activeSortable) activeSortable.animateAll();\n        }\n      }\n    },\n    nulling: function nulling() {\n      lastSwapEl = null;\n    }\n  };\n  return _extends(Swap, {\n    pluginName: 'swap',\n    eventProperties: function eventProperties() {\n      return {\n        swapItem: lastSwapEl\n      };\n    }\n  });\n}\nfunction swapNodes(n1, n2) {\n  var p1 = n1.parentNode,\n    p2 = n2.parentNode,\n    i1,\n    i2;\n  if (!p1 || !p2 || p1.isEqualNode(n2) || p2.isEqualNode(n1)) return;\n  i1 = index(n1);\n  i2 = index(n2);\n  if (p1.isEqualNode(p2) && i1 < i2) {\n    i2++;\n  }\n  p1.insertBefore(n2, p1.children[i1]);\n  p2.insertBefore(n1, p2.children[i2]);\n}\n\nvar multiDragElements = [],\n  multiDragClones = [],\n  lastMultiDragSelect,\n  // for selection with modifier key down (SHIFT)\n  multiDragSortable,\n  initialFolding = false,\n  // Initial multi-drag fold when drag started\n  folding = false,\n  // Folding any other time\n  dragStarted = false,\n  dragEl$1,\n  clonesFromRect,\n  clonesHidden;\nfunction MultiDragPlugin() {\n  function MultiDrag(sortable) {\n    // Bind all private methods\n    for (var fn in this) {\n      if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {\n        this[fn] = this[fn].bind(this);\n      }\n    }\n    if (!sortable.options.avoidImplicitDeselect) {\n      if (sortable.options.supportPointer) {\n        on(document, 'pointerup', this._deselectMultiDrag);\n      } else {\n        on(document, 'mouseup', this._deselectMultiDrag);\n        on(document, 'touchend', this._deselectMultiDrag);\n      }\n    }\n    on(document, 'keydown', this._checkKeyDown);\n    on(document, 'keyup', this._checkKeyUp);\n    this.defaults = {\n      selectedClass: 'sortable-selected',\n      multiDragKey: null,\n      avoidImplicitDeselect: false,\n      setData: function setData(dataTransfer, dragEl) {\n        var data = '';\n        if (multiDragElements.length && multiDragSortable === sortable) {\n          multiDragElements.forEach(function (multiDragElement, i) {\n            data += (!i ? '' : ', ') + multiDragElement.textContent;\n          });\n        } else {\n          data = dragEl.textContent;\n        }\n        dataTransfer.setData('Text', data);\n      }\n    };\n  }\n  MultiDrag.prototype = {\n    multiDragKeyDown: false,\n    isMultiDrag: false,\n    delayStartGlobal: function delayStartGlobal(_ref) {\n      var dragged = _ref.dragEl;\n      dragEl$1 = dragged;\n    },\n    delayEnded: function delayEnded() {\n      this.isMultiDrag = ~multiDragElements.indexOf(dragEl$1);\n    },\n    setupClone: function setupClone(_ref2) {\n      var sortable = _ref2.sortable,\n        cancel = _ref2.cancel;\n      if (!this.isMultiDrag) return;\n      for (var i = 0; i < multiDragElements.length; i++) {\n        multiDragClones.push(clone(multiDragElements[i]));\n        multiDragClones[i].sortableIndex = multiDragElements[i].sortableIndex;\n        multiDragClones[i].draggable = false;\n        multiDragClones[i].style['will-change'] = '';\n        toggleClass(multiDragClones[i], this.options.selectedClass, false);\n        multiDragElements[i] === dragEl$1 && toggleClass(multiDragClones[i], this.options.chosenClass, false);\n      }\n      sortable._hideClone();\n      cancel();\n    },\n    clone: function clone(_ref3) {\n      var sortable = _ref3.sortable,\n        rootEl = _ref3.rootEl,\n        dispatchSortableEvent = _ref3.dispatchSortableEvent,\n        cancel = _ref3.cancel;\n      if (!this.isMultiDrag) return;\n      if (!this.options.removeCloneOnHide) {\n        if (multiDragElements.length && multiDragSortable === sortable) {\n          insertMultiDragClones(true, rootEl);\n          dispatchSortableEvent('clone');\n          cancel();\n        }\n      }\n    },\n    showClone: function showClone(_ref4) {\n      var cloneNowShown = _ref4.cloneNowShown,\n        rootEl = _ref4.rootEl,\n        cancel = _ref4.cancel;\n      if (!this.isMultiDrag) return;\n      insertMultiDragClones(false, rootEl);\n      multiDragClones.forEach(function (clone) {\n        css(clone, 'display', '');\n      });\n      cloneNowShown();\n      clonesHidden = false;\n      cancel();\n    },\n    hideClone: function hideClone(_ref5) {\n      var _this = this;\n      var sortable = _ref5.sortable,\n        cloneNowHidden = _ref5.cloneNowHidden,\n        cancel = _ref5.cancel;\n      if (!this.isMultiDrag) return;\n      multiDragClones.forEach(function (clone) {\n        css(clone, 'display', 'none');\n        if (_this.options.removeCloneOnHide && clone.parentNode) {\n          clone.parentNode.removeChild(clone);\n        }\n      });\n      cloneNowHidden();\n      clonesHidden = true;\n      cancel();\n    },\n    dragStartGlobal: function dragStartGlobal(_ref6) {\n      var sortable = _ref6.sortable;\n      if (!this.isMultiDrag && multiDragSortable) {\n        multiDragSortable.multiDrag._deselectMultiDrag();\n      }\n      multiDragElements.forEach(function (multiDragElement) {\n        multiDragElement.sortableIndex = index(multiDragElement);\n      });\n\n      // Sort multi-drag elements\n      multiDragElements = multiDragElements.sort(function (a, b) {\n        return a.sortableIndex - b.sortableIndex;\n      });\n      dragStarted = true;\n    },\n    dragStarted: function dragStarted(_ref7) {\n      var _this2 = this;\n      var sortable = _ref7.sortable;\n      if (!this.isMultiDrag) return;\n      if (this.options.sort) {\n        // Capture rects,\n        // hide multi drag elements (by positioning them absolute),\n        // set multi drag elements rects to dragRect,\n        // show multi drag elements,\n        // animate to rects,\n        // unset rects & remove from DOM\n\n        sortable.captureAnimationState();\n        if (this.options.animation) {\n          multiDragElements.forEach(function (multiDragElement) {\n            if (multiDragElement === dragEl$1) return;\n            css(multiDragElement, 'position', 'absolute');\n          });\n          var dragRect = getRect(dragEl$1, false, true, true);\n          multiDragElements.forEach(function (multiDragElement) {\n            if (multiDragElement === dragEl$1) return;\n            setRect(multiDragElement, dragRect);\n          });\n          folding = true;\n          initialFolding = true;\n        }\n      }\n      sortable.animateAll(function () {\n        folding = false;\n        initialFolding = false;\n        if (_this2.options.animation) {\n          multiDragElements.forEach(function (multiDragElement) {\n            unsetRect(multiDragElement);\n          });\n        }\n\n        // Remove all auxiliary multidrag items from el, if sorting enabled\n        if (_this2.options.sort) {\n          removeMultiDragElements();\n        }\n      });\n    },\n    dragOver: function dragOver(_ref8) {\n      var target = _ref8.target,\n        completed = _ref8.completed,\n        cancel = _ref8.cancel;\n      if (folding && ~multiDragElements.indexOf(target)) {\n        completed(false);\n        cancel();\n      }\n    },\n    revert: function revert(_ref9) {\n      var fromSortable = _ref9.fromSortable,\n        rootEl = _ref9.rootEl,\n        sortable = _ref9.sortable,\n        dragRect = _ref9.dragRect;\n      if (multiDragElements.length > 1) {\n        // Setup unfold animation\n        multiDragElements.forEach(function (multiDragElement) {\n          sortable.addAnimationState({\n            target: multiDragElement,\n            rect: folding ? getRect(multiDragElement) : dragRect\n          });\n          unsetRect(multiDragElement);\n          multiDragElement.fromRect = dragRect;\n          fromSortable.removeAnimationState(multiDragElement);\n        });\n        folding = false;\n        insertMultiDragElements(!this.options.removeCloneOnHide, rootEl);\n      }\n    },\n    dragOverCompleted: function dragOverCompleted(_ref10) {\n      var sortable = _ref10.sortable,\n        isOwner = _ref10.isOwner,\n        insertion = _ref10.insertion,\n        activeSortable = _ref10.activeSortable,\n        parentEl = _ref10.parentEl,\n        putSortable = _ref10.putSortable;\n      var options = this.options;\n      if (insertion) {\n        // Clones must be hidden before folding animation to capture dragRectAbsolute properly\n        if (isOwner) {\n          activeSortable._hideClone();\n        }\n        initialFolding = false;\n        // If leaving sort:false root, or already folding - Fold to new location\n        if (options.animation && multiDragElements.length > 1 && (folding || !isOwner && !activeSortable.options.sort && !putSortable)) {\n          // Fold: Set all multi drag elements's rects to dragEl's rect when multi-drag elements are invisible\n          var dragRectAbsolute = getRect(dragEl$1, false, true, true);\n          multiDragElements.forEach(function (multiDragElement) {\n            if (multiDragElement === dragEl$1) return;\n            setRect(multiDragElement, dragRectAbsolute);\n\n            // Move element(s) to end of parentEl so that it does not interfere with multi-drag clones insertion if they are inserted\n            // while folding, and so that we can capture them again because old sortable will no longer be fromSortable\n            parentEl.appendChild(multiDragElement);\n          });\n          folding = true;\n        }\n\n        // Clones must be shown (and check to remove multi drags) after folding when interfering multiDragElements are moved out\n        if (!isOwner) {\n          // Only remove if not folding (folding will remove them anyways)\n          if (!folding) {\n            removeMultiDragElements();\n          }\n          if (multiDragElements.length > 1) {\n            var clonesHiddenBefore = clonesHidden;\n            activeSortable._showClone(sortable);\n\n            // Unfold animation for clones if showing from hidden\n            if (activeSortable.options.animation && !clonesHidden && clonesHiddenBefore) {\n              multiDragClones.forEach(function (clone) {\n                activeSortable.addAnimationState({\n                  target: clone,\n                  rect: clonesFromRect\n                });\n                clone.fromRect = clonesFromRect;\n                clone.thisAnimationDuration = null;\n              });\n            }\n          } else {\n            activeSortable._showClone(sortable);\n          }\n        }\n      }\n    },\n    dragOverAnimationCapture: function dragOverAnimationCapture(_ref11) {\n      var dragRect = _ref11.dragRect,\n        isOwner = _ref11.isOwner,\n        activeSortable = _ref11.activeSortable;\n      multiDragElements.forEach(function (multiDragElement) {\n        multiDragElement.thisAnimationDuration = null;\n      });\n      if (activeSortable.options.animation && !isOwner && activeSortable.multiDrag.isMultiDrag) {\n        clonesFromRect = _extends({}, dragRect);\n        var dragMatrix = matrix(dragEl$1, true);\n        clonesFromRect.top -= dragMatrix.f;\n        clonesFromRect.left -= dragMatrix.e;\n      }\n    },\n    dragOverAnimationComplete: function dragOverAnimationComplete() {\n      if (folding) {\n        folding = false;\n        removeMultiDragElements();\n      }\n    },\n    drop: function drop(_ref12) {\n      var evt = _ref12.originalEvent,\n        rootEl = _ref12.rootEl,\n        parentEl = _ref12.parentEl,\n        sortable = _ref12.sortable,\n        dispatchSortableEvent = _ref12.dispatchSortableEvent,\n        oldIndex = _ref12.oldIndex,\n        putSortable = _ref12.putSortable;\n      var toSortable = putSortable || this.sortable;\n      if (!evt) return;\n      var options = this.options,\n        children = parentEl.children;\n\n      // Multi-drag selection\n      if (!dragStarted) {\n        if (options.multiDragKey && !this.multiDragKeyDown) {\n          this._deselectMultiDrag();\n        }\n        toggleClass(dragEl$1, options.selectedClass, !~multiDragElements.indexOf(dragEl$1));\n        if (!~multiDragElements.indexOf(dragEl$1)) {\n          multiDragElements.push(dragEl$1);\n          dispatchEvent({\n            sortable: sortable,\n            rootEl: rootEl,\n            name: 'select',\n            targetEl: dragEl$1,\n            originalEvent: evt\n          });\n\n          // Modifier activated, select from last to dragEl\n          if (evt.shiftKey && lastMultiDragSelect && sortable.el.contains(lastMultiDragSelect)) {\n            var lastIndex = index(lastMultiDragSelect),\n              currentIndex = index(dragEl$1);\n            if (~lastIndex && ~currentIndex && lastIndex !== currentIndex) {\n              (function () {\n                // Must include lastMultiDragSelect (select it), in case modified selection from no selection\n                // (but previous selection existed)\n                var n, i;\n                if (currentIndex > lastIndex) {\n                  i = lastIndex;\n                  n = currentIndex;\n                } else {\n                  i = currentIndex;\n                  n = lastIndex + 1;\n                }\n                var filter = options.filter;\n                for (; i < n; i++) {\n                  if (~multiDragElements.indexOf(children[i])) continue;\n                  // Check if element is draggable\n                  if (!closest(children[i], options.draggable, parentEl, false)) continue;\n                  // Check if element is filtered\n                  var filtered = filter && (typeof filter === 'function' ? filter.call(sortable, evt, children[i], sortable) : filter.split(',').some(function (criteria) {\n                    return closest(children[i], criteria.trim(), parentEl, false);\n                  }));\n                  if (filtered) continue;\n                  toggleClass(children[i], options.selectedClass, true);\n                  multiDragElements.push(children[i]);\n                  dispatchEvent({\n                    sortable: sortable,\n                    rootEl: rootEl,\n                    name: 'select',\n                    targetEl: children[i],\n                    originalEvent: evt\n                  });\n                }\n              })();\n            }\n          } else {\n            lastMultiDragSelect = dragEl$1;\n          }\n          multiDragSortable = toSortable;\n        } else {\n          multiDragElements.splice(multiDragElements.indexOf(dragEl$1), 1);\n          lastMultiDragSelect = null;\n          dispatchEvent({\n            sortable: sortable,\n            rootEl: rootEl,\n            name: 'deselect',\n            targetEl: dragEl$1,\n            originalEvent: evt\n          });\n        }\n      }\n\n      // Multi-drag drop\n      if (dragStarted && this.isMultiDrag) {\n        folding = false;\n        // Do not \"unfold\" after around dragEl if reverted\n        if ((parentEl[expando].options.sort || parentEl !== rootEl) && multiDragElements.length > 1) {\n          var dragRect = getRect(dragEl$1),\n            multiDragIndex = index(dragEl$1, ':not(.' + this.options.selectedClass + ')');\n          if (!initialFolding && options.animation) dragEl$1.thisAnimationDuration = null;\n          toSortable.captureAnimationState();\n          if (!initialFolding) {\n            if (options.animation) {\n              dragEl$1.fromRect = dragRect;\n              multiDragElements.forEach(function (multiDragElement) {\n                multiDragElement.thisAnimationDuration = null;\n                if (multiDragElement !== dragEl$1) {\n                  var rect = folding ? getRect(multiDragElement) : dragRect;\n                  multiDragElement.fromRect = rect;\n\n                  // Prepare unfold animation\n                  toSortable.addAnimationState({\n                    target: multiDragElement,\n                    rect: rect\n                  });\n                }\n              });\n            }\n\n            // Multi drag elements are not necessarily removed from the DOM on drop, so to reinsert\n            // properly they must all be removed\n            removeMultiDragElements();\n            multiDragElements.forEach(function (multiDragElement) {\n              if (children[multiDragIndex]) {\n                parentEl.insertBefore(multiDragElement, children[multiDragIndex]);\n              } else {\n                parentEl.appendChild(multiDragElement);\n              }\n              multiDragIndex++;\n            });\n\n            // If initial folding is done, the elements may have changed position because they are now\n            // unfolding around dragEl, even though dragEl may not have his index changed, so update event\n            // must be fired here as Sortable will not.\n            if (oldIndex === index(dragEl$1)) {\n              var update = false;\n              multiDragElements.forEach(function (multiDragElement) {\n                if (multiDragElement.sortableIndex !== index(multiDragElement)) {\n                  update = true;\n                  return;\n                }\n              });\n              if (update) {\n                dispatchSortableEvent('update');\n                dispatchSortableEvent('sort');\n              }\n            }\n          }\n\n          // Must be done after capturing individual rects (scroll bar)\n          multiDragElements.forEach(function (multiDragElement) {\n            unsetRect(multiDragElement);\n          });\n          toSortable.animateAll();\n        }\n        multiDragSortable = toSortable;\n      }\n\n      // Remove clones if necessary\n      if (rootEl === parentEl || putSortable && putSortable.lastPutMode !== 'clone') {\n        multiDragClones.forEach(function (clone) {\n          clone.parentNode && clone.parentNode.removeChild(clone);\n        });\n      }\n    },\n    nullingGlobal: function nullingGlobal() {\n      this.isMultiDrag = dragStarted = false;\n      multiDragClones.length = 0;\n    },\n    destroyGlobal: function destroyGlobal() {\n      this._deselectMultiDrag();\n      off(document, 'pointerup', this._deselectMultiDrag);\n      off(document, 'mouseup', this._deselectMultiDrag);\n      off(document, 'touchend', this._deselectMultiDrag);\n      off(document, 'keydown', this._checkKeyDown);\n      off(document, 'keyup', this._checkKeyUp);\n    },\n    _deselectMultiDrag: function _deselectMultiDrag(evt) {\n      if (typeof dragStarted !== \"undefined\" && dragStarted) return;\n\n      // Only deselect if selection is in this sortable\n      if (multiDragSortable !== this.sortable) return;\n\n      // Only deselect if target is not item in this sortable\n      if (evt && closest(evt.target, this.options.draggable, this.sortable.el, false)) return;\n\n      // Only deselect if left click\n      if (evt && evt.button !== 0) return;\n      while (multiDragElements.length) {\n        var el = multiDragElements[0];\n        toggleClass(el, this.options.selectedClass, false);\n        multiDragElements.shift();\n        dispatchEvent({\n          sortable: this.sortable,\n          rootEl: this.sortable.el,\n          name: 'deselect',\n          targetEl: el,\n          originalEvent: evt\n        });\n      }\n    },\n    _checkKeyDown: function _checkKeyDown(evt) {\n      if (evt.key === this.options.multiDragKey) {\n        this.multiDragKeyDown = true;\n      }\n    },\n    _checkKeyUp: function _checkKeyUp(evt) {\n      if (evt.key === this.options.multiDragKey) {\n        this.multiDragKeyDown = false;\n      }\n    }\n  };\n  return _extends(MultiDrag, {\n    // Static methods & properties\n    pluginName: 'multiDrag',\n    utils: {\n      /**\r\n       * Selects the provided multi-drag item\r\n       * @param  {HTMLElement} el    The element to be selected\r\n       */\n      select: function select(el) {\n        var sortable = el.parentNode[expando];\n        if (!sortable || !sortable.options.multiDrag || ~multiDragElements.indexOf(el)) return;\n        if (multiDragSortable && multiDragSortable !== sortable) {\n          multiDragSortable.multiDrag._deselectMultiDrag();\n          multiDragSortable = sortable;\n        }\n        toggleClass(el, sortable.options.selectedClass, true);\n        multiDragElements.push(el);\n      },\n      /**\r\n       * Deselects the provided multi-drag item\r\n       * @param  {HTMLElement} el    The element to be deselected\r\n       */\n      deselect: function deselect(el) {\n        var sortable = el.parentNode[expando],\n          index = multiDragElements.indexOf(el);\n        if (!sortable || !sortable.options.multiDrag || !~index) return;\n        toggleClass(el, sortable.options.selectedClass, false);\n        multiDragElements.splice(index, 1);\n      }\n    },\n    eventProperties: function eventProperties() {\n      var _this3 = this;\n      var oldIndicies = [],\n        newIndicies = [];\n      multiDragElements.forEach(function (multiDragElement) {\n        oldIndicies.push({\n          multiDragElement: multiDragElement,\n          index: multiDragElement.sortableIndex\n        });\n\n        // multiDragElements will already be sorted if folding\n        var newIndex;\n        if (folding && multiDragElement !== dragEl$1) {\n          newIndex = -1;\n        } else if (folding) {\n          newIndex = index(multiDragElement, ':not(.' + _this3.options.selectedClass + ')');\n        } else {\n          newIndex = index(multiDragElement);\n        }\n        newIndicies.push({\n          multiDragElement: multiDragElement,\n          index: newIndex\n        });\n      });\n      return {\n        items: _toConsumableArray(multiDragElements),\n        clones: [].concat(multiDragClones),\n        oldIndicies: oldIndicies,\n        newIndicies: newIndicies\n      };\n    },\n    optionListeners: {\n      multiDragKey: function multiDragKey(key) {\n        key = key.toLowerCase();\n        if (key === 'ctrl') {\n          key = 'Control';\n        } else if (key.length > 1) {\n          key = key.charAt(0).toUpperCase() + key.substr(1);\n        }\n        return key;\n      }\n    }\n  });\n}\nfunction insertMultiDragElements(clonesInserted, rootEl) {\n  multiDragElements.forEach(function (multiDragElement, i) {\n    var target = rootEl.children[multiDragElement.sortableIndex + (clonesInserted ? Number(i) : 0)];\n    if (target) {\n      rootEl.insertBefore(multiDragElement, target);\n    } else {\n      rootEl.appendChild(multiDragElement);\n    }\n  });\n}\n\n/**\r\n * Insert multi-drag clones\r\n * @param  {[Boolean]} elementsInserted  Whether the multi-drag elements are inserted\r\n * @param  {HTMLElement} rootEl\r\n */\nfunction insertMultiDragClones(elementsInserted, rootEl) {\n  multiDragClones.forEach(function (clone, i) {\n    var target = rootEl.children[clone.sortableIndex + (elementsInserted ? Number(i) : 0)];\n    if (target) {\n      rootEl.insertBefore(clone, target);\n    } else {\n      rootEl.appendChild(clone);\n    }\n  });\n}\nfunction removeMultiDragElements() {\n  multiDragElements.forEach(function (multiDragElement) {\n    if (multiDragElement === dragEl$1) return;\n    multiDragElement.parentNode && multiDragElement.parentNode.removeChild(multiDragElement);\n  });\n}\n\nSortable.mount(new AutoScrollPlugin());\nSortable.mount(Remove, Revert);\n\nexport default Sortable;\nexport { MultiDragPlugin as MultiDrag, Sortable, SwapPlugin as Swap };\n","import Sortable from 'sortablejs';\nimport type { DataGrid } from './core.js';\n\n/**\n * Configuration for the ColumnManager component\n */\nexport interface ColumnManagerConfig {\n  container: HTMLElement;\n  grid: DataGrid;\n  onReorder?: (order: string[]) => void;\n  onToggle?: (field: string, visible: boolean) => void;\n  onReset?: () => void;\n}\n\n/**\n * ColumnManager - Manages column visibility and ordering with drag-and-drop support\n *\n * Renders a list of columns with:\n * - Search/filter field to find columns quickly\n * - Item count badge showing visible/total columns\n * - Scroll shadows to indicate content above/below fold\n * - Drag handles for reordering\n * - iOS-style switches for visibility toggle\n *\n * Uses safe DOM construction (textContent) to prevent XSS when labels come from server metadata.\n */\nexport class ColumnManager {\n  private container: HTMLElement;\n  private grid: DataGrid;\n  private sortable: Sortable | null = null;\n  private onReorder?: (order: string[]) => void;\n  private onToggle?: (field: string, visible: boolean) => void;\n  private onReset?: () => void;\n  private searchInput: HTMLInputElement | null = null;\n  private columnListEl: HTMLElement | null = null;\n  private countBadgeEl: HTMLElement | null = null;\n\n  constructor(config: ColumnManagerConfig) {\n    this.container = config.container;\n    this.grid = config.grid;\n    this.onReorder = config.onReorder;\n    this.onToggle = config.onToggle;\n    this.onReset = config.onReset;\n    this.initialize();\n  }\n\n  private initialize(): void {\n    // Render column items with switches and drag handles\n    this.render();\n\n    // Setup SortableJS for drag-and-drop\n    this.setupDragAndDrop();\n\n    // Bind switch toggle events\n    this.bindSwitchToggles();\n\n    // Setup scroll shadow detection\n    this.setupScrollShadows();\n  }\n\n  /**\n   * Render column items using safe DOM construction\n   * Uses textContent for labels to prevent XSS\n   */\n  private render(): void {\n    const columns = this.grid.config.columns;\n    const hiddenSet = this.grid.state.hiddenColumns;\n\n    // Clear container\n    this.container.innerHTML = '';\n\n    // Create header with search and count badge\n    const header = this.createHeader(columns.length, columns.length - hiddenSet.size);\n    this.container.appendChild(header);\n\n    // Create column list wrapper for SortableJS\n    const columnList = document.createElement('div');\n    columnList.className = 'column-list';\n    columnList.setAttribute('role', 'list');\n    columnList.setAttribute('aria-label', 'Column visibility and order');\n    this.columnListEl = columnList;\n\n    // Build each column item using DOM APIs (safe from XSS)\n    columns.forEach(col => {\n      const item = this.createColumnItem(col.field, col.label || col.field, !hiddenSet.has(col.field));\n      columnList.appendChild(item);\n    });\n\n    this.container.appendChild(columnList);\n\n    // Add Reset to Default button at the bottom\n    const footer = this.createFooter();\n    this.container.appendChild(footer);\n  }\n\n  /**\n   * Create header with search input and count badge\n   */\n  private createHeader(totalCount: number, visibleCount: number): HTMLElement {\n    const header = document.createElement('div');\n    header.className = 'column-manager-header';\n\n    // Search input container\n    const searchContainer = document.createElement('div');\n    searchContainer.className = 'column-search-container';\n\n    const searchIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    searchIcon.setAttribute('class', 'column-search-icon');\n    searchIcon.setAttribute('viewBox', '0 0 24 24');\n    searchIcon.setAttribute('fill', 'none');\n    searchIcon.setAttribute('stroke', 'currentColor');\n    searchIcon.setAttribute('stroke-width', '2');\n    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n    circle.setAttribute('cx', '11');\n    circle.setAttribute('cy', '11');\n    circle.setAttribute('r', '8');\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.setAttribute('d', 'm21 21-4.3-4.3');\n    searchIcon.appendChild(circle);\n    searchIcon.appendChild(path);\n\n    const searchInput = document.createElement('input');\n    searchInput.type = 'text';\n    searchInput.className = 'column-search-input';\n    searchInput.placeholder = 'Filter columns...';\n    searchInput.setAttribute('aria-label', 'Filter columns');\n    this.searchInput = searchInput;\n\n    // Bind search input\n    searchInput.addEventListener('input', () => {\n      this.filterColumns(searchInput.value);\n    });\n\n    searchContainer.appendChild(searchIcon);\n    searchContainer.appendChild(searchInput);\n\n    // Count badge\n    const countBadge = document.createElement('span');\n    countBadge.className = 'column-count-badge';\n    countBadge.textContent = `${visibleCount} of ${totalCount}`;\n    countBadge.setAttribute('aria-live', 'polite');\n    this.countBadgeEl = countBadge;\n\n    header.appendChild(searchContainer);\n    header.appendChild(countBadge);\n\n    return header;\n  }\n\n  /**\n   * Filter columns by search term\n   */\n  private filterColumns(searchTerm: string): void {\n    const term = searchTerm.toLowerCase().trim();\n    const items = this.container.querySelectorAll('.column-item');\n\n    items.forEach((item) => {\n      const label = item.querySelector('.column-label')?.textContent?.toLowerCase() || '';\n      const matches = term === '' || label.includes(term);\n      (item as HTMLElement).style.display = matches ? '' : 'none';\n    });\n\n    // Update scroll shadows after filtering\n    this.updateScrollShadows();\n  }\n\n  /**\n   * Update the count badge\n   */\n  private updateCountBadge(): void {\n    if (!this.countBadgeEl) return;\n\n    const columns = this.grid.config.columns;\n    const hiddenSet = this.grid.state.hiddenColumns;\n    const visibleCount = columns.length - hiddenSet.size;\n\n    this.countBadgeEl.textContent = `${visibleCount} of ${columns.length}`;\n  }\n\n  /**\n   * Setup scroll shadow detection on the column list\n   */\n  private setupScrollShadows(): void {\n    if (!this.columnListEl) return;\n\n    // Initial check\n    this.updateScrollShadows();\n\n    // Update on scroll\n    this.columnListEl.addEventListener('scroll', () => {\n      this.updateScrollShadows();\n    });\n\n    // Update on resize (debounced)\n    const resizeObserver = new ResizeObserver(() => {\n      this.updateScrollShadows();\n    });\n    resizeObserver.observe(this.columnListEl);\n  }\n\n  /**\n   * Update scroll shadow classes based on scroll position\n   */\n  private updateScrollShadows(): void {\n    if (!this.columnListEl) return;\n\n    const el = this.columnListEl;\n    const scrollTop = el.scrollTop;\n    const scrollHeight = el.scrollHeight;\n    const clientHeight = el.clientHeight;\n\n    // Check if content is scrollable\n    const isScrollable = scrollHeight > clientHeight;\n\n    // Determine shadow states\n    const hasTopShadow = isScrollable && scrollTop > 0;\n    const hasBottomShadow = isScrollable && (scrollTop + clientHeight) < (scrollHeight - 1);\n\n    // Apply classes\n    el.classList.toggle('column-list--shadow-top', hasTopShadow);\n    el.classList.toggle('column-list--shadow-bottom', hasBottomShadow);\n  }\n\n  /**\n   * Create footer with Reset to Default button\n   */\n  private createFooter(): HTMLElement {\n    const footer = document.createElement('div');\n    footer.className = 'column-manager-footer';\n\n    const resetBtn = document.createElement('button');\n    resetBtn.type = 'button';\n    resetBtn.className = 'column-reset-btn';\n    resetBtn.setAttribute('aria-label', 'Reset columns to default');\n\n    // Reset icon (SVG)\n    const resetIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    resetIcon.setAttribute('class', 'column-reset-icon');\n    resetIcon.setAttribute('viewBox', '0 0 24 24');\n    resetIcon.setAttribute('fill', 'none');\n    resetIcon.setAttribute('stroke', 'currentColor');\n    resetIcon.setAttribute('stroke-width', '2');\n    resetIcon.setAttribute('stroke-linecap', 'round');\n    resetIcon.setAttribute('stroke-linejoin', 'round');\n\n    // Rotate CCW icon path\n    const path1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path1.setAttribute('d', 'M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8');\n    const path2 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path2.setAttribute('d', 'M3 3v5h5');\n    resetIcon.appendChild(path1);\n    resetIcon.appendChild(path2);\n\n    const resetText = document.createElement('span');\n    resetText.textContent = 'Reset to Default';\n\n    resetBtn.appendChild(resetIcon);\n    resetBtn.appendChild(resetText);\n\n    // Bind reset click handler\n    resetBtn.addEventListener('click', () => {\n      this.handleReset();\n    });\n\n    footer.appendChild(resetBtn);\n    return footer;\n  }\n\n  /**\n   * Handle reset button click\n   */\n  private handleReset(): void {\n    this.grid.resetColumnsToDefault();\n    this.onReset?.();\n\n    // Clear search and update UI\n    if (this.searchInput) {\n      this.searchInput.value = '';\n      this.filterColumns('');\n    }\n    this.updateCountBadge();\n  }\n\n  /**\n   * Create a single column item element\n   * Uses DOM APIs with textContent for safe label rendering\n   * Includes full ARIA support for accessibility\n   */\n  private createColumnItem(field: string, label: string, isVisible: boolean): HTMLElement {\n    const itemId = `column-item-${field}`;\n    const switchId = `column-switch-${field}`;\n\n    const item = document.createElement('div');\n    item.className = 'column-item';\n    item.id = itemId;\n    item.dataset.column = field;\n    item.setAttribute('role', 'listitem');\n\n    // Content wrapper (drag handle + label)\n    const content = document.createElement('div');\n    content.className = 'column-item-content';\n\n    // Drag handle SVG with accessibility\n    const dragHandle = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    dragHandle.setAttribute('class', 'drag-handle');\n    dragHandle.setAttribute('viewBox', '0 0 20 20');\n    dragHandle.setAttribute('fill', 'currentColor');\n    dragHandle.setAttribute('aria-hidden', 'true');  // Decorative, hidden from screen readers\n    dragHandle.setAttribute('focusable', 'false');\n\n    // Create 6 dots for drag handle (2x3 grid)\n    const dotPositions = [\n      [5, 4], [5, 10], [5, 16],\n      [11, 4], [11, 10], [11, 16]\n    ];\n    dotPositions.forEach(([cx, cy]) => {\n      const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n      circle.setAttribute('cx', String(cx));\n      circle.setAttribute('cy', String(cy));\n      circle.setAttribute('r', '1.5');\n      dragHandle.appendChild(circle);\n    });\n\n    // Label (uses textContent for XSS safety)\n    const labelSpan = document.createElement('span');\n    labelSpan.className = 'column-label';\n    labelSpan.id = `${itemId}-label`;\n    labelSpan.textContent = label;\n\n    content.appendChild(dragHandle);\n    content.appendChild(labelSpan);\n\n    // Switch toggle with full accessibility\n    const switchLabel = document.createElement('label');\n    switchLabel.className = 'column-switch';\n    switchLabel.htmlFor = switchId;\n\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.id = switchId;\n    checkbox.dataset.column = field;\n    checkbox.checked = isVisible;\n    checkbox.setAttribute('role', 'switch');\n    checkbox.setAttribute('aria-checked', String(isVisible));\n    checkbox.setAttribute('aria-labelledby', `${itemId}-label`);\n    checkbox.setAttribute('aria-describedby', `${itemId}-desc`);\n\n    // Hidden description for screen readers\n    const description = document.createElement('span');\n    description.id = `${itemId}-desc`;\n    description.className = 'sr-only';\n    description.textContent = `Press Space or Enter to toggle ${label} column visibility. Currently ${isVisible ? 'visible' : 'hidden'}.`;\n\n    const slider = document.createElement('span');\n    slider.className = 'column-switch-slider';\n    slider.setAttribute('aria-hidden', 'true');  // Visual-only element\n\n    switchLabel.appendChild(checkbox);\n    switchLabel.appendChild(slider);\n\n    item.appendChild(content);\n    item.appendChild(switchLabel);\n    item.appendChild(description);\n\n    return item;\n  }\n\n  /**\n   * Setup SortableJS for drag-and-drop reordering\n   */\n  private setupDragAndDrop(): void {\n    // SortableJS should be attached to the column-list wrapper, not the container\n    const columnList = this.container.querySelector('.column-list') || this.container;\n\n    this.sortable = Sortable.create(columnList as HTMLElement, {\n      animation: 150,\n      handle: '.drag-handle',\n      ghostClass: 'column-item-ghost',\n      dragClass: 'column-item-drag',\n      chosenClass: 'column-item-chosen',\n      // Touch handling for mobile\n      touchStartThreshold: 3,\n      delay: 100,\n      delayOnTouchOnly: true,\n      onEnd: () => {\n        // Get current column order from DOM\n        const items = columnList.querySelectorAll('.column-item');\n        const newOrder = Array.from(items).map(item =>\n          (item as HTMLElement).dataset.column!\n        );\n\n        // Notify via callback if provided\n        if (this.onReorder) {\n          this.onReorder(newOrder);\n        }\n\n        // Apply to grid (Phase FE2)\n        this.grid.reorderColumns(newOrder);\n\n        // Also persist via behavior layer\n        this.grid.config.behaviors?.columnVisibility?.reorderColumns?.(newOrder, this.grid);\n      }\n    });\n  }\n\n  /**\n   * Bind change events for visibility switches\n   * Includes ARIA state updates for accessibility\n   */\n  private bindSwitchToggles(): void {\n    const switches = this.container.querySelectorAll<HTMLInputElement>('input[type=\"checkbox\"]');\n\n    switches.forEach((checkbox) => {\n      checkbox.addEventListener('change', () => {\n        const field = checkbox.dataset.column;\n        if (!field) return;\n\n        const isVisible = checkbox.checked;\n\n        // Update ARIA attributes\n        checkbox.setAttribute('aria-checked', String(isVisible));\n\n        // Update description text\n        const descId = `column-item-${field}-desc`;\n        const description = this.container.querySelector(`#${descId}`);\n        if (description) {\n          const label = this.container.querySelector(`#column-item-${field}-label`)?.textContent || field;\n          description.textContent = `Press Space or Enter to toggle ${label} column visibility. Currently ${isVisible ? 'visible' : 'hidden'}.`;\n        }\n\n        // Notify via callback if provided\n        if (this.onToggle) {\n          this.onToggle(field, isVisible);\n        }\n\n        // Use behavior layer for toggle\n        if (this.grid.config.behaviors?.columnVisibility) {\n          this.grid.config.behaviors.columnVisibility.toggleColumn(field, this.grid);\n        }\n\n        // Update count badge\n        this.updateCountBadge();\n      });\n    });\n  }\n\n  /**\n   * Update the switch state for a specific column\n   * Called when visibility changes externally (e.g., URL restore)\n   * Also updates ARIA attributes for accessibility\n   */\n  updateSwitchState(field: string, isVisible: boolean): void {\n    const checkbox = this.container.querySelector<HTMLInputElement>(\n      `input[type=\"checkbox\"][data-column=\"${field}\"]`\n    );\n    if (checkbox) {\n      checkbox.checked = isVisible;\n      checkbox.setAttribute('aria-checked', String(isVisible));\n    }\n  }\n\n  /**\n   * Sync all switch states with current grid state\n   */\n  syncWithGridState(): void {\n    const hiddenSet = this.grid.state.hiddenColumns;\n    this.grid.config.columns.forEach(col => {\n      this.updateSwitchState(col.field, !hiddenSet.has(col.field));\n    });\n    this.updateCountBadge();\n  }\n\n  /**\n   * Get the current column order from the DOM\n   */\n  getColumnOrder(): string[] {\n    const items = this.container.querySelectorAll('.column-item');\n    return Array.from(items).map(item => (item as HTMLElement).dataset.column!);\n  }\n\n  /**\n   * Re-render the column list (e.g., after columns change)\n   */\n  refresh(): void {\n    // Re-render replaces the `.column-list` node, so Sortable must be re-initialized.\n    this.destroy();\n    this.render();\n    this.setupDragAndDrop();\n    this.bindSwitchToggles();\n    this.setupScrollShadows();\n  }\n\n  /**\n   * Cleanup - destroy SortableJS instance\n   */\n  destroy(): void {\n    if (this.sortable) {\n      this.sortable.destroy();\n      this.sortable = null;\n    }\n  }\n}\n\n// Export for module usage\nexport default ColumnManager;\n","/**\n * Grouped Mode Utilities for DataGrid (Phase 2)\n *\n * Provides data transformation, state management, and rendering support\n * for translation-grouped content views.\n *\n * Contract:\n * - Groups records by `translation_group_id`\n * - Preserves backend-provided group summaries when available\n * - Falls back to client-computed summaries when backend omits them\n * - Maintains expand/collapse state with persistence\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * View mode for DataGrid\n */\nexport type ViewMode = 'flat' | 'grouped' | 'matrix';\n\n/**\n * Group summary from backend or computed locally\n */\nexport interface GroupSummary {\n  /** Total items in the group */\n  totalItems: number;\n  /** Number of available/complete locales */\n  availableLocales: string[];\n  /** Number of missing locales */\n  missingLocales: string[];\n  /** Overall readiness state */\n  readinessState: 'ready' | 'missing_locales' | 'missing_fields' | 'missing_locales_and_fields' | null;\n  /** Ready for publish transition */\n  readyForPublish: boolean | null;\n}\n\n/**\n * A group of records sharing the same translation_group_id\n */\nexport interface RecordGroup {\n  /** The translation_group_id */\n  groupId: string;\n  /** Records in this group */\n  records: Record<string, unknown>[];\n  /** Group summary (from backend or computed) */\n  summary: GroupSummary;\n  /** Whether this group is expanded (for UI) */\n  expanded: boolean;\n  /** Whether summary came from backend */\n  summaryFromBackend: boolean;\n}\n\n/**\n * Result of grouping transformation\n */\nexport interface GroupedData {\n  /** Groups of records */\n  groups: RecordGroup[];\n  /** Ungrouped records (no translation_group_id) */\n  ungrouped: Record<string, unknown>[];\n  /** Total group count */\n  totalGroups: number;\n  /** Total record count */\n  totalRecords: number;\n}\n\n/**\n * Options for group transformation\n */\nexport interface GroupTransformOptions {\n  /** Field to group by (default: translation_group_id) */\n  groupByField?: string;\n  /** Default expanded state for groups */\n  defaultExpanded?: boolean;\n  /** Previously expanded group IDs */\n  expandedGroups?: Set<string>;\n}\n\n// ============================================================================\n// Group Data Transformation (TX-055)\n// ============================================================================\n\n/**\n * Transform flat records into grouped structure by translation_group_id.\n *\n * @param records - Array of records from API\n * @param options - Grouping options\n * @returns Grouped data structure\n */\nexport function transformToGroups(\n  records: Record<string, unknown>[],\n  options: GroupTransformOptions = {}\n): GroupedData {\n  const {\n    groupByField = 'translation_group_id',\n    defaultExpanded = true,\n    expandedGroups = new Set<string>(),\n  } = options;\n\n  const groupMap = new Map<string, Record<string, unknown>[]>();\n  const ungrouped: Record<string, unknown>[] = [];\n\n  // Partition records by group ID\n  for (const record of records) {\n    const groupId = getGroupId(record, groupByField);\n\n    if (groupId) {\n      const existing = groupMap.get(groupId);\n      if (existing) {\n        existing.push(record);\n      } else {\n        groupMap.set(groupId, [record]);\n      }\n    } else {\n      ungrouped.push(record);\n    }\n  }\n\n  // Transform map to RecordGroup array\n  const groups: RecordGroup[] = [];\n  for (const [groupId, groupRecords] of groupMap) {\n    const summary = computeGroupSummary(groupRecords);\n    const expanded = expandedGroups.has(groupId) || (expandedGroups.size === 0 && defaultExpanded);\n\n    groups.push({\n      groupId,\n      records: groupRecords,\n      summary,\n      expanded,\n      summaryFromBackend: false, // We're computing client-side here\n    });\n  }\n\n  // Sort groups by first record's order (preserve API sort)\n  groups.sort((a, b) => {\n    const aIndex = records.indexOf(a.records[0]);\n    const bIndex = records.indexOf(b.records[0]);\n    return aIndex - bIndex;\n  });\n\n  return {\n    groups,\n    ungrouped,\n    totalGroups: groups.length,\n    totalRecords: records.length,\n  };\n}\n\n/**\n * Extract group ID from a record.\n */\nfunction getGroupId(record: Record<string, unknown>, field: string): string | null {\n  const value = record[field];\n  if (typeof value === 'string' && value.trim()) {\n    return value;\n  }\n\n  // Try nested paths (e.g., translation.meta.translation_group_id)\n  const nestedPaths = [\n    `translation.meta.${field}`,\n    `content_translation.meta.${field}`,\n  ];\n\n  for (const path of nestedPaths) {\n    const nested = getNestedValue(record, path);\n    if (typeof nested === 'string' && nested.trim()) {\n      return nested;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get nested value from object by dot-separated path.\n */\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  const parts = path.split('.');\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined || typeof current !== 'object') {\n      return undefined;\n    }\n    current = (current as Record<string, unknown>)[part];\n  }\n\n  return current;\n}\n\n/**\n * Compute group summary from records (client-side fallback).\n * Backend summary should be preferred when available.\n */\nfunction computeGroupSummary(records: Record<string, unknown>[]): GroupSummary {\n  const allAvailable = new Set<string>();\n  const allMissing = new Set<string>();\n  let hasIncomplete = false;\n  let readyCount = 0;\n\n  for (const record of records) {\n    const readiness = record.translation_readiness as Record<string, unknown> | undefined;\n\n    if (readiness) {\n      const available = readiness.available_locales;\n      const missing = readiness.missing_required_locales;\n      const state = readiness.readiness_state;\n\n      if (Array.isArray(available)) {\n        available.filter(isString).forEach((loc) => allAvailable.add(loc));\n      }\n      if (Array.isArray(missing)) {\n        missing.filter(isString).forEach((loc) => allMissing.add(loc));\n      }\n      if (state === 'missing_fields' || state === 'missing_locales_and_fields') {\n        hasIncomplete = true;\n      }\n      if (state === 'ready') {\n        readyCount++;\n      }\n    }\n\n    // Also check legacy available_locales\n    const legacyAvailable = record.available_locales;\n    if (Array.isArray(legacyAvailable)) {\n      legacyAvailable.filter(isString).forEach((loc) => allAvailable.add(loc));\n    }\n  }\n\n  // Determine overall readiness state\n  let readinessState: GroupSummary['readinessState'] = null;\n  if (records.length > 0) {\n    const allReady = readyCount === records.length;\n    const hasMissing = allMissing.size > 0;\n\n    if (allReady) {\n      readinessState = 'ready';\n    } else if (hasMissing && hasIncomplete) {\n      readinessState = 'missing_locales_and_fields';\n    } else if (hasMissing) {\n      readinessState = 'missing_locales';\n    } else if (hasIncomplete) {\n      readinessState = 'missing_fields';\n    }\n  }\n\n  return {\n    totalItems: records.length,\n    availableLocales: Array.from(allAvailable),\n    missingLocales: Array.from(allMissing),\n    readinessState,\n    readyForPublish: readinessState === 'ready',\n  };\n}\n\nfunction isString(value: unknown): value is string {\n  return typeof value === 'string';\n}\n\n// ============================================================================\n// Backend Summary Merging\n// ============================================================================\n\n/**\n * Merge backend-provided group summaries into grouped data.\n * Backend summaries override client-computed summaries.\n *\n * @param groupedData - Client-computed grouped data\n * @param backendSummaries - Map of groupId to backend summary\n * @returns Grouped data with backend summaries merged\n */\nexport function mergeBackendSummaries(\n  groupedData: GroupedData,\n  backendSummaries: Map<string, Partial<GroupSummary>>\n): GroupedData {\n  const groups = groupedData.groups.map((group) => {\n    const backendSummary = backendSummaries.get(group.groupId);\n    if (backendSummary) {\n      return {\n        ...group,\n        summary: {\n          ...group.summary,\n          ...backendSummary,\n        },\n        summaryFromBackend: true,\n      };\n    }\n    return group;\n  });\n\n  return {\n    ...groupedData,\n    groups,\n  };\n}\n\n/**\n * Extract backend summaries from API response metadata.\n * Looks for `group_summaries` in response.\n */\nexport function extractBackendSummaries(\n  response: Record<string, unknown>\n): Map<string, Partial<GroupSummary>> {\n  const summaries = new Map<string, Partial<GroupSummary>>();\n\n  const groupSummaries = response.group_summaries;\n  if (!groupSummaries || typeof groupSummaries !== 'object' || Array.isArray(groupSummaries)) {\n    return summaries;\n  }\n\n  for (const [groupId, summary] of Object.entries(groupSummaries as Record<string, unknown>)) {\n    if (summary && typeof summary === 'object') {\n      const s = summary as Record<string, unknown>;\n      summaries.set(groupId, {\n        totalItems: typeof s.total_items === 'number' ? s.total_items : undefined,\n        availableLocales: Array.isArray(s.available_locales) ? s.available_locales.filter(isString) : undefined,\n        missingLocales: Array.isArray(s.missing_locales) ? s.missing_locales.filter(isString) : undefined,\n        readinessState: isValidReadinessState(s.readiness_state) ? s.readiness_state : undefined,\n        readyForPublish: typeof s.ready_for_publish === 'boolean' ? s.ready_for_publish : undefined,\n      });\n    }\n  }\n\n  return summaries;\n}\n\nfunction isValidReadinessState(\n  value: unknown\n): value is 'ready' | 'missing_locales' | 'missing_fields' | 'missing_locales_and_fields' {\n  return (\n    value === 'ready' ||\n    value === 'missing_locales' ||\n    value === 'missing_fields' ||\n    value === 'missing_locales_and_fields'\n  );\n}\n\n// ============================================================================\n// Expand/Collapse State Management (TX-057)\n// ============================================================================\n\nconst EXPAND_STATE_KEY_PREFIX = 'datagrid-expand-state-';\n\n/**\n * Get persisted expand state for a panel.\n */\nexport function getPersistedExpandState(panelId: string): Set<string> {\n  try {\n    const key = EXPAND_STATE_KEY_PREFIX + panelId;\n    const stored = localStorage.getItem(key);\n    if (stored) {\n      const parsed = JSON.parse(stored);\n      if (Array.isArray(parsed)) {\n        return new Set(parsed.filter(isString));\n      }\n    }\n  } catch {\n    // Ignore storage errors\n  }\n  return new Set<string>();\n}\n\n/**\n * Persist expand state for a panel.\n */\nexport function persistExpandState(panelId: string, expandedGroups: Set<string>): void {\n  try {\n    const key = EXPAND_STATE_KEY_PREFIX + panelId;\n    localStorage.setItem(key, JSON.stringify(Array.from(expandedGroups)));\n  } catch {\n    // Ignore storage errors\n  }\n}\n\n/**\n * Toggle expand state for a group.\n */\nexport function toggleGroupExpand(\n  groupedData: GroupedData,\n  groupId: string\n): GroupedData {\n  const groups = groupedData.groups.map((group) => {\n    if (group.groupId === groupId) {\n      return { ...group, expanded: !group.expanded };\n    }\n    return group;\n  });\n\n  return { ...groupedData, groups };\n}\n\n/**\n * Expand all groups.\n */\nexport function expandAllGroups(groupedData: GroupedData): GroupedData {\n  const groups = groupedData.groups.map((group) => ({\n    ...group,\n    expanded: true,\n  }));\n  return { ...groupedData, groups };\n}\n\n/**\n * Collapse all groups.\n */\nexport function collapseAllGroups(groupedData: GroupedData): GroupedData {\n  const groups = groupedData.groups.map((group) => ({\n    ...group,\n    expanded: false,\n  }));\n  return { ...groupedData, groups };\n}\n\n/**\n * Get set of currently expanded group IDs.\n */\nexport function getExpandedGroupIds(groupedData: GroupedData): Set<string> {\n  const expanded = new Set<string>();\n  for (const group of groupedData.groups) {\n    if (group.expanded) {\n      expanded.add(group.groupId);\n    }\n  }\n  return expanded;\n}\n\n// ============================================================================\n// View Mode Persistence (TX-034)\n// ============================================================================\n\nconst VIEW_MODE_KEY_PREFIX = 'datagrid-view-mode-';\n\n/**\n * Get persisted view mode for a panel.\n */\nexport function getPersistedViewMode(panelId: string): ViewMode | null {\n  try {\n    const key = VIEW_MODE_KEY_PREFIX + panelId;\n    const stored = localStorage.getItem(key);\n    if (stored && isValidViewMode(stored)) {\n      return stored;\n    }\n  } catch {\n    // Ignore storage errors\n  }\n  return null;\n}\n\n/**\n * Persist view mode for a panel.\n */\nexport function persistViewMode(panelId: string, mode: ViewMode): void {\n  try {\n    const key = VIEW_MODE_KEY_PREFIX + panelId;\n    localStorage.setItem(key, mode);\n  } catch {\n    // Ignore storage errors\n  }\n}\n\nfunction isValidViewMode(value: string): value is ViewMode {\n  return value === 'flat' || value === 'grouped' || value === 'matrix';\n}\n\n// ============================================================================\n// Group Rendering Helpers (TX-056)\n// ============================================================================\n\n/**\n * Render group header summary HTML.\n * Displays locale completeness and readiness state.\n */\nexport function renderGroupHeaderSummary(\n  group: RecordGroup,\n  options: { size?: 'sm' | 'md' } = {}\n): string {\n  const { summary } = group;\n  const { size = 'sm' } = options;\n\n  const textSize = size === 'sm' ? 'text-xs' : 'text-sm';\n  const availableCount = summary.availableLocales.length;\n  const missingCount = summary.missingLocales.length;\n  const totalLocales = availableCount + missingCount;\n\n  // Readiness badge\n  let readinessBadge = '';\n  if (summary.readinessState) {\n    const stateConfig = getReadinessStateConfig(summary.readinessState);\n    readinessBadge = `\n      <span class=\"${textSize} px-1.5 py-0.5 rounded ${stateConfig.bgClass} ${stateConfig.textClass}\"\n            title=\"${stateConfig.description}\">\n        ${stateConfig.icon} ${stateConfig.label}\n      </span>\n    `;\n  }\n\n  // Locale count\n  const localeCount = totalLocales > 0\n    ? `<span class=\"${textSize} text-gray-500\">${availableCount}/${totalLocales} locales</span>`\n    : '';\n\n  // Item count\n  const itemCount = `<span class=\"${textSize} text-gray-500\">${summary.totalItems} item${summary.totalItems !== 1 ? 's' : ''}</span>`;\n\n  return `\n    <div class=\"inline-flex items-center gap-2\">\n      ${readinessBadge}\n      ${localeCount}\n      ${itemCount}\n    </div>\n  `;\n}\n\n/**\n * Get configuration for readiness state display.\n */\nfunction getReadinessStateConfig(state: GroupSummary['readinessState']): {\n  icon: string;\n  label: string;\n  bgClass: string;\n  textClass: string;\n  description: string;\n} {\n  switch (state) {\n    case 'ready':\n      return {\n        icon: '',\n        label: 'Ready',\n        bgClass: 'bg-green-100',\n        textClass: 'text-green-700',\n        description: 'All translations complete',\n      };\n    case 'missing_locales':\n      return {\n        icon: '',\n        label: 'Missing',\n        bgClass: 'bg-amber-100',\n        textClass: 'text-amber-700',\n        description: 'Missing required locale translations',\n      };\n    case 'missing_fields':\n      return {\n        icon: '',\n        label: 'Incomplete',\n        bgClass: 'bg-yellow-100',\n        textClass: 'text-yellow-700',\n        description: 'Has translations but missing required fields',\n      };\n    case 'missing_locales_and_fields':\n      return {\n        icon: '',\n        label: 'Not Ready',\n        bgClass: 'bg-red-100',\n        textClass: 'text-red-700',\n        description: 'Missing translations and required fields',\n      };\n    default:\n      return {\n        icon: '?',\n        label: 'Unknown',\n        bgClass: 'bg-gray-100',\n        textClass: 'text-gray-700',\n        description: 'Status unknown',\n      };\n  }\n}\n\n/**\n * Render group header row HTML for the DataGrid.\n */\nexport function renderGroupHeaderRow(\n  group: RecordGroup,\n  colSpan: number,\n  options: { showExpandIcon?: boolean } = {}\n): string {\n  const { showExpandIcon = true } = options;\n  const expandIcon = showExpandIcon\n    ? `<span class=\"expand-icon mr-2\" aria-hidden=\"true\">${group.expanded ? '' : ''}</span>`\n    : '';\n\n  const summaryHtml = renderGroupHeaderSummary(group);\n\n  return `\n    <tr class=\"group-header bg-gray-50 hover:bg-gray-100 cursor-pointer border-b border-gray-200\"\n        data-group-id=\"${escapeAttr(group.groupId)}\"\n        data-expanded=\"${group.expanded}\"\n        role=\"row\"\n        aria-expanded=\"${group.expanded}\"\n        tabindex=\"0\">\n      <td colspan=\"${colSpan + 2}\" class=\"px-4 py-2\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex items-center\">\n            ${expandIcon}\n            <span class=\"font-medium text-gray-700\">Group: ${escapeHtml(group.groupId.slice(0, 12))}...</span>\n          </div>\n          ${summaryHtml}\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n/**\n * Escape HTML special characters.\n */\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\n/**\n * Escape attribute value.\n */\nfunction escapeAttr(str: string): string {\n  return escapeHtml(str);\n}\n\n// ============================================================================\n// Empty and Loading States (TX-061, TX-062)\n// ============================================================================\n\n/**\n * Render grouped mode empty state.\n */\nexport function renderGroupedEmptyState(colSpan: number): string {\n  return `\n    <tr>\n      <td colspan=\"${colSpan + 2}\" class=\"px-6 py-12 text-center\">\n        <div class=\"text-gray-500\">\n          <svg class=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                  d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n          <h3 class=\"mt-2 text-sm font-medium text-gray-900\">No translation groups</h3>\n          <p class=\"mt-1 text-sm text-gray-500\">No grouped translations found for this content type.</p>\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n/**\n * Render grouped mode loading state.\n */\nexport function renderGroupedLoadingState(colSpan: number): string {\n  return `\n    <tr>\n      <td colspan=\"${colSpan + 2}\" class=\"px-6 py-12 text-center\">\n        <div class=\"flex items-center justify-center\">\n          <svg class=\"animate-spin h-8 w-8 text-blue-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          <span class=\"ml-2 text-gray-500\">Loading groups...</span>\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n// ============================================================================\n// Error Boundary (TX-060)\n// ============================================================================\n\n/**\n * Render grouped mode error state.\n */\nexport function renderGroupedErrorState(\n  colSpan: number,\n  error: string,\n  onRetry?: () => void\n): string {\n  const retryButton = onRetry\n    ? `<button type=\"button\" class=\"mt-2 px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600\" onclick=\"this.dispatchEvent(new CustomEvent('retry', { bubbles: true }))\">Retry</button>`\n    : '';\n\n  return `\n    <tr>\n      <td colspan=\"${colSpan + 2}\" class=\"px-6 py-12 text-center\">\n        <div class=\"text-red-500\">\n          <svg class=\"mx-auto h-12 w-12\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n          <h3 class=\"mt-2 text-sm font-medium text-gray-900\">Error loading groups</h3>\n          <p class=\"mt-1 text-sm text-gray-500\">${escapeHtml(error)}</p>\n          ${retryButton}\n        </div>\n      </td>\n    </tr>\n  `;\n}\n\n// ============================================================================\n// Mobile/Responsive Helpers (TX-063)\n// ============================================================================\n\n/**\n * Check if we're in narrow viewport mode.\n */\nexport function isNarrowViewport(breakpoint: number = 768): boolean {\n  if (typeof window === 'undefined') return false;\n  return window.innerWidth < breakpoint;\n}\n\n/**\n * Get recommended view mode for viewport.\n * On narrow viewports, prefer flat mode over grouped.\n */\nexport function getViewModeForViewport(\n  preferredMode: ViewMode,\n  breakpoint: number = 768\n): ViewMode {\n  if (isNarrowViewport(breakpoint) && preferredMode === 'grouped') {\n    return 'flat';\n  }\n  return preferredMode;\n}\n","import type {\n  ColumnDefinition,\n  ColumnFilter,\n  SortColumn,\n  DataGridBehaviors\n} from './behaviors/types.js';\nimport type { ActionButton, BulkActionConfig, ActionRenderMode } from './actions.js';\nimport type { CellRenderer, CellRendererContext } from './renderers.js';\nimport type { ToastNotifier } from '../toast/types.js';\nimport type { ViewMode, GroupedData, RecordGroup } from './grouped-mode.js';\nimport { ActionRenderer } from './actions.js';\nimport { CellRendererRegistry } from './renderers.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\nimport { extractErrorMessage } from '../toast/error-helpers.js';\nimport { ColumnManager } from './column-manager.js';\nimport {\n  transformToGroups,\n  extractBackendSummaries,\n  mergeBackendSummaries,\n  getPersistedExpandState,\n  persistExpandState,\n  getPersistedViewMode,\n  persistViewMode,\n  renderGroupHeaderRow,\n  renderGroupedEmptyState,\n  renderGroupedLoadingState,\n  renderGroupedErrorState,\n  getViewModeForViewport,\n  getExpandedGroupIds,\n} from './grouped-mode.js';\n\n/**\n * DataGrid configuration\n */\nexport interface DataGridConfig {\n  tableId: string;\n  apiEndpoint: string;\n  /**\n   * Optional base path for view/edit links (UI routes). Falls back to apiEndpoint.\n   */\n  actionBasePath?: string;\n  columns: ColumnDefinition[];\n  perPage?: number;\n  searchDelay?: number;\n  behaviors?: DataGridBehaviors;\n  selectors?: Partial<DataGridSelectors>;\n\n  // Extension points\n  /**\n   * Custom row actions (overrides default view/edit/delete)\n   */\n  rowActions?: (record: any) => ActionButton[];\n  /**\n   * Custom bulk actions\n   */\n  bulkActions?: BulkActionConfig[];\n  /**\n   * Custom cell renderers (field name -> renderer function)\n   */\n  cellRenderers?: Record<string, CellRenderer>;\n  /**\n   * Custom row class provider\n   */\n  rowClassProvider?: (record: any) => string[];\n  /**\n   * Use default actions (view, edit, delete)\n   */\n  useDefaultActions?: boolean;\n  /**\n   * Action rendering mode: 'inline' (buttons) or 'dropdown' (menu)\n   */\n  actionRenderMode?: ActionRenderMode;\n  /**\n   * Toast notification handler (optional)\n   * If not provided, falls back to native alert/confirm\n   */\n  notifier?: ToastNotifier;\n  /**\n   * Panel identifier for state persistence (Phase 2 grouped mode)\n   */\n  panelId?: string;\n  /**\n   * Enable grouped mode support (Phase 2)\n   * When true, records can be grouped by translation_group_id\n   */\n  enableGroupedMode?: boolean;\n  /**\n   * Default view mode: 'flat', 'grouped', or 'matrix' (Phase 2)\n   */\n  defaultViewMode?: ViewMode;\n  /**\n   * Field to group by (default: translation_group_id)\n   */\n  groupByField?: string;\n}\n\n/**\n * DOM element selectors\n */\ninterface DataGridSelectors {\n  table: string;\n  searchInput: string;\n  perPageSelect: string;\n  filterRow: string;\n  columnToggleBtn: string;\n  columnToggleMenu: string;\n  exportBtn: string;\n  exportMenu: string;\n  paginationContainer: string;\n  tableInfoStart: string;\n  tableInfoEnd: string;\n  tableInfoTotal: string;\n  selectAllCheckbox: string;\n  rowCheckboxes: string;\n  bulkActionsBar: string;\n  selectedCount: string;\n}\n\n/**\n * DataGrid state\n */\ninterface DataGridState {\n  currentPage: number;\n  perPage: number;\n  totalRows: number;\n  search: string;\n  filters: ColumnFilter[];\n  sort: SortColumn[];\n  selectedRows: Set<string>;\n  hiddenColumns: Set<string>;\n  columnOrder: string[];  // Ordered list of column fields (Phase FE2)\n  // Phase 2: Grouped mode state\n  viewMode: ViewMode;\n  groupedData: GroupedData | null;\n  expandedGroups: Set<string>;\n}\n\n/**\n * API response format (go-crud default)\n */\ninterface ApiResponse<T = any> {\n  success?: boolean;\n  data?: T[];\n  records?: T[];\n  total?: number;\n  count?: number;\n  $meta?: {\n    count?: number;\n  };\n  schema?: Record<string, any>;\n  form?: Record<string, any>;\n}\n\ninterface DetailResponse<T = any> {\n  data?: T;\n  schema?: Record<string, any>;\n  form?: Record<string, any>;\n}\n\n/**\n * DataGrid component\n * Behavior-agnostic data grid with pluggable behaviors\n */\nexport class DataGrid {\n  public config: DataGridConfig;\n  public state: DataGridState;\n  private selectors: DataGridSelectors;\n  private tableEl: HTMLTableElement | null = null;\n  private searchTimeout: number | null = null;\n  private abortController: AbortController | null = null;\n  private dropdownAbortController: AbortController | null = null;\n  private didRestoreColumnOrder: boolean = false;\n  private shouldReorderDOMOnRestore: boolean = false;\n  private actionRenderer: ActionRenderer;\n  private cellRendererRegistry: CellRendererRegistry;\n  private recordsById: Record<string, any> = {};\n  private notifier: ToastNotifier;\n  private columnManager: ColumnManager | null = null;\n  private defaultColumns: ColumnDefinition[];\n  private lastSchema: Record<string, any> | null = null;\n  private lastForm: Record<string, any> | null = null;\n\n  constructor(config: DataGridConfig) {\n    this.config = {\n      perPage: 10,\n      searchDelay: 300,\n      behaviors: {},\n      ...config\n    };\n\n    // Initialize notifier (use provided or fallback to alert/confirm)\n    this.notifier = config.notifier || new FallbackNotifier();\n\n    this.selectors = {\n      table: `#${config.tableId}`,\n      searchInput: '#table-search',\n      perPageSelect: '#table-per-page',\n      filterRow: '[data-filter-column]',\n      columnToggleBtn: '#column-toggle-btn',\n      columnToggleMenu: '#column-toggle-menu',\n      exportBtn: '#export-btn',\n      exportMenu: '#export-menu',\n      paginationContainer: '#table-pagination',\n      tableInfoStart: '#table-info-start',\n      tableInfoEnd: '#table-info-end',\n      tableInfoTotal: '#table-info-total',\n      selectAllCheckbox: '#table-checkbox-all',\n      rowCheckboxes: '.table-checkbox',\n      bulkActionsBar: '#bulk-actions-bar',\n      selectedCount: '#selected-count',\n      ...config.selectors\n    };\n\n    // Restore persisted grouped mode state if enabled\n    const panelId = this.config.panelId || this.config.tableId;\n    const persistedViewMode = this.config.enableGroupedMode\n      ? getPersistedViewMode(panelId)\n      : null;\n    const persistedExpandState = this.config.enableGroupedMode\n      ? getPersistedExpandState(panelId)\n      : new Set<string>();\n    const initialViewMode = persistedViewMode || this.config.defaultViewMode || 'flat';\n\n    this.state = {\n      currentPage: 1,\n      perPage: this.config.perPage || 10,\n      totalRows: 0,\n      search: '',\n      filters: [],\n      sort: [],\n      selectedRows: new Set(),\n      hiddenColumns: new Set(\n        this.config.columns.filter(col => col.hidden).map(col => col.field)\n      ),\n      columnOrder: this.config.columns.map(col => col.field),  // Initialize with config column order\n      // Phase 2: Grouped mode state\n      viewMode: initialViewMode,\n      groupedData: null,\n      expandedGroups: persistedExpandState,\n    };\n\n    // Initialize action renderer and cell renderer registry\n    this.actionRenderer = new ActionRenderer({\n      mode: this.config.actionRenderMode || 'dropdown',  // Default to dropdown\n      actionBasePath: this.config.actionBasePath || this.config.apiEndpoint,\n      notifier: this.notifier  // Pass notifier to ActionRenderer\n    });\n    this.cellRendererRegistry = new CellRendererRegistry();\n\n    // Register custom cell renderers if provided\n    if (this.config.cellRenderers) {\n      Object.entries(this.config.cellRenderers).forEach(([field, renderer]) => {\n        this.cellRendererRegistry.register(field, renderer);\n      });\n    }\n\n    // Snapshot default columns for \"Reset to Default\" behavior.\n    // Keep a shallow copy so functions (renderers) remain intact.\n    this.defaultColumns = this.config.columns.map(col => ({ ...col }));\n  }\n\n  /**\n   * Initialize the data grid\n   */\n  init(): void {\n    console.log('[DataGrid] Initializing with config:', this.config);\n    this.tableEl = document.querySelector(this.selectors.table);\n    if (!this.tableEl) {\n      console.error(`[DataGrid] Table element not found: ${this.selectors.table}`);\n      return;\n    }\n    console.log('[DataGrid] Table element found:', this.tableEl);\n\n    // Don't auto-inject bulk actions toolbar - we use a custom overlay in the template\n    // that's positioned at the bottom of the page\n    // The auto-injection creates duplicate IDs and conflicts with our custom overlay\n\n    // Restore state from URL before binding\n    this.restoreStateFromURL();\n\n    this.bindSearchInput();\n    this.bindPerPageSelect();\n    this.bindFilterInputs();\n    this.bindColumnVisibility();\n    this.bindExportButtons();\n    this.bindSorting();\n    this.bindSelection();\n    this.bindBulkActions();\n    this.bindBulkClearButton();\n    this.bindDropdownToggles();\n\n    // Initial data load\n    this.refresh();\n  }\n\n  /**\n   * Restore DataGrid state from URL parameters\n   */\n  private restoreStateFromURL(): void {\n    const params = new URLSearchParams(window.location.search);\n    this.didRestoreColumnOrder = false;\n    this.shouldReorderDOMOnRestore = false;\n\n    // Restore search\n    const search = params.get('search');\n    if (search) {\n      this.state.search = search;\n      const searchInput = document.querySelector<HTMLInputElement>(this.selectors.searchInput);\n      if (searchInput) {\n        searchInput.value = search;\n      }\n    }\n\n    // Restore page\n    const page = params.get('page');\n    if (page) {\n      const parsedPage = parseInt(page, 10);\n      this.state.currentPage = Number.isNaN(parsedPage) ? 1 : Math.max(1, parsedPage);\n    }\n\n    // Restore perPage\n    const perPage = params.get('perPage');\n    if (perPage) {\n      const parsedPerPage = parseInt(perPage, 10);\n      const fallbackPerPage = this.config.perPage || 10;\n      this.state.perPage = Number.isNaN(parsedPerPage)\n        ? fallbackPerPage\n        : Math.max(1, parsedPerPage);\n      const perPageSelect = document.querySelector<HTMLSelectElement>(this.selectors.perPageSelect);\n      if (perPageSelect) {\n        perPageSelect.value = String(this.state.perPage);\n      }\n    }\n\n    // Restore filters\n    const filtersParam = params.get('filters');\n    if (filtersParam) {\n      try {\n        this.state.filters = JSON.parse(filtersParam);\n      } catch (e) {\n        console.warn('[DataGrid] Failed to parse filters from URL:', e);\n      }\n    }\n\n    // Restore sort\n    const sortParam = params.get('sort');\n    if (sortParam) {\n      try {\n        this.state.sort = JSON.parse(sortParam);\n      } catch (e) {\n        console.warn('[DataGrid] Failed to parse sort from URL:', e);\n      }\n    }\n\n    // Restore hidden columns with precedence: URL > localStorage > defaults\n    const hiddenColumnsParam = params.get('hiddenColumns');\n    if (hiddenColumnsParam) {\n      // Priority 1: URL params (authoritative for shared links)\n      try {\n        const hiddenArray = JSON.parse(hiddenColumnsParam);\n        const validFields = new Set(this.config.columns.map(col => col.field));\n        this.state.hiddenColumns = new Set(\n          (Array.isArray(hiddenArray) ? hiddenArray : []).filter((field) => validFields.has(field))\n        );\n      } catch (e) {\n        console.warn('[DataGrid] Failed to parse hidden columns from URL:', e);\n      }\n    } else if (this.config.behaviors?.columnVisibility) {\n      // Priority 2: localStorage cache (fallback when no URL params)\n      const allColumnFields = this.config.columns.map(col => col.field);\n      const cachedHidden = this.config.behaviors.columnVisibility.loadHiddenColumnsFromCache(allColumnFields);\n      if (cachedHidden.size > 0) {\n        this.state.hiddenColumns = cachedHidden;\n      }\n      // Priority 3: defaults (all visible) - already initialized in constructor\n    }\n\n    // Restore column order from localStorage cache (not in URL by default per guiding notes)\n    // Note: Column order is preferences-only, not URL-shareable\n    if (this.config.behaviors?.columnVisibility?.loadColumnOrderFromCache) {\n      const allColumnFields = this.config.columns.map(col => col.field);\n      const cachedOrder = this.config.behaviors.columnVisibility.loadColumnOrderFromCache(allColumnFields);\n      if (cachedOrder && cachedOrder.length > 0) {\n        // Merge cached order with current columns (drop missing, append new)\n        const validOrder = this.mergeColumnOrder(cachedOrder);\n        this.state.columnOrder = validOrder;\n\n        // Track whether we restored an order, and whether it requires DOM reordering.\n        this.didRestoreColumnOrder = true;\n        const defaultOrder = this.defaultColumns.map(col => col.field);\n        this.shouldReorderDOMOnRestore = defaultOrder.join('|') !== validOrder.join('|');\n\n        // Reorder config.columns to match\n        const columnMap = new Map(this.config.columns.map(c => [c.field, c]));\n        this.config.columns = validOrder\n          .map(field => columnMap.get(field))\n          .filter((c): c is ColumnDefinition => c !== undefined);\n\n        console.log('[DataGrid] Column order restored from cache:', validOrder);\n      }\n    }\n\n    console.log('[DataGrid] State restored from URL:', this.state);\n\n    // Apply restored state to UI after a short delay to ensure DOM is ready\n    setTimeout(() => {\n      this.applyRestoredState();\n    }, 0);\n  }\n\n  /**\n   * Apply restored state to UI elements\n   */\n  private applyRestoredState(): void {\n    // Apply filter values to inputs\n    if (this.state.filters.length > 0) {\n      this.state.filters.forEach(filter => {\n        const input = document.querySelector<HTMLInputElement>(\n          `[data-filter-column=\"${filter.column}\"]`\n        );\n        if (input) {\n          input.value = String(filter.value);\n        }\n      });\n    }\n\n    // Apply column order if restored from cache\n    // Note: This reorders header/filter rows in DOM to match state.columnOrder\n    if (this.didRestoreColumnOrder && this.shouldReorderDOMOnRestore) {\n      this.reorderTableColumns(this.state.columnOrder);\n    }\n\n    // Apply column visibility (always, even if all visible)\n    const visibleColumns = this.config.columns\n      .filter(col => !this.state.hiddenColumns.has(col.field))\n      .map(col => col.field);\n\n    this.updateColumnVisibility(visibleColumns, true); // Skip URL update during restoration\n\n    // Apply sort indicators\n    if (this.state.sort.length > 0) {\n      this.updateSortIndicators();\n    }\n  }\n\n  /**\n   * Push current state to URL without reloading page\n   */\n  private pushStateToURL(): void {\n    const params = new URLSearchParams();\n\n    // Add search\n    if (this.state.search) {\n      params.set('search', this.state.search);\n    }\n\n    // Add page (only if not page 1)\n    if (this.state.currentPage > 1) {\n      params.set('page', String(this.state.currentPage));\n    }\n\n    // Add perPage (only if different from default)\n    if (this.state.perPage !== (this.config.perPage || 10)) {\n      params.set('perPage', String(this.state.perPage));\n    }\n\n    // Add filters\n    if (this.state.filters.length > 0) {\n      params.set('filters', JSON.stringify(this.state.filters));\n    }\n\n    // Add sort\n    if (this.state.sort.length > 0) {\n      params.set('sort', JSON.stringify(this.state.sort));\n    }\n\n    // Add hidden columns\n    if (this.state.hiddenColumns.size > 0) {\n      params.set('hiddenColumns', JSON.stringify(Array.from(this.state.hiddenColumns)));\n    }\n\n    // Update URL without reload\n    const newURL = params.toString()\n      ? `${window.location.pathname}?${params.toString()}`\n      : window.location.pathname;\n\n    window.history.pushState({}, '', newURL);\n    console.log('[DataGrid] URL updated:', newURL);\n  }\n\n  /**\n   * Public API: sync current grid state to the URL.\n   * Keeps `hiddenColumns` shareable; column order stays preferences-only by default.\n   */\n  syncURL(): void {\n    this.pushStateToURL();\n  }\n\n  /**\n   * Refresh data from API\n   */\n  async refresh(): Promise<void> {\n    console.log('[DataGrid] ===== refresh() CALLED =====');\n    console.log('[DataGrid] Current sort state:', JSON.stringify(this.state.sort));\n\n    if (this.abortController) {\n      this.abortController.abort();\n    }\n\n    this.abortController = new AbortController();\n\n    try {\n      const url = this.buildApiUrl();\n      const response = await fetch(url, {\n        signal: this.abortController.signal,\n        headers: {\n          'Accept': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data: ApiResponse = await response.json();\n      console.log('[DataGrid] API Response:', data);\n      console.log('[DataGrid] API Response data array:', data.data);\n      console.log('[DataGrid] API Response total:', data.total, 'count:', data.count, '$meta:', data.$meta);\n      this.lastSchema = data.schema || null;\n      this.lastForm = data.form || null;\n      const total = this.getResponseTotal(data);\n      if (this.normalizePagination(total)) {\n        return this.refresh();\n      }\n      console.log('[DataGrid] About to call renderData()...');\n      this.renderData(data);\n      console.log('[DataGrid] renderData() completed');\n      this.updatePaginationUI(data);\n      console.log('[DataGrid] ===== refresh() COMPLETED =====');\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        console.log('[DataGrid] Request aborted');\n        return;\n      }\n      console.error('[DataGrid] Error fetching data:', error);\n      this.showError('Failed to load data');\n    }\n  }\n\n  /**\n   * Build API URL with all query parameters\n   */\n  buildApiUrl(): string {\n    const params = new URLSearchParams();\n    const queryParams = this.buildQueryParams();\n\n    Object.entries(queryParams).forEach(([key, value]) => {\n      if (value !== null && value !== undefined) {\n        params.append(key, String(value));\n      }\n    });\n\n    const url = `${this.config.apiEndpoint}?${params.toString()}`;\n    console.log(`[DataGrid] API URL: ${url}`);\n    return url;\n  }\n\n  /**\n   * Build query string (for exports, etc.)\n   */\n  buildQueryString(): string {\n    const params = new URLSearchParams();\n    const queryParams = this.buildQueryParams();\n\n    Object.entries(queryParams).forEach(([key, value]) => {\n      if (value !== null && value !== undefined) {\n        params.append(key, String(value));\n      }\n    });\n\n    return params.toString();\n  }\n\n  /**\n   * Build query parameters from state using behaviors\n   */\n  private buildQueryParams(): Record<string, any> {\n    const params: Record<string, any> = {};\n\n    // Pagination\n    if (this.config.behaviors?.pagination) {\n      const paginationParams = this.config.behaviors.pagination.buildQuery(\n        this.state.currentPage,\n        this.state.perPage\n      );\n      Object.assign(params, paginationParams);\n    }\n\n    // Search\n    if (this.state.search && this.config.behaviors?.search) {\n      const searchParams = this.config.behaviors.search.buildQuery(this.state.search);\n      Object.assign(params, searchParams);\n    }\n\n    // Filters\n    if (this.state.filters.length > 0 && this.config.behaviors?.filter) {\n      const filterParams = this.config.behaviors.filter.buildFilters(this.state.filters);\n      Object.assign(params, filterParams);\n    }\n\n    // Sorting\n    if (this.state.sort.length > 0 && this.config.behaviors?.sort) {\n      const sortParams = this.config.behaviors.sort.buildQuery(this.state.sort);\n      Object.assign(params, sortParams);\n    }\n\n    return params;\n  }\n\n  private getResponseTotal(data: ApiResponse): number | null {\n    if (data.total !== undefined && data.total !== null) return data.total;\n    if (data.$meta?.count !== undefined && data.$meta?.count !== null) return data.$meta.count;\n    if (data.count !== undefined && data.count !== null) return data.count;\n    return null;\n  }\n\n  private normalizePagination(total: number | null): boolean {\n    if (total === null) {\n      return false;\n    }\n\n    const nextPerPage = Math.max(1, this.state.perPage || this.config.perPage || 10);\n    const maxPage = Math.max(1, Math.ceil(total / nextPerPage));\n    let nextPage = this.state.currentPage;\n\n    if (total === 0) {\n      nextPage = 1;\n    } else if (nextPage > maxPage) {\n      nextPage = maxPage;\n    } else if (nextPage < 1) {\n      nextPage = 1;\n    }\n\n    const didCorrect = nextPerPage !== this.state.perPage || nextPage !== this.state.currentPage;\n    if (didCorrect) {\n      this.state.perPage = nextPerPage;\n      this.state.currentPage = nextPage;\n      this.pushStateToURL();\n    }\n\n    if (total === 0) {\n      return false;\n    }\n\n    return didCorrect;\n  }\n\n  /**\n   * Reset pagination to first page\n   */\n  resetPagination(): void {\n    this.state.currentPage = 1;\n  }\n\n  /**\n   * Update column visibility\n   */\n  updateColumnVisibility(visibleColumns: string[], skipURLUpdate: boolean = false): void {\n    if (!this.tableEl) return;\n\n    const visibleSet = new Set(visibleColumns);\n\n    // Update hidden columns state\n    this.state.hiddenColumns.clear();\n    this.config.columns.forEach(col => {\n      if (!visibleSet.has(col.field)) {\n        this.state.hiddenColumns.add(col.field);\n      }\n    });\n\n    // Update URL with new hidden columns state (unless during restoration)\n    if (!skipURLUpdate) {\n      this.pushStateToURL();\n    }\n\n    // Update header and filter row visibility\n    // Note: This selector matches both header row th[data-column] and filter row th[data-column]\n    // Filter row cells must have data-column attributes to stay aligned with headers\n    const headerCells = this.tableEl.querySelectorAll('thead th[data-column]');\n    headerCells.forEach((th) => {\n      const field = (th as HTMLElement).dataset.column;\n      if (field) {\n        (th as HTMLElement).style.display = visibleSet.has(field) ? '' : 'none';\n      }\n    });\n\n    // Update body cell visibility\n    const bodyCells = this.tableEl.querySelectorAll('tbody td[data-column]');\n    bodyCells.forEach((td) => {\n      const field = (td as HTMLElement).dataset.column;\n      if (field) {\n        (td as HTMLElement).style.display = visibleSet.has(field) ? '' : 'none';\n      }\n    });\n\n    // Sync checkbox state in column visibility menu\n    this.syncColumnVisibilityCheckboxes();\n  }\n\n  /**\n   * Sync column visibility switches with current state\n   * Uses ColumnManager if available, falls back to direct DOM manipulation\n   */\n  private syncColumnVisibilityCheckboxes(): void {\n    // Prefer ColumnManager if initialized\n    if (this.columnManager) {\n      this.columnManager.syncWithGridState();\n      return;\n    }\n\n    // Fallback to direct DOM manipulation for legacy checkboxes\n    const menu = document.querySelector(this.selectors.columnToggleMenu);\n    if (!menu) return;\n\n    this.config.columns.forEach(col => {\n      const checkbox = menu.querySelector<HTMLInputElement>(\n        `input[data-column=\"${col.field}\"]`\n      );\n      if (checkbox) {\n        checkbox.checked = !this.state.hiddenColumns.has(col.field);\n      }\n    });\n  }\n\n  /**\n   * Render data into table\n   */\n  private renderData(data: ApiResponse): void {\n    const tbody = this.tableEl?.querySelector('tbody');\n    if (!tbody) {\n      console.error('[DataGrid] tbody not found!');\n      return;\n    }\n\n    tbody.innerHTML = '';\n\n    const items = data.data || data.records || [];\n    console.log(`[DataGrid] renderData() called with ${items.length} items`);\n    console.log('[DataGrid] First 3 items:', items.slice(0, 3));\n    const total = this.getResponseTotal(data);\n    this.state.totalRows = total ?? items.length;\n\n    if (items.length === 0) {\n      // Use grouped empty state if in grouped mode\n      if (this.config.enableGroupedMode && this.state.viewMode === 'grouped') {\n        tbody.innerHTML = renderGroupedEmptyState(this.config.columns.length);\n      } else {\n        tbody.innerHTML = `\n          <tr>\n            <td colspan=\"${this.config.columns.length + 2}\" class=\"px-6 py-8 text-center text-gray-500\">\n              No results found\n            </td>\n          </tr>\n        `;\n      }\n      return;\n    }\n\n    // Clear records by ID cache\n    this.recordsById = {};\n\n    // Phase 2: Check if grouped mode is enabled and active\n    if (this.config.enableGroupedMode && this.state.viewMode === 'grouped') {\n      this.renderGroupedData(data, items, tbody);\n    } else {\n      // Flat mode rendering (original behavior)\n      this.renderFlatData(items, tbody);\n    }\n\n    // Apply column visibility to new body cells\n    // Note: config.columns is already in the correct order, but some may be hidden\n    if (this.state.hiddenColumns.size > 0) {\n      const bodyCells = tbody.querySelectorAll('td[data-column]');\n      bodyCells.forEach((td) => {\n        const field = (td as HTMLElement).dataset.column;\n        if (field && this.state.hiddenColumns.has(field)) {\n          (td as HTMLElement).style.display = 'none';\n        }\n      });\n    }\n\n    // Rebind selection after rendering\n    this.updateSelectionBindings();\n  }\n\n  /**\n   * Render data in flat mode (original behavior)\n   */\n  private renderFlatData(items: any[], tbody: HTMLElement): void {\n    items.forEach((item: any, index: number) => {\n      console.log(`[DataGrid] Rendering row ${index + 1}: id=${item.id}`);\n      if (item.id) {\n        this.recordsById[item.id] = item;\n      }\n      const row = this.createTableRow(item);\n      tbody.appendChild(row);\n    });\n\n    console.log(`[DataGrid] Finished appending ${items.length} rows to tbody`);\n    console.log(`[DataGrid] tbody.children.length =`, tbody.children.length);\n  }\n\n  /**\n   * Render data in grouped mode (Phase 2)\n   */\n  private renderGroupedData(data: ApiResponse, items: any[], tbody: HTMLElement): void {\n    const groupByField = this.config.groupByField || 'translation_group_id';\n\n    // Transform to grouped structure\n    let groupedData = transformToGroups(items, {\n      groupByField,\n      defaultExpanded: true,\n      expandedGroups: this.state.expandedGroups,\n    });\n\n    // Merge backend summaries if available\n    const backendSummaries = extractBackendSummaries(data as Record<string, unknown>);\n    if (backendSummaries.size > 0) {\n      groupedData = mergeBackendSummaries(groupedData, backendSummaries);\n    }\n\n    // Store grouped data in state\n    this.state.groupedData = groupedData;\n\n    const colSpan = this.config.columns.length;\n\n    // Render grouped rows\n    for (const group of groupedData.groups) {\n      // Render group header row\n      const headerHtml = renderGroupHeaderRow(group, colSpan);\n      tbody.insertAdjacentHTML('beforeend', headerHtml);\n\n      // Get the header row and bind click handler\n      const headerRow = tbody.lastElementChild as HTMLElement;\n      if (headerRow) {\n        headerRow.addEventListener('click', () => this.toggleGroup(group.groupId));\n        headerRow.addEventListener('keydown', (e: KeyboardEvent) => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            this.toggleGroup(group.groupId);\n          }\n        });\n      }\n\n      // Render child rows if expanded\n      if (group.expanded) {\n        for (const record of group.records) {\n          if (record.id) {\n            this.recordsById[record.id as string] = record;\n          }\n          const row = this.createTableRow(record);\n          row.dataset.groupId = group.groupId;\n          row.classList.add('group-child-row');\n          tbody.appendChild(row);\n        }\n      }\n    }\n\n    // Render ungrouped rows (if any)\n    for (const record of groupedData.ungrouped) {\n      if (record.id) {\n        this.recordsById[record.id as string] = record;\n      }\n      const row = this.createTableRow(record);\n      tbody.appendChild(row);\n    }\n\n    console.log(`[DataGrid] Rendered ${groupedData.groups.length} groups, ${groupedData.ungrouped.length} ungrouped`);\n  }\n\n  /**\n   * Toggle group expand/collapse state (Phase 2)\n   */\n  toggleGroup(groupId: string): void {\n    if (!this.state.groupedData) return;\n\n    // Toggle in state\n    if (this.state.expandedGroups.has(groupId)) {\n      this.state.expandedGroups.delete(groupId);\n    } else {\n      this.state.expandedGroups.add(groupId);\n    }\n\n    // Persist state\n    const panelId = this.config.panelId || this.config.tableId;\n    persistExpandState(panelId, this.state.expandedGroups);\n\n    // Update the group's expanded state\n    const group = this.state.groupedData.groups.find(g => g.groupId === groupId);\n    if (group) {\n      group.expanded = this.state.expandedGroups.has(groupId);\n    }\n\n    // Re-render the affected group (toggle child row visibility)\n    this.updateGroupVisibility(groupId);\n  }\n\n  /**\n   * Update visibility of child rows for a group\n   */\n  private updateGroupVisibility(groupId: string): void {\n    const tbody = this.tableEl?.querySelector('tbody');\n    if (!tbody) return;\n\n    const headerRow = tbody.querySelector(`tr[data-group-id=\"${groupId}\"]`) as HTMLElement;\n    if (!headerRow) return;\n\n    const isExpanded = this.state.expandedGroups.has(groupId);\n\n    // Update header row state\n    headerRow.dataset.expanded = String(isExpanded);\n    headerRow.setAttribute('aria-expanded', String(isExpanded));\n\n    // Update expand icon\n    const expandIcon = headerRow.querySelector('.expand-icon');\n    if (expandIcon) {\n      expandIcon.textContent = isExpanded ? '' : '';\n    }\n\n    // Toggle child rows visibility\n    const childRows = tbody.querySelectorAll<HTMLElement>(`tr.group-child-row[data-group-id=\"${groupId}\"]`);\n    childRows.forEach(row => {\n      row.style.display = isExpanded ? '' : 'none';\n    });\n  }\n\n  /**\n   * Set view mode (flat, grouped, matrix) - Phase 2\n   */\n  setViewMode(mode: ViewMode): void {\n    if (!this.config.enableGroupedMode) {\n      console.warn('[DataGrid] Grouped mode not enabled');\n      return;\n    }\n\n    // Apply viewport-specific adjustments\n    const effectiveMode = getViewModeForViewport(mode);\n\n    this.state.viewMode = effectiveMode;\n\n    // Persist mode\n    const panelId = this.config.panelId || this.config.tableId;\n    persistViewMode(panelId, effectiveMode);\n\n    // Re-fetch data with new mode\n    this.refresh();\n  }\n\n  /**\n   * Get current view mode\n   */\n  getViewMode(): ViewMode {\n    return this.state.viewMode;\n  }\n\n  /**\n   * Get grouped data (if available)\n   */\n  getGroupedData(): GroupedData | null {\n    return this.state.groupedData;\n  }\n\n  /**\n   * Fetch a detail payload and unwrap the record from the `data` field.\n   */\n  async fetchDetail(id: string): Promise<{ data: any; schema?: Record<string, any>; form?: Record<string, any>; tabs?: any[] }> {\n    const response = await fetch(`${this.config.apiEndpoint}/${id}`, {\n      headers: {\n        'Accept': 'application/json'\n      }\n    });\n    if (!response.ok) {\n      throw new Error(`Detail request failed: ${response.status}`);\n    }\n    const payload = await response.json();\n    const detail = this.normalizeDetailResponse(payload);\n    if (detail.schema) {\n      this.lastSchema = detail.schema;\n    }\n    if (detail.form) {\n      this.lastForm = detail.form;\n    }\n    return {\n      ...detail,\n      tabs: detail.schema?.tabs || [],\n    };\n  }\n\n  /**\n   * Access the most recent schema returned by the API (list or detail).\n   */\n  getSchema(): Record<string, any> | null {\n    return this.lastSchema;\n  }\n\n  /**\n   * Access the most recent form returned by the API (list or detail).\n   */\n  getForm(): Record<string, any> | null {\n    return this.lastForm;\n  }\n\n  /**\n   * Access tabs from the most recent schema payload.\n   */\n  getTabs(): any[] {\n    return this.lastSchema?.tabs || [];\n  }\n\n  private normalizeDetailResponse(payload: any): { data: any; schema?: Record<string, any>; form?: Record<string, any> } {\n    if (payload && typeof payload === 'object' && 'data' in payload) {\n      const detail = payload as DetailResponse;\n      return {\n        data: detail.data,\n        schema: detail.schema,\n        form: detail.form,\n      };\n    }\n    return { data: payload };\n  }\n\n  private resolveRendererOptions(col: ColumnDefinition): Record<string, any> {\n    const options = col.rendererOptions ?? col.renderer_options;\n    if (!options || typeof options !== 'object' || Array.isArray(options)) {\n      return {};\n    }\n    return options;\n  }\n\n  /**\n   * Create table row element\n   */\n  private createTableRow(item: any): HTMLTableRowElement {\n    const row = document.createElement('tr');\n\n    // Apply custom row classes if provider is configured\n    let rowClasses = ['hover:bg-gray-50'];\n    if (this.config.rowClassProvider) {\n      rowClasses = rowClasses.concat(this.config.rowClassProvider(item));\n    }\n    row.className = rowClasses.join(' ');\n\n    // Checkbox cell\n    const checkboxCell = document.createElement('td');\n    checkboxCell.className = 'px-6 py-4 whitespace-nowrap';\n    checkboxCell.dataset.role = 'selection';\n    checkboxCell.dataset.fixed = 'left';\n    checkboxCell.innerHTML = `\n      <label class=\"flex\">\n        <input type=\"checkbox\"\n               class=\"table-checkbox shrink-0 border-gray-300 rounded text-blue-600 focus:ring-blue-500\"\n               data-id=\"${item.id}\">\n        <span class=\"sr-only\">Select</span>\n      </label>\n    `;\n    row.appendChild(checkboxCell);\n\n    // Data cells\n    this.config.columns.forEach((col) => {\n      const cell = document.createElement('td');\n      cell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-800';\n      cell.setAttribute('data-column', col.field);\n\n      const value = item[col.field];\n      const rendererName = typeof col.renderer === 'string' ? col.renderer.trim() : '';\n      const rendererContext: CellRendererContext = {\n        options: this.resolveRendererOptions(col),\n      };\n\n      // Priority: column render > field renderer > named renderer > default renderer\n      if (col.render) {\n        cell.innerHTML = col.render(value, item);\n      } else if (this.cellRendererRegistry.has(col.field)) {\n        const renderer = this.cellRendererRegistry.get(col.field);\n        cell.innerHTML = renderer(value, item, col.field, rendererContext);\n      } else if (rendererName && this.cellRendererRegistry.has(rendererName)) {\n        const renderer = this.cellRendererRegistry.get(rendererName);\n        cell.innerHTML = renderer(value, item, col.field, rendererContext);\n      } else if (value === null || value === undefined) {\n        cell.textContent = '-';\n      } else if (col.field.includes('_at')) {\n        cell.textContent = new Date(value).toLocaleDateString();\n      } else {\n        cell.textContent = String(value);\n      }\n\n      row.appendChild(cell);\n    });\n\n    // Actions cell\n    const actionBase = this.config.actionBasePath || this.config.apiEndpoint;\n    const actionsCell = document.createElement('td');\n    actionsCell.className = 'px-6 py-4 whitespace-nowrap text-end text-sm font-medium';\n    actionsCell.dataset.role = 'actions';\n    actionsCell.dataset.fixed = 'right';\n\n    // Use custom row actions if provided, otherwise use default actions\n    if (this.config.rowActions) {\n      const actions = this.config.rowActions(item);\n      actionsCell.innerHTML = this.actionRenderer.renderRowActions(item, actions);\n\n      // Attach event listeners for each action button\n      actions.forEach(action => {\n        const actionId = this.sanitizeActionId(action.label);\n        const button = actionsCell.querySelector(`[data-action-id=\"${actionId}\"]`);\n        if (action.disabled) {\n          return;\n        }\n        if (button) {\n          button.addEventListener('click', async (e) => {\n            e.preventDefault();\n            if ((button as HTMLButtonElement).disabled) {\n              return;\n            }\n            try {\n              await action.action(item);\n            } catch (error) {\n              console.error(`Action \"${action.label}\" failed:`, error);\n              const errorMsg = error instanceof Error ? error.message : `Action \"${action.label}\" failed`;\n              this.notify(errorMsg, 'error');\n            }\n          });\n        }\n      });\n    } else if (this.config.useDefaultActions !== false) {\n      // Default actions (view, edit, delete)\n      const defaultActions = [\n        {\n          label: 'View',\n          icon: 'eye',\n          action: () => { window.location.href = `${actionBase}/${item.id}`; },\n          variant: 'secondary' as const\n        },\n        {\n          label: 'Edit',\n          icon: 'edit',\n          action: () => { window.location.href = `${actionBase}/${item.id}/edit`; },\n          variant: 'primary' as const\n        },\n        {\n          label: 'Delete',\n          icon: 'trash',\n          action: async () => { await this.handleDelete(item.id); },\n          variant: 'danger' as const\n        }\n      ];\n\n      actionsCell.innerHTML = this.actionRenderer.renderRowActions(item, defaultActions);\n\n      // Attach event listeners for each default action\n      defaultActions.forEach(action => {\n        const actionId = this.sanitizeActionId(action.label);\n        const button = actionsCell.querySelector(`[data-action-id=\"${actionId}\"]`);\n        if (button) {\n          button.addEventListener('click', async (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            if ((button as HTMLButtonElement).disabled) {\n              return;\n            }\n            try {\n              await action.action();\n            } catch (error) {\n              console.error(`Action \"${action.label}\" failed:`, error);\n              const errorMsg = error instanceof Error ? error.message : `Action \"${action.label}\" failed`;\n              this.notify(errorMsg, 'error');\n            }\n          });\n        }\n      });\n    }\n\n    row.appendChild(actionsCell);\n\n    return row;\n  }\n\n  /**\n   * Sanitize action label to create a valid ID\n   */\n  private sanitizeActionId(label: string): string {\n    return label.toLowerCase().replace(/[^a-z0-9]/g, '-');\n  }\n\n  /**\n   * Handle delete action\n   */\n  private async handleDelete(id: string): Promise<void> {\n    const confirmed = await this.confirmAction('Are you sure you want to delete this item?');\n    if (!confirmed) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`${this.config.apiEndpoint}/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Accept': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error('Delete failed');\n      }\n\n      await this.refresh();\n    } catch (error) {\n      console.error('Error deleting item:', error);\n      this.showError('Failed to delete item');\n    }\n  }\n\n  /**\n   * Update pagination UI\n   */\n  private updatePaginationUI(data: ApiResponse): void {\n    const total = this.getResponseTotal(data) ?? this.state.totalRows;\n    const offset = this.state.perPage * (this.state.currentPage - 1);\n    const start = total === 0 ? 0 : offset + 1;\n    const end = Math.min(offset + this.state.perPage, total);\n\n    const startEl = document.querySelector(this.selectors.tableInfoStart);\n    const endEl = document.querySelector(this.selectors.tableInfoEnd);\n    const totalEl = document.querySelector(this.selectors.tableInfoTotal);\n\n    if (startEl) startEl.textContent = String(start);\n    if (endEl) endEl.textContent = String(end);\n    if (totalEl) totalEl.textContent = String(total);\n\n    this.renderPaginationButtons(total);\n  }\n\n  /**\n   * Render pagination buttons\n   */\n  private renderPaginationButtons(total: number): void {\n    const container = document.querySelector(this.selectors.paginationContainer);\n    if (!container) return;\n\n    const totalPages = Math.ceil(total / this.state.perPage);\n    if (totalPages <= 1) {\n      container.innerHTML = '';\n      return;\n    }\n\n    const buttons: string[] = [];\n    const current = this.state.currentPage;\n\n    // Previous button\n    buttons.push(`\n      <button type=\"button\"\n              data-page=\"${current - 1}\"\n              ${current === 1 ? 'disabled' : ''}\n              class=\"min-h-[38px] min-w-[38px] py-2 px-2.5 inline-flex justify-center items-center gap-x-1.5 text-sm rounded-lg text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none\">\n        <svg class=\"shrink-0 size-3.5\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"m15 18-6-6 6-6\"></path>\n        </svg>\n        <span>Previous</span>\n      </button>\n    `);\n\n    // Page numbers\n    const maxButtons = 5;\n    let startPage = Math.max(1, current - Math.floor(maxButtons / 2));\n    let endPage = Math.min(totalPages, startPage + maxButtons - 1);\n\n    if (endPage - startPage < maxButtons - 1) {\n      startPage = Math.max(1, endPage - maxButtons + 1);\n    }\n\n    for (let i = startPage; i <= endPage; i++) {\n      const isActive = i === current;\n      buttons.push(`\n        <button type=\"button\"\n                data-page=\"${i}\"\n                class=\"min-h-[38px] min-w-[38px] flex justify-center items-center ${\n                  isActive\n                    ? 'bg-gray-200 text-gray-800 focus:outline-none focus:bg-gray-300'\n                    : 'text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100'\n                } py-2 px-3 text-sm rounded-lg\">\n          ${i}\n        </button>\n      `);\n    }\n\n    // Next button\n    buttons.push(`\n      <button type=\"button\"\n              data-page=\"${current + 1}\"\n              ${current === totalPages ? 'disabled' : ''}\n              class=\"min-h-[38px] min-w-[38px] py-2 px-2.5 inline-flex justify-center items-center gap-x-1.5 text-sm rounded-lg text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none\">\n        <span>Next</span>\n        <svg class=\"shrink-0 size-3.5\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"m9 18 6-6-6-6\"></path>\n        </svg>\n      </button>\n    `);\n\n    container.innerHTML = buttons.join('');\n\n    // Bind click handlers\n    container.querySelectorAll('[data-page]').forEach((btn) => {\n      btn.addEventListener('click', async () => {\n        const page = parseInt((btn as HTMLElement).dataset.page || '1', 10);\n        if (page >= 1 && page <= totalPages) {\n          this.state.currentPage = page;\n          this.pushStateToURL();\n          if (this.config.behaviors?.pagination) {\n            await this.config.behaviors.pagination.onPageChange(page, this);\n          } else {\n            await this.refresh();\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Bind search input\n   */\n  private bindSearchInput(): void {\n    const input = document.querySelector<HTMLInputElement>(this.selectors.searchInput);\n    if (!input) {\n      console.warn(`[DataGrid] Search input not found: ${this.selectors.searchInput}`);\n      return;\n    }\n\n    console.log(`[DataGrid] Search input bound to: ${this.selectors.searchInput}`);\n\n    const clearBtn = document.getElementById('clear-search-btn');\n\n    // Toggle clear button visibility\n    const toggleClearBtn = () => {\n      if (clearBtn) {\n        if (input.value.trim()) {\n          clearBtn.classList.remove('hidden');\n        } else {\n          clearBtn.classList.add('hidden');\n        }\n      }\n    };\n\n    input.addEventListener('input', () => {\n      toggleClearBtn();\n\n      if (this.searchTimeout) {\n        clearTimeout(this.searchTimeout);\n      }\n\n      this.searchTimeout = window.setTimeout(async () => {\n        console.log(`[DataGrid] Search triggered: \"${input.value}\"`);\n        this.state.search = input.value;\n        this.pushStateToURL();\n        if (this.config.behaviors?.search) {\n          await this.config.behaviors.search.onSearch(input.value, this);\n        } else {\n          this.resetPagination();\n          await this.refresh();\n        }\n      }, this.config.searchDelay);\n    });\n\n    // Clear button handler\n    if (clearBtn) {\n      clearBtn.addEventListener('click', async () => {\n        input.value = '';\n        input.focus();\n        toggleClearBtn();\n\n        // Trigger search with empty value\n        this.state.search = '';\n        this.pushStateToURL();\n        if (this.config.behaviors?.search) {\n          await this.config.behaviors.search.onSearch('', this);\n        } else {\n          this.resetPagination();\n          await this.refresh();\n        }\n      });\n    }\n\n    // Initial toggle on page load\n    toggleClearBtn();\n  }\n\n  /**\n   * Bind per-page select\n   */\n  private bindPerPageSelect(): void {\n    const select = document.querySelector<HTMLSelectElement>(this.selectors.perPageSelect);\n    if (!select) return;\n\n    select.addEventListener('change', async () => {\n      this.state.perPage = parseInt(select.value, 10);\n      this.resetPagination();\n      this.pushStateToURL();\n      await this.refresh();\n    });\n  }\n\n  /**\n   * Bind filter inputs\n   */\n  private bindFilterInputs(): void {\n    const filterInputs = document.querySelectorAll<HTMLInputElement | HTMLSelectElement>(this.selectors.filterRow);\n\n    filterInputs.forEach((input) => {\n      // Handler function for both input and change events\n      const handleFilterChange = async () => {\n        const column = input.dataset.filterColumn;\n        const inputType = input instanceof HTMLInputElement ? input.type.toLowerCase() : '';\n        const inferredOperator = input instanceof HTMLSelectElement\n          ? 'eq'\n          : (inputType === '' || inputType === 'text' || inputType === 'search' || inputType === 'email' || inputType === 'tel' || inputType === 'url')\n            ? 'ilike'\n            : 'eq';\n        const operator = (input.dataset.filterOperator as any) || inferredOperator;\n        const value = input.value;\n\n        if (!column) return;\n\n        // Update filters state\n        const existingIndex = this.state.filters.findIndex(f => f.column === column);\n        if (value) {\n          const filter: ColumnFilter = { column, operator, value };\n          if (existingIndex >= 0) {\n            this.state.filters[existingIndex] = filter;\n          } else {\n            this.state.filters.push(filter);\n          }\n        } else {\n          // Remove filter if value is empty\n          if (existingIndex >= 0) {\n            this.state.filters.splice(existingIndex, 1);\n          }\n        }\n\n        this.pushStateToURL();\n        if (this.config.behaviors?.filter) {\n          await this.config.behaviors.filter.onFilterChange(column, value, this);\n        } else {\n          this.resetPagination();\n          await this.refresh();\n        }\n      };\n\n      // Bind both input (for text inputs) and change (for selects) events\n      input.addEventListener('input', handleFilterChange);\n      input.addEventListener('change', handleFilterChange);\n    });\n  }\n\n  /**\n   * Bind column visibility toggle using ColumnManager\n   */\n  private bindColumnVisibility(): void {\n    const toggleBtn = document.querySelector(this.selectors.columnToggleBtn);\n    const menu = document.querySelector<HTMLElement>(this.selectors.columnToggleMenu);\n\n    if (!toggleBtn || !menu) return;\n\n    // Initialize ColumnManager to render column items with switches and drag handles\n    this.columnManager = new ColumnManager({\n      container: menu,\n      grid: this,\n      onToggle: (field, visible) => {\n        console.log(`[DataGrid] Column ${field} visibility toggled to ${visible}`);\n      },\n      onReorder: (order) => {\n        console.log(`[DataGrid] Columns reordered:`, order);\n      }\n    });\n  }\n\n  /**\n   * Bind export buttons\n   */\n  private bindExportButtons(): void {\n    const menu = document.querySelector(this.selectors.exportMenu);\n    if (!menu) return;\n\n    const exportButtons = menu.querySelectorAll<HTMLButtonElement>('[data-export-format]');\n\n    exportButtons.forEach((btn) => {\n      btn.addEventListener('click', async () => {\n        const format = (btn as HTMLElement).dataset.exportFormat as 'csv' | 'json' | 'excel' | 'pdf';\n        if (!format || !this.config.behaviors?.export) return;\n\n        // Get concurrency mode (default to 'single')\n        const concurrency = this.config.behaviors.export.getConcurrency?.() || 'single';\n\n        // Determine which buttons to disable based on concurrency mode\n        const buttonsToDisable: HTMLButtonElement[] = [];\n        if (concurrency === 'single') {\n          // Disable all export buttons\n          exportButtons.forEach(b => buttonsToDisable.push(b));\n        } else if (concurrency === 'per-format') {\n          // Disable only the clicked button\n          buttonsToDisable.push(btn);\n        }\n        // 'none' mode: no buttons disabled, but clicked button still shows spinner\n\n        // Helper to toggle spinner visibility on a button\n        const showSpinner = (b: HTMLButtonElement) => {\n          const icon = b.querySelector('.export-icon');\n          const spinner = b.querySelector('.export-spinner');\n          if (icon) icon.classList.add('hidden');\n          if (spinner) spinner.classList.remove('hidden');\n        };\n\n        const hideSpinner = (b: HTMLButtonElement) => {\n          const icon = b.querySelector('.export-icon');\n          const spinner = b.querySelector('.export-spinner');\n          if (icon) icon.classList.remove('hidden');\n          if (spinner) spinner.classList.add('hidden');\n        };\n\n        // Apply loading state to buttons that should be disabled\n        buttonsToDisable.forEach(b => {\n          b.setAttribute('data-export-loading', 'true');\n          b.disabled = true;\n          showSpinner(b);\n        });\n\n        // For 'none' mode, still show spinner on clicked button (but don't disable)\n        const showSpinnerOnly = concurrency === 'none';\n        if (showSpinnerOnly) {\n          btn.setAttribute('data-export-loading', 'true');\n          showSpinner(btn);\n        }\n\n        try {\n          await this.config.behaviors.export.export(format, this);\n        } catch (error) {\n          // Error already handled by the export behavior (toast shown)\n          console.error('[DataGrid] Export failed:', error);\n        } finally {\n          // Clear loading state from disabled buttons\n          buttonsToDisable.forEach(b => {\n            b.removeAttribute('data-export-loading');\n            b.disabled = false;\n            hideSpinner(b);\n          });\n\n          // Clear spinner-only state for 'none' mode\n          if (showSpinnerOnly) {\n            btn.removeAttribute('data-export-loading');\n            hideSpinner(btn);\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Bind table sorting\n   */\n  private bindSorting(): void {\n    if (!this.tableEl) return;\n\n    // Bind new sort buttons ([data-sort-column])\n    const sortButtons = this.tableEl.querySelectorAll<HTMLButtonElement>('[data-sort-column]');\n\n    sortButtons.forEach((button) => {\n      button.addEventListener('click', async (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const field = button.dataset.sortColumn;\n        if (!field) return;\n\n        console.log(`[DataGrid] Sort button clicked for field: ${field}`);\n\n        // Triple-click cycle: none -> asc -> desc -> none -> asc -> ...\n        const existing = this.state.sort.find(s => s.field === field);\n        let direction: 'asc' | 'desc' | null = null;\n\n        if (existing) {\n          if (existing.direction === 'asc') {\n            // asc -> desc\n            direction = 'desc';\n            existing.direction = direction;\n          } else {\n            // desc -> none (clear sort)\n            this.state.sort = this.state.sort.filter(s => s.field !== field);\n            direction = null;\n            console.log(`[DataGrid] Sort cleared for field: ${field}`);\n          }\n        } else {\n          // none -> asc\n          direction = 'asc';\n          this.state.sort = [{ field, direction }];\n        }\n\n        console.log(`[DataGrid] New sort state:`, this.state.sort);\n\n        this.pushStateToURL();\n\n        if (direction !== null && this.config.behaviors?.sort) {\n          console.log('[DataGrid] Calling custom sort behavior');\n          await this.config.behaviors.sort.onSort(field, direction, this);\n        } else {\n          console.log('[DataGrid] Calling refresh() for sort');\n          await this.refresh();\n        }\n\n        // Update UI\n        console.log('[DataGrid] Updating sort indicators');\n        this.updateSortIndicators();\n      });\n    });\n\n    // Also bind legacy sortable headers ([data-sort])\n    const sortableHeaders = this.tableEl.querySelectorAll<HTMLElement>('[data-sort]');\n\n    sortableHeaders.forEach((header) => {\n      header.addEventListener('click', async () => {\n        const field = header.dataset.sort;\n        if (!field) return;\n\n        // Triple-click cycle: none -> asc -> desc -> none -> asc -> ...\n        const existing = this.state.sort.find(s => s.field === field);\n        let direction: 'asc' | 'desc' | null = null;\n\n        if (existing) {\n          if (existing.direction === 'asc') {\n            // asc -> desc\n            direction = 'desc';\n            existing.direction = direction;\n          } else {\n            // desc -> none (clear sort)\n            this.state.sort = this.state.sort.filter(s => s.field !== field);\n            direction = null;\n          }\n        } else {\n          // none -> asc\n          direction = 'asc';\n          this.state.sort = [{ field, direction }];\n        }\n\n        this.pushStateToURL();\n\n        if (direction !== null && this.config.behaviors?.sort) {\n          await this.config.behaviors.sort.onSort(field, direction, this);\n        } else {\n          await this.refresh();\n        }\n\n        // Update UI\n        this.updateSortIndicators();\n      });\n    });\n  }\n\n  /**\n   * Update sort indicators in table headers\n   */\n  private updateSortIndicators(): void {\n    if (!this.tableEl) return;\n\n    // Handle both old [data-sort] and new [data-sort-column] buttons\n    const sortButtons = this.tableEl.querySelectorAll<HTMLButtonElement>('[data-sort-column]');\n\n    sortButtons.forEach((button) => {\n      const field = button.dataset.sortColumn;\n      if (!field) return;\n\n      const sorted = this.state.sort.find(s => s.field === field);\n      const svg = button.querySelector('svg');\n\n      if (svg) {\n        // Update button visibility and styling based on sort state\n        if (sorted) {\n          button.classList.remove('opacity-0');\n          button.classList.add('opacity-100');\n\n          // Update icon based on direction\n          if (sorted.direction === 'asc') {\n            // Show ascending arrow (up arrow only)\n            svg.innerHTML = '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 15l7-7 7 7\" />';\n            svg.classList.add('text-blue-600');\n            svg.classList.remove('text-gray-400');\n          } else {\n            // Show descending arrow (down arrow only)\n            svg.innerHTML = '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />';\n            svg.classList.add('text-blue-600');\n            svg.classList.remove('text-gray-400');\n          }\n        } else {\n          // Reset to default double arrow\n          svg.innerHTML = '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 9l4-4 4 4m0 6l-4 4-4-4\" />';\n          svg.classList.remove('text-blue-600');\n          svg.classList.add('text-gray-400');\n        }\n      }\n    });\n\n    // Also handle legacy [data-sort] headers with .sort-indicator\n    const headers = this.tableEl.querySelectorAll<HTMLElement>('[data-sort]');\n    headers.forEach((header) => {\n      const field = header.dataset.sort;\n      const sorted = this.state.sort.find(s => s.field === field);\n\n      const indicator = header.querySelector('.sort-indicator');\n      if (indicator) {\n        indicator.textContent = sorted ? (sorted.direction === 'asc' ? '' : '') : '';\n      }\n    });\n  }\n\n  /**\n   * Bind selection checkboxes\n   */\n  private bindSelection(): void {\n    const selectAll = document.querySelector<HTMLInputElement>(this.selectors.selectAllCheckbox);\n\n    if (selectAll) {\n      selectAll.addEventListener('change', () => {\n        const checkboxes = document.querySelectorAll<HTMLInputElement>(this.selectors.rowCheckboxes);\n        checkboxes.forEach((cb) => {\n          cb.checked = selectAll.checked;\n          const id = cb.dataset.id;\n          if (id) {\n            if (selectAll.checked) {\n              this.state.selectedRows.add(id);\n            } else {\n              this.state.selectedRows.delete(id);\n            }\n          }\n        });\n        this.updateBulkActionsBar();\n      });\n    }\n\n    this.updateSelectionBindings();\n  }\n\n  /**\n   * Update selection bindings after rendering\n   * This syncs checkbox states with the selectedRows Set\n   */\n  private updateSelectionBindings(): void {\n    const checkboxes = document.querySelectorAll<HTMLInputElement>(this.selectors.rowCheckboxes);\n\n    checkboxes.forEach((cb) => {\n      const id = cb.dataset.id;\n\n      // Sync checkbox state with selectedRows Set\n      if (id) {\n        cb.checked = this.state.selectedRows.has(id);\n      }\n\n      // Remove old listeners to avoid duplicates (use once: true or track bound status in production)\n      cb.addEventListener('change', () => {\n        if (id) {\n          if (cb.checked) {\n            this.state.selectedRows.add(id);\n          } else {\n            this.state.selectedRows.delete(id);\n          }\n        }\n        this.updateBulkActionsBar();\n      });\n    });\n  }\n\n  /**\n   * Bind bulk action buttons\n   */\n  private bindBulkActions(): void {\n    const overlay = document.getElementById('bulk-actions-overlay');\n    const bulkBase = overlay?.dataset?.bulkBase || '';\n    const bulkActionButtons = document.querySelectorAll('[data-bulk-action]');\n\n    bulkActionButtons.forEach((btn) => {\n      btn.addEventListener('click', async () => {\n        const el = btn as HTMLElement;\n        const actionId = el.dataset.bulkAction;\n        if (!actionId) return;\n\n        const ids = Array.from(this.state.selectedRows);\n        if (ids.length === 0) {\n          this.notify('Please select items first', 'warning');\n          return;\n        }\n\n        // 1. Try config.bulkActions first (inline JS config)\n        if (this.config.bulkActions) {\n          const bulkActionConfig = this.config.bulkActions.find(ba => ba.id === actionId);\n          if (bulkActionConfig) {\n            try {\n              await this.actionRenderer.executeBulkAction(bulkActionConfig, ids);\n              this.state.selectedRows.clear();\n              this.updateBulkActionsBar();\n              await this.refresh();\n            } catch (error) {\n              console.error('Bulk action failed:', error);\n              this.showError('Bulk action failed');\n            }\n            return;\n          }\n        }\n\n        // 2. Try DOM data-driven config (from server-rendered data-bulk-* attributes)\n        if (bulkBase) {\n          const endpoint = `${bulkBase}/${actionId}`;\n          const confirmMsg = el.dataset.bulkConfirm;\n          const payloadRequired = this.parseDatasetStringArray(el.dataset.bulkPayloadRequired);\n          const payloadSchema = this.parseDatasetObject(el.dataset.bulkPayloadSchema);\n          const domConfig = {\n            id: actionId,\n            label: el.textContent?.trim() || actionId,\n            endpoint: endpoint,\n            confirm: confirmMsg,\n            payloadRequired: payloadRequired,\n            payloadSchema: payloadSchema,\n          };\n          try {\n            await this.actionRenderer.executeBulkAction(domConfig, ids);\n            this.state.selectedRows.clear();\n            this.updateBulkActionsBar();\n            await this.refresh();\n          } catch (error) {\n            console.error('Bulk action failed:', error);\n            this.showError('Bulk action failed');\n          }\n          return;\n        }\n\n        // 3. Fall back to behaviors.bulkActions (old system)\n        if (this.config.behaviors?.bulkActions) {\n          try {\n            await this.config.behaviors.bulkActions.execute(actionId, ids, this);\n            this.state.selectedRows.clear();\n            this.updateBulkActionsBar();\n          } catch (error) {\n            console.error('Bulk action failed:', error);\n            this.showError('Bulk action failed');\n          }\n        }\n      });\n    });\n\n    // Bind clear selection button\n    const clearBtn = document.getElementById('clear-selection-btn');\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => {\n        this.state.selectedRows.clear();\n        this.updateBulkActionsBar();\n        // Uncheck all checkboxes\n        const checkboxes = document.querySelectorAll<HTMLInputElement>('.table-checkbox');\n        checkboxes.forEach(cb => cb.checked = false);\n        const selectAll = document.querySelector<HTMLInputElement>(this.selectors.selectAllCheckbox);\n        if (selectAll) selectAll.checked = false;\n      });\n    }\n\n    // Bind overflow menu toggle\n    this.bindOverflowMenu();\n  }\n\n  /**\n   * Bind overflow menu toggle (three-dot \"More\" button)\n   */\n  private bindOverflowMenu(): void {\n    const moreBtn = document.getElementById('bulk-more-btn');\n    const menu = document.getElementById('bulk-overflow-menu');\n    if (!moreBtn || !menu) return;\n\n    moreBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      menu.classList.toggle('hidden');\n    });\n\n    // Close on outside click\n    document.addEventListener('click', () => {\n      menu.classList.add('hidden');\n    });\n\n    // Close on Escape\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        menu.classList.add('hidden');\n      }\n    });\n\n    // Prevent menu clicks from closing the menu\n    menu.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n  }\n\n  /**\n   * Update bulk actions bar visibility with animation\n   */\n  private updateBulkActionsBar(): void {\n    const overlay = document.getElementById('bulk-actions-overlay');\n    const countEl = document.getElementById('selected-count');\n    const selectedCount = this.state.selectedRows.size;\n\n    console.log('[DataGrid] updateBulkActionsBar - overlay:', overlay, 'countEl:', countEl, 'count:', selectedCount);\n\n    if (!overlay || !countEl) {\n      console.error('[DataGrid] Missing bulk actions elements!');\n      return;\n    }\n\n    // Update count\n    countEl.textContent = String(selectedCount);\n\n    // Show/hide with animation\n    if (selectedCount > 0) {\n      overlay.classList.remove('hidden');\n      // Trigger reflow for animation\n      void overlay.offsetHeight;\n    } else {\n      overlay.classList.add('hidden');\n    }\n  }\n\n  /**\n   * Bind clear selection button\n   */\n  private bindBulkClearButton(): void {\n    const clearBtn = document.getElementById('bulk-clear-selection');\n    console.log('[DataGrid] Binding clear button:', clearBtn);\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => {\n        console.log('[DataGrid] Clear button clicked!');\n        this.clearSelection();\n      });\n    } else {\n      console.error('[DataGrid] Clear button not found!');\n    }\n  }\n\n  /**\n   * Clear all selections\n   */\n  private clearSelection(): void {\n    console.log('[DataGrid] Clearing selection...');\n    this.state.selectedRows.clear();\n\n    // Uncheck the \"select all\" checkbox in the table header\n    const selectAllCheckbox = document.querySelector<HTMLInputElement>(this.selectors.selectAllCheckbox);\n    if (selectAllCheckbox) {\n      selectAllCheckbox.checked = false;\n    }\n\n    this.updateBulkActionsBar();\n    this.updateSelectionBindings();\n  }\n\n  /**\n   * Position dropdown menu intelligently based on available space\n   */\n  private positionDropdownMenu(trigger: HTMLElement, menu: HTMLElement): void {\n    const triggerRect = trigger.getBoundingClientRect();\n    const menuHeight = menu.offsetHeight || 300; // Estimate if not rendered\n    const viewportHeight = window.innerHeight;\n    const spaceBelow = viewportHeight - triggerRect.bottom;\n    const spaceAbove = triggerRect.top;\n\n    // Determine if menu should open upward or downward\n    const shouldOpenUpward = spaceBelow < menuHeight && spaceAbove > spaceBelow;\n\n    // Position horizontally (align right edge of menu with trigger)\n    const left = triggerRect.right - (menu.offsetWidth || 224); // 224px = 14rem default width\n    menu.style.left = `${Math.max(10, left)}px`; // At least 10px from left edge\n\n    // Position vertically\n    if (shouldOpenUpward) {\n      // Open upward\n      menu.style.top = `${triggerRect.top - menuHeight - 8}px`;\n      menu.style.bottom = 'auto';\n    } else {\n      // Open downward (default)\n      menu.style.top = `${triggerRect.bottom + 8}px`;\n      menu.style.bottom = 'auto';\n    }\n  }\n\n  /**\n   * Bind dropdown toggles\n   */\n  private bindDropdownToggles(): void {\n    // Ensure we don't stack global listeners across in-page navigations.\n    if (this.dropdownAbortController) {\n      this.dropdownAbortController.abort();\n    }\n    this.dropdownAbortController = new AbortController();\n    const { signal } = this.dropdownAbortController;\n\n    // Existing dropdown toggles (column visibility, export, etc.)\n    // Defensive: ensure all dropdown menus start hidden\n    document.querySelectorAll('[data-dropdown-toggle]').forEach((toggle) => {\n      const targetId = (toggle as HTMLElement).dataset.dropdownToggle;\n      const target = document.getElementById(targetId || '');\n      if (target && !target.classList.contains('hidden')) {\n        target.classList.add('hidden');\n      }\n    });\n\n    document.querySelectorAll('[data-dropdown-toggle]').forEach((toggle) => {\n      toggle.addEventListener('click', (e) => {\n        e.stopPropagation();\n        const targetId = (toggle as HTMLElement).dataset.dropdownToggle;\n        const target = document.getElementById(targetId || '');\n\n        if (target) {\n          const isOpening = target.classList.contains('hidden');\n\n          // Close all other toggle dropdowns before opening this one\n          document.querySelectorAll('[data-dropdown-toggle]').forEach((otherToggle) => {\n            const otherId = (otherToggle as HTMLElement).dataset.dropdownToggle;\n            const otherTarget = document.getElementById(otherId || '');\n            if (otherTarget && otherTarget !== target) {\n              otherTarget.classList.add('hidden');\n            }\n          });\n\n          // Toggle this dropdown\n          target.classList.toggle('hidden');\n        }\n      }, { signal });\n    });\n\n    // Action dropdown menus (row actions)\n    document.addEventListener('click', (e) => {\n      const trigger = (e.target as HTMLElement).closest('[data-dropdown-trigger]');\n\n      if (trigger) {\n        e.stopPropagation();\n        const dropdown = trigger.closest('[data-dropdown]');\n        const menu = dropdown?.querySelector('.actions-menu') as HTMLElement;\n\n        // Close other action dropdowns\n        document.querySelectorAll('.actions-menu').forEach(m => {\n          if (m !== menu) m.classList.add('hidden');\n        });\n\n        // Toggle this dropdown\n        const isOpening = menu?.classList.contains('hidden');\n        menu?.classList.toggle('hidden');\n        trigger.setAttribute('aria-expanded', isOpening ? 'true' : 'false');\n\n        // Position the dropdown intelligently (only when opening)\n        if (isOpening && menu) {\n          this.positionDropdownMenu(trigger as HTMLElement, menu);\n        }\n      } else {\n        // Check if the click is inside an open dropdown menu (e.g., column toggle menu)\n        const clickedInsideDropdownMenu = (e.target as HTMLElement).closest('[data-dropdown-toggle], #column-toggle-menu, #export-menu');\n\n        if (!clickedInsideDropdownMenu) {\n          // Close all action dropdowns when clicking outside\n          document.querySelectorAll('.actions-menu').forEach(m =>\n            m.classList.add('hidden')\n          );\n\n          // Also close existing dropdowns\n          document.querySelectorAll('[data-dropdown-toggle]').forEach((toggle) => {\n            const targetId = (toggle as HTMLElement).dataset.dropdownToggle;\n            const target = document.getElementById(targetId || '');\n            if (target) {\n              target.classList.add('hidden');\n            }\n          });\n        }\n      }\n    }, { signal });\n\n    // ESC key closes all dropdowns\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        // Close action dropdowns\n        document.querySelectorAll('.actions-menu').forEach(m => {\n          m.classList.add('hidden');\n          const trigger = m.closest('[data-dropdown]')?.querySelector('[data-dropdown-trigger]');\n          if (trigger) trigger.setAttribute('aria-expanded', 'false');\n        });\n\n        // Close toggle dropdowns (column visibility, export, etc.)\n        document.querySelectorAll('[data-dropdown-toggle]').forEach((toggle) => {\n          const targetId = (toggle as HTMLElement).dataset.dropdownToggle;\n          const target = document.getElementById(targetId || '');\n          if (target) {\n            target.classList.add('hidden');\n          }\n        });\n      }\n    }, { signal });\n  }\n\n  /**\n   * Show error message using notifier\n   */\n  private showError(message: string): void {\n    console.error(message);\n    this.notifier.error(message);\n  }\n\n  /**\n   * Show notification using notifier\n   */\n  private notify(message: string, type: 'success' | 'error' | 'warning' | 'info'): void {\n    this.notifier.show({ message, type });\n  }\n\n  /**\n   * Show confirmation dialog using notifier\n   */\n  private async confirmAction(message: string): Promise<boolean> {\n    return this.notifier.confirm(message);\n  }\n\n  /**\n   * Extract error message from Response or Error\n   */\n  private async extractError(error: unknown): Promise<string> {\n    if (error instanceof Response) {\n      return extractErrorMessage(error);\n    }\n    if (error instanceof Error) {\n      return error.message;\n    }\n    return 'An unexpected error occurred';\n  }\n\n  private parseDatasetStringArray(raw: string | undefined): string[] | undefined {\n    if (!raw) {\n      return undefined;\n    }\n    try {\n      const parsed = JSON.parse(raw) as unknown;\n      if (!Array.isArray(parsed)) {\n        return undefined;\n      }\n      const result = parsed\n        .map((item) => (typeof item === 'string' ? item.trim() : ''))\n        .filter((item) => item.length > 0);\n      return result.length > 0 ? result : undefined;\n    } catch (error) {\n      console.warn('[DataGrid] Failed to parse bulk payload_required:', error);\n      return undefined;\n    }\n  }\n\n  private parseDatasetObject(raw: string | undefined): Record<string, unknown> | undefined {\n    if (!raw) {\n      return undefined;\n    }\n    try {\n      const parsed = JSON.parse(raw) as unknown;\n      if (!parsed || typeof parsed !== 'object' || Array.isArray(parsed)) {\n        return undefined;\n      }\n      return parsed as Record<string, unknown>;\n    } catch (error) {\n      console.warn('[DataGrid] Failed to parse bulk payload_schema:', error);\n      return undefined;\n    }\n  }\n\n  /**\n   * Reorder columns based on the provided order array\n   * Updates config.columns order and triggers DOM reordering\n   * Note: Column order is NOT pushed to URL by default (per guiding notes)\n   */\n  reorderColumns(newOrder: string[]): void {\n    if (!this.tableEl) return;\n\n    // Validate and merge order with current columns\n    // - Keep only columns that exist in config.columns\n    // - Append any new columns not in newOrder\n    const validOrder = this.mergeColumnOrder(newOrder);\n\n    // Update state\n    this.state.columnOrder = validOrder;\n\n    // Reorder config.columns to match the new order\n    const columnMap = new Map(this.config.columns.map(c => [c.field, c]));\n    this.config.columns = validOrder\n      .map(field => columnMap.get(field))\n      .filter((c): c is ColumnDefinition => c !== undefined);\n\n    // Reorder DOM elements\n    this.reorderTableColumns(validOrder);\n\n    console.log('[DataGrid] Columns reordered:', validOrder);\n  }\n\n  /**\n   * Reset columns to their initial/default order and visibility.\n   * Intended to be called by ColumnManager's \"Reset to Default\" action.\n   */\n  resetColumnsToDefault(): void {\n    // Clear persisted preferences first (localStorage + optional server sync)\n    // so \"Reset to Default\" truly removes saved state instead of re-saving defaults.\n    this.config.behaviors?.columnVisibility?.clearSavedPrefs?.();\n\n    // Restore default config columns (shallow copies)\n    this.config.columns = this.defaultColumns.map(col => ({ ...col }));\n    this.state.columnOrder = this.config.columns.map(col => col.field);\n\n    // Default visibility: visible unless column.hidden is true\n    const visibleColumns = this.config.columns\n      .filter(col => !col.hidden)\n      .map(col => col.field);\n\n    // Apply DOM updates if table is initialized\n    if (this.tableEl) {\n      this.reorderTableColumns(this.state.columnOrder);\n      this.updateColumnVisibility(visibleColumns);\n    } else {\n      this.state.hiddenColumns = new Set(\n        this.config.columns.filter(col => col.hidden).map(col => col.field)\n      );\n    }\n\n    // Re-render the column menu to reflect defaults (Sortable is re-initialized in refresh()).\n    if (this.columnManager) {\n      this.columnManager.refresh();\n      this.columnManager.syncWithGridState();\n    }\n\n    console.log('[DataGrid] Columns reset to default');\n  }\n\n  /**\n   * Merge and validate saved column order with current columns\n   * - Drops columns that no longer exist\n   * - Appends new columns that aren't in saved order\n   */\n  private mergeColumnOrder(savedOrder: string[]): string[] {\n    const currentFields = new Set(this.config.columns.map(c => c.field));\n    const savedSet = new Set(savedOrder);\n\n    // Keep only saved columns that still exist\n    const validSaved = savedOrder.filter(field => currentFields.has(field));\n\n    // Find new columns not in saved order (append at end)\n    const newColumns = this.config.columns\n      .map(c => c.field)\n      .filter(field => !savedSet.has(field));\n\n    return [...validSaved, ...newColumns];\n  }\n\n  /**\n   * Reorder table DOM elements (header, filter row, body rows)\n   * Moves existing nodes rather than recreating them to preserve event listeners\n   */\n  private reorderTableColumns(order: string[]): void {\n    if (!this.tableEl) return;\n\n    // Reorder header row\n    const headerRow = this.tableEl.querySelector('thead tr:first-child');\n    if (headerRow) {\n      this.reorderRowCells(headerRow, order, 'th');\n    }\n\n    // Reorder filter row\n    const filterRow = this.tableEl.querySelector('#filter-row');\n    if (filterRow) {\n      this.reorderRowCells(filterRow, order, 'th');\n    }\n\n    // Reorder body rows\n    const bodyRows = this.tableEl.querySelectorAll('tbody tr');\n    bodyRows.forEach(row => {\n      this.reorderRowCells(row, order, 'td');\n    });\n  }\n\n  /**\n   * Reorder cells within a single row\n   * Preserves fixed columns (selection on left, actions on right)\n   */\n  private reorderRowCells(row: Element, order: string[], cellTag: 'th' | 'td'): void {\n    // Get data cells (those with data-column attribute)\n    const dataCells = Array.from(row.querySelectorAll(`${cellTag}[data-column]`));\n    const cellMap = new Map(\n      dataCells.map(cell => [(cell as HTMLElement).dataset.column!, cell])\n    );\n\n    // Get fixed cells (selection/actions)\n    // Prefer explicit markers; fall back to heuristics for legacy tables.\n    const allCells = Array.from(row.querySelectorAll(cellTag));\n    const selectionCell =\n      row.querySelector(`${cellTag}[data-role=\"selection\"]`) ||\n      allCells.find(cell => cell.querySelector('input[type=\"checkbox\"]'));\n    const actionsCell =\n      row.querySelector(`${cellTag}[data-role=\"actions\"]`) ||\n      allCells.find(cell =>\n        !((cell as HTMLElement).dataset.column) && (\n          cell.querySelector('[data-action]') ||\n          cell.querySelector('[data-action-id]') ||\n          cell.querySelector('.dropdown')\n        )\n      );\n\n    // Build reordered cells array\n    const reorderedCells: Element[] = [];\n\n    // Add selection cell first (if exists)\n    if (selectionCell) {\n      reorderedCells.push(selectionCell);\n    }\n\n    // Add data cells in new order\n    order.forEach(field => {\n      const cell = cellMap.get(field);\n      if (cell) {\n        reorderedCells.push(cell);\n      }\n    });\n\n    // Add actions cell last (if exists)\n    if (actionsCell) {\n      reorderedCells.push(actionsCell);\n    }\n\n    // Move cells to new positions (appending moves, doesn't clone)\n    reorderedCells.forEach(cell => {\n      row.appendChild(cell);\n    });\n  }\n\n  /**\n   * Cleanup and destroy the DataGrid instance\n   * Call this when removing the grid from the DOM to prevent memory leaks\n   */\n  destroy(): void {\n    // Destroy ColumnManager (cleans up SortableJS instance)\n    if (this.columnManager) {\n      this.columnManager.destroy();\n      this.columnManager = null;\n    }\n\n    // Remove global dropdown listeners\n    if (this.dropdownAbortController) {\n      this.dropdownAbortController.abort();\n      this.dropdownAbortController = null;\n    }\n\n    // Abort any pending API requests\n    if (this.abortController) {\n      this.abortController.abort();\n      this.abortController = null;\n    }\n\n    // Clear search timeout\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n      this.searchTimeout = null;\n    }\n\n    console.log('[DataGrid] Instance destroyed');\n  }\n}\n\n// Export for global usage\nif (typeof window !== 'undefined') {\n  (window as any).DataGrid = DataGrid;\n}\n","/**\n * Advanced Search Component\n * Provides a query builder UI for complex search queries\n */\n\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\nimport { TextPromptModal } from '../shared/modal.js';\n\nexport interface SearchCriterion {\n  field: string;\n  operator: string;\n  value: string | number;\n  logic?: 'and' | 'or'; // Logic connector to next criterion\n}\n\nexport interface AdvancedSearchConfig {\n  fields: FieldDefinition[];\n  onSearch: (criteria: SearchCriterion[]) => void;\n  onClear: () => void;\n  notifier?: ToastNotifier;\n}\n\nexport interface FieldDefinition {\n  name: string;\n  label: string;\n  type: 'text' | 'number' | 'select' | 'date';\n  operators?: string[];\n  options?: { label: string; value: string }[];\n}\n\nconst DEFAULT_OPERATORS: Record<string, { label: string; value: string }[]> = {\n  text: [\n    { label: 'contains', value: 'ilike' },\n    { label: 'equals', value: 'eq' },\n    { label: 'starts with', value: 'starts' },\n    { label: 'ends with', value: 'ends' },\n    { label: 'not equals', value: 'ne' }\n  ],\n  number: [\n    { label: 'equals', value: 'eq' },\n    { label: 'not equals', value: 'ne' },\n    { label: 'greater than', value: 'gt' },\n    { label: 'less than', value: 'lt' },\n    { label: 'between', value: 'between' }\n  ],\n  select: [\n    { label: 'equals', value: 'eq' },\n    { label: 'not equals', value: 'ne' }\n  ],\n  date: [\n    { label: 'on', value: 'eq' },\n    { label: 'before', value: 'lt' },\n    { label: 'after', value: 'gt' },\n    { label: 'between', value: 'between' }\n  ]\n};\n\nexport class AdvancedSearch {\n  private config: AdvancedSearchConfig;\n  private criteria: SearchCriterion[] = [];\n  private modal: HTMLElement | null = null;\n  private container: HTMLElement | null = null;\n  private searchInput: HTMLInputElement | null = null;\n  private clearBtn: HTMLElement | null = null;\n  private notifier: ToastNotifier;\n\n  constructor(config: AdvancedSearchConfig) {\n    this.config = config;\n    this.notifier = config.notifier || new FallbackNotifier();\n  }\n\n  init(): void {\n    this.modal = document.getElementById('advanced-search-modal');\n    this.container = document.getElementById('search-criteria-container');\n    this.searchInput = document.getElementById('table-search') as HTMLInputElement;\n    this.clearBtn = document.getElementById('search-clear-btn');\n\n    if (!this.modal || !this.container) {\n      console.error('[AdvancedSearch] Required elements not found');\n      return;\n    }\n\n    // Restore criteria from URL on init\n    this.restoreCriteriaFromURL();\n\n    // Re-render to show restored criteria in the modal and chips in input\n    if (this.criteria.length > 0) {\n      this.renderCriteria();\n      this.renderChips();\n    }\n\n    this.bindEvents();\n    this.bindClearButton();\n  }\n\n  /**\n   * Restore advanced search criteria from URL\n   */\n  private restoreCriteriaFromURL(): void {\n    const params = new URLSearchParams(window.location.search);\n    // Use the same 'filters' parameter as DataGrid for consistency\n    const filtersParam = params.get('filters');\n\n    if (filtersParam) {\n      try {\n        const filters = JSON.parse(filtersParam);\n        // Convert DataGrid filters format to advanced search criteria format\n        this.criteria = filters.map((f: any) => ({\n          field: f.column,\n          operator: f.operator || 'ilike',\n          value: f.value,\n          logic: 'and' // Default logic connector\n        }));\n        console.log('[AdvancedSearch] Restored criteria from URL:', this.criteria);\n      } catch (e) {\n        console.warn('[AdvancedSearch] Failed to parse filters from URL:', e);\n      }\n    }\n  }\n\n  /**\n   * Push criteria to URL\n   */\n  private pushCriteriaToURL(): void {\n    const params = new URLSearchParams(window.location.search);\n\n    if (this.criteria.length > 0) {\n      params.set('advancedSearch', JSON.stringify(this.criteria));\n    } else {\n      params.delete('advancedSearch');\n    }\n\n    const newURL = params.toString()\n      ? `${window.location.pathname}?${params.toString()}`\n      : window.location.pathname;\n\n    window.history.pushState({}, '', newURL);\n    console.log('[AdvancedSearch] URL updated with criteria');\n  }\n\n  private bindEvents(): void {\n    // Open modal\n    const openBtn = document.getElementById('advanced-search-btn');\n    openBtn?.addEventListener('click', () => this.open());\n\n    // Close modal\n    const closeBtn = document.getElementById('advanced-search-close');\n    const cancelBtn = document.getElementById('advanced-search-cancel');\n    const overlay = document.getElementById('advanced-search-overlay');\n\n    closeBtn?.addEventListener('click', () => this.close());\n    cancelBtn?.addEventListener('click', () => this.close());\n    overlay?.addEventListener('click', () => this.close());\n\n    // Add criteria\n    const addBtn = document.getElementById('add-criteria-btn');\n    addBtn?.addEventListener('click', () => this.addCriterion());\n\n    // Apply search\n    const applyBtn = document.getElementById('advanced-search-apply');\n    applyBtn?.addEventListener('click', () => this.applySearch());\n\n    // Save/Load presets\n    const saveBtn = document.getElementById('save-search-preset-btn');\n    const loadBtn = document.getElementById('load-search-preset-btn');\n\n    saveBtn?.addEventListener('click', () => this.savePreset());\n    loadBtn?.addEventListener('click', () => this.loadPreset());\n  }\n\n  private bindClearButton(): void {\n    if (!this.searchInput || !this.clearBtn) return;\n\n    // Show/hide clear button based on input value\n    const updateClearButton = () => {\n      if (this.searchInput!.value.trim()) {\n        this.clearBtn!.classList.remove('hidden');\n      } else {\n        this.clearBtn!.classList.add('hidden');\n      }\n    };\n\n    this.searchInput.addEventListener('input', updateClearButton);\n\n    // Clear search\n    this.clearBtn.addEventListener('click', () => {\n      if (this.searchInput) {\n        this.searchInput.value = '';\n        this.clearBtn!.classList.add('hidden');\n\n        // Clear advanced search criteria and chips\n        this.clearAllChips();\n      }\n    });\n\n    // Initial update\n    updateClearButton();\n  }\n\n  open(): void {\n    if (!this.modal) return;\n\n    this.modal.classList.remove('hidden');\n\n    // Initialize with one criterion if empty\n    if (this.criteria.length === 0) {\n      this.addCriterion();\n    } else {\n      this.renderCriteria();\n    }\n  }\n\n  close(): void {\n    if (!this.modal) return;\n    this.modal.classList.add('hidden');\n  }\n\n  addCriterion(criterion?: Partial<SearchCriterion>): void {\n    const newCriterion: SearchCriterion = {\n      field: criterion?.field || this.config.fields[0]?.name || '',\n      operator: criterion?.operator || 'ilike',\n      value: criterion?.value || '',\n      logic: criterion?.logic || 'and'\n    };\n\n    this.criteria.push(newCriterion);\n    this.renderCriteria();\n  }\n\n  removeCriterion(index: number): void {\n    this.criteria.splice(index, 1);\n    this.renderCriteria();\n  }\n\n  private renderCriteria(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = '';\n\n    this.criteria.forEach((criterion, index) => {\n      // Create wrapper for row + connector to keep separator line behind buttons\n      const wrapper = document.createElement('div');\n\n      const row = this.createCriterionRow(criterion, index);\n      wrapper.appendChild(row);\n\n      // Add logic connector between rows (except last)\n      if (index < this.criteria.length - 1) {\n        const connector = this.createLogicConnector(index);\n        wrapper.appendChild(connector);\n      }\n\n      this.container!.appendChild(wrapper);\n    });\n  }\n\n  private createCriterionRow(criterion: SearchCriterion, index: number): HTMLElement {\n    const row = document.createElement('div');\n    row.className = 'flex items-center gap-2 py-3';\n\n    const field = this.config.fields.find(f => f.name === criterion.field) || this.config.fields[0];\n\n    // Field selector\n    row.innerHTML = `\n      <select data-criterion-index=\"${index}\" data-criterion-part=\"field\"\n              class=\"py-2 px-3 pe-9 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50\">\n        ${this.config.fields.map(f => `\n          <option value=\"${f.name}\" ${f.name === criterion.field ? 'selected' : ''}>${f.label}</option>\n        `).join('')}\n      </select>\n\n      <select data-criterion-index=\"${index}\" data-criterion-part=\"operator\"\n              class=\"py-2 px-3 pe-9 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50\">\n        ${this.getOperatorsForField(field).map(op => `\n          <option value=\"${op.value}\" ${op.value === criterion.operator ? 'selected' : ''}>${op.label}</option>\n        `).join('')}\n      </select>\n\n      ${this.createValueInput(field, criterion, index)}\n\n      <button type=\"button\" data-criterion-index=\"${index}\" data-action=\"remove\"\n              class=\"p-2 text-gray-400 hover:text-red-600\">\n        <svg class=\"h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M3 6h18\"/><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/>\n        </svg>\n      </button>\n    `;\n\n    // Bind events\n    row.querySelectorAll('select, input').forEach(el => {\n      el.addEventListener('change', (e) => this.updateCriterion(e.target as HTMLElement));\n    });\n\n    row.querySelector('[data-action=\"remove\"]')?.addEventListener('click', () => {\n      this.removeCriterion(index);\n    });\n\n    return row;\n  }\n\n  private createValueInput(field: FieldDefinition, criterion: SearchCriterion, index: number): string {\n    if (field.type === 'select' && field.options) {\n      return `\n        <select data-criterion-index=\"${index}\" data-criterion-part=\"value\"\n                class=\"flex-1 py-2 px-3 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500\">\n          <option value=\"\">Select...</option>\n          ${field.options.map(opt => `\n            <option value=\"${opt.value}\" ${opt.value === criterion.value ? 'selected' : ''}>${opt.label}</option>\n          `).join('')}\n        </select>\n      `;\n    }\n\n    const inputType = field.type === 'date' ? 'date' : field.type === 'number' ? 'number' : 'text';\n\n    return `\n      <input type=\"${inputType}\"\n             data-criterion-index=\"${index}\"\n             data-criterion-part=\"value\"\n             value=\"${criterion.value}\"\n             placeholder=\"Enter value...\"\n             class=\"flex-1 py-2 px-3 block border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500\">\n    `;\n  }\n\n  private createLogicConnector(index: number): HTMLElement {\n    const connector = document.createElement('div');\n    connector.className = 'flex items-center justify-center gap-2 py-2';\n\n    const logic = this.criteria[index].logic || 'and';\n\n    connector.innerHTML = `\n      <button type=\"button\"\n              data-logic-index=\"${index}\"\n              data-logic-value=\"and\"\n              class=\"px-3 py-1 text-xs font-medium rounded border ${logic === 'and' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        And\n      </button>\n      <button type=\"button\"\n              data-logic-index=\"${index}\"\n              data-logic-value=\"or\"\n              class=\"px-3 py-1 text-xs font-medium rounded border ${logic === 'or' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        Or\n      </button>\n    `;\n\n    connector.querySelectorAll('[data-logic-index]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const idx = parseInt(target.dataset.logicIndex || '0', 10);\n        const value = target.dataset.logicValue as 'and' | 'or';\n        this.criteria[idx].logic = value;\n        this.renderCriteria();\n      });\n    });\n\n    return connector;\n  }\n\n  private updateCriterion(element: HTMLElement): void {\n    const index = parseInt(element.dataset.criterionIndex || '0', 10);\n    const part = element.dataset.criterionPart as 'field' | 'operator' | 'value';\n\n    if (!this.criteria[index]) return;\n\n    const value = (element as HTMLInputElement | HTMLSelectElement).value;\n\n    if (part === 'field') {\n      this.criteria[index].field = value;\n      // Re-render to update operators and value input for new field type\n      this.renderCriteria();\n    } else if (part === 'operator') {\n      this.criteria[index].operator = value;\n    } else if (part === 'value') {\n      this.criteria[index].value = value;\n    }\n  }\n\n  private getOperatorsForField(field: FieldDefinition): { label: string; value: string }[] {\n    if (field.operators && field.operators.length > 0) {\n      return field.operators.map(op => ({ label: op, value: op }));\n    }\n    return DEFAULT_OPERATORS[field.type] || DEFAULT_OPERATORS.text;\n  }\n\n  private applySearch(): void {\n    this.pushCriteriaToURL();\n    this.config.onSearch(this.criteria);\n    this.renderChips(); // Render chips before closing modal\n    this.close();\n  }\n\n  private savePreset(): void {\n    const modal = new TextPromptModal({\n      title: 'Save Search Preset',\n      label: 'Preset name',\n      placeholder: 'e.g. Active users filter',\n      confirmLabel: 'Save',\n      onConfirm: (name) => {\n        const presets = this.loadPresetsFromStorage();\n        presets[name] = this.criteria;\n        localStorage.setItem('search_presets', JSON.stringify(presets));\n        this.notifier.success(`Preset \"${name}\" saved!`);\n      },\n    });\n    modal.show();\n  }\n\n  private loadPreset(): void {\n    const presets = this.loadPresetsFromStorage();\n    const names = Object.keys(presets);\n\n    if (names.length === 0) {\n      this.notifier.warning('No saved presets found.');\n      return;\n    }\n\n    const modal = new TextPromptModal({\n      title: 'Load Search Preset',\n      label: `Available presets: ${names.join(', ')}`,\n      placeholder: 'Enter preset name',\n      confirmLabel: 'Load',\n      onConfirm: (name) => {\n        if (!presets[name]) {\n          this.notifier.warning(`Preset \"${name}\" not found.`);\n          return;\n        }\n        this.criteria = presets[name];\n        this.renderCriteria();\n      },\n    });\n    modal.show();\n  }\n\n  private loadPresetsFromStorage(): Record<string, SearchCriterion[]> {\n    try {\n      const stored = localStorage.getItem('search_presets');\n      return stored ? JSON.parse(stored) : {};\n    } catch (e) {\n      return {};\n    }\n  }\n\n  getCriteria(): SearchCriterion[] {\n    return this.criteria;\n  }\n\n  setCriteria(criteria: SearchCriterion[]): void {\n    this.criteria = criteria;\n    this.renderCriteria();\n    this.renderChips();\n  }\n\n  /**\n   * Render filter chips in the search input\n   */\n  renderChips(): void {\n    const chipsContainer = document.getElementById('filter-chips-container');\n    const searchInput = document.getElementById('table-search') as HTMLInputElement;\n    const clearBtn = document.getElementById('search-clear-btn');\n\n    if (!chipsContainer) return;\n\n    chipsContainer.innerHTML = '';\n\n    if (this.criteria.length === 0) {\n      // No chips - show placeholder, hide clear button\n      if (searchInput) {\n        searchInput.placeholder = 'Search for items';\n        searchInput.style.display = '';\n      }\n      if (clearBtn) clearBtn.classList.add('hidden');\n      return;\n    }\n\n    // Hide placeholder when chips present\n    if (searchInput) {\n      searchInput.placeholder = '';\n      searchInput.style.display = '';\n    }\n\n    // Show clear button\n    if (clearBtn) clearBtn.classList.remove('hidden');\n\n    // Render each criterion as a chip\n    this.criteria.forEach((criterion, index) => {\n      const chip = this.createChip(criterion, index);\n      chipsContainer.appendChild(chip);\n    });\n  }\n\n  /**\n   * Create a single filter chip\n   */\n  private createChip(criterion: SearchCriterion, index: number): HTMLElement {\n    const chip = document.createElement('div');\n    chip.className = 'inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded border border-blue-200';\n\n    const field = this.config.fields.find(f => f.name === criterion.field);\n    const fieldLabel = field?.label || criterion.field;\n    const operatorLabel = criterion.operator === 'ilike' ? 'contains' :\n                         criterion.operator === 'eq' ? 'is' :\n                         criterion.operator;\n\n    chip.innerHTML = `\n      <span>${fieldLabel} ${operatorLabel} \"${criterion.value}\"</span>\n      <button type=\"button\"\n              data-chip-index=\"${index}\"\n              class=\"ml-1 text-blue-600 hover:text-blue-800 focus:outline-none\"\n              title=\"Remove filter\">\n        <svg class=\"h-3 w-3\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/>\n        </svg>\n      </button>\n    `;\n\n    // Bind remove handler\n    const removeBtn = chip.querySelector('[data-chip-index]');\n    if (removeBtn) {\n      removeBtn.addEventListener('click', () => {\n        this.removeChip(index);\n      });\n    }\n\n    return chip;\n  }\n\n  /**\n   * Remove a chip and update filters\n   */\n  private removeChip(index: number): void {\n    this.criteria.splice(index, 1);\n    this.renderCriteria();\n    this.renderChips();\n\n    // Trigger search with updated criteria\n    this.config.onSearch(this.criteria);\n  }\n\n  /**\n   * Clear all chips\n   */\n  clearAllChips(): void {\n    this.criteria = [];\n    this.renderCriteria();\n    this.renderChips();\n\n    // Trigger clear callback\n    if (this.config.onClear) {\n      this.config.onClear();\n    }\n  }\n}\n","/**\n * FilterBuilder Component\n *\n * Manages complex filter groups with AND/OR logic between conditions and groups.\n * Renders a UI similar to query builders with drag-and-drop reordering.\n */\n\nimport type { FilterCondition, FilterGroup, FilterStructure } from './behaviors/types.js';\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\n\nexport interface FieldDefinition {\n  name: string;\n  label: string;\n  type: 'text' | 'number' | 'date' | 'select';\n  operators?: string[];\n  options?: { label: string; value: string }[];\n}\n\nexport interface FilterBuilderConfig {\n  fields: FieldDefinition[];\n  onApply: (structure: FilterStructure) => void;\n  onClear: () => void;\n  notifier?: ToastNotifier;\n}\n\nconst DEFAULT_OPERATORS: Record<string, { label: string; value: string }[]> = {\n  text: [\n    { label: 'contains', value: 'ilike' },\n    { label: 'is', value: 'eq' },\n    { label: 'is not', value: 'ne' },\n  ],\n  number: [\n    { label: 'equals', value: 'eq' },\n    { label: 'not equals', value: 'ne' },\n    { label: 'greater than', value: 'gt' },\n    { label: 'less than', value: 'lt' },\n    { label: 'greater than or equal', value: 'gte' },\n    { label: 'less than or equal', value: 'lte' },\n  ],\n  date: [\n    { label: 'is', value: 'eq' },\n    { label: 'before', value: 'lt' },\n    { label: 'after', value: 'gt' },\n  ],\n  select: [\n    { label: 'is', value: 'eq' },\n    { label: 'is not', value: 'ne' },\n  ],\n};\n\nexport class FilterBuilder {\n  private config: FilterBuilderConfig;\n  private structure: FilterStructure;\n  private panel: HTMLElement | null = null;\n  private container: HTMLElement | null = null;\n  private previewElement: HTMLElement | null = null;\n  private sqlPreviewElement: HTMLElement | null = null;\n  private overlay: HTMLElement | null = null;\n  private notifier: ToastNotifier;\n\n  constructor(config: FilterBuilderConfig) {\n    this.config = config;\n    this.notifier = config.notifier || new FallbackNotifier();\n    this.structure = { groups: [], groupLogic: [] };\n    this.init();\n  }\n\n  private init(): void {\n    this.panel = document.getElementById('filter-panel');\n    this.overlay = document.getElementById('filter-overlay');\n    this.previewElement = document.getElementById('filter-preview-text');\n\n    if (!this.panel) {\n      console.error('[FilterBuilder] Panel element not found');\n      return;\n    }\n\n    // Build panel structure\n    this.buildPanelStructure();\n\n    // Bind toggle button\n    const toggleBtn = document.getElementById('filter-toggle-btn');\n    if (toggleBtn) {\n      toggleBtn.addEventListener('click', () => this.toggle());\n    }\n\n    // Bind clear filters\n    const clearBtn = document.getElementById('clear-filters-btn');\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => this.clearFilters());\n    }\n\n    // Close on overlay click\n    if (this.overlay) {\n      this.overlay.addEventListener('click', () => this.close());\n    }\n\n    // Close on Escape\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape' && !this.panel!.classList.contains('hidden')) {\n        this.close();\n      }\n    });\n\n    // Restore from URL\n    this.restoreFromURL();\n  }\n\n  private buildPanelStructure(): void {\n    if (!this.panel) return;\n\n    this.panel.innerHTML = `\n      <div class=\"flex items-center justify-between mb-4\">\n        <h3 class=\"text-base font-semibold text-gray-900\">Filters</h3>\n        <div class=\"flex gap-2\">\n          <button type=\"button\" id=\"saved-filters-btn\" class=\"text-sm text-blue-600 hover:text-blue-800\">\n            Saved filters \n          </button>\n          <button type=\"button\" id=\"edit-sql-btn\" class=\"text-sm text-blue-600 hover:text-blue-800\">\n            Edit as SQL\n          </button>\n        </div>\n      </div>\n\n      <!-- Filter Groups Container -->\n      <div id=\"filter-groups-container\" class=\"space-y-3 mb-4\">\n        <!-- Groups will be rendered here -->\n      </div>\n\n      <!-- Add Group Button -->\n      <button type=\"button\" id=\"add-group-btn\" class=\"inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800 mb-4\">\n        <svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"/><rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"/>\n          <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"/><rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"/>\n        </svg>\n        AND\n      </button>\n\n      <!-- SQL Preview -->\n      <div class=\"border-t border-gray-200 pt-3 mb-4\">\n        <div class=\"text-xs text-gray-500 mb-1\">Preview:</div>\n        <div id=\"sql-preview\" class=\"text-xs font-mono text-gray-700 bg-gray-50 p-2 rounded border border-gray-200 min-h-[40px] max-h-[100px] overflow-y-auto break-words\">\n          No filters applied\n        </div>\n      </div>\n\n      <!-- Action Buttons -->\n      <div class=\"flex items-center justify-between border-t border-gray-200 pt-4\">\n        <div class=\"flex gap-2\">\n          <input type=\"text\" id=\"save-filter-name\" placeholder=\"Type a name here\" class=\"text-sm border border-gray-200 rounded px-3 py-1.5 w-48\">\n          <button type=\"button\" id=\"save-filter-btn\" class=\"text-sm text-gray-600 hover:text-gray-800 border border-gray-200 rounded px-3 py-1.5\">\n            Save filter\n          </button>\n        </div>\n        <div class=\"flex gap-2\">\n          <button type=\"button\" id=\"clear-all-btn\" class=\"text-sm text-gray-700 hover:text-gray-900 px-4 py-2\">\n            Clear all\n          </button>\n          <button type=\"button\" id=\"apply-filter-btn\" class=\"text-sm text-white bg-blue-600 hover:bg-blue-700 rounded-lg px-4 py-2\">\n            Apply filter\n          </button>\n        </div>\n      </div>\n    `;\n\n    this.container = document.getElementById('filter-groups-container');\n    this.sqlPreviewElement = document.getElementById('sql-preview');\n\n    // Bind action buttons\n    this.bindActions();\n\n    // Start with one empty group\n    if (this.structure.groups.length === 0) {\n      this.addGroup();\n    }\n  }\n\n  private bindActions(): void {\n    const addGroupBtn = document.getElementById('add-group-btn');\n    const applyBtn = document.getElementById('apply-filter-btn');\n    const clearAllBtn = document.getElementById('clear-all-btn');\n    const saveBtn = document.getElementById('save-filter-btn');\n\n    if (addGroupBtn) {\n      addGroupBtn.addEventListener('click', () => this.addGroup());\n    }\n\n    if (applyBtn) {\n      applyBtn.addEventListener('click', () => this.applyFilters());\n    }\n\n    if (clearAllBtn) {\n      clearAllBtn.addEventListener('click', () => this.clearAll());\n    }\n\n    if (saveBtn) {\n      saveBtn.addEventListener('click', () => this.saveFilter());\n    }\n  }\n\n  private addGroup(): void {\n    const newGroup: FilterGroup = {\n      conditions: [this.createEmptyCondition()],\n      logic: 'or'\n    };\n\n    this.structure.groups.push(newGroup);\n\n    // Add group logic if not first group\n    if (this.structure.groups.length > 1) {\n      this.structure.groupLogic.push('and');\n    }\n\n    this.render();\n  }\n\n  private createEmptyCondition(): FilterCondition {\n    const firstField = this.config.fields[0];\n    return {\n      field: firstField.name,\n      operator: 'ilike',\n      value: ''\n    };\n  }\n\n  private render(): void {\n    if (!this.container) return;\n\n    this.container.innerHTML = '';\n\n    this.structure.groups.forEach((group, groupIndex) => {\n      // Create group container\n      const groupEl = this.createGroupElement(group, groupIndex);\n      this.container!.appendChild(groupEl);\n\n      // Add group logic connector (except after last group)\n      if (groupIndex < this.structure.groups.length - 1) {\n        const connector = this.createGroupConnector(groupIndex);\n        this.container!.appendChild(connector);\n      }\n    });\n\n    this.updatePreview();\n  }\n\n  private createGroupElement(group: FilterGroup, groupIndex: number): HTMLElement {\n    const groupEl = document.createElement('div');\n    groupEl.className = 'border border-gray-200 rounded-lg p-3 bg-gray-50';\n\n    // Group header (if multiple groups)\n    const header = document.createElement('div');\n    header.className = 'flex justify-end mb-2';\n    header.innerHTML = `\n      <button type=\"button\" data-remove-group=\"${groupIndex}\" class=\"text-xs text-red-600 hover:text-red-800\">\n        Remove group\n      </button>\n    `;\n    groupEl.appendChild(header);\n\n    // Render conditions\n    group.conditions.forEach((condition, condIndex) => {\n      const condEl = this.createConditionElement(condition, groupIndex, condIndex);\n      groupEl.appendChild(condEl);\n\n      // Add condition logic (except after last condition)\n      if (condIndex < group.conditions.length - 1) {\n        const condConnector = this.createConditionConnector(groupIndex, condIndex, group.logic);\n        groupEl.appendChild(condConnector);\n      }\n    });\n\n    // Add condition button\n    const addCondBtn = document.createElement('button');\n    addCondBtn.type = 'button';\n    addCondBtn.className = 'mt-2 inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800';\n    addCondBtn.dataset.addCondition = String(groupIndex);\n    addCondBtn.innerHTML = `\n      <svg class=\"h-3 w-3\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M12 5v14\"/><path d=\"M5 12h14\"/>\n      </svg>\n      ${group.logic.toUpperCase()}\n    `;\n    groupEl.appendChild(addCondBtn);\n\n    // Bind events\n    this.bindGroupEvents(groupEl, groupIndex);\n\n    return groupEl;\n  }\n\n  private createConditionElement(condition: FilterCondition, groupIndex: number, condIndex: number): HTMLElement {\n    const condEl = document.createElement('div');\n    condEl.className = 'flex items-center gap-2 mb-2';\n\n    const field = this.config.fields.find(f => f.name === condition.field) || this.config.fields[0];\n\n    condEl.innerHTML = `\n      <div class=\"flex items-center text-gray-400 cursor-move\" title=\"Drag to reorder\">\n        <svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <circle cx=\"9\" cy=\"5\" r=\"1\"/><circle cx=\"9\" cy=\"12\" r=\"1\"/><circle cx=\"9\" cy=\"19\" r=\"1\"/>\n          <circle cx=\"15\" cy=\"5\" r=\"1\"/><circle cx=\"15\" cy=\"12\" r=\"1\"/><circle cx=\"15\" cy=\"19\" r=\"1\"/>\n        </svg>\n      </div>\n\n      <select data-cond=\"${groupIndex}-${condIndex}-field\" class=\"py-1.5 px-2 text-sm border-gray-200 rounded-lg bg-white w-32\">\n        ${this.config.fields.map(f => `\n          <option value=\"${f.name}\" ${f.name === condition.field ? 'selected' : ''}>${f.label}</option>\n        `).join('')}\n      </select>\n\n      <select data-cond=\"${groupIndex}-${condIndex}-operator\" class=\"py-1.5 px-2 text-sm border-gray-200 rounded-lg bg-white w-36\">\n        ${this.getOperatorsForField(field).map(op => `\n          <option value=\"${op.value}\" ${op.value === condition.operator ? 'selected' : ''}>${op.label}</option>\n        `).join('')}\n      </select>\n\n      ${this.renderValueInput(field, condition, groupIndex, condIndex)}\n\n      <button type=\"button\" data-remove-cond=\"${groupIndex}-${condIndex}\" class=\"text-red-600 hover:text-red-800\">\n        <svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M3 6h18\"/><path d=\"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6\"/><path d=\"M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2\"/>\n        </svg>\n      </button>\n\n      <button type=\"button\" data-add-cond-or=\"${groupIndex}-${condIndex}\" class=\"px-2 py-1 text-xs border border-blue-600 text-blue-600 rounded hover:bg-blue-50\" title=\"Add OR condition\">\n        OR\n      </button>\n\n      <button type=\"button\" data-add-cond-and=\"${groupIndex}-${condIndex}\" class=\"px-2 py-1 text-xs border border-blue-600 text-blue-600 rounded hover:bg-blue-50\" title=\"Add AND condition\">\n        AND\n      </button>\n    `;\n\n    return condEl;\n  }\n\n  private renderValueInput(field: FieldDefinition, condition: FilterCondition, groupIndex: number, condIndex: number): string {\n    if (field.type === 'select' && field.options) {\n      return `\n        <select data-cond=\"${groupIndex}-${condIndex}-value\" class=\"flex-1 min-w-[200px] py-1.5 px-2 text-sm border-gray-200 rounded-lg bg-white\">\n          <option value=\"\">Select...</option>\n          ${field.options.map(opt => `\n            <option value=\"${opt.value}\" ${opt.value === condition.value ? 'selected' : ''}>${opt.label}</option>\n          `).join('')}\n        </select>\n      `;\n    }\n\n    const inputType = field.type === 'date' ? 'date' : field.type === 'number' ? 'number' : 'text';\n\n    return `\n      <input type=\"${inputType}\"\n             data-cond=\"${groupIndex}-${condIndex}-value\"\n             value=\"${condition.value || ''}\"\n             placeholder=\"Enter value...\"\n             class=\"flex-1 min-w-[200px] py-1.5 px-2 text-sm border-gray-200 rounded-lg\">\n    `;\n  }\n\n  private createConditionConnector(groupIndex: number, condIndex: number, logic: 'and' | 'or'): HTMLElement {\n    const connector = document.createElement('div');\n    connector.className = 'flex items-center justify-center my-1';\n    connector.innerHTML = `\n      <span class=\"text-xs font-medium text-gray-500 px-2 py-0.5 bg-white border border-gray-200 rounded\">\n        ${logic.toUpperCase()}\n      </span>\n    `;\n    return connector;\n  }\n\n  private createGroupConnector(groupIndex: number): HTMLElement {\n    const connector = document.createElement('div');\n    connector.className = 'flex items-center justify-center py-2';\n\n    const logic = this.structure.groupLogic[groupIndex] || 'and';\n\n    connector.innerHTML = `\n      <button type=\"button\"\n              data-group-logic=\"${groupIndex}\"\n              data-logic-value=\"and\"\n              class=\"px-3 py-1 text-xs font-medium rounded-l border ${logic === 'and' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        AND\n      </button>\n      <button type=\"button\"\n              data-group-logic=\"${groupIndex}\"\n              data-logic-value=\"or\"\n              class=\"px-3 py-1 text-xs font-medium rounded-r border ${logic === 'or' ? 'bg-green-600 text-white border-green-600' : 'bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300'}\">\n        OR\n      </button>\n    `;\n\n    // Bind logic toggle\n    connector.querySelectorAll('[data-group-logic]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const idx = parseInt(target.dataset.groupLogic || '0', 10);\n        const value = target.dataset.logicValue as 'and' | 'or';\n        this.structure.groupLogic[idx] = value;\n        this.render();\n      });\n    });\n\n    return connector;\n  }\n\n  private bindGroupEvents(groupEl: HTMLElement, groupIndex: number): void {\n    // Remove group\n    const removeGroupBtn = groupEl.querySelector(`[data-remove-group=\"${groupIndex}\"]`);\n    if (removeGroupBtn) {\n      removeGroupBtn.addEventListener('click', () => this.removeGroup(groupIndex));\n    }\n\n    // Add condition\n    const addCondBtn = groupEl.querySelector(`[data-add-condition=\"${groupIndex}\"]`);\n    if (addCondBtn) {\n      addCondBtn.addEventListener('click', () => this.addCondition(groupIndex));\n    }\n\n    // Condition field changes\n    groupEl.querySelectorAll('[data-cond]').forEach(el => {\n      const input = el as HTMLInputElement | HTMLSelectElement;\n      const [gIdx, cIdx, part] = input.dataset.cond!.split('-');\n      const gi = parseInt(gIdx, 10);\n      const ci = parseInt(cIdx, 10);\n\n      input.addEventListener('change', () => {\n        if (part === 'field') {\n          this.structure.groups[gi].conditions[ci].field = input.value;\n          this.render(); // Re-render to update operators\n        } else if (part === 'operator') {\n          this.structure.groups[gi].conditions[ci].operator = input.value;\n          this.updatePreview();\n        } else if (part === 'value') {\n          this.structure.groups[gi].conditions[ci].value = input.value;\n          this.updatePreview();\n        }\n      });\n    });\n\n    // Remove condition\n    groupEl.querySelectorAll('[data-remove-cond]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const closest = target.closest('[data-remove-cond]') as HTMLElement;\n        if (!closest) return;\n        const [gIdx, cIdx] = closest.dataset.removeCond!.split('-').map(Number);\n        this.removeCondition(gIdx, cIdx);\n      });\n    });\n\n    // Add OR/AND condition\n    groupEl.querySelectorAll('[data-add-cond-or], [data-add-cond-and]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n        const isOr = target.dataset.addCondOr !== undefined;\n        const dataAttr = isOr ? target.dataset.addCondOr : target.dataset.addCondAnd;\n        if (!dataAttr) return;\n        const [gIdx] = dataAttr.split('-').map(Number);\n\n        // Toggle group logic\n        this.structure.groups[gIdx].logic = isOr ? 'or' : 'and';\n        this.addCondition(gIdx);\n      });\n    });\n  }\n\n  private addCondition(groupIndex: number): void {\n    this.structure.groups[groupIndex].conditions.push(this.createEmptyCondition());\n    this.render();\n  }\n\n  private removeCondition(groupIndex: number, condIndex: number): void {\n    const group = this.structure.groups[groupIndex];\n    group.conditions.splice(condIndex, 1);\n\n    // If group is empty, remove it\n    if (group.conditions.length === 0) {\n      this.removeGroup(groupIndex);\n    } else {\n      this.render();\n    }\n  }\n\n  private removeGroup(groupIndex: number): void {\n    this.structure.groups.splice(groupIndex, 1);\n\n    // Adjust groupLogic array\n    if (groupIndex < this.structure.groupLogic.length) {\n      this.structure.groupLogic.splice(groupIndex, 1);\n    } else if (groupIndex > 0 && this.structure.groupLogic.length > 0) {\n      this.structure.groupLogic.splice(groupIndex - 1, 1);\n    }\n\n    // Ensure at least one group\n    if (this.structure.groups.length === 0) {\n      this.addGroup();\n    } else {\n      this.render();\n    }\n  }\n\n  private getOperatorsForField(field: FieldDefinition): { label: string; value: string }[] {\n    if (field.operators && field.operators.length > 0) {\n      return field.operators.map(op => ({ label: op, value: op }));\n    }\n    return DEFAULT_OPERATORS[field.type] || DEFAULT_OPERATORS.text;\n  }\n\n  private updatePreview(): void {\n    const sqlPreview = this.generateSQLPreview();\n    const textPreview = this.generateTextPreview();\n\n    if (this.sqlPreviewElement) {\n      this.sqlPreviewElement.textContent = sqlPreview || 'No filters applied';\n    }\n\n    if (this.previewElement) {\n      this.previewElement.textContent = textPreview;\n    }\n\n    // Show/hide applied filter preview\n    const previewContainer = document.getElementById('applied-filter-preview');\n    if (previewContainer) {\n      if (this.hasActiveFilters()) {\n        previewContainer.classList.remove('hidden');\n      } else {\n        previewContainer.classList.add('hidden');\n      }\n    }\n  }\n\n  private hasActiveFilters(): boolean {\n    return this.structure.groups.some(g =>\n      g.conditions.some(c => c.value !== '' && c.value !== null && c.value !== undefined)\n    );\n  }\n\n  private generateSQLPreview(): string {\n    const groupParts = this.structure.groups.map(group => {\n      const condParts = group.conditions\n        .filter(c => c.value !== '' && c.value !== null)\n        .map(c => {\n          const op = c.operator.toUpperCase();\n          const val = typeof c.value === 'string' ? `'${c.value}'` : c.value;\n          return `${c.field} ${op === 'ILIKE' ? 'ILIKE' : op === 'EQ' ? '=' : op} ${val}`;\n        });\n\n      if (condParts.length === 0) return '';\n      if (condParts.length === 1) return condParts[0];\n      return `( ${condParts.join(` ${group.logic.toUpperCase()} `)} )`;\n    }).filter(p => p !== '');\n\n    if (groupParts.length === 0) return '';\n    if (groupParts.length === 1) return groupParts[0];\n\n    return groupParts.reduce((acc, part, idx) => {\n      if (idx === 0) return part;\n      const logic = this.structure.groupLogic[idx - 1] || 'and';\n      return `${acc} ${logic.toUpperCase()} ${part}`;\n    }, '');\n  }\n\n  private generateTextPreview(): string {\n    const groupParts = this.structure.groups.map(group => {\n      const condParts = group.conditions\n        .filter(c => c.value !== '' && c.value !== null)\n        .map(c => {\n          const field = this.config.fields.find(f => f.name === c.field);\n          const fieldLabel = field?.label || c.field;\n          const opLabel = this.getOperatorsForField(field!).find(op => op.value === c.operator)?.label || c.operator;\n          return `${fieldLabel} ${opLabel} \"${c.value}\"`;\n        });\n\n      if (condParts.length === 0) return '';\n      if (condParts.length === 1) return condParts[0];\n      return `( ${condParts.join(` ${group.logic.toUpperCase()} `)} )`;\n    }).filter(p => p !== '');\n\n    if (groupParts.length === 0) return '';\n    if (groupParts.length === 1) return groupParts[0];\n\n    return groupParts.reduce((acc, part, idx) => {\n      if (idx === 0) return part;\n      const logic = this.structure.groupLogic[idx - 1] || 'and';\n      return `${acc} ${logic.toUpperCase()} ${part}`;\n    }, '');\n  }\n\n  private applyFilters(): void {\n    this.config.onApply(this.structure);\n    this.close();\n  }\n\n  private clearAll(): void {\n    this.structure = { groups: [], groupLogic: [] };\n    this.addGroup();\n    this.updatePreview();\n  }\n\n  private clearFilters(): void {\n    this.clearAll();\n    this.config.onClear();\n    this.updatePreview();\n  }\n\n  private saveFilter(): void {\n    const nameInput = document.getElementById('save-filter-name') as HTMLInputElement;\n    const name = nameInput?.value.trim();\n\n    if (!name) {\n      this.notifier.warning('Please enter a name for the filter');\n      return;\n    }\n\n    const saved = this.getSavedFilters();\n    saved[name] = this.structure;\n    localStorage.setItem('saved_filters', JSON.stringify(saved));\n\n    this.notifier.success(`Filter \"${name}\" saved!`);\n    if (nameInput) nameInput.value = '';\n  }\n\n  private getSavedFilters(): Record<string, FilterStructure> {\n    try {\n      const saved = localStorage.getItem('saved_filters');\n      return saved ? JSON.parse(saved) : {};\n    } catch {\n      return {};\n    }\n  }\n\n  private toggle(): void {\n    if (this.panel?.classList.contains('hidden')) {\n      this.open();\n    } else {\n      this.close();\n    }\n  }\n\n  private open(): void {\n    // Position panel below the filter button\n    const toggleBtn = document.getElementById('filter-toggle-btn');\n    if (toggleBtn && this.panel) {\n      const rect = toggleBtn.getBoundingClientRect();\n      this.panel.style.top = `${rect.bottom + 8}px`;\n      this.panel.style.left = `${rect.left}px`;\n    }\n\n    this.panel?.classList.remove('hidden');\n    this.overlay?.classList.remove('hidden');\n  }\n\n  private close(): void {\n    this.panel?.classList.add('hidden');\n    this.overlay?.classList.add('hidden');\n  }\n\n  private restoreFromURL(): void {\n    const params = new URLSearchParams(window.location.search);\n    const filtersParam = params.get('filters');\n\n    if (filtersParam) {\n      try {\n        const filters = JSON.parse(filtersParam);\n        // Convert old format to new group structure if needed\n        if (Array.isArray(filters) && filters.length > 0) {\n          this.structure = this.convertLegacyFilters(filters);\n          this.render();\n        }\n      } catch (e) {\n        console.warn('[FilterBuilder] Failed to parse filters from URL:', e);\n      }\n    }\n  }\n\n  private convertLegacyFilters(filters: any[]): FilterStructure {\n    // Group filters by field to detect OR conditions\n    const fieldGroups = new Map<string, any[]>();\n\n    filters.forEach(f => {\n      const key = f.column;\n      if (!fieldGroups.has(key)) {\n        fieldGroups.set(key, []);\n      }\n      fieldGroups.get(key)!.push(f);\n    });\n\n    const groups: FilterGroup[] = [];\n\n    fieldGroups.forEach((conditions) => {\n      groups.push({\n        conditions: conditions.map(c => ({\n          field: c.column,\n          operator: c.operator || 'ilike',\n          value: c.value\n        })),\n        logic: conditions.length > 1 ? 'or' : 'and'\n      });\n    });\n\n    return {\n      groups,\n      groupLogic: new Array(groups.length - 1).fill('and')\n    };\n  }\n\n  getStructure(): FilterStructure {\n    return this.structure;\n  }\n\n  setStructure(structure: FilterStructure): void {\n    this.structure = structure;\n    this.render();\n  }\n}\n","import type { SearchBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud search behavior\n * Builds OR queries across multiple fields using __ilike operator\n */\nexport class GoCrudSearchBehavior implements SearchBehavior {\n  constructor(private searchableFields: string[]) {\n    if (!searchableFields || searchableFields.length === 0) {\n      throw new Error('At least one searchable field is required');\n    }\n  }\n\n  buildQuery(term: string): Record<string, any> {\n    if (!term || term.trim() === '') {\n      return {};\n    }\n\n    const params: Record<string, any> = {};\n    const trimmedTerm = term.trim();\n\n    // Build OR query: ?name__ilike=%term%&email__ilike=%term%\n    // Note: go-crud will OR these together when multiple fields match the same operator pattern\n    this.searchableFields.forEach(field => {\n      params[`${field}__ilike`] = `%${trimmedTerm}%`;\n    });\n\n    return params;\n  }\n\n  async onSearch(term: string, grid: DataGrid): Promise<void> {\n    // Reset to first page when searching\n    grid.resetPagination();\n    await grid.refresh();\n  }\n}\n","import type { FilterBehavior, ColumnFilter } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud filter behavior\n * Builds query parameters using go-crud's filter syntax\n */\nexport class GoCrudFilterBehavior implements FilterBehavior {\n  buildFilters(filters: ColumnFilter[]): Record<string, any> {\n    const params: Record<string, any> = {};\n\n    // Group filters by column to detect OR conditions\n    const grouped = new Map<string, { operator: string; values: any[] }>();\n\n    filters.forEach(filter => {\n      if (filter.value === null || filter.value === undefined || filter.value === '') {\n        return;\n      }\n\n      const operator = filter.operator || 'eq';\n      const column = filter.column;\n\n      if (!grouped.has(column)) {\n        grouped.set(column, { operator, values: [] });\n      }\n      grouped.get(column)!.values.push(filter.value);\n    });\n\n    // Convert grouped filters to params\n    grouped.forEach((data, column) => {\n      if (data.values.length === 1) {\n        // Single value - use the original operator\n        const key = data.operator === 'eq' ? column : `${column}__${data.operator}`;\n        params[key] = data.values[0];\n      } else {\n        // Multiple values for same field - use __in for OR logic (exact match)\n        // For pattern matching like ILIKE, join with comma and handle in backend\n        if (data.operator === 'ilike') {\n          // Use custom OR syntax: field__ilike=val1,val2\n          params[`${column}__ilike`] = data.values.join(',');\n        } else if (data.operator === 'eq') {\n          // Use __in for exact matches with multiple values\n          params[`${column}__in`] = data.values.join(',');\n        } else {\n          // For other operators, join with comma\n          params[`${column}__${data.operator}`] = data.values.join(',');\n        }\n      }\n    });\n\n    return params;\n  }\n\n  async onFilterChange(column: string, value: any, grid: DataGrid): Promise<void> {\n    // Reset to first page when filtering changes\n    grid.resetPagination();\n    await grid.refresh();\n  }\n}\n","import type { PaginationBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud pagination behavior\n * Uses limit/offset query parameters\n */\nexport class GoCrudPaginationBehavior implements PaginationBehavior {\n  buildQuery(page: number, perPage: number): Record<string, any> {\n    return {\n      limit: perPage,\n      offset: (page - 1) * perPage\n    };\n  }\n\n  async onPageChange(page: number, grid: DataGrid): Promise<void> {\n    await grid.refresh();\n  }\n}\n","import type { SortBehavior, SortColumn } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud sort behavior\n * Uses order query parameter with comma-separated values\n */\nexport class GoCrudSortBehavior implements SortBehavior {\n  buildQuery(columns: SortColumn[]): Record<string, any> {\n    if (!columns || columns.length === 0) {\n      return {};\n    }\n\n    // Build order parameter: ?order=name asc,created_at desc\n    const order = columns\n      .map(col => `${col.field} ${col.direction}`)\n      .join(',');\n\n    return { order };\n  }\n\n  async onSort(column: string, direction: 'asc' | 'desc', grid: DataGrid): Promise<void> {\n    await grid.refresh();\n  }\n}\n","import type { ExportBehavior, ExportConcurrencyMode } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\ntype ExportFormat = 'csv' | 'json' | 'excel' | 'pdf';\ntype DeliveryMode = 'sync' | 'async' | 'auto';\n\ninterface ExportSelection {\n  mode: 'all' | 'ids' | 'query';\n  ids?: string[];\n  query?: {\n    name: string;\n    params?: Record<string, any>;\n  };\n}\n\ninterface ExportQueryFilter {\n  field: string;\n  op: string;\n  value: any;\n}\n\ninterface ExportQuerySort {\n  field: string;\n  desc: boolean;\n}\n\ninterface ExportQuery {\n  filters?: ExportQueryFilter[];\n  search?: string;\n  sort?: ExportQuerySort[];\n  limit?: number;\n  offset?: number;\n  cursor?: string;\n}\n\ninterface ExportPayload {\n  definition?: string;\n  resource?: string;\n  source_variant?: string;\n  format: string;\n  query?: ExportQuery;\n  selection?: ExportSelection;\n  columns?: string[];\n  delivery?: DeliveryMode;\n  estimated_rows?: number;\n  estimated_bytes?: number;\n}\n\ninterface ExportAsyncResponse {\n  id?: string;\n  status_url?: string;\n  download_url?: string;\n}\n\ninterface ExportStatusRecord {\n  id?: string;\n  state?: string;\n}\n\nexport interface GoCrudExportConfig {\n  endpoint: string;\n  definition?: string;\n  resource?: string;\n  variant?: string;\n  sourceVariant?: string;\n  delivery?: DeliveryMode;\n  /**\n   * Formats that should default to async delivery (when delivery is not explicitly set).\n   * Defaults to ['pdf'].\n   */\n  asyncFormats?: ExportFormat[];\n  /**\n   * Polling interval for async exports (ms).\n   */\n  statusPollIntervalMs?: number;\n  /**\n   * Maximum polling duration for async exports (ms). Set to 0 to disable timeout.\n   */\n  statusPollTimeoutMs?: number;\n  selection?: ExportSelection;\n  columns?: string[];\n  /**\n   * Concurrency mode for export operations\n   * - 'single': Block all export buttons while any export is in progress (default)\n   * - 'per-format': Block only the clicked format's button\n   * - 'none': Allow parallel exports (no blocking)\n   */\n  concurrency?: ExportConcurrencyMode;\n}\n\n/**\n * go-export export behavior\n * Uses go-export endpoints with the datagrid request contract\n */\nexport class GoCrudExportBehavior implements ExportBehavior {\n  private config: GoCrudExportConfig;\n\n  constructor(config: GoCrudExportConfig) {\n    if (!config || !config.endpoint) {\n      throw new Error('export endpoint is required');\n    }\n    if (!config.definition && !config.resource) {\n      throw new Error('export definition or resource is required');\n    }\n    this.config = config;\n  }\n\n  getEndpoint(): string {\n    return this.config.endpoint;\n  }\n\n  getConcurrency(): ExportConcurrencyMode {\n    return this.config.concurrency || 'single';\n  }\n\n  async export(format: ExportFormat, grid: DataGrid): Promise<void> {\n    if (!grid) {\n      throw new Error('datagrid instance is required');\n    }\n\n    const payload = buildDatagridExportRequest(grid, this.config, format);\n    payload.delivery = resolveDelivery(this.config, format);\n\n    let response: Response;\n    try {\n      response = await fetch(this.getEndpoint(), {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json,application/octet-stream'\n        },\n        body: JSON.stringify(payload)\n      });\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Network error during export';\n      notify(grid, 'error', message);\n      throw err; // Re-throw so core.ts finally block can clear loading state\n    }\n\n    if (response.status === 202) {\n      const result = (await response.json().catch(() => ({}))) as ExportAsyncResponse;\n      notify(grid, 'info', 'Export queued. You can download it when ready.');\n      const statusURL = result?.status_url || '';\n      if (statusURL) {\n        const downloadURL = resolveDownloadURL(result, statusURL);\n        try {\n          await pollExportStatus(statusURL, {\n            intervalMs: resolvePollIntervalMs(this.config),\n            timeoutMs: resolvePollTimeoutMs(this.config)\n          });\n          const downloadResponse = await fetch(downloadURL, {\n            headers: {\n              'Accept': 'application/octet-stream'\n            }\n          });\n          if (!downloadResponse.ok) {\n            const message = await readErrorMessage(downloadResponse);\n            notify(grid, 'error', message);\n            throw new Error(message);\n          }\n          await downloadExport(downloadResponse, payload.definition || payload.resource || 'export', payload.format);\n          notify(grid, 'success', 'Export ready.');\n          return;\n        } catch (err) {\n          const message = err instanceof Error ? err.message : 'Export failed';\n          notify(grid, 'error', message);\n          throw err;\n        }\n      }\n      if (result?.download_url) {\n        window.open(result.download_url, '_blank');\n        return;\n      }\n      return;\n    }\n\n    if (!response.ok) {\n      const message = await readErrorMessage(response);\n      notify(grid, 'error', message);\n      throw new Error(message); // Throw so core.ts finally block can clear loading state\n    }\n\n    await downloadExport(response, payload.definition || payload.resource || 'export', payload.format);\n    notify(grid, 'success', 'Export ready.');\n  }\n}\n\nfunction buildDatagridExportRequest(\n  grid: DataGrid,\n  config: GoCrudExportConfig,\n  format: ExportFormat\n): ExportPayload {\n  const normalizedFormat = normalizeFormat(format);\n  const selection = buildSelection(grid, config);\n  const columns = buildVisibleColumns(grid, config);\n  const queryParams = buildQueryParams(grid);\n  const query = buildQuery(queryParams);\n\n  const payload: ExportPayload = {\n    format: normalizedFormat,\n    query,\n    selection,\n    columns,\n    delivery: config.delivery || 'auto'\n  };\n\n  if (config.definition) {\n    payload.definition = config.definition;\n  }\n  if (config.resource) {\n    payload.resource = config.resource;\n  }\n  const sourceVariant = config.sourceVariant || config.variant;\n  if (sourceVariant) {\n    payload.source_variant = sourceVariant;\n  }\n\n  return payload;\n}\n\nfunction resolveDelivery(config: GoCrudExportConfig, format: ExportFormat): DeliveryMode {\n  if (config.delivery) {\n    return config.delivery;\n  }\n  const asyncFormats = config.asyncFormats && config.asyncFormats.length > 0\n    ? config.asyncFormats\n    : ['pdf'];\n  if (asyncFormats.includes(format)) {\n    return 'async';\n  }\n  return 'auto';\n}\n\nfunction resolvePollIntervalMs(config: GoCrudExportConfig): number {\n  const value = Number(config.statusPollIntervalMs);\n  if (Number.isFinite(value) && value > 0) {\n    return value;\n  }\n  return 2000;\n}\n\nfunction resolvePollTimeoutMs(config: GoCrudExportConfig): number {\n  const value = Number(config.statusPollTimeoutMs);\n  if (Number.isFinite(value) && value >= 0) {\n    return value;\n  }\n  return 300000;\n}\n\nfunction resolveDownloadURL(result: ExportAsyncResponse, statusURL: string): string {\n  if (result?.download_url) {\n    return result.download_url;\n  }\n  const base = statusURL.replace(/\\/+$/, '');\n  return `${base}/download`;\n}\n\nasync function pollExportStatus(\n  statusURL: string,\n  opts: { intervalMs: number; timeoutMs: number }\n): Promise<ExportStatusRecord> {\n  const started = Date.now();\n  const interval = Math.max(250, opts.intervalMs);\n\n  while (true) {\n    const response = await fetch(statusURL, {\n      headers: {\n        'Accept': 'application/json'\n      }\n    });\n    if (!response.ok) {\n      const message = await readErrorMessage(response);\n      throw new Error(message);\n    }\n    const record = (await response.json().catch(() => ({}))) as ExportStatusRecord;\n    const state = String(record?.state || '').toLowerCase();\n    if (state === 'completed') {\n      return record;\n    }\n    if (state === 'failed') {\n      throw new Error('Export failed');\n    }\n    if (state === 'canceled') {\n      throw new Error('Export canceled');\n    }\n    if (state === 'deleted') {\n      throw new Error('Export deleted');\n    }\n    if (opts.timeoutMs > 0 && Date.now() - started > opts.timeoutMs) {\n      throw new Error('Export status timed out');\n    }\n    await sleep(interval);\n  }\n}\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nfunction buildSelection(grid: DataGrid, config: GoCrudExportConfig): ExportSelection {\n  if (config.selection?.mode) {\n    return config.selection;\n  }\n  const selected = Array.from(grid.state.selectedRows || []);\n  const mode = selected.length > 0 ? 'ids' : 'all';\n  return {\n    mode,\n    ids: mode === 'ids' ? selected : []\n  };\n}\n\nfunction buildVisibleColumns(grid: DataGrid, config: GoCrudExportConfig): string[] {\n  if (Array.isArray(config.columns) && config.columns.length > 0) {\n    return config.columns.slice();\n  }\n  const hidden = grid.state?.hiddenColumns ? new Set(grid.state.hiddenColumns) : new Set<string>();\n  const order = Array.isArray(grid.state?.columnOrder) && grid.state.columnOrder.length > 0\n    ? grid.state.columnOrder\n    : grid.config.columns.map((col) => col.field);\n  return order.filter((field) => !hidden.has(field));\n}\n\nfunction buildQueryParams(grid: DataGrid): Record<string, any> {\n  const params: Record<string, any> = {};\n  const behaviors = grid.config.behaviors || {};\n\n  if (behaviors.pagination) {\n    Object.assign(params, behaviors.pagination.buildQuery(grid.state.currentPage, grid.state.perPage));\n  }\n  if (grid.state.search && behaviors.search) {\n    Object.assign(params, behaviors.search.buildQuery(grid.state.search));\n  }\n  if (grid.state.filters.length > 0 && behaviors.filter) {\n    Object.assign(params, behaviors.filter.buildFilters(grid.state.filters));\n  }\n  if (grid.state.sort.length > 0 && behaviors.sort) {\n    Object.assign(params, behaviors.sort.buildQuery(grid.state.sort));\n  }\n\n  return params;\n}\n\nfunction buildQuery(params: Record<string, any>): ExportQuery {\n  const query: ExportQuery = {};\n  const filters: ExportQueryFilter[] = [];\n\n  Object.entries(params).forEach(([key, value]) => {\n    if (value === null || value === undefined || value === '') {\n      return;\n    }\n    switch (key) {\n      case 'limit':\n        query.limit = toNumber(value);\n        return;\n      case 'offset':\n        query.offset = toNumber(value);\n        return;\n      case 'order':\n      case 'sort':\n        query.sort = parseSort(String(value));\n        return;\n      case 'q':\n      case 'search':\n        query.search = String(value);\n        return;\n      default:\n        break;\n    }\n\n    const { field, op } = splitFilterKey(key);\n    if (!field) {\n      return;\n    }\n    filters.push({ field, op, value });\n  });\n\n  if (filters.length > 0) {\n    query.filters = filters;\n  }\n\n  return query;\n}\n\nfunction splitFilterKey(key: string): { field: string; op: string } {\n  const parts = key.split('__');\n  const field = parts[0]?.trim() || '';\n  const op = parts[1]?.trim() || 'eq';\n  return { field, op };\n}\n\nfunction parseSort(raw: string): ExportQuerySort[] {\n  if (!raw) return [];\n  return raw\n    .split(',')\n    .map((chunk) => chunk.trim())\n    .filter(Boolean)\n    .map((chunk) => {\n      const parts = chunk.split(/\\s+/);\n      const field = parts[0] || '';\n      const direction = parts[1] || 'asc';\n      return { field, desc: direction.toLowerCase() === 'desc' };\n    })\n    .filter((item) => item.field);\n}\n\nfunction normalizeFormat(format: ExportFormat): string {\n  const value = String(format || '').trim().toLowerCase();\n  if (value === 'excel' || value === 'xls') {\n    return 'xlsx';\n  }\n  return value || 'csv';\n}\n\nfunction toNumber(value: any): number {\n  const parsed = Number(value);\n  return Number.isFinite(parsed) ? parsed : 0;\n}\n\nasync function downloadExport(response: Response, definition: string, format: string): Promise<void> {\n  const blob = await response.blob();\n  const filename = resolveFilename(response, definition, format);\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.rel = 'noopener';\n  document.body.appendChild(link);\n  link.click();\n  link.remove();\n  URL.revokeObjectURL(url);\n}\n\nfunction resolveFilename(response: Response, definition: string, format: string): string {\n  const header = response.headers.get('content-disposition') || '';\n  const fallback = `${definition}.${format}`;\n  const filename = parseFilename(header);\n  return filename || fallback;\n}\n\nfunction parseFilename(header: string): string | null {\n  if (!header) return null;\n  const utfMatch = header.match(/filename\\*=(?:UTF-8'')?([^;]+)/i);\n  if (utfMatch && utfMatch[1]) {\n    return decodeURIComponent(utfMatch[1].replace(/\"/g, '').trim());\n  }\n  const match = header.match(/filename=\"?([^\";]+)\"?/i);\n  if (match && match[1]) {\n    return match[1].trim();\n  }\n  return null;\n}\n\nasync function readErrorMessage(response: Response): Promise<string> {\n  const contentType = response.headers.get('content-type') || '';\n  if (contentType.includes('application/json')) {\n    const payload = await response.json().catch(() => ({}));\n    if (payload?.error?.message) {\n      return payload.error.message;\n    }\n    if (payload?.message) {\n      return payload.message;\n    }\n  }\n  const text = await response.text().catch(() => '');\n  if (text) {\n    return text;\n  }\n  return `Export failed (${response.status})`;\n}\n\nfunction notify(grid: DataGrid, type: 'info' | 'success' | 'error', message: string): void {\n  const notifier = grid.config.notifier as any;\n  if (notifier && typeof notifier[type] === 'function') {\n    notifier[type](message);\n    return;\n  }\n  const toast = (window as any).toastManager;\n  if (toast && typeof toast[type] === 'function') {\n    toast[type](message);\n    return;\n  }\n  if (type === 'error') {\n    alert(message);\n  }\n}\n","import type { BulkActionBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * go-crud bulk action behavior\n * Uses custom action endpoints for bulk operations\n */\nexport class GoCrudBulkActionBehavior implements BulkActionBehavior {\n  constructor(private baseEndpoint: string) {}\n\n  getActionEndpoint(action: string): string {\n    // Bulk action endpoint pattern: /admin/crud/users/bulk/{action}\n    const plural = this.getPluralEndpoint();\n    return `${plural}/bulk/${action}`;\n  }\n\n  private getPluralEndpoint(): string {\n    // If baseEndpoint ends with singular form, convert to plural\n    if (this.baseEndpoint.endsWith('s')) {\n      return this.baseEndpoint;\n    }\n    return `${this.baseEndpoint}s`;\n  }\n\n  async execute(action: string, ids: string[], grid: DataGrid): Promise<void> {\n    const endpoint = this.getActionEndpoint(action);\n\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ ids })\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Bulk action '${action}' failed: ${errorText}`);\n    }\n\n    // Refresh grid after successful bulk action\n    await grid.refresh();\n  }\n}\n","import type { ColumnVisibilityBehavior } from '../behaviors/types.js';\nimport type { DataGrid } from '../core.js';\n\n/**\n * Legacy V1 storage format (visibility only)\n */\ntype ColumnPrefsV1 = Record<string, boolean>;\n\n/**\n * V2 storage format (visibility + order)\n */\ninterface ColumnPrefsV2 {\n  version: 2;\n  visibility: Record<string, boolean>;\n  order?: string[];\n}\n\nfunction normalizeBasePath(basePath?: string): string {\n  const trimmed = (basePath || '').trim();\n  if (!trimmed || trimmed === '/') return '';\n  return '/' + trimmed.replace(/^\\/+|\\/+$/g, '');\n}\n\nfunction normalizeApiBasePath(apiBasePath?: string): string {\n  const trimmed = (apiBasePath || '').trim();\n  if (!trimmed || trimmed === '/') return '';\n  return trimmed.replace(/\\/+$/, '');\n}\n\n/**\n * Type guard to check if prefs are V2 format\n */\nfunction isV2Prefs(data: unknown): data is ColumnPrefsV2 {\n  return (\n    typeof data === 'object' &&\n    data !== null &&\n    'version' in data &&\n    (data as ColumnPrefsV2).version === 2\n  );\n}\n\n/**\n * Default column visibility behavior\n * Stores state in localStorage as a cache, but DataGrid.state.hiddenColumns is the single source of truth\n *\n * Storage schema (V2):\n * {\n *   version: 2,\n *   visibility: { email: true, username: true, ... },\n *   order: [\"email\", \"username\", \"status\", ...]\n * }\n *\n * Migrates automatically from V1 format (Record<string, boolean>)\n */\nexport class DefaultColumnVisibilityBehavior implements ColumnVisibilityBehavior {\n  protected storageKey: string;\n  private cachedOrder: string[] | null = null;\n\n  constructor(\n    initialColumns: string[],\n    storageKey: string = 'datatable_columns'\n  ) {\n    this.storageKey = storageKey;\n  }\n\n  /**\n   * Get visible columns from grid state (single source of truth)\n   */\n  getVisibleColumns(grid: DataGrid): string[] {\n    return grid.config.columns\n      .filter(col => !grid.state.hiddenColumns.has(col.field))\n      .map(col => col.field);\n  }\n\n  /**\n   * Toggle column visibility based on current grid state\n   * Preserves column order when writing visibility updates\n   */\n  toggleColumn(field: string, grid: DataGrid): void {\n    // Read current state from grid (single source of truth)\n    const currentlyVisible = !grid.state.hiddenColumns.has(field);\n\n    // Compute new visible columns\n    const newVisibleColumns = grid.config.columns\n      .filter(col => {\n        if (col.field === field) {\n          return !currentlyVisible; // Toggle the clicked field\n        }\n        return !grid.state.hiddenColumns.has(col.field); // Keep others as-is\n      })\n      .map(col => col.field);\n\n    // Build visibility map\n    const visibility: Record<string, boolean> = {};\n    grid.config.columns.forEach(col => {\n      visibility[col.field] = newVisibleColumns.includes(col.field);\n    });\n\n    // Save to localStorage preserving existing order\n    // Use cached order if available, otherwise use current grid column order\n    const currentOrder = this.cachedOrder || grid.state.columnOrder;\n    this.savePrefs({\n      version: 2,\n      visibility,\n      order: currentOrder.length > 0 ? currentOrder : undefined\n    });\n\n    // Update grid (which will sync checkboxes automatically)\n    grid.updateColumnVisibility(newVisibleColumns);\n  }\n\n  /**\n   * Reorder columns and persist to storage\n   * Stores both visibility and order in V2 format\n   */\n  reorderColumns(order: string[], grid: DataGrid): void {\n    // Build visibility map from current grid state\n    const visibility: Record<string, boolean> = {};\n    grid.config.columns.forEach(col => {\n      visibility[col.field] = !grid.state.hiddenColumns.has(col.field);\n    });\n\n    // Update cached order\n    this.cachedOrder = order;\n\n    // Save V2 prefs with both visibility and order\n    this.savePrefs({\n      version: 2,\n      visibility,\n      order\n    });\n\n    console.log('[ColumnVisibility] Order saved:', order);\n  }\n\n  /**\n   * Load column order from cache (localStorage)\n   * Validates order against current columns (drops missing, doesn't append new)\n   * New columns are appended by DataGrid.mergeColumnOrder()\n   */\n  loadColumnOrderFromCache(allColumns: string[]): string[] {\n    try {\n      const prefs = this.loadPrefs();\n      if (!prefs || !prefs.order) {\n        return [];\n      }\n\n      // Validate: keep only columns that exist in allColumns\n      const validColumns = new Set(allColumns);\n      const validOrder = prefs.order.filter(field => validColumns.has(field));\n\n      // Cache the loaded order for future saves\n      this.cachedOrder = validOrder;\n\n      console.log('[ColumnVisibility] Order loaded from cache:', validOrder);\n      return validOrder;\n    } catch (e) {\n      console.warn('Failed to load column order from cache:', e);\n      return [];\n    }\n  }\n\n  /**\n   * Load saved visibility state from localStorage\n   * Returns hiddenColumns Set to be merged with URL state\n   * Handles both V1 and V2 formats (migrates V1 automatically)\n   * Filters out stale columns that no longer exist in allColumns\n   */\n  loadHiddenColumnsFromCache(allColumns: string[]): Set<string> {\n    try {\n      const prefs = this.loadPrefs();\n      if (!prefs) return new Set();\n\n      // Build set of valid columns to filter stale entries\n      const validColumns = new Set(allColumns);\n\n      // Return hidden columns (visible=false), filtered against valid columns\n      const hidden = new Set<string>();\n      Object.entries(prefs.visibility).forEach(([field, visible]) => {\n        // Only include if column still exists and is hidden\n        if (!visible && validColumns.has(field)) {\n          hidden.add(field);\n        }\n      });\n\n      return hidden;\n    } catch (e) {\n      console.warn('Failed to load column visibility state:', e);\n      return new Set();\n    }\n  }\n\n  /**\n   * Load preferences from localStorage with V1->V2 migration\n   */\n  protected loadPrefs(): ColumnPrefsV2 | null {\n    try {\n      const saved = localStorage.getItem(this.storageKey);\n      if (!saved) return null;\n\n      const data = JSON.parse(saved);\n\n      // Check if V2 format\n      if (isV2Prefs(data)) {\n        return data;\n      }\n\n      // Migrate V1 format (Record<string, boolean>) to V2\n      const v1Data = data as ColumnPrefsV1;\n      const migratedPrefs: ColumnPrefsV2 = {\n        version: 2,\n        visibility: v1Data\n        // order is undefined - will be populated on first reorder\n      };\n\n      // Save migrated prefs back to storage\n      console.log('[ColumnVisibility] Migrating V1 prefs to V2 format');\n      this.savePrefs(migratedPrefs);\n\n      return migratedPrefs;\n    } catch (e) {\n      console.warn('Failed to load column preferences:', e);\n      return null;\n    }\n  }\n\n  /**\n   * Save V2 preferences to localStorage\n   */\n  protected savePrefs(prefs: ColumnPrefsV2): void {\n    try {\n      localStorage.setItem(this.storageKey, JSON.stringify(prefs));\n    } catch (e) {\n      console.warn('Failed to save column preferences:', e);\n    }\n  }\n\n  /**\n   * Clear saved preferences from localStorage\n   * Called when user clicks \"Reset to Default\"\n   */\n  clearSavedPrefs(): void {\n    try {\n      localStorage.removeItem(this.storageKey);\n      this.cachedOrder = null;\n      console.log('[ColumnVisibility] Preferences cleared');\n    } catch (e) {\n      console.warn('Failed to clear column preferences:', e);\n    }\n  }\n}\n\n/**\n * Server-synced column visibility behavior configuration\n */\nexport interface ServerColumnVisibilityConfig {\n  /** Resource name for the preference key (e.g., 'users' -> 'ui.datagrid.users.columns') */\n  resource: string;\n  /** Base path for the preferences API (used when preferencesEndpoint is omitted) */\n  basePath?: string;\n  /** Full API base path (preferred when using versioned admin APIs) */\n  apiBasePath?: string;\n  /** Base path for preferences API (default: '/api/preferences' unless basePath is provided) */\n  preferencesEndpoint?: string;\n  /** localStorage key for local cache (default: '<resource>_datatable_columns') */\n  localStorageKey?: string;\n  /** Debounce delay in ms for server sync (default: 1000) */\n  syncDebounce?: number;\n}\n\n/**\n * Server-synced column visibility behavior\n *\n * Extends DefaultColumnVisibilityBehavior with server persistence:\n * - On reorder/toggle, saves to localStorage immediately (fast) and syncs to server (durable)\n * - On init, can hydrate from server preferences before DataGrid starts\n *\n * Server preference key format: `ui.datagrid.<resource>.columns`\n * Server payload format: { raw: { \"ui.datagrid.<resource>.columns\": <V2 prefs> } }\n */\nexport class ServerColumnVisibilityBehavior extends DefaultColumnVisibilityBehavior {\n  private resource: string;\n  private preferencesEndpoint: string;\n  private syncDebounce: number;\n  private syncTimeout: ReturnType<typeof setTimeout> | null = null;\n  private serverPrefs: ColumnPrefsV2 | null = null;\n\n  constructor(initialColumns: string[], config: ServerColumnVisibilityConfig) {\n    const localStorageKey = config.localStorageKey || `${config.resource}_datatable_columns`;\n    super(initialColumns, localStorageKey);\n\n    this.resource = config.resource;\n    const basePath = normalizeBasePath(config.basePath);\n    const apiBasePath = normalizeApiBasePath(config.apiBasePath);\n    if (config.preferencesEndpoint) {\n      this.preferencesEndpoint = config.preferencesEndpoint;\n    } else if (apiBasePath) {\n      this.preferencesEndpoint = `${apiBasePath}/preferences`;\n    } else if (basePath) {\n      this.preferencesEndpoint = `${basePath}/api/preferences`;\n    } else {\n      this.preferencesEndpoint = '/api/preferences';\n    }\n    this.syncDebounce = config.syncDebounce ?? 1000;\n  }\n\n  /**\n   * Get the server preference key for this resource\n   */\n  private get serverPrefsKey(): string {\n    return `ui.datagrid.${this.resource}.columns`;\n  }\n\n  /**\n   * Toggle column visibility and sync to server\n   */\n  override toggleColumn(field: string, grid: DataGrid): void {\n    // Call parent to update localStorage immediately\n    super.toggleColumn(field, grid);\n\n    // Schedule server sync\n    this.scheduleServerSync(grid);\n  }\n\n  /**\n   * Reorder columns and sync to server\n   */\n  override reorderColumns(order: string[], grid: DataGrid): void {\n    // Call parent to update localStorage immediately\n    super.reorderColumns(order, grid);\n\n    // Schedule server sync\n    this.scheduleServerSync(grid);\n  }\n\n  /**\n   * Load preferences from server\n   * Call this before DataGrid.init() to hydrate state from server\n   * Returns the V2 prefs if found, null otherwise\n   */\n  async loadFromServer(): Promise<ColumnPrefsV2 | null> {\n    try {\n      const response = await fetch(this.preferencesEndpoint, {\n        method: 'GET',\n        credentials: 'same-origin',\n        headers: {\n          'Accept': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        console.warn('[ServerColumnVisibility] Failed to load server prefs:', response.status);\n        return null;\n      }\n\n      const data = await response.json();\n\n      // Server response format: { records: [{ raw: { \"ui.datagrid.users.columns\": {...} } }] }\n      const records = data.records || [];\n      if (records.length === 0) {\n        console.log('[ServerColumnVisibility] No server preferences found');\n        return null;\n      }\n\n      const rawPrefs = records[0]?.raw;\n      if (!rawPrefs || !rawPrefs[this.serverPrefsKey]) {\n        console.log('[ServerColumnVisibility] No column preferences in server response');\n        return null;\n      }\n\n      const serverPrefs = rawPrefs[this.serverPrefsKey];\n\n      // Validate it's V2 format\n      if (!isV2Prefs(serverPrefs)) {\n        console.warn('[ServerColumnVisibility] Server prefs not in V2 format:', serverPrefs);\n        return null;\n      }\n\n      // Cache server prefs\n      this.serverPrefs = serverPrefs;\n\n      // Store as local cache so DataGrid can restore synchronously on init.\n      this.savePrefs(serverPrefs);\n\n      console.log('[ServerColumnVisibility] Loaded prefs from server:', serverPrefs);\n      return serverPrefs;\n    } catch (e) {\n      console.warn('[ServerColumnVisibility] Error loading server prefs:', e);\n      return null;\n    }\n  }\n\n  /**\n   * Get initial column prefs (server takes precedence over localStorage)\n   * Call this after loadFromServer() to get the prefs to use\n   */\n  getInitialPrefs(allColumns: string[]): { hiddenColumns: Set<string>; columnOrder: string[] } {\n    // Use server prefs if available, otherwise fall back to localStorage\n    const prefs = this.serverPrefs;\n\n    if (prefs) {\n      // Build hidden columns set from server prefs\n      const hidden = new Set<string>();\n      Object.entries(prefs.visibility).forEach(([field, visible]) => {\n        if (!visible) {\n          hidden.add(field);\n        }\n      });\n\n      // Validate order against current columns\n      const validColumns = new Set(allColumns);\n      const validOrder = (prefs.order || []).filter(field => validColumns.has(field));\n\n      return {\n        hiddenColumns: hidden,\n        columnOrder: validOrder\n      };\n    }\n\n    // Fall back to localStorage via parent methods\n    return {\n      hiddenColumns: this.loadHiddenColumnsFromCache(allColumns),\n      columnOrder: this.loadColumnOrderFromCache(allColumns)\n    };\n  }\n\n  /**\n   * Schedule a debounced sync to server\n   */\n  private scheduleServerSync(grid: DataGrid): void {\n    // Clear existing timeout\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n    }\n\n    // Schedule new sync\n    this.syncTimeout = setTimeout(() => {\n      this.syncToServer(grid);\n    }, this.syncDebounce);\n  }\n\n  /**\n   * Sync current preferences to server\n   */\n  private async syncToServer(grid: DataGrid): Promise<void> {\n    // Build V2 prefs from current grid state\n    const visibility: Record<string, boolean> = {};\n    grid.config.columns.forEach(col => {\n      visibility[col.field] = !grid.state.hiddenColumns.has(col.field);\n    });\n\n    const prefs: ColumnPrefsV2 = {\n      version: 2,\n      visibility,\n      order: grid.state.columnOrder.length > 0 ? grid.state.columnOrder : undefined\n    };\n\n    try {\n      const response = await fetch(this.preferencesEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify({\n          raw: {\n            [this.serverPrefsKey]: prefs\n          }\n        })\n      });\n\n      if (!response.ok) {\n        console.warn('[ServerColumnVisibility] Failed to sync to server:', response.status);\n        return;\n      }\n\n      // Update cached server prefs\n      this.serverPrefs = prefs;\n\n      console.log('[ServerColumnVisibility] Synced prefs to server:', prefs);\n    } catch (e) {\n      console.warn('[ServerColumnVisibility] Error syncing to server:', e);\n    }\n  }\n\n  /**\n   * Clear saved preferences from both localStorage and server\n   * Called when user clicks \"Reset to Default\"\n   */\n  override clearSavedPrefs(): void {\n    // Clear localStorage\n    super.clearSavedPrefs();\n\n    // Clear server prefs\n    this.serverPrefs = null;\n\n    // Clear server prefs by sending empty/null value\n    this.clearServerPrefs();\n  }\n\n  /**\n   * Clear preferences on server\n   */\n  private async clearServerPrefs(): Promise<void> {\n    try {\n      const response = await fetch(this.preferencesEndpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify({\n          raw: {\n            [this.serverPrefsKey]: null\n          }\n        })\n      });\n\n      if (!response.ok) {\n        console.warn('[ServerColumnVisibility] Failed to clear server prefs:', response.status);\n        return;\n      }\n\n      console.log('[ServerColumnVisibility] Server prefs cleared');\n    } catch (e) {\n      console.warn('[ServerColumnVisibility] Error clearing server prefs:', e);\n    }\n  }\n}\n","/**\n * Schema-Driven Actions for DataGrid\n *\n * Builds row actions from server-provided schema.actions,\n * with fallback to default view/edit/delete when absent.\n *\n * Design decisions (per CONTENT_TRANSLATION_TDD.md):\n * - Schema actions are authoritative when present\n * - Default actions (view/edit/delete) are fallback only\n * - Duplicate prevention by action name\n * - Deterministic precedence: schema > defaults\n */\n\nimport type { ActionButton, ActionVariant } from './actions.js';\nimport {\n  executeActionRequest,\n  formatStructuredErrorForDisplay,\n  extractTranslationBlocker,\n  isTranslationBlocker,\n  type StructuredError,\n} from '../toast/error-helpers.js';\n\n// ============================================================================\n// Schema Action Types\n// ============================================================================\n\n/**\n * Schema action definition from server (schema.actions[*])\n */\nexport interface SchemaAction {\n  /** Unique action identifier */\n  name: string;\n  /** Display label */\n  label?: string;\n  /** i18n label key */\n  label_key?: string;\n  /** Command name for command-backed actions */\n  command_name?: string;\n  /** Confirmation message (if action requires confirmation) */\n  confirm?: string;\n  /** Action visual variant */\n  variant?: 'primary' | 'secondary' | 'danger' | 'success' | 'warning';\n  /** Icon identifier */\n  icon?: string;\n  /** Required payload fields (legacy boolean is also tolerated) */\n  payload_required?: string[] | boolean;\n  /** JSON Schema for payload */\n  payload_schema?: PayloadSchema | Record<string, unknown>;\n  /** Action type hint (navigation vs POST) */\n  type?: 'navigation' | 'action';\n  /** Target URL pattern for navigation actions */\n  href?: string;\n  /** Scope where this action is valid */\n  scope?: 'all' | 'row' | 'detail' | 'bulk';\n  /** Record fields required to render/execute this action in a given context */\n  context_required?: string[];\n  /** Permission required for this action */\n  permission?: string;\n  /** Server-authoritative display order (lower numbers appear first) */\n  order?: number;\n}\n\nexport interface ActionState {\n  enabled?: boolean;\n  reason?: string;\n  reason_code?: string;\n  available_transitions?: string[];\n}\n\n/**\n * Payload schema for actions requiring input\n */\nexport interface PayloadSchema {\n  type?: string;\n  required?: string[];\n  properties?: Record<string, PayloadSchemaProperty>;\n}\n\nexport interface PayloadSchemaProperty {\n  type?: string;\n  title?: string;\n  description?: string;\n  default?: unknown;\n  enum?: unknown[];\n  oneOf?: PayloadSchemaOption[];\n}\n\nexport interface PayloadSchemaOption {\n  const?: unknown;\n  title?: string;\n}\n\n// ============================================================================\n// Schema Action Builder Configuration\n// ============================================================================\n\n/**\n * Configuration for building schema-driven actions\n */\nexport interface SchemaActionBuilderConfig {\n  /** Base path for action API endpoint (e.g., /admin/api/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation actions (e.g., /admin/content/pages) */\n  actionBasePath: string;\n  /** Current locale context (passed to action payloads) */\n  locale?: string;\n  /** Current environment context (passed to action payloads) */\n  environment?: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Callback for handling translation blockers */\n  onTranslationBlocker?: (info: TranslationBlockerContext) => void;\n  /** Callback after successful action execution */\n  onActionSuccess?: (actionName: string, result: ActionResult) => void;\n  /** Callback after action error */\n  onActionError?: (actionName: string, error: StructuredError) => void;\n  /** Whether to use default actions as fallback (default: true) */\n  useDefaultFallback?: boolean;\n  /** Explicit compatibility mode: append defaults even with schema actions */\n  appendDefaultActions?: boolean;\n  /** Action rendering context (DataGrid row actions use 'row') */\n  actionContext?: 'row' | 'detail' | 'bulk';\n  /** Optional client-side action order override (action name -> order) */\n  actionOrderOverride?: Record<string, number>;\n}\n\n/**\n * Result from action execution\n */\nexport interface ActionResult {\n  success: boolean;\n  data?: Record<string, unknown>;\n  error?: StructuredError;\n}\n\n/**\n * Context for translation blocker handling\n */\nexport interface TranslationBlockerContext {\n  actionName: string;\n  recordId: string;\n  missingLocales: string[];\n  missingFieldsByLocale: Record<string, string[]> | null;\n  transition: string | null;\n  entityType: string | null;\n  requestedLocale: string | null;\n  environment: string | null;\n  retry?: () => Promise<ActionResult>;\n}\n\n// ============================================================================\n// Schema Action Builder\n// ============================================================================\n\n// ============================================================================\n// Action Ordering Constants\n// ============================================================================\n\n/**\n * Stable fallback order map for common actions.\n * Used when server doesn't provide explicit order.\n * Lower numbers appear first.\n */\nconst STABLE_ACTION_ORDER: Record<string, number> = {\n  view: 100,\n  edit: 200,\n  duplicate: 300,\n  create_translation: 400,\n  publish: 500,\n  unpublish: 600,\n  submit: 700,\n  approve: 800,\n  reject: 900,\n  archive: 1000,\n  restore: 1100,\n  delete: 9000, // Destructive actions last\n};\n\n/** Default order for unknown actions (before destructive actions) */\nconst DEFAULT_ACTION_ORDER = 5000;\n\n/** Maximum order value for insertion-order tie-breaking */\nconst MAX_ORDER = 10000;\n\n/**\n * Internal wrapper for action with ordering metadata\n */\ninterface OrderedAction {\n  action: ActionButton;\n  name: string;\n  order: number;\n  insertionIndex: number;\n}\n\n/**\n * Builds row actions from schema.actions with proper precedence and deduplication.\n *\n * Rules:\n * 1. Navigation actions (view, edit): build navigation URLs\n * 2. Delete action: existing delete flow\n * 3. All other schema actions: POST to /admin/api/{panel}/actions/{action.name}\n * 4. Duplicate prevention by action name\n * 5. Schema actions take precedence over defaults\n * 6. Action ordering precedence: schema.order > actionOrderOverride > stable fallback > insertion\n */\nexport class SchemaActionBuilder {\n  private config: SchemaActionBuilderConfig;\n  private seenActions: Set<string> = new Set();\n\n  constructor(config: SchemaActionBuilderConfig) {\n    this.config = {\n      useDefaultFallback: true,\n      appendDefaultActions: false,\n      actionContext: 'row',\n      ...config,\n    };\n  }\n\n  /**\n   * Build row actions for a record from schema.actions\n   *\n   * @param record - The data record\n   * @param schemaActions - Actions from schema.actions (may be undefined)\n   * @returns Array of ActionButton for rendering\n   */\n  buildRowActions(record: Record<string, unknown>, schemaActions?: SchemaAction[]): ActionButton[] {\n    this.seenActions.clear();\n    const orderedActions: OrderedAction[] = [];\n    let insertionIndex = 0;\n\n    // Build URL query context\n    const queryContext = this.buildQueryContext();\n\n    // If schema actions exist, use them as authoritative source\n    if (Array.isArray(schemaActions) && schemaActions.length > 0) {\n      for (const schemaAction of schemaActions) {\n        if (!schemaAction.name) continue;\n        if (!this.shouldIncludeAction(record, schemaAction)) continue;\n\n        // Skip duplicates\n        const actionKey = schemaAction.name.toLowerCase();\n        if (this.seenActions.has(actionKey)) continue;\n        this.seenActions.add(actionKey);\n\n        const actionState = this.resolveRecordActionState(record, schemaAction.name);\n        const actionButton = this.buildActionFromSchema(record, schemaAction, queryContext, actionState);\n        if (actionButton) {\n          orderedActions.push({\n            action: actionButton,\n            name: schemaAction.name,\n            order: this.resolveActionOrder(schemaAction.name, schemaAction.order),\n            insertionIndex: insertionIndex++,\n          });\n        }\n      }\n\n      // Only append defaults if explicitly requested (compatibility mode)\n      if (this.config.appendDefaultActions) {\n        this.appendDefaultActionsOrdered(orderedActions, record, queryContext, insertionIndex);\n      }\n    } else if (this.config.useDefaultFallback) {\n      // No schema actions - use defaults as fallback\n      this.appendDefaultActionsOrdered(orderedActions, record, queryContext, insertionIndex);\n    }\n\n    // Sort actions by order (ascending), then by insertion index for tie-breaking\n    orderedActions.sort((a, b) => {\n      if (a.order !== b.order) {\n        return a.order - b.order;\n      }\n      return a.insertionIndex - b.insertionIndex;\n    });\n\n    return orderedActions.map((oa) => oa.action);\n  }\n\n  /**\n   * Resolve action order using precedence:\n   * 1. schema.actions[*].order (server authoritative)\n   * 2. actionOrderOverride (optional client override)\n   * 3. stable fallback map\n   * 4. default order\n   */\n  private resolveActionOrder(actionName: string, schemaOrder?: number): number {\n    // 1. Server-provided order takes highest precedence\n    if (typeof schemaOrder === 'number' && Number.isFinite(schemaOrder)) {\n      return schemaOrder;\n    }\n\n    const normalizedName = actionName.toLowerCase();\n\n    // 2. Client-side override\n    if (this.config.actionOrderOverride?.[normalizedName] !== undefined) {\n      return this.config.actionOrderOverride[normalizedName];\n    }\n\n    // 3. Stable fallback map\n    if (STABLE_ACTION_ORDER[normalizedName] !== undefined) {\n      return STABLE_ACTION_ORDER[normalizedName];\n    }\n\n    // 4. Default order for unknown actions\n    return DEFAULT_ACTION_ORDER;\n  }\n\n  /**\n   * Build a single action from schema definition\n   */\n  private buildActionFromSchema(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction,\n    queryContext: string,\n    actionState: ActionState | null\n  ): ActionButton | null {\n    const actionName = schemaAction.name;\n    const label = schemaAction.label || schemaAction.label_key || actionName;\n    const variant = (schemaAction.variant || 'secondary') as ActionVariant;\n    const icon = schemaAction.icon;\n\n    // Determine action type based on name or explicit type hint\n    const isNavigationAction = this.isNavigationAction(schemaAction);\n    const isDeleteAction = actionName === 'delete';\n\n    if (isNavigationAction) {\n      return this.applyActionState(\n        this.buildNavigationAction(record, schemaAction, label, variant, icon, queryContext),\n        actionState\n      );\n    }\n\n    if (isDeleteAction) {\n      return this.applyActionState(this.buildDeleteAction(record, label, variant, icon), actionState);\n    }\n\n    // All other actions: POST to panel action endpoint\n    return this.applyActionState(this.buildPostAction(record, schemaAction, label, variant, icon), actionState);\n  }\n\n  /**\n   * Check if action is a navigation action\n   */\n  private isNavigationAction(schemaAction: SchemaAction): boolean {\n    if (schemaAction.type === 'navigation') return true;\n    if (schemaAction.href) return true;\n\n    // Known navigation actions by name\n    const navActions = ['view', 'edit', 'show', 'details'];\n    return navActions.includes(schemaAction.name.toLowerCase());\n  }\n\n  private shouldIncludeAction(record: Record<string, unknown>, schemaAction: SchemaAction): boolean {\n    if (!this.matchesActionScope(schemaAction.scope)) {\n      return false;\n    }\n\n    const requiredContext = Array.isArray(schemaAction.context_required)\n      ? schemaAction.context_required\n      : [];\n    if (requiredContext.length === 0) {\n      return true;\n    }\n\n    for (const rawField of requiredContext) {\n      const field = typeof rawField === 'string' ? rawField.trim() : '';\n      if (!field) continue;\n      const value = this.resolveRecordContextValue(record, field);\n      if (this.isEmptyPayloadValue(value)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  private resolveRecordActionState(record: Record<string, unknown>, actionName: string): ActionState | null {\n    const rawState = record['_action_state'];\n    if (!rawState || typeof rawState !== 'object' || Array.isArray(rawState)) {\n      return null;\n    }\n    const perAction = (rawState as Record<string, unknown>)[actionName];\n    if (!perAction || typeof perAction !== 'object' || Array.isArray(perAction)) {\n      return null;\n    }\n    return perAction as ActionState;\n  }\n\n  private applyActionState(action: ActionButton, state: ActionState | null): ActionButton {\n    if (!state) {\n      return action;\n    }\n    if (state.enabled !== false) {\n      return action;\n    }\n    const disabledReason = this.disabledReason(state);\n    return {\n      ...action,\n      disabled: true,\n      disabledReason,\n    };\n  }\n\n  private disabledReason(state: ActionState): string {\n    const reason = typeof state.reason === 'string' ? state.reason.trim() : '';\n    if (reason) {\n      return reason;\n    }\n    const code = typeof state.reason_code === 'string' ? state.reason_code.trim().toLowerCase() : '';\n    switch (code) {\n      case 'workflow_transition_not_available':\n        return 'Action is not available in the current workflow state.';\n      case 'permission_denied':\n        return 'You do not have permission to execute this action.';\n      case 'missing_context_required':\n        return 'Action is unavailable because required record context is missing.';\n      default:\n        return 'Action is currently unavailable.';\n    }\n  }\n\n  private matchesActionScope(scope: SchemaAction['scope']): boolean {\n    const normalizedScope = typeof scope === 'string' ? scope.trim().toLowerCase() : '';\n    if (!normalizedScope || normalizedScope === 'all') {\n      return true;\n    }\n    const context = (this.config.actionContext || 'row').toLowerCase();\n    return normalizedScope === context;\n  }\n\n  private resolveRecordContextValue(record: Record<string, unknown>, path: string): unknown {\n    const normalizedPath = path.trim();\n    if (!normalizedPath) return undefined;\n    if (!normalizedPath.includes('.')) {\n      return record[normalizedPath];\n    }\n\n    const segments = normalizedPath.split('.').map((segment) => segment.trim()).filter(Boolean);\n    if (segments.length === 0) return undefined;\n\n    let cursor: unknown = record;\n    for (const segment of segments) {\n      if (!cursor || typeof cursor !== 'object' || Array.isArray(cursor)) {\n        return undefined;\n      }\n      cursor = (cursor as Record<string, unknown>)[segment];\n    }\n    return cursor;\n  }\n\n  /**\n   * Build navigation action (view, edit, etc.)\n   */\n  private buildNavigationAction(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction,\n    label: string,\n    variant: ActionVariant,\n    icon: string | undefined,\n    queryContext: string\n  ): ActionButton {\n    const recordId = String(record.id || '');\n    const basePath = this.config.actionBasePath;\n\n    // Determine target URL\n    let targetUrl: string;\n    if (schemaAction.href) {\n      // Use explicit href pattern, replacing {id} placeholder\n      targetUrl = schemaAction.href.replace('{id}', recordId);\n    } else if (schemaAction.name === 'edit') {\n      targetUrl = `${basePath}/${recordId}/edit`;\n    } else {\n      // Default: view\n      targetUrl = `${basePath}/${recordId}`;\n    }\n\n    // Append query context\n    if (queryContext) {\n      targetUrl += targetUrl.includes('?') ? `&${queryContext}` : `?${queryContext}`;\n    }\n\n    return {\n      label,\n      icon: icon || this.getDefaultIcon(schemaAction.name),\n      variant,\n      action: () => {\n        window.location.href = targetUrl;\n      },\n    };\n  }\n\n  /**\n   * Build delete action with confirmation\n   */\n  private buildDeleteAction(\n    record: Record<string, unknown>,\n    label: string,\n    variant: ActionVariant,\n    icon: string | undefined\n  ): ActionButton {\n    const recordId = String(record.id || '');\n    const endpoint = this.config.apiEndpoint;\n\n    return {\n      label,\n      icon: icon || 'trash',\n      variant: variant === 'secondary' ? 'danger' : variant,\n      action: async () => {\n        const confirmed = window.confirm(`Are you sure you want to delete this item?`);\n        if (!confirmed) return;\n\n        const response = await fetch(`${endpoint}/${recordId}`, {\n          method: 'DELETE',\n          headers: { 'Accept': 'application/json' },\n        });\n\n        if (!response.ok) {\n          throw new Error('Delete failed');\n        }\n      },\n    };\n  }\n\n  /**\n   * Build POST action for workflow/panel actions\n   */\n  private buildPostAction(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction,\n    label: string,\n    variant: ActionVariant,\n    icon: string | undefined\n  ): ActionButton {\n    const recordId = String(record.id || '');\n    const actionName = schemaAction.name;\n    const endpoint = `${this.config.apiEndpoint}/actions/${actionName}`;\n\n    return {\n      label,\n      icon: icon || this.getDefaultIcon(actionName),\n      variant,\n      action: async () => {\n        // Handle confirmation if required\n        if (schemaAction.confirm) {\n          const confirmed = window.confirm(schemaAction.confirm);\n          if (!confirmed) return;\n        }\n\n        // Build payload\n        const payload = await this.buildActionPayload(record, schemaAction);\n        if (payload === null) {\n          // User cancelled payload input\n          return;\n        }\n\n        await this.executePostAction({\n          actionName,\n          endpoint,\n          payload,\n          recordId,\n        });\n      },\n    };\n  }\n\n  private async executePostAction(input: {\n    actionName: string;\n    endpoint: string;\n    payload: Record<string, unknown>;\n    recordId: string;\n  }): Promise<ActionResult> {\n    const result = await executeActionRequest(input.endpoint, input.payload);\n\n    if (result.success) {\n      this.config.onActionSuccess?.(input.actionName, result);\n\n      // Post-create handoff for create_translation action\n      if (input.actionName.toLowerCase() === 'create_translation' && result.data) {\n        this.handleCreateTranslationSuccess(result.data, input.payload);\n      }\n\n      return result;\n    }\n\n    if (!result.error) {\n      return result;\n    }\n\n    // Translation blockers require a modal-first remediation flow with retry support.\n    if (isTranslationBlocker(result.error)) {\n      const blockerInfo = extractTranslationBlocker(result.error);\n      if (blockerInfo && this.config.onTranslationBlocker) {\n        const retryPayload = { ...input.payload };\n        this.config.onTranslationBlocker({\n          actionName: input.actionName,\n          recordId: input.recordId,\n          ...blockerInfo,\n          retry: async () => this.executePostAction({\n            actionName: input.actionName,\n            endpoint: input.endpoint,\n            payload: { ...retryPayload },\n            recordId: input.recordId,\n          }),\n        });\n        return { success: false, error: result.error };\n      }\n    }\n\n    const formattedMessage = this.buildActionErrorMessage(input.actionName, result.error);\n    this.config.onActionError?.(input.actionName, {\n      ...result.error,\n      message: formattedMessage,\n    });\n    throw new Error(formattedMessage);\n  }\n\n  /**\n   * Handle successful create_translation action:\n   * - Show success toast with source locale shortcut\n   * - Redirect to new locale edit page\n   */\n  private handleCreateTranslationSuccess(\n    data: Record<string, unknown>,\n    originalPayload: Record<string, unknown>\n  ): void {\n    // Extract new record info from response\n    const newId = typeof data.id === 'string' ? data.id : String(data.id || '');\n    const newLocale = typeof data.locale === 'string' ? data.locale : '';\n\n    if (!newId) {\n      console.warn('[SchemaActionBuilder] create_translation response missing id');\n      return;\n    }\n\n    // Build redirect URL to edit the new translation\n    const basePath = this.config.actionBasePath;\n    const params = new URLSearchParams();\n    if (newLocale) {\n      params.set('locale', newLocale);\n    }\n    if (this.config.environment) {\n      params.set('env', this.config.environment);\n    }\n    const queryString = params.toString();\n    const editUrl = `${basePath}/${newId}/edit${queryString ? `?${queryString}` : ''}`;\n\n    // Show success toast with source locale shortcut\n    const sourceLocale = typeof originalPayload.source_locale === 'string'\n      ? originalPayload.source_locale\n      : this.config.locale || 'source';\n    const localeLabel = this.localeLabel(newLocale || 'unknown');\n\n    // Use toast if available, otherwise console log\n    if (typeof window !== 'undefined' && 'toastManager' in window) {\n      const toastManager = (window as unknown as {\n        toastManager: { success: (msg: string, opts?: { action?: { label: string; handler: () => void } }) => void }\n      }).toastManager;\n\n      toastManager.success(`${localeLabel} translation created`, {\n        action: {\n          label: `View ${sourceLocale.toUpperCase()}`,\n          handler: () => {\n            // Navigate back to source locale\n            const sourceParams = new URLSearchParams();\n            sourceParams.set('locale', sourceLocale);\n            if (this.config.environment) {\n              sourceParams.set('env', this.config.environment);\n            }\n            const sourceId = typeof originalPayload.id === 'string'\n              ? originalPayload.id\n              : String(originalPayload.id || newId);\n            window.location.href = `${basePath}/${sourceId}/edit?${sourceParams.toString()}`;\n          },\n        },\n      });\n    } else {\n      console.log(`[SchemaActionBuilder] Translation created: ${newLocale}`);\n    }\n\n    // Redirect to new translation edit page\n    window.location.href = editUrl;\n  }\n\n  /**\n   * Build action payload from record and schema\n   */\n  private async buildActionPayload(\n    record: Record<string, unknown>,\n    schemaAction: SchemaAction\n  ): Promise<Record<string, unknown> | null> {\n    const payload: Record<string, unknown> = {\n      id: record.id,\n    };\n\n    // Add locale/environment context\n    if (this.config.locale) {\n      payload.locale = this.config.locale;\n    }\n    if (this.config.environment) {\n      payload.environment = this.config.environment;\n    }\n    if (this.config.panelName) {\n      payload.policy_entity = this.config.panelName;\n    }\n\n    const schema = this.normalizePayloadSchema(schemaAction.payload_schema);\n    const requiredFields = this.collectRequiredFields(schemaAction.payload_required, schema);\n\n    // Seed defaults from schema definitions.\n    if (schema?.properties) {\n      for (const [field, definition] of Object.entries(schema.properties)) {\n        if (payload[field] === undefined && definition.default !== undefined) {\n          payload[field] = definition.default;\n        }\n      }\n    }\n\n    // Generate idempotency_key for send-like actions when required but absent.\n    if (\n      requiredFields.includes('idempotency_key') &&\n      this.isEmptyPayloadValue(payload.idempotency_key)\n    ) {\n      payload.idempotency_key = this.generateIdempotencyKey(schemaAction.name, String(record.id || ''));\n    }\n\n    const missingRequired = requiredFields.filter((field) => this.isEmptyPayloadValue(payload[field]));\n    if (missingRequired.length === 0) {\n      return payload;\n    }\n\n    const promptedValues = await this.promptForPayload(schemaAction, missingRequired, schema, payload, record);\n    if (promptedValues === null) {\n      return null; // User cancelled\n    }\n\n    for (const field of missingRequired) {\n      const definition = schema?.properties?.[field];\n      const rawValue = promptedValues[field] ?? '';\n      const parsed = this.coercePromptValue(rawValue, field, definition);\n      if (parsed.error) {\n        throw new Error(parsed.error);\n      }\n      payload[field] = parsed.value;\n    }\n\n    return payload;\n  }\n\n  /**\n   * Prompt user for required payload values\n   * Uses the existing PayloadInputModal from actions.ts\n   */\n  private async promptForPayload(\n    schemaAction: SchemaAction,\n    requiredFields: string[],\n    schema: PayloadSchema | null,\n    payload: Record<string, unknown>,\n    record?: Record<string, unknown>\n  ): Promise<Record<string, unknown> | null> {\n    if (requiredFields.length === 0) {\n      return {};\n    }\n    // Import dynamically to avoid circular dependencies\n    const { PayloadInputModal } = await import('./payload-modal.js');\n\n    const fields = requiredFields.map((name) => {\n      const definition = schema?.properties?.[name];\n      return {\n        name,\n        label: definition?.title || name,\n        description: definition?.description,\n        value: this.stringifyDefault(payload[name] ?? definition?.default),\n        type: definition?.type || 'string',\n        options: this.buildFieldOptions(name, schemaAction.name, definition, record),\n      };\n    });\n\n    const result = await PayloadInputModal.prompt({\n      title: `Complete ${schemaAction.label || schemaAction.name}`,\n      fields,\n    });\n\n    return result;\n  }\n\n  /**\n   * Build field options from schema property\n   */\n  private buildFieldOptions(\n    fieldName: string,\n    actionName: string,\n    prop: PayloadSchemaProperty | undefined,\n    record?: Record<string, unknown>\n  ): Array<{ value: string; label: string }> | undefined {\n    if (!prop) {\n      return this.deriveCreateTranslationLocaleOptions(fieldName, actionName, record);\n    }\n    if (prop.oneOf) {\n      return prop.oneOf\n        .filter(opt => opt && 'const' in opt)\n        .map(opt => ({\n          value: this.stringifyDefault(opt.const),\n          label: opt.title || this.stringifyDefault(opt.const),\n        }));\n    }\n\n    if (prop.enum) {\n      return prop.enum.map(val => ({\n        value: this.stringifyDefault(val),\n        label: this.stringifyDefault(val),\n      }));\n    }\n\n    const extensionOptions = this.buildExtensionFieldOptions(prop);\n    if (extensionOptions && extensionOptions.length > 0) {\n      return extensionOptions;\n    }\n\n    return this.deriveCreateTranslationLocaleOptions(fieldName, actionName, record);\n  }\n\n  private buildExtensionFieldOptions(prop: PayloadSchemaProperty): Array<{ value: string; label: string }> | undefined {\n    const raw = prop as Record<string, unknown>;\n    const candidate =\n      raw['x-options'] ??\n      raw.x_options ??\n      raw.xOptions;\n    if (!Array.isArray(candidate) || candidate.length === 0) {\n      return undefined;\n    }\n\n    const options: Array<{ value: string; label: string }> = [];\n    for (const item of candidate) {\n      if (typeof item === 'string') {\n        const value = this.stringifyDefault(item);\n        if (!value) {\n          continue;\n        }\n        options.push({ value, label: value });\n        continue;\n      }\n      if (!item || typeof item !== 'object') {\n        continue;\n      }\n      const candidateValue = (item as Record<string, unknown>).value;\n      const value = this.stringifyDefault(candidateValue);\n      if (!value) {\n        continue;\n      }\n      const candidateLabel = (item as Record<string, unknown>).label;\n      const label = this.stringifyDefault(candidateLabel) || value;\n      options.push({ value, label });\n    }\n    return options.length > 0 ? options : undefined;\n  }\n\n  private deriveCreateTranslationLocaleOptions(\n    fieldName: string,\n    actionName: string,\n    record?: Record<string, unknown>\n  ): Array<{ value: string; label: string; description?: string; recommended?: boolean }> | undefined {\n    if (fieldName.trim().toLowerCase() !== 'locale') {\n      return undefined;\n    }\n    if (actionName.trim().toLowerCase() !== 'create_translation') {\n      return undefined;\n    }\n    if (!record || typeof record !== 'object') {\n      return undefined;\n    }\n\n    const readiness = this.asObject(record.translation_readiness);\n    let locales = this.asStringArray(readiness?.missing_required_locales);\n    if (locales.length === 0) {\n      locales = this.asStringArray((record as Record<string, unknown>).missing_locales);\n    }\n    if (locales.length === 0 && readiness) {\n      const required = this.asStringArray(readiness.required_locales);\n      const availableSet = new Set(this.asStringArray(readiness.available_locales));\n      locales = required.filter((locale) => !availableSet.has(locale));\n    }\n    if (locales.length === 0) {\n      return undefined;\n    }\n\n    // Extract context for hints\n    const recommendedLocale = this.extractStringField(record, 'recommended_locale');\n    const requiredForPublish = this.asStringArray(readiness?.required_for_publish ?? readiness?.required_locales);\n    const existingLocales = this.asStringArray(readiness?.available_locales ?? record.existing_locales);\n\n    const seen = new Set<string>();\n    const options: Array<{ value: string; label: string; description?: string; recommended?: boolean }> = [];\n    for (const rawLocale of locales) {\n      const locale = rawLocale.trim().toLowerCase();\n      if (!locale || seen.has(locale)) {\n        continue;\n      }\n      seen.add(locale);\n\n      const isRecommended = recommendedLocale?.toLowerCase() === locale;\n      const isRequiredForPublish = requiredForPublish.includes(locale);\n\n      // Build description hint\n      const hints: string[] = [];\n      if (isRequiredForPublish) {\n        hints.push('Required for publishing');\n      }\n      if (existingLocales.length > 0) {\n        hints.push(`${existingLocales.length} translation${existingLocales.length > 1 ? 's' : ''} exist`);\n      }\n      const description = hints.length > 0 ? hints.join('  ') : undefined;\n\n      // Build label with explicit format: \"FR - French (recommended)\"\n      let label = `${locale.toUpperCase()} - ${this.localeLabel(locale)}`;\n      if (isRecommended) {\n        label += ' (recommended)';\n      }\n\n      options.push({\n        value: locale,\n        label,\n        description,\n        recommended: isRecommended,\n      });\n    }\n\n    // Sort: recommended first, then alphabetically\n    options.sort((a, b) => {\n      if (a.recommended && !b.recommended) return -1;\n      if (!a.recommended && b.recommended) return 1;\n      return a.value.localeCompare(b.value);\n    });\n\n    return options.length > 0 ? options : undefined;\n  }\n\n  private extractStringField(record: Record<string, unknown>, field: string): string | null {\n    const value = record[field];\n    if (typeof value === 'string' && value.trim()) {\n      return value.trim();\n    }\n    return null;\n  }\n\n  private asObject(value: unknown): Record<string, unknown> | null {\n    if (!value || typeof value !== 'object' || Array.isArray(value)) {\n      return null;\n    }\n    return value as Record<string, unknown>;\n  }\n\n  private asStringArray(value: unknown): string[] {\n    if (!Array.isArray(value)) {\n      return [];\n    }\n    return value\n      .filter((entry): entry is string => typeof entry === 'string')\n      .map((entry) => entry.trim().toLowerCase())\n      .filter((entry) => entry.length > 0);\n  }\n\n  private localeLabel(locale: string): string {\n    const labels: Record<string, string> = {\n      en: 'English',\n      es: 'Spanish',\n      fr: 'French',\n      de: 'German',\n      it: 'Italian',\n      pt: 'Portuguese',\n    };\n    return labels[locale] || locale.toUpperCase();\n  }\n\n  /**\n   * Stringify default value for form input\n   */\n  private stringifyDefault(value: unknown): string {\n    if (value === undefined || value === null) return '';\n    if (typeof value === 'string') return value;\n    if (typeof value === 'object') {\n      try {\n        return JSON.stringify(value);\n      } catch {\n        return '';\n      }\n    }\n    return String(value);\n  }\n\n  private normalizePayloadSchema(schema: SchemaAction['payload_schema']): PayloadSchema | null {\n    if (!schema || typeof schema !== 'object') {\n      return null;\n    }\n\n    const propertiesRaw = (schema as Record<string, unknown>).properties;\n    let properties: Record<string, PayloadSchemaProperty> | undefined;\n    if (propertiesRaw && typeof propertiesRaw === 'object' && !Array.isArray(propertiesRaw)) {\n      properties = {};\n      for (const [key, value] of Object.entries(propertiesRaw as Record<string, unknown>)) {\n        if (value && typeof value === 'object' && !Array.isArray(value)) {\n          properties[key] = value as PayloadSchemaProperty;\n        }\n      }\n    }\n\n    const requiredRaw = (schema as Record<string, unknown>).required;\n    const required = Array.isArray(requiredRaw)\n      ? requiredRaw\n        .filter((field): field is string => typeof field === 'string')\n        .map((field) => field.trim())\n        .filter((field) => field.length > 0)\n      : undefined;\n\n    return {\n      type: typeof (schema as Record<string, unknown>).type === 'string'\n        ? ((schema as Record<string, unknown>).type as string)\n        : undefined,\n      required,\n      properties,\n    };\n  }\n\n  private collectRequiredFields(\n    payloadRequired: SchemaAction['payload_required'],\n    schema: PayloadSchema | null\n  ): string[] {\n    const ordered: string[] = [];\n    const seen = new Set<string>();\n    const append = (field: string): void => {\n      const name = field.trim();\n      if (!name || seen.has(name)) {\n        return;\n      }\n      seen.add(name);\n      ordered.push(name);\n    };\n\n    if (Array.isArray(payloadRequired)) {\n      payloadRequired.forEach((field) => append(String(field)));\n    }\n    if (Array.isArray(schema?.required)) {\n      schema.required.forEach((field) => append(String(field)));\n    }\n    return ordered;\n  }\n\n  private isEmptyPayloadValue(value: unknown): boolean {\n    if (value === null || value === undefined) {\n      return true;\n    }\n    if (typeof value === 'string') {\n      return value.trim() === '';\n    }\n    if (Array.isArray(value)) {\n      return value.length === 0;\n    }\n    if (typeof value === 'object') {\n      return Object.keys(value as Record<string, unknown>).length === 0;\n    }\n    return false;\n  }\n\n  private generateIdempotencyKey(actionName: string, recordId: string): string {\n    const safeAction = actionName.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    const safeRecord = recordId.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    const suffix = typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function'\n      ? crypto.randomUUID()\n      : `${Date.now()}-${Math.floor(Math.random() * 1_000_000)}`;\n    return `${safeAction || 'action'}-${safeRecord || 'record'}-${suffix}`;\n  }\n\n  private coercePromptValue(\n    rawValue: unknown,\n    field: string,\n    prop: PayloadSchemaProperty | undefined\n  ): { value: unknown; error?: string } {\n    const value = typeof rawValue === 'string' ? rawValue.trim() : String(rawValue ?? '').trim();\n    const type = typeof prop?.type === 'string' ? prop.type.toLowerCase() : 'string';\n\n    if (value.length === 0) {\n      return { value };\n    }\n\n    if (type === 'number' || type === 'integer') {\n      const parsed = Number(value);\n      if (!Number.isFinite(parsed)) {\n        return { value: null, error: `${field} must be a valid number` };\n      }\n      return { value: type === 'integer' ? Math.trunc(parsed) : parsed };\n    }\n\n    if (type === 'boolean') {\n      const normalized = value.toLowerCase();\n      if (normalized === 'true' || normalized === '1' || normalized === 'yes') {\n        return { value: true };\n      }\n      if (normalized === 'false' || normalized === '0' || normalized === 'no') {\n        return { value: false };\n      }\n      return { value: null, error: `${field} must be true or false` };\n    }\n\n    if (type === 'array' || type === 'object') {\n      try {\n        return { value: JSON.parse(value) };\n      } catch {\n        const expected = type === 'array' ? '[...]' : '{...}';\n        return { value: null, error: `${field} must be valid JSON (${expected})` };\n      }\n    }\n\n    return { value };\n  }\n\n  private buildActionErrorMessage(actionName: string, error: StructuredError): string {\n    return formatStructuredErrorForDisplay(error, `${actionName} failed`);\n  }\n\n  /**\n   * Build URL query context from locale/environment\n   */\n  private buildQueryContext(): string {\n    const params = new URLSearchParams();\n    if (this.config.locale) {\n      params.set('locale', this.config.locale);\n    }\n    if (this.config.environment) {\n      params.set('env', this.config.environment);\n    }\n    return params.toString();\n  }\n\n  /**\n   * Append default actions (view, edit, delete) avoiding duplicates\n   */\n  private appendDefaultActions(\n    actions: ActionButton[],\n    record: Record<string, unknown>,\n    queryContext: string\n  ): void {\n    const recordId = String(record.id || '');\n    const basePath = this.config.actionBasePath;\n    const apiEndpoint = this.config.apiEndpoint;\n\n    const defaults: Array<{ name: string; button: ActionButton }> = [\n      {\n        name: 'view',\n        button: {\n          label: 'View',\n          icon: 'eye',\n          variant: 'secondary',\n          action: () => {\n            let url = `${basePath}/${recordId}`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'edit',\n        button: {\n          label: 'Edit',\n          icon: 'edit',\n          variant: 'primary',\n          action: () => {\n            let url = `${basePath}/${recordId}/edit`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'delete',\n        button: {\n          label: 'Delete',\n          icon: 'trash',\n          variant: 'danger',\n          action: async () => {\n            if (!window.confirm('Are you sure you want to delete this item?')) return;\n            const response = await fetch(`${apiEndpoint}/${recordId}`, {\n              method: 'DELETE',\n              headers: { 'Accept': 'application/json' },\n            });\n            if (!response.ok) {\n              throw new Error('Delete failed');\n            }\n          },\n        },\n      },\n    ];\n\n    for (const def of defaults) {\n      if (!this.seenActions.has(def.name)) {\n        this.seenActions.add(def.name);\n        actions.push(def.button);\n      }\n    }\n  }\n\n  /**\n   * Append default actions with ordering metadata\n   */\n  private appendDefaultActionsOrdered(\n    orderedActions: OrderedAction[],\n    record: Record<string, unknown>,\n    queryContext: string,\n    startingIndex: number\n  ): void {\n    const recordId = String(record.id || '');\n    const basePath = this.config.actionBasePath;\n    const apiEndpoint = this.config.apiEndpoint;\n\n    const defaults: Array<{ name: string; button: ActionButton }> = [\n      {\n        name: 'view',\n        button: {\n          label: 'View',\n          icon: 'eye',\n          variant: 'secondary',\n          action: () => {\n            let url = `${basePath}/${recordId}`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'edit',\n        button: {\n          label: 'Edit',\n          icon: 'edit',\n          variant: 'primary',\n          action: () => {\n            let url = `${basePath}/${recordId}/edit`;\n            if (queryContext) url += `?${queryContext}`;\n            window.location.href = url;\n          },\n        },\n      },\n      {\n        name: 'delete',\n        button: {\n          label: 'Delete',\n          icon: 'trash',\n          variant: 'danger',\n          action: async () => {\n            if (!window.confirm('Are you sure you want to delete this item?')) return;\n            const response = await fetch(`${apiEndpoint}/${recordId}`, {\n              method: 'DELETE',\n              headers: { 'Accept': 'application/json' },\n            });\n            if (!response.ok) {\n              throw new Error('Delete failed');\n            }\n          },\n        },\n      },\n    ];\n\n    let insertionIndex = startingIndex;\n    for (const def of defaults) {\n      if (!this.seenActions.has(def.name)) {\n        this.seenActions.add(def.name);\n        orderedActions.push({\n          action: def.button,\n          name: def.name,\n          order: this.resolveActionOrder(def.name, undefined),\n          insertionIndex: insertionIndex++,\n        });\n      }\n    }\n  }\n\n  /**\n   * Get default icon for action by name\n   */\n  private getDefaultIcon(actionName: string): string | undefined {\n    const icons: Record<string, string> = {\n      view: 'eye',\n      edit: 'edit',\n      delete: 'trash',\n      publish: 'check-circle',\n      unpublish: 'x-circle',\n      archive: 'archive',\n      restore: 'archive',\n      duplicate: 'copy',\n      create_translation: 'copy',\n      approve: 'check-circle',\n      reject: 'x-circle',\n      submit: 'check-circle',\n    };\n    return icons[actionName.toLowerCase()];\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Build row actions from schema with default configuration\n */\nexport function buildSchemaRowActions(\n  record: Record<string, unknown>,\n  schemaActions: SchemaAction[] | undefined,\n  config: SchemaActionBuilderConfig\n): ActionButton[] {\n  const builder = new SchemaActionBuilder(config);\n  return builder.buildRowActions(record, schemaActions);\n}\n\n/**\n * Extract schema.actions from API response\n */\nexport function extractSchemaActions(response: {\n  schema?: { actions?: SchemaAction[] };\n}): SchemaAction[] | undefined {\n  return response.schema?.actions;\n}\n","/**\n * Payload Input Modal\n *\n * Reusable modal for collecting payload values from users\n * before executing actions that require input.\n */\n\nimport { Modal, escapeHtml } from '../shared/modal.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface PayloadModalFieldOption {\n  value: string;\n  label: string;\n  /** Optional description/hint for the option */\n  description?: string;\n  /** Whether this option is recommended (for preselection) */\n  recommended?: boolean;\n}\n\nexport interface PayloadModalField {\n  name: string;\n  label: string;\n  description?: string;\n  value: string;\n  type: string;\n  options?: PayloadModalFieldOption[];\n}\n\nexport interface PayloadModalConfig {\n  title: string;\n  fields: PayloadModalField[];\n  confirmLabel?: string;\n  cancelLabel?: string;\n}\n\n// ============================================================================\n// PayloadInputModal\n// ============================================================================\n\nexport class PayloadInputModal extends Modal {\n  private readonly modalConfig: PayloadModalConfig;\n  private readonly onConfirm: (values: Record<string, string>) => void;\n  private readonly onCancel: () => void;\n  private resolved = false;\n\n  constructor(\n    config: PayloadModalConfig,\n    onConfirm: (values: Record<string, string>) => void,\n    onCancel: () => void\n  ) {\n    super({ size: 'md', initialFocus: '[data-payload-field]', lockBodyScroll: false });\n    this.modalConfig = config;\n    this.onConfirm = onConfirm;\n    this.onCancel = onCancel;\n  }\n\n  /**\n   * Show modal and return promise that resolves with values or null if cancelled\n   */\n  static prompt(config: PayloadModalConfig): Promise<Record<string, string> | null> {\n    return new Promise<Record<string, string> | null>((resolve) => {\n      const modal = new PayloadInputModal(\n        config,\n        (values) => resolve(values),\n        () => resolve(null)\n      );\n      modal.show();\n    });\n  }\n\n  protected renderContent(): string {\n    const fields = this.modalConfig.fields.map((field) => this.renderField(field)).join('');\n    return `\n      <form class=\"flex flex-col\" data-payload-form>\n        <div class=\"px-6 py-4 border-b border-gray-200\">\n          <h3 class=\"text-lg font-semibold text-gray-900\">${escapeHtml(this.modalConfig.title)}</h3>\n          <p class=\"text-sm text-gray-500 mt-1\">Complete required fields to continue.</p>\n        </div>\n        <div class=\"px-6 py-4 space-y-4 max-h-[60vh] overflow-y-auto\">\n          ${fields}\n        </div>\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200\">\n          <button type=\"button\"\n                  data-payload-cancel\n                  class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer\">\n            ${escapeHtml(this.modalConfig.cancelLabel ?? 'Cancel')}\n          </button>\n          <button type=\"submit\"\n                  data-payload-confirm\n                  class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 cursor-pointer\">\n            ${escapeHtml(this.modalConfig.confirmLabel ?? 'Continue')}\n          </button>\n        </div>\n      </form>\n    `;\n  }\n\n  protected bindContentEvents(): void {\n    const form = this.container?.querySelector<HTMLFormElement>('[data-payload-form]');\n    const cancelBtn = this.container?.querySelector<HTMLButtonElement>('[data-payload-cancel]');\n\n    const submit = (): void => {\n      this.clearErrors();\n      const values: Record<string, string> = {};\n      let firstInvalid: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null = null;\n\n      for (const field of this.modalConfig.fields) {\n        const input = this.container?.querySelector<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>(\n          `[data-payload-field=\"${field.name}\"]`\n        );\n        if (!input) {\n          continue;\n        }\n        const value = input.value.trim();\n        values[field.name] = value;\n        if (!value) {\n          if (!firstInvalid) {\n            firstInvalid = input;\n          }\n          this.showFieldError(field.name, 'This field is required.');\n        }\n      }\n\n      if (firstInvalid) {\n        firstInvalid.focus();\n        return;\n      }\n\n      this.resolved = true;\n      this.onConfirm(values);\n      this.hide();\n    };\n\n    form?.addEventListener('submit', (event) => {\n      event.preventDefault();\n      submit();\n    });\n    cancelBtn?.addEventListener('click', () => {\n      this.hide();\n    });\n\n    // Handle radio group value synchronization\n    const radioGroups = this.container?.querySelectorAll<HTMLElement>('[data-payload-radio-group]');\n    radioGroups?.forEach((group) => {\n      const fieldName = group.dataset.payloadRadioGroup;\n      if (!fieldName) return;\n\n      const radios = group.querySelectorAll<HTMLInputElement>(`[data-payload-radio=\"${fieldName}\"]`);\n      const hiddenInput = group.querySelector<HTMLInputElement>(`[data-payload-field=\"${fieldName}\"]`);\n      if (!hiddenInput) return;\n\n      radios.forEach((radio) => {\n        radio.addEventListener('change', () => {\n          if (radio.checked) {\n            hiddenInput.value = radio.value;\n          }\n        });\n      });\n    });\n  }\n\n  protected onBeforeHide(): boolean {\n    if (!this.resolved) {\n      this.resolved = true;\n      this.onCancel();\n    }\n    return true;\n  }\n\n  private renderField(field: PayloadModalField): string {\n    const description = field.description\n      ? `<p class=\"text-xs text-gray-500 mt-1\">${escapeHtml(field.description)}</p>`\n      : '';\n    const control = field.options && field.options.length > 0\n      ? this.renderSelect(field)\n      : this.renderInput(field);\n    return `\n      <div>\n        <label class=\"block text-sm font-medium text-gray-800 mb-1.5\" for=\"payload-field-${field.name}\">\n          ${escapeHtml(field.label)}\n        </label>\n        ${control}\n        ${description}\n        <p class=\"hidden text-xs text-red-600 mt-1\" data-payload-error=\"${field.name}\"></p>\n      </div>\n    `;\n  }\n\n  private renderSelect(field: PayloadModalField): string {\n    // Find recommended option for preselection if no value is set\n    let selected = field.value;\n    const options = field.options || [];\n    if (!selected) {\n      const recommended = options.find((opt) => opt.recommended);\n      if (recommended) {\n        selected = recommended.value;\n      }\n    }\n\n    // Check if any option has descriptions (for enhanced rendering)\n    const hasDescriptions = options.some((opt) => opt.description);\n\n    if (hasDescriptions) {\n      // Render as radio group for better description display\n      return this.renderRadioGroup(field, options, selected);\n    }\n\n    const optionHtml = options\n      .map((option) => {\n        const isSelected = option.value === selected ? ' selected' : '';\n        return `<option value=\"${escapeHtml(option.value)}\"${isSelected}>${escapeHtml(option.label)}</option>`;\n      })\n      .join('');\n    return `\n      <select id=\"payload-field-${field.name}\"\n              data-payload-field=\"${field.name}\"\n              class=\"w-full border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300\">\n        <option value=\"\">Select an option</option>\n        ${optionHtml}\n      </select>\n    `;\n  }\n\n  private renderRadioGroup(\n    field: PayloadModalField,\n    options: PayloadModalFieldOption[],\n    selected: string\n  ): string {\n    const radioItems = options\n      .map((option, index) => {\n        const isChecked = option.value === selected ? ' checked' : '';\n        const description = option.description\n          ? `<span class=\"text-xs text-gray-500 block ml-6 mt-0.5\">${escapeHtml(option.description)}</span>`\n          : '';\n        return `\n          <label class=\"flex items-start gap-2 p-2 rounded-lg hover:bg-gray-50 cursor-pointer ${option.recommended ? 'bg-blue-50 border border-blue-200' : ''}\">\n            <input type=\"radio\"\n                   name=\"payload-radio-${field.name}\"\n                   value=\"${escapeHtml(option.value)}\"\n                   data-payload-radio=\"${field.name}\"\n                   class=\"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500\"\n                   ${isChecked} />\n            <span class=\"flex-1\">\n              <span class=\"text-sm font-medium text-gray-900\">${escapeHtml(option.label)}</span>\n              ${description}\n            </span>\n          </label>\n        `;\n      })\n      .join('');\n\n    // Hidden input to hold the actual value for form submission\n    const initialValue = selected || '';\n    return `\n      <div class=\"space-y-1\" data-payload-radio-group=\"${field.name}\">\n        <input type=\"hidden\"\n               data-payload-field=\"${field.name}\"\n               value=\"${escapeHtml(initialValue)}\" />\n        ${radioItems}\n      </div>\n    `;\n  }\n\n  private renderInput(field: PayloadModalField): string {\n    const cls = 'w-full border rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent px-3 py-2 text-sm border-gray-300';\n    if (field.type === 'array' || field.type === 'object') {\n      return `\n        <textarea id=\"payload-field-${field.name}\"\n                  data-payload-field=\"${field.name}\"\n                  rows=\"4\"\n                  class=\"${cls}\"\n                  placeholder=\"${field.type === 'array' ? '[...]' : '{...}'}\">${escapeHtml(field.value)}</textarea>\n      `;\n    }\n    const inputType = field.type === 'integer' || field.type === 'number' ? 'number' : 'text';\n    return `\n      <input id=\"payload-field-${field.name}\"\n             type=\"${inputType}\"\n             data-payload-field=\"${field.name}\"\n             value=\"${escapeHtml(field.value)}\"\n             class=\"${cls}\" />\n    `;\n  }\n\n  private clearErrors(): void {\n    const errors = this.container?.querySelectorAll<HTMLElement>('[data-payload-error]');\n    errors?.forEach((el) => {\n      el.textContent = '';\n      el.classList.add('hidden');\n    });\n  }\n\n  private showFieldError(name: string, message: string): void {\n    const errorEl = this.container?.querySelector<HTMLElement>(`[data-payload-error=\"${name}\"]`);\n    if (!errorEl) {\n      return;\n    }\n    errorEl.textContent = message;\n    errorEl.classList.remove('hidden');\n  }\n}\n","/**\n * Translation Blocker Modal\n *\n * Modal-first UI for TRANSLATION_MISSING errors that provides actionable\n * remediation for editors. Shows missing locales, per-locale field hints,\n * and quick actions (Create/Open translation).\n *\n * Design decisions (per CONTENT_TRANSLATION_TDD.md):\n * - Modal is primary UX, toast is fallback only for render failure\n * - Quick actions operate from typed contract data (no heuristics/string matching)\n * - Accessible with keyboard navigation and screen-reader labels\n */\n\nimport { Modal, escapeHtml } from '../shared/modal.js';\nimport { executeActionRequest } from '../toast/error-helpers.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for the translation blocker modal\n */\nexport interface TranslationBlockerModalConfig {\n  /** The workflow transition that was blocked (e.g., 'publish') */\n  transition: string | null;\n  /** Entity type (e.g., 'pages', 'posts') */\n  entityType: string | null;\n  /** The record ID that triggered the blocker */\n  recordId: string;\n  /** Locales that are missing translations */\n  missingLocales: string[];\n  /** Required fields missing per locale (optional) */\n  missingFieldsByLocale: Record<string, string[]> | null;\n  /** The locale that was requested */\n  requestedLocale: string | null;\n  /** The environment context (e.g., 'production', 'staging') */\n  environment: string | null;\n  /** API endpoint for panel actions (e.g., /admin/api/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Callback after successful create translation action */\n  onCreateSuccess?: (locale: string, result: CreateTranslationResult) => void;\n  /** Callback after action error */\n  onError?: (message: string) => void;\n  /** Callback when retry is requested */\n  onRetry?: () => void | Promise<void>;\n  /** Callback when modal is dismissed without action */\n  onDismiss?: () => void;\n}\n\n/**\n * Result from create_translation action\n */\nexport interface CreateTranslationResult {\n  id: string;\n  locale: string;\n  status: string;\n  translation_group_id?: string;\n}\n\n/**\n * Internal state for locale action status\n */\ninterface LocaleActionState {\n  loading: boolean;\n  created: boolean;\n  newRecordId?: string;\n}\n\n// ============================================================================\n// Translation Blocker Modal\n// ============================================================================\n\nexport class TranslationBlockerModal extends Modal {\n  private config: TranslationBlockerModalConfig;\n  private localeStates: Map<string, LocaleActionState> = new Map();\n  private resolved = false;\n\n  constructor(config: TranslationBlockerModalConfig) {\n    super({\n      size: 'lg',\n      initialFocus: '[data-blocker-action]',\n      lockBodyScroll: true,\n      dismissOnBackdropClick: true,\n      dismissOnEscape: true,\n    });\n    this.config = config;\n\n    // Initialize state for each missing locale\n    for (const locale of config.missingLocales) {\n      this.localeStates.set(locale, { loading: false, created: false });\n    }\n  }\n\n  /**\n   * Show the translation blocker modal.\n   * Returns a promise that resolves when the modal is closed.\n   */\n  static showBlocker(config: TranslationBlockerModalConfig): Promise<void> {\n    return new Promise<void>((resolve) => {\n      const originalOnDismiss = config.onDismiss;\n      const modal = new TranslationBlockerModal({\n        ...config,\n        onDismiss: () => {\n          originalOnDismiss?.();\n          resolve();\n        },\n      });\n      modal.show();\n    });\n  }\n\n  protected renderContent(): string {\n    const transition = this.config.transition || 'complete action';\n    const entityType = this.config.entityType || 'content';\n    const hasFieldHints = this.config.missingFieldsByLocale !== null &&\n      Object.keys(this.config.missingFieldsByLocale).length > 0;\n\n    return `\n      <div class=\"flex flex-col\" role=\"dialog\" aria-labelledby=\"blocker-title\" aria-describedby=\"blocker-description\">\n        <!-- Header -->\n        <div class=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-amber-50 dark:bg-amber-900/20\">\n          <div class=\"flex items-center gap-3\">\n            <div class=\"flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-amber-100 dark:bg-amber-800/40\">\n              <svg class=\"w-5 h-5 text-amber-600 dark:text-amber-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n              </svg>\n            </div>\n            <div>\n              <h2 id=\"blocker-title\" class=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                Cannot ${escapeHtml(transition)} ${escapeHtml(entityType)}\n              </h2>\n              <p id=\"blocker-description\" class=\"text-sm text-gray-600 dark:text-gray-400 mt-0.5\">\n                ${this.renderDescription(hasFieldHints)}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Missing Locales List -->\n        <div class=\"px-6 py-4 max-h-[50vh] overflow-y-auto\">\n          <p class=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\" id=\"locales-heading\">\n            Missing translations (${this.config.missingLocales.length}):\n          </p>\n          <ul class=\"space-y-3\" role=\"list\" aria-labelledby=\"locales-heading\">\n            ${this.config.missingLocales.map(locale => this.renderLocaleItem(locale)).join('')}\n          </ul>\n        </div>\n\n        <!-- Footer -->\n        <div class=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\n          <button type=\"button\"\n                  data-blocker-dismiss\n                  class=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer transition-colors\">\n            Close\n          </button>\n          <button type=\"button\"\n                  data-blocker-retry\n                  class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                  aria-describedby=\"retry-hint\">\n            Retry ${escapeHtml(transition)}\n          </button>\n        </div>\n        <p id=\"retry-hint\" class=\"sr-only\">Retry the blocked action after creating missing translations</p>\n      </div>\n    `;\n  }\n\n  private renderDescription(hasFieldHints: boolean): string {\n    if (hasFieldHints) {\n      return 'Required translations are missing or incomplete. Create or complete the translations listed below.';\n    }\n    return 'Required translations are missing. Create the translations listed below to continue.';\n  }\n\n  private renderLocaleItem(locale: string): string {\n    const state = this.localeStates.get(locale) || { loading: false, created: false };\n    const missingFields = this.config.missingFieldsByLocale?.[locale];\n    const hasFields = Array.isArray(missingFields) && missingFields.length > 0;\n    const localeLabel = this.getLocaleLabel(locale);\n\n    // Determine action button state\n    const actionDisabled = state.loading ? 'disabled' : '';\n    const loadingClass = state.loading ? 'opacity-50' : '';\n\n    return `\n      <li class=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 ${loadingClass}\"\n          data-locale-item=\"${escapeHtml(locale)}\"\n          role=\"listitem\">\n        <div class=\"flex items-start justify-between gap-4\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 uppercase tracking-wide\"\n                    aria-label=\"Locale code\">\n                ${escapeHtml(locale)}\n              </span>\n              <span class=\"text-sm font-medium text-gray-900 dark:text-white\">\n                ${escapeHtml(localeLabel)}\n              </span>\n              ${state.created ? `\n                <span class=\"inline-flex items-center text-xs text-green-600 dark:text-green-400\" role=\"status\">\n                  <svg class=\"w-4 h-4 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n                    <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/>\n                  </svg>\n                  Created\n                </span>\n              ` : ''}\n            </div>\n            ${hasFields ? `\n              <div class=\"mt-2\">\n                <p class=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Missing required fields:</p>\n                <div class=\"flex flex-wrap gap-1.5\">\n                  ${missingFields.map(field => `\n                    <span class=\"inline-flex items-center px-2 py-0.5 rounded text-xs bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800\">\n                      ${escapeHtml(field)}\n                    </span>\n                  `).join('')}\n                </div>\n              </div>\n            ` : ''}\n          </div>\n          <div class=\"flex items-center gap-2 flex-shrink-0\">\n            ${state.created ? this.renderOpenButton(locale, state.newRecordId) : this.renderCreateButton(locale, actionDisabled)}\n            ${this.renderOpenButton(locale, undefined, state.created)}\n          </div>\n        </div>\n        ${state.loading ? `\n          <div class=\"mt-2 flex items-center text-xs text-gray-500 dark:text-gray-400\" role=\"status\" aria-live=\"polite\">\n            <svg class=\"animate-spin w-4 h-4 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n              <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"/>\n              <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"/>\n            </svg>\n            Creating translation...\n          </div>\n        ` : ''}\n      </li>\n    `;\n  }\n\n  private renderCreateButton(locale: string, disabled: string): string {\n    return `\n      <button type=\"button\"\n              data-blocker-action=\"create\"\n              data-locale=\"${escapeHtml(locale)}\"\n              ${disabled}\n              class=\"inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer transition-colors\"\n              aria-label=\"Create ${this.getLocaleLabel(locale)} translation\">\n        <svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\"/>\n        </svg>\n        Create\n      </button>\n    `;\n  }\n\n  private renderOpenButton(locale: string, recordId?: string, hideIfNotCreated = false): string {\n    if (hideIfNotCreated) return '';\n\n    // Build URL with locale context preserved\n    const baseUrl = this.config.navigationBasePath;\n    const targetId = recordId || this.config.recordId;\n    const params = new URLSearchParams();\n    params.set('locale', locale);\n    if (this.config.environment) {\n      params.set('env', this.config.environment);\n    }\n    const url = `${baseUrl}/${targetId}/edit?${params.toString()}`;\n\n    return `\n      <a href=\"${escapeHtml(url)}\"\n         data-blocker-action=\"open\"\n         data-locale=\"${escapeHtml(locale)}\"\n         class=\"inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer transition-colors\"\n         aria-label=\"Open ${this.getLocaleLabel(locale)} translation\">\n        <svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n        </svg>\n        Open\n      </a>\n    `;\n  }\n\n  private getLocaleLabel(locale: string): string {\n    // Common locale labels - can be extended\n    const labels: Record<string, string> = {\n      en: 'English',\n      es: 'Spanish',\n      fr: 'French',\n      de: 'German',\n      it: 'Italian',\n      pt: 'Portuguese',\n      ja: 'Japanese',\n      ko: 'Korean',\n      zh: 'Chinese',\n      ar: 'Arabic',\n      ru: 'Russian',\n      nl: 'Dutch',\n      pl: 'Polish',\n      sv: 'Swedish',\n      da: 'Danish',\n      no: 'Norwegian',\n      fi: 'Finnish',\n    };\n    return labels[locale.toLowerCase()] || locale.toUpperCase();\n  }\n\n  protected bindContentEvents(): void {\n    // Dismiss button\n    const dismissBtn = this.container?.querySelector<HTMLButtonElement>('[data-blocker-dismiss]');\n    dismissBtn?.addEventListener('click', () => {\n      this.dismiss();\n    });\n\n    // Retry button\n    const retryBtn = this.container?.querySelector<HTMLButtonElement>('[data-blocker-retry]');\n    retryBtn?.addEventListener('click', async () => {\n      await this.handleRetry();\n    });\n\n    // Create translation buttons\n    const createBtns = this.container?.querySelectorAll<HTMLButtonElement>('[data-blocker-action=\"create\"]');\n    createBtns?.forEach(btn => {\n      btn.addEventListener('click', () => {\n        const locale = btn.getAttribute('data-locale');\n        if (locale) {\n          this.handleCreateTranslation(locale);\n        }\n      });\n    });\n\n    // Keyboard navigation within locale list\n    const localeItems = this.container?.querySelectorAll<HTMLElement>('[data-locale-item]');\n    localeItems?.forEach((item, index) => {\n      item.addEventListener('keydown', (e) => {\n        if (e.key === 'ArrowDown' && index < localeItems.length - 1) {\n          e.preventDefault();\n          const nextItem = localeItems[index + 1];\n          const focusable = nextItem.querySelector<HTMLElement>('[data-blocker-action]');\n          focusable?.focus();\n        } else if (e.key === 'ArrowUp' && index > 0) {\n          e.preventDefault();\n          const prevItem = localeItems[index - 1];\n          const focusable = prevItem.querySelector<HTMLElement>('[data-blocker-action]');\n          focusable?.focus();\n        }\n      });\n    });\n  }\n\n  private async handleCreateTranslation(locale: string): Promise<void> {\n    const state = this.localeStates.get(locale);\n    if (!state || state.loading || state.created) return;\n\n    // Update state to loading\n    state.loading = true;\n    this.updateLocaleItemUI(locale);\n\n    try {\n      // Build payload for create_translation action\n      const payload: Record<string, unknown> = {\n        id: this.config.recordId,\n        locale: locale,\n      };\n\n      if (this.config.environment) {\n        payload.environment = this.config.environment;\n      }\n      if (this.config.panelName) {\n        payload.policy_entity = this.config.panelName;\n      }\n\n      // Execute create_translation action\n      const endpoint = `${this.config.apiEndpoint}/actions/create_translation`;\n      const result = await executeActionRequest(endpoint, payload);\n\n      if (result.success) {\n        // Update state to created\n        state.loading = false;\n        state.created = true;\n\n        // Extract new record ID from response data if present\n        if (result.data?.id) {\n          state.newRecordId = String(result.data.id);\n        }\n\n        this.updateLocaleItemUI(locale);\n\n        // Call success callback\n        const createResult: CreateTranslationResult = {\n          id: state.newRecordId || this.config.recordId,\n          locale: locale,\n          status: String(result.data?.status || 'draft'),\n          translation_group_id: result.data?.translation_group_id\n            ? String(result.data.translation_group_id)\n            : undefined,\n        };\n        this.config.onCreateSuccess?.(locale, createResult);\n      } else {\n        state.loading = false;\n        this.updateLocaleItemUI(locale);\n\n        const errorMessage = result.error?.message || 'Failed to create translation';\n        this.config.onError?.(errorMessage);\n      }\n    } catch (err) {\n      state.loading = false;\n      this.updateLocaleItemUI(locale);\n\n      const errorMessage = err instanceof Error ? err.message : 'Failed to create translation';\n      this.config.onError?.(errorMessage);\n    }\n  }\n\n  private updateLocaleItemUI(locale: string): void {\n    const item = this.container?.querySelector(`[data-locale-item=\"${locale}\"]`);\n    if (!item) return;\n\n    // Re-render the locale item\n    const state = this.localeStates.get(locale);\n    if (!state) return;\n\n    // Find the parent list and replace this item\n    const parent = item.parentElement;\n    if (!parent) return;\n\n    const temp = document.createElement('div');\n    temp.innerHTML = this.renderLocaleItem(locale);\n    const newItem = temp.firstElementChild;\n    if (newItem) {\n      parent.replaceChild(newItem, item);\n\n      // Re-bind events for the new item\n      const createBtn = newItem.querySelector<HTMLButtonElement>('[data-blocker-action=\"create\"]');\n      createBtn?.addEventListener('click', () => {\n        this.handleCreateTranslation(locale);\n      });\n    }\n  }\n\n  private async handleRetry(): Promise<void> {\n    // Close modal first, then retry the blocked action from caller context.\n    this.resolved = true;\n    this.hide();\n    if (!this.config.onRetry) return;\n\n    try {\n      await this.config.onRetry();\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Retry failed';\n      this.config.onError?.(message);\n    }\n  }\n\n  private dismiss(): void {\n    this.resolved = true;\n    this.config.onDismiss?.();\n    this.hide();\n  }\n\n  protected onBeforeHide(): boolean {\n    if (!this.resolved) {\n      this.resolved = true;\n      this.config.onDismiss?.();\n    }\n    return true;\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Show translation blocker modal with simplified configuration.\n * Use this as the primary entry point for displaying blockers.\n */\nexport async function showTranslationBlocker(config: TranslationBlockerModalConfig): Promise<void> {\n  try {\n    await TranslationBlockerModal.showBlocker(config);\n  } catch (err) {\n    // Fallback to toast/alert if modal render fails\n    console.error('[TranslationBlockerModal] Render failed, using fallback:', err);\n    const transition = config.transition || 'complete action';\n    const locales = config.missingLocales.join(', ');\n    const message = `Cannot ${transition}: Missing translations for ${locales}`;\n\n    if (typeof window !== 'undefined' && 'toastManager' in window) {\n      (window as unknown as { toastManager: { error: (msg: string) => void } }).toastManager.error(message);\n    } else {\n      alert(message);\n    }\n  }\n}\n","/**\n * Translation Status Legend Component\n *\n * Provides a visual legend for translation status indicators in content list views.\n * Shows readiness states using consistent iconography across the admin panel.\n *\n * Contract:\n * -  ready: All required translations complete\n * -  incomplete: Has translations but missing required fields\n * -  missing: Missing required locale translations\n * -  fallback/stale: Viewing fallback content or stale data\n *\n * Phase 1 behavior:\n * - Always visible in list toolbar\n * - Non-collapsible\n * - No persisted user preference\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Status legend item definition\n */\nexport interface StatusLegendItem {\n  /** Unique status key */\n  key: string;\n  /** Display label */\n  label: string;\n  /** Icon character or SVG */\n  icon: string;\n  /** CSS color class for the icon */\n  colorClass: string;\n  /** Tooltip/description */\n  description: string;\n}\n\n/**\n * Status legend configuration\n */\nexport interface StatusLegendConfig {\n  /** Container element or selector */\n  container: HTMLElement | string;\n  /** Additional CSS classes for the legend container */\n  containerClass?: string;\n  /** Legend title (optional) */\n  title?: string;\n  /** Orientation: horizontal (default) or vertical */\n  orientation?: 'horizontal' | 'vertical';\n  /** Size variant */\n  size?: 'sm' | 'default';\n  /** Items to display (uses defaults if not provided) */\n  items?: StatusLegendItem[];\n}\n\n// ============================================================================\n// Default Legend Items\n// ============================================================================\n\n/**\n * Default translation status legend items per contract\n */\nexport const DEFAULT_STATUS_LEGEND_ITEMS: StatusLegendItem[] = [\n  {\n    key: 'ready',\n    label: 'Ready',\n    icon: '',\n    colorClass: 'text-green-500',\n    description: 'All required translations are complete',\n  },\n  {\n    key: 'incomplete',\n    label: 'Incomplete',\n    icon: '',\n    colorClass: 'text-amber-500',\n    description: 'Has translations but missing required fields',\n  },\n  {\n    key: 'missing',\n    label: 'Missing',\n    icon: '',\n    colorClass: 'text-red-500',\n    description: 'Missing required locale translations',\n  },\n  {\n    key: 'fallback',\n    label: 'Fallback',\n    icon: '',\n    colorClass: 'text-amber-600',\n    description: 'Viewing fallback content or stale data',\n  },\n];\n\n// ============================================================================\n// Status Legend Component\n// ============================================================================\n\nexport class StatusLegend {\n  private container: HTMLElement | null = null;\n  private config: Required<Omit<StatusLegendConfig, 'container'>> & { container: HTMLElement | null };\n\n  constructor(config: StatusLegendConfig) {\n    const containerEl = typeof config.container === 'string'\n      ? document.querySelector<HTMLElement>(config.container)\n      : config.container;\n\n    this.config = {\n      container: containerEl,\n      containerClass: config.containerClass || '',\n      title: config.title || '',\n      orientation: config.orientation || 'horizontal',\n      size: config.size || 'default',\n      items: config.items || DEFAULT_STATUS_LEGEND_ITEMS,\n    };\n\n    this.container = containerEl;\n  }\n\n  /**\n   * Render the legend into the container\n   */\n  render(): void {\n    if (!this.container) {\n      console.warn('[StatusLegend] Container not found');\n      return;\n    }\n\n    this.container.innerHTML = this.buildHTML();\n  }\n\n  /**\n   * Build HTML for the legend\n   */\n  buildHTML(): string {\n    const { title, orientation, size, items, containerClass } = this.config;\n    const isVertical = orientation === 'vertical';\n    const isSmall = size === 'sm';\n\n    const flexDirection = isVertical ? 'flex-col' : 'flex-row flex-wrap';\n    const gap = isSmall ? 'gap-2' : 'gap-4';\n    const textSize = isSmall ? 'text-xs' : 'text-sm';\n    const iconSize = isSmall ? 'text-sm' : 'text-base';\n\n    const titleHtml = title\n      ? `<span class=\"font-medium text-gray-600 dark:text-gray-400 mr-2 ${textSize}\">${this.escapeHtml(title)}</span>`\n      : '';\n\n    const itemsHtml = items.map(item => this.renderItem(item, iconSize, textSize)).join('');\n\n    return `\n      <div class=\"status-legend inline-flex items-center ${flexDirection} ${gap} ${containerClass}\"\n           role=\"list\"\n           aria-label=\"Translation status legend\">\n        ${titleHtml}\n        ${itemsHtml}\n      </div>\n    `;\n  }\n\n  /**\n   * Render a single legend item\n   */\n  private renderItem(item: StatusLegendItem, iconSize: string, textSize: string): string {\n    return `\n      <div class=\"status-legend-item inline-flex items-center gap-1\"\n           role=\"listitem\"\n           title=\"${this.escapeHtml(item.description)}\"\n           aria-label=\"${this.escapeHtml(item.label)}: ${this.escapeHtml(item.description)}\">\n        <span class=\"${item.colorClass} ${iconSize}\" aria-hidden=\"true\">${item.icon}</span>\n        <span class=\"text-gray-600 dark:text-gray-400 ${textSize}\">${this.escapeHtml(item.label)}</span>\n      </div>\n    `;\n  }\n\n  /**\n   * Update items and re-render\n   */\n  setItems(items: StatusLegendItem[]): void {\n    this.config.items = items;\n    this.render();\n  }\n\n  /**\n   * Destroy the legend\n   */\n  destroy(): void {\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n\n  /**\n   * Escape HTML special characters\n   */\n  private escapeHtml(str: string): string {\n    // Use string replacement instead of DOM for Node.js test compatibility\n    return str\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create and render a status legend\n */\nexport function createStatusLegend(config: StatusLegendConfig): StatusLegend {\n  const legend = new StatusLegend(config);\n  legend.render();\n  return legend;\n}\n\n/**\n * Initialize status legend on elements with data-status-legend attribute\n */\nexport function initStatusLegends(): StatusLegend[] {\n  const elements = document.querySelectorAll<HTMLElement>('[data-status-legend]');\n  const legends: StatusLegend[] = [];\n\n  elements.forEach((el) => {\n    // Skip if already initialized\n    if (el.hasAttribute('data-status-legend-init')) {\n      return;\n    }\n\n    const orientation = (el.dataset.orientation as 'horizontal' | 'vertical') || 'horizontal';\n    const size = (el.dataset.size as 'sm' | 'default') || 'default';\n    const title = el.dataset.title || '';\n\n    const legend = createStatusLegend({\n      container: el,\n      orientation,\n      size,\n      title,\n    });\n\n    el.setAttribute('data-status-legend-init', 'true');\n    legends.push(legend);\n  });\n\n  return legends;\n}\n\n/**\n * Render inline legend HTML for embedding in templates\n */\nexport function renderStatusLegendHTML(options: {\n  title?: string;\n  orientation?: 'horizontal' | 'vertical';\n  size?: 'sm' | 'default';\n  items?: StatusLegendItem[];\n  containerClass?: string;\n} = {}): string {\n  // Create a temporary legend instance to generate HTML\n  const tempContainer = document.createElement('div');\n  const legend = new StatusLegend({\n    container: tempContainer,\n    ...options,\n  });\n  return legend.buildHTML();\n}\n","/**\n * Quick Filters Component (Phase 2)\n *\n * Provides preset filter buttons for common translation filter scenarios.\n * Supports capability-aware disabled states with visible reason text.\n *\n * Contract:\n * - Quick filters are visible-disabled when unsupported, not hidden\n * - Each filter shows a reason when disabled\n * - Filter state is synchronized with DataGrid\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Quick filter definition\n */\nexport interface QuickFilter {\n  /** Unique filter key */\n  key: string;\n  /** Display label */\n  label: string;\n  /** Filter field name */\n  field: string;\n  /** Filter value */\n  value: string;\n  /** Icon or badge (optional) */\n  icon?: string;\n  /** CSS class for styling */\n  styleClass?: string;\n  /** Tooltip description */\n  description?: string;\n}\n\n/**\n * Quick filter capability - defines whether a filter is supported\n */\nexport interface QuickFilterCapability {\n  /** The filter key */\n  key: string;\n  /** Whether the filter is supported */\n  supported: boolean;\n  /** Reason why filter is disabled (when not supported) */\n  disabledReason?: string;\n}\n\n/**\n * Quick filter state\n */\nexport interface QuickFilterState {\n  /** Currently active filter key (null if none) */\n  activeKey: string | null;\n  /** Filter capabilities */\n  capabilities: Map<string, QuickFilterCapability>;\n}\n\n/**\n * Quick filters configuration\n */\nexport interface QuickFiltersConfig {\n  /** Container element or selector */\n  container: HTMLElement | string;\n  /** Available filters */\n  filters: QuickFilter[];\n  /** Initial capabilities (optional) */\n  capabilities?: QuickFilterCapability[];\n  /** Callback when filter is selected */\n  onFilterSelect: (filter: QuickFilter | null) => void;\n  /** Additional CSS classes */\n  containerClass?: string;\n  /** Size variant */\n  size?: 'sm' | 'default';\n}\n\n// ============================================================================\n// Default Translation Quick Filters\n// ============================================================================\n\n/**\n * Default quick filters for translation readiness states\n */\nexport const DEFAULT_TRANSLATION_QUICK_FILTERS: QuickFilter[] = [\n  {\n    key: 'all',\n    label: 'All',\n    field: '',\n    value: '',\n    icon: '',\n    styleClass: 'bg-gray-100 text-gray-700 hover:bg-gray-200',\n    description: 'Show all records',\n  },\n  {\n    key: 'ready',\n    label: 'Ready',\n    field: 'readiness_state',\n    value: 'ready',\n    icon: '',\n    styleClass: 'bg-green-100 text-green-700 hover:bg-green-200',\n    description: 'All translations complete',\n  },\n  {\n    key: 'missing_locales',\n    label: 'Missing',\n    field: 'readiness_state',\n    value: 'missing_locales',\n    icon: '',\n    styleClass: 'bg-amber-100 text-amber-700 hover:bg-amber-200',\n    description: 'Missing required locale translations',\n  },\n  {\n    key: 'missing_fields',\n    label: 'Incomplete',\n    field: 'readiness_state',\n    value: 'missing_fields',\n    icon: '',\n    styleClass: 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200',\n    description: 'Has translations but missing required fields',\n  },\n  {\n    key: 'fallback',\n    label: 'Fallback',\n    field: 'fallback_used',\n    value: 'true',\n    icon: '',\n    styleClass: 'bg-orange-100 text-orange-700 hover:bg-orange-200',\n    description: 'Records currently viewed in fallback mode',\n  },\n];\n\n// ============================================================================\n// Quick Filters Component\n// ============================================================================\n\nexport class QuickFilters {\n  private container: HTMLElement | null = null;\n  private config: QuickFiltersConfig;\n  private state: QuickFilterState;\n\n  constructor(config: QuickFiltersConfig) {\n    this.config = config;\n\n    // Resolve container\n    this.container = typeof config.container === 'string'\n      ? document.querySelector<HTMLElement>(config.container)\n      : config.container;\n\n    // Initialize state\n    this.state = {\n      activeKey: null,\n      capabilities: new Map(),\n    };\n\n    // Apply initial capabilities\n    if (config.capabilities) {\n      for (const cap of config.capabilities) {\n        this.state.capabilities.set(cap.key, cap);\n      }\n    }\n\n    // Set defaults for filters without explicit capability\n    for (const filter of config.filters) {\n      if (!this.state.capabilities.has(filter.key)) {\n        this.state.capabilities.set(filter.key, { key: filter.key, supported: true });\n      }\n    }\n\n    this.render();\n  }\n\n  /**\n   * Render the quick filters\n   */\n  render(): void {\n    if (!this.container) {\n      console.warn('[QuickFilters] Container not found');\n      return;\n    }\n\n    const { size = 'default', containerClass = '' } = this.config;\n    const textSize = size === 'sm' ? 'text-xs' : 'text-sm';\n    const padding = size === 'sm' ? 'px-2 py-1' : 'px-3 py-1.5';\n\n    const filtersHtml = this.config.filters\n      .map((filter) => this.renderFilterButton(filter, textSize, padding))\n      .join('');\n\n    this.container.innerHTML = `\n      <div class=\"quick-filters inline-flex items-center gap-2 flex-wrap ${containerClass}\"\n           role=\"group\"\n           aria-label=\"Quick filters\">\n        ${filtersHtml}\n      </div>\n    `;\n\n    // Bind click handlers\n    this.bindEventListeners();\n  }\n\n  /**\n   * Render a single filter button\n   */\n  private renderFilterButton(filter: QuickFilter, textSize: string, padding: string): string {\n    const capability = this.state.capabilities.get(filter.key);\n    const isSupported = capability?.supported !== false;\n    const isActive = this.state.activeKey === filter.key;\n    const disabledReason = capability?.disabledReason || 'Filter not available';\n\n    const baseClasses = `inline-flex items-center gap-1 ${padding} ${textSize} rounded-full font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500`;\n\n    let stateClasses: string;\n    let ariaAttributes: string;\n\n    if (!isSupported) {\n      // Disabled state with visible reason\n      stateClasses = 'bg-gray-100 text-gray-400 cursor-not-allowed opacity-60';\n      ariaAttributes = `aria-disabled=\"true\" title=\"${escapeAttr(disabledReason)}\"`;\n    } else if (isActive) {\n      // Active state\n      stateClasses = `${filter.styleClass || 'bg-blue-100 text-blue-700'} ring-2 ring-offset-1 ring-blue-500`;\n      ariaAttributes = 'aria-pressed=\"true\"';\n    } else {\n      // Normal state\n      stateClasses = filter.styleClass || 'bg-gray-100 text-gray-700 hover:bg-gray-200';\n      ariaAttributes = 'aria-pressed=\"false\"';\n    }\n\n    const iconHtml = filter.icon\n      ? `<span aria-hidden=\"true\">${filter.icon}</span>`\n      : '';\n\n    return `\n      <button type=\"button\"\n              class=\"quick-filter-btn ${baseClasses} ${stateClasses}\"\n              data-filter-key=\"${escapeAttr(filter.key)}\"\n              ${ariaAttributes}\n              ${!isSupported ? 'disabled' : ''}>\n        ${iconHtml}\n        <span>${escapeHtml(filter.label)}</span>\n      </button>\n    `;\n  }\n\n  /**\n   * Bind event listeners to filter buttons\n   */\n  private bindEventListeners(): void {\n    if (!this.container) return;\n\n    const buttons = this.container.querySelectorAll<HTMLButtonElement>('.quick-filter-btn');\n    buttons.forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const key = btn.dataset.filterKey;\n        if (key && !btn.disabled) {\n          this.selectFilter(key);\n        }\n      });\n    });\n  }\n\n  /**\n   * Select a filter by key\n   */\n  selectFilter(key: string): void {\n    const filter = this.config.filters.find((f) => f.key === key);\n    if (!filter) {\n      console.warn(`[QuickFilters] Filter not found: ${key}`);\n      return;\n    }\n\n    const capability = this.state.capabilities.get(key);\n    if (capability?.supported === false) {\n      console.warn(`[QuickFilters] Filter not supported: ${key}`);\n      return;\n    }\n\n    // Toggle if same filter clicked\n    if (this.state.activeKey === key) {\n      this.clearFilter();\n      return;\n    }\n\n    this.state.activeKey = key;\n    this.render();\n\n    // Notify callback\n    if (filter.field === '') {\n      // \"All\" filter clears the filter\n      this.config.onFilterSelect(null);\n    } else {\n      this.config.onFilterSelect(filter);\n    }\n  }\n\n  /**\n   * Clear the active filter\n   */\n  clearFilter(): void {\n    this.state.activeKey = null;\n    this.render();\n    this.config.onFilterSelect(null);\n  }\n\n  /**\n   * Update filter capabilities\n   */\n  updateCapabilities(capabilities: QuickFilterCapability[]): void {\n    for (const cap of capabilities) {\n      this.state.capabilities.set(cap.key, cap);\n    }\n    this.render();\n  }\n\n  /**\n   * Set a specific capability\n   */\n  setCapability(key: string, supported: boolean, disabledReason?: string): void {\n    this.state.capabilities.set(key, { key, supported, disabledReason });\n    this.render();\n  }\n\n  /**\n   * Get current active filter\n   */\n  getActiveFilter(): QuickFilter | null {\n    if (!this.state.activeKey) return null;\n    return this.config.filters.find((f) => f.key === this.state.activeKey) || null;\n  }\n\n  /**\n   * Set active filter programmatically\n   */\n  setActiveFilter(key: string | null): void {\n    this.state.activeKey = key;\n    this.render();\n  }\n\n  /**\n   * Destroy the component\n   */\n  destroy(): void {\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.container = null;\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create quick filters for translation readiness\n */\nexport function createTranslationQuickFilters(\n  container: HTMLElement | string,\n  onFilterSelect: (filter: QuickFilter | null) => void,\n  options: {\n    capabilities?: QuickFilterCapability[];\n    size?: 'sm' | 'default';\n    containerClass?: string;\n  } = {}\n): QuickFilters {\n  return new QuickFilters({\n    container,\n    filters: DEFAULT_TRANSLATION_QUICK_FILTERS,\n    onFilterSelect,\n    ...options,\n  });\n}\n\n/**\n * Initialize quick filters on elements with data-quick-filters attribute\n */\nexport function initQuickFilters(\n  onFilterSelect: (filter: QuickFilter | null, container: HTMLElement) => void\n): QuickFilters[] {\n  const elements = document.querySelectorAll<HTMLElement>('[data-quick-filters]');\n  const instances: QuickFilters[] = [];\n\n  elements.forEach((el) => {\n    // Skip if already initialized\n    if (el.hasAttribute('data-quick-filters-init')) {\n      return;\n    }\n\n    const size = (el.dataset.size as 'sm' | 'default') || 'default';\n\n    const instance = createTranslationQuickFilters(\n      el,\n      (filter) => onFilterSelect(filter, el),\n      { size }\n    );\n\n    el.setAttribute('data-quick-filters-init', 'true');\n    instances.push(instance);\n  });\n\n  return instances;\n}\n\n/**\n * Render inline quick filters HTML for embedding in templates\n */\nexport function renderQuickFiltersHTML(options: {\n  filters?: QuickFilter[];\n  activeKey?: string | null;\n  capabilities?: QuickFilterCapability[];\n  size?: 'sm' | 'default';\n  containerClass?: string;\n} = {}): string {\n  const {\n    filters = DEFAULT_TRANSLATION_QUICK_FILTERS,\n    activeKey = null,\n    capabilities = [],\n    size = 'default',\n    containerClass = '',\n  } = options;\n\n  const textSize = size === 'sm' ? 'text-xs' : 'text-sm';\n  const padding = size === 'sm' ? 'px-2 py-1' : 'px-3 py-1.5';\n\n  const capMap = new Map<string, QuickFilterCapability>();\n  for (const cap of capabilities) {\n    capMap.set(cap.key, cap);\n  }\n\n  const filtersHtml = filters\n    .map((filter) => {\n      const capability = capMap.get(filter.key);\n      const isSupported = capability?.supported !== false;\n      const isActive = activeKey === filter.key;\n      const disabledReason = capability?.disabledReason || 'Filter not available';\n\n      const baseClasses = `inline-flex items-center gap-1 ${padding} ${textSize} rounded-full font-medium`;\n\n      let stateClasses: string;\n      if (!isSupported) {\n        stateClasses = 'bg-gray-100 text-gray-400 cursor-not-allowed opacity-60';\n      } else if (isActive) {\n        stateClasses = `${filter.styleClass || 'bg-blue-100 text-blue-700'} ring-2 ring-offset-1 ring-blue-500`;\n      } else {\n        stateClasses = filter.styleClass || 'bg-gray-100 text-gray-700';\n      }\n\n      const iconHtml = filter.icon ? `<span>${filter.icon}</span>` : '';\n      const titleAttr = !isSupported ? `title=\"${escapeAttr(disabledReason)}\"` : '';\n\n      return `<span class=\"${baseClasses} ${stateClasses}\" ${titleAttr}>${iconHtml}<span>${escapeHtml(filter.label)}</span></span>`;\n    })\n    .join('');\n\n  return `<div class=\"quick-filters inline-flex items-center gap-2 flex-wrap ${containerClass}\">${filtersHtml}</div>`;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction escapeAttr(str: string): string {\n  return escapeHtml(str);\n}\n","/**\n * Translation Bulk Actions (Phase 2)\n *\n * Provides bulk action handlers for translation operations:\n * - Create missing translations\n *\n * Contract:\n * - Uses typed per-item success/failure results from backend\n * - Shows deterministic result summary toast/report\n * - Refreshes affected rows after mutation\n */\n\nimport type { ToastNotifier } from '../toast/types.js';\nimport { FallbackNotifier } from '../toast/toast-manager.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Per-item result from bulk create-missing-translations\n */\nexport interface BulkCreateResult {\n  /** Source record ID */\n  id: string;\n  /** Target locale */\n  locale: string;\n  /** Whether creation succeeded */\n  success: boolean;\n  /** Error message if failed */\n  error?: string;\n  /** Created record ID if succeeded */\n  created_id?: string;\n}\n\n/**\n * Bulk create-missing-translations response\n */\nexport interface BulkCreateMissingResponse {\n  /** Whether overall operation completed */\n  success: boolean;\n  /** Per-item results */\n  data?: BulkCreateResult[];\n  /** Total items processed */\n  total?: number;\n  /** Count of successful creations */\n  created_count?: number;\n  /** Count of failed creations */\n  failed_count?: number;\n  /** Count of items skipped (already exist) */\n  skipped_count?: number;\n  /** Overall error message if failed */\n  error?: string;\n  /** Validation errors */\n  validation_errors?: Record<string, string>;\n}\n\n/**\n * Summary for display\n */\nexport interface BulkActionSummary {\n  /** Total items processed */\n  total: number;\n  /** Successfully created */\n  created: number;\n  /** Failed */\n  failed: number;\n  /** Skipped (already exist) */\n  skipped: number;\n  /** Failure details (limited) */\n  failures: { id: string; locale: string; error: string }[];\n}\n\n/**\n * Configuration for bulk create-missing action\n */\nexport interface BulkCreateMissingConfig {\n  /** API endpoint */\n  apiEndpoint: string;\n  /** Toast notifier */\n  notifier?: ToastNotifier;\n  /** Callback after successful operation */\n  onSuccess?: (summary: BulkActionSummary) => void;\n  /** Callback on error */\n  onError?: (error: Error) => void;\n  /** Max failures to show in summary */\n  maxFailuresToShow?: number;\n}\n\n// ============================================================================\n// Bulk Create Missing Translations Handler\n// ============================================================================\n\n/**\n * Execute bulk create-missing-translations action.\n *\n * @param config - Action configuration\n * @param recordIds - IDs of records to create missing translations for\n * @param options - Optional action parameters\n * @returns Summary of the operation\n */\nexport async function executeBulkCreateMissing(\n  config: BulkCreateMissingConfig,\n  recordIds: string[],\n  options: { locales?: string[] } = {}\n): Promise<BulkActionSummary> {\n  const { apiEndpoint, notifier = new FallbackNotifier(), maxFailuresToShow = 5 } = config;\n\n  const endpoint = `${apiEndpoint}/bulk/create-missing-translations`;\n\n  try {\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n      },\n      body: JSON.stringify({\n        ids: recordIds,\n        locales: options.locales,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorBody = await response.text();\n      let errorMessage = `Request failed: ${response.status}`;\n\n      try {\n        const errorJson = JSON.parse(errorBody);\n        errorMessage = errorJson.error || errorJson.message || errorMessage;\n      } catch {\n        // Use text error\n        if (errorBody) {\n          errorMessage = errorBody;\n        }\n      }\n\n      throw new Error(errorMessage);\n    }\n\n    const data: BulkCreateMissingResponse = await response.json();\n\n    // Parse response into summary\n    const summary = parseBulkResponse(data, maxFailuresToShow);\n\n    // Show result toast\n    showResultToast(summary, notifier);\n\n    // Call success callback\n    if (config.onSuccess) {\n      config.onSuccess(summary);\n    }\n\n    return summary;\n  } catch (error) {\n    const err = error instanceof Error ? error : new Error(String(error));\n\n    notifier.error(`Failed to create translations: ${err.message}`);\n\n    if (config.onError) {\n      config.onError(err);\n    }\n\n    throw err;\n  }\n}\n\n/**\n * Parse bulk response into summary\n */\nfunction parseBulkResponse(\n  response: BulkCreateMissingResponse,\n  maxFailures: number\n): BulkActionSummary {\n  const results = response.data || [];\n\n  const created = response.created_count ?? results.filter((r) => r.success).length;\n  const failed = response.failed_count ?? results.filter((r) => !r.success).length;\n  const skipped = response.skipped_count ?? 0;\n  const total = response.total ?? results.length;\n\n  // Collect failure details (limited)\n  const failures = results\n    .filter((r) => !r.success && r.error)\n    .slice(0, maxFailures)\n    .map((r) => ({\n      id: r.id,\n      locale: r.locale,\n      error: r.error || 'Unknown error',\n    }));\n\n  return {\n    total,\n    created,\n    failed,\n    skipped,\n    failures,\n  };\n}\n\n/**\n * Show result toast based on summary\n */\nfunction showResultToast(summary: BulkActionSummary, notifier: ToastNotifier): void {\n  const { created, failed, skipped, total } = summary;\n\n  if (total === 0) {\n    notifier.info('No translations to create');\n    return;\n  }\n\n  if (failed === 0) {\n    // All successful\n    if (created > 0) {\n      notifier.success(`Created ${created} translation${created !== 1 ? 's' : ''}${skipped > 0 ? ` (${skipped} skipped)` : ''}`);\n    } else if (skipped > 0) {\n      notifier.info(`All ${skipped} translation${skipped !== 1 ? 's' : ''} already exist`);\n    }\n  } else if (created === 0) {\n    // All failed\n    notifier.error(`Failed to create ${failed} translation${failed !== 1 ? 's' : ''}`);\n  } else {\n    // Partial success\n    notifier.warning(\n      `Created ${created}, failed ${failed}${skipped > 0 ? `, skipped ${skipped}` : ''}`\n    );\n  }\n}\n\n// ============================================================================\n// Result Summary Rendering\n// ============================================================================\n\n/**\n * Render detailed result summary HTML for modal or report\n */\nexport function renderBulkResultSummary(summary: BulkActionSummary): string {\n  const { created, failed, skipped, total, failures } = summary;\n\n  // Overall stats\n  const statsHtml = `\n    <div class=\"grid grid-cols-3 gap-4 mb-4\">\n      <div class=\"text-center p-3 bg-green-50 rounded\">\n        <div class=\"text-2xl font-bold text-green-700\">${created}</div>\n        <div class=\"text-sm text-green-600\">Created</div>\n      </div>\n      <div class=\"text-center p-3 ${failed > 0 ? 'bg-red-50' : 'bg-gray-50'} rounded\">\n        <div class=\"text-2xl font-bold ${failed > 0 ? 'text-red-700' : 'text-gray-400'}\">${failed}</div>\n        <div class=\"text-sm ${failed > 0 ? 'text-red-600' : 'text-gray-500'}\">Failed</div>\n      </div>\n      <div class=\"text-center p-3 ${skipped > 0 ? 'bg-yellow-50' : 'bg-gray-50'} rounded\">\n        <div class=\"text-2xl font-bold ${skipped > 0 ? 'text-yellow-700' : 'text-gray-400'}\">${skipped}</div>\n        <div class=\"text-sm ${skipped > 0 ? 'text-yellow-600' : 'text-gray-500'}\">Skipped</div>\n      </div>\n    </div>\n  `;\n\n  // Failure details\n  let failuresHtml = '';\n  if (failures.length > 0) {\n    const failureRows = failures\n      .map(\n        (f) => `\n        <tr>\n          <td class=\"px-3 py-2 text-sm text-gray-700\">${escapeHtml(f.id)}</td>\n          <td class=\"px-3 py-2 text-sm text-gray-700\">${escapeHtml(f.locale)}</td>\n          <td class=\"px-3 py-2 text-sm text-red-600\">${escapeHtml(f.error)}</td>\n        </tr>\n      `\n      )\n      .join('');\n\n    failuresHtml = `\n      <div class=\"mt-4\">\n        <h4 class=\"text-sm font-medium text-gray-700 mb-2\">Failure Details</h4>\n        <div class=\"border rounded overflow-hidden\">\n          <table class=\"min-w-full divide-y divide-gray-200\">\n            <thead class=\"bg-gray-50\">\n              <tr>\n                <th class=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">ID</th>\n                <th class=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Locale</th>\n                <th class=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Error</th>\n              </tr>\n            </thead>\n            <tbody class=\"bg-white divide-y divide-gray-200\">\n              ${failureRows}\n            </tbody>\n          </table>\n        </div>\n        ${failed > failures.length ? `<p class=\"mt-2 text-sm text-gray-500\">Showing ${failures.length} of ${failed} failures</p>` : ''}\n      </div>\n    `;\n  }\n\n  return `\n    <div class=\"bulk-result-summary\">\n      <div class=\"mb-4 text-sm text-gray-600\">\n        Processed ${total} item${total !== 1 ? 's' : ''}\n      </div>\n      ${statsHtml}\n      ${failuresHtml}\n    </div>\n  `;\n}\n\n/**\n * Render compact inline summary for list view\n */\nexport function renderBulkResultInline(summary: BulkActionSummary): string {\n  const { created, failed, skipped } = summary;\n\n  const parts: string[] = [];\n\n  if (created > 0) {\n    parts.push(`<span class=\"text-green-600\">+${created}</span>`);\n  }\n  if (failed > 0) {\n    parts.push(`<span class=\"text-red-600\">${failed} failed</span>`);\n  }\n  if (skipped > 0) {\n    parts.push(`<span class=\"text-yellow-600\">${skipped} skipped</span>`);\n  }\n\n  return parts.join('  ');\n}\n\n// ============================================================================\n// Action Builder Integration\n// ============================================================================\n\n/**\n * Create a bulk action handler for create-missing-translations\n * that can be passed to DataGrid configuration.\n */\nexport function createBulkCreateMissingHandler(\n  apiEndpoint: string,\n  notifier?: ToastNotifier,\n  onComplete?: (summary: BulkActionSummary) => void\n): (ids: string[]) => Promise<BulkActionSummary> {\n  return async (ids: string[]) => {\n    return executeBulkCreateMissing(\n      {\n        apiEndpoint,\n        notifier,\n        onSuccess: onComplete,\n      },\n      ids\n    );\n  };\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n","/**\n * Shared Locale Action Component\n *\n * Reusable UI component for locale-level actions (Create/Open translation).\n * Used across fallback banner, blocker modal, and inline missing-locale affordances.\n *\n * Design decisions (per TRANSLATION_UX_IMPL.md):\n * - Single component for create/open actions ensures consistent UX\n * - Loading/success/error states handled uniformly\n * - Accessible with keyboard navigation and screen-reader labels\n */\n\nimport { executeActionRequest } from '../toast/error-helpers.js';\nimport { escapeHtml } from '../shared/modal.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for a locale action chip\n */\nexport interface LocaleActionConfig {\n  /** The locale code (e.g., 'es', 'fr') */\n  locale: string;\n  /** The record ID for actions */\n  recordId: string;\n  /** API endpoint for panel actions (e.g., /admin/api/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Current environment context */\n  environment?: string;\n  /** Whether the locale exists (for existing locales, only show open action) */\n  localeExists?: boolean;\n  /** Display size variant */\n  size?: 'sm' | 'md';\n  /** Display mode: 'chip' for inline, 'button' for prominent */\n  mode?: 'chip' | 'button';\n  /** Callback after successful create action */\n  onCreateSuccess?: (locale: string, result: CreateActionResult) => void;\n  /** Callback after action error */\n  onError?: (locale: string, message: string) => void;\n  /** Callback after open action triggered */\n  onOpen?: (locale: string, url: string) => void;\n}\n\n/**\n * Result from create_translation action\n */\nexport interface CreateActionResult {\n  id: string;\n  locale: string;\n  status: string;\n  translationGroupId?: string;\n}\n\n/**\n * State for a locale action component\n */\nexport interface LocaleActionState {\n  loading: boolean;\n  created: boolean;\n  error: string | null;\n  newRecordId?: string;\n}\n\n// ============================================================================\n// Locale Label Mapping\n// ============================================================================\n\nconst LOCALE_LABELS: Record<string, string> = {\n  en: 'English',\n  es: 'Spanish',\n  fr: 'French',\n  de: 'German',\n  it: 'Italian',\n  pt: 'Portuguese',\n  ja: 'Japanese',\n  ko: 'Korean',\n  zh: 'Chinese',\n  ar: 'Arabic',\n  ru: 'Russian',\n  nl: 'Dutch',\n  pl: 'Polish',\n  sv: 'Swedish',\n  da: 'Danish',\n  no: 'Norwegian',\n  fi: 'Finnish',\n};\n\n/**\n * Get human-readable label for a locale code.\n */\nexport function getLocaleLabel(locale: string): string {\n  const normalized = locale.toLowerCase();\n  return LOCALE_LABELS[normalized] || locale.toUpperCase();\n}\n\n// ============================================================================\n// Locale Action Component\n// ============================================================================\n\n/**\n * LocaleActionChip renders a locale chip with create/open actions.\n * Manages its own state and can be used standalone or in a list.\n */\nexport class LocaleActionChip {\n  private config: LocaleActionConfig;\n  private state: LocaleActionState;\n  private element: HTMLElement | null = null;\n\n  constructor(config: LocaleActionConfig) {\n    this.config = {\n      size: 'sm',\n      mode: 'chip',\n      localeExists: false,\n      ...config,\n    };\n    this.state = {\n      loading: false,\n      created: false,\n      error: null,\n    };\n  }\n\n  /**\n   * Render the locale action chip as HTML string.\n   * Use when generating static HTML.\n   */\n  render(): string {\n    const { locale, size, mode, localeExists } = this.config;\n    const { loading, created, error } = this.state;\n\n    const localeLabel = getLocaleLabel(locale);\n    const sizeClasses = size === 'sm'\n      ? 'text-xs px-2 py-1'\n      : 'text-sm px-3 py-1.5';\n\n    // Determine base styling based on mode\n    const modeClasses = mode === 'button'\n      ? 'rounded-lg'\n      : 'rounded-full';\n\n    // Determine state-based styling\n    let stateClasses: string;\n    let statusIcon = '';\n\n    if (loading) {\n      stateClasses = 'bg-gray-100 text-gray-600 border-gray-300';\n      statusIcon = this.renderSpinner();\n    } else if (created) {\n      stateClasses = 'bg-green-100 text-green-700 border-green-300';\n      statusIcon = this.renderCheckIcon();\n    } else if (error) {\n      stateClasses = 'bg-red-100 text-red-700 border-red-300';\n      statusIcon = this.renderErrorIcon();\n    } else if (localeExists) {\n      stateClasses = 'bg-blue-100 text-blue-700 border-blue-300';\n    } else {\n      stateClasses = 'bg-amber-100 text-amber-700 border-amber-300';\n    }\n\n    const actionsHtml = this.renderActions();\n\n    return `\n      <div class=\"inline-flex items-center gap-1.5 ${sizeClasses} ${modeClasses} border ${stateClasses}\"\n           data-locale-action=\"${escapeHtml(locale)}\"\n           data-locale-exists=\"${localeExists}\"\n           data-loading=\"${loading}\"\n           data-created=\"${created}\"\n           role=\"group\"\n           aria-label=\"${localeLabel} translation\">\n        ${statusIcon}\n        <span class=\"font-medium uppercase tracking-wide\" aria-hidden=\"true\">${escapeHtml(locale)}</span>\n        <span class=\"sr-only\">${localeLabel}</span>\n        ${actionsHtml}\n      </div>\n    `;\n  }\n\n  /**\n   * Render action buttons (create/open).\n   */\n  private renderActions(): string {\n    const { locale, localeExists, size } = this.config;\n    const { loading, created } = this.state;\n\n    const buttonSize = size === 'sm' ? 'p-0.5' : 'p-1';\n    const iconSize = size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n\n    const actions: string[] = [];\n\n    // Create button (only for missing locales that haven't been created)\n    if (!localeExists && !created && !loading) {\n      actions.push(`\n        <button type=\"button\"\n                class=\"inline-flex items-center justify-center ${buttonSize} rounded hover:bg-amber-200 focus:outline-none focus:ring-1 focus:ring-amber-500 transition-colors\"\n                data-action=\"create\"\n                data-locale=\"${escapeHtml(locale)}\"\n                aria-label=\"Create ${getLocaleLabel(locale)} translation\"\n                title=\"Create ${getLocaleLabel(locale)} translation\">\n          <svg class=\"${iconSize}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n        </button>\n      `);\n    }\n\n    // Open button (for existing locales or newly created ones)\n    if (localeExists || created) {\n      const openBgClass = created ? 'hover:bg-green-200' : 'hover:bg-blue-200';\n      const openRingClass = created ? 'focus:ring-green-500' : 'focus:ring-blue-500';\n      actions.push(`\n        <button type=\"button\"\n                class=\"inline-flex items-center justify-center ${buttonSize} rounded ${openBgClass} focus:outline-none focus:ring-1 ${openRingClass} transition-colors\"\n                data-action=\"open\"\n                data-locale=\"${escapeHtml(locale)}\"\n                aria-label=\"Open ${getLocaleLabel(locale)} translation\"\n                title=\"Open ${getLocaleLabel(locale)} translation\">\n          <svg class=\"${iconSize}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n          </svg>\n        </button>\n      `);\n    }\n\n    return actions.join('');\n  }\n\n  /**\n   * Mount the component to a container element and bind events.\n   */\n  mount(container: HTMLElement): void {\n    container.innerHTML = this.render();\n    this.element = container.querySelector(`[data-locale-action=\"${this.config.locale}\"]`);\n    this.bindEvents();\n  }\n\n  /**\n   * Bind event handlers to action buttons.\n   */\n  private bindEvents(): void {\n    if (!this.element) return;\n\n    const createBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"create\"]');\n    const openBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"open\"]');\n\n    createBtn?.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.handleCreate();\n    });\n\n    openBtn?.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.handleOpen();\n    });\n  }\n\n  /**\n   * Handle create translation action.\n   */\n  async handleCreate(): Promise<void> {\n    if (this.state.loading || this.state.created) return;\n\n    this.setState({ loading: true, error: null });\n\n    try {\n      const payload: Record<string, unknown> = {\n        id: this.config.recordId,\n        locale: this.config.locale,\n      };\n\n      if (this.config.environment) {\n        payload.environment = this.config.environment;\n      }\n      if (this.config.panelName) {\n        payload.policy_entity = this.config.panelName;\n      }\n\n      const endpoint = `${this.config.apiEndpoint}/actions/create_translation`;\n      const result = await executeActionRequest(endpoint, payload);\n\n      if (result.success) {\n        const newId = result.data?.id ? String(result.data.id) : undefined;\n        this.setState({\n          loading: false,\n          created: true,\n          newRecordId: newId,\n        });\n\n        const createResult: CreateActionResult = {\n          id: newId || this.config.recordId,\n          locale: this.config.locale,\n          status: String(result.data?.status || 'draft'),\n          translationGroupId: result.data?.translation_group_id\n            ? String(result.data.translation_group_id)\n            : undefined,\n        };\n\n        this.config.onCreateSuccess?.(this.config.locale, createResult);\n      } else {\n        const errorMessage = result.error?.message || 'Failed to create translation';\n        this.setState({ loading: false, error: errorMessage });\n        this.config.onError?.(this.config.locale, errorMessage);\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to create translation';\n      this.setState({ loading: false, error: errorMessage });\n      this.config.onError?.(this.config.locale, errorMessage);\n    }\n  }\n\n  /**\n   * Handle open translation action.\n   */\n  handleOpen(): void {\n    const { locale, navigationBasePath, recordId, environment } = this.config;\n    const { newRecordId } = this.state;\n\n    const targetId = newRecordId || recordId;\n    const params = new URLSearchParams();\n    params.set('locale', locale);\n    if (environment) {\n      params.set('env', environment);\n    }\n\n    const url = `${navigationBasePath}/${targetId}/edit?${params.toString()}`;\n    this.config.onOpen?.(locale, url);\n\n    // Default behavior: navigate to the URL\n    window.location.href = url;\n  }\n\n  /**\n   * Update component state and re-render.\n   */\n  private setState(updates: Partial<LocaleActionState>): void {\n    this.state = { ...this.state, ...updates };\n    if (this.element) {\n      const parent = this.element.parentElement;\n      if (parent) {\n        this.mount(parent);\n      }\n    }\n  }\n\n  /**\n   * Render spinner icon for loading state.\n   */\n  private renderSpinner(): string {\n    const size = this.config.size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n    return `\n      <svg class=\"${size} animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n        <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"/>\n        <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Render check icon for success state.\n   */\n  private renderCheckIcon(): string {\n    const size = this.config.size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n    return `\n      <svg class=\"${size}\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n        <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Render error icon for error state.\n   */\n  private renderErrorIcon(): string {\n    const size = this.config.size === 'sm' ? 'w-3 h-3' : 'w-4 h-4';\n    return `\n      <svg class=\"${size}\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n        <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Get current state (for testing/inspection).\n   */\n  getState(): LocaleActionState {\n    return { ...this.state };\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Render a static locale action chip as HTML.\n * Use for server-side or initial render scenarios.\n */\nexport function renderLocaleActionChip(config: LocaleActionConfig): string {\n  const chip = new LocaleActionChip(config);\n  return chip.render();\n}\n\n/**\n * Render a list of locale action chips.\n * Useful for rendering multiple missing locales at once.\n */\nexport function renderLocaleActionList(\n  locales: string[],\n  baseConfig: Omit<LocaleActionConfig, 'locale'>\n): string {\n  if (locales.length === 0) return '';\n\n  const chips = locales.map((locale) => {\n    const config: LocaleActionConfig = { ...baseConfig, locale };\n    return renderLocaleActionChip(config);\n  });\n\n  return `\n    <div class=\"flex flex-wrap items-center gap-2\" role=\"list\" aria-label=\"Missing translations\">\n      ${chips.join('')}\n    </div>\n  `;\n}\n\n/**\n * Initialize locale action chips within a container.\n * Binds event handlers to all chips matching the selector.\n */\nexport function initLocaleActionChips(\n  container: HTMLElement,\n  baseConfig: Omit<LocaleActionConfig, 'locale'>\n): Map<string, LocaleActionChip> {\n  const chips = new Map<string, LocaleActionChip>();\n  const elements = container.querySelectorAll<HTMLElement>('[data-locale-action]');\n\n  elements.forEach((element) => {\n    const locale = element.getAttribute('data-locale-action');\n    if (!locale) return;\n\n    const localeExists = element.getAttribute('data-locale-exists') === 'true';\n    const config: LocaleActionConfig = { ...baseConfig, locale, localeExists };\n    const chip = new LocaleActionChip(config);\n\n    // Re-mount to bind events\n    const parent = element.parentElement;\n    if (parent) {\n      chip.mount(parent);\n      chips.set(locale, chip);\n    }\n  });\n\n  return chips;\n}\n\n/**\n * Build URL for editing a specific locale of a record.\n */\nexport function buildLocaleEditUrl(\n  basePath: string,\n  recordId: string,\n  locale: string,\n  environment?: string\n): string {\n  const params = new URLSearchParams();\n  params.set('locale', locale);\n  if (environment) {\n    params.set('env', environment);\n  }\n  return `${basePath}/${recordId}/edit?${params.toString()}`;\n}\n","/**\n * Fallback Banner Component\n *\n * Renders a warning banner when content is displayed in fallback mode\n * (requested locale doesn't exist, showing fallback/source locale instead).\n * Includes form lock behavior to prevent editing fallback content.\n *\n * Design decisions (per TRANSLATION_UX_IMPL.md Section 8.1):\n * - Banner is explicit and non-dismissible in fallback mode\n * - Form is locked (non-editable) until user creates missing translation\n * - Primary CTA: Create requested locale\n * - Secondary CTA: Open resolved/source locale\n */\n\nimport { escapeHtml } from '../shared/modal.js';\nimport {\n  LocaleActionChip,\n  getLocaleLabel,\n  buildLocaleEditUrl,\n  type CreateActionResult,\n} from './locale-action.js';\nimport { extractTranslationContext, type TranslationContext } from './translation-context.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for the fallback banner\n */\nexport interface FallbackBannerConfig {\n  /** Translation context extracted from the record */\n  context: TranslationContext;\n  /** API endpoint for panel actions (e.g., /admin/api/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Current environment context */\n  environment?: string;\n  /** Callback after successful create action */\n  onCreateSuccess?: (locale: string, result: CreateActionResult) => void;\n  /** Callback after action error */\n  onError?: (message: string) => void;\n  /** Callback when open source action is triggered */\n  onOpenSource?: (locale: string, url: string) => void;\n  /** Whether to show the form lock message */\n  showFormLockMessage?: boolean;\n  /** Custom form lock message */\n  formLockMessage?: string;\n}\n\n/**\n * Form lock state\n */\nexport interface FormLockState {\n  /** Whether the form is locked */\n  locked: boolean;\n  /** The reason the form is locked */\n  reason: string | null;\n  /** The locale that was requested but missing */\n  missingLocale: string | null;\n  /** The locale being shown as fallback */\n  fallbackLocale: string | null;\n}\n\n// ============================================================================\n// Fallback Banner Component\n// ============================================================================\n\n/**\n * FallbackBanner renders a warning banner with actions for fallback mode.\n * Manages form lock state and provides CTA buttons.\n */\nexport class FallbackBanner {\n  private config: FallbackBannerConfig;\n  private element: HTMLElement | null = null;\n  private localeChip: LocaleActionChip | null = null;\n\n  constructor(config: FallbackBannerConfig) {\n    this.config = {\n      showFormLockMessage: true,\n      ...config,\n    };\n  }\n\n  /**\n   * Check if fallback mode is active.\n   */\n  isInFallbackMode(): boolean {\n    const { context } = this.config;\n    return context.fallbackUsed || context.missingRequestedLocale;\n  }\n\n  /**\n   * Get form lock state.\n   */\n  getFormLockState(): FormLockState {\n    const { context } = this.config;\n\n    if (!this.isInFallbackMode()) {\n      return {\n        locked: false,\n        reason: null,\n        missingLocale: null,\n        fallbackLocale: null,\n      };\n    }\n\n    return {\n      locked: true,\n      reason: this.config.formLockMessage ||\n        `The ${context.requestedLocale?.toUpperCase() || 'requested'} translation doesn't exist. Create it to enable editing.`,\n      missingLocale: context.requestedLocale,\n      fallbackLocale: context.resolvedLocale,\n    };\n  }\n\n  /**\n   * Render the fallback banner as HTML string.\n   */\n  render(): string {\n    if (!this.isInFallbackMode()) {\n      return '';\n    }\n\n    const { context, showFormLockMessage } = this.config;\n    const requestedLocale = context.requestedLocale || 'requested';\n    const resolvedLocale = context.resolvedLocale || 'default';\n    const requestedLabel = getLocaleLabel(requestedLocale);\n    const resolvedLabel = getLocaleLabel(resolvedLocale);\n\n    // Build locale action chip for primary CTA\n    const primaryCtaHtml = this.renderPrimaryCta();\n    const secondaryCtaHtml = this.renderSecondaryCta();\n    const formLockHtml = showFormLockMessage ? this.renderFormLockMessage() : '';\n\n    return `\n      <div class=\"fallback-banner bg-amber-50 border border-amber-200 rounded-lg shadow-sm\"\n           role=\"alert\"\n           aria-live=\"polite\"\n           data-fallback-banner=\"true\"\n           data-requested-locale=\"${escapeHtml(requestedLocale)}\"\n           data-resolved-locale=\"${escapeHtml(resolvedLocale)}\">\n        <div class=\"p-4\">\n          <div class=\"flex items-start gap-3\">\n            <!-- Warning Icon -->\n            <div class=\"flex-shrink-0 mt-0.5\">\n              <svg class=\"w-5 h-5 text-amber-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n                <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n              </svg>\n            </div>\n\n            <!-- Content -->\n            <div class=\"flex-1 min-w-0\">\n              <h3 class=\"text-sm font-semibold text-amber-800\">\n                Viewing fallback content\n              </h3>\n              <p class=\"mt-1 text-sm text-amber-700\">\n                The <strong class=\"font-medium\">${escapeHtml(requestedLabel)}</strong> (${escapeHtml(requestedLocale.toUpperCase())})\n                translation doesn't exist yet. You're viewing content from\n                <strong class=\"font-medium\">${escapeHtml(resolvedLabel)}</strong> (${escapeHtml(resolvedLocale.toUpperCase())}).\n              </p>\n\n              ${formLockHtml}\n\n              <!-- Actions -->\n              <div class=\"mt-4 flex flex-wrap items-center gap-3\">\n                ${primaryCtaHtml}\n                ${secondaryCtaHtml}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render the primary CTA (Create missing locale).\n   */\n  private renderPrimaryCta(): string {\n    const { context, apiEndpoint, navigationBasePath, panelName, environment } = this.config;\n    const requestedLocale = context.requestedLocale;\n\n    if (!requestedLocale || !context.recordId) {\n      return '';\n    }\n\n    return `\n      <button type=\"button\"\n              class=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-amber-600 rounded-lg hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors\"\n              data-action=\"create-translation\"\n              data-locale=\"${escapeHtml(requestedLocale)}\"\n              data-record-id=\"${escapeHtml(context.recordId)}\"\n              data-api-endpoint=\"${escapeHtml(apiEndpoint)}\"\n              data-panel=\"${escapeHtml(panelName || '')}\"\n              data-environment=\"${escapeHtml(environment || '')}\"\n              aria-label=\"Create ${getLocaleLabel(requestedLocale)} translation\">\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n        </svg>\n        Create ${escapeHtml(requestedLocale.toUpperCase())} translation\n      </button>\n    `;\n  }\n\n  /**\n   * Render the secondary CTA (Open source locale).\n   */\n  private renderSecondaryCta(): string {\n    const { context, navigationBasePath, environment } = this.config;\n    const resolvedLocale = context.resolvedLocale;\n\n    if (!resolvedLocale || !context.recordId) {\n      return '';\n    }\n\n    const url = buildLocaleEditUrl(navigationBasePath, context.recordId, resolvedLocale, environment);\n\n    return `\n      <a href=\"${escapeHtml(url)}\"\n         class=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 bg-white border border-amber-300 rounded-lg hover:bg-amber-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors\"\n         data-action=\"open-source\"\n         data-locale=\"${escapeHtml(resolvedLocale)}\"\n         aria-label=\"Open ${getLocaleLabel(resolvedLocale)} translation\">\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/>\n        </svg>\n        Open ${escapeHtml(resolvedLocale.toUpperCase())} (source)\n      </a>\n    `;\n  }\n\n  /**\n   * Render the form lock message.\n   */\n  private renderFormLockMessage(): string {\n    return `\n      <p class=\"mt-2 text-sm text-amber-600 flex items-center gap-1.5\">\n        <svg class=\"w-4 h-4 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n          <path fill-rule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clip-rule=\"evenodd\"/>\n        </svg>\n        <span>Editing is disabled until you create the missing translation.</span>\n      </p>\n    `;\n  }\n\n  /**\n   * Mount the banner to a container and bind events.\n   */\n  mount(container: HTMLElement): void {\n    container.innerHTML = this.render();\n    this.element = container.querySelector('[data-fallback-banner]');\n    this.bindEvents();\n  }\n\n  /**\n   * Bind event handlers.\n   */\n  private bindEvents(): void {\n    if (!this.element) return;\n\n    const createBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"create-translation\"]');\n    const openBtn = this.element.querySelector<HTMLAnchorElement>('[data-action=\"open-source\"]');\n\n    createBtn?.addEventListener('click', async (e) => {\n      e.preventDefault();\n      await this.handleCreate();\n    });\n\n    openBtn?.addEventListener('click', (e) => {\n      const locale = openBtn.getAttribute('data-locale');\n      const url = openBtn.getAttribute('href');\n      if (locale && url) {\n        this.config.onOpenSource?.(locale, url);\n      }\n      // Let the default navigation happen unless prevented\n    });\n  }\n\n  /**\n   * Handle create translation action.\n   */\n  private async handleCreate(): Promise<void> {\n    const { context, apiEndpoint, panelName, environment, navigationBasePath } = this.config;\n    const locale = context.requestedLocale;\n    const recordId = context.recordId;\n\n    if (!locale || !recordId) return;\n\n    // Create locale action chip for handling the create action\n    const chip = new LocaleActionChip({\n      locale,\n      recordId,\n      apiEndpoint,\n      navigationBasePath,\n      panelName,\n      environment,\n      localeExists: false,\n      onCreateSuccess: (loc, result) => {\n        this.config.onCreateSuccess?.(loc, result);\n        // Redirect to edit the new translation\n        const url = buildLocaleEditUrl(navigationBasePath, result.id, loc, environment);\n        window.location.href = url;\n      },\n      onError: (_loc, message) => {\n        this.config.onError?.(message);\n      },\n    });\n\n    await chip.handleCreate();\n  }\n}\n\n// ============================================================================\n// Form Lock Helpers\n// ============================================================================\n\n/**\n * Apply form lock to a form element based on fallback state.\n * Disables all form inputs and adds visual indicators.\n */\nexport function applyFormLock(form: HTMLFormElement, lockState: FormLockState): void {\n  if (!lockState.locked) {\n    removeFormLock(form);\n    return;\n  }\n\n  // Add locked class for styling\n  form.classList.add('form-locked', 'pointer-events-none', 'opacity-75');\n  form.setAttribute('data-form-locked', 'true');\n  form.setAttribute('data-lock-reason', lockState.reason || '');\n\n  // Disable all form elements\n  const inputs = form.querySelectorAll<HTMLElement>('input, textarea, select, button[type=\"submit\"]');\n  inputs.forEach((input) => {\n    input.setAttribute('disabled', 'true');\n    input.setAttribute('data-was-enabled', 'true');\n    input.setAttribute('aria-disabled', 'true');\n  });\n\n  // Add lock overlay if not present\n  if (!form.querySelector('[data-form-lock-overlay]')) {\n    const overlay = document.createElement('div');\n    overlay.setAttribute('data-form-lock-overlay', 'true');\n    overlay.className = 'absolute inset-0 bg-amber-50/30 cursor-not-allowed z-10';\n    overlay.setAttribute('title', lockState.reason || 'Form is locked');\n\n    // Ensure form has relative positioning\n    const computedStyle = window.getComputedStyle(form);\n    if (computedStyle.position === 'static') {\n      form.style.position = 'relative';\n    }\n\n    form.appendChild(overlay);\n  }\n}\n\n/**\n * Remove form lock from a form element.\n */\nexport function removeFormLock(form: HTMLFormElement): void {\n  form.classList.remove('form-locked', 'pointer-events-none', 'opacity-75');\n  form.removeAttribute('data-form-locked');\n  form.removeAttribute('data-lock-reason');\n\n  // Re-enable previously enabled form elements\n  const inputs = form.querySelectorAll<HTMLElement>('[data-was-enabled=\"true\"]');\n  inputs.forEach((input) => {\n    input.removeAttribute('disabled');\n    input.removeAttribute('data-was-enabled');\n    input.removeAttribute('aria-disabled');\n  });\n\n  // Remove lock overlay\n  const overlay = form.querySelector('[data-form-lock-overlay]');\n  overlay?.remove();\n}\n\n/**\n * Check if a form is locked.\n */\nexport function isFormLocked(form: HTMLFormElement): boolean {\n  return form.getAttribute('data-form-locked') === 'true';\n}\n\n/**\n * Get form lock reason.\n */\nexport function getFormLockReason(form: HTMLFormElement): string | null {\n  return form.getAttribute('data-lock-reason');\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Render fallback banner from a record payload.\n */\nexport function renderFallbackBannerFromRecord(\n  record: Record<string, unknown>,\n  config: Omit<FallbackBannerConfig, 'context'>\n): string {\n  const context = extractTranslationContext(record);\n  const banner = new FallbackBanner({ ...config, context });\n  return banner.render();\n}\n\n/**\n * Check if a record is in fallback mode and should show banner.\n */\nexport function shouldShowFallbackBanner(record: Record<string, unknown>): boolean {\n  const context = extractTranslationContext(record);\n  return context.fallbackUsed || context.missingRequestedLocale;\n}\n\n/**\n * Initialize fallback banner in a container with event handling.\n */\nexport function initFallbackBanner(\n  container: HTMLElement,\n  config: FallbackBannerConfig\n): FallbackBanner {\n  const banner = new FallbackBanner(config);\n  banner.mount(container);\n  return banner;\n}\n\n/**\n * Initialize form lock based on translation context.\n * Returns the form lock state.\n */\nexport function initFormLock(\n  form: HTMLFormElement,\n  record: Record<string, unknown>\n): FormLockState {\n  const context = extractTranslationContext(record);\n  const banner = new FallbackBanner({\n    context,\n    apiEndpoint: '',\n    navigationBasePath: '',\n  });\n\n  const lockState = banner.getFormLockState();\n  applyFormLock(form, lockState);\n\n  return lockState;\n}\n","/**\n * Inline Missing Locale Chips Component\n *\n * Renders actionable locale chips inline with content rows for creating\n * missing translations directly from list/grid views.\n *\n * Design decisions (per TRANSLATION_UX_IMPL.md Section 8.2):\n * - Chips appear inline with rows that have missing required locales\n * - Create action is gated by _action_state for the create_translation action\n * - Uses shared LocaleActionChip component for consistent UX\n */\n\nimport { escapeHtml } from '../shared/modal.js';\nimport {\n  LocaleActionChip,\n  getLocaleLabel,\n  renderLocaleActionChip,\n  type LocaleActionConfig,\n  type CreateActionResult,\n} from './locale-action.js';\nimport {\n  extractTranslationReadiness,\n  type TranslationReadiness,\n} from './translation-context.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for inline locale chips\n */\nexport interface InlineLocaleChipsConfig {\n  /** Record ID */\n  recordId: string;\n  /** API endpoint for panel actions (e.g., /admin/api/pages) */\n  apiEndpoint: string;\n  /** Base path for navigation (e.g., /admin/content/pages) */\n  navigationBasePath: string;\n  /** Panel/entity name (e.g., 'pages') */\n  panelName?: string;\n  /** Current environment context */\n  environment?: string;\n  /** Maximum number of chips to display (default: 3) */\n  maxChips?: number;\n  /** Size variant for chips */\n  size?: 'sm' | 'md';\n  /** Callback after successful create action */\n  onCreateSuccess?: (locale: string, result: CreateActionResult) => void;\n  /** Callback after action error */\n  onError?: (locale: string, message: string) => void;\n}\n\n/**\n * Action state from record _action_state field\n */\nexport interface ActionStateEntry {\n  enabled?: boolean;\n  reason?: string;\n  reason_code?: string;\n}\n\n// ============================================================================\n// Inline Locale Chips Component\n// ============================================================================\n\n/**\n * InlineLocaleChips renders actionable chips for missing locales.\n * Respects _action_state for gating the create_translation action.\n */\nexport class InlineLocaleChips {\n  private config: InlineLocaleChipsConfig;\n  private readiness: TranslationReadiness;\n  private actionState: ActionStateEntry | null;\n  private chips: Map<string, LocaleActionChip> = new Map();\n  private element: HTMLElement | null = null;\n\n  constructor(\n    record: Record<string, unknown>,\n    config: InlineLocaleChipsConfig\n  ) {\n    this.config = {\n      maxChips: 3,\n      size: 'sm',\n      ...config,\n    };\n    this.readiness = extractTranslationReadiness(record);\n    this.actionState = this.extractActionState(record, 'create_translation');\n  }\n\n  /**\n   * Extract action state for a specific action from the record.\n   */\n  private extractActionState(\n    record: Record<string, unknown>,\n    actionName: string\n  ): ActionStateEntry | null {\n    const rawState = record._action_state;\n    if (!rawState || typeof rawState !== 'object' || Array.isArray(rawState)) {\n      return null;\n    }\n    const perAction = (rawState as Record<string, unknown>)[actionName];\n    if (!perAction || typeof perAction !== 'object' || Array.isArray(perAction)) {\n      return null;\n    }\n    return perAction as ActionStateEntry;\n  }\n\n  /**\n   * Check if the create_translation action is enabled.\n   */\n  isCreateActionEnabled(): boolean {\n    // If no action state, assume enabled (backward compat)\n    if (!this.actionState) {\n      return true;\n    }\n    // Explicit enabled: false means disabled\n    return this.actionState.enabled !== false;\n  }\n\n  /**\n   * Get the disabled reason if create action is disabled.\n   */\n  getDisabledReason(): string | null {\n    if (this.isCreateActionEnabled()) {\n      return null;\n    }\n    if (this.actionState?.reason) {\n      return this.actionState.reason;\n    }\n    // Map reason codes to human-readable messages\n    const code = this.actionState?.reason_code;\n    if (code === 'workflow_transition_not_available') {\n      return 'Translation creation is not available in the current workflow state.';\n    }\n    if (code === 'permission_denied') {\n      return 'You do not have permission to create translations.';\n    }\n    return 'Translation creation is currently unavailable.';\n  }\n\n  /**\n   * Get missing locales to display as chips.\n   */\n  getMissingLocales(): string[] {\n    if (!this.readiness.hasReadinessMetadata) {\n      return [];\n    }\n    return this.readiness.missingRequiredLocales.slice(0, this.config.maxChips);\n  }\n\n  /**\n   * Get count of overflow locales (not displayed).\n   */\n  getOverflowCount(): number {\n    if (!this.readiness.hasReadinessMetadata) {\n      return 0;\n    }\n    const total = this.readiness.missingRequiredLocales.length;\n    return Math.max(0, total - (this.config.maxChips || 3));\n  }\n\n  /**\n   * Render the inline locale chips as HTML string.\n   */\n  render(): string {\n    const missingLocales = this.getMissingLocales();\n\n    if (missingLocales.length === 0) {\n      return '';\n    }\n\n    const isEnabled = this.isCreateActionEnabled();\n    const disabledReason = this.getDisabledReason();\n    const overflowCount = this.getOverflowCount();\n\n    const chipsHtml = missingLocales.map((locale) =>\n      this.renderChip(locale, isEnabled, disabledReason)\n    ).join('');\n\n    const overflowHtml = overflowCount > 0\n      ? this.renderOverflow(overflowCount)\n      : '';\n\n    const containerClass = isEnabled\n      ? 'inline-flex items-center gap-1.5 flex-wrap'\n      : 'inline-flex items-center gap-1.5 flex-wrap opacity-60';\n\n    return `\n      <div class=\"${containerClass}\"\n           data-inline-locale-chips=\"true\"\n           data-record-id=\"${escapeHtml(this.config.recordId)}\"\n           data-action-enabled=\"${isEnabled}\"\n           role=\"list\"\n           aria-label=\"Missing translations\">\n        ${chipsHtml}${overflowHtml}\n      </div>\n    `;\n  }\n\n  /**\n   * Render a single locale chip.\n   */\n  private renderChip(\n    locale: string,\n    isEnabled: boolean,\n    disabledReason: string | null\n  ): string {\n    const { recordId, apiEndpoint, navigationBasePath, panelName, environment, size } = this.config;\n\n    if (!isEnabled) {\n      // Render disabled chip without action buttons\n      return this.renderDisabledChip(locale, disabledReason, size);\n    }\n\n    // Render actionable chip\n    return renderLocaleActionChip({\n      locale,\n      recordId,\n      apiEndpoint,\n      navigationBasePath,\n      panelName,\n      environment,\n      localeExists: false,\n      size,\n      mode: 'chip',\n      onCreateSuccess: this.config.onCreateSuccess,\n      onError: this.config.onError,\n    });\n  }\n\n  /**\n   * Render a disabled locale chip (no action buttons).\n   */\n  private renderDisabledChip(\n    locale: string,\n    disabledReason: string | null,\n    size: 'sm' | 'md' | undefined\n  ): string {\n    const sizeClasses = size === 'md'\n      ? 'text-sm px-3 py-1.5'\n      : 'text-xs px-2 py-1';\n\n    const tooltip = disabledReason || 'Translation creation unavailable';\n    const localeLabel = getLocaleLabel(locale);\n\n    return `\n      <div class=\"inline-flex items-center gap-1 ${sizeClasses} rounded-full border border-gray-300 bg-gray-100 text-gray-500 cursor-not-allowed\"\n           data-locale=\"${escapeHtml(locale)}\"\n           data-disabled=\"true\"\n           title=\"${escapeHtml(tooltip)}\"\n           role=\"listitem\"\n           aria-label=\"${localeLabel} translation (unavailable)\">\n        <svg class=\"w-3 h-3 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\n          <path fill-rule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clip-rule=\"evenodd\"/>\n        </svg>\n        <span class=\"font-medium uppercase tracking-wide\">${escapeHtml(locale)}</span>\n      </div>\n    `;\n  }\n\n  /**\n   * Render overflow indicator.\n   */\n  private renderOverflow(count: number): string {\n    const { size } = this.config;\n    const sizeClasses = size === 'md'\n      ? 'text-sm px-2 py-1'\n      : 'text-xs px-1.5 py-0.5';\n\n    const allMissing = this.readiness.missingRequiredLocales.join(', ').toUpperCase();\n\n    return `\n      <span class=\"${sizeClasses} rounded text-gray-500 font-medium\"\n            title=\"Also missing: ${escapeHtml(allMissing)}\"\n            aria-label=\"${count} more missing translations\">\n        +${count}\n      </span>\n    `;\n  }\n\n  /**\n   * Mount the component and bind events.\n   */\n  mount(container: HTMLElement): void {\n    container.innerHTML = this.render();\n    this.element = container.querySelector('[data-inline-locale-chips]');\n    this.bindEvents();\n  }\n\n  /**\n   * Bind event handlers for actionable chips.\n   */\n  private bindEvents(): void {\n    if (!this.element || !this.isCreateActionEnabled()) return;\n\n    const chipElements = this.element.querySelectorAll<HTMLElement>('[data-locale-action]');\n    chipElements.forEach((chipEl) => {\n      const locale = chipEl.getAttribute('data-locale-action');\n      if (!locale) return;\n\n      // Create chip instance for event handling\n      const chip = new LocaleActionChip({\n        locale,\n        recordId: this.config.recordId,\n        apiEndpoint: this.config.apiEndpoint,\n        navigationBasePath: this.config.navigationBasePath,\n        panelName: this.config.panelName,\n        environment: this.config.environment,\n        localeExists: false,\n        size: this.config.size,\n        onCreateSuccess: this.config.onCreateSuccess,\n        onError: this.config.onError,\n      });\n\n      this.chips.set(locale, chip);\n\n      // Bind create button\n      const createBtn = chipEl.querySelector<HTMLButtonElement>('[data-action=\"create\"]');\n      createBtn?.addEventListener('click', async (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        await chip.handleCreate();\n      });\n\n      // Bind open button\n      const openBtn = chipEl.querySelector<HTMLButtonElement>('[data-action=\"open\"]');\n      openBtn?.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        chip.handleOpen();\n      });\n    });\n  }\n\n  /**\n   * Get chip instance by locale (for testing/inspection).\n   */\n  getChip(locale: string): LocaleActionChip | undefined {\n    return this.chips.get(locale);\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Render inline locale chips from a record payload.\n */\nexport function renderInlineLocaleChips(\n  record: Record<string, unknown>,\n  config: Omit<InlineLocaleChipsConfig, 'recordId'>\n): string {\n  const recordId = String(record.id || '');\n  if (!recordId) return '';\n\n  const component = new InlineLocaleChips(record, { ...config, recordId });\n  return component.render();\n}\n\n/**\n * Check if a record has missing locales that should show chips.\n */\nexport function shouldShowInlineLocaleChips(record: Record<string, unknown>): boolean {\n  const readiness = extractTranslationReadiness(record);\n  return readiness.hasReadinessMetadata && readiness.missingRequiredLocales.length > 0;\n}\n\n/**\n * Initialize inline locale chips in a container.\n */\nexport function initInlineLocaleChips(\n  container: HTMLElement,\n  record: Record<string, unknown>,\n  config: Omit<InlineLocaleChipsConfig, 'recordId'>\n): InlineLocaleChips {\n  const recordId = String(record.id || '');\n  const component = new InlineLocaleChips(record, { ...config, recordId });\n  component.mount(container);\n  return component;\n}\n\n/**\n * Create a cell renderer for inline locale chips.\n * Can be used with DataGrid column configuration.\n */\nexport function createInlineLocaleChipsRenderer(\n  config: Omit<InlineLocaleChipsConfig, 'recordId'>\n): (value: unknown, record: Record<string, unknown>, column: string) => string {\n  return (_value: unknown, record: Record<string, unknown>, _column: string): string => {\n    return renderInlineLocaleChips(record, config);\n  };\n}\n","/**\n * Keyboard Shortcuts Registry\n *\n * ===========================================================================\n * DESIGN NOTE (TX-072): Keyboard Shortcut System for Translation Workflow\n * ===========================================================================\n *\n * Goals:\n * 1. Accelerate common translation operations (save, publish, locale switch)\n * 2. Provide discoverability through visual cues and help modal\n * 3. Maintain consistency with standard editor conventions\n * 4. Support context-aware shortcuts (form vs list view)\n *\n * Shortcut Categories:\n * \n *  Category         Shortcuts                                            \n * \n *  Save/Submit      Ctrl/Cmd+S (save), Ctrl/Cmd+Enter (submit)           \n *  Locale           Ctrl/Cmd+Shift+L (locale picker), Ctrl/Cmd+1-9       \n *  Navigation       Ctrl/Cmd+[ ] (prev/next locale)                      \n *  Actions          Ctrl/Cmd+P (publish), Ctrl/Cmd+Shift+T (translate)   \n *  Help             ? (show shortcuts help), Esc (dismiss modals)        \n * \n *\n * Key Design Decisions:\n * - Use Cmd on Mac, Ctrl on other platforms (detected via platform check)\n * - Shortcuts are opt-in and configurable per context\n * - Conflicts with browser/OS shortcuts are avoided\n * - All shortcuts are documented and discoverable via ? key\n * - Shortcuts respect focus state (don't trigger when typing in inputs)\n *\n * Discoverability:\n * - Help modal (? key) shows all available shortcuts\n * - Tooltips on buttons show keyboard shortcuts\n * - First-time hint for ? key in toolbar\n *\n * ===========================================================================\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Platform-independent modifier key representation\n */\nexport type ModifierKey = 'ctrl' | 'alt' | 'shift' | 'meta';\n\n/**\n * Keyboard shortcut definition\n */\nexport interface KeyboardShortcut {\n  /** Unique identifier for this shortcut */\n  id: string;\n  /** Human-readable description */\n  description: string;\n  /** Category for grouping in help modal */\n  category: ShortcutCategory;\n  /** Primary key (e.g., 's', 'Enter', '1') */\n  key: string;\n  /** Modifier keys required */\n  modifiers: ModifierKey[];\n  /** Handler function called when shortcut is triggered */\n  handler: (event: KeyboardEvent) => void | Promise<void>;\n  /** Whether shortcut is enabled (default: true) */\n  enabled?: boolean;\n  /** Context where shortcut is active (default: 'global') */\n  context?: ShortcutContext;\n  /** Whether to prevent default browser behavior */\n  preventDefault?: boolean;\n  /** Whether shortcut should work when focused on form inputs */\n  allowInInput?: boolean;\n}\n\n/**\n * Shortcut category for grouping\n */\nexport type ShortcutCategory =\n  | 'save'\n  | 'navigation'\n  | 'locale'\n  | 'actions'\n  | 'help'\n  | 'other';\n\n/**\n * Context where shortcuts are active\n */\nexport type ShortcutContext = 'global' | 'form' | 'list' | 'modal';\n\n/**\n * Shortcut registration options\n */\nexport interface ShortcutRegistrationOptions {\n  /** Override existing shortcut with same ID */\n  override?: boolean;\n  /** Priority for handling (higher = processed first) */\n  priority?: number;\n}\n\n/**\n * Configuration for the shortcut registry\n */\nexport interface ShortcutRegistryConfig {\n  /** Enable/disable the entire registry */\n  enabled?: boolean;\n  /** Current active context */\n  context?: ShortcutContext;\n  /** Platform override for modifier key display (auto-detected if not set) */\n  platform?: 'mac' | 'windows' | 'linux';\n  /** Callback for when a shortcut is triggered */\n  onShortcutTriggered?: (shortcut: KeyboardShortcut) => void;\n  /** Callback for when help is requested (? key) */\n  onHelpRequested?: () => void;\n}\n\n// ============================================================================\n// Platform Detection\n// ============================================================================\n\n/**\n * Detect if running on Mac platform\n */\nexport function isMacPlatform(): boolean {\n  if (typeof navigator === 'undefined') return false;\n  return /Mac|iPhone|iPad|iPod/i.test(navigator.platform || navigator.userAgent);\n}\n\n/**\n * Get the primary modifier key label for the current platform\n */\nexport function getPrimaryModifierLabel(): string {\n  return isMacPlatform() ? '' : 'Ctrl';\n}\n\n/**\n * Get the modifier key symbol for display\n */\nexport function getModifierSymbol(modifier: ModifierKey): string {\n  if (isMacPlatform()) {\n    switch (modifier) {\n      case 'ctrl': return '';\n      case 'alt': return '';\n      case 'shift': return '';\n      case 'meta': return '';\n    }\n  }\n  switch (modifier) {\n    case 'ctrl': return 'Ctrl';\n    case 'alt': return 'Alt';\n    case 'shift': return 'Shift';\n    case 'meta': return 'Win';\n  }\n}\n\n/**\n * Format a shortcut for display (e.g., \"+S\" or \"Ctrl+S\")\n */\nexport function formatShortcutDisplay(shortcut: KeyboardShortcut): string {\n  const modifiers = shortcut.modifiers.map(getModifierSymbol);\n  const key = formatKeyDisplay(shortcut.key);\n\n  if (isMacPlatform()) {\n    // Mac style: symbols without + separators\n    return [...modifiers, key].join('');\n  }\n  // Windows/Linux style: with + separators\n  return [...modifiers, key].join('+');\n}\n\n/**\n * Format a key for display\n */\nfunction formatKeyDisplay(key: string): string {\n  const keyMappings: Record<string, string> = {\n    'Enter': '',\n    'Escape': 'Esc',\n    'ArrowUp': '',\n    'ArrowDown': '',\n    'ArrowLeft': '',\n    'ArrowRight': '',\n    ' ': 'Space',\n    '[': '[',\n    ']': ']',\n  };\n  return keyMappings[key] || key.toUpperCase();\n}\n\n// ============================================================================\n// Keyboard Shortcut Registry\n// ============================================================================\n\n/**\n * KeyboardShortcutRegistry manages keyboard shortcuts and their handlers.\n * Provides a centralized place to register, unregister, and trigger shortcuts.\n */\nexport class KeyboardShortcutRegistry {\n  private shortcuts: Map<string, KeyboardShortcut> = new Map();\n  private config: ShortcutRegistryConfig;\n  private keydownHandler: ((event: KeyboardEvent) => void) | null = null;\n  private boundElement: Document | HTMLElement | null = null;\n\n  constructor(config: ShortcutRegistryConfig = {}) {\n    this.config = {\n      enabled: true,\n      context: 'global',\n      ...config,\n    };\n  }\n\n  /**\n   * Register a keyboard shortcut.\n   */\n  register(\n    shortcut: KeyboardShortcut,\n    options: ShortcutRegistrationOptions = {}\n  ): void {\n    const { override = false } = options;\n\n    if (this.shortcuts.has(shortcut.id) && !override) {\n      console.warn(`[KeyboardShortcuts] Shortcut \"${shortcut.id}\" already registered`);\n      return;\n    }\n\n    this.shortcuts.set(shortcut.id, {\n      enabled: true,\n      context: 'global',\n      preventDefault: true,\n      allowInInput: false,\n      ...shortcut,\n    });\n  }\n\n  /**\n   * Unregister a keyboard shortcut by ID.\n   */\n  unregister(id: string): boolean {\n    return this.shortcuts.delete(id);\n  }\n\n  /**\n   * Enable or disable a specific shortcut.\n   */\n  setEnabled(id: string, enabled: boolean): void {\n    const shortcut = this.shortcuts.get(id);\n    if (shortcut) {\n      shortcut.enabled = enabled;\n    }\n  }\n\n  /**\n   * Set the current active context.\n   */\n  setContext(context: ShortcutContext): void {\n    this.config.context = context;\n  }\n\n  /**\n   * Get the current context.\n   */\n  getContext(): ShortcutContext {\n    return this.config.context || 'global';\n  }\n\n  /**\n   * Get all registered shortcuts.\n   */\n  getShortcuts(): KeyboardShortcut[] {\n    return Array.from(this.shortcuts.values());\n  }\n\n  /**\n   * Get shortcuts by category.\n   */\n  getShortcutsByCategory(category: ShortcutCategory): KeyboardShortcut[] {\n    return this.getShortcuts().filter((s) => s.category === category);\n  }\n\n  /**\n   * Get shortcuts grouped by category.\n   */\n  getShortcutsGroupedByCategory(): Map<ShortcutCategory, KeyboardShortcut[]> {\n    const grouped = new Map<ShortcutCategory, KeyboardShortcut[]>();\n    for (const shortcut of this.shortcuts.values()) {\n      const list = grouped.get(shortcut.category) || [];\n      list.push(shortcut);\n      grouped.set(shortcut.category, list);\n    }\n    return grouped;\n  }\n\n  /**\n   * Bind keyboard event listeners.\n   */\n  bind(element: Document | HTMLElement = document): void {\n    if (this.keydownHandler) {\n      this.unbind();\n    }\n\n    this.keydownHandler = (event: KeyboardEvent) => {\n      this.handleKeydown(event);\n    };\n\n    this.boundElement = element;\n    element.addEventListener('keydown', this.keydownHandler as EventListener);\n  }\n\n  /**\n   * Unbind keyboard event listeners.\n   */\n  unbind(): void {\n    if (this.keydownHandler && this.boundElement) {\n      this.boundElement.removeEventListener('keydown', this.keydownHandler as EventListener);\n      this.keydownHandler = null;\n      this.boundElement = null;\n    }\n  }\n\n  /**\n   * Handle keydown event.\n   */\n  private handleKeydown(event: KeyboardEvent): void {\n    if (!this.config.enabled) return;\n\n    // Check for help shortcut (? key without modifiers)\n    if (event.key === '?' && !event.ctrlKey && !event.altKey && !event.metaKey) {\n      if (!this.isInputFocused(event)) {\n        event.preventDefault();\n        this.config.onHelpRequested?.();\n        return;\n      }\n    }\n\n    // Find matching shortcut\n    const matchingShortcut = this.findMatchingShortcut(event);\n    if (!matchingShortcut) return;\n\n    // Check if shortcut is enabled\n    if (!matchingShortcut.enabled) return;\n\n    // Check context\n    if (matchingShortcut.context !== 'global' &&\n        matchingShortcut.context !== this.config.context) {\n      return;\n    }\n\n    // Check if we should allow in input\n    if (!matchingShortcut.allowInInput && this.isInputFocused(event)) {\n      return;\n    }\n\n    // Prevent default if configured\n    if (matchingShortcut.preventDefault) {\n      event.preventDefault();\n    }\n\n    // Trigger callback\n    this.config.onShortcutTriggered?.(matchingShortcut);\n\n    // Execute handler\n    try {\n      const result = matchingShortcut.handler(event);\n      if (result instanceof Promise) {\n        result.catch((err) => {\n          console.error(`[KeyboardShortcuts] Handler error for \"${matchingShortcut.id}\":`, err);\n        });\n      }\n    } catch (err) {\n      console.error(`[KeyboardShortcuts] Handler error for \"${matchingShortcut.id}\":`, err);\n    }\n  }\n\n  /**\n   * Find a shortcut matching the given keyboard event.\n   */\n  private findMatchingShortcut(event: KeyboardEvent): KeyboardShortcut | null {\n    for (const shortcut of this.shortcuts.values()) {\n      if (this.matchesEvent(shortcut, event)) {\n        return shortcut;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Check if a shortcut matches a keyboard event.\n   */\n  private matchesEvent(shortcut: KeyboardShortcut, event: KeyboardEvent): boolean {\n    // Check key\n    const eventKey = event.key.toLowerCase();\n    const shortcutKey = shortcut.key.toLowerCase();\n\n    if (eventKey !== shortcutKey && event.code.toLowerCase() !== shortcutKey) {\n      return false;\n    }\n\n    // Check modifiers\n    const isMac = isMacPlatform();\n    const expectedModifiers = new Set(shortcut.modifiers);\n\n    // On Mac, treat 'ctrl' in shortcuts as 'meta' (Cmd)\n    const wantsCtrl = expectedModifiers.has('ctrl');\n    const wantsMeta = expectedModifiers.has('meta');\n    const wantsAlt = expectedModifiers.has('alt');\n    const wantsShift = expectedModifiers.has('shift');\n\n    // Check primary modifier (Cmd on Mac, Ctrl on others)\n    if (wantsCtrl) {\n      const hasModifier = isMac ? event.metaKey : event.ctrlKey;\n      if (!hasModifier) return false;\n    }\n\n    // Check explicit meta requirement\n    if (wantsMeta && !isMac && !event.metaKey) return false;\n\n    // Check alt/option\n    if (wantsAlt && !event.altKey) return false;\n\n    // Check shift\n    if (wantsShift && !event.shiftKey) return false;\n\n    // Check for unexpected modifiers\n    if (!wantsCtrl && !wantsMeta) {\n      if (isMac ? event.metaKey : event.ctrlKey) return false;\n    }\n    if (!wantsAlt && event.altKey) return false;\n    if (!wantsShift && event.shiftKey) return false;\n\n    return true;\n  }\n\n  /**\n   * Check if an input element is focused.\n   */\n  private isInputFocused(event: KeyboardEvent): boolean {\n    const target = event.target as HTMLElement;\n    if (!target) return false;\n\n    const tagName = target.tagName.toLowerCase();\n    if (tagName === 'input' || tagName === 'textarea' || tagName === 'select') {\n      return true;\n    }\n\n    // Check for contenteditable\n    if (target.isContentEditable) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Destroy the registry and clean up.\n   */\n  destroy(): void {\n    this.unbind();\n    this.shortcuts.clear();\n  }\n}\n\n// ============================================================================\n// Default Translation Shortcuts\n// ============================================================================\n\n/**\n * Create default translation workflow shortcuts.\n */\nexport function createTranslationShortcuts(handlers: {\n  onSave?: () => void | Promise<void>;\n  onPublish?: () => void | Promise<void>;\n  onLocalePicker?: () => void;\n  onPrevLocale?: () => void;\n  onNextLocale?: () => void;\n  onCreateTranslation?: () => void;\n  onHelp?: () => void;\n}): KeyboardShortcut[] {\n  const shortcuts: KeyboardShortcut[] = [];\n\n  if (handlers.onSave) {\n    shortcuts.push({\n      id: 'save',\n      description: 'Save changes',\n      category: 'save',\n      key: 's',\n      modifiers: ['ctrl'],\n      handler: handlers.onSave,\n      context: 'form',\n    });\n  }\n\n  if (handlers.onPublish) {\n    shortcuts.push({\n      id: 'publish',\n      description: 'Publish content',\n      category: 'actions',\n      key: 'p',\n      modifiers: ['ctrl', 'shift'],\n      handler: handlers.onPublish,\n      context: 'form',\n    });\n  }\n\n  if (handlers.onLocalePicker) {\n    shortcuts.push({\n      id: 'locale-picker',\n      description: 'Open locale picker',\n      category: 'locale',\n      key: 'l',\n      modifiers: ['ctrl', 'shift'],\n      handler: handlers.onLocalePicker,\n    });\n  }\n\n  if (handlers.onPrevLocale) {\n    shortcuts.push({\n      id: 'prev-locale',\n      description: 'Switch to previous locale',\n      category: 'locale',\n      key: '[',\n      modifiers: ['ctrl'],\n      handler: handlers.onPrevLocale,\n    });\n  }\n\n  if (handlers.onNextLocale) {\n    shortcuts.push({\n      id: 'next-locale',\n      description: 'Switch to next locale',\n      category: 'locale',\n      key: ']',\n      modifiers: ['ctrl'],\n      handler: handlers.onNextLocale,\n    });\n  }\n\n  if (handlers.onCreateTranslation) {\n    shortcuts.push({\n      id: 'create-translation',\n      description: 'Create new translation',\n      category: 'actions',\n      key: 't',\n      modifiers: ['ctrl', 'shift'],\n      handler: handlers.onCreateTranslation,\n    });\n  }\n\n  return shortcuts;\n}\n\n// ============================================================================\n// Help Modal Rendering\n// ============================================================================\n\n/**\n * Render keyboard shortcuts help modal content.\n */\nexport function renderShortcutsHelpContent(shortcuts: KeyboardShortcut[]): string {\n  const grouped = new Map<ShortcutCategory, KeyboardShortcut[]>();\n  for (const shortcut of shortcuts) {\n    // Treat undefined as enabled (default), only skip if explicitly false\n    if (shortcut.enabled === false) continue;\n    const list = grouped.get(shortcut.category) || [];\n    list.push(shortcut);\n    grouped.set(shortcut.category, list);\n  }\n\n  const categoryLabels: Record<ShortcutCategory, string> = {\n    save: 'Save & Submit',\n    navigation: 'Navigation',\n    locale: 'Locale Switching',\n    actions: 'Actions',\n    help: 'Help',\n    other: 'Other',\n  };\n\n  const categoryOrder: ShortcutCategory[] = ['save', 'locale', 'navigation', 'actions', 'help', 'other'];\n\n  let html = `\n    <div class=\"shortcuts-help\" role=\"document\">\n      <div class=\"text-sm text-gray-500 mb-4\">\n        Press <kbd class=\"px-1.5 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs font-mono\">?</kbd> to show this help anytime\n      </div>\n  `;\n\n  for (const category of categoryOrder) {\n    const categoryShortcuts = grouped.get(category);\n    if (!categoryShortcuts || categoryShortcuts.length === 0) continue;\n\n    html += `\n      <div class=\"mb-4\">\n        <h4 class=\"text-sm font-medium text-gray-700 mb-2\">${categoryLabels[category]}</h4>\n        <dl class=\"space-y-1\">\n    `;\n\n    for (const shortcut of categoryShortcuts) {\n      const display = formatShortcutDisplay(shortcut);\n      html += `\n          <div class=\"flex justify-between items-center py-1\">\n            <dt class=\"text-sm text-gray-600\">${escapeHtml(shortcut.description)}</dt>\n            <dd class=\"flex-shrink-0 ml-4\">\n              <kbd class=\"px-2 py-1 bg-gray-100 border border-gray-200 rounded text-xs font-mono text-gray-700\">${escapeHtml(display)}</kbd>\n            </dd>\n          </div>\n      `;\n    }\n\n    html += `\n        </dl>\n      </div>\n    `;\n  }\n\n  html += `</div>`;\n  return html;\n}\n\n/**\n * Simple HTML escaping\n */\nfunction escapeHtml(text: string): string {\n  const div = typeof document !== 'undefined' ? document.createElement('div') : null;\n  if (div) {\n    div.textContent = text;\n    return div.innerHTML;\n  }\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\nlet defaultRegistry: KeyboardShortcutRegistry | null = null;\n\n/**\n * Get the default global shortcut registry.\n */\nexport function getDefaultShortcutRegistry(): KeyboardShortcutRegistry {\n  if (!defaultRegistry) {\n    defaultRegistry = new KeyboardShortcutRegistry();\n  }\n  return defaultRegistry;\n}\n\n/**\n * Initialize shortcuts with handlers and bind to document.\n */\nexport function initKeyboardShortcuts(\n  handlers: Parameters<typeof createTranslationShortcuts>[0],\n  config?: ShortcutRegistryConfig\n): KeyboardShortcutRegistry {\n  const registry = new KeyboardShortcutRegistry(config);\n  const shortcuts = createTranslationShortcuts(handlers);\n\n  for (const shortcut of shortcuts) {\n    registry.register(shortcut);\n  }\n\n  registry.bind();\n  return registry;\n}\n"],"names":["PayloadInputModal","Modal","config","onConfirm","onCancel","resolve","values","fields","field","escapeModalHtml","form","cancelBtn","submit","firstInvalid","input","value","event","description","control","selected","optionHtml","option","isSelected","cls","inputType","el","name","message","errorEl","ActionRenderer","FallbackNotifier","record","actions","visibleActions","action","variantClass","icon","customClass","disabled","disabledClass","ariaDisabledAttr","titleAttr","menuId","actionItems","index","isDestructive","divider","itemClass","label","basePath","container","records","button","btn","recordId","e","error","errorMsg","bulkActions","toolbar","info","actionsContainer","clearButton","selectedIds","requestPayload","response","extractErrorMessage","data","payload","schema","definition","missingRequired","rawValues","rawValue","parsed","required","ordered","seen","append","propertiesRaw","properties","key","requiredFields","modalFields","rawType","options","item","match","allowed","type","normalized","fallbackCount","actionLabel","summary","succeeded","failed","variant","str","div","extractTranslationContext","context","extractStringField","extractStringArrayField","extractBooleanField","isInFallbackMode","ctx","hasTranslationContext","extractTranslationReadiness","readiness","readinessObj","v","fieldsByLocale","locale","state","isValidReadinessState","readyFor","transition","ready","hasTranslationReadiness","isReadyForTransition","renderLocaleBadge","showFallbackIndicator","size","extraClass","isFallback","baseClasses","renderAvailableLocalesIndicator","maxLocales","sizeClass","pillSize","visibleLocales","hiddenCount","pills","overflow","renderTranslationStatusCell","showResolvedLocale","parts","renderStatusBadge","status","statusLower","badge","renderReadinessIndicator","showDetailedTooltip","bgClass","textClass","tooltip","getReadinessStateDisplay","renderPublishReadinessBadge","isReady","missingCount","renderLocaleCompleteness","available","loc","colorClass","renderMissingTranslationsBadge","hasMissingLocales","hasMissingFields","hasMissingTranslations","getMissingTranslationsCount","checkIcon","warningIcon","missing","localesWithMissingFields","missingLocales","renderTranslationMatrixCell","showLabels","requiredLocales","availableLocales","missingRequiredFieldsByLocale","allLocales","availableSet","incompleteLocales","getIncompleteLocales","chips","isAvailable","isIncomplete","isComplete","stateClass","stateLabel","labelHtml","incomplete","createTranslationMatrixRenderer","_value","_column","renderFallbackWarning","showCreateButton","createTranslationUrl","panelName","requestedLocale","resolvedLocale","createButtonHtml","createTranslationStatusRenderer","createLocaleBadgeRenderer","paths","path","getNestedValue","obj","current","part","EMPTY_CELL_HTML","DEFAULT_OBJECT_LABEL_KEYS","escapeHtml","compactJSON","normalizeDisplayKeys","keys","pushKey","candidate","listCandidate","objectValueByPath","segments","segment","scalarSummary","summarizeObjectValue","summarizeArrayValue","rawLimit","limit","preview","normalizeNumberOption","snakeKey","camelKey","defaultValue","raw","normalizeBooleanOption","normalizeStringOption","resolveBlockLabel","typeKeys","val","blocksChipVariantClass","CellRendererRegistry","column","renderer","bytes","sizes","i","text","maxLength","_record","tag","maxVisible","showCount","chipVariant","iconMap","visibleItems","iconRef","iconHtml","renderIcon","remaining","overflowBadge","initial","CommonRenderers","_colorMap","role","email","sharedBooleanChip","date","diffMs","diffMins","diffHours","diffDays","ownKeys","object","enumerableOnly","symbols","sym","_objectSpread2","target","source","_defineProperty","_typeof","_extends","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","version","userAgent","pattern","IE11OrLess","Edge","FireFox","Safari","IOS","ChromeForAndroid","captureMode","on","fn","off","matches","selector","getParentOrHost","closest","includeCTX","R_SPACE","toggleClass","className","css","prop","style","matrix","selfOnly","appliedTransforms","transform","matrixFn","find","tagName","iterator","list","n","getWindowScrollingElement","scrollingElement","getRect","relativeToContainingBlock","relativeToNonStaticParent","undoScale","elRect","top","left","bottom","right","height","width","containerRect","elMatrix","scaleX","scaleY","isScrolledPast","elSide","parentSide","parent","getParentAutoScrollElement","elSideVal","parentSideVal","visible","getChild","childNum","includeDragEl","currentChild","children","Sortable","lastChild","last","getRelativeScrollOffset","offsetLeft","offsetTop","winScroller","indexOfObject","arr","includeSelf","elem","gotSelf","elemCSS","extend","dst","src","isRectEqual","rect1","rect2","_throttleTimeout","throttle","callback","ms","args","_this","cancelThrottle","scrollBy","x","y","clone","Polymer","$","getChildContainingRectFromElement","ghostEl","rect","child","_rect$left","_rect$top","_rect$right","_rect$bottom","childRect","expando","AnimationStateManager","animationStates","animationCallbackId","fromRect","childMatrix","animating","animationTime","time","toRect","prevFromRect","prevToRect","animatingRect","targetMatrix","calculateRealTime","currentRect","duration","translateX","translateY","repaint","plugins","defaults","PluginManager","plugin","p","eventName","sortable","evt","eventNameGlobal","pluginName","initialized","modified","eventProperties","modifiedValue","dispatchEvent","_ref","rootEl","targetEl","cloneEl","toEl","fromEl","oldIndex","newIndex","oldDraggableIndex","newDraggableIndex","originalEvent","putSortable","extraEventProperties","onName","allEventProperties","_excluded","pluginEvent","dragEl","parentEl","nextEl","lastDownEl","cloneHidden","moved","_hideGhostForTarget","_unhideGhostForTarget","_dispatchEvent","activeGroup","awaitingDragStarted","ignoreNextClick","sortables","tapEvt","touchEvt","lastDx","lastDy","tapDistanceLeft","tapDistanceTop","lastTarget","lastDirection","pastFirstInvertThresh","isCircumstantialInvert","targetMoveDistance","ghostRelativeParent","ghostRelativeParentInitialScroll","_silent","savedInputChecked","documentExists","PositionGhostAbsolutely","CSSFloatProperty","supportDraggable","supportCssPointerEvents","_detectDirection","elCSS","elWidth","child1","child2","firstChildCSS","secondChildCSS","firstChildWidth","secondChildWidth","touchingSideChild2","_dragElInRowColumn","dragRect","targetRect","vertical","dragElS1Opp","dragElS2Opp","dragElOppLength","targetS1Opp","targetS2Opp","targetOppLength","_detectNearestEmptySortable","ret","threshold","insideHorizontally","insideVertically","_prepareGroup","toFn","pull","to","from","sameGroup","otherGroup","group","originalGroup","nearestEmptyInsertDetectEvent","nearest","_checkOutsideTargetEl","dataTransfer","preventOnFilter","touch","originalTarget","filter","_saveInputCheckedState","criteria","ownerDocument","dragStartFn","_disableDraggable","_nextTick","fallback","inserted","fallbackTolerance","fallbackOffset","ghostMatrix","relativeScrollOffset","dx","dy","cssMatrix","revert","activeSortable","isOwner","canSort","fromSortable","completedFired","dragOverEvent","extra","completed","after","_onMove","changed","capture","insertion","elLastChild","_ghostIsLast","_ghostIsFirst","firstChild","direction","targetBeforeFirstSwap","differentLevel","differentRowCol","side1","scrolledPastTop","scrollBefore","_getSwapDirection","sibling","dragIndex","nextSibling","moveVector","_unsilent","_cancelNextTick","_globalDragOver","order","_generateId","useAnimation","items","id","store","willInsertAfter","onMoveFn","retVal","firstElRect","childContainingRect","spacer","lastElRect","swapThreshold","invertedSwapThreshold","invertSwap","isLastTarget","mouseOnAxis","targetLength","targetS1","targetS2","invert","_getInsertDirection","sum","root","inputs","idx","element","_len","_key","autoScrolls","scrollEl","scrollRootEl","scrolling","lastAutoScrollX","lastAutoScrollY","touchEvt$1","pointerElemChangedInterval","AutoScrollPlugin","AutoScroll","_ref2","clearPointerElemChangedInterval","clearAutoScrolls","autoScroll","ogElemScroller","newElem","sens","speed","scrollThisInstance","scrollCustomFn","layersOut","currentParent","canScrollX","canScrollY","scrollWidth","scrollHeight","scrollPosX","scrollPosY","vx","vy","scrollOffsetY","scrollOffsetX","drop","dispatchSortableEvent","hideGhostForTarget","unhideGhostForTarget","toSortable","Revert","_ref3","Remove","_ref4","parentSortable","ColumnManager","columns","hiddenSet","header","columnList","col","footer","totalCount","visibleCount","searchContainer","searchIcon","circle","searchInput","countBadge","searchTerm","term","scrollTop","clientHeight","isScrollable","hasTopShadow","hasBottomShadow","resetBtn","resetIcon","path1","path2","resetText","isVisible","itemId","switchId","content","dragHandle","cx","cy","labelSpan","switchLabel","checkbox","slider","newOrder","descId","transformToGroups","groupByField","defaultExpanded","expandedGroups","groupMap","ungrouped","groupId","getGroupId","existing","groups","groupRecords","computeGroupSummary","expanded","a","b","aIndex","bIndex","nestedPaths","nested","allAvailable","allMissing","hasIncomplete","readyCount","isString","legacyAvailable","readinessState","allReady","hasMissing","mergeBackendSummaries","groupedData","backendSummaries","backendSummary","extractBackendSummaries","summaries","groupSummaries","s","EXPAND_STATE_KEY_PREFIX","getPersistedExpandState","panelId","stored","persistExpandState","toggleGroupExpand","expandAllGroups","collapseAllGroups","getExpandedGroupIds","VIEW_MODE_KEY_PREFIX","getPersistedViewMode","isValidViewMode","persistViewMode","mode","renderGroupHeaderSummary","textSize","availableCount","totalLocales","readinessBadge","stateConfig","getReadinessStateConfig","localeCount","itemCount","renderGroupHeaderRow","colSpan","showExpandIcon","expandIcon","summaryHtml","escapeAttr","renderGroupedEmptyState","renderGroupedLoadingState","renderGroupedErrorState","onRetry","retryButton","isNarrowViewport","breakpoint","getViewModeForViewport","preferredMode","DataGrid","persistedViewMode","persistedExpandState","initialViewMode","params","search","page","parsedPage","perPage","parsedPerPage","fallbackPerPage","perPageSelect","filtersParam","sortParam","hiddenColumnsParam","hiddenArray","validFields","allColumnFields","cachedHidden","cachedOrder","validOrder","defaultOrder","columnMap","c","visibleColumns","newURL","url","total","queryParams","paginationParams","searchParams","filterParams","sortParams","nextPerPage","maxPage","nextPage","didCorrect","skipURLUpdate","visibleSet","th","td","menu","tbody","row","headerHtml","headerRow","g","isExpanded","effectiveMode","detail","rowClasses","checkboxCell","cell","rendererName","rendererContext","actionBase","actionsCell","actionId","defaultActions","offset","start","end","startEl","endEl","totalEl","totalPages","buttons","maxButtons","startPage","endPage","isActive","clearBtn","toggleClearBtn","select","handleFilterChange","inferredOperator","operator","existingIndex","f","toggleBtn","exportButtons","format","concurrency","buttonsToDisable","showSpinner","spinner","hideSpinner","showSpinnerOnly","sorted","svg","indicator","selectAll","cb","bulkBase","ids","bulkActionConfig","ba","endpoint","confirmMsg","payloadRequired","payloadSchema","domConfig","moreBtn","overlay","countEl","selectedCount","selectAllCheckbox","trigger","triggerRect","menuHeight","spaceBelow","spaceAbove","shouldOpenUpward","signal","toggle","targetId","otherToggle","otherId","otherTarget","m","isOpening","result","savedOrder","currentFields","savedSet","validSaved","newColumns","filterRow","cellTag","dataCells","cellMap","allCells","selectionCell","reorderedCells","DEFAULT_OPERATORS","AdvancedSearch","filters","closeBtn","saveBtn","loadBtn","updateClearButton","criterion","newCriterion","wrapper","connector","op","opt","logic","TextPromptModal","presets","names","chipsContainer","chip","fieldLabel","operatorLabel","removeBtn","FilterBuilder","addGroupBtn","applyBtn","clearAllBtn","newGroup","groupIndex","groupEl","condition","condIndex","condEl","condConnector","addCondBtn","removeGroupBtn","gIdx","cIdx","gi","ci","isOr","dataAttr","sqlPreview","textPreview","previewContainer","groupParts","condParts","acc","opLabel","nameInput","saved","fieldGroups","conditions","structure","GoCrudSearchBehavior","searchableFields","trimmedTerm","grid","GoCrudFilterBehavior","grouped","GoCrudPaginationBehavior","GoCrudSortBehavior","GoCrudExportBehavior","buildDatagridExportRequest","resolveDelivery","err","notify","statusURL","downloadURL","resolveDownloadURL","pollExportStatus","resolvePollIntervalMs","resolvePollTimeoutMs","downloadResponse","readErrorMessage","downloadExport","normalizedFormat","normalizeFormat","selection","buildSelection","buildVisibleColumns","buildQueryParams","query","buildQuery","sourceVariant","opts","started","interval","sleep","hidden","behaviors","toNumber","parseSort","splitFilterKey","chunk","blob","filename","resolveFilename","link","parseFilename","utfMatch","notifier","toast","GoCrudBulkActionBehavior","baseEndpoint","errorText","normalizeBasePath","trimmed","normalizeApiBasePath","apiBasePath","isV2Prefs","DefaultColumnVisibilityBehavior","initialColumns","storageKey","currentlyVisible","newVisibleColumns","visibility","currentOrder","allColumns","prefs","validColumns","migratedPrefs","ServerColumnVisibilityBehavior","localStorageKey","rawPrefs","serverPrefs","STABLE_ACTION_ORDER","DEFAULT_ACTION_ORDER","SchemaActionBuilder","schemaActions","orderedActions","insertionIndex","queryContext","schemaAction","actionKey","actionState","actionButton","oa","actionName","schemaOrder","normalizedName","isNavigationAction","isDeleteAction","requiredContext","rawField","rawState","perAction","disabledReason","reason","scope","normalizedScope","normalizedPath","cursor","targetUrl","executeActionRequest","isTranslationBlocker","blockerInfo","extractTranslationBlocker","retryPayload","formattedMessage","originalPayload","newId","newLocale","queryString","editUrl","sourceLocale","localeLabel","sourceParams","sourceId","promptedValues","payloadModal","fieldName","extensionOptions","candidateValue","candidateLabel","locales","recommendedLocale","requiredForPublish","existingLocales","rawLocale","isRecommended","isRequiredForPublish","hints","entry","requiredRaw","safeAction","safeRecord","suffix","formatStructuredErrorForDisplay","apiEndpoint","def","startingIndex","buildSchemaRowActions","extractSchemaActions","radios","hiddenInput","radio","recommended","radioItems","isChecked","initialValue","TranslationBlockerModal","originalOnDismiss","entityType","hasFieldHints","missingFields","hasFields","actionDisabled","hideIfNotCreated","baseUrl","localeItems","createResult","errorMessage","temp","newItem","showTranslationBlocker","DEFAULT_STATUS_LEGEND_ITEMS","StatusLegend","containerEl","title","orientation","containerClass","isVertical","isSmall","flexDirection","gap","iconSize","titleHtml","itemsHtml","createStatusLegend","legend","initStatusLegends","elements","legends","renderStatusLegendHTML","tempContainer","DEFAULT_TRANSLATION_QUICK_FILTERS","QuickFilters","cap","padding","filtersHtml","capability","isSupported","stateClasses","ariaAttributes","capabilities","supported","createTranslationQuickFilters","onFilterSelect","initQuickFilters","instances","instance","renderQuickFiltersHTML","activeKey","capMap","executeBulkCreateMissing","recordIds","maxFailuresToShow","errorBody","errorJson","parseBulkResponse","showResultToast","maxFailures","results","created","r","skipped","failures","renderBulkResultSummary","statsHtml","failuresHtml","renderBulkResultInline","createBulkCreateMissingHandler","onComplete","LOCALE_LABELS","getLocaleLabel","LocaleActionChip","localeExists","loading","sizeClasses","modeClasses","statusIcon","actionsHtml","buttonSize","openBgClass","openRingClass","createBtn","openBtn","navigationBasePath","environment","newRecordId","updates","renderLocaleActionChip","renderLocaleActionList","baseConfig","initLocaleActionChips","buildLocaleEditUrl","FallbackBanner","showFormLockMessage","requestedLabel","resolvedLabel","primaryCtaHtml","secondaryCtaHtml","formLockHtml","_loc","applyFormLock","lockState","removeFormLock","isFormLocked","getFormLockReason","renderFallbackBannerFromRecord","shouldShowFallbackBanner","initFallbackBanner","banner","initFormLock","InlineLocaleChips","code","isEnabled","overflowCount","chipsHtml","overflowHtml","count","chipEl","renderInlineLocaleChips","shouldShowInlineLocaleChips","initInlineLocaleChips","component","createInlineLocaleChipsRenderer","isMacPlatform","getPrimaryModifierLabel","getModifierSymbol","modifier","formatShortcutDisplay","shortcut","modifiers","formatKeyDisplay","KeyboardShortcutRegistry","override","enabled","category","matchingShortcut","eventKey","shortcutKey","isMac","expectedModifiers","wantsCtrl","wantsMeta","wantsAlt","wantsShift","createTranslationShortcuts","handlers","shortcuts","renderShortcutsHelpContent","categoryLabels","categoryOrder","html","categoryShortcuts","display","defaultRegistry","getDefaultShortcutRegistry","initKeyboardShortcuts","registry"],"mappings":"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","x_google_ignoreList":[3]}