{"version":3,"file":"index.js","sources":["../../src/tabs/formatters.ts","../../src/tabs/renderers.ts","../../src/tabs/tabs-controller.ts"],"sourcesContent":["/**\n * Formatting utilities for tab panels\n */\n\n/**\n * Escape HTML special characters to prevent XSS\n */\nexport function escapeHTML(raw: unknown): string {\n  const text = String(raw || '');\n  return text.replace(/[&<>\"']/g, (m) => ({\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n  }[m] || m));\n}\n\n/**\n * Format a number with locale-specific separators\n */\nexport function formatNumber(value: unknown): string {\n  if (typeof value === 'number') return value.toLocaleString();\n  if (value === null || value === undefined) return '';\n  return String(value);\n}\n\n/**\n * Parse a timestamp string into a Date object\n */\nexport function parseTimestamp(value: unknown): Date | null {\n  if (value === null || value === undefined || value === '') return null;\n  const parsed = new Date(value as string);\n  return Number.isNaN(parsed.getTime()) ? null : parsed;\n}\n\n/**\n * Format a timestamp as an absolute date/time string\n */\nexport function formatAbsoluteTime(value: unknown): string {\n  const parsed = parseTimestamp(value);\n  if (!parsed) return String(value || '');\n  return new Intl.DateTimeFormat(undefined, {\n    dateStyle: 'medium',\n    timeStyle: 'short',\n  }).format(parsed);\n}\n\n/**\n * Format a timestamp as a relative time string (e.g., \"2 hours ago\")\n */\nexport function formatRelativeTime(value: unknown): string {\n  const parsed = parseTimestamp(value);\n  if (!parsed) return String(value || '');\n\n  const diffMs = parsed.getTime() - Date.now();\n  const absMs = Math.abs(diffMs);\n  const rtf = new Intl.RelativeTimeFormat(undefined, { numeric: 'auto' });\n\n  const second = 1000;\n  const minute = 60 * second;\n  const hour = 60 * minute;\n  const day = 24 * hour;\n  const month = 30 * day;\n  const year = 365 * day;\n\n  if (absMs < minute) return rtf.format(Math.round(diffMs / second), 'second');\n  if (absMs < hour) return rtf.format(Math.round(diffMs / minute), 'minute');\n  if (absMs < day) return rtf.format(Math.round(diffMs / hour), 'hour');\n  if (absMs < month) return rtf.format(Math.round(diffMs / day), 'day');\n  if (absMs < year) return rtf.format(Math.round(diffMs / month), 'month');\n  return rtf.format(Math.round(diffMs / year), 'year');\n}\n\n/**\n * Hydrate time elements in a container with formatted timestamps\n */\nexport function hydrateTimeElements(root?: Element | Document | null): void {\n  const scope = root || document;\n\n  scope.querySelectorAll('[data-relative-time]').forEach((node) => {\n    const raw = node.getAttribute('data-relative-time');\n    if (!raw) return;\n    node.textContent = formatRelativeTime(raw);\n    const absolute = formatAbsoluteTime(raw);\n    if (absolute) node.setAttribute('title', absolute);\n  });\n\n  scope.querySelectorAll('[data-absolute-time]').forEach((node) => {\n    const raw = node.getAttribute('data-absolute-time');\n    if (!raw) return;\n    const absolute = formatAbsoluteTime(raw);\n    node.textContent = absolute;\n    if (absolute) node.setAttribute('title', absolute);\n  });\n}\n\n/**\n * Check if a value is empty\n */\nexport function isEmptyValue(value: unknown): boolean {\n  return value === null || value === undefined || String(value).trim() === '';\n}\n","/**\n * Rendering functions for tab panel content\n */\n\nimport type {\n  TabPanel,\n  TabPanelPayload,\n  Widget,\n  ProfileSection,\n  ProfileField,\n  FieldDefinition,\n} from './types';\nimport { escapeHTML, formatNumber, isEmptyValue } from './formatters';\n\nconst WIDGET_TITLES: Record<string, string> = {\n  'admin.widget.user_stats': 'User Statistics',\n  'admin.widget.activity_feed': 'Recent Activity',\n  'admin.widget.user_activity_feed': 'User Activity',\n  'admin.widget.quick_actions': 'Quick Actions',\n  'admin.widget.notifications': 'Notifications',\n  'admin.widget.settings_overview': 'Settings Overview',\n  'admin.widget.user_profile_overview': 'Profile Overview',\n  'admin.widget.content_stats': 'Content Stats',\n  'admin.widget.storage_stats': 'Storage Stats',\n  'admin.widget.system_health': 'System Health',\n};\n\nfunction getWidgetTitle(definition?: string): string {\n  if (!definition) return '';\n  return WIDGET_TITLES[definition] || definition.replace(/_/g, ' ');\n}\n\nfunction renderProfileFieldValue(field: ProfileField): string {\n  const value = field?.value !== undefined && field?.value !== null ? field.value : '-';\n  const valueText = escapeHTML(value);\n  const type = String(field?.type || 'text').toLowerCase();\n\n  if (type === 'badge') {\n    return `<span class=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">${valueText}</span>`;\n  }\n\n  if (type === 'status') {\n    const status = String(value || '').toLowerCase();\n    const tone = ({\n      active: { dot: 'bg-green-500', text: 'text-green-700' },\n      inactive: { dot: 'bg-gray-400', text: 'text-gray-600' },\n      suspended: { dot: 'bg-red-500', text: 'text-red-700' },\n      pending: { dot: 'bg-yellow-500', text: 'text-yellow-700' },\n    } as Record<string, { dot: string; text: string }>)[status] || { dot: 'bg-gray-400', text: 'text-gray-700' };\n    return `<span class=\"inline-flex items-center gap-1.5\"><span class=\"w-2 h-2 rounded-full ${tone.dot}\"></span><span class=\"${tone.text}\">${valueText}</span></span>`;\n  }\n\n  if (type === 'verified') {\n    const verified = Boolean(field?.verified);\n    return `<span class=\"inline-flex items-center gap-1.5\"><span>${valueText}</span><span class=\"${verified ? 'text-green-500' : 'text-gray-400'}\">${verified ? '✓' : '✕'}</span></span>`;\n  }\n\n  if (type === 'date') {\n    return `<time datetime=\"${valueText}\" data-absolute-time=\"${valueText}\">${valueText}</time>`;\n  }\n\n  if (type === 'relative') {\n    return `<time datetime=\"${valueText}\" data-relative-time=\"${valueText}\">${valueText}</time>`;\n  }\n\n  return valueText;\n}\n\nfunction renderProfileSections(sections: ProfileSection[]): string {\n  const blocks = sections.map((section) => {\n    const fields = Array.isArray(section?.fields) ? section.fields : [];\n    const visibleFields = fields.filter((f) => !(f?.hide_if_empty && isEmptyValue(f?.value)));\n    if (!visibleFields.length) return '';\n\n    return `\n      <div class=\"profile-section\">\n        <div class=\"text-xs uppercase tracking-wider text-gray-500 mb-3 font-semibold\">${escapeHTML(section?.label || '')}</div>\n        <dl class=\"space-y-3\">\n          ${visibleFields.map((f) => `\n            <div class=\"flex items-start justify-between gap-4\">\n              <dt class=\"text-sm text-gray-500\">${escapeHTML(f?.label || f?.key || '')}</dt>\n              <dd class=\"text-sm font-medium text-gray-900 text-right\">${renderProfileFieldValue(f)}</dd>\n            </div>\n          `).join('')}\n        </dl>\n      </div>\n    `;\n  }).filter(Boolean);\n\n  return blocks.length\n    ? `<div class=\"space-y-6\">${blocks.join('')}</div>`\n    : '<p class=\"text-gray-500\">No profile data to display</p>';\n}\n\nfunction renderWidgetContent(widget: Widget): string {\n  const def = widget.definition || '';\n  const data = widget.data || {};\n\n  if (def === 'admin.widget.user_stats') {\n    const values = data.values || { Total: data.total, Active: data.active, 'New Today': data.new_today };\n    return `<div class=\"metrics\">${Object.entries(values).map(([k, v]) =>\n      `<div class=\"metric\"><small>${escapeHTML(k)}</small><span>${escapeHTML(formatNumber(v))}</span></div>`\n    ).join('')}</div>`;\n  }\n\n  if (def === 'admin.widget.settings_overview') {\n    const values = data.values || {};\n    const entries = Object.entries(values);\n    if (!entries.length) return '<p class=\"text-gray-500\">No settings to display</p>';\n    return `<dl class=\"space-y-2\">${entries.map(([k, v]) =>\n      `<div class=\"flex items-start justify-between gap-4\"><dt class=\"text-sm text-gray-500\">${escapeHTML(k)}</dt><dd class=\"text-sm font-medium text-gray-900\">${escapeHTML(v ?? '-')}</dd></div>`\n    ).join('')}</dl>`;\n  }\n\n  if (def === 'admin.widget.user_profile_overview') {\n    const sections = Array.isArray(data.sections) ? data.sections : [];\n    if (!sections.length) return '<p class=\"text-gray-500\">No profile data to display</p>';\n    return renderProfileSections(sections);\n  }\n\n  if (def === 'admin.widget.activity_feed' || def === 'admin.widget.user_activity_feed') {\n    const entries = data.entries || [];\n    if (!entries.length) return '<p class=\"text-gray-500\">No recent activity</p>';\n    return `<ul class=\"space-y-3\">${entries.map((e) =>\n      `<li class=\"py-3 border-b border-gray-100 last:border-b-0\">\n        <div class=\"font-medium text-gray-900 text-sm\">${escapeHTML(e.actor)}</div>\n        <div class=\"text-gray-500 text-sm mt-1\">${escapeHTML(e.action)} ${escapeHTML(e.object)}</div>\n        ${e.created_at ? `<time class=\"text-xs text-gray-400 mt-1 block\" datetime=\"${escapeHTML(e.created_at)}\" data-relative-time=\"${escapeHTML(e.created_at)}\">${escapeHTML(e.created_at)}</time>` : ''}\n      </li>`\n    ).join('')}</ul>`;\n  }\n\n  return `<pre class=\"text-xs text-gray-600 overflow-auto\">${escapeHTML(JSON.stringify(data, null, 2))}</pre>`;\n}\n\nexport function renderWidget(widget: Widget): string {\n  const span = widget.metadata?.layout?.width || widget.span || 12;\n  const title = widget.data?.title || widget.config?.title || widget.title || getWidgetTitle(widget.definition);\n\n  return `\n    <article class=\"widget\" data-widget=\"${escapeHTML(widget.id || widget.definition || '')}\" data-span=\"${escapeHTML(span)}\" style=\"--span: ${escapeHTML(span)}\">\n      <div class=\"widget__header mb-4\"><h3 class=\"text-lg font-semibold text-gray-900\">${escapeHTML(title)}</h3></div>\n      <div class=\"widget__content\">${renderWidgetContent(widget)}</div>\n    </article>\n  `;\n}\n\nexport function renderWidgetPanel(panel: TabPanel): string {\n  const widgets = Array.isArray(panel.widgets) ? panel.widgets : [];\n  const message = panel.empty_message || 'No widgets configured for this tab.';\n  const content = widgets.length\n    ? `<div class=\"widgets-grid\" data-area-code=\"${escapeHTML(panel.area_code || '')}\">${widgets.map(renderWidget).join('')}</div>`\n    : `<p class=\"text-sm text-gray-500\">${escapeHTML(message)}</p>`;\n\n  return `<div class=\"max-w-4xl bg-white border border-gray-200 rounded-xl overflow-hidden\"><div class=\"p-6\">${content}</div></div>`;\n}\n\nexport function renderDetailsPanel(payload: TabPanelPayload): string {\n  const record = payload.record || {};\n  const fields = Array.isArray(payload.fields) ? payload.fields : [];\n  const displayName = (record.username || record.display_name || record.id || '') as string;\n  const email = (record.email || '') as string;\n  const initial = String(record.username || record.display_name || record.email || record.id || '?').slice(0, 1).toUpperCase();\n\n  return `\n    <div class=\"max-w-4xl bg-white border border-gray-200 rounded-xl overflow-hidden\">\n      <div class=\"p-6 bg-gray-50 border-b border-gray-200 flex items-center gap-4\">\n        <div class=\"w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center text-xl font-semibold text-blue-700\">${escapeHTML(initial)}</div>\n        <div>\n          <h2 class=\"text-xl font-semibold text-gray-900\">${escapeHTML(displayName)}</h2>\n          <p class=\"text-sm text-gray-500\">${escapeHTML(email)}</p>\n        </div>\n      </div>\n      <div class=\"p-6\">\n        <div class=\"text-xs uppercase tracking-wider text-gray-500 font-semibold mb-4\">Details</div>\n        <div class=\"grid grid-cols-2 gap-6\">\n          ${fields.map((f: FieldDefinition) =>\n            `<div class=\"flex flex-col\"><div class=\"text-sm text-gray-500 mb-1\">${escapeHTML(f.label)}</div><div class=\"text-base font-medium text-gray-900\">${escapeHTML(f.value ?? '-')}</div></div>`\n          ).join('')}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nexport function renderPanelLink(panel: TabPanel): string {\n  const href = panel.href || '';\n  const panelName = panel.panel || 'panel';\n\n  if (!href) {\n    return `<div class=\"max-w-4xl bg-white border border-gray-200 rounded-xl overflow-hidden\"><div class=\"p-6 text-sm text-gray-500\">Panel link unavailable.</div></div>`;\n  }\n\n  return `\n    <div class=\"max-w-4xl bg-white border border-gray-200 rounded-xl overflow-hidden\">\n      <div class=\"p-6 space-y-4\">\n        <div class=\"text-xs uppercase tracking-wider text-gray-500 font-semibold\">Linked Panel</div>\n        <p class=\"text-sm text-gray-500\">This tab links to the ${escapeHTML(panelName)} panel.</p>\n        <a href=\"${escapeHTML(href)}\" class=\"btn btn-secondary\">Open panel</a>\n      </div>\n    </div>\n  `;\n}\n\nexport function renderTemplatePanel(panel: TabPanel): string {\n  if (panel.html) return panel.html;\n\n  const msg = panel.template\n    ? `Template tab \"${escapeHTML(panel.template)}\" requires server rendering.`\n    : 'Template tab is missing a template reference.';\n\n  return `<div class=\"max-w-4xl bg-white border border-gray-200 rounded-xl overflow-hidden\"><div class=\"p-6 text-sm text-gray-500\">${msg}</div></div>`;\n}\n\nexport function renderClientTab(payload: TabPanelPayload): string {\n  const panel = payload?.tab || (payload as unknown as TabPanel);\n\n  if (!panel || !panel.kind) {\n    return '<p class=\"text-sm text-gray-500\">No content available.</p>';\n  }\n\n  if (panel.kind === 'dashboard_area' || panel.kind === 'cms_area') {\n    return renderWidgetPanel(panel);\n  }\n\n  if (panel.kind === 'details') {\n    return renderDetailsPanel(payload);\n  }\n\n  if (panel.kind === 'panel') {\n    return renderPanelLink(panel);\n  }\n\n  if (panel.kind === 'template') {\n    return renderTemplatePanel(panel);\n  }\n\n  return '<p class=\"text-sm text-gray-500\">Tab content unavailable.</p>';\n}\n","/**\n * TabsController - Manages tab navigation and content loading for resource detail views\n */\n\nimport type { TabLink, TabPanelContainer, TabControllerOptions } from './types';\nimport { hydrateTimeElements } from './formatters';\nimport { renderClientTab } from './renderers';\n\nexport class TabsController {\n  private tabsNav: HTMLElement;\n  private panelContainer: TabPanelContainer;\n  private tabLinks: TabLink[];\n  private basePath: string;\n  private apiBasePath: string;\n  private panelName: string;\n  private recordId: string;\n  private options: TabControllerOptions;\n\n  constructor(\n    tabsNav: HTMLElement,\n    panelContainer: TabPanelContainer,\n    options: TabControllerOptions = {}\n  ) {\n    this.tabsNav = tabsNav;\n    this.panelContainer = panelContainer;\n    this.tabLinks = Array.from(tabsNav.querySelectorAll('[data-tab-id]')) as TabLink[];\n    this.basePath = (panelContainer.dataset.basePath || '').replace(/\\/$/, '');\n    this.apiBasePath = (panelContainer.dataset.apiBasePath || '').replace(/\\/$/, '');\n    this.panelName = panelContainer.dataset.panel || '';\n    this.recordId = panelContainer.dataset.recordId || '';\n    this.options = options;\n\n    this.init();\n  }\n\n  private init(): void {\n    // Bind click handler\n    this.tabsNav.addEventListener('click', this.handleTabClick.bind(this));\n\n    // Hydrate any existing time elements\n    hydrateTimeElements(this.panelContainer);\n\n    // Load active client tab if needed\n    const activeLink = this.tabsNav.querySelector('.panel-tab-active') as TabLink | null;\n    if (activeLink?.dataset.renderMode === 'client') {\n      this.loadTab(activeLink, { silent: true });\n    }\n  }\n\n  private buildEndpoint(kind: 'html' | 'json', tabId: string): string {\n    if (!this.basePath || !this.panelName || !this.recordId || !tabId) {\n      return '';\n    }\n\n    const safeTab = encodeURIComponent(tabId);\n    const safeRecord = encodeURIComponent(this.recordId);\n\n    if (kind === 'json') {\n      const apiRoot = this.apiBasePath || `${this.basePath}/api`;\n      return `${apiRoot}/${this.panelName}/${safeRecord}/tabs/${safeTab}`;\n    }\n\n    return `${this.basePath}/${this.panelName}/${safeRecord}/tabs/${safeTab}`;\n  }\n\n  private setActiveTab(tabId: string): void {\n    this.tabLinks.forEach((link) => {\n      const isActive = link.dataset.tabId === tabId;\n      link.classList.toggle('panel-tab-active', isActive);\n      link.setAttribute('aria-selected', isActive ? 'true' : 'false');\n    });\n    this.panelContainer.dataset.activeTab = tabId || '';\n\n    this.options.onTabChange?.(tabId);\n  }\n\n  private updateUrl(href: string): void {\n    if (!href) return;\n    try {\n      window.history.pushState({ tab: href }, '', href);\n    } catch (err) {\n      console.warn('[TabsController] Unable to update URL', err);\n    }\n  }\n\n  private handleTabClick(event: Event): void {\n    const link = (event.target as Element).closest('[data-tab-id]') as TabLink | null;\n    if (!link) return;\n\n    const mode = link.dataset.renderMode || '';\n    if (mode !== 'hybrid' && mode !== 'client') return;\n\n    event.preventDefault();\n    this.loadTab(link);\n  }\n\n  async loadTab(link: TabLink, options?: { silent?: boolean }): Promise<boolean> {\n    const mode = link.dataset.renderMode || '';\n    const tabId = link.dataset.tabId || '';\n\n    if (!mode || !tabId) return false;\n\n    const href = link.getAttribute('href') || '';\n    this.setActiveTab(tabId);\n\n    if (!options?.silent) {\n      this.updateUrl(href);\n    }\n\n    this.panelContainer.innerHTML = '<p class=\"text-sm text-gray-500\">Loading tab...</p>';\n\n    try {\n      if (mode === 'hybrid') {\n        const endpoint = this.buildEndpoint('html', tabId);\n        if (!endpoint) throw new Error('missing html endpoint');\n\n        const response = await fetch(endpoint, {\n          headers: { 'X-Requested-With': 'XMLHttpRequest' },\n        });\n\n        if (!response.ok) throw new Error(`tab html ${response.status}`);\n\n        this.panelContainer.innerHTML = await response.text();\n        hydrateTimeElements(this.panelContainer);\n        return true;\n      }\n\n      if (mode === 'client') {\n        const endpoint = this.buildEndpoint('json', tabId);\n        if (!endpoint) throw new Error('missing json endpoint');\n\n        const response = await fetch(endpoint, {\n          headers: { Accept: 'application/json' },\n        });\n\n        if (!response.ok) throw new Error(`tab json ${response.status}`);\n\n        const payload = await response.json();\n        this.panelContainer.innerHTML = renderClientTab(payload);\n        hydrateTimeElements(this.panelContainer);\n        return true;\n      }\n    } catch (err) {\n      console.warn('[TabsController] Failed to load tab', err);\n      this.options.onError?.(err as Error);\n\n      if (href) {\n        window.location.href = href;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Get the currently active tab ID\n   */\n  getActiveTabId(): string {\n    return this.panelContainer.dataset.activeTab || '';\n  }\n\n  /**\n   * Programmatically switch to a tab by ID\n   */\n  switchToTab(tabId: string): void {\n    const link = this.tabLinks.find((l) => l.dataset.tabId === tabId);\n    if (link) {\n      this.loadTab(link);\n    }\n  }\n}\n\n/**\n * Initialize tabs controller for a page\n * Returns the controller instance or null if required elements are not found\n */\nexport function initTabsController(options?: TabControllerOptions): TabsController | null {\n  const tabsNav = document.querySelector('.panel-tabs') as HTMLElement | null;\n  const panelContainer = document.querySelector('[data-tab-panel-container]') as TabPanelContainer | null;\n\n  if (!tabsNav || !panelContainer) {\n    return null;\n  }\n\n  return new TabsController(tabsNav, panelContainer, options);\n}\n"],"names":["escapeHTML","raw","m","formatNumber","value","parseTimestamp","parsed","formatAbsoluteTime","formatRelativeTime","diffMs","absMs","rtf","second","minute","hour","day","month","year","hydrateTimeElements","root","scope","node","absolute","isEmptyValue","WIDGET_TITLES","getWidgetTitle","definition","renderProfileFieldValue","field","valueText","type","status","tone","verified","renderProfileSections","sections","blocks","section","visibleFields","f","renderWidgetContent","widget","def","data","values","k","v","entries","e","renderWidget","span","title","renderWidgetPanel","panel","widgets","message","renderDetailsPanel","payload","record","fields","displayName","email","initial","renderPanelLink","href","panelName","renderTemplatePanel","renderClientTab","TabsController","tabsNav","panelContainer","options","activeLink","kind","tabId","safeTab","safeRecord","link","isActive","err","event","mode","endpoint","response","l","initTabsController"],"mappings":"AAOO,SAASA,EAAWC,GAAsB;AAE/C,SADa,OAAOA,KAAO,EAAE,EACjB,QAAQ,YAAY,CAACC,OAAO;AAAA,IACtC,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,EAAA,GACLA,CAAC,KAAKA,CAAE;AACZ;AAKO,SAASC,EAAaC,GAAwB;AACnD,SAAI,OAAOA,KAAU,WAAiBA,EAAM,eAAA,IACxCA,KAAU,OAAoC,KAC3C,OAAOA,CAAK;AACrB;AAKO,SAASC,EAAeD,GAA6B;AAC1D,MAAIA,KAAU,QAA+BA,MAAU,GAAI,QAAO;AAClE,QAAME,IAAS,IAAI,KAAKF,CAAe;AACvC,SAAO,OAAO,MAAME,EAAO,QAAA,CAAS,IAAI,OAAOA;AACjD;AAKO,SAASC,EAAmBH,GAAwB;AACzD,QAAME,IAASD,EAAeD,CAAK;AACnC,SAAKE,IACE,IAAI,KAAK,eAAe,QAAW;AAAA,IACxC,WAAW;AAAA,IACX,WAAW;AAAA,EAAA,CACZ,EAAE,OAAOA,CAAM,IAJI,OAAOF,KAAS,EAAE;AAKxC;AAKO,SAASI,EAAmBJ,GAAwB;AACzD,QAAME,IAASD,EAAeD,CAAK;AACnC,MAAI,CAACE,EAAQ,QAAO,OAAOF,KAAS,EAAE;AAEtC,QAAMK,IAASH,EAAO,QAAA,IAAY,KAAK,IAAA,GACjCI,IAAQ,KAAK,IAAID,CAAM,GACvBE,IAAM,IAAI,KAAK,mBAAmB,QAAW,EAAE,SAAS,QAAQ,GAEhEC,IAAS,KACTC,IAAS,KAAKD,GACdE,IAAO,KAAKD,GACZE,IAAM,KAAKD,GACXE,IAAQ,KAAKD,GACbE,IAAO,MAAMF;AAEnB,SAAIL,IAAQG,IAAeF,EAAI,OAAO,KAAK,MAAMF,IAASG,CAAM,GAAG,QAAQ,IACvEF,IAAQI,IAAaH,EAAI,OAAO,KAAK,MAAMF,IAASI,CAAM,GAAG,QAAQ,IACrEH,IAAQK,IAAYJ,EAAI,OAAO,KAAK,MAAMF,IAASK,CAAI,GAAG,MAAM,IAChEJ,IAAQM,IAAcL,EAAI,OAAO,KAAK,MAAMF,IAASM,CAAG,GAAG,KAAK,IAChEL,IAAQO,IAAaN,EAAI,OAAO,KAAK,MAAMF,IAASO,CAAK,GAAG,OAAO,IAChEL,EAAI,OAAO,KAAK,MAAMF,IAASQ,CAAI,GAAG,MAAM;AACrD;AAKO,SAASC,EAAoBC,GAAwC;AAC1E,QAAMC,IAAQD,KAAQ;AAEtB,EAAAC,EAAM,iBAAiB,sBAAsB,EAAE,QAAQ,CAACC,MAAS;AAC/D,UAAMpB,IAAMoB,EAAK,aAAa,oBAAoB;AAClD,QAAI,CAACpB,EAAK;AACV,IAAAoB,EAAK,cAAcb,EAAmBP,CAAG;AACzC,UAAMqB,IAAWf,EAAmBN,CAAG;AACvC,IAAIqB,KAAUD,EAAK,aAAa,SAASC,CAAQ;AAAA,EACnD,CAAC,GAEDF,EAAM,iBAAiB,sBAAsB,EAAE,QAAQ,CAACC,MAAS;AAC/D,UAAMpB,IAAMoB,EAAK,aAAa,oBAAoB;AAClD,QAAI,CAACpB,EAAK;AACV,UAAMqB,IAAWf,EAAmBN,CAAG;AACvC,IAAAoB,EAAK,cAAcC,GACfA,KAAUD,EAAK,aAAa,SAASC,CAAQ;AAAA,EACnD,CAAC;AACH;AAKO,SAASC,EAAanB,GAAyB;AACpD,SAAOA,KAAU,QAA+B,OAAOA,CAAK,EAAE,WAAW;AAC3E;ACxFA,MAAMoB,IAAwC;AAAA,EAC5C,2BAA2B;AAAA,EAC3B,8BAA8B;AAAA,EAC9B,mCAAmC;AAAA,EACnC,8BAA8B;AAAA,EAC9B,8BAA8B;AAAA,EAC9B,kCAAkC;AAAA,EAClC,sCAAsC;AAAA,EACtC,8BAA8B;AAAA,EAC9B,8BAA8B;AAAA,EAC9B,8BAA8B;AAChC;AAEA,SAASC,EAAeC,GAA6B;AACnD,SAAKA,IACEF,EAAcE,CAAU,KAAKA,EAAW,QAAQ,MAAM,GAAG,IADxC;AAE1B;AAEA,SAASC,EAAwBC,GAA6B;AAC5D,QAAMxB,IAAQwB,GAAO,UAAU,UAAaA,GAAO,UAAU,OAAOA,EAAM,QAAQ,KAC5EC,IAAY7B,EAAWI,CAAK,GAC5B0B,IAAO,OAAOF,GAAO,QAAQ,MAAM,EAAE,YAAA;AAE3C,MAAIE,MAAS;AACX,WAAO,mHAAmHD,CAAS;AAGrI,MAAIC,MAAS,UAAU;AACrB,UAAMC,IAAS,OAAO3B,KAAS,EAAE,EAAE,YAAA,GAC7B4B,IAAQ;AAAA,MACZ,QAAQ,EAAE,KAAK,gBAAgB,MAAM,iBAAA;AAAA,MACrC,UAAU,EAAE,KAAK,eAAe,MAAM,gBAAA;AAAA,MACtC,WAAW,EAAE,KAAK,cAAc,MAAM,eAAA;AAAA,MACtC,SAAS,EAAE,KAAK,iBAAiB,MAAM,kBAAA;AAAA,IAAkB,EACPD,CAAM,KAAK,EAAE,KAAK,eAAe,MAAM,gBAAA;AAC3F,WAAO,oFAAoFC,EAAK,GAAG,yBAAyBA,EAAK,IAAI,KAAKH,CAAS;AAAA,EACrJ;AAEA,MAAIC,MAAS,YAAY;AACvB,UAAMG,IAAW,EAAQL,GAAO;AAChC,WAAO,wDAAwDC,CAAS,uBAAuBI,IAAW,mBAAmB,eAAe,KAAKA,IAAW,MAAM,GAAG;AAAA,EACvK;AAEA,SAAIH,MAAS,SACJ,mBAAmBD,CAAS,yBAAyBA,CAAS,KAAKA,CAAS,YAGjFC,MAAS,aACJ,mBAAmBD,CAAS,yBAAyBA,CAAS,KAAKA,CAAS,YAG9EA;AACT;AAEA,SAASK,EAAsBC,GAAoC;AACjE,QAAMC,IAASD,EAAS,IAAI,CAACE,MAAY;AAEvC,UAAMC,KADS,MAAM,QAAQD,GAAS,MAAM,IAAIA,EAAQ,SAAS,CAAA,GACpC,OAAO,CAACE,MAAM,EAAEA,GAAG,iBAAiBhB,EAAagB,GAAG,KAAK,EAAE;AACxF,WAAKD,EAAc,SAEZ;AAAA;AAAA,yFAE8EtC,EAAWqC,GAAS,SAAS,EAAE,CAAC;AAAA;AAAA,YAE7GC,EAAc,IAAI,CAACC,MAAM;AAAA;AAAA,kDAEavC,EAAWuC,GAAG,SAASA,GAAG,OAAO,EAAE,CAAC;AAAA,yEACbZ,EAAwBY,CAAC,CAAC;AAAA;AAAA,WAExF,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,QAXiB;AAAA,EAepC,CAAC,EAAE,OAAO,OAAO;AAEjB,SAAOH,EAAO,SACV,0BAA0BA,EAAO,KAAK,EAAE,CAAC,WACzC;AACN;AAEA,SAASI,EAAoBC,GAAwB;AACnD,QAAMC,IAAMD,EAAO,cAAc,IAC3BE,IAAOF,EAAO,QAAQ,CAAA;AAE5B,MAAIC,MAAQ,2BAA2B;AACrC,UAAME,IAASD,EAAK,UAAU,EAAE,OAAOA,EAAK,OAAO,QAAQA,EAAK,QAAQ,aAAaA,EAAK,UAAA;AAC1F,WAAO,wBAAwB,OAAO,QAAQC,CAAM,EAAE;AAAA,MAAI,CAAC,CAACC,GAAGC,CAAC,MAC9D,8BAA8B9C,EAAW6C,CAAC,CAAC,iBAAiB7C,EAAWG,EAAa2C,CAAC,CAAC,CAAC;AAAA,IAAA,EACvF,KAAK,EAAE,CAAC;AAAA,EACZ;AAEA,MAAIJ,MAAQ,kCAAkC;AAC5C,UAAME,IAASD,EAAK,UAAU,CAAA,GACxBI,IAAU,OAAO,QAAQH,CAAM;AACrC,WAAKG,EAAQ,SACN,yBAAyBA,EAAQ;AAAA,MAAI,CAAC,CAACF,GAAGC,CAAC,MAChD,yFAAyF9C,EAAW6C,CAAC,CAAC,sDAAsD7C,EAAW8C,KAAK,GAAG,CAAC;AAAA,IAAA,EAChL,KAAK,EAAE,CAAC,UAHkB;AAAA,EAI9B;AAEA,MAAIJ,MAAQ,sCAAsC;AAChD,UAAMP,IAAW,MAAM,QAAQQ,EAAK,QAAQ,IAAIA,EAAK,WAAW,CAAA;AAChE,WAAKR,EAAS,SACPD,EAAsBC,CAAQ,IADR;AAAA,EAE/B;AAEA,MAAIO,MAAQ,gCAAgCA,MAAQ,mCAAmC;AACrF,UAAMK,IAAUJ,EAAK,WAAW,CAAA;AAChC,WAAKI,EAAQ,SACN,yBAAyBA,EAAQ;AAAA,MAAI,CAACC,MAC3C;AAAA,yDACmDhD,EAAWgD,EAAE,KAAK,CAAC;AAAA,kDAC1BhD,EAAWgD,EAAE,MAAM,CAAC,IAAIhD,EAAWgD,EAAE,MAAM,CAAC;AAAA,UACpFA,EAAE,aAAa,4DAA4DhD,EAAWgD,EAAE,UAAU,CAAC,yBAAyBhD,EAAWgD,EAAE,UAAU,CAAC,KAAKhD,EAAWgD,EAAE,UAAU,CAAC,YAAY,EAAE;AAAA;AAAA,IAAA,EAEnM,KAAK,EAAE,CAAC,UAPkB;AAAA,EAQ9B;AAEA,SAAO,oDAAoDhD,EAAW,KAAK,UAAU2C,GAAM,MAAM,CAAC,CAAC,CAAC;AACtG;AAEO,SAASM,EAAaR,GAAwB;AACnD,QAAMS,IAAOT,EAAO,UAAU,QAAQ,SAASA,EAAO,QAAQ,IACxDU,IAAQV,EAAO,MAAM,SAASA,EAAO,QAAQ,SAASA,EAAO,SAAShB,EAAegB,EAAO,UAAU;AAE5G,SAAO;AAAA,2CACkCzC,EAAWyC,EAAO,MAAMA,EAAO,cAAc,EAAE,CAAC,gBAAgBzC,EAAWkD,CAAI,CAAC,oBAAoBlD,EAAWkD,CAAI,CAAC;AAAA,yFACtElD,EAAWmD,CAAK,CAAC;AAAA,qCACrEX,EAAoBC,CAAM,CAAC;AAAA;AAAA;AAGhE;AAEO,SAASW,EAAkBC,GAAyB;AACzD,QAAMC,IAAU,MAAM,QAAQD,EAAM,OAAO,IAAIA,EAAM,UAAU,CAAA,GACzDE,IAAUF,EAAM,iBAAiB;AAKvC,SAAO,sGAJSC,EAAQ,SACpB,6CAA6CtD,EAAWqD,EAAM,aAAa,EAAE,CAAC,KAAKC,EAAQ,IAAIL,CAAY,EAAE,KAAK,EAAE,CAAC,WACrH,oCAAoCjD,EAAWuD,CAAO,CAAC,MAEyD;AACtH;AAEO,SAASC,EAAmBC,GAAkC;AACnE,QAAMC,IAASD,EAAQ,UAAU,CAAA,GAC3BE,IAAS,MAAM,QAAQF,EAAQ,MAAM,IAAIA,EAAQ,SAAS,CAAA,GAC1DG,IAAeF,EAAO,YAAYA,EAAO,gBAAgBA,EAAO,MAAM,IACtEG,IAASH,EAAO,SAAS,IACzBI,IAAU,OAAOJ,EAAO,YAAYA,EAAO,gBAAgBA,EAAO,SAASA,EAAO,MAAM,GAAG,EAAE,MAAM,GAAG,CAAC,EAAE,YAAA;AAE/G,SAAO;AAAA;AAAA;AAAA,+HAGsH1D,EAAW8D,CAAO,CAAC;AAAA;AAAA,4DAEtF9D,EAAW4D,CAAW,CAAC;AAAA,6CACtC5D,EAAW6D,CAAK,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAMlDF,EAAO;AAAA,IAAI,CAACpB,MACZ,sEAAsEvC,EAAWuC,EAAE,KAAK,CAAC,0DAA0DvC,EAAWuC,EAAE,SAAS,GAAG,CAAC;AAAA,EAAA,EAC7K,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAKpB;AAEO,SAASwB,EAAgBV,GAAyB;AACvD,QAAMW,IAAOX,EAAM,QAAQ,IACrBY,IAAYZ,EAAM,SAAS;AAEjC,SAAKW,IAIE;AAAA;AAAA;AAAA;AAAA,iEAIwDhE,EAAWiE,CAAS,CAAC;AAAA,mBACnEjE,EAAWgE,CAAI,CAAC;AAAA;AAAA;AAAA,MARxB;AAYX;AAEO,SAASE,EAAoBb,GAAyB;AAC3D,SAAIA,EAAM,OAAaA,EAAM,OAMtB,4HAJKA,EAAM,WACd,iBAAiBrD,EAAWqD,EAAM,QAAQ,CAAC,iCAC3C,+CAEkI;AACxI;AAEO,SAASc,EAAgBV,GAAkC;AAChE,QAAMJ,IAAQI,GAAS,OAAQA;AAE/B,SAAI,CAACJ,KAAS,CAACA,EAAM,OACZ,+DAGLA,EAAM,SAAS,oBAAoBA,EAAM,SAAS,aAC7CD,EAAkBC,CAAK,IAG5BA,EAAM,SAAS,YACVG,EAAmBC,CAAO,IAG/BJ,EAAM,SAAS,UACVU,EAAgBV,CAAK,IAG1BA,EAAM,SAAS,aACVa,EAAoBb,CAAK,IAG3B;AACT;ACtOO,MAAMe,EAAe;AAAA,EAU1B,YACEC,GACAC,GACAC,IAAgC,CAAA,GAChC;AACA,SAAK,UAAUF,GACf,KAAK,iBAAiBC,GACtB,KAAK,WAAW,MAAM,KAAKD,EAAQ,iBAAiB,eAAe,CAAC,GACpE,KAAK,YAAYC,EAAe,QAAQ,YAAY,IAAI,QAAQ,OAAO,EAAE,GACzE,KAAK,eAAeA,EAAe,QAAQ,eAAe,IAAI,QAAQ,OAAO,EAAE,GAC/E,KAAK,YAAYA,EAAe,QAAQ,SAAS,IACjD,KAAK,WAAWA,EAAe,QAAQ,YAAY,IACnD,KAAK,UAAUC,GAEf,KAAK,KAAA;AAAA,EACP;AAAA,EAEQ,OAAa;AAEnB,SAAK,QAAQ,iBAAiB,SAAS,KAAK,eAAe,KAAK,IAAI,CAAC,GAGrErD,EAAoB,KAAK,cAAc;AAGvC,UAAMsD,IAAa,KAAK,QAAQ,cAAc,mBAAmB;AACjE,IAAIA,GAAY,QAAQ,eAAe,YACrC,KAAK,QAAQA,GAAY,EAAE,QAAQ,IAAM;AAAA,EAE7C;AAAA,EAEQ,cAAcC,GAAuBC,GAAuB;AAClE,QAAI,CAAC,KAAK,YAAY,CAAC,KAAK,aAAa,CAAC,KAAK,YAAY,CAACA;AAC1D,aAAO;AAGT,UAAMC,IAAU,mBAAmBD,CAAK,GAClCE,IAAa,mBAAmB,KAAK,QAAQ;AAEnD,WAAIH,MAAS,SAEJ,GADS,KAAK,eAAe,GAAG,KAAK,QAAQ,MACnC,IAAI,KAAK,SAAS,IAAIG,CAAU,SAASD,CAAO,KAG5D,GAAG,KAAK,QAAQ,IAAI,KAAK,SAAS,IAAIC,CAAU,SAASD,CAAO;AAAA,EACzE;AAAA,EAEQ,aAAaD,GAAqB;AACxC,SAAK,SAAS,QAAQ,CAACG,MAAS;AAC9B,YAAMC,IAAWD,EAAK,QAAQ,UAAUH;AACxC,MAAAG,EAAK,UAAU,OAAO,oBAAoBC,CAAQ,GAClDD,EAAK,aAAa,iBAAiBC,IAAW,SAAS,OAAO;AAAA,IAChE,CAAC,GACD,KAAK,eAAe,QAAQ,YAAYJ,KAAS,IAEjD,KAAK,QAAQ,cAAcA,CAAK;AAAA,EAClC;AAAA,EAEQ,UAAUV,GAAoB;AACpC,QAAKA;AACL,UAAI;AACF,eAAO,QAAQ,UAAU,EAAE,KAAKA,EAAA,GAAQ,IAAIA,CAAI;AAAA,MAClD,SAASe,GAAK;AACZ,gBAAQ,KAAK,yCAAyCA,CAAG;AAAA,MAC3D;AAAA,EACF;AAAA,EAEQ,eAAeC,GAAoB;AACzC,UAAMH,IAAQG,EAAM,OAAmB,QAAQ,eAAe;AAC9D,QAAI,CAACH,EAAM;AAEX,UAAMI,IAAOJ,EAAK,QAAQ,cAAc;AACxC,IAAII,MAAS,YAAYA,MAAS,aAElCD,EAAM,eAAA,GACN,KAAK,QAAQH,CAAI;AAAA,EACnB;AAAA,EAEA,MAAM,QAAQA,GAAeN,GAAkD;AAC7E,UAAMU,IAAOJ,EAAK,QAAQ,cAAc,IAClCH,IAAQG,EAAK,QAAQ,SAAS;AAEpC,QAAI,CAACI,KAAQ,CAACP,EAAO,QAAO;AAE5B,UAAMV,IAAOa,EAAK,aAAa,MAAM,KAAK;AAC1C,SAAK,aAAaH,CAAK,GAElBH,GAAS,UACZ,KAAK,UAAUP,CAAI,GAGrB,KAAK,eAAe,YAAY;AAEhC,QAAI;AACF,UAAIiB,MAAS,UAAU;AACrB,cAAMC,IAAW,KAAK,cAAc,QAAQR,CAAK;AACjD,YAAI,CAACQ,EAAU,OAAM,IAAI,MAAM,uBAAuB;AAEtD,cAAMC,IAAW,MAAM,MAAMD,GAAU;AAAA,UACrC,SAAS,EAAE,oBAAoB,iBAAA;AAAA,QAAiB,CACjD;AAED,YAAI,CAACC,EAAS,GAAI,OAAM,IAAI,MAAM,YAAYA,EAAS,MAAM,EAAE;AAE/D,oBAAK,eAAe,YAAY,MAAMA,EAAS,KAAA,GAC/CjE,EAAoB,KAAK,cAAc,GAChC;AAAA,MACT;AAEA,UAAI+D,MAAS,UAAU;AACrB,cAAMC,IAAW,KAAK,cAAc,QAAQR,CAAK;AACjD,YAAI,CAACQ,EAAU,OAAM,IAAI,MAAM,uBAAuB;AAEtD,cAAMC,IAAW,MAAM,MAAMD,GAAU;AAAA,UACrC,SAAS,EAAE,QAAQ,mBAAA;AAAA,QAAmB,CACvC;AAED,YAAI,CAACC,EAAS,GAAI,OAAM,IAAI,MAAM,YAAYA,EAAS,MAAM,EAAE;AAE/D,cAAM1B,IAAU,MAAM0B,EAAS,KAAA;AAC/B,oBAAK,eAAe,YAAYhB,EAAgBV,CAAO,GACvDvC,EAAoB,KAAK,cAAc,GAChC;AAAA,MACT;AAAA,IACF,SAAS6D,GAAK;AACZ,cAAQ,KAAK,uCAAuCA,CAAG,GACvD,KAAK,QAAQ,UAAUA,CAAY,GAE/Bf,MACF,OAAO,SAAS,OAAOA;AAAA,IAE3B;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAyB;AACvB,WAAO,KAAK,eAAe,QAAQ,aAAa;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKA,YAAYU,GAAqB;AAC/B,UAAMG,IAAO,KAAK,SAAS,KAAK,CAACO,MAAMA,EAAE,QAAQ,UAAUV,CAAK;AAChE,IAAIG,KACF,KAAK,QAAQA,CAAI;AAAA,EAErB;AACF;AAMO,SAASQ,EAAmBd,GAAuD;AACxF,QAAMF,IAAU,SAAS,cAAc,aAAa,GAC9CC,IAAiB,SAAS,cAAc,4BAA4B;AAE1E,SAAI,CAACD,KAAW,CAACC,IACR,OAGF,IAAIF,EAAeC,GAASC,GAAgBC,CAAO;AAC5D;"}