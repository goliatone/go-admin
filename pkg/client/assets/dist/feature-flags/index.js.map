{"version":3,"file":"index.js","sources":["../../src/feature-flags/scope-search/scope-search-box.ts","../../src/feature-flags/feature-flags-manager.ts"],"sourcesContent":["/**\n * Scope Search Box\n * Specialized search box for feature flags scope selection\n * Switches resolver/renderer based on selected scope type\n */\n\nimport { SearchBox } from '../../searchbox/search-box.js';\nimport { createCrudResolver } from '../../searchbox/resolvers/api-resolver.js';\nimport { UserRenderer } from '../../searchbox/renderers/user-renderer.js';\nimport { EntityRenderer } from '../../searchbox/renderers/entity-renderer.js';\nimport type { SearchResult, SearchResolver } from '../../searchbox/types.js';\nimport type { ScopeSearchBoxConfig, ScopeConfig, ScopeType } from './types.js';\n\n/**\n * Noop resolver for system scope (no search needed)\n */\nclass SystemResolver implements SearchResolver {\n  async search(): Promise<SearchResult[]> {\n    return [];\n  }\n}\n\nexport class ScopeSearchBox {\n  private config: ScopeSearchBoxConfig;\n  private input: HTMLInputElement;\n  private scopeSelect: HTMLSelectElement;\n  private container: HTMLElement;\n  private searchBox: SearchBox | null = null;\n  private scopeConfigs: Map<ScopeType, ScopeConfig> = new Map();\n  private currentScope: ScopeType = 'system';\n  private selectedResult: SearchResult | null = null;\n\n  constructor(config: ScopeSearchBoxConfig) {\n    this.config = config;\n\n    // Resolve input element\n    if (typeof config.input === 'string') {\n      const el = document.querySelector<HTMLInputElement>(config.input);\n      if (!el) throw new Error(`ScopeSearchBox: Input element not found: ${config.input}`);\n      this.input = el;\n    } else {\n      this.input = config.input;\n    }\n\n    // Resolve scope select element\n    if (typeof config.scopeSelect === 'string') {\n      const el = document.querySelector<HTMLSelectElement>(config.scopeSelect);\n      if (!el) throw new Error(`ScopeSearchBox: Scope select not found: ${config.scopeSelect}`);\n      this.scopeSelect = el;\n    } else {\n      this.scopeSelect = config.scopeSelect;\n    }\n\n    // Resolve container\n    if (config.container) {\n      if (typeof config.container === 'string') {\n        const el = document.querySelector<HTMLElement>(config.container);\n        if (!el) throw new Error(`ScopeSearchBox: Container not found: ${config.container}`);\n        this.container = el;\n      } else {\n        this.container = config.container;\n      }\n    } else {\n      this.container = this.input.parentElement || document.body;\n    }\n\n    // Index scope configs\n    for (const scopeConfig of config.scopeConfigs) {\n      this.scopeConfigs.set(scopeConfig.scope, scopeConfig);\n    }\n  }\n\n  /**\n   * Initialize the scope search box\n   */\n  init(): void {\n    this.bindScopeSelect();\n    this.currentScope = (this.scopeSelect.value as ScopeType) || 'system';\n    this.updateForScope(this.currentScope);\n  }\n\n  /**\n   * Destroy and clean up\n   */\n  destroy(): void {\n    if (this.searchBox) {\n      this.searchBox.destroy();\n      this.searchBox = null;\n    }\n  }\n\n  /**\n   * Get the currently selected scope type\n   */\n  getScope(): ScopeType {\n    return this.currentScope;\n  }\n\n  /**\n   * Get the currently selected scope ID\n   */\n  getScopeId(): string {\n    return this.input.value.trim();\n  }\n\n  /**\n   * Get the selected result data\n   */\n  getSelectedResult(): SearchResult | null {\n    return this.selectedResult;\n  }\n\n  /**\n   * Programmatically set the scope\n   */\n  setScope(scope: ScopeType): void {\n    this.scopeSelect.value = scope;\n    this.updateForScope(scope);\n  }\n\n  /**\n   * Programmatically set the scope ID\n   */\n  setScopeId(id: string): void {\n    this.input.value = id;\n    if (this.searchBox) {\n      this.searchBox.setValue(id);\n    }\n  }\n\n  /**\n   * Clear the scope ID\n   */\n  clear(): void {\n    this.selectedResult = null;\n    if (this.searchBox) {\n      this.searchBox.clear();\n    } else {\n      this.input.value = '';\n    }\n    this.config.onClear?.();\n  }\n\n  private bindScopeSelect(): void {\n    this.scopeSelect.addEventListener('change', () => {\n      const newScope = this.scopeSelect.value as ScopeType;\n      this.updateForScope(newScope);\n      this.config.onScopeChange?.(newScope);\n    });\n  }\n\n  private updateForScope(scope: ScopeType): void {\n    this.currentScope = scope;\n    this.selectedResult = null;\n\n    // Destroy existing search box\n    if (this.searchBox) {\n      this.searchBox.destroy();\n      this.searchBox = null;\n    }\n\n    // System scope doesn't need search\n    if (scope === 'system') {\n      this.input.value = '';\n      this.input.disabled = true;\n      this.input.placeholder = 'N/A (System scope)';\n      return;\n    }\n\n    // Enable input\n    this.input.disabled = false;\n    this.input.value = '';\n\n    // Get scope-specific config\n    const scopeConfig = this.scopeConfigs.get(scope);\n\n    if (scopeConfig) {\n      // Create search box with scope-specific config\n      this.searchBox = new SearchBox({\n        input: this.input,\n        container: this.container,\n        resolver: scopeConfig.resolver,\n        renderer: scopeConfig.renderer,\n        placeholder: scopeConfig.placeholder || this.getDefaultPlaceholder(scope),\n        minChars: scopeConfig.minChars ?? 2,\n        onSelect: (result) => {\n          this.selectedResult = result;\n          this.config.onSelect?.(scope, result);\n        },\n        onClear: () => {\n          this.selectedResult = null;\n          this.config.onClear?.();\n        },\n      });\n      this.searchBox.init();\n    } else {\n      // No config for this scope - just use plain input\n      this.input.placeholder = this.getDefaultPlaceholder(scope);\n    }\n  }\n\n  private getDefaultPlaceholder(scope: ScopeType): string {\n    const placeholders: Record<ScopeType, string> = {\n      system: 'N/A',\n      tenant: 'Search tenants...',\n      org: 'Search organizations...',\n      user: 'Search users...',\n    };\n    return this.config.defaultPlaceholder || placeholders[scope] || 'Enter ID...';\n  }\n}\n\n/**\n * Create default scope configs for common go-admin setup\n * Uses go-crud endpoints for tenants, orgs, and users\n */\nexport function createDefaultScopeConfigs(basePath: string): ScopeConfig[] {\n  return [\n    {\n      scope: 'tenant',\n      resolver: createCrudResolver<Record<string, unknown>>(`${basePath}/api/tenants`, {\n        labelField: (item) => String(item.name || ''),\n        descriptionField: (item) => String(item.slug || ''),\n        searchParam: 'q',\n      }),\n      renderer: new EntityRenderer({\n        badgeField: 'status',\n      }),\n      placeholder: 'Search tenants by name...',\n    },\n    {\n      scope: 'org',\n      resolver: createCrudResolver<Record<string, unknown>>(`${basePath}/api/organizations`, {\n        labelField: (item) => String(item.name || ''),\n        searchParam: 'q',\n      }),\n      renderer: new EntityRenderer({\n        badgeField: 'status',\n      }),\n      placeholder: 'Search organizations...',\n    },\n    {\n      scope: 'user',\n      resolver: createCrudResolver<Record<string, unknown>>(`${basePath}/api/users`, {\n        labelField: (item) => String(item.displayName || item.username || item.email || ''),\n        descriptionField: (item) => String(item.email || ''),\n        searchParam: 'q',\n      }),\n      renderer: new UserRenderer({\n        avatarField: 'avatar',\n        emailField: 'email',\n        roleField: 'role',\n      }),\n      placeholder: 'Search users...',\n    },\n  ];\n}\n\n/**\n * Factory function to create ScopeSearchBox with common defaults\n */\nexport function createScopeSearchBox(options: {\n  inputSelector: string;\n  scopeSelectSelector: string;\n  containerSelector?: string;\n  basePath: string;\n  customConfigs?: Partial<Record<ScopeType, Partial<ScopeConfig>>>;\n  onSelect?: (scope: ScopeType, result: SearchResult) => void;\n  onScopeChange?: (scope: ScopeType) => void;\n}): ScopeSearchBox {\n  const defaultConfigs: ScopeConfig[] = [\n    {\n      scope: 'tenant',\n      resolver: createCrudResolver<Record<string, unknown>>(`${options.basePath}/crud/tenants`, {\n        labelField: (item) => String(item.name || ''),\n        descriptionField: (item) => String(item.slug || ''),\n        searchParam: 'q',\n      }),\n      renderer: new EntityRenderer({\n        badgeField: 'status',\n      }),\n      placeholder: 'Search tenants...',\n    },\n    {\n      scope: 'org',\n      resolver: createCrudResolver<Record<string, unknown>>(`${options.basePath}/crud/organizations`, {\n        labelField: (item) => String(item.name || ''),\n        searchParam: 'q',\n      }),\n      renderer: new EntityRenderer({\n        badgeField: 'status',\n      }),\n      placeholder: 'Search organizations...',\n    },\n    {\n      scope: 'user',\n      resolver: createCrudResolver<Record<string, unknown>>(`${options.basePath}/crud/users`, {\n        labelField: (item) => String(item.display_name || item.username || item.email || ''),\n        descriptionField: (item) => String(item.email || ''),\n        searchParam: 'q',\n      }),\n      renderer: new UserRenderer({\n        avatarField: 'avatar',\n        emailField: 'email',\n        roleField: 'role',\n      }),\n      placeholder: 'Search users...',\n    },\n  ];\n\n  // Merge custom configs\n  const scopeConfigs = defaultConfigs.map((config) => {\n    const custom = options.customConfigs?.[config.scope];\n    if (custom) {\n      return { ...config, ...custom };\n    }\n    return config;\n  });\n\n  return new ScopeSearchBox({\n    input: options.inputSelector,\n    scopeSelect: options.scopeSelectSelector,\n    container: options.containerSelector,\n    scopeConfigs,\n    onSelect: options.onSelect,\n    onScopeChange: options.onScopeChange,\n  });\n}\n","/**\n * Feature Flags Manager\n * Manages feature flag display, filtering, and updates\n */\n\nimport type {\n  Flag,\n  FlagsPayload,\n  FeatureFlagsConfig,\n  FeatureFlagsSelectors,\n  OverrideState,\n  ActionMenuOption,\n  ToastNotifier,\n} from './types.js';\nimport type { ScopeType, ScopeConfig } from './scope-search/types.js';\nimport { ScopeSearchBox } from './scope-search/scope-search-box.js';\nimport { createCrudResolver } from '../searchbox/resolvers/api-resolver.js';\nimport { UserRenderer } from '../searchbox/renderers/user-renderer.js';\nimport { EntityRenderer } from '../searchbox/renderers/entity-renderer.js';\n\nconst DEFAULT_SELECTORS: FeatureFlagsSelectors = {\n  scopeSelect: '#flag-scope',\n  scopeIdInput: '#flag-scope-id',\n  applyScopeBtn: '#apply-scope',\n  refreshBtn: '#refresh-flags',\n  searchInput: '#flag-search',\n  mutableState: '#mutable-state',\n  tableBody: '#flags-table',\n  emptyState: '#flags-empty',\n};\n\nconst ACTION_OPTIONS: ActionMenuOption[] = [\n  { value: 'unset', label: 'Default', icon: 'minus' },\n  { value: 'enabled', label: 'Enabled', icon: 'check' },\n  { value: 'disabled', label: 'Disabled', icon: 'x' },\n];\n\nconst ICONS: Record<string, string> = {\n  check: '<svg class=\"w-4 h-4 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>',\n  x: '<svg class=\"w-4 h-4 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>',\n  minus: '<svg class=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"/></svg>',\n  chevronDown: '<svg class=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>',\n};\n\nexport class FeatureFlagsManager {\n  private config: FeatureFlagsConfig;\n  private selectors: FeatureFlagsSelectors;\n  private toast: ToastNotifier | null;\n\n  private scopeSelect: HTMLSelectElement | null = null;\n  private scopeIdInput: HTMLInputElement | null = null;\n  private applyScopeBtn: HTMLButtonElement | null = null;\n  private refreshBtn: HTMLButtonElement | null = null;\n  private searchInput: HTMLInputElement | null = null;\n  private mutableStateEl: HTMLElement | null = null;\n  private tableBody: HTMLTableSectionElement | null = null;\n  private emptyState: HTMLElement | null = null;\n\n  private allFlags: Flag[] = [];\n  private isMutable = false;\n  private documentClickHandler: (() => void) | null = null;\n  private scopeSearchBox: ScopeSearchBox | null = null;\n\n  constructor(\n    config: FeatureFlagsConfig,\n    selectors: Partial<FeatureFlagsSelectors> = {},\n    toast?: ToastNotifier\n  ) {\n    this.config = config;\n    this.selectors = { ...DEFAULT_SELECTORS, ...selectors };\n    this.toast = toast || (window as any).toastManager || null;\n  }\n\n  /**\n   * Initialize the feature flags manager\n   */\n  init(): void {\n    this.cacheElements();\n    this.bindEvents();\n    this.initScopeSearch();\n    this.syncFromQuery();\n    this.loadFlags();\n  }\n\n  /**\n   * Destroy the manager and clean up event listeners\n   */\n  destroy(): void {\n    if (this.documentClickHandler) {\n      document.removeEventListener('click', this.documentClickHandler);\n      this.documentClickHandler = null;\n    }\n    if (this.scopeSearchBox) {\n      this.scopeSearchBox.destroy();\n      this.scopeSearchBox = null;\n    }\n  }\n\n  private cacheElements(): void {\n    this.scopeSelect = document.querySelector<HTMLSelectElement>(this.selectors.scopeSelect);\n    this.scopeIdInput = document.querySelector<HTMLInputElement>(this.selectors.scopeIdInput);\n    this.applyScopeBtn = document.querySelector<HTMLButtonElement>(this.selectors.applyScopeBtn);\n    this.refreshBtn = document.querySelector<HTMLButtonElement>(this.selectors.refreshBtn);\n    this.searchInput = document.querySelector<HTMLInputElement>(this.selectors.searchInput);\n    this.mutableStateEl = document.querySelector<HTMLElement>(this.selectors.mutableState);\n    this.tableBody = document.querySelector<HTMLTableSectionElement>(this.selectors.tableBody);\n    this.emptyState = document.querySelector<HTMLElement>(this.selectors.emptyState);\n  }\n\n  private bindEvents(): void {\n    this.applyScopeBtn?.addEventListener('click', () => this.loadFlags());\n    this.refreshBtn?.addEventListener('click', () => this.loadFlags());\n    this.searchInput?.addEventListener('input', () => this.renderFlags(this.allFlags, this.isMutable));\n\n    // Global click handler to close dropdowns\n    this.documentClickHandler = () => {\n      document.querySelectorAll('.action-menu-dropdown').forEach((d) => d.classList.add('hidden'));\n    };\n    document.addEventListener('click', this.documentClickHandler);\n  }\n\n  private initScopeSearch(): void {\n    if (!this.scopeSelect || !this.scopeIdInput) return;\n\n    // Build scope configs for tenant, org, user\n    const scopeConfigs = this.buildScopeConfigs();\n\n    // Create container for the searchbox dropdown\n    const container = this.scopeIdInput.parentElement;\n    if (!container) return;\n\n    // Ensure container has relative positioning for dropdown\n    container.style.position = 'relative';\n\n    this.scopeSearchBox = new ScopeSearchBox({\n      input: this.scopeIdInput,\n      scopeSelect: this.scopeSelect,\n      container,\n      scopeConfigs,\n      onSelect: (scope, result) => {\n        // When a result is selected, use its ID\n        if (this.scopeIdInput) {\n          this.scopeIdInput.value = result.id;\n        }\n      },\n      onScopeChange: (scope) => {\n        // When scope changes, clear the ID and reload\n        if (scope === 'system') {\n          this.loadFlags();\n        }\n      },\n      onClear: () => {\n        // Nothing to do on clear\n      },\n    });\n\n    this.scopeSearchBox.init();\n  }\n\n  private buildScopeConfigs(): ScopeConfig[] {\n    const basePath = this.config.basePath;\n\n    return [\n      {\n        scope: 'tenant' as ScopeType,\n        resolver: createCrudResolver<Record<string, unknown>>(`${basePath}/crud/tenants`, {\n          labelField: (item) => String(item.name || ''),\n          descriptionField: (item) => String(item.slug || ''),\n          searchParam: 'q',\n        }),\n        renderer: new EntityRenderer({\n          badgeField: 'status',\n        }),\n        placeholder: 'Search tenants...',\n        minChars: 1,\n      },\n      {\n        scope: 'org' as ScopeType,\n        resolver: createCrudResolver<Record<string, unknown>>(`${basePath}/crud/organizations`, {\n          labelField: (item) => String(item.name || ''),\n          searchParam: 'q',\n        }),\n        renderer: new EntityRenderer({\n          badgeField: 'status',\n        }),\n        placeholder: 'Search organizations...',\n        minChars: 1,\n      },\n      {\n        scope: 'user' as ScopeType,\n        resolver: createCrudResolver<Record<string, unknown>>(`${basePath}/crud/users`, {\n          labelField: (item) => String(item.display_name || item.username || item.email || 'Unknown'),\n          descriptionField: (item) => String(item.email || ''),\n          searchParam: 'q',\n        }),\n        renderer: new UserRenderer({\n          avatarField: 'avatar',\n          emailField: 'email',\n          roleField: 'role',\n        }),\n        placeholder: 'Search users...',\n        minChars: 1,\n      },\n    ];\n  }\n\n  private syncFromQuery(): void {\n    const params = new URLSearchParams(window.location.search);\n    const scope = params.get('scope') as ScopeType | null;\n    const scopeId = params.get('scope_id');\n\n    if (scope && this.scopeSearchBox) {\n      this.scopeSearchBox.setScope(scope);\n      if (scopeId) {\n        this.scopeSearchBox.setScopeId(scopeId);\n      }\n    } else {\n      // Fallback for when scope search isn't enabled\n      if (scope && this.scopeSelect) {\n        this.scopeSelect.value = scope;\n      }\n      if (scopeId && this.scopeIdInput) {\n        this.scopeIdInput.value = scopeId;\n      }\n    }\n  }\n\n  private syncUrl(): void {\n    const params = new URLSearchParams();\n    const scope = this.scopeSelect?.value || 'system';\n    params.set('scope', scope);\n\n    if (scope !== 'system' && this.scopeIdInput?.value.trim()) {\n      params.set('scope_id', this.scopeIdInput.value.trim());\n    }\n\n    const query = params.toString();\n    const next = query ? `${window.location.pathname}?${query}` : window.location.pathname;\n    window.history.replaceState({}, '', next);\n  }\n\n  private buildScopeParams(): { scope: string; scopeId: string; params: URLSearchParams } {\n    // Use scopeSearchBox if available, otherwise fall back to direct element access\n    const scope = this.scopeSearchBox?.getScope() || this.scopeSelect?.value || 'system';\n    const scopeId = this.scopeSearchBox?.getScopeId() || this.scopeIdInput?.value.trim() || '';\n    const params = new URLSearchParams();\n    params.set('scope', scope);\n\n    if (scope !== 'system' && scopeId) {\n      params.set('scope_id', scopeId);\n    }\n\n    return { scope, scopeId, params };\n  }\n\n  async loadFlags(): Promise<void> {\n    const { params } = this.buildScopeParams();\n    this.syncUrl();\n\n    const url = `${this.config.apiPath}?${params.toString()}`;\n\n    try {\n      const response = await fetch(url, { headers: { Accept: 'application/json' } });\n\n      if (!response.ok) {\n        const text = await response.text();\n        this.toast?.error(text || 'Failed to load flags.');\n        return;\n      }\n\n      const payload: FlagsPayload = await response.json();\n      this.isMutable = !!payload.mutable;\n\n      if (this.mutableStateEl) {\n        this.mutableStateEl.textContent = this.isMutable ? 'Yes' : 'No';\n      }\n\n      this.allFlags = payload.flags || [];\n      this.renderFlags(this.allFlags, this.isMutable);\n    } catch (err) {\n      this.toast?.error('Failed to load flags.');\n    }\n  }\n\n  async updateFlag(key: string, state: OverrideState): Promise<void> {\n    const { scope, scopeId } = this.buildScopeParams();\n\n    if (scope !== 'system' && !scopeId) {\n      this.toast?.error('Scope ID required for tenant/org/user scopes.');\n      await this.loadFlags();\n      return;\n    }\n\n    const payload: Record<string, any> = { key, scope };\n    if (scopeId) {\n      payload.scope_id = scopeId;\n    }\n\n    let method = 'POST';\n    if (state === 'unset') {\n      method = 'DELETE';\n    } else {\n      payload.enabled = state === 'enabled';\n    }\n\n    try {\n      const response = await fetch(this.config.apiPath, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        const text = await response.text();\n        this.toast?.error(text || 'Failed to update flag.');\n      } else {\n        this.toast?.success('Flag updated.');\n      }\n    } catch (err) {\n      this.toast?.error('Failed to update flag.');\n    }\n\n    await this.loadFlags();\n  }\n\n  private renderFlags(flags: Flag[], mutable: boolean): void {\n    if (!this.tableBody || !this.emptyState) return;\n\n    this.tableBody.innerHTML = '';\n\n    const searchTerm = (this.searchInput?.value || '').toLowerCase().trim();\n    const filtered = searchTerm\n      ? flags.filter((f) => f.key && f.key.toLowerCase().includes(searchTerm))\n      : flags;\n\n    if (filtered.length === 0) {\n      this.emptyState.classList.remove('hidden');\n      return;\n    }\n\n    this.emptyState.classList.add('hidden');\n\n    filtered.forEach((flag) => {\n      const row = this.createFlagRow(flag, mutable);\n      this.tableBody!.appendChild(row);\n    });\n\n    this.wireActionMenus();\n  }\n\n  private createFlagRow(flag: Flag, mutable: boolean): HTMLTableRowElement {\n    const effective = flag.effective ? 'Enabled' : 'Disabled';\n    const effectiveBadge = this.badge(effective, flag.effective ? 'on' : 'off');\n    const source = flag.source || 'unknown';\n    const defaultValue =\n      flag.default && flag.default.set ? (flag.default.value ? 'Enabled' : 'Disabled') : '—';\n\n    const overrideState = this.normalizeOverrideState(flag);\n    const overrideValue =\n      flag.override && flag.override.value !== undefined\n        ? flag.override.value\n          ? 'Enabled'\n          : 'Disabled'\n        : '—';\n    const overrideLabel =\n      overrideState === 'enabled' || overrideState === 'disabled' ? overrideValue : 'Default';\n    const overrideBadge = this.badge(\n      overrideLabel,\n      overrideState === 'enabled' ? 'on' : overrideState === 'disabled' ? 'off' : 'neutral'\n    );\n\n    const currentVal = this.currentOverrideValue(flag);\n    const key = flag.key || '';\n\n    const row = document.createElement('tr');\n    row.innerHTML = `\n      <td class=\"px-5 py-4 text-sm text-gray-900 font-mono\">${this.escapeHtml(key)}</td>\n      <td class=\"px-5 py-4 text-sm\">${effectiveBadge}</td>\n      <td class=\"px-5 py-4 text-sm text-gray-600 capitalize\">${this.escapeHtml(source)}</td>\n      <td class=\"px-5 py-4 text-sm text-gray-600\">${defaultValue}</td>\n      <td class=\"px-5 py-4 text-sm\">${overrideBadge}</td>\n      <td class=\"px-5 py-4 text-sm\">${this.renderActionMenu(key, currentVal, !mutable)}</td>\n    `;\n\n    return row;\n  }\n\n  private badge(label: string, intent: 'on' | 'off' | 'neutral'): string {\n    const base = 'status-badge';\n    if (intent === 'on') {\n      return `<span class=\"${base} status-active\">${this.escapeHtml(label)}</span>`;\n    }\n    if (intent === 'off') {\n      return `<span class=\"${base} status-disabled\">${this.escapeHtml(label)}</span>`;\n    }\n    return `<span class=\"${base} status-draft\">${this.escapeHtml(label)}</span>`;\n  }\n\n  private normalizeOverrideState(flag: Flag): string {\n    const state = flag.override?.state ? String(flag.override.state) : 'missing';\n    return state.toLowerCase();\n  }\n\n  private currentOverrideValue(flag: Flag): OverrideState {\n    const state = this.normalizeOverrideState(flag);\n    if (state === 'enabled') return 'enabled';\n    if (state === 'disabled') return 'disabled';\n    return 'unset';\n  }\n\n  private renderActionMenu(key: string, currentValue: OverrideState, disabled: boolean): string {\n    const disabledClass = disabled ? 'opacity-50 pointer-events-none' : '';\n    const currentOption = ACTION_OPTIONS.find((o) => o.value === currentValue);\n\n    return `\n      <div class=\"relative action-menu ${disabledClass}\" data-flag-key=\"${this.escapeHtml(key)}\">\n        <button type=\"button\" class=\"action-menu-trigger inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-0\" ${disabled ? 'disabled' : ''}>\n          <span class=\"action-menu-label\">${currentOption?.label || 'Default'}</span>\n          ${ICONS.chevronDown}\n        </button>\n        <div class=\"action-menu-dropdown hidden absolute right-0 mt-1 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-20\">\n          ${ACTION_OPTIONS.map(\n            (opt) => `\n            <button type=\"button\" data-value=\"${opt.value}\" class=\"action-menu-item w-full text-left px-3 py-2 text-sm hover:bg-gray-50 flex items-center gap-2 ${opt.value === currentValue ? 'bg-gray-50 font-medium' : ''}\">\n              ${ICONS[opt.icon] || ''}\n              ${opt.label}\n            </button>\n          `\n          ).join('')}\n        </div>\n      </div>\n    `;\n  }\n\n  private wireActionMenus(): void {\n    document.querySelectorAll('.action-menu').forEach((menu) => {\n      const trigger = menu.querySelector<HTMLButtonElement>('.action-menu-trigger');\n      const dropdown = menu.querySelector<HTMLElement>('.action-menu-dropdown');\n      const items = menu.querySelectorAll<HTMLButtonElement>('.action-menu-item');\n      const key = (menu as HTMLElement).dataset.flagKey;\n\n      if (!trigger || !dropdown || !key) return;\n\n      trigger.addEventListener('click', (e) => {\n        e.stopPropagation();\n        // Close other open menus\n        document.querySelectorAll('.action-menu-dropdown').forEach((d) => {\n          if (d !== dropdown) d.classList.add('hidden');\n        });\n        dropdown.classList.toggle('hidden');\n      });\n\n      items.forEach((item) => {\n        item.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          const value = item.dataset.value as OverrideState;\n          dropdown.classList.add('hidden');\n          await this.updateFlag(key, value);\n        });\n      });\n    });\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n"],"names":["ScopeSearchBox","config","el","scopeConfig","scope","id","newScope","SearchBox","result","placeholders","createDefaultScopeConfigs","basePath","createCrudResolver","item","EntityRenderer","UserRenderer","createScopeSearchBox","options","scopeConfigs","custom","DEFAULT_SELECTORS","ACTION_OPTIONS","ICONS","FeatureFlagsManager","selectors","toast","d","container","params","scopeId","query","next","url","response","text","payload","key","state","method","flags","mutable","searchTerm","filtered","f","flag","row","effective","effectiveBadge","source","defaultValue","overrideState","overrideValue","overrideLabel","overrideBadge","currentVal","label","intent","base","currentValue","disabled","disabledClass","currentOption","o","opt","menu","trigger","dropdown","items","e","value","div"],"mappings":";AAsBO,MAAMA,EAAe;AAAA,EAU1B,YAAYC,GAA8B;AAIxC,QATF,KAAQ,YAA8B,MACtC,KAAQ,mCAAgD,IAAA,GACxD,KAAQ,eAA0B,UAClC,KAAQ,iBAAsC,MAG5C,KAAK,SAASA,GAGV,OAAOA,EAAO,SAAU,UAAU;AACpC,YAAMC,IAAK,SAAS,cAAgCD,EAAO,KAAK;AAChE,UAAI,CAACC,EAAI,OAAM,IAAI,MAAM,4CAA4CD,EAAO,KAAK,EAAE;AACnF,WAAK,QAAQC;AAAA,IACf;AACE,WAAK,QAAQD,EAAO;AAItB,QAAI,OAAOA,EAAO,eAAgB,UAAU;AAC1C,YAAMC,IAAK,SAAS,cAAiCD,EAAO,WAAW;AACvE,UAAI,CAACC,EAAI,OAAM,IAAI,MAAM,2CAA2CD,EAAO,WAAW,EAAE;AACxF,WAAK,cAAcC;AAAA,IACrB;AACE,WAAK,cAAcD,EAAO;AAI5B,QAAIA,EAAO;AACT,UAAI,OAAOA,EAAO,aAAc,UAAU;AACxC,cAAMC,IAAK,SAAS,cAA2BD,EAAO,SAAS;AAC/D,YAAI,CAACC,EAAI,OAAM,IAAI,MAAM,wCAAwCD,EAAO,SAAS,EAAE;AACnF,aAAK,YAAYC;AAAA,MACnB;AACE,aAAK,YAAYD,EAAO;AAAA;AAG1B,WAAK,YAAY,KAAK,MAAM,iBAAiB,SAAS;AAIxD,eAAWE,KAAeF,EAAO;AAC/B,WAAK,aAAa,IAAIE,EAAY,OAAOA,CAAW;AAAA,EAExD;AAAA;AAAA;AAAA;AAAA,EAKA,OAAa;AACX,SAAK,gBAAA,GACL,KAAK,eAAgB,KAAK,YAAY,SAAuB,UAC7D,KAAK,eAAe,KAAK,YAAY;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,UAAgB;AACd,IAAI,KAAK,cACP,KAAK,UAAU,QAAA,GACf,KAAK,YAAY;AAAA,EAErB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAsB;AACpB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,aAAqB;AACnB,WAAO,KAAK,MAAM,MAAM,KAAA;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAyC;AACvC,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,SAASC,GAAwB;AAC/B,SAAK,YAAY,QAAQA,GACzB,KAAK,eAAeA,CAAK;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,WAAWC,GAAkB;AAC3B,SAAK,MAAM,QAAQA,GACf,KAAK,aACP,KAAK,UAAU,SAASA,CAAE;AAAA,EAE9B;AAAA;AAAA;AAAA;AAAA,EAKA,QAAc;AACZ,SAAK,iBAAiB,MAClB,KAAK,YACP,KAAK,UAAU,MAAA,IAEf,KAAK,MAAM,QAAQ,IAErB,KAAK,OAAO,UAAA;AAAA,EACd;AAAA,EAEQ,kBAAwB;AAC9B,SAAK,YAAY,iBAAiB,UAAU,MAAM;AAChD,YAAMC,IAAW,KAAK,YAAY;AAClC,WAAK,eAAeA,CAAQ,GAC5B,KAAK,OAAO,gBAAgBA,CAAQ;AAAA,IACtC,CAAC;AAAA,EACH;AAAA,EAEQ,eAAeF,GAAwB;AAW7C,QAVA,KAAK,eAAeA,GACpB,KAAK,iBAAiB,MAGlB,KAAK,cACP,KAAK,UAAU,QAAA,GACf,KAAK,YAAY,OAIfA,MAAU,UAAU;AACtB,WAAK,MAAM,QAAQ,IACnB,KAAK,MAAM,WAAW,IACtB,KAAK,MAAM,cAAc;AACzB;AAAA,IACF;AAGA,SAAK,MAAM,WAAW,IACtB,KAAK,MAAM,QAAQ;AAGnB,UAAMD,IAAc,KAAK,aAAa,IAAIC,CAAK;AAE/C,IAAID,KAEF,KAAK,YAAY,IAAII,EAAU;AAAA,MAC7B,OAAO,KAAK;AAAA,MACZ,WAAW,KAAK;AAAA,MAChB,UAAUJ,EAAY;AAAA,MACtB,UAAUA,EAAY;AAAA,MACtB,aAAaA,EAAY,eAAe,KAAK,sBAAsBC,CAAK;AAAA,MACxE,UAAUD,EAAY,YAAY;AAAA,MAClC,UAAU,CAACK,MAAW;AACpB,aAAK,iBAAiBA,GACtB,KAAK,OAAO,WAAWJ,GAAOI,CAAM;AAAA,MACtC;AAAA,MACA,SAAS,MAAM;AACb,aAAK,iBAAiB,MACtB,KAAK,OAAO,UAAA;AAAA,MACd;AAAA,IAAA,CACD,GACD,KAAK,UAAU,KAAA,KAGf,KAAK,MAAM,cAAc,KAAK,sBAAsBJ,CAAK;AAAA,EAE7D;AAAA,EAEQ,sBAAsBA,GAA0B;AACtD,UAAMK,IAA0C;AAAA,MAC9C,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,MAAM;AAAA,IAAA;AAER,WAAO,KAAK,OAAO,sBAAsBA,EAAaL,CAAK,KAAK;AAAA,EAClE;AACF;AAMO,SAASM,EAA0BC,GAAiC;AACzE,SAAO;AAAA,IACL;AAAA,MACE,OAAO;AAAA,MACP,UAAUC,EAA4C,GAAGD,CAAQ,gBAAgB;AAAA,QAC/E,YAAY,CAACE,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,QAC5C,kBAAkB,CAACA,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,QAClD,aAAa;AAAA,MAAA,CACd;AAAA,MACD,UAAU,IAAIC,EAAe;AAAA,QAC3B,YAAY;AAAA,MAAA,CACb;AAAA,MACD,aAAa;AAAA,IAAA;AAAA,IAEf;AAAA,MACE,OAAO;AAAA,MACP,UAAUF,EAA4C,GAAGD,CAAQ,sBAAsB;AAAA,QACrF,YAAY,CAACE,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,QAC5C,aAAa;AAAA,MAAA,CACd;AAAA,MACD,UAAU,IAAIC,EAAe;AAAA,QAC3B,YAAY;AAAA,MAAA,CACb;AAAA,MACD,aAAa;AAAA,IAAA;AAAA,IAEf;AAAA,MACE,OAAO;AAAA,MACP,UAAUF,EAA4C,GAAGD,CAAQ,cAAc;AAAA,QAC7E,YAAY,CAACE,MAAS,OAAOA,EAAK,eAAeA,EAAK,YAAYA,EAAK,SAAS,EAAE;AAAA,QAClF,kBAAkB,CAACA,MAAS,OAAOA,EAAK,SAAS,EAAE;AAAA,QACnD,aAAa;AAAA,MAAA,CACd;AAAA,MACD,UAAU,IAAIE,EAAa;AAAA,QACzB,aAAa;AAAA,QACb,YAAY;AAAA,QACZ,WAAW;AAAA,MAAA,CACZ;AAAA,MACD,aAAa;AAAA,IAAA;AAAA,EACf;AAEJ;AAKO,SAASC,EAAqBC,GAQlB;AA0CjB,QAAMC,IAzCgC;AAAA,IACpC;AAAA,MACE,OAAO;AAAA,MACP,UAAUN,EAA4C,GAAGK,EAAQ,QAAQ,iBAAiB;AAAA,QACxF,YAAY,CAACJ,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,QAC5C,kBAAkB,CAACA,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,QAClD,aAAa;AAAA,MAAA,CACd;AAAA,MACD,UAAU,IAAIC,EAAe;AAAA,QAC3B,YAAY;AAAA,MAAA,CACb;AAAA,MACD,aAAa;AAAA,IAAA;AAAA,IAEf;AAAA,MACE,OAAO;AAAA,MACP,UAAUF,EAA4C,GAAGK,EAAQ,QAAQ,uBAAuB;AAAA,QAC9F,YAAY,CAACJ,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,QAC5C,aAAa;AAAA,MAAA,CACd;AAAA,MACD,UAAU,IAAIC,EAAe;AAAA,QAC3B,YAAY;AAAA,MAAA,CACb;AAAA,MACD,aAAa;AAAA,IAAA;AAAA,IAEf;AAAA,MACE,OAAO;AAAA,MACP,UAAUF,EAA4C,GAAGK,EAAQ,QAAQ,eAAe;AAAA,QACtF,YAAY,CAACJ,MAAS,OAAOA,EAAK,gBAAgBA,EAAK,YAAYA,EAAK,SAAS,EAAE;AAAA,QACnF,kBAAkB,CAACA,MAAS,OAAOA,EAAK,SAAS,EAAE;AAAA,QACnD,aAAa;AAAA,MAAA,CACd;AAAA,MACD,UAAU,IAAIE,EAAa;AAAA,QACzB,aAAa;AAAA,QACb,YAAY;AAAA,QACZ,WAAW;AAAA,MAAA,CACZ;AAAA,MACD,aAAa;AAAA,IAAA;AAAA,EACf,EAIkC,IAAI,CAACd,MAAW;AAClD,UAAMkB,IAASF,EAAQ,gBAAgBhB,EAAO,KAAK;AACnD,WAAIkB,IACK,EAAE,GAAGlB,GAAQ,GAAGkB,EAAA,IAElBlB;AAAA,EACT,CAAC;AAED,SAAO,IAAID,EAAe;AAAA,IACxB,OAAOiB,EAAQ;AAAA,IACf,aAAaA,EAAQ;AAAA,IACrB,WAAWA,EAAQ;AAAA,IACnB,cAAAC;AAAA,IACA,UAAUD,EAAQ;AAAA,IAClB,eAAeA,EAAQ;AAAA,EAAA,CACxB;AACH;ACnTA,MAAMG,IAA2C;AAAA,EAC/C,aAAa;AAAA,EACb,cAAc;AAAA,EACd,eAAe;AAAA,EACf,YAAY;AAAA,EACZ,aAAa;AAAA,EACb,cAAc;AAAA,EACd,WAAW;AAAA,EACX,YAAY;AACd,GAEMC,IAAqC;AAAA,EACzC,EAAE,OAAO,SAAS,OAAO,WAAW,MAAM,QAAA;AAAA,EAC1C,EAAE,OAAO,WAAW,OAAO,WAAW,MAAM,QAAA;AAAA,EAC5C,EAAE,OAAO,YAAY,OAAO,YAAY,MAAM,IAAA;AAChD,GAEMC,IAAgC;AAAA,EACpC,OAAO;AAAA,EACP,GAAG;AAAA,EACH,OAAO;AAAA,EACP,aAAa;AACf;AAEO,MAAMC,EAAoB;AAAA,EAmB/B,YACEtB,GACAuB,IAA4C,CAAA,GAC5CC,GACA;AAlBF,SAAQ,cAAwC,MAChD,KAAQ,eAAwC,MAChD,KAAQ,gBAA0C,MAClD,KAAQ,aAAuC,MAC/C,KAAQ,cAAuC,MAC/C,KAAQ,iBAAqC,MAC7C,KAAQ,YAA4C,MACpD,KAAQ,aAAiC,MAEzC,KAAQ,WAAmB,CAAA,GAC3B,KAAQ,YAAY,IACpB,KAAQ,uBAA4C,MACpD,KAAQ,iBAAwC,MAO9C,KAAK,SAASxB,GACd,KAAK,YAAY,EAAE,GAAGmB,GAAmB,GAAGI,EAAA,GAC5C,KAAK,QAAQC,KAAU,OAAe,gBAAgB;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKA,OAAa;AACX,SAAK,cAAA,GACL,KAAK,WAAA,GACL,KAAK,gBAAA,GACL,KAAK,cAAA,GACL,KAAK,UAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKA,UAAgB;AACd,IAAI,KAAK,yBACP,SAAS,oBAAoB,SAAS,KAAK,oBAAoB,GAC/D,KAAK,uBAAuB,OAE1B,KAAK,mBACP,KAAK,eAAe,QAAA,GACpB,KAAK,iBAAiB;AAAA,EAE1B;AAAA,EAEQ,gBAAsB;AAC5B,SAAK,cAAc,SAAS,cAAiC,KAAK,UAAU,WAAW,GACvF,KAAK,eAAe,SAAS,cAAgC,KAAK,UAAU,YAAY,GACxF,KAAK,gBAAgB,SAAS,cAAiC,KAAK,UAAU,aAAa,GAC3F,KAAK,aAAa,SAAS,cAAiC,KAAK,UAAU,UAAU,GACrF,KAAK,cAAc,SAAS,cAAgC,KAAK,UAAU,WAAW,GACtF,KAAK,iBAAiB,SAAS,cAA2B,KAAK,UAAU,YAAY,GACrF,KAAK,YAAY,SAAS,cAAuC,KAAK,UAAU,SAAS,GACzF,KAAK,aAAa,SAAS,cAA2B,KAAK,UAAU,UAAU;AAAA,EACjF;AAAA,EAEQ,aAAmB;AACzB,SAAK,eAAe,iBAAiB,SAAS,MAAM,KAAK,WAAW,GACpE,KAAK,YAAY,iBAAiB,SAAS,MAAM,KAAK,WAAW,GACjE,KAAK,aAAa,iBAAiB,SAAS,MAAM,KAAK,YAAY,KAAK,UAAU,KAAK,SAAS,CAAC,GAGjG,KAAK,uBAAuB,MAAM;AAChC,eAAS,iBAAiB,uBAAuB,EAAE,QAAQ,CAACC,MAAMA,EAAE,UAAU,IAAI,QAAQ,CAAC;AAAA,IAC7F,GACA,SAAS,iBAAiB,SAAS,KAAK,oBAAoB;AAAA,EAC9D;AAAA,EAEQ,kBAAwB;AAC9B,QAAI,CAAC,KAAK,eAAe,CAAC,KAAK,aAAc;AAG7C,UAAMR,IAAe,KAAK,kBAAA,GAGpBS,IAAY,KAAK,aAAa;AACpC,IAAKA,MAGLA,EAAU,MAAM,WAAW,YAE3B,KAAK,iBAAiB,IAAI3B,EAAe;AAAA,MACvC,OAAO,KAAK;AAAA,MACZ,aAAa,KAAK;AAAA,MAClB,WAAA2B;AAAA,MACA,cAAAT;AAAA,MACA,UAAU,CAACd,GAAOI,MAAW;AAE3B,QAAI,KAAK,iBACP,KAAK,aAAa,QAAQA,EAAO;AAAA,MAErC;AAAA,MACA,eAAe,CAACJ,MAAU;AAExB,QAAIA,MAAU,YACZ,KAAK,UAAA;AAAA,MAET;AAAA,MACA,SAAS,MAAM;AAAA,MAEf;AAAA,IAAA,CACD,GAED,KAAK,eAAe,KAAA;AAAA,EACtB;AAAA,EAEQ,oBAAmC;AACzC,UAAMO,IAAW,KAAK,OAAO;AAE7B,WAAO;AAAA,MACL;AAAA,QACE,OAAO;AAAA,QACP,UAAUC,EAA4C,GAAGD,CAAQ,iBAAiB;AAAA,UAChF,YAAY,CAACE,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,UAC5C,kBAAkB,CAACA,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,UAClD,aAAa;AAAA,QAAA,CACd;AAAA,QACD,UAAU,IAAIC,EAAe;AAAA,UAC3B,YAAY;AAAA,QAAA,CACb;AAAA,QACD,aAAa;AAAA,QACb,UAAU;AAAA,MAAA;AAAA,MAEZ;AAAA,QACE,OAAO;AAAA,QACP,UAAUF,EAA4C,GAAGD,CAAQ,uBAAuB;AAAA,UACtF,YAAY,CAACE,MAAS,OAAOA,EAAK,QAAQ,EAAE;AAAA,UAC5C,aAAa;AAAA,QAAA,CACd;AAAA,QACD,UAAU,IAAIC,EAAe;AAAA,UAC3B,YAAY;AAAA,QAAA,CACb;AAAA,QACD,aAAa;AAAA,QACb,UAAU;AAAA,MAAA;AAAA,MAEZ;AAAA,QACE,OAAO;AAAA,QACP,UAAUF,EAA4C,GAAGD,CAAQ,eAAe;AAAA,UAC9E,YAAY,CAACE,MAAS,OAAOA,EAAK,gBAAgBA,EAAK,YAAYA,EAAK,SAAS,SAAS;AAAA,UAC1F,kBAAkB,CAACA,MAAS,OAAOA,EAAK,SAAS,EAAE;AAAA,UACnD,aAAa;AAAA,QAAA,CACd;AAAA,QACD,UAAU,IAAIE,EAAa;AAAA,UACzB,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,WAAW;AAAA,QAAA,CACZ;AAAA,QACD,aAAa;AAAA,QACb,UAAU;AAAA,MAAA;AAAA,IACZ;AAAA,EAEJ;AAAA,EAEQ,gBAAsB;AAC5B,UAAMa,IAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,GACnDxB,IAAQwB,EAAO,IAAI,OAAO,GAC1BC,IAAUD,EAAO,IAAI,UAAU;AAErC,IAAIxB,KAAS,KAAK,kBAChB,KAAK,eAAe,SAASA,CAAK,GAC9ByB,KACF,KAAK,eAAe,WAAWA,CAAO,MAIpCzB,KAAS,KAAK,gBAChB,KAAK,YAAY,QAAQA,IAEvByB,KAAW,KAAK,iBAClB,KAAK,aAAa,QAAQA;AAAA,EAGhC;AAAA,EAEQ,UAAgB;AACtB,UAAMD,IAAS,IAAI,gBAAA,GACbxB,IAAQ,KAAK,aAAa,SAAS;AACzC,IAAAwB,EAAO,IAAI,SAASxB,CAAK,GAErBA,MAAU,YAAY,KAAK,cAAc,MAAM,UACjDwB,EAAO,IAAI,YAAY,KAAK,aAAa,MAAM,MAAM;AAGvD,UAAME,IAAQF,EAAO,SAAA,GACfG,IAAOD,IAAQ,GAAG,OAAO,SAAS,QAAQ,IAAIA,CAAK,KAAK,OAAO,SAAS;AAC9E,WAAO,QAAQ,aAAa,CAAA,GAAI,IAAIC,CAAI;AAAA,EAC1C;AAAA,EAEQ,mBAAgF;AAEtF,UAAM3B,IAAQ,KAAK,gBAAgB,cAAc,KAAK,aAAa,SAAS,UACtEyB,IAAU,KAAK,gBAAgB,WAAA,KAAgB,KAAK,cAAc,MAAM,KAAA,KAAU,IAClFD,IAAS,IAAI,gBAAA;AACnB,WAAAA,EAAO,IAAI,SAASxB,CAAK,GAErBA,MAAU,YAAYyB,KACxBD,EAAO,IAAI,YAAYC,CAAO,GAGzB,EAAE,OAAAzB,GAAO,SAAAyB,GAAS,QAAAD,EAAA;AAAA,EAC3B;AAAA,EAEA,MAAM,YAA2B;AAC/B,UAAM,EAAE,QAAAA,EAAA,IAAW,KAAK,iBAAA;AACxB,SAAK,QAAA;AAEL,UAAMI,IAAM,GAAG,KAAK,OAAO,OAAO,IAAIJ,EAAO,UAAU;AAEvD,QAAI;AACF,YAAMK,IAAW,MAAM,MAAMD,GAAK,EAAE,SAAS,EAAE,QAAQ,mBAAA,GAAsB;AAE7E,UAAI,CAACC,EAAS,IAAI;AAChB,cAAMC,IAAO,MAAMD,EAAS,KAAA;AAC5B,aAAK,OAAO,MAAMC,KAAQ,uBAAuB;AACjD;AAAA,MACF;AAEA,YAAMC,IAAwB,MAAMF,EAAS,KAAA;AAC7C,WAAK,YAAY,CAAC,CAACE,EAAQ,SAEvB,KAAK,mBACP,KAAK,eAAe,cAAc,KAAK,YAAY,QAAQ,OAG7D,KAAK,WAAWA,EAAQ,SAAS,CAAA,GACjC,KAAK,YAAY,KAAK,UAAU,KAAK,SAAS;AAAA,IAChD,QAAc;AACZ,WAAK,OAAO,MAAM,uBAAuB;AAAA,IAC3C;AAAA,EACF;AAAA,EAEA,MAAM,WAAWC,GAAaC,GAAqC;AACjE,UAAM,EAAE,OAAAjC,GAAO,SAAAyB,MAAY,KAAK,iBAAA;AAEhC,QAAIzB,MAAU,YAAY,CAACyB,GAAS;AAClC,WAAK,OAAO,MAAM,+CAA+C,GACjE,MAAM,KAAK,UAAA;AACX;AAAA,IACF;AAEA,UAAMM,IAA+B,EAAE,KAAAC,GAAK,OAAAhC,EAAA;AAC5C,IAAIyB,MACFM,EAAQ,WAAWN;AAGrB,QAAIS,IAAS;AACb,IAAID,MAAU,UACZC,IAAS,WAETH,EAAQ,UAAUE,MAAU;AAG9B,QAAI;AACF,YAAMJ,IAAW,MAAM,MAAM,KAAK,OAAO,SAAS;AAAA,QAChD,QAAAK;AAAA,QACA,SAAS,EAAE,gBAAgB,mBAAA;AAAA,QAC3B,MAAM,KAAK,UAAUH,CAAO;AAAA,MAAA,CAC7B;AAED,UAAKF,EAAS;AAIZ,aAAK,OAAO,QAAQ,eAAe;AAAA,WAJnB;AAChB,cAAMC,IAAO,MAAMD,EAAS,KAAA;AAC5B,aAAK,OAAO,MAAMC,KAAQ,wBAAwB;AAAA,MACpD;AAAA,IAGF,QAAc;AACZ,WAAK,OAAO,MAAM,wBAAwB;AAAA,IAC5C;AAEA,UAAM,KAAK,UAAA;AAAA,EACb;AAAA,EAEQ,YAAYK,GAAeC,GAAwB;AACzD,QAAI,CAAC,KAAK,aAAa,CAAC,KAAK,WAAY;AAEzC,SAAK,UAAU,YAAY;AAE3B,UAAMC,KAAc,KAAK,aAAa,SAAS,IAAI,YAAA,EAAc,KAAA,GAC3DC,IAAWD,IACbF,EAAM,OAAO,CAACI,MAAMA,EAAE,OAAOA,EAAE,IAAI,YAAA,EAAc,SAASF,CAAU,CAAC,IACrEF;AAEJ,QAAIG,EAAS,WAAW,GAAG;AACzB,WAAK,WAAW,UAAU,OAAO,QAAQ;AACzC;AAAA,IACF;AAEA,SAAK,WAAW,UAAU,IAAI,QAAQ,GAEtCA,EAAS,QAAQ,CAACE,MAAS;AACzB,YAAMC,IAAM,KAAK,cAAcD,GAAMJ,CAAO;AAC5C,WAAK,UAAW,YAAYK,CAAG;AAAA,IACjC,CAAC,GAED,KAAK,gBAAA;AAAA,EACP;AAAA,EAEQ,cAAcD,GAAYJ,GAAuC;AACvE,UAAMM,IAAYF,EAAK,YAAY,YAAY,YACzCG,IAAiB,KAAK,MAAMD,GAAWF,EAAK,YAAY,OAAO,KAAK,GACpEI,IAASJ,EAAK,UAAU,WACxBK,IACJL,EAAK,WAAWA,EAAK,QAAQ,MAAOA,EAAK,QAAQ,QAAQ,YAAY,aAAc,KAE/EM,IAAgB,KAAK,uBAAuBN,CAAI,GAChDO,IACJP,EAAK,YAAYA,EAAK,SAAS,UAAU,SACrCA,EAAK,SAAS,QACZ,YACA,aACF,KACAQ,IACJF,MAAkB,aAAaA,MAAkB,aAAaC,IAAgB,WAC1EE,IAAgB,KAAK;AAAA,MACzBD;AAAA,MACAF,MAAkB,YAAY,OAAOA,MAAkB,aAAa,QAAQ;AAAA,IAAA,GAGxEI,IAAa,KAAK,qBAAqBV,CAAI,GAC3CR,IAAMQ,EAAK,OAAO,IAElBC,IAAM,SAAS,cAAc,IAAI;AACvC,WAAAA,EAAI,YAAY;AAAA,8DAC0C,KAAK,WAAWT,CAAG,CAAC;AAAA,sCAC5CW,CAAc;AAAA,+DACW,KAAK,WAAWC,CAAM,CAAC;AAAA,oDAClCC,CAAY;AAAA,sCAC1BI,CAAa;AAAA,sCACb,KAAK,iBAAiBjB,GAAKkB,GAAY,CAACd,CAAO,CAAC;AAAA,OAG3EK;AAAA,EACT;AAAA,EAEQ,MAAMU,GAAeC,GAA0C;AACrE,UAAMC,IAAO;AACb,WAAID,MAAW,OACN,gBAAgBC,CAAI,mBAAmB,KAAK,WAAWF,CAAK,CAAC,YAElEC,MAAW,QACN,gBAAgBC,CAAI,qBAAqB,KAAK,WAAWF,CAAK,CAAC,YAEjE,gBAAgBE,CAAI,kBAAkB,KAAK,WAAWF,CAAK,CAAC;AAAA,EACrE;AAAA,EAEQ,uBAAuBX,GAAoB;AAEjD,YADcA,EAAK,UAAU,QAAQ,OAAOA,EAAK,SAAS,KAAK,IAAI,WACtD,YAAA;AAAA,EACf;AAAA,EAEQ,qBAAqBA,GAA2B;AACtD,UAAMP,IAAQ,KAAK,uBAAuBO,CAAI;AAC9C,WAAIP,MAAU,YAAkB,YAC5BA,MAAU,aAAmB,aAC1B;AAAA,EACT;AAAA,EAEQ,iBAAiBD,GAAasB,GAA6BC,GAA2B;AAC5F,UAAMC,IAAgBD,IAAW,mCAAmC,IAC9DE,IAAgBxC,EAAe,KAAK,CAACyC,MAAMA,EAAE,UAAUJ,CAAY;AAEzE,WAAO;AAAA,yCAC8BE,CAAa,oBAAoB,KAAK,WAAWxB,CAAG,CAAC;AAAA,qOACuIuB,IAAW,aAAa,EAAE;AAAA,4CACnNE,GAAe,SAAS,SAAS;AAAA,YACjEvC,EAAM,WAAW;AAAA;AAAA;AAAA,YAGjBD,EAAe;AAAA,MACf,CAAC0C,MAAQ;AAAA,gDAC2BA,EAAI,KAAK,yGAAyGA,EAAI,UAAUL,IAAe,2BAA2B,EAAE;AAAA,gBAC5MpC,EAAMyC,EAAI,IAAI,KAAK,EAAE;AAAA,gBACrBA,EAAI,KAAK;AAAA;AAAA;AAAA,IAAA,EAGb,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,EAIlB;AAAA,EAEQ,kBAAwB;AAC9B,aAAS,iBAAiB,cAAc,EAAE,QAAQ,CAACC,MAAS;AAC1D,YAAMC,IAAUD,EAAK,cAAiC,sBAAsB,GACtEE,IAAWF,EAAK,cAA2B,uBAAuB,GAClEG,IAAQH,EAAK,iBAAoC,mBAAmB,GACpE5B,IAAO4B,EAAqB,QAAQ;AAE1C,MAAI,CAACC,KAAW,CAACC,KAAY,CAAC9B,MAE9B6B,EAAQ,iBAAiB,SAAS,CAACG,MAAM;AACvC,QAAAA,EAAE,gBAAA,GAEF,SAAS,iBAAiB,uBAAuB,EAAE,QAAQ,CAAC1C,MAAM;AAChE,UAAIA,MAAMwC,KAAUxC,EAAE,UAAU,IAAI,QAAQ;AAAA,QAC9C,CAAC,GACDwC,EAAS,UAAU,OAAO,QAAQ;AAAA,MACpC,CAAC,GAEDC,EAAM,QAAQ,CAACtD,MAAS;AACtB,QAAAA,EAAK,iBAAiB,SAAS,OAAOuD,MAAM;AAC1C,UAAAA,EAAE,gBAAA;AACF,gBAAMC,IAAQxD,EAAK,QAAQ;AAC3B,UAAAqD,EAAS,UAAU,IAAI,QAAQ,GAC/B,MAAM,KAAK,WAAW9B,GAAKiC,CAAK;AAAA,QAClC,CAAC;AAAA,MACH,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA,EAEQ,WAAWnC,GAAsB;AACvC,UAAMoC,IAAM,SAAS,cAAc,KAAK;AACxC,WAAAA,EAAI,cAAcpC,GACXoC,EAAI;AAAA,EACb;AACF;"}