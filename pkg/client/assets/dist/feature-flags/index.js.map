{"version":3,"file":"index.js","sources":["../../src/feature-flags/feature-flags-manager.ts"],"sourcesContent":["/**\n * Feature Flags Manager\n * Manages feature flag display, filtering, and updates\n */\n\nimport type {\n  Flag,\n  FlagsPayload,\n  FeatureFlagsConfig,\n  FeatureFlagsSelectors,\n  OverrideState,\n  ActionMenuOption,\n  ToastNotifier,\n} from './types.js';\n\nconst DEFAULT_SELECTORS: FeatureFlagsSelectors = {\n  scopeSelect: '#flag-scope',\n  scopeIdInput: '#flag-scope-id',\n  applyScopeBtn: '#apply-scope',\n  refreshBtn: '#refresh-flags',\n  searchInput: '#flag-search',\n  mutableState: '#mutable-state',\n  tableBody: '#flags-table',\n  emptyState: '#flags-empty',\n};\n\nconst ACTION_OPTIONS: ActionMenuOption[] = [\n  { value: 'unset', label: 'Default', icon: 'minus' },\n  { value: 'enabled', label: 'Enabled', icon: 'check' },\n  { value: 'disabled', label: 'Disabled', icon: 'x' },\n];\n\nconst ICONS: Record<string, string> = {\n  check: '<svg class=\"w-4 h-4 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>',\n  x: '<svg class=\"w-4 h-4 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>',\n  minus: '<svg class=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"/></svg>',\n  chevronDown: '<svg class=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>',\n};\n\nexport class FeatureFlagsManager {\n  private config: FeatureFlagsConfig;\n  private selectors: FeatureFlagsSelectors;\n  private toast: ToastNotifier | null;\n\n  private scopeSelect: HTMLSelectElement | null = null;\n  private scopeIdInput: HTMLInputElement | null = null;\n  private applyScopeBtn: HTMLButtonElement | null = null;\n  private refreshBtn: HTMLButtonElement | null = null;\n  private searchInput: HTMLInputElement | null = null;\n  private mutableStateEl: HTMLElement | null = null;\n  private tableBody: HTMLTableSectionElement | null = null;\n  private emptyState: HTMLElement | null = null;\n\n  private allFlags: Flag[] = [];\n  private isMutable = false;\n  private documentClickHandler: (() => void) | null = null;\n\n  constructor(\n    config: FeatureFlagsConfig,\n    selectors: Partial<FeatureFlagsSelectors> = {},\n    toast?: ToastNotifier\n  ) {\n    this.config = config;\n    this.selectors = { ...DEFAULT_SELECTORS, ...selectors };\n    this.toast = toast || (window as any).toastManager || null;\n  }\n\n  /**\n   * Initialize the feature flags manager\n   */\n  init(): void {\n    this.cacheElements();\n    this.bindEvents();\n    this.syncFromQuery();\n    this.loadFlags();\n  }\n\n  /**\n   * Destroy the manager and clean up event listeners\n   */\n  destroy(): void {\n    if (this.documentClickHandler) {\n      document.removeEventListener('click', this.documentClickHandler);\n      this.documentClickHandler = null;\n    }\n  }\n\n  private cacheElements(): void {\n    this.scopeSelect = document.querySelector<HTMLSelectElement>(this.selectors.scopeSelect);\n    this.scopeIdInput = document.querySelector<HTMLInputElement>(this.selectors.scopeIdInput);\n    this.applyScopeBtn = document.querySelector<HTMLButtonElement>(this.selectors.applyScopeBtn);\n    this.refreshBtn = document.querySelector<HTMLButtonElement>(this.selectors.refreshBtn);\n    this.searchInput = document.querySelector<HTMLInputElement>(this.selectors.searchInput);\n    this.mutableStateEl = document.querySelector<HTMLElement>(this.selectors.mutableState);\n    this.tableBody = document.querySelector<HTMLTableSectionElement>(this.selectors.tableBody);\n    this.emptyState = document.querySelector<HTMLElement>(this.selectors.emptyState);\n  }\n\n  private bindEvents(): void {\n    this.applyScopeBtn?.addEventListener('click', () => this.loadFlags());\n    this.refreshBtn?.addEventListener('click', () => this.loadFlags());\n    this.searchInput?.addEventListener('input', () => this.renderFlags(this.allFlags, this.isMutable));\n\n    // Global click handler to close dropdowns\n    this.documentClickHandler = () => {\n      document.querySelectorAll('.action-menu-dropdown').forEach((d) => d.classList.add('hidden'));\n    };\n    document.addEventListener('click', this.documentClickHandler);\n  }\n\n  private syncFromQuery(): void {\n    const params = new URLSearchParams(window.location.search);\n    const scope = params.get('scope');\n    const scopeId = params.get('scope_id');\n\n    if (scope && this.scopeSelect) {\n      this.scopeSelect.value = scope;\n    }\n    if (scopeId && this.scopeIdInput) {\n      this.scopeIdInput.value = scopeId;\n    }\n  }\n\n  private syncUrl(): void {\n    const params = new URLSearchParams();\n    const scope = this.scopeSelect?.value || 'system';\n    params.set('scope', scope);\n\n    if (scope !== 'system' && this.scopeIdInput?.value.trim()) {\n      params.set('scope_id', this.scopeIdInput.value.trim());\n    }\n\n    const query = params.toString();\n    const next = query ? `${window.location.pathname}?${query}` : window.location.pathname;\n    window.history.replaceState({}, '', next);\n  }\n\n  private buildScopeParams(): { scope: string; scopeId: string; params: URLSearchParams } {\n    const scope = this.scopeSelect?.value || 'system';\n    const scopeId = this.scopeIdInput?.value.trim() || '';\n    const params = new URLSearchParams();\n    params.set('scope', scope);\n\n    if (scope !== 'system' && scopeId) {\n      params.set('scope_id', scopeId);\n    }\n\n    return { scope, scopeId, params };\n  }\n\n  async loadFlags(): Promise<void> {\n    const { params } = this.buildScopeParams();\n    this.syncUrl();\n\n    const url = `${this.config.apiPath}?${params.toString()}`;\n\n    try {\n      const response = await fetch(url, { headers: { Accept: 'application/json' } });\n\n      if (!response.ok) {\n        const text = await response.text();\n        this.toast?.error(text || 'Failed to load flags.');\n        return;\n      }\n\n      const payload: FlagsPayload = await response.json();\n      this.isMutable = !!payload.mutable;\n\n      if (this.mutableStateEl) {\n        this.mutableStateEl.textContent = this.isMutable ? 'Yes' : 'No';\n      }\n\n      this.allFlags = payload.flags || [];\n      this.renderFlags(this.allFlags, this.isMutable);\n    } catch (err) {\n      this.toast?.error('Failed to load flags.');\n    }\n  }\n\n  async updateFlag(key: string, state: OverrideState): Promise<void> {\n    const { scope, scopeId } = this.buildScopeParams();\n\n    if (scope !== 'system' && !scopeId) {\n      this.toast?.error('Scope ID required for tenant/org/user scopes.');\n      await this.loadFlags();\n      return;\n    }\n\n    const payload: Record<string, any> = { key, scope };\n    if (scopeId) {\n      payload.scope_id = scopeId;\n    }\n\n    let method = 'POST';\n    if (state === 'unset') {\n      method = 'DELETE';\n    } else {\n      payload.enabled = state === 'enabled';\n    }\n\n    try {\n      const response = await fetch(this.config.apiPath, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        const text = await response.text();\n        this.toast?.error(text || 'Failed to update flag.');\n      } else {\n        this.toast?.success('Flag updated.');\n      }\n    } catch (err) {\n      this.toast?.error('Failed to update flag.');\n    }\n\n    await this.loadFlags();\n  }\n\n  private renderFlags(flags: Flag[], mutable: boolean): void {\n    if (!this.tableBody || !this.emptyState) return;\n\n    this.tableBody.innerHTML = '';\n\n    const searchTerm = (this.searchInput?.value || '').toLowerCase().trim();\n    const filtered = searchTerm\n      ? flags.filter((f) => f.key && f.key.toLowerCase().includes(searchTerm))\n      : flags;\n\n    if (filtered.length === 0) {\n      this.emptyState.classList.remove('hidden');\n      return;\n    }\n\n    this.emptyState.classList.add('hidden');\n\n    filtered.forEach((flag) => {\n      const row = this.createFlagRow(flag, mutable);\n      this.tableBody!.appendChild(row);\n    });\n\n    this.wireActionMenus();\n  }\n\n  private createFlagRow(flag: Flag, mutable: boolean): HTMLTableRowElement {\n    const effective = flag.effective ? 'Enabled' : 'Disabled';\n    const effectiveBadge = this.badge(effective, flag.effective ? 'on' : 'off');\n    const source = flag.source || 'unknown';\n    const defaultValue =\n      flag.default && flag.default.set ? (flag.default.value ? 'Enabled' : 'Disabled') : '—';\n\n    const overrideState = this.normalizeOverrideState(flag);\n    const overrideValue =\n      flag.override && flag.override.value !== undefined\n        ? flag.override.value\n          ? 'Enabled'\n          : 'Disabled'\n        : '—';\n    const overrideLabel =\n      overrideState === 'enabled' || overrideState === 'disabled' ? overrideValue : 'Default';\n    const overrideBadge = this.badge(\n      overrideLabel,\n      overrideState === 'enabled' ? 'on' : overrideState === 'disabled' ? 'off' : 'neutral'\n    );\n\n    const currentVal = this.currentOverrideValue(flag);\n    const key = flag.key || '';\n\n    const row = document.createElement('tr');\n    row.innerHTML = `\n      <td class=\"px-5 py-4 text-sm text-gray-900 font-mono\">${this.escapeHtml(key)}</td>\n      <td class=\"px-5 py-4 text-sm\">${effectiveBadge}</td>\n      <td class=\"px-5 py-4 text-sm text-gray-600 capitalize\">${this.escapeHtml(source)}</td>\n      <td class=\"px-5 py-4 text-sm text-gray-600\">${defaultValue}</td>\n      <td class=\"px-5 py-4 text-sm\">${overrideBadge}</td>\n      <td class=\"px-5 py-4 text-sm\">${this.renderActionMenu(key, currentVal, !mutable)}</td>\n    `;\n\n    return row;\n  }\n\n  private badge(label: string, intent: 'on' | 'off' | 'neutral'): string {\n    const base = 'status-badge';\n    if (intent === 'on') {\n      return `<span class=\"${base} status-active\">${this.escapeHtml(label)}</span>`;\n    }\n    if (intent === 'off') {\n      return `<span class=\"${base} status-disabled\">${this.escapeHtml(label)}</span>`;\n    }\n    return `<span class=\"${base} status-draft\">${this.escapeHtml(label)}</span>`;\n  }\n\n  private normalizeOverrideState(flag: Flag): string {\n    const state = flag.override?.state ? String(flag.override.state) : 'missing';\n    return state.toLowerCase();\n  }\n\n  private currentOverrideValue(flag: Flag): OverrideState {\n    const state = this.normalizeOverrideState(flag);\n    if (state === 'enabled') return 'enabled';\n    if (state === 'disabled') return 'disabled';\n    return 'unset';\n  }\n\n  private renderActionMenu(key: string, currentValue: OverrideState, disabled: boolean): string {\n    const disabledClass = disabled ? 'opacity-50 pointer-events-none' : '';\n    const currentOption = ACTION_OPTIONS.find((o) => o.value === currentValue);\n\n    return `\n      <div class=\"relative action-menu ${disabledClass}\" data-flag-key=\"${this.escapeHtml(key)}\">\n        <button type=\"button\" class=\"action-menu-trigger inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-0\" ${disabled ? 'disabled' : ''}>\n          <span class=\"action-menu-label\">${currentOption?.label || 'Default'}</span>\n          ${ICONS.chevronDown}\n        </button>\n        <div class=\"action-menu-dropdown hidden absolute right-0 mt-1 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-20\">\n          ${ACTION_OPTIONS.map(\n            (opt) => `\n            <button type=\"button\" data-value=\"${opt.value}\" class=\"action-menu-item w-full text-left px-3 py-2 text-sm hover:bg-gray-50 flex items-center gap-2 ${opt.value === currentValue ? 'bg-gray-50 font-medium' : ''}\">\n              ${ICONS[opt.icon] || ''}\n              ${opt.label}\n            </button>\n          `\n          ).join('')}\n        </div>\n      </div>\n    `;\n  }\n\n  private wireActionMenus(): void {\n    document.querySelectorAll('.action-menu').forEach((menu) => {\n      const trigger = menu.querySelector<HTMLButtonElement>('.action-menu-trigger');\n      const dropdown = menu.querySelector<HTMLElement>('.action-menu-dropdown');\n      const items = menu.querySelectorAll<HTMLButtonElement>('.action-menu-item');\n      const key = (menu as HTMLElement).dataset.flagKey;\n\n      if (!trigger || !dropdown || !key) return;\n\n      trigger.addEventListener('click', (e) => {\n        e.stopPropagation();\n        // Close other open menus\n        document.querySelectorAll('.action-menu-dropdown').forEach((d) => {\n          if (d !== dropdown) d.classList.add('hidden');\n        });\n        dropdown.classList.toggle('hidden');\n      });\n\n      items.forEach((item) => {\n        item.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          const value = item.dataset.value as OverrideState;\n          dropdown.classList.add('hidden');\n          await this.updateFlag(key, value);\n        });\n      });\n    });\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n"],"names":["DEFAULT_SELECTORS","ACTION_OPTIONS","ICONS","FeatureFlagsManager","config","selectors","toast","d","params","scope","scopeId","query","next","url","response","text","payload","key","state","method","flags","mutable","searchTerm","filtered","f","flag","row","effective","effectiveBadge","source","defaultValue","overrideState","overrideValue","overrideLabel","overrideBadge","currentVal","label","intent","base","currentValue","disabled","disabledClass","currentOption","o","opt","menu","trigger","dropdown","items","e","item","value","div"],"mappings":"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"}