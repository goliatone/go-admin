{% macro render_item(item) %}
  {% if item.type == "separator" %}
    <div class="menu-separator my-2"></div>
  {% elif item.type == "group" %}
    <div class="menu-group mb-4">
      <button class="flex items-center w-full gap-2 px-3 py-2 text-xs font-medium text-sidebar-text-muted hover:text-sidebar-text transition-colors rounded-lg hover:bg-sidebar-bg-hover">
        <i class="iconoir-nav-arrow-down text-xs transition-transform"></i>
        <span class="flex-1 text-left uppercase tracking-wider">{% if item.group_title %}{{ item.group_title }}{% else %}{{ item.label }}{% endif %}</span>
        <span class="menu-group-ellipsis text-sidebar-text-muted">...</span>
      </button>
      <div class="space-y-0.5 mt-1">
        {% for child in item.children %}
          {{ render_item(child) }}
        {% endfor %}
      </div>
    </div>
  {% else %}
    {% set has_children = item.has_children %}
    {% if item.collapsible and has_children %}
      {% set submenu_id = item.key|default:item.label %}
      <button class="nav-item submenu-toggle{% if item.active or item.child_active %} active{% endif %}{% if item.classes %}{% for c in item.classes %} {{ c }}{% endfor %}{% endif %}"
              data-submenu-toggle="{{ submenu_id }}"
              data-expanded="{% if item.expanded %}true{% else %}false{% endif %}"
              style="height: var(--sidebar-item-height, 36px);{% if item.styles %} {% for k,v in item.styles %}{{ k }}: {{ v }}; {% endfor %}{% endif %}">
        {% if item.icon %}{{ renderMenuIcon(item.icon)|safe }}{% endif %}
        <span class="nav-text">{{ item.label }}</span>
        {% if item.badge %}
          <span class="ml-auto inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold {% if item.badge.color %}bg-{{ item.badge.color }}{% else %}bg-white/10{% endif %}">
            {% if item.badge.text %}{{ item.badge.text }}{% elif item.badge.value %}{{ item.badge.value }}{% endif %}
          </span>
        {% endif %}
        <i class="iconoir-nav-arrow-down submenu-indicator"></i>
      </button>
      <div class="submenu {% if item.expanded %}expanded{% else %}collapsed{% endif %}" data-submenu="{{ submenu_id }}">
        {% for child in item.children %}
          {{ render_item(child) }}
        {% endfor %}
      </div>
    {% else %}
      <a href="{{ item.href|default:'#' }}"
         class="nav-item{% if item.active %} active{% endif %}{% if item.classes %}{% for c in item.classes %} {{ c }}{% endfor %}{% endif %}"
         style="height: var(--sidebar-item-height, 36px);{% if item.styles %} {% for k,v in item.styles %}{{ k }}: {{ v }}; {% endfor %}{% endif %}">
        {% if item.icon %}{{ renderMenuIcon(item.icon)|safe }}{% endif %}
        <span class="nav-text">{{ item.label }}</span>
        {% if item.badge %}
          <span class="ml-auto inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold {% if item.badge.color %}bg-{{ item.badge.color }}{% else %}bg-white/10{% endif %}">
            {% if item.badge.text %}{{ item.badge.text }}{% elif item.badge.value %}{{ item.badge.value }}{% endif %}
          </span>
        {% endif %}
      </a>
      {% if has_children %}
        <div class="submenu expanded" data-submenu="{{ item.key|default:item.label }}">
          {% for child in item.children %}
            {{ render_item(child) }}
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}
