{% extends "layout.html" %}

{% block title %}Activity - {{ title }}{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ base_path }}/assets/dist/styles/activity.css">
{% endblock %}

{% block content %}
<header class="px-8 py-6 bg-white border-b border-gray-200 flex justify-between items-center">
  <div>
    <h1 class="text-3xl font-bold text-admin-dark">Activity</h1>
    <p class="text-sm text-gray-500 mt-1">Track actions and changes across your system.</p>
  </div>
  <button type="button" id="activity-refresh" class="btn btn-secondary">
    <i class="iconoir-refresh"></i>
    <span>Refresh</span>
  </button>
</header>

<div class="flex-1 p-8 overflow-y-auto">
  <div id="activity-disabled" class="hidden mb-4 rounded-lg border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900">
    Activity logging is not configured. Connect an ActivityRepository to enable this view.
  </div>
  <div id="activity-error" class="hidden mb-4 rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-900"></div>

  <div class="bg-white border border-gray-200 rounded-xl mb-6 p-4 shadow-sm">
    <form id="activity-filters" class="grid gap-4 md:grid-cols-3">
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-q">Keyword</label>
        <input id="filter-q" name="q" type="text" placeholder="Search metadata"
               class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-verb">Verb</label>
        <input id="filter-verb" name="verb" type="text" placeholder="created, updated, deleted"
               class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-channels">Channels</label>
        <input id="filter-channels" name="channels" type="text" placeholder="users, settings"
               class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-object-type">Object Type</label>
        <input id="filter-object-type" name="object_type" type="text" placeholder="user, role"
               class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-object-id">Object ID</label>
        <input id="filter-object-id" name="object_id" type="text" placeholder="123"
               class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-limit">Results</label>
        <select id="filter-limit" name="limit"
                class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
          <option value="50">50 per page</option>
          <option value="100">100 per page</option>
          <option value="200">200 per page</option>
        </select>
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-since">Since</label>
        <input id="filter-since" name="since" type="datetime-local"
               class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600 mb-1" for="filter-until">Until</label>
        <input id="filter-until" name="until" type="datetime-local"
               class="w-full border border-gray-200 rounded-lg text-sm px-3 py-2 focus:outline-none focus:ring-0 focus:border-gray-300">
      </div>
      <div class="flex items-end gap-2 md:col-span-3">
        <button type="submit" class="btn btn-primary">Apply Filters</button>
        <button type="button" id="activity-clear" class="btn btn-secondary">Clear</button>
      </div>
    </form>
  </div>

  <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="activity-table min-w-full text-sm text-left text-gray-700">
        <thead class="text-xs uppercase tracking-wide text-gray-500 bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="px-4 py-3 w-40">When</th>
            <th class="px-4 py-3 w-32">Action</th>
            <th class="px-4 py-3">Activity</th>
            <th class="px-4 py-3 w-24">Channel</th>
            <th class="px-4 py-3 w-48">Details</th>
          </tr>
        </thead>
        <tbody id="activity-table-body" class="divide-y divide-gray-100 bg-white"></tbody>
      </table>
    </div>
    <div id="activity-empty" class="hidden p-6 text-sm text-gray-500 text-center">
      <div class="text-4xl mb-3">ðŸ“‹</div>
      <p>No activity found.</p>
    </div>
  </div>

  <div class="mt-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div id="activity-count" class="text-sm text-gray-600"></div>
    <div class="flex gap-2">
      <button type="button" id="activity-prev" class="btn btn-secondary" disabled>
        <i class="iconoir-arrow-left"></i>
        <span>Previous</span>
      </button>
      <button type="button" id="activity-next" class="btn btn-secondary" disabled>
        <span>Next</span>
        <i class="iconoir-arrow-right"></i>
      </button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script type="module">
import { ActivityManager } from '{{ base_path }}/assets/dist/activity/index.js';

const basePath = '{{ base_path }}';
const apiPath = '{{ activity_api_path|default:"" }}' || `${basePath}/api/activity`;

const manager = new ActivityManager({
  apiPath,
  basePath,
});

manager.init();
</script>
{% endblock %}
