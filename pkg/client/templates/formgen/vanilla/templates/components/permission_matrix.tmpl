<div class="permission-matrix" data-field-name="{{ field_name }}">
  <table class="w-full border-collapse text-sm">
    <thead>
      <tr>
        <th class="text-left p-2 border-b border-gray-200 font-medium text-gray-700">Resource</th>
        {% for action in actions %}
        <th class="text-center p-2 border-b border-gray-200 font-medium text-gray-700">{{ action|title }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr class="hover:bg-gray-50">
        <td class="p-2 border-b border-gray-200 font-medium text-gray-900">{{ row.label }}</td>
        {% for cell in row.cells %}
        <td class="text-center p-2 border-b border-gray-200">
          <input type="checkbox" class="perm-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-offset-0" data-permission="{{ cell.perm }}"{% if cell.checked %} checked{% endif %}>
        </td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <input type="hidden" name="{{ field_name }}" class="permission-matrix-value" value="{{ serialized }}">

  {% if show_extra %}
  <div class="mt-3">
    <label class="text-xs font-medium text-gray-700">Additional permissions</label>
    <select
      class="permission-matrix-extra mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500"
      multiple
      data-endpoint-url="/__permission_matrix__/extras"
      data-endpoint-renderer="chips"
      data-endpoint-refresh="manual"
      data-endpoint-placeholder="Select additional permissions"
      data-endpoint-field-label="Additional permissions"
    >
      {% for perm in extra_options %}
      <option value="{{ perm }}"{% if perm in extra_selected %} selected{% endif %}>{{ perm }}</option>
      {% endfor %}
    </select>
    <div class="mt-2 flex items-center gap-2">
      <input type="text" class="permission-matrix-extra-input block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Add permission (e.g. admin.debug.repl)">
      <button type="button" class="permission-matrix-extra-add rounded-md border border-gray-300 bg-white px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">Add</button>
    </div>
    <p class="mt-1 text-xs text-gray-500">Selected values render as chips. Use Add to include custom permissions.</p>
  </div>
  {% endif %}
</div>
