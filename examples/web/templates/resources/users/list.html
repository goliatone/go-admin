{% extends "layout.html" %}

{% block title %}{{ resource_label|default:resource|title }} - {{ title }}{% endblock %}

{% block content %}
<header class="px-8 py-6 bg-white border-b border-gray-200 flex justify-between items-center">
  <h1 class="text-3xl font-bold text-admin-dark">{{ resource_label|default:resource|title }}</h1>
  <div class="flex gap-3">
    <a href="{{ routes.new }}" class="btn btn-primary">+ New {{ resource_label|default:resource|title }}</a>
  </div>
</header>

<div class="flex-1 p-8 overflow-y-auto">
  <div class="flex gap-4 items-center mb-6">
    <input
      type="text"
      id="resource-search"
      class="flex-1 px-4 py-3 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"
      placeholder="Search..."
    >
    <span class="text-zinc-500 text-sm" id="results-count">{{ total|default:"0"|integer }} items</span>
  </div>

  {% if items %}
  <div class="bg-white border border-gray-200 rounded-xl overflow-hidden">
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-gray-50 border-b border-gray-200">
          {% for col in columns %}
            <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">{{ col.label }}</th>
          {% endfor %}
          <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">Actions</th>
        </tr>
      </thead>
      <tbody id="resource-table-body">
        {% for item in items %}
        <tr data-resource-name="{{ resource }}" data-resource-id="{{ item.id }}" class="border-b border-gray-100 last:border-b-0 hover:bg-gray-50">
          {% for col in columns %}
            <td class="px-4 py-4 text-sm text-admin-dark">
              {% if col.key == 'status' %}
                <span class="status-badge status-{{ item[col.key] }}">{{ item[col.key]|default:"-" }}</span>
              {% else %}
                {{ item[col.key]|default:"-" }}
              {% endif %}
            </td>
          {% endfor %}
          <td class="px-4 py-4">
            <div class="flex gap-2">
              {% if item.actions.view %}<a href="{{ item.actions.view }}" class="btn btn-sm btn-secondary">View</a>{% endif %}
              {% if item.actions.edit %}<a href="{{ item.actions.edit }}" class="btn btn-sm btn-primary">Edit</a>{% endif %}
              {% if item.actions.delete %}
                <form method="POST" action="{{ item.actions.delete }}" class="inline">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this {{ resource_label|default:resource|lower }}?')">Delete</button>
                </form>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="text-center py-16">
    <div class="text-6xl mb-4">ðŸ“„</div>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No {{ resource_label|default:resource|lower }} yet</h3>
    <p class="text-gray-500 mb-6">Get started by creating your first {{ resource_label|default:resource|lower }}</p>
    <a href="{{ routes.new }}" class="btn btn-primary">Create</a>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
  // Simple client-side search across all columns
  document.getElementById('resource-search')?.addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#resource-table-body tr');
    let visible = 0;

    rows.forEach(row => {
      const cells = Array.from(row.querySelectorAll('td')).map(td => td.textContent.toLowerCase());
      const matches = cells.some(text => text.includes(query));
      row.style.display = matches ? '' : 'none';
      if (matches) visible++;
    });

    const label = document.getElementById('results-count');
    if (label) {
      label.textContent = `${visible} item${visible !== 1 ? 's' : ''}`;
    }
  });
</script>
{% endblock %}
