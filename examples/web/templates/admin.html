{% extends "layout.html" %}

{% block title %}Dashboard - {{ title }}{% endblock %}

{% block content %}
<header class="px-8 py-6 bg-white border-b border-gray-200 flex justify-between items-center">
  <h1 class="text-3xl font-bold text-admin-dark">Dashboard</h1>
  <div class="flex gap-3">
    <button class="btn btn-secondary" onclick="window.open('{{ base_path }}/api/dashboard')">‚Üë Export</button>
    <button class="btn btn-primary">+ Import</button>
  </div>
</header>

<div class="flex-1 p-8 overflow-y-auto">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Stats Overview -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-white border border-gray-200 rounded-xl p-6">
          <div class="text-sm text-zinc-500 mb-2">Total Revenue</div>
          <div class="text-3xl font-bold text-admin-dark" id="total-revenue">$0</div>
          <div class="text-sm text-zinc-500 mt-1" id="total-orders">0 orders</div>
        </div>
        <div class="bg-white border border-gray-200 rounded-xl p-6">
          <div class="text-sm text-zinc-500 mb-2">Total Users</div>
          <div class="text-3xl font-bold text-admin-dark" id="total-users">0</div>
          <div class="text-sm text-zinc-500 mt-1">Active users</div>
        </div>
        <div class="bg-white border border-gray-200 rounded-xl p-6">
          <div class="text-sm text-zinc-500 mb-2">Published Content</div>
          <div class="text-3xl font-bold text-admin-dark" id="published-content">0</div>
          <div class="text-sm text-zinc-500 mt-1">Pages & Posts</div>
        </div>
        <div class="bg-white border border-gray-200 rounded-xl p-6">
          <div class="text-sm text-zinc-500 mb-2">Storage Used</div>
          <div class="text-3xl font-bold text-admin-dark" id="storage-used">0 GB</div>
          <div class="text-sm text-zinc-500 mt-1" id="storage-percent">0% of total</div>
        </div>
      </div>

      <!-- Admin Panels -->
      <div class="bg-white border border-gray-200 rounded-xl p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-lg font-semibold text-admin-dark">Admin Panels</h2>
        </div>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <a href="{{ base_path }}/users" class="flex flex-col items-center text-center p-6 border border-gray-200 rounded-xl hover:border-blue-500 hover:shadow-lg hover:-translate-y-1 transition-all no-underline">
            <div class="text-4xl mb-3">üë•</div>
            <div class="text-base font-semibold text-admin-dark mb-1">Users</div>
            <div class="text-sm text-zinc-500">Manage user accounts</div>
          </a>
          <a href="{{ base_path }}/pages" class="flex flex-col items-center text-center p-6 border border-gray-200 rounded-xl hover:border-blue-500 hover:shadow-lg hover:-translate-y-1 transition-all no-underline">
            <div class="text-4xl mb-3">üìÑ</div>
            <div class="text-base font-semibold text-admin-dark mb-1">Pages</div>
            <div class="text-sm text-zinc-500">Edit website pages</div>
          </a>
          <a href="{{ base_path }}/posts" class="flex flex-col items-center text-center p-6 border border-gray-200 rounded-xl hover:border-blue-500 hover:shadow-lg hover:-translate-y-1 transition-all no-underline">
            <div class="text-4xl mb-3">üìù</div>
            <div class="text-base font-semibold text-admin-dark mb-1">Posts</div>
            <div class="text-sm text-zinc-500">Manage blog posts</div>
          </a>
          <a href="{{ base_path }}/media" class="flex flex-col items-center text-center p-6 border border-gray-200 rounded-xl hover:border-blue-500 hover:shadow-lg hover:-translate-y-1 transition-all no-underline">
            <div class="text-4xl mb-3">üñºÔ∏è</div>
            <div class="text-base font-semibold text-admin-dark mb-1">Media</div>
            <div class="text-sm text-zinc-500">Upload files & images</div>
          </a>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="bg-white border border-gray-200 rounded-xl p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-lg font-semibold text-admin-dark">Recent Activity</h2>
          <a href="{{ base_path }}/api/activity" class="text-sm text-blue-500 hover:text-blue-600 no-underline" target="_blank">View all</a>
        </div>
        <ul class="space-y-3" id="activity-feed">
          <li class="text-zinc-500">Loading...</li>
        </ul>
      </div>

      <!-- Background Jobs -->
      <div class="bg-white border border-gray-200 rounded-xl p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-lg font-semibold text-admin-dark">Background Jobs</h2>
          <a href="{{ base_path }}/api/jobs" class="text-sm text-blue-500 hover:text-blue-600 no-underline" target="_blank">Manage</a>
        </div>
        <ul class="space-y-2" id="jobs-list">
          <li class="text-zinc-500">Loading...</li>
        </ul>
      </div>
    </div>

    <!-- Right Sidebar -->
    <aside class="space-y-6">
      <!-- Revenue Chart -->
      <div class="bg-white border border-gray-200 rounded-xl p-6">
        <div class="text-xs uppercase tracking-wider text-zinc-500 mb-4 font-semibold">Receipt of Goods</div>
        <div class="flex justify-center mb-4">
          <div class="relative w-36 h-36">
            <svg class="w-full h-full" viewBox="0 0 140 140">
              <circle class="stroke-gray-100" fill="none" stroke-width="12" cx="70" cy="70" r="60"></circle>
              <circle class="stroke-blue-500" fill="none" stroke-width="12" cx="70" cy="70" r="60" id="revenue-circle"
                      stroke-dasharray="376.99" stroke-dashoffset="94.25"
                      transform="rotate(-90 70 70)" stroke-linecap="round"></circle>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
              <div class="text-2xl font-bold text-admin-dark" id="revenue-percent">75%</div>
              <div class="text-xs text-zinc-500">Complete</div>
            </div>
          </div>
        </div>
        <div class="space-y-2">
          <div class="flex justify-between text-sm">
            <span class="text-zinc-500">Target</span>
            <span class="font-semibold text-admin-dark">$50,000</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-zinc-500">Achieved</span>
            <span class="font-semibold text-admin-dark" id="revenue-achieved">$37,500</span>
          </div>
        </div>
      </div>

      <!-- System Metrics -->
      <div class="bg-white border border-gray-200 rounded-xl p-6">
        <div class="text-xs uppercase tracking-wider text-zinc-500 mb-4 font-semibold">System Metrics</div>
        <div class="space-y-4">
          <div>
            <div class="text-2xl font-bold text-admin-dark" id="metric-uptime">99.9%</div>
            <div class="text-sm text-zinc-500">Uptime</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-admin-dark" id="metric-requests">1.2M</div>
            <div class="text-sm text-zinc-500">Requests/day</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-admin-dark" id="metric-latency">45ms</div>
            <div class="text-sm text-zinc-500">Avg Latency</div>
          </div>
        </div>
      </div>

      <!-- Transaction Status -->
      <div class="bg-white border border-gray-200 rounded-xl p-6">
        <div class="text-xs uppercase tracking-wider text-zinc-500 mb-4 font-semibold">Transaction Status</div>
        <ul class="space-y-3">
          <li>
            <div class="flex justify-between mb-2 text-sm">
              <span class="flex items-center gap-2 text-admin-dark">
                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                Paid
              </span>
              <span class="font-semibold text-zinc-600" id="status-paid">65%</span>
            </div>
            <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
              <div class="h-full bg-green-500 rounded-full transition-all" style="width: 65%"></div>
            </div>
          </li>
          <li>
            <div class="flex justify-between mb-2 text-sm">
              <span class="flex items-center gap-2 text-admin-dark">
                <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                Cancelled
              </span>
              <span class="font-semibold text-zinc-600" id="status-cancelled">20%</span>
            </div>
            <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
              <div class="h-full bg-red-500 rounded-full transition-all" style="width: 20%"></div>
            </div>
          </li>
          <li>
            <div class="flex justify-between mb-2 text-sm">
              <span class="flex items-center gap-2 text-admin-dark">
                <span class="w-2 h-2 bg-amber-500 rounded-full"></span>
                Refunded
              </span>
              <span class="font-semibold text-zinc-600" id="status-refunded">15%</span>
            </div>
            <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
              <div class="h-full bg-amber-500 rounded-full transition-all" style="width: 15%"></div>
            </div>
          </li>
        </ul>
      </div>
    </aside>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Fetch and populate dashboard data
  async function loadDashboard() {
    try {
      const response = await fetch('{{ base_path }}/api/dashboard');
      const data = await response.json();

      // Update stats
      document.getElementById('total-revenue').textContent = `$${data.totalRevenue?.toLocaleString() || 0}`;
      document.getElementById('total-orders').textContent = `${data.totalOrders || 0} orders`;
      document.getElementById('total-users').textContent = data.totalUsers || 0;
      document.getElementById('published-content').textContent = data.publishedContent || 0;
      document.getElementById('storage-used').textContent = `${data.storageUsed || 0} GB`;
      document.getElementById('storage-percent').textContent = `${data.storagePercent || 0}% of total`;

      // Update revenue chart
      if (data.revenuePercent !== undefined) {
        const circle = document.getElementById('revenue-circle');
        const circumference = 2 * Math.PI * 60;
        const offset = circumference - (data.revenuePercent / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        document.getElementById('revenue-percent').textContent = `${data.revenuePercent}%`;
        document.getElementById('revenue-achieved').textContent = `$${data.revenueAchieved?.toLocaleString() || 0}`;
      }

      // Update activity feed
      if (data.recentActivity && data.recentActivity.length > 0) {
        const activityFeed = document.getElementById('activity-feed');
        activityFeed.innerHTML = data.recentActivity.map(activity => `
          <li class="py-3 border-b border-gray-100 last:border-b-0">
            <div class="font-semibold text-admin-dark text-sm">${activity.actor}</div>
            <div class="text-zinc-500 text-sm mt-1">${activity.action}</div>
          </li>
        `).join('');
      }

      // Update jobs list
      if (data.jobs && data.jobs.length > 0) {
        const jobsList = document.getElementById('jobs-list');
        jobsList.innerHTML = data.jobs.map(job => `
          <li class="py-2 px-3 border border-gray-200 rounded-lg bg-gray-50">
            <div class="flex items-center justify-between text-sm">
              <span class="font-medium text-admin-dark">${job.name}</span>
              <span class="text-xs text-zinc-500">${job.status}</span>
            </div>
          </li>
        `).join('');
      }
    } catch (error) {
      console.error('Failed to load dashboard data:', error);
    }
  }

  // Load dashboard data on page load
  window.addEventListener('DOMContentLoaded', loadDashboard);
</script>
{% endblock %}
