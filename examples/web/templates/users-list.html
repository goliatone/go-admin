{% extends "layout.html" %}

{% block title %}Users - {{ title }}{% endblock %}

{% block content %}
<header class="px-8 py-6 bg-white border-b border-gray-200 flex justify-between items-center">
  <h1 class="text-3xl font-bold text-admin-dark">Users</h1>
  <div class="flex gap-3">
    <a href="{{ base_path }}/users/new" class="btn btn-primary">+ Create User</a>
  </div>
</header>

<div class="flex-1 p-8 overflow-y-auto">
  <!-- Search Bar -->
  <div class="flex gap-4 items-center mb-6">
    <input
      type="text"
      id="user-search"
      class="flex-1 px-4 py-3 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"
      placeholder="Search by name, email, or role..."
    >
    <span class="text-zinc-500 text-sm" id="results-count">{{ total_users|integer }} users</span>
  </div>

  {% if users %}
  <!-- User Table -->
  <div class="bg-white border border-gray-200 rounded-xl overflow-hidden">
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-gray-50 border-b border-gray-200">
          <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">Name</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">Email</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">Role</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">Status</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">Created</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-zinc-500 uppercase tracking-wide">Actions</th>
        </tr>
      </thead>
      <tbody id="user-table-body">
        {% for user in users %}
        <tr data-user-id="{{ user.id }}" data-user-name="{{ user.username }}" data-user-email="{{ user.email }}" data-user-role="{{ user.role }}" class="border-b border-gray-100 last:border-b-0 hover:bg-gray-50">
          <td class="px-4 py-4 font-semibold text-admin-dark">{{ user.username }}</td>
          <td class="px-4 py-4 text-zinc-500">{{ user.email }}</td>
          <td class="px-4 py-4">{{ user.role }}</td>
          <td class="px-4 py-4">
            <span class="status-badge status-{{ user.status }}">{{ user.status }}</span>
          </td>
          <td class="px-4 py-4">{{ user.created_at }}</td>
          <td class="px-4 py-4">
            <div class="flex gap-2">
              <a href="{{ base_path }}/users/{{ user.id }}" class="btn btn-sm btn-secondary">View</a>
              <a href="{{ base_path }}/users/{{ user.id }}/edit" class="btn btn-sm btn-primary">Edit</a>
              <form method="POST" action="{{ base_path }}/users/{{ user.id }}/delete" class="inline">
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete {{ user.username }}?')">Delete</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <!-- Empty State -->
  <div class="text-center py-16">
    <div class="text-6xl mb-4">ðŸ‘¥</div>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No users yet</h3>
    <p class="text-gray-500 mb-6">Get started by creating your first user</p>
    <a href="{{ base_path }}/users/new" class="btn btn-primary">Create Your First User</a>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
  // Simple client-side search
  document.getElementById('user-search')?.addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#user-table-body tr');
    let visible = 0;

    rows.forEach(row => {
      const name = row.dataset.userName?.toLowerCase() || '';
      const email = row.dataset.userEmail?.toLowerCase() || '';
      const role = row.dataset.userRole?.toLowerCase() || '';
      const matches = name.includes(query) || email.includes(query) || role.includes(query);

      row.style.display = matches ? '' : 'none';
      if (matches) visible++;
    });

    document.getElementById('results-count').textContent = `${visible} user${visible !== 1 ? 's' : ''}`;
  });
</script>
{% endblock %}
